{"version":3,"sources":["layout/menu.js"],"names":["define","GenericNav","_l","model","Collection","visible","extend","target","Model","defaults","fetch","options","this","reset","extendedNavItem","GenericNavView","add","render","url","tooltip","title","disabled","Galaxy","user","id","menu","document","ready","$","each","webhook","Webhooks","callback","webhooks","masthead","collection","obj","name","icon","config","Utils","appendScriptStyle","onclick","function","Function","page","cls","support_url","citation_url","mailing_lists","terms_url","screencasts_url","wiki_url","biostar_url_redirect","userTab","noscratchbook","helpTab","activeView","set","get","session_csrf_token","divider","remove","show","active_view","off","jQuery","Deferred","resolve","promise","Tab","View","initialize","$menu","empty","removeClass","setElement","_template","_","self","append","menuItem","$note","addClass","events","click .dropdown-toggle","_buildMenuItem","css","_formatUrl","e","preventDefault","html","_toggleClick","trigger","$toggle","placement","buildLink","on","hide","popover","setTimeout","attr","frame","m","label","root","content","attributes","indexOf","charAt"],"mappings":"aACAA,QAAQ,0BAA2B,eAAgB,qBAAsB,eAAgB,SADzFC,EACAD,EAMIE,EACIC,GAwcJ,OACIC,WAvcQC,SADMD,WAAAE,QAENC,MAAAA,SAAQC,MAAAF,QAFFG,UAF0BJ,SAAA,EAOjCE,OAAA,aAGHG,MAAA,SAAAC,GAEAA,EAAAA,MACAC,KAAAC,QAKA,IAAAC,EAAA,IAAAb,EAAAc,eACAH,KAAAI,IAAAF,EAAAG,UAKIC,KAAAA,KACAC,GAAAA,WAJJC,MAAAlB,EAAA,gBAGIgB,IAAK,GAITC,QAAAjB,EAAA,wBAMIiB,KAAAA,KACAE,GAAAA,WACAH,MAAKhB,EAAA,YALTiB,QAAAjB,EAAA,8BAIImB,UAAWC,OAAOC,KAAKC,GAI3BN,IAAA,aAMIA,KAAAA,KACAC,GAAAA,SACAM,MACIvB,EAAA,eACIkB,IAAAA,gBACAF,QAAKhB,EAAA,8BAFTuB,OAMIP,MAAKhB,EAAA,kBAETgB,IAAA,iBAIAE,MAAAlB,EAAA,aACIkB,IAAOlB,6BAIPkB,MAAUlB,EAAA,aACVgB,IAAK,6BALLE,MAAOlB,EAAG,kBAUtBgB,IAAA,kCAGSE,MAAAlB,EAAA,SACDgB,IAAA,2BASIX,KAAAA,KAHJiB,GAKA,gBACIJ,MAAAA,EAAAA,iBACAF,IAAAA,sBACAX,QAAAA,EAAQ,sBAHZc,UAKAC,OAAAC,KAAAC,GACIJ,OAEAb,MAAQL,EAAA,qBAdVgB,IAAA,0BANVX,OAAA,WA0BAa,MAAAlB,EAAA,wBACAgB,IAAA,sBACAX,OAAa,WAGHmB,MAAFxB,EAAYyB,4BACRC,IAAEC,yBACEtB,OAAIuB,kBAEUC,EAAAf,KAN1BE,IAAK,4BAcWc,SAAA,SAAAC,GACAL,EAAAF,UAAAC,MAAIL,WACAA,EAAAA,KAAAA,EAAAA,OAAYY,SAASC,EAAAA,GACxB,IAAAL,EAAM3B,EAAImB,SACPA,GAAAA,EAAAA,SAAOY,CACV,IAAAE,GAZGZ,GAAIM,EAAQO,KAchBC,KAAAR,EAAAS,OAAAD,KACAE,IAAMC,EAAAA,OAAkBX,IAC3BX,QAAAW,EAAAS,OAAApB,QApBLuB,QAAAZ,EAAAS,OAAAI,UAAA,IAAAC,SAAAd,EAAAS,OAAAI,WAYYrB,OAAOuB,KAc/BvB,OAAAuB,KAAAX,SAAAC,WAAAnB,IAAAoB,GACAd,OAAAY,UACAZ,OAAAY,SAAAC,WAAAnB,IAAAoB,GAEaI,EAAAC,kBAAAX,WAaTV,OAAAA,KAAOlB,IAAG,aACViB,KAAAA,KACAM,GACI,QACIL,MAAOlB,EAAG,SACVgB,IAAKP,QACLJ,QAAQL,EAAA,0BAEZ4C,IAAA,eAOI5B,IAAAA,GACAX,GAAAA,OAHJa,MAKAlB,EAAA,QACIkB,QAAAA,EAAOlB,mCACPgB,OAGJE,MAAAlB,EAAA,WACIkB,IAAOlB,EADX6C,YAEI7B,OAAKP,WAILS,MAAUlB,EAAA,UACVgB,IAAKP,EAAQqC,WACbzC,OAAQ,WAIRW,MAAKhB,EAAA,iBAjCPgB,IAAAP,EAAAsC,cAJV1C,OAAA,WA4CaI,MAAQuC,EAAAA,UACLhC,IAAAP,EAAAwC,gBAJhB5C,OAAA,WASaa,MAAAlB,EAAA,QACGgB,IAAAP,EAAAyC,SAJhB7C,OAAA,WASaI,MAAQ0C,EAAAA,sBACLnC,IAAAP,EAAAqC,aAJhBzC,OAAA,WAQAa,MAAAlB,EAAA,qBACAgB,IAAA,WAIIP,EAAIA,WACA2C,EAAAA,KAAAA,MACI9B,MAAAA,EAAI,wBACJJ,IAAAA,EAAOlB,UACP4C,OAAAA,WAEArB,EAAAA,aAEQL,EAAAA,KAAAA,SACAF,MAAAA,EAAAA,kBACAX,IAAAA,oCACAgD,OAAAA,WAGAnC,EAAAA,aACAF,EAAAA,KAAAA,SACAX,MAAAA,EAAAA,kBACAgD,IAAAA,EAAAA,qBAJJhD,OAPE,WAebK,KArBDI,IAAAwC,GA0BQrC,IAAAA,KA0CID,EAzCJA,OAAAA,KAAKM,IA0CDjB,GAAAA,OAHJa,MA5BElB,EAAA,QALV4C,IAAA,gBAwCH3B,QAAAjB,EAAA,0BACDuB,OAEcgC,MAAAA,EAAWC,gBAAzB,IAAApC,OAAAC,KAAAoC,IAAA,WAjSRvC,MAAAlB,EAAA,eAiQwBgB,IAAK,SAuCbE,MAAAlB,EAAA,iBACKS,IAAQR,kBAGNiB,MAAOlB,EAAA,UACTgB,IAAO,kCAApBI,OAAAsC,mBACarD,OAAO,OACNsD,SAAd,IAGIzC,MAAAlB,EAAA,mBACJgB,IAAA,iBAZuBX,OAAA,SAgBvBa,MAAAlB,EAAA,kBACc4D,IAAd,gBACcvD,OAAM,SAGLa,MAAOlB,EAAA,eAEZgB,IAAKf,aAKGI,OAAWoD,UAlFjBpD,EAAAA,qBANJiB,GAAA,OASHJ,MAAAlB,EAAA,qBACE4C,IAAA,iBACHQ,QAAUpD,EAAA,iCACFuB,OAECL,MAAAlB,EAHC,SAIMgB,IAAA,aAERX,OAAA,cACWL,eAAG,IAILkB,MAAAlB,EAAA,YAETgB,IAAA,cACWhB,OAAG,cACLqD,eAAA,MAQT/B,GAAA,OACIJ,MAAOlB,EAAG,SACVgB,IAAK,iBACLX,QAAQL,EAAA,SAEZgB,IAAA,aACIE,OAAOlB,cACPgB,eAAK,GAkErBN,KAAII,IAAKb,GACL,IAAAsD,EAAWM,KAAXJ,IAAAhD,EAAAqD,aAKQpC,OAJRA,GAAE6B,EAAFC,IAEKO,UACG,IACArC,IAAEsC,OAAAC,UAAFC,UAAAC,aA+GhBC,IA1GQ1C,SAAE2C,KAAAjE,QACLkE,WAAA,SAAA7D,GACDC,KAAK6D,MAAMC,EAAQC,MACnB/D,KAAIgE,WAAWjB,KAAIkB,aACfC,KAAAA,UAAY3E,KAAMwD,EAAAA,aACdoB,KAAAA,QAAKN,KAAMO,EAAAA,oBACXC,KAAAA,MAAAA,KAASpB,EAAAA,kBACZjD,KAHDsE,MAAAtE,KAAAgB,EAAA,kBAIAmD,KAAAA,SAAAnE,KAAWuE,MAAS,SAAAvE,KAApBK,OAAAL,OAGJwE,QArEuBC,yBAAA,gBAyE3BC,OAAAA,WACI,IAAIP,EAAOnE,KAuEX,OAtEAD,EAAAA,YAAYF,SACRW,KAAAA,IAAAA,KADgC,KAAAR,KAAAT,MAAAqB,IAAA+D,KAEhCrE,WAFgCN,KAAAT,MAAAwD,IAAA,YAAA,WAAA,WAIhCJ,KAAAA,MAAAA,IAAAA,MAAe3C,KAAA4E,WAAA5E,KAAAT,MAAAwD,IAAA,SAJiB/C,KAApCsE,MAMAvE,KAAQO,KAAM6D,MAAKS,IAAAA,SAAW7E,IAC9BgE,cAMYc,SAAEC,iBACFX,SAAAnE,KAAeT,MAAAwD,IAAA,aACf4B,KACI5E,QAAQ+B,KAARvC,MAAAwD,IAAA,cAAA,SAAA,SAEArC,KAAAA,QACHqE,KAAA/E,KAAAT,MAAAwD,IAAA,UAAA,IAZbgB,cAlFuBQ,SAAA,mBAkClBA,SAASvE,KAAKT,MAAMwD,IAAI,QAiEjCwB,SAAAvE,KAAAT,MAAAwD,IAAA,SAAA,oBAAA/C,KAAAT,MAAAwD,IAAA,SACAiC,SAAchF,KAAAT,MAAAwD,IAAA,WAAY,UAClBoB,KAAAA,SAAJnE,KAAAT,MAAAwD,IAAA,WACIxD,KAAAA,OAAaA,KAAjBA,MAAAwD,IAAA,QACE+B,KAAAA,QAAF9E,KAAAT,MAAAwD,IAAA,YACExC,QAAF,WACAhB,KAAAA,MAAM0F,IAAQ,YAAYjF,KAAAkF,QAAY3E,SAAA4E,UAAA,WAClC5F,KAAAA,UADJwE,cAGKxE,SAAA,YACDgF,SAAKhF,KAAUA,MAAVwD,IAAmB,aAAA,YACpBxD,SAAMwD,KAAIxD,MAAAwD,IAAV,WAAiC,UACpC/C,KAFDT,MAEOwD,IAAA,SAAA/C,KAAAT,MAAAwD,IAAA,cACHxD,KAAAA,MAAMuD,OACT9B,EAAA,cACEmC,OACMiC,MACLC,GAAA,QAAS,WAFVrE,EAAA,cAAAsE,OA5DKnB,EAAK5E,MAAMuD,IAAI,aAAa,OAyE5BiC,EAAAA,MAAMO,OACNH,EAAAA,cAAWG,QAFNtF,KADb6D,MAWK0B,QAAQxB,YAXb,iBAYAyB,KAAAA,MAAWzC,IAAA,UACPoB,EAAAA,KAAAA,KAAKe,MAAQK,IAAAA,QAAQ,SAArBlB,GACDF,EAFHN,MAAAO,OAAAD,EAAAO,eAAAL,IAGHA,EAAApB,SAAAkB,EAAAN,MAAAO,OAAApD,EAAA,SAAAuD,SAAA,cA1EGJ,EAAKN,MAAMU,SAAS,iBA6E5BJ,EAAAe,QAAAd,OAAApD,EAAA,QAAAuD,SAAA,WAEWvE,MAIXiE,eAAW,SAAAlE,GACP,IAAAoE,EACInE,KApchB,OA4cSD,EAAAmE,EAAArE,SAAAE,OA/JLS,MAAA,GA6EYF,IAAK,GAqFVX,OAAA,UACHH,eADG,IAAPO,EAAAO,IAAA6D,EAAAS,WAAA7E,EAAAO,KA/cJU,EAAA,SAAAoD,OAgYgBpD,EAAE,QACGyE,KAAK,OAAQ1F,EAAQO,KACrBmF,KAAK,SAAU1F,EAAQJ,QACvBoF,KAAKhF,EAAQS,OACb6E,GAAG,QAAS,SAASR,GAClBA,EAAEC,iBACFX,EAAK5E,MAAMuD,IAAI,aAAa,GACxB/C,EAAQ+B,QACR/B,EAAQ+B,UAERpB,OAAOgF,MAAMtF,IAAIL,OAOrCiF,aAAc,SAASH,GACnB,IAAIV,EAAOnE,KACPT,EAAQS,KAAKT,MAMjB,GALAsF,EAAEC,iBACF9D,EAAE,YAAYsE,OACd/F,EAAM0F,QAAQ,WAAY,SAASU,GAC/BpG,EAAMqB,KAAO+E,EAAE/E,IAAM+E,EAAE5C,IAAI,SAAW4C,EAAE7C,IAAI,aAAa,KAExDvD,EAAMwD,IAAI,YAMR,CAAA,IACMqC,EAAT,SAAmBQ,EAAOtF,GACtB,OAAOU,EAAE,UACJoD,OACGpD,EAAE,QACGyE,KAAK,OAAQ/E,OAAOmF,KAAOvF,GAC3ByE,KAAKa,IAEbb,QAET/E,KAAKkF,QAAQK,SAAWvF,KAAKkF,QAAQK,QAAQ,WAC7CvF,KAAKkF,QACAK,SACGR,MAAM,EACNI,UAAW,SACXW,QACI,UACAV,EAAU,QAAS,8BACnB,OACAA,EAAU,WAAY,+BACtB,0BAEPG,QAAQ,QACbC,WAAW,WACPrB,EAAKe,QAAQK,QAAQ,YACtB,UA9BEhG,EAAMwD,IAAI,QAGXxD,EAAMuD,IAAI,aAAa,GAFvBvD,EAAMwD,IAAI,WAAaxD,EAAMwD,IAAI,UAAVxD,GAAyBmB,OAAOgF,MAAMtF,IAAIb,EAAMwG,aAkCnFnB,WAAY,SAAStE,GACjB,MAAqB,iBAAPA,IAA0C,IAAvBA,EAAI0F,QAAQ,OAAiC,KAAjB1F,EAAI2F,OAAO,GAAYvF,OAAOmF,KAAOvF,EAAMA,GAI5G2D,UAAW,WACP,MACI","file":"../../scripts/layout/menu.js","sourcesContent":["/** Masthead Collection **/\ndefine([\"layout/generic-nav-view\", \"mvc/webhooks\", \"utils/localization\", \"utils/utils\"], function(\n    GenericNav,\n    Webhooks,\n    _l,\n    Utils\n) {\n    var Collection = Backbone.Collection.extend({\n        model: Backbone.Model.extend({\n            defaults: {\n                visible: true,\n                target: \"_parent\"\n            }\n        }),\n        fetch: function(options) {\n            var self = this;\n            options = options || {};\n            this.reset();\n\n            //\n            // Chat server tab\n            //\n            var extendedNavItem = new GenericNav.GenericNavView();\n            this.add(extendedNavItem.render());\n\n            //\n            // Analyze data tab.\n            //\n            this.add({\n                id: \"analysis\",\n                title: _l(\"Analyze Data\"),\n                url: \"\",\n                tooltip: _l(\"Analysis home view\")\n            });\n\n            //\n            // Workflow tab.\n            //\n            this.add({\n                id: \"workflow\",\n                title: _l(\"Workflow\"),\n                tooltip: _l(\"Chain tools into workflows\"),\n                disabled: !Galaxy.user.id,\n                url: \"workflow\"\n            });\n\n            //\n            // 'Shared Items' or Libraries tab.\n            //\n            this.add({\n                id: \"shared\",\n                title: _l(\"Shared Data\"),\n                url: \"library/index\",\n                tooltip: _l(\"Access published resources\"),\n                menu: [\n                    {\n                        title: _l(\"Data Libraries\"),\n                        url: \"library/list\"\n                    },\n                    {\n                        title: _l(\"Histories\"),\n                        url: \"histories/list_published\"\n                    },\n                    {\n                        title: _l(\"Workflows\"),\n                        url: \"workflows/list_published\"\n                    },\n                    {\n                        title: _l(\"Visualizations\"),\n                        url: \"visualizations/list_published\"\n                    },\n                    {\n                        title: _l(\"Pages\"),\n                        url: \"pages/list_published\"\n                    }\n                ]\n            });\n\n            //\n            // Visualization tab.\n            //\n            this.add({\n                id: \"visualization\",\n                title: _l(\"Visualization\"),\n                url: \"visualizations/list\",\n                tooltip: _l(\"Visualize datasets\"),\n                disabled: !Galaxy.user.id,\n                menu: [\n                    {\n                        title: _l(\"New Track Browser\"),\n                        url: \"visualization/trackster\",\n                        target: \"_frame\"\n                    },\n                    {\n                        title: _l(\"Saved Visualizations\"),\n                        url: \"visualizations/list\",\n                        target: \"_frame\"\n                    },\n                    {\n                        title: _l(\"Interactive Environments\"),\n                        url: \"visualization/gie_list\",\n                        target: \"galaxy_main\"\n                    }\n                ]\n            });\n\n            //\n            // Webhooks\n            //\n            Webhooks.add({\n                url: \"api/webhooks/masthead/all\",\n                callback: function(webhooks) {\n                    $(document).ready(function() {\n                        $.each(webhooks.models, function(index, model) {\n                            var webhook = model.toJSON();\n                            if (webhook.activate) {\n                                var obj = {\n                                    id: webhook.name,\n                                    icon: webhook.config.icon,\n                                    url: webhook.config.url,\n                                    tooltip: webhook.config.tooltip,\n                                    onclick: webhook.config.function && new Function(webhook.config.function)\n                                };\n\n                                // Galaxy.page is undefined for data libraries, workflows pages\n                                if (Galaxy.page) {\n                                    Galaxy.page.masthead.collection.add(obj);\n                                } else if (Galaxy.masthead) {\n                                    Galaxy.masthead.collection.add(obj);\n                                }\n\n                                // Append masthead script and styles to Galaxy main\n                                Utils.appendScriptStyle(webhook);\n                            }\n                        });\n                    });\n                }\n            });\n\n            //\n            // Admin.\n            //\n            Galaxy.user.get(\"is_admin\") &&\n                this.add({\n                    id: \"admin\",\n                    title: _l(\"Admin\"),\n                    url: \"admin\",\n                    tooltip: _l(\"Administer this Galaxy\"),\n                    cls: \"admin-only\"\n                });\n\n            //\n            // Help tab.\n            //\n            var helpTab = {\n                id: \"help\",\n                title: _l(\"Help\"),\n                tooltip: _l(\"Support, contact, and community\"),\n                menu: [\n                    {\n                        title: _l(\"Support\"),\n                        url: options.support_url,\n                        target: \"_blank\"\n                    },\n                    {\n                        title: _l(\"Search\"),\n                        url: options.search_url,\n                        target: \"_blank\"\n                    },\n                    {\n                        title: _l(\"Mailing Lists\"),\n                        url: options.mailing_lists,\n                        target: \"_blank\"\n                    },\n                    {\n                        title: _l(\"Videos\"),\n                        url: options.screencasts_url,\n                        target: \"_blank\"\n                    },\n                    {\n                        title: _l(\"Wiki\"),\n                        url: options.wiki_url,\n                        target: \"_blank\"\n                    },\n                    {\n                        title: _l(\"How to Cite Galaxy\"),\n                        url: options.citation_url,\n                        target: \"_blank\"\n                    },\n                    {\n                        title: _l(\"Interactive Tours\"),\n                        url: \"tours\"\n                    }\n                ]\n            };\n            options.terms_url &&\n                helpTab.menu.push({\n                    title: _l(\"Terms and Conditions\"),\n                    url: options.terms_url,\n                    target: \"_blank\"\n                });\n            options.biostar_url &&\n                helpTab.menu.unshift({\n                    title: _l(\"Ask a question\"),\n                    url: \"biostar/biostar_question_redirect\",\n                    target: \"_blank\"\n                });\n            options.biostar_url &&\n                helpTab.menu.unshift({\n                    title: _l(\"Galaxy Biostar\"),\n                    url: options.biostar_url_redirect,\n                    target: \"_blank\"\n                });\n            this.add(helpTab);\n\n            //\n            // User tab.\n            //\n            var userTab = {};\n            if (!Galaxy.user.id) {\n                if (options.allow_user_creation) {\n                    userTab = {\n                        id: \"user\",\n                        title: _l(\"Login or Register\"),\n                        cls: \"loggedout-only\",\n                        tooltip: _l(\"Account registration or login\"),\n                        menu: [\n                            {\n                                title: _l(\"Login\"),\n                                url: \"user/login\",\n                                target: \"galaxy_main\",\n                                noscratchbook: true\n                            },\n                            {\n                                title: _l(\"Register\"),\n                                url: \"user/create\",\n                                target: \"galaxy_main\",\n                                noscratchbook: true\n                            }\n                        ]\n                    };\n                } else {\n                    userTab = {\n                        id: \"user\",\n                        title: _l(\"Login\"),\n                        cls: \"loggedout-only\",\n                        tooltip: _l(\"Login\"),\n                        url: \"user/login\",\n                        target: \"galaxy_main\",\n                        noscratchbook: true\n                    };\n                }\n            } else {\n                userTab = {\n                    id: \"user\",\n                    title: _l(\"User\"),\n                    cls: \"loggedin-only\",\n                    tooltip: _l(\"Account and saved data\"),\n                    menu: [\n                        {\n                            title: _l(\"Logged in as\") + \" \" + Galaxy.user.get(\"email\")\n                        },\n                        {\n                            title: _l(\"Preferences\"),\n                            url: \"user\"\n                        },\n                        {\n                            title: _l(\"Custom Builds\"),\n                            url: \"custom_builds\"\n                        },\n                        {\n                            title: _l(\"Logout\"),\n                            url: \"user/logout?session_csrf_token=\" + Galaxy.session_csrf_token,\n                            target: \"_top\",\n                            divider: true\n                        },\n                        {\n                            title: _l(\"Saved Histories\"),\n                            url: \"histories/list\",\n                            target: \"_top\"\n                        },\n                        {\n                            title: _l(\"Saved Datasets\"),\n                            url: \"datasets/list\",\n                            target: \"_top\"\n                        },\n                        {\n                            title: _l(\"Saved Pages\"),\n                            url: \"pages/list\",\n                            target: \"_top\"\n                        }\n                    ]\n                };\n            }\n            this.add(userTab);\n            var activeView = this.get(options.active_view);\n            activeView && activeView.set(\"active\", true);\n            return new jQuery.Deferred().resolve().promise();\n        }\n    });\n\n    /** Masthead tab **/\n    var Tab = Backbone.View.extend({\n        initialize: function(options) {\n            this.model = options.model;\n            this.setElement(this._template());\n            this.$dropdown = this.$(\".dropdown\");\n            this.$toggle = this.$(\".dropdown-toggle\");\n            this.$menu = this.$(\".dropdown-menu\");\n            this.$note = this.$(\".dropdown-note\");\n            this.listenTo(this.model, \"change\", this.render, this);\n        },\n\n        events: {\n            \"click .dropdown-toggle\": \"_toggleClick\"\n        },\n\n        render: function() {\n            var self = this;\n            $(\".tooltip\").remove();\n            this.$el.attr(\"id\", this.model.id).css({\n                visibility: (this.model.get(\"visible\") && \"visible\") || \"hidden\"\n            });\n            this.model.set(\"url\", this._formatUrl(this.model.get(\"url\")));\n            this.$note\n                .html(this.model.get(\"note\") || \"\")\n                .removeClass()\n                .addClass(\"dropdown-note\")\n                .addClass(this.model.get(\"note_cls\"))\n                .css({\n                    display: (this.model.get(\"show_note\") && \"block\") || \"none\"\n                });\n            this.$toggle\n                .html(this.model.get(\"title\") || \"\")\n                .removeClass()\n                .addClass(\"dropdown-toggle\")\n                .addClass(this.model.get(\"cls\"))\n                .addClass(this.model.get(\"icon\") && \"dropdown-icon fa \" + this.model.get(\"icon\"))\n                .addClass(this.model.get(\"toggle\") && \"toggle\")\n                .attr(\"target\", this.model.get(\"target\"))\n                .attr(\"href\", this.model.get(\"url\"))\n                .attr(\"title\", this.model.get(\"tooltip\"))\n                .tooltip(\"destroy\");\n            this.model.get(\"tooltip\") && this.$toggle.tooltip({ placement: \"bottom\" });\n            this.$dropdown\n                .removeClass()\n                .addClass(\"dropdown\")\n                .addClass(this.model.get(\"disabled\") && \"disabled\")\n                .addClass(this.model.get(\"active\") && \"active\");\n            if (this.model.get(\"menu\") && this.model.get(\"show_menu\")) {\n                this.$menu.show();\n                $(\"#dd-helper\")\n                    .show()\n                    .off()\n                    .on(\"click\", function() {\n                        $(\"#dd-helper\").hide();\n                        self.model.set(\"show_menu\", false);\n                    });\n            } else {\n                self.$menu.hide();\n                $(\"#dd-helper\").hide();\n            }\n            this.$menu.empty().removeClass(\"dropdown-menu\");\n            if (this.model.get(\"menu\")) {\n                _.each(this.model.get(\"menu\"), function(menuItem) {\n                    self.$menu.append(self._buildMenuItem(menuItem));\n                    menuItem.divider && self.$menu.append($(\"<li/>\").addClass(\"divider\"));\n                });\n                self.$menu.addClass(\"dropdown-menu\");\n                self.$toggle.append($(\"<b/>\").addClass(\"caret\"));\n            }\n            return this;\n        },\n\n        /** Add new menu item */\n        _buildMenuItem: function(options) {\n            var self = this;\n            options = _.defaults(options || {}, {\n                title: \"\",\n                url: \"\",\n                target: \"_parent\",\n                noscratchbook: false\n            });\n            options.url = self._formatUrl(options.url);\n            return $(\"<li/>\").append(\n                $(\"<a/>\")\n                    .attr(\"href\", options.url)\n                    .attr(\"target\", options.target)\n                    .html(options.title)\n                    .on(\"click\", function(e) {\n                        e.preventDefault();\n                        self.model.set(\"show_menu\", false);\n                        if (options.onclick) {\n                            options.onclick();\n                        } else {\n                            Galaxy.frame.add(options);\n                        }\n                    })\n            );\n        },\n\n        /** Handle click event */\n        _toggleClick: function(e) {\n            var self = this;\n            var model = this.model;\n            e.preventDefault();\n            $(\".tooltip\").hide();\n            model.trigger(\"dispatch\", function(m) {\n                model.id !== m.id && m.get(\"menu\") && m.set(\"show_menu\", false);\n            });\n            if (!model.get(\"disabled\")) {\n                if (!model.get(\"menu\")) {\n                    model.get(\"onclick\") ? model.get(\"onclick\")() : Galaxy.frame.add(model.attributes);\n                } else {\n                    model.set(\"show_menu\", true);\n                }\n            } else {\n                function buildLink(label, url) {\n                    return $(\"<div/>\")\n                        .append(\n                            $(\"<a/>\")\n                                .attr(\"href\", Galaxy.root + url)\n                                .html(label)\n                        )\n                        .html();\n                }\n                this.$toggle.popover && this.$toggle.popover(\"destroy\");\n                this.$toggle\n                    .popover({\n                        html: true,\n                        placement: \"bottom\",\n                        content:\n                            \"Please \" +\n                            buildLink(\"login\", \"user/login?use_panels=True\") +\n                            \" or \" +\n                            buildLink(\"register\", \"user/create?use_panels=True\") +\n                            \" to use this feature.\"\n                    })\n                    .popover(\"show\");\n                setTimeout(function() {\n                    self.$toggle.popover(\"destroy\");\n                }, 5000);\n            }\n        },\n\n        /** Url formatting */\n        _formatUrl: function(url) {\n            return typeof url == \"string\" && url.indexOf(\"//\") === -1 && url.charAt(0) != \"/\" ? Galaxy.root + url : url;\n        },\n\n        /** body tempate */\n        _template: function() {\n            return (\n                '<ul class=\"nav navbar-nav\">' +\n                '<li class=\"dropdown\">' +\n                '<a class=\"dropdown-toggle\"/>' +\n                '<ul class=\"dropdown-menu\"/>' +\n                '<div class=\"dropdown-note\"/>' +\n                \"</li>\" +\n                \"</ul>\"\n            );\n        }\n    });\n\n    return {\n        Collection: Collection,\n        Tab: Tab\n    };\n});\n"]}