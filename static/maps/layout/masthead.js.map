{"version":3,"sources":["layout/masthead.js"],"names":["define","Utils","Scratchbook","QuotaMeter","View","Backbone","options","initialize","setElement","self","$navbarBrandLink","this","$navbarBrandImage","$navbarBrandTitle","$navbarTabs","$","$quoteMeter","collection","Menu","Collection","on","model","append","Tab","render","$el","empty","callback","frame","fetch","Galaxy","user","el","quotaMeter","$download_link","closest","UserQuotaMeter","e","target","text","length","q","attr","hide","preventDefault","html","get","brand","logo_src","_template"],"mappings":"aAAAA,QAAQ,cAAe,cAAe,qBAAsB,4BAA6B,SACrFC,EADJD,EAMIE,EACAC,GA+FA,OACIC,KA7FIC,SAAAD,KAAeE,QACfC,WAAKC,SAAWF,GAChB,IAAAG,EAAKC,KACLC,KAAKC,QAAAA,EACLD,KAAKE,WAAAA,KAAAA,aACLF,KAAKG,iBAAmBC,KAAEA,EAAA,sBAC1BJ,KAAKK,kBAAcL,KAAOI,EAAA,uBAF1BJ,KAAKE,kBAAoBF,KAAKI,EAAE,uBAIhCJ,KAAAG,YAAAH,KAAAI,EAAA,gBACAJ,KAAKM,YAAaN,KAAIO,EAAAA,0BAIjBP,KAHLM,WAIiB,IAAAC,EAAWC,WACpBV,KAAAA,WALRW,GAOQ,MAAA,SAAYC,GACZZ,EAAKQ,YAAgBK,OAAA,IAAAJ,EAAYK,KAAAF,MAAAA,IAAAG,SAAAC,OAAjCL,GAAA,QAAA,WARRX,EAYWK,YAZXY,UAcAN,GAAA,WAAA,SAAAO,GACOC,EAAPX,WAAoBW,KAAQ,SAAI1B,GAC5Be,EAAiBA,OAGrBY,MAAAlB,KAAAL,SAGIe,OAAAA,MAAOS,KAAOC,MADkD,IAAA7B,GAEhE8B,WAAShB,KAAAA,aAMLc,OAAAG,WAAIC,KAAiBnB,WAAYoB,IAAAA,EAAQC,gBACzCf,MAAIa,OAAAA,KACAF,GAAArB,KAAII,cAQJsB,EAAAA,QACHjB,GAAA,QAAA,SAAAiB,GAED,IAAAH,EAAgBnB,EAAAsB,EAAAC,QAAWH,QAAA,eAC3B,GAAII,EAAJC,SACqC,IAAhCvB,EAAAA,uBAAgBuB,QACTnB,EAAAA,QAAUC,OACZiB,EAAQE,aAFlBC,KAAA,KAAA,YAIiBC,QArBzB5B,EAAA,uBAAA2B,KAAA,MAAAR,EAAAQ,KAAA,SAxCwBL,EAAAO,oBAoEnB/B,GAAAA,eAAkBgC,WAClBnC,IAAAA,EAAAA,GARG,GASHE,EAAAA,WAAkB8B,KAAK,SAAOrB,GAC9BY,IAAWT,EAAAA,EAAhBsB,IAAA,mBAAAzB,EAAAyB,IAAA,iBAAAzB,GACAoB,IAAAF,GAAAE,EAAA,OAXqB,KAATF,EAchB,OAAAA,KARAf,OAAQ,WAKJ,OAuBDb,KAAAE,kBAAAgC,KAAA,WAAAlC,KAAAL,QAAAyC,OAAA,KAAApC,KAAAL,QAAAyC,OAAA,KACH3C,KAAMA,iBAAAA,KAAAA,OAAAA,KAAAA,QAAAA,UADVO,KAAAC,kBAAA8B,KAAA,MAAA/B,KAAAL,QAAA0C,UAtGJrC,KAAAsB,WAAAT,SA+EmBb,MAIXsC,UAAW,WACP,MACI","file":"../../scripts/layout/masthead.js","sourcesContent":["define([\"utils/utils\", \"layout/menu\", \"layout/scratchbook\", \"mvc/user/user-quotameter\"], function(\n    Utils,\n    Menu,\n    Scratchbook,\n    QuotaMeter\n) {\n    /** Masthead **/\n    var View = Backbone.View.extend({\n        initialize: function(options) {\n            var self = this;\n            this.options = options;\n            this.setElement(this._template());\n            this.$navbarBrandLink = this.$(\".navbar-brand-link\");\n            this.$navbarBrandImage = this.$(\".navbar-brand-image\");\n            this.$navbarBrandTitle = this.$(\".navbar-brand-title\");\n            this.$navbarTabs = this.$(\".navbar-tabs\");\n            this.$quoteMeter = this.$(\".quota-meter-container\");\n\n            // build tabs\n            this.collection = new Menu.Collection();\n            this.collection\n                .on(\"add\", function(model) {\n                    self.$navbarTabs.append(new Menu.Tab({ model: model }).render().$el);\n                })\n                .on(\"reset\", function() {\n                    self.$navbarTabs.empty();\n                })\n                .on(\"dispatch\", function(callback) {\n                    self.collection.each(function(m) {\n                        callback(m);\n                    });\n                })\n                .fetch(this.options);\n\n            // scratchbook\n            Galaxy.frame = this.frame = new Scratchbook({\n                collection: this.collection\n            });\n\n            // set up the quota meter (And fetch the current user data from trans)\n            // add quota meter to masthead\n            Galaxy.quotaMeter = this.quotaMeter = new QuotaMeter.UserQuotaMeter({\n                model: Galaxy.user,\n                el: this.$quoteMeter\n            });\n\n            // loop through beforeunload functions if the user attempts to unload the page\n            $(window)\n                .on(\"click\", function(e) {\n                    var $download_link = $(e.target).closest(\"a[download]\");\n                    if ($download_link.length == 1) {\n                        if ($(\"iframe[id=download]\").length === 0) {\n                            $(\"body\").append(\n                                $(\"<iframe/>\")\n                                    .attr(\"id\", \"download\")\n                                    .hide()\n                            );\n                        }\n                        $(\"iframe[id=download]\").attr(\"src\", $download_link.attr(\"href\"));\n                        e.preventDefault();\n                    }\n                })\n                .on(\"beforeunload\", function() {\n                    var text = \"\";\n                    self.collection.each(function(model) {\n                        var q = model.get(\"onbeforeunload\") && model.get(\"onbeforeunload\")();\n                        q && (text += q + \" \");\n                    });\n                    if (text !== \"\") {\n                        return text;\n                    }\n                });\n        },\n\n        render: function() {\n            this.$navbarBrandTitle.html(\"Galaxy \" + ((this.options.brand && \"/ \" + this.options.brand) || \"\"));\n            this.$navbarBrandLink.attr(\"href\", this.options.logo_url);\n            this.$navbarBrandImage.attr(\"src\", this.options.logo_src);\n            this.quotaMeter.render();\n            return this;\n        },\n\n        /** body template */\n        _template: function() {\n            return (\n                '<div id=\"masthead\" class=\"navbar navbar-fixed-top navbar-inverse\">' +\n                '<div class=\"navbar-header\">' +\n                '<div class=\"navbar-tabs\"/>' +\n                \"</div>\" +\n                '<div class=\"navbar-brand\">' +\n                '<a class=\"navbar-brand-link\">' +\n                '<img class=\"navbar-brand-image\"/>' +\n                '<span class=\"navbar-brand-title\"/>' +\n                \"</a>\" +\n                \"</div>\" +\n                '<div class=\"quota-meter-container\"/>' +\n                '<div class=\"navbar-icons\"/>' +\n                \"</div>\"\n            );\n        }\n    });\n\n    return {\n        View: View\n    };\n});\n"]}