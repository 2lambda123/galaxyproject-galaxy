{"version":3,"file":"history-model.js","sources":["../../../src/mvc/history/history-model.js"],"names":["define","HISTORY_CONTENTS","HISTORY_PREFS","CONTROLLED_FETCH_COLLECTION","UTILS","BASE_MVC","_l","History","Backbone","Model","extend","LoggableMixin","mixin","SearchableModelMixin","_logNamespace","UPDATE_DELAY","defaults","model_class","id","name","state","deleted","contents_active","contents_states","urlRoot","Galaxy","root","contentsClass","HistoryContents","searchAttributes","searchAliases","title","tag","initialize","historyJSON","options","this","logger","log","contents","history","historyId","get","order","_setUpListeners","_setUpCollectionListeners","updateTimeoutId","on","error","clearUpdateTimeout","change:id","model","newId","listenTo","trigger","apply","jQuery","makeArray","arguments","contentsShown","contentsActive","shown","active","includeDeleted","includeHidden","hidden","nice_size","size","bytesToString","toJSON","_","prototype","call","key","ownedByCurrUser","user","isAnonymous","numOfUnfinishedJobs","unfinishedJobIds","length","numOfUnfinishedShownContents","runningAndActive","_fetchContentRelatedAttributes","contentRelatedAttrs","fetch","data","$","param","keys","join","refresh","self","lastUpdateTime","allFetched","fetchFn","currentPage","fetchPage","fetchUpdated","done","response","status","xhr","serverResponseDatetime","Date","getResponseHeader","err","setSeconds","getSeconds","checkForUpdates","_delayThenUpdate","setTimeout","delay","nonReadyContentCount","clearTimeout","parse","parsed","create_time","update_time","fetchWithContents","contentsOptions","view","then","setHistoryId","fetchContents","fetchCurrentPage","_delete","when","save","purge","purged","undelete","copy","current","allDatasets","undefined","Error","postData","history_id","all_datasets","post","newHistory","setAsCurrent","getJSON","toString","_collectionSuper","InfinitelyScrollingCollection","HistoryCollection","limitOnFirstFetch","limitPerFetch","models","currentHistoryId","setUpListeners","url","change:deleted","debug","remove","copied","original","newData","setCurrent","set-as-current","oldCurrentId","_buildFetchData","_buildFetchFilters","superFilters","filters","fetchFirst","silent","limit","encoded_id-in","offset","fetchMore","comparators","clone","buildComparator","ascending","name-dsc","size-asc","sort","currentHistory","unshift","create","hdas","historyOptions","collection"],"mappings":"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"}