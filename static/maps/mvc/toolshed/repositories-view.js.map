{"version":3,"sources":["mvc/toolshed/repositories-view.js"],"names":["define","toolshed_model","toolshed_util","Category","Backbone","View","extend","el","params","initialize","this","self","model","render","shed","CategoryCollection","listenTo","category_id","tool_shed","url","options","_","category_contents_template","templateCategoryContents","category","models","$","css","bindEvents","that","require","autocomplete","source","request","shed_url","replace","base_url","Galaxy","root","term","tool_shed_url","post","data","result_list","shedParser","response","minLength","select","event","tsr_id","ui","item","value","new_route","history","navigate","trigger","reDraw","$el","empty","template","join"],"mappings":"aAAAA,QAAQ,8BAA+B,qBAAsB,SAASC,EAAgBC,GA4GlF,OACIC,SA5G+BC,SAASC,KAAKC,QAD7CC,GAAA,UAEAA,WAAI,SADgDC,GAGpDC,KAAAA,MAAY,IAAAR,EAASO,mBACjBE,KAAIC,SAAOD,KAAXE,MAAA,OAAAF,KAAAG,QACA,IAAAC,EAAAN,EAAiBP,UAAAA,QAAec,MAAAA,OAChCL,KAAKM,MAAAA,KAAS,kBAAoBF,EAAlC,gBAAAN,EAAAS,YACAP,KAAII,MAAON,UAAOU,EAClBR,KAAKE,MAAMO,SAAOX,EAAAS,YAClBP,KAAKE,MAAMM,SAGdL,OAZmD,SAAAO,GAehDV,KAAKU,QAAUC,EAAEf,OAAOI,KAAKU,QAASA,GAD1CP,IAAQS,EAAkBZ,KAAAa,yBACtBb,KAAKU,IAAAA,KACDE,GACJE,SACIF,KAAAA,MAAAA,OAAAA,GACIE,UAAeZ,KAALA,MAAWa,UACrBP,MAAWhB,EAAWgB,iBAI9BQ,EAAE,WAAWC,IAAI,WAAY,QAC7BjB,KAAKkB,cAGTA,WAAY,WACR,IAAIC,EAAOnB,KACXoB,SAAS,yBAA0B,WAC/BJ,EAAE,eAAeK,cACbC,OAAQ,SAAAC,EAASA,GACb,IAAIC,EAAWL,EAAKjB,MAAMM,UAAUiB,QAAQ,OAAQ,KAChDC,EAAWC,OAAOC,KAAO,uBACzB9B,GACA+B,KAAMN,EAAQM,KACdC,cAAeN,GAEnBR,EAAEe,KAAKL,EAAU5B,EAAQ,SAAAkC,GACrB,IAAIC,EAAczC,EAAc0C,WAAWF,GAC3CG,EAASF,MAGjBG,UAAW,EACXC,OAAQ,SAAAC,EAASA,GACb,IAAIC,EAASC,EAAGC,KAAKC,MACjBC,EAAY,gBAAkBxB,EAAKjB,MAAMM,UAAY,MAAQ+B,EACjE7C,SAASkD,QAAQC,SAASF,GACtBG,SAAS,EACTrB,SAAS,UAO7BsB,OAAQ,SAAArC,GACJV,KAAKgD,IAAIC,QACTjD,KAAKD,WAAWW,IAGpBG,yBAA0BF,EAAEuC,UAEpB,0BA2CL,+CACHzD,6CADJ,WA5GJ,yEAsEgB,4FACA,wJACA,SACA,0DACA,+DACA,4BACA,8LACA,UACA,SACA,8CACA,uBACA,iCACA,OACA,qCACA,oCACA,oBACA,oCACA,QACA,WACA,oEACA,OACA,mCACA,OACA,wEACA,8FACA,SACA,QACA,yCACA,kCACA,QACA,YACA,WACA,SACA,UACF0D,KAAK","file":"../../../scripts/mvc/toolshed/repositories-view.js","sourcesContent":["define([\"mvc/toolshed/toolshed-model\", \"mvc/toolshed/util\"], function(toolshed_model, toolshed_util) {\n    var ToolShedCategoryContentsView = Backbone.View.extend({\n        el: \"#center\",\n\n        initialize: function(params) {\n            var self = this;\n            this.model = new toolshed_model.CategoryCollection();\n            this.listenTo(this.model, \"sync\", this.render);\n            var shed = params.tool_shed.replace(/\\//g, \"%2f\");\n            this.model.url += \"?tool_shed_url=\" + shed + \"&category_id=\" + params.category_id;\n            this.model.tool_shed = shed;\n            this.model.category = params.category_id;\n            this.model.fetch();\n        },\n\n        render: function(options) {\n            this.options = _.extend(this.options, options);\n            var category_contents_template = this.templateCategoryContents;\n            this.$el.html(\n                category_contents_template({\n                    category: this.model.models[0],\n                    tool_shed: this.model.tool_shed,\n                    queue: toolshed_util.queueLength()\n                })\n            );\n            $(\"#center\").css(\"overflow\", \"auto\");\n            this.bindEvents();\n        },\n\n        bindEvents: function() {\n            var that = this;\n            require([\"libs/jquery/jquery-ui\"], function() {\n                $(\"#search_box\").autocomplete({\n                    source: function(request, response) {\n                        var shed_url = that.model.tool_shed.replace(/%2f/g, \"/\");\n                        var base_url = Galaxy.root + \"api/tool_shed/search\";\n                        var params = {\n                            term: request.term,\n                            tool_shed_url: shed_url\n                        };\n                        $.post(base_url, params, function(data) {\n                            var result_list = toolshed_util.shedParser(data);\n                            response(result_list);\n                        });\n                    },\n                    minLength: 3,\n                    select: function(event, ui) {\n                        var tsr_id = ui.item.value;\n                        var new_route = \"repository/s/\" + that.model.tool_shed + \"/r/\" + tsr_id;\n                        Backbone.history.navigate(new_route, {\n                            trigger: true,\n                            replace: true\n                        });\n                    }\n                });\n            });\n        },\n\n        reDraw: function(options) {\n            this.$el.empty();\n            this.initialize(options);\n        },\n\n        templateCategoryContents: _.template(\n            [\n                '<style type=\"text/css\">',\n                \".ui-autocomplete { background-color: #fff; }\",\n                \"li.ui-menu-item { list-style-type: none; }\",\n                \"</style>\",\n                '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n                '<div class=\"unified-panel-header-inner\">Repositories in <%= category.get(\"name\") %></div>',\n                '<div class=\"unified-panel-header-inner\" style=\"position: absolute; right: 5px; top: 0px;\"><a href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n                \"</div>\",\n                '<div class=\"unified-panel-body\" id=\"list_repositories\">',\n                '<div id=\"standard-search\" style=\"height: 2em; margin: 1em;\">',\n                '<span class=\"ui-widget\" >',\n                '<input class=\"search-box-input\" id=\"search_box\" name=\"search\" data-shedurl=\"<%= tool_shed.replace(/%2f/g, \"/\") %>\" placeholder=\"Search repositories by name or id\" size=\"60\" type=\"text\" />',\n                \"</span>\",\n                \"</div>\",\n                '<div style=\"clear: both; margin-top: 1em;\">',\n                '<table class=\"grid\">',\n                '<thead id=\"grid-table-header\">',\n                \"<tr>\",\n                '<th style=\"width: 10%;\">Owner</th>',\n                '<th style=\"width: 15%;\">Name</th>',\n                \"<th>Synopsis</th>\",\n                '<th style=\"width: 10%;\">Type</th>',\n                \"</tr>\",\n                \"</thead>\",\n                '<% _.each(category.get(\"repositories\"), function(repository) { %>',\n                \"<tr>\",\n                \"<td><%= repository.owner %></td>\",\n                \"<td>\",\n                '<div style=\"float: left; margin-left: 1px;\" class=\"menubutton split\">',\n                '<a href=\"#/repository/s/<%= tool_shed %>/r/<%= repository.id %>\"><%= repository.name %></a>',\n                \"</div>\",\n                \"</td>\",\n                \"<td><%= repository.description %></td>\",\n                \"<td><%= repository.type %></td>\",\n                \"</tr>\",\n                \"<% }); %>\",\n                \"</table>\",\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        )\n    });\n\n    return {\n        Category: ToolShedCategoryContentsView\n    };\n});\n"]}