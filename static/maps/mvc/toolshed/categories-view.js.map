{"version":3,"sources":["mvc/toolshed/categories-view.js"],"names":["define","toolshed_model","toolshed_util","CategoryView","Backbone","View","extend","el","tool_shed","initialize","options","this","self","_","defaults","shed","replace","render","model","url","Categories","listenTo","categories","models","queue","category_list_template","queueLength","$","$el","bindEvents","that","autocomplete","source","request","response","shed_url","base_url","Galaxy","params","tool_shed_url","console","log","data","post","minLength","select","event","ui","item","value","tsr_id","root","history","navigate","new_route","reDraw","empty","templateCategoryList","template","join"],"mappings":"aAAAA,QAAQ,8BAA+B,qBAAsB,SAASC,EAAgBC,GA+GlF,OACIC,aA/GqBC,SAASC,KAAKC,QADnCC,GAAA,UAEAA,UAGIC,UAAW,mCADLC,WAHgC,SAAAC,GAQtC,IADJD,EAAYC,EAAAF,UAASE,QAAS,MAAA,OAC1BC,KAAIC,QAAJC,EAAAC,SAAAH,KAAAD,SAAAA,EAAAC,KAAAG,UACAH,KAAII,MAAOL,IAAAA,EAAkBM,WAC7BL,KAAKD,SAALC,KAAiBG,MAAS,OAAKJ,KAALO,QAC1BN,KAAKO,MAALC,IAAiBlB,KAAAA,MAAAA,IAAemB,kBAAhCT,KAAAD,QAAAF,UACAG,KAAKU,MAAAA,UAAcH,EACnBP,KAAKO,MAAMC,SAGdF,OAhByC,SAAAP,GAmBtCC,KAAKD,QAAUG,EAAEP,OAAOK,KAAKD,QAASA,GAD1CO,KAAQP,QAAAY,WAASZ,KAASQ,MAAAK,OACtBZ,KAAKD,QAALc,MAAiBlB,EAAYI,cAC7B,IAAAe,EAA0Bd,KAAKO,qBAC/BP,KAAKD,IAAAA,KAAQc,EAAsBE,KAAAA,UACnCC,EAAA,WAAIF,IAAAA,WAAyB,QAC7Bd,KAAKiB,cAGRC,WA1ByC,WA6BtC,IAAIC,EAAOnB,KADfkB,SAAY,yBAAW,WACfC,EAAAA,eAAJC,cACQC,OAAC,SAAAC,EAATC,GACM,IAAAC,EAAeJ,EAAAA,MAAavB,UAAAQ,QAAA,OAAA,KAClBoB,EAAAC,OAASJ,KAASC,uBAClBC,GACAC,KAAAA,EAAWC,KACXC,cAASH,GAETI,EAAAA,KAAAA,EAAAA,EAAeJ,SAAAA,GAFnBK,QAAAC,IAAAC,GAIEC,IAAKP,EAAUE,EAAiBI,WAAMA,GACpCF,EAAQC,MAGXG,UAJD,EAKHC,OAbyB,SAAAC,EAAAC,GAc1BH,IAAAA,EAd0BG,EAAAC,KAAAC,MAoBlBC,GALAb,OAASS,KAECT,EAAOc,MAAO3C,UAGhB0C,gBAAAA,EAAAA,MAAAA,UAAAA,MAAAA,GAFC9C,SAAbgD,QAAAC,SAAAC,GAIIA,SAAAA,EACJlD,SAASgD,UAOxBG,OA7DyC,SAAA7C,GAgEtCC,KAAKiB,IAAI4B,QADbD,KAAQrC,MAAAC,IAAAR,KAASD,MAATS,IAAkB,kBAAAR,KAAAD,QAAAF,UACtBG,KAAKiB,WAALlB,IAGH+C,qBAnEyC5C,EAAA6C,UAqE1CD,0BArEJ,+CAyEY,6CAqCL,WACHtD,yEADJ,4HA/GJ,wJA+EgB,SACA,wDACA,+DACA,4BACA,8LACA,UACA,SACA,8CACA,uBACA,iCACA,OACA,gBACA,uBACA,wBACA,QACA,WACA,gDACA,OACA,OACA,sGACA,QACA,8CACA,+CACA,QACA,YACA,WACA,SACA,UACFwD,KAAK","file":"../../../scripts/mvc/toolshed/categories-view.js","sourcesContent":["define([\"mvc/toolshed/toolshed-model\", \"mvc/toolshed/util\"], function(toolshed_model, toolshed_util) {\n    var ToolShedCategories = Backbone.View.extend({\n        el: \"#center\",\n\n        defaults: {\n            tool_shed: \"https://toolshed.g2.bx.psu.edu/\"\n        },\n\n        initialize: function(options) {\n            var self = this;\n            var shed = options.tool_shed.replace(/\\//g, \"%2f\");\n            this.options = _.defaults(this.options || options, this.defaults);\n            this.model = new toolshed_model.Categories();\n            this.listenTo(this.model, \"sync\", this.render);\n            this.model.url = this.model.url + \"?tool_shed_url=\" + this.options.tool_shed;\n            this.model.tool_shed = shed;\n            this.model.fetch();\n        },\n\n        render: function(options) {\n            this.options = _.extend(this.options, options);\n            this.options.categories = this.model.models;\n            this.options.queue = toolshed_util.queueLength();\n            var category_list_template = this.templateCategoryList;\n            this.$el.html(category_list_template(this.options));\n            $(\"#center\").css(\"overflow\", \"auto\");\n            this.bindEvents();\n        },\n\n        bindEvents: function() {\n            var that = this;\n            require([\"libs/jquery/jquery-ui\"], function() {\n                $(\"#search_box\").autocomplete({\n                    source: function(request, response) {\n                        var shed_url = that.model.tool_shed.replace(/%2f/g, \"/\");\n                        var base_url = Galaxy.root + \"api/tool_shed/search\";\n                        var params = {\n                            term: request.term,\n                            tool_shed_url: shed_url\n                        };\n                        $.post(base_url, params, function(data) {\n                            console.log(data);\n                            var result_list = toolshed_util.shedParser(data);\n                            response(result_list);\n                        });\n                    },\n                    minLength: 3,\n                    select: function(event, ui) {\n                        var tsr_id = ui.item.value;\n                        var api_url = Galaxy.root + \"api/tool_shed/repository\";\n                        var params = {\n                            tool_shed_url: that.model.tool_shed,\n                            tsr_id: tsr_id\n                        };\n                        var new_route = \"repository/s/\" + that.model.tool_shed + \"/r/\" + tsr_id;\n                        Backbone.history.navigate(new_route, {\n                            trigger: true,\n                            replace: true\n                        });\n                    }\n                });\n            });\n        },\n\n        reDraw: function(options) {\n            this.$el.empty();\n            this.model.url = this.model.url + \"?tool_shed_url=\" + this.options.tool_shed;\n            this.initialize(options);\n        },\n\n        templateCategoryList: _.template(\n            [\n                '<style type=\"text/css\">',\n                \".ui-autocomplete { background-color: #fff; }\",\n                \"li.ui-menu-item { list-style-type: none; }\",\n                \"</style>\",\n                '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n                '<div class=\"unified-panel-header-inner\" style=\"layout: inline;\">Categories in <%= tool_shed.replace(/%2f/g, \"/\") %></div>',\n                '<div class=\"unified-panel-header-inner\" style=\"position: absolute; right: 5px; top: 0px;\"><a href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n                \"</div>\",\n                '<div class=\"unified-panel-body\" id=\"list_categories\">',\n                '<div id=\"standard-search\" style=\"height: 2em; margin: 1em;\">',\n                '<span class=\"ui-widget\" >',\n                '<input class=\"search-box-input\" id=\"search_box\" data-shedurl=\"<%= tool_shed.replace(/%2f/g, \"/\") %>\" name=\"search\" placeholder=\"Search repositories by name or id\" size=\"60\" type=\"text\" />',\n                \"</span>\",\n                \"</div>\",\n                '<div style=\"clear: both; margin-top: 1em;\">',\n                '<table class=\"grid\">',\n                '<thead id=\"grid-table-header\">',\n                \"<tr>\",\n                \"<th>Name</th>\",\n                \"<th>Description</th>\",\n                \"<th>Repositories</th>\",\n                \"</tr>\",\n                \"</thead>\",\n                \"<% _.each(categories, function(category) { %>\",\n                \"<tr>\",\n                \"<td>\",\n                '<a href=\"#/category/s/<%= tool_shed %>/c/<%= category.get(\"id\") %>\"><%= category.get(\"name\") %></a>',\n                \"</td>\",\n                '<td><%= category.get(\"description\") %></td>',\n                '<td><%= category.get(\"repositories\") %></td>',\n                \"</tr>\",\n                \"<% }); %>\",\n                \"</table>\",\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        )\n    });\n\n    return {\n        CategoryView: ToolShedCategories\n    };\n});\n"]}