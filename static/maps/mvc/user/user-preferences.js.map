{"version":3,"sources":["mvc/user/user-preferences.js"],"names":["define","Form","Ui","QueryStringParsing","Model","Backbone","extend","initialize","options","user_id","Galaxy","user","id","information","title","description","url","redirect","password","icon","communication","permissions","submit_title","api_key","toolbox_filters","openids","onclick","location","href","root","custom_builds","logout","modal","show","body","buttons","Cancel","hide","Sign out","window","session_csrf_token","View","this","model","setElement","render","self","config","$","getJSON","data","$preferences","message","status","append","_","escape","email","prepend","Message","get","use_remote_user","_addLink","$el","enable_communication_server","enable_openid","empty","_templateFooter","action","$a","$row","find","attr","$table","nice_total_disk_usage","enable_quotas","quota"],"mappings":"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","file":"../../../scripts/mvc/user/user-preferences.js","sourcesContent":["/** User Preferences view */\ndefine([\"mvc/form/form-view\", \"mvc/ui/ui-misc\", \"utils/query-string-parsing\"], function(Form, Ui, QueryStringParsing) {\n    /** Contains descriptive dictionaries describing user forms */\n    var Model = Backbone.Model.extend({\n        initialize: function(options) {\n            options = options || {};\n            options.user_id = options.user_id || Galaxy.user.id;\n            this.set({\n                user_id: options.user_id,\n                information: {\n                    title: \"Manage information\",\n                    description: \"Edit your email, addresses and custom parameters or change your username.\",\n                    url: \"api/users/\" + options.user_id + \"/information/inputs\",\n                    icon: \"fa-user\",\n                    redirect: \"user\"\n                },\n                password: {\n                    title: \"Change password\",\n                    description: \"Allows you to change your login credentials.\",\n                    icon: \"fa-unlock-alt\",\n                    url: \"api/users/\" + options.user_id + \"/password/inputs\",\n                    submit_title: \"Save password\",\n                    redirect: \"user\"\n                },\n                communication: {\n                    title: \"Change communication settings\",\n                    description: \"Enable or disable the communication feature to chat with other users.\",\n                    url: \"api/users/\" + options.user_id + \"/communication/inputs\",\n                    icon: \"fa-comments-o\",\n                    redirect: \"user\"\n                },\n                permissions: {\n                    title: \"Set dataset permissions for new histories\",\n                    description:\n                        \"Grant others default access to newly created histories. Changes made here will only affect histories created after these settings have been stored.\",\n                    url: \"api/users/\" + options.user_id + \"/permissions/inputs\",\n                    icon: \"fa-users\",\n                    submit_title: \"Save permissions\",\n                    redirect: \"user\"\n                },\n                api_key: {\n                    title: \"Manage API key\",\n                    description: \"Access your current API key or create a new one.\",\n                    url: \"api/users/\" + options.user_id + \"/api_key/inputs\",\n                    icon: \"fa-key\",\n                    submit_title: \"Create a new key\",\n                    submit_icon: \"fa-check\"\n                },\n                toolbox_filters: {\n                    title: \"Manage Toolbox filters\",\n                    description: \"Customize your Toolbox by displaying or omitting sets of Tools.\",\n                    url: \"api/users/\" + options.user_id + \"/toolbox_filters/inputs\",\n                    icon: \"fa-filter\",\n                    submit_title: \"Save filters\",\n                    redirect: \"user\"\n                },\n                openids: {\n                    title: \"Manage OpenIDs\",\n                    description: \"Associate OpenIDs with your account.\",\n                    icon: \"fa-openid\",\n                    onclick: function() {\n                        window.location.href = Galaxy.root + \"user/openid_manage?cntrller=user&use_panels=True\";\n                    }\n                },\n                custom_builds: {\n                    title: \"Manage custom builds\",\n                    description: \"Add or remove custom builds using history datasets.\",\n                    icon: \"fa-cubes\",\n                    onclick: function() {\n                        window.location.href = Galaxy.root + \"custom_builds\";\n                    }\n                },\n                logout: {\n                    title: \"Sign out\",\n                    description: \"Click here to sign out of all sessions.\",\n                    icon: \"fa-sign-out\",\n                    onclick: function() {\n                        Galaxy.modal.show({\n                            title: \"Sign out\",\n                            body: \"Do you want to continue and sign out of all active sessions?\",\n                            buttons: {\n                                Cancel: function() {\n                                    Galaxy.modal.hide();\n                                },\n                                \"Sign out\": function() {\n                                    window.location.href =\n                                        Galaxy.root + \"user/logout?session_csrf_token=\" + Galaxy.session_csrf_token;\n                                }\n                            }\n                        });\n                    }\n                }\n            });\n        }\n    });\n\n    /** View of the main user preference panel with links to individual user forms */\n    var View = Backbone.View.extend({\n        title: \"User Preferences\",\n        initialize: function() {\n            this.model = new Model();\n            this.setElement(\"<div/>\");\n            this.render();\n        },\n\n        render: function() {\n            var self = this;\n            var config = Galaxy.config;\n            $.getJSON(Galaxy.root + \"api/users/\" + Galaxy.user.id, function(data) {\n                self.$preferences = $(\"<div/>\")\n                    .addClass(\"ui-panel\")\n                    .append($(\"<h2/>\").append(\"User preferences\"))\n                    .append($(\"<p/>\").append(\"You are logged in as <strong>\" + _.escape(data.email) + \"</strong>.\"))\n                    .append((self.$table = $(\"<table/>\").addClass(\"ui-panel-table\")));\n                var message = QueryStringParsing.get(\"message\");\n                var status = QueryStringParsing.get(\"status\");\n                if (message && status) {\n                    self.$preferences.prepend(new Ui.Message({ message: message, status: status }).$el);\n                }\n                if (!config.use_remote_user) {\n                    self._addLink(\"information\");\n                    self._addLink(\"password\");\n                }\n                if (config.enable_communication_server) {\n                    self._addLink(\"communication\");\n                }\n                self._addLink(\"custom_builds\");\n                self._addLink(\"permissions\");\n                self._addLink(\"api_key\");\n                if (config.has_user_tool_filters) {\n                    self._addLink(\"toolbox_filters\");\n                }\n                if (config.enable_openid && !config.use_remote_user) {\n                    self._addLink(\"openids\");\n                }\n                if (Galaxy.session_csrf_token) {\n                    self._addLink(\"logout\");\n                }\n                self.$preferences.append(self._templateFooter(data));\n                self.$el.empty().append(self.$preferences);\n            });\n        },\n\n        _addLink: function(action) {\n            var options = this.model.get(action);\n            var $row = $(this._templateLink(options));\n            var $a = $row.find(\"a\");\n            if (options.onclick) {\n                $a.on(\"click\", function() {\n                    options.onclick();\n                });\n            } else {\n                $a.attr(\"href\", Galaxy.root + \"user/\" + action);\n            }\n            this.$table.append($row);\n        },\n\n        _templateLink: function(options) {\n            return (\n                \"<tr>\" +\n                \"<td>\" +\n                '<div class=\"ui-panel-icon fa ' +\n                options.icon +\n                '\">' +\n                \"</td>\" +\n                \"<td>\" +\n                '<a class=\"ui-panel-anchor\" href=\"javascript:void(0)\">' +\n                options.title +\n                \"</a>\" +\n                '<div class=\"ui-form-info\">' +\n                options.description +\n                \"</div>\" +\n                \"</td>\" +\n                \"</tr>\"\n            );\n        },\n\n        _templateFooter: function(options) {\n            return (\n                '<p class=\"ui-panel-footer\">' +\n                \"You are using <strong>\" +\n                options.nice_total_disk_usage +\n                \"</strong> of disk space in this Galaxy instance. \" +\n                (Galaxy.config.enable_quotas ? \"Your disk quota is: <strong>\" + options.quota + \"</strong>. \" : \"\") +\n                'Is your usage more than expected? See the <a href=\"https://galaxyproject.org/learn/managing-datasets/\" target=\"_blank\">documentation</a> for tips on how to find all of the data in your account.' +\n                \"</p>\"\n            );\n        }\n    });\n\n    return {\n        View: View,\n        Model: Model\n    };\n});\n"]}