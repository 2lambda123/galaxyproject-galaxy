{"version":3,"sources":["mvc/dataset/dataset-edit-attributes.js"],"names":["define","Utils","Tabs","Ui","Form","View","Backbone","extend","initialize","Model","dataset_id","Galaxy","params","this","tabs","_createTabs","message","$","$el","append","render","hide","url","success","ajax","self","initial_message","model","get","_","each","forms","form","response","key","set","show","err_msg","status","responseJSON","update","data","operation","create","type","root","_reloadHistory","error","conversion","datatype","permission","_getAttribute","_getConversion","_getPermission","title","icon","tooltip","id","attribute","operations","submit_attributes","ButtonIcon","onclick","submit_autodetect","_submit","submit_conversion","_getDatatype","submit_datatype","submit_permission","window","currHistoryPanel","loadCurrentHistory"],"mappings":"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","file":"../../../scripts/mvc/dataset/dataset-edit-attributes.js","sourcesContent":["/** Dataset edit attributes view */\ndefine([\"utils/utils\", \"mvc/ui/ui-tabs\", \"mvc/ui/ui-misc\", \"mvc/form/form-view\"], function(Utils, Tabs, Ui, Form) {\n    var View = Backbone.View.extend({\n        initialize: function() {\n            this.setElement(\"<div/>\");\n            this.model = new Backbone.Model({\n                dataset_id: Galaxy.params.dataset_id\n            });\n            this.message = new Ui.Message({ persistent: true });\n            this.tabs = this._createTabs();\n            this.$el\n                .append($(\"<h4/>\").append(\"Edit dataset attributes\"))\n                .append(this.message.$el)\n                .append(\"<p/>\")\n                .append(this.tabs.$el)\n                .hide();\n            this.render();\n        },\n\n        /** fetch data for the selected dataset and build forms */\n        render: function() {\n            var self = this;\n            $.ajax({\n                url: Galaxy.root + \"dataset/get_edit?dataset_id=\" + self.model.get(\"dataset_id\"),\n                success: function(response) {\n                    !self.initial_message && self.message.update(response);\n                    self.initial_message = true;\n                    _.each(self.forms, function(form, key) {\n                        form.model.set(\"inputs\", response[key + \"_inputs\"]);\n                        form.model.set(\"hide_operations\", response[key + \"_disable\"]);\n                        form.render();\n                    });\n                    self.$el.show();\n                },\n                error: function(response) {\n                    var err_msg = response.responseJSON && response.responseJSON.err_msg;\n                    self.message.update({\n                        status: \"danger\",\n                        message: err_msg || \"Error occured while loading the dataset.\"\n                    });\n                }\n            });\n        },\n\n        /** submit data to backend to update attributes */\n        _submit: function(operation, form) {\n            var self = this;\n            var data = form.data.create();\n            data.dataset_id = this.model.get(\"dataset_id\");\n            data.operation = operation;\n            $.ajax({\n                type: \"PUT\",\n                url: Galaxy.root + \"dataset/set_edit\",\n                data: data,\n                success: function(response) {\n                    self.message.update(response);\n                    self.render();\n                    self._reloadHistory();\n                },\n                error: function(response) {\n                    var err_msg = response.responseJSON && response.responseJSON.err_msg;\n                    self.message.update({\n                        status: \"danger\",\n                        message: err_msg || \"Error occured while editing the dataset attributes.\"\n                    });\n                }\n            });\n        },\n\n        /** create tabs for different dataset attribute categories*/\n        _createTabs: function() {\n            this.forms = {\n                attribute: this._getAttribute(),\n                conversion: this._getConversion(),\n                datatype: this._getDatatype(),\n                permission: this._getPermission()\n            };\n            var tabs = new Tabs.View();\n            tabs.add({\n                id: \"attribute\",\n                title: \"Attributes\",\n                icon: \"fa fa-bars\",\n                tooltip: \"Edit dataset attributes\",\n                $el: this.forms.attribute.$el\n            });\n            tabs.add({\n                id: \"convert\",\n                title: \"Convert\",\n                icon: \"fa-gear\",\n                tooltip: \"Convert to new format\",\n                $el: this.forms.conversion.$el\n            });\n            tabs.add({\n                id: \"datatype\",\n                title: \"Datatypes\",\n                icon: \"fa-database\",\n                tooltip: \"Change data type\",\n                $el: this.forms.datatype.$el\n            });\n            tabs.add({\n                id: \"permissions\",\n                title: \"Permissions\",\n                icon: \"fa-user\",\n                tooltip: \"Permissions\",\n                $el: this.forms.permission.$el\n            });\n            return tabs;\n        },\n\n        /** edit main attributes form */\n        _getAttribute: function() {\n            var self = this;\n            var form = new Form({\n                title: \"Edit attributes\",\n                operations: {\n                    submit_attributes: new Ui.ButtonIcon({\n                        tooltip: \"Save attributes of the dataset.\",\n                        icon: \"fa-floppy-o\",\n                        title: \"Save\",\n                        onclick: function() {\n                            self._submit(\"attributes\", form);\n                        }\n                    }),\n                    submit_autodetect: new Ui.ButtonIcon({\n                        tooltip:\n                            \"This will inspect the dataset and attempt to correct the values of fields if they are not accurate.\",\n                        icon: \"fa-undo\",\n                        title: \"Auto-detect\",\n                        onclick: function() {\n                            self._submit(\"autodetect\", form);\n                        }\n                    })\n                }\n            });\n            return form;\n        },\n\n        /** datatype conversion form */\n        _getConversion: function() {\n            var self = this;\n            var form = new Form({\n                title: \"Convert to new format\",\n                operations: {\n                    submit_conversion: new Ui.ButtonIcon({\n                        tooltip: \"Convert the datatype to a new format.\",\n                        title: \"Convert datatype\",\n                        icon: \"fa-exchange\",\n                        onclick: function() {\n                            self._submit(\"conversion\", form);\n                        }\n                    })\n                }\n            });\n            return form;\n        },\n\n        /** change datatype form */\n        _getDatatype: function() {\n            var self = this;\n            var form = new Form({\n                title: \"Change datatype\",\n                operations: {\n                    submit_datatype: new Ui.ButtonIcon({\n                        tooltip: \"Change the datatype to a new type.\",\n                        title: \"Change datatype\",\n                        icon: \"fa-exchange\",\n                        onclick: function() {\n                            self._submit(\"datatype\", form);\n                        }\n                    })\n                }\n            });\n            return form;\n        },\n\n        /** dataset permissions form */\n        _getPermission: function() {\n            var self = this;\n            var form = new Form({\n                title: \"Manage dataset permissions\",\n                operations: {\n                    submit_permission: new Ui.ButtonIcon({\n                        tooltip: \"Save permissions.\",\n                        title: \"Save permissions\",\n                        icon: \"fa-floppy-o \",\n                        onclick: function() {\n                            self._submit(\"permission\", form);\n                        }\n                    })\n                }\n            });\n            return form;\n        },\n\n        /** reload Galaxy's history after updating dataset's attributes */\n        _reloadHistory: function() {\n            if (window.Galaxy) {\n                window.Galaxy.currHistoryPanel.loadCurrentHistory();\n            }\n        }\n    });\n\n    return {\n        View: View\n    };\n});\n"]}