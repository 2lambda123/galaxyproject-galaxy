{"version":3,"sources":["mvc/form/form-repeat.js"],"names":["define","Utils","Portlet","Ui","View","Backbone","extend","initialize","options","merge","title","empty_text","min","ButtonIcon","icon","button_new","this","tooltip","cls","onnew","setElement","$","$list","append","$el","size","_","list","Galaxy","id","onclick","ondel","operations","portlet","button_delete","hide","_refresh","fadeIn","max","disable","emit","debug","enable","remove","delAll","del","hideOperation","each","isEmpty","addClass","html","index"],"mappings":"aACAA,QAAQ,cAAe,oBAAqB,kBAAmB,SAASC,EAAOC,EAASC,GAuGpF,OACIC,KAzGRC,SAAAD,KAAAE,QACQC,WAAA,SAAeC,GACfJ,KAAOC,QACPE,KAAAA,QAAYN,EAAAQ,MAAAD,GACRE,MAAA,SACAC,WAAeV,iBACXS,IAAAA,KACAC,IAAAA,OAEAC,KAAAA,WAAK,IAAAT,EAAAU,YAJTC,KAAA,UAMAJ,MAAKK,UAAiBZ,KAAGU,QAAWH,MAChCI,QAAM,WAD0BE,KAAAR,QAAAE,MAAA,SAEhCA,IAAAA,gDACAO,QAAS,WACTC,EAAKC,OAAAX,EAAAW,WAGJH,KAAAI,WAPLC,EAAA,UASKD,OACDC,KAAEC,MACGC,EAAAA,WApBeA,OAAAF,EAAA,UAAAE,OAAAP,KAAAD,WAAAS,QA4B3BC,KA5B2B,WA2BxB,OAAOC,EAAED,KAAKT,KAAKW,OAMfC,IAAAA,SAAAA,GACA,GAAApB,EAAAqB,KAAAb,KAAAW,KAAAnB,EAAAqB,IAAA,CAIAZ,IAAAA,EAAS,IAAAd,EAAAU,YACTK,KAAK,aACLY,QAAS,2BACLtB,IAAAA,0CACHsB,QAAA,WANLtB,EAAAuB,OAAAvB,EAAAuB,WAUIrB,EAAO,IAAAR,EAFoBE,MAG3Bc,GAAAA,EAAKV,GACLwB,MAAAA,cAJJd,IAAAV,EAAAU,KAAA,oBAMAe,YAAezB,cAAf0B,KAEAD,EAAKN,OAAKnB,EAAVgB,KACAS,EAAKX,IAAMC,SAAOU,eAAAE,OAClBnB,KAAKR,KAAAA,EAALqB,IAAwBI,EACxBjB,KAAKoB,MAAAA,OAALH,EAAAT,IAAAa,OAAA,SAvDwBrB,KAAAR,QAAA8B,IAAA,GAAAtB,KAAAS,QAAAT,KAAAR,QAAA8B,KAAAtB,KAAAD,WAAAwB,UAuDxBvB,KAAKoB,gBApBJR,OAAAY,KAAAC,MAAA,qBAAA,0CA0BGb,IAAAA,SAAAA,GACAZ,KAAAW,KAAAE,IAIJb,KAAKD,MAAAA,KAAW2B,IAAhBb,GAAAc,gBACKP,KAAAA,KAALP,GAnEwBb,KAAAD,WAAA2B,SAmExB1B,KAAKoB,YAJJR,OAAAY,KAAAC,MAAA,qBAAA,6BAUGG,OAAA,WACH,IAAA,IAAAf,KAAAb,KAAAW,KA1EuBX,KAAA6B,IAAAhB,IAgFxBH,YAAO,WACHO,KAAAA,WAAQa,IAAAA,OACXpB,EAFDqB,KAAA/B,KAAAW,KAAA,SAAAM,GAGEe,EAAQF,cACN,mBADJpB,EAAEsB,QAAQhC,KAAKW,OAQnBX,KAAAQ,IAAAD,OACUF,EAAA,UACN4B,SAAA,gBACAC,KAAelC,KAAKW,QAAMhB,cAK7ByB,SAAA,WAnGL,IAAAe,EAAA,EA8FQ,IAAK,IAAItB,KAAMb,KAAKW,KAAM,CAQ3B,IAAAM,EAAAjB,KAAAW,KAAAE,GACGzB,EAAAA,QAAAA,EAAAA,KAAAA,KAAAA,QAAAA,OADV6B,EAAAjB,KAAAS,OAAAT,KAAAR,QAAAI,IAAA,gBAAA,iBAAA","file":"../../../scripts/mvc/form/form-repeat.js","sourcesContent":["/** This class creates a ui component which enables the dynamic creation of portlets */\ndefine([\"utils/utils\", \"mvc/ui/ui-portlet\", \"mvc/ui/ui-misc\"], function(Utils, Portlet, Ui) {\n    var View = Backbone.View.extend({\n        initialize: function(options) {\n            this.list = {};\n            this.options = Utils.merge(options, {\n                title: \"Repeat\",\n                empty_text: \"Not available.\",\n                max: null,\n                min: null\n            });\n            this.button_new = new Ui.ButtonIcon({\n                icon: \"fa-plus\",\n                title: \"Insert \" + this.options.title,\n                tooltip: \"Add new \" + this.options.title + \" block\",\n                cls: \"ui-button-icon ui-clear-float form-repeat-add\",\n                onclick: function() {\n                    options.onnew && options.onnew();\n                }\n            });\n            this.setElement(\n                $(\"<div/>\")\n                    .append((this.$list = $(\"<div/>\")))\n                    .append($(\"<div/>\").append(this.button_new.$el))\n            );\n        },\n\n        /** Number of repeat blocks */\n        size: function() {\n            return _.size(this.list);\n        },\n\n        /** Add new repeat block */\n        add: function(options) {\n            if (!options.id || this.list[options.id]) {\n                Galaxy.emit.debug(\"form-repeat::add()\", \"Duplicate or invalid repeat block id.\");\n                return;\n            }\n            var button_delete = new Ui.ButtonIcon({\n                icon: \"fa-trash-o\",\n                tooltip: \"Delete this repeat block\",\n                cls: \"ui-button-icon-plain form-repeat-delete\",\n                onclick: function() {\n                    options.ondel && options.ondel();\n                }\n            });\n            var portlet = new Portlet.View({\n                id: options.id,\n                title: \"placeholder\",\n                cls: options.cls || \"ui-portlet-repeat\",\n                operations: { button_delete: button_delete }\n            });\n            portlet.append(options.$el);\n            portlet.$el.addClass(\"section-row\").hide();\n            this.list[options.id] = portlet;\n            this.$list.append(portlet.$el.fadeIn(\"fast\"));\n            this.options.max > 0 && this.size() >= this.options.max && this.button_new.disable();\n            this._refresh();\n        },\n\n        /** Delete repeat block */\n        del: function(id) {\n            if (!this.list[id]) {\n                Galaxy.emit.debug(\"form-repeat::del()\", \"Invalid repeat block id.\");\n                return;\n            }\n            this.$list.find(\"#\" + id).remove();\n            delete this.list[id];\n            this.button_new.enable();\n            this._refresh();\n        },\n\n        /** Remove all */\n        delAll: function() {\n            for (var id in this.list) {\n                this.del(id);\n            }\n        },\n\n        /** Hides add/del options */\n        hideOptions: function() {\n            this.button_new.$el.hide();\n            _.each(this.list, function(portlet) {\n                portlet.hideOperation(\"button_delete\");\n            });\n            _.isEmpty(this.list) &&\n                this.$el.append(\n                    $(\"<div/>\")\n                        .addClass(\"ui-form-info\")\n                        .html(this.options.empty_text)\n                );\n        },\n\n        /** Refresh view */\n        _refresh: function() {\n            var index = 0;\n            for (var id in this.list) {\n                var portlet = this.list[id];\n                portlet.title(++index + \": \" + this.options.title);\n                portlet[this.size() > this.options.min ? \"showOperation\" : \"hideOperation\"](\"button_delete\");\n            }\n        }\n    });\n\n    return {\n        View: View\n    };\n});\n"]}