{"version":3,"sources":["mvc/form/form-wrapper.js"],"names":["define","Form","Ui","View","Backbone","extend","initialize","options","Model","this","model","get","url","redirect","render","self","root","ajax","type","response","attributes","$","form","title","message","status","icon","inputs","buttons","Button","tooltip","submit_tooltip","submit_title","cls","onclick","_submit","$el","empty","append","fail","Message","persistent","Galaxy","data","contentType","create","done","success_message","window","field_list","input_id","input","param","_showMessage","value","responseJSON","err_msg","$panel","animate","scrollTop","update","parents","filter","indexOf","css"],"mappings":"aACAA,QAAQ,qBAAsB,kBAAmB,SAASC,EAAMC,GA6F5D,OACIC,KA/FRC,SAAAD,KAAAE,QACQC,WAAA,SAADC,GACCJ,KAAOC,MAASD,IAAKE,SAAOG,MAAAD,GAC5BD,KAAAA,IAAYG,KAAAC,MAAAC,IAAA,OACRF,KAAKC,SAAQD,KAAIL,MAASI,IAAb,YACbC,KAAKG,WAAWF,UAChBD,KAAKI,UAGRC,OAP2B,WAUxB,IAAIC,EAAON,KADfK,EAAAA,MACQC,IAAAA,OAAJC,KAAAP,KAAAG,IACEK,KAAK,QAEHC,KAAM,SAAAC,GAEA,IAAAZ,EAASY,EAAAA,UAAUJ,EAAAL,MAAAU,WAAAD,GACjBZ,EAAUc,IAAEhB,GACZiB,MAAWrB,EAAKsB,MAChBA,QAAOhB,EADSiB,QAEhBA,OAASjB,EAAQiB,QAFD,UAGhBC,KAAQlB,EAAQkB,KAChBC,OAAMnB,EAJUoB,OAKhBA,SACAC,OAAS,IAAA1B,EAAA2B,QACGC,QAAOD,EAAOE,eAClBD,MAASvB,EAAQwB,cADC,OAElBR,KAAOhB,EAAQyB,aAAgB,UAC/BN,IAAMnB,iCACN0B,QAAK,WACLC,EAASC,QAAAb,SAZrBP,EAAAqB,IAAAC,QAAAC,OAAAhB,EAAAc,OAoBHG,KAAK,SAASpB,GACXJ,EAASsB,IAAAA,QAAQC,OAETd,IAAAA,EAASgB,SACDhB,QAFG,2BAAAT,EAAAH,IAAA,IAGX6B,OAAY,SAJpBA,YAAA,IA3BRL,QAuCAf,QAAEJ,SAAKK,GACHV,IAAAA,EAAK8B,KACLC,EAAAA,MACAzB,IAAAA,OAHGF,KAAAD,EAAAH,IAIHgC,KAAAA,KAAAA,UAAatB,EAAAqB,KAAAE,UAEZC,KAAK,MACFF,YAAIG,qBAEAtB,KAAAA,SAAQN,GACRsB,IAAAA,GAHJjB,QAAAL,EAAAK,QAKIT,OAAKF,UACLmC,YAAA,GAEA1B,EAAAT,SACIS,OAAK2B,SAAWC,OAAhBlC,KAAgCmC,EAAAA,SAAhC,IAAA9B,EAAA+B,MAAAL,IAEJhC,EAAKsC,KAAAA,WAAmBN,EAAAA,SAAxBI,EAAAD,GACH5B,EAAA2B,WAAAC,GAAAI,MAAAH,EAAAG,SAGID,EAAAA,aAAmB/B,EAAAyB,MAGpBN,KAAAA,SAAAA,GAHJ1B,EAAAsC,aAAA/B,GAtBRE,QAAAL,EAAAoC,aAAAC,QAlDwB/B,OAAA,SA2EZgB,YAAY,OAYxBgB,aAAOC,SAAUC,EAAAA,GACJC,EAAAA,IAChBC,UAzFLC,OAAA,WAoFgB,OAA+D,IAAvD,OAAQ,UAAUC,QAAQ1C,EAAEZ,MAAMuD,IAAI,eASpD7D,QADVuD,SAAAC,UAAA,GAAA,KA7FJrC,EAAAE,QAAAoC,OAAArD","file":"../../../scripts/mvc/form/form-wrapper.js","sourcesContent":["/** Generic form view */\ndefine([\"mvc/form/form-view\", \"mvc/ui/ui-misc\"], function(Form, Ui) {\n    var View = Backbone.View.extend({\n        initialize: function(options) {\n            this.model = new Backbone.Model(options);\n            this.url = this.model.get(\"url\");\n            this.redirect = this.model.get(\"redirect\");\n            this.setElement(\"<div/>\");\n            this.render();\n        },\n\n        render: function() {\n            var self = this;\n            $.ajax({\n                url: Galaxy.root + this.url,\n                type: \"GET\"\n            })\n                .done(function(response) {\n                    var options = $.extend({}, self.model.attributes, response);\n                    var form = new Form({\n                        title: options.title,\n                        message: options.message,\n                        status: options.status || \"warning\",\n                        icon: options.icon,\n                        inputs: options.inputs,\n                        buttons: {\n                            submit: new Ui.Button({\n                                tooltip: options.submit_tooltip,\n                                title: options.submit_title || \"Save\",\n                                icon: options.submit_icon || \"fa-save\",\n                                cls: \"btn btn-primary ui-clear-float\",\n                                onclick: function() {\n                                    self._submit(form);\n                                }\n                            })\n                        }\n                    });\n                    self.$el.empty().append(form.$el);\n                })\n                .fail(function(response) {\n                    self.$el.empty().append(\n                        new Ui.Message({\n                            message: \"Failed to load resource \" + self.url + \".\",\n                            status: \"danger\",\n                            persistent: true\n                        }).$el\n                    );\n                });\n        },\n\n        _submit: function(form) {\n            var self = this;\n            $.ajax({\n                url: Galaxy.root + self.url,\n                data: JSON.stringify(form.data.create()),\n                type: \"PUT\",\n                contentType: \"application/json\"\n            })\n                .done(function(response) {\n                    var success_message = {\n                        message: response.message,\n                        status: \"success\",\n                        persistent: false\n                    };\n                    if (self.redirect) {\n                        window.location = Galaxy.root + self.redirect + \"?\" + $.param(success_message);\n                    } else {\n                        form.data.matchModel(response, function(input, input_id) {\n                            form.field_list[input_id].value(input.value);\n                        });\n                        self._showMessage(form, success_message);\n                    }\n                })\n                .fail(function(response) {\n                    self._showMessage(form, {\n                        message: response.responseJSON.err_msg,\n                        status: \"danger\",\n                        persistent: false\n                    });\n                });\n        },\n\n        _showMessage: function(form, options) {\n            var $panel = form.$el\n                .parents()\n                .filter(function() {\n                    return [\"auto\", \"scroll\"].indexOf($(this).css(\"overflow\")) != -1;\n                })\n                .first();\n            $panel.animate({ scrollTop: 0 }, 500);\n            form.message.update(options);\n        }\n    });\n\n    return {\n        View: View\n    };\n});\n"]}