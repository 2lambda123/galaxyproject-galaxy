{"version":3,"sources":["mvc/upload/default/default-row.js"],"names":["define","Utils","UploadModel","UploadSettings","Popover","Select","Backbone","View","extend","status_classes","init","queued","running","success","error","initialize","app","options","self","this","model","setElement","_template","$mode","$","$title","$text","$size","$info_text","$info_progress","$text_content","$settings","$symbol","$progress_bar","$percentage","settings","title","container","placement","default_genome","select_genome","value","default_extension","select_extension","css","data","list_genomes","onchange","genome","set","list_extensions","extension","on","_removeRow","showExtensionInfo","e","$el","target","preventDefault","_showSettings","url_paste","val","file_size","length","_refreshStatus","_refreshPercentage","_refreshInfo","_refreshGenome","_refreshExtension","_refreshFileSize","listenTo","render","remove","_refreshType","prototype","apply","removeClass","file_mode","attributes","_","escape","file_name","width","html","top","show","height","addClass","get","hide","percentage","info","parseInt","status","enabled","attr","disable","enable","collection","visible","bytesToString","indexOf","empty","append","id"],"mappings":"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","file":"../../../../scripts/mvc/upload/default/default-row.js","sourcesContent":["/** Renders the default uploader rows */\ndefine(\n    [\"utils/utils\", \"mvc/upload/upload-model\", \"mvc/upload/upload-settings\", \"mvc/ui/ui-popover\", \"mvc/ui/ui-select\"],\n    function(Utils, UploadModel, UploadSettings, Popover, Select) {\n        return Backbone.View.extend({\n            /** Dictionary of upload states and associated icons */\n            status_classes: {\n                init: \"upload-icon-button fa fa-trash-o\",\n                queued: \"upload-icon fa fa-spinner fa-spin\",\n                running: \"upload-icon fa fa-spinner fa-spin\",\n                success: \"upload-icon-button fa fa-check\",\n                error: \"upload-icon-button fa fa-exclamation-triangle\"\n            },\n\n            initialize: function(app, options) {\n                var self = this;\n                this.app = app;\n                this.model = options.model;\n                this.setElement(this._template(options.model));\n                this.$mode = this.$(\".upload-mode\");\n                this.$title = this.$(\".upload-title\");\n                this.$text = this.$(\".upload-text\");\n                this.$size = this.$(\".upload-size\");\n                this.$info_text = this.$(\".upload-info-text\");\n                this.$info_progress = this.$(\".upload-info-progress\");\n                this.$text_content = this.$(\".upload-text-content\");\n                this.$settings = this.$(\".upload-settings\");\n                this.$symbol = this.$(\".upload-symbol\");\n                this.$progress_bar = this.$(\".upload-progress-bar\");\n                this.$percentage = this.$(\".upload-percentage\");\n\n                // append popup to settings icon\n                this.settings = new Popover.View({\n                    title: \"Upload configuration\",\n                    container: this.$(\".upload-settings\"),\n                    placement: \"bottom\"\n                });\n\n                // identify default genome and extension values\n                var default_genome = this.app.select_genome.value();\n                var default_extension = this.app.select_extension.value();\n\n                // create select genomes\n                this.select_genome = new Select.View({\n                    css: \"upload-genome\",\n                    data: self.app.list_genomes,\n                    container: this.$(\".upload-genome\"),\n                    value: default_genome,\n                    onchange: function(genome) {\n                        self.model.set(\"genome\", genome);\n                    }\n                });\n\n                // create select extension\n                this.select_extension = new Select.View({\n                    css: \"upload-extension\",\n                    data: self.app.list_extensions,\n                    container: this.$(\".upload-extension\"),\n                    value: default_extension,\n                    onchange: function(extension) {\n                        self.model.set(\"extension\", extension);\n                    }\n                });\n\n                // initialize genome and extension values\n                this.model.set({\n                    genome: default_genome,\n                    extension: default_extension\n                });\n\n                // handle click event\n                this.$symbol.on(\"click\", function() {\n                    self._removeRow();\n                });\n\n                // handle extension info popover\n                this.$(\".upload-extension-info\")\n                    .on(\"click\", function(e) {\n                        self.app.showExtensionInfo({\n                            $el: $(e.target),\n                            title: self.select_extension.text(),\n                            extension: self.select_extension.value()\n                        });\n                    })\n                    .on(\"mousedown\", function(e) {\n                        e.preventDefault();\n                    });\n\n                // handle settings popover\n                this.$settings\n                    .on(\"click\", function(e) {\n                        self._showSettings();\n                    })\n                    .on(\"mousedown\", function(e) {\n                        e.preventDefault();\n                    });\n\n                // handle text editing event\n                this.$text_content.on(\"change input\", function(e) {\n                    self.model.set({\n                        url_paste: $(e.target).val(),\n                        file_size: $(e.target).val().length\n                    });\n                });\n\n                // model events\n                this.listenTo(this.model, \"change:percentage\", function() {\n                    self._refreshPercentage();\n                });\n                this.listenTo(this.model, \"change:status\", function() {\n                    self._refreshStatus();\n                });\n                this.listenTo(this.model, \"change:info\", function() {\n                    self._refreshInfo();\n                });\n                this.listenTo(this.model, \"change:genome\", function() {\n                    self._refreshGenome();\n                });\n                this.listenTo(this.model, \"change:extension\", function() {\n                    self._refreshExtension();\n                });\n                this.listenTo(this.model, \"change:file_size\", function() {\n                    self._refreshFileSize();\n                });\n            },\n\n            render: function() {\n                this._refreshType();\n                this._refreshPercentage();\n                this._refreshStatus();\n                this._refreshInfo();\n                this._refreshGenome();\n                this._refreshExtension();\n                this._refreshFileSize();\n            },\n\n            /** Remove view */\n            remove: function() {\n                this.select_genome.remove();\n                this.select_extension.remove();\n                Backbone.View.prototype.remove.apply(this);\n            },\n\n            /** Render type */\n            _refreshType: function() {\n                var options = this.model.attributes;\n                this.$title.html(_.escape(options.file_name));\n                this.$size.html(Utils.bytesToString(options.file_size));\n                this.$mode\n                    .removeClass()\n                    .addClass(\"upload-mode\")\n                    .addClass(\"text-primary\");\n                if (options.file_mode == \"new\") {\n                    this.$text\n                        .css({\n                            width: this.$el.width() - 16 + \"px\",\n                            top: this.$el.height() - 8 + \"px\"\n                        })\n                        .show();\n                    this.$el.height(this.$el.height() - 8 + this.$text.height() + 16);\n                    this.$mode.addClass(\"fa fa-edit\");\n                } else if (options.file_mode == \"local\") {\n                    this.$mode.addClass(\"fa fa-laptop\");\n                } else if (options.file_mode == \"ftp\") {\n                    this.$mode.addClass(\"fa fa-folder-open-o\");\n                }\n            },\n\n            /** Update extension */\n            _refreshExtension: function() {\n                this.select_extension.value(this.model.get(\"extension\"));\n            },\n\n            /** Update genome */\n            _refreshGenome: function() {\n                this.select_genome.value(this.model.get(\"genome\"));\n            },\n\n            /** Refresh info text */\n            _refreshInfo: function() {\n                var info = this.model.get(\"info\");\n                if (info) {\n                    this.$info_text.html(\"<strong>Failed: </strong>\" + info).show();\n                } else {\n                    this.$info_text.hide();\n                }\n            },\n\n            /** Refresh percentage status */\n            _refreshPercentage: function() {\n                var percentage = parseInt(this.model.get(\"percentage\"));\n                this.$progress_bar.css({ width: percentage + \"%\" });\n                this.$percentage.html(percentage != 100 ? percentage + \"%\" : \"Adding to history...\");\n            },\n\n            /** Refresh status */\n            _refreshStatus: function() {\n                var status = this.model.get(\"status\");\n                this.$symbol\n                    .removeClass()\n                    .addClass(\"upload-symbol\")\n                    .addClass(this.status_classes[status]);\n                this.model.set(\"enabled\", status == \"init\");\n                var enabled = this.model.get(\"enabled\");\n                this.$text_content.attr(\"disabled\", !enabled);\n                if (enabled) {\n                    this.select_genome.enable();\n                    this.select_extension.enable();\n                } else {\n                    this.select_genome.disable();\n                    this.select_extension.disable();\n                }\n                if (status == \"success\") {\n                    this.$el.addClass(\"success\");\n                    this.$percentage.html(\"100%\");\n                }\n                if (status == \"error\") {\n                    this.$el.addClass(\"danger\");\n                    this.$info_progress.hide();\n                }\n            },\n\n            /** Refresh file size */\n            _refreshFileSize: function() {\n                this.$size.html(Utils.bytesToString(this.model.get(\"file_size\")));\n            },\n\n            /** Remove row */\n            _removeRow: function() {\n                if ([\"init\", \"success\", \"error\"].indexOf(this.model.get(\"status\")) !== -1) {\n                    this.app.collection.remove(this.model);\n                }\n            },\n\n            /** Attach file info popup */\n            _showSettings: function() {\n                if (!this.settings.visible) {\n                    this.settings.empty();\n                    this.settings.append(new UploadSettings(this).$el);\n                    this.settings.show();\n                } else {\n                    this.settings.hide();\n                }\n            },\n\n            /** View template */\n            _template: function(options) {\n                return (\n                    '<tr id=\"upload-row-' +\n                    options.id +\n                    '\" class=\"upload-row\">' +\n                    \"<td>\" +\n                    '<div class=\"upload-text-column\">' +\n                    '<div class=\"upload-mode\"/>' +\n                    '<div class=\"upload-title\"/>' +\n                    '<div class=\"upload-text\">' +\n                    '<div class=\"upload-text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div>' +\n                    '<textarea class=\"upload-text-content form-control\"/>' +\n                    \"</div>\" +\n                    \"</div>\" +\n                    \"</td>\" +\n                    \"<td>\" +\n                    '<div class=\"upload-size\"/>' +\n                    \"</td>\" +\n                    \"<td>\" +\n                    '<div class=\"upload-extension\" style=\"float: left;\"/>&nbsp;&nbsp' +\n                    '<div class=\"upload-extension-info upload-icon-button fa fa-search\"/>' +\n                    \"</td>\" +\n                    \"<td>\" +\n                    '<div class=\"upload-genome\"/>' +\n                    \"</td>\" +\n                    '<td><div class=\"upload-settings upload-icon-button fa fa-gear\"/></td>' +\n                    \"<td>\" +\n                    '<div class=\"upload-info\">' +\n                    '<div class=\"upload-info-text\"/>' +\n                    '<div class=\"upload-info-progress progress\">' +\n                    '<div class=\"upload-progress-bar progress-bar progress-bar-success\"/>' +\n                    '<div class=\"upload-percentage\">0%</div>' +\n                    \"</div>\" +\n                    \"</div>\" +\n                    \"</td>\" +\n                    \"<td>\" +\n                    '<div class=\"upload-symbol ' +\n                    this.status_classes.init +\n                    '\"/>' +\n                    \"</td>\" +\n                    \"</tr>\"\n                );\n            }\n        });\n    }\n);\n"]}