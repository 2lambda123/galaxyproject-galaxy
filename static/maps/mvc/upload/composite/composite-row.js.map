{"version":3,"sources":["mvc/upload/composite/composite-row.js"],"names":["define","status_classes","init","ready","running","error","UploadSettings","UploadFtp","Popover","Ui","Select","Backbone","View","extend","initialize","self","app","options","success","setElement","$source","$text_content","this","$info_text","$info_progress","model","$file_name","_template","$file_desc","$","$file_size","$progress_bar","$percentage","uploadinput","$el","ondragover","ondragleave","removeClass","get","file_data","files","addClass","file_size","file_mode","_refreshReady","length","reset","file_name","name","size","ButtonMenu","mode","title","onclick","pull","ftp_upload_site","button_menu","addMenu","icon","_showFtp","dialog","container","placement","find","url_paste","target","on","e","$settings","set","_showSettings","val","_refreshPercentage","listenTo","preventDefault","_refreshFileName","_refreshMode","_refreshStatus","_refreshFileSize","_refreshInfo","remove","html","escape","$status","render","attr","prototype","id","_","Utils","bytesToString","apply","$text","each","width","height","css","top","show","trigger","hide","percentage","info","parseInt","status","offsetHeight","ftp","ftp_file","file_path","append","path","settings","visible","empty"],"mappings":"aACAA,QAEQ,cASA,6BACI,wBACAC,oBACIC,iBACAC,mBACAC,mBAEAC,SAAAA,EAAOC,EAAAC,EAAAC,EAAAC,EAAAC,GALK,OAFQC,SAAAC,KAAAC,QAUxBC,gBACQC,KAAAA,6CACJZ,MAAWa,uCACXZ,QAAaa,oCACbC,QAAKC,0BACLd,MAAKe,0CAGLN,WAAA,SAAoBE,EAAAC,GACpB,IAAKI,EAAAA,KACLC,KAAKC,IAALP,EACAM,KAAKE,MAAAA,EAAiBC,MACtBH,KAAKI,WAAaJ,KAAOK,aACzBL,KAAKM,QAAaN,KAAAO,EAAO,kBACzBP,KAAKQ,UAAaR,KAAOO,EAAA,oBACzBP,KAAKS,QAALT,KAAqBO,EAAKA,kBAC1BP,KAAKU,MAALV,KAAmBO,EAAKA,gBAPxBP,KAAKD,cAAgBC,KAAKO,EAAE,wBAS5BP,KAAAC,WAAAD,KAAAO,EAAA,qBACAP,KAAKW,eAAmBC,KAAID,EAAAA,yBACxBE,KAAAA,WAAYb,KAAAO,EAAA,qBACRd,KAAAA,WAAAO,KAAeO,EAAA,qBAClBP,KAHmCQ,WAAAR,KAAAO,EAAA,qBAIpCO,KAAAA,cAAad,KAAAO,EAAA,wBACTd,KAAAA,YAASsB,KAATR,EAAqB,sBAGrBP,KAAAW,YAAeK,KAAIJ,IAAAD,aACflB,WAAKU,WACDc,EAAAA,MAAAA,IAAWC,YADEzB,EAAAmB,IAAAO,SAAA,YAGbC,YAAAA,WACAC,EAAAA,IAAAA,YAAiB,YAErB5B,SAAK6B,SAAAA,GACR,WAAA7B,EAAAU,MAAAa,IAAA,WAAAE,GAAAA,EAAAK,OAAA,IACJ9B,EAAAU,MAAAqB,OAjBLP,UAAAC,EAAA,GAWgBO,UAAWP,EAAM,GAAGQ,KASpCN,UAAAF,EAAA,GAAAS,KACmBN,UAAOO,EAAW,GAAAC,MAAA,UAE1BpC,EAF0B6B,oBAQjCQ,KAAAA,YAAO,IAAA3C,EAFcyC,YAGrBG,KAAS,gBACLtC,MAAKkB,SACRqB,KAAA,SAEDhC,KAAKN,QAAIuC,OAAAA,KAAbC,YAA8BtB,KAC1BZ,KAAKkC,YAAYC,SACbC,KAAM,YACNN,MAAO,oBACPC,QAAS,WACLtC,EAAK4C,YAALC,YAGXtC,KAAAN,IAAAuC,iBACIC,KAAAA,YAAoBC,SACfC,KAAA,mBACCN,MAAA,kBACPC,QAAS,WACA5B,EAAMqB,cAIdxB,KAAAkC,YAAAC,SARLC,KAAA,UAEIN,MAAO,mBASXC,QAAA,WACWtC,EAAIP,MAAQI,OACZ+B,UAAA,MACII,UAAA,gBAMXK,KAAAA,IAAO,IAAA5C,EAAAI,MACPiD,MAAW,mBACXC,UAAWxC,KAAAF,QAAA2C,KAAA,mBAHfD,UAAA,UAQI/C,KAAKU,SAAU,IAAAjB,EAAAI,MACXoD,MAAAA,uBACAtB,UAAWb,KAAIoC,UAFnBH,UAAA,WAOJxC,KAAAD,cAAA6C,GAAA,eAAA,SAAAC,GACKC,EAAAA,MACGC,KACKC,UAALzC,EAAAsC,EAAAF,QAAAM,MAEA7B,UAAab,EAAAsC,EAAAF,QAAYM,MAAA1B,SAJjC9B,EAAA6B,kBAUI7B,KAAKyD,UADTN,GAAA,QAAA,SAAAC,GAGKM,EAASH,kBAAdJ,GAAA,YAAA,SAAAC,GAGKM,EAASC,mBAIV3D,KAAK4D,SAAAA,KAAAA,MAAL,oBAAA,WADJ5D,EAAAyD,uBAIIzD,KAAK6D,SAAAA,KAALnD,MAAA,gBAAA,WADJV,EAAA8D,mBAII9D,KAAK+D,SAAAA,KAAAA,MAAL,cAAA,WADJ/D,EAAAgE,iBAIIhE,KAAKiE,SAAL1D,KAAAG,MAAA,mBAAA,WADJV,EAAA4D,qBAII5D,KAAKiE,SAAL1D,KAAAG,MAAA,mBAAA,WADJV,EAAA6D,iBANAtD,KAAKmD,SAASnD,KAAKG,MAAO,mBAAoB,WAW1CV,EAAA+D,qBAEJxD,KAAKI,SAAWuD,KAAOC,MAAO,SAAA,WACzBtD,EAAAA,WAELN,KAAK6D,IAAQ9C,WAAb6B,GAA2BzB,QAAS,WAnJhB1B,EAAAiE,YAwJpBI,OAAA,WACAzE,KAASC,IAATyE,KAAcC,KAAUN,cAAa1D,KAArCG,MAAA8D,IAzJoBjE,KAAAI,WAAAuD,KAAAO,EAAAN,OAAA5D,KAAAG,MAAAa,IAAA,cAAA,MAiJpBhB,KAAKM,WAAWqD,KAAK3D,KAAKG,MAAMa,IAAI,cAAgB,eAWxDhB,KAAAQ,WAAAmD,KAAAQ,EAAAC,cAAApE,KAAAG,MAAAa,IAAA,eACAhB,KAAA6D,QAAA9C,cAAAI,SAAAnB,KAAArB,eAAAC,OAIA0C,OAAAA,WAEQnB,SAAAb,KAAU0E,UAAW7D,OAAUkE,MAAArE,OAQ/BsB,cAAA,WACAtB,KAAKsE,IAAAA,WACIC,KAAA,SAAApE,GACDqE,EAAAA,IAAO,SAAArE,EAAmBa,IAAK,aAD9B,GAAA,SAAA,WAOZsC,aAAM,WAEH,OADgBtD,KAAKyE,MAArBzD,IAAA,cAEHhB,KAAAyE,OAAAzE,KAAAY,IAAA6D,SAvLmBzE,KAAAsE,MA6KXI,KAabF,MAAAxE,KAAAY,IAAA4D,QAAA,GAAA,KACcG,IAAA3E,KAAAY,IAAA6D,SAAW,EAAA,OAEXG,OACN5E,KAAKC,IAAAA,OAALD,KAAqBY,IAAA6D,SAAA,EAAAzE,KAAAsE,MAArBG,SAAA,IACGzE,KAAAD,cAAAkD,IAAA,IAAA4B,QAAA,WAEN7E,KAAAY,IAAA6D,OAAAzE,KAAAyE,QAjMmBzE,KAAAsE,MAAAQ,SAuMpBrB,aAAIsB,WACA,IAAAC,EAAKvE,KAAAA,MAALO,IAAyBwD,QACtBQ,EACHhF,KAAKS,WAAcU,KAAAA,4BAAnB6D,GAAAJ,OAEA5E,KAAKS,WAALqE,QAPR5B,mBAAoB,WAapB,IAAA6B,EAAAE,SAAAjF,KAAAG,MAAAa,IAAA,eACgB,GAAhBuC,EACQ2B,KAASzE,cAAAiE,KAAeF,MAA5BO,EAAA,OAEK5E,KAAM4C,cAAemC,SAAU,iBAC/BnF,KAAAA,cAAmB2E,KAAAF,MAAa,OACrCxE,KAASe,cAAY,GAAAoE,aACjBD,KAAAA,cAAuBA,YAAU,kBAEpClF,KAAAU,YAAAiD,KAAA,KAAAoB,EAAAA,EAAA,IAAA,yBAIGxB,eAAWR,WACX,IAAAmC,EAAKxE,KAAYiD,MAAK3C,IAAtB,UACHhB,KAAA6D,QAAA9C,cAAAI,SAAAnB,KAAArB,eAAAuG,IACGA,KAAAA,MAAUnC,IAAA,UAAS,WAAAmC,GACnBlF,KAAKY,cAAamD,KAAA,YAAlB/D,KAAAG,MAAAa,IAAA,YACAhB,KAAKG,IAAAA,YAAU,0BACVD,WAALgF,GAAA,SAAAA,GACAlF,KAAKC,MAAL8C,IAAgB6B,aAAhB,GAEA5E,KAAKE,QAAAA,KAAAA,WAAL,WAAAgF,EAAA,WAAA,eAAA,YACKjF,WAALiF,IACHlF,KAAAY,IAAAO,SAAA,WA1OmBnB,KAAAG,MAAA4C,IAAA,aAAA,KAgOhB/C,KAAKU,YAAYiD,KAAK,SAcZ,SAAlBN,GACSjD,KAAAA,IAAWuD,SAAUxD,UA/ONH,KAAAG,MAAA4C,IAAA,aAAA,GAqOhB/C,KAAKE,eAAe4E,OAa5B9E,KAAAC,WAAA2E,SAESpE,KAAAA,eAAsB4D,OApPPpE,KAAAC,WAAA6E,SA0PhBzB,iBAAW,WACXrD,KAAKoF,WAALzB,KAAA3D,KAAAG,MAAAa,IAAA,cAAA,MAKYvB,iBAAK2F,WACLpF,KAAAQ,WAAIf,KAAKU,EAAUiE,cAAapE,KAAAG,MAA5Ba,IAAyCqE,gBAIrCjE,SAAAA,WACAkE,GAAAA,KAAAA,IAAAA,QASpBtF,KAAKoF,IAAIN,WATWQ,CAJa,IAAA7F,EAAjBO,KAMAP,KAAAA,IAAAA,QACHO,KAAAoF,IAAAG,OACJ,IAAAtG,GAdTgD,gBAAAjC,KAAAN,IAAAuC,gBAiBS2C,SAAT,SAAAS,GACG5F,EAAA2F,IAAAN,OACH,WAAArF,EAAAU,MAAAa,IAAA,WAAAqE,IACH5F,EAAAU,MAAAqB,OAhRmBH,UAAA,MAoQII,UAAW4D,EAASG,KAehDpE,UAAAiE,EAAA1D,KACe2D,UAAWD,EAAAG,OAElB/F,EAAA6B,oBAGGV,KAENZ,KAAAoF,IAAAR,SA3RT5B,cAAA,WAXRhD,KAAAyF,SAAAC,QAqSoB1F,KAAKyF,SAASX,QAJd9E,KAAKyF,SAASE,QACd3F,KAAKyF,SAASF,OAAO,IAAIvG,EAAegB,MAAMY,KAC9CZ,KAAKyF,SAASb,SAOtBvE,UAAW,WACP,MACI","file":"../../../../scripts/mvc/upload/composite/composite-row.js","sourcesContent":["/** Renders the composite upload row view */\ndefine(\n    [\n        \"utils/utils\",\n        \"mvc/upload/upload-settings\",\n        \"mvc/upload/upload-ftp\",\n        \"mvc/ui/ui-popover\",\n        \"mvc/ui/ui-misc\",\n        \"mvc/ui/ui-select\",\n        \"utils/uploadbox\"\n    ],\n    function(Utils, UploadSettings, UploadFtp, Popover, Ui, Select) {\n        return Backbone.View.extend({\n            /** Dictionary of upload states and associated icons */\n            status_classes: {\n                init: \"upload-mode fa fa-exclamation text-primary\",\n                ready: \"upload-mode fa fa-check text-success\",\n                running: \"upload-mode fa fa-spinner fa-spin\",\n                success: \"upload-mode fa fa-check\",\n                error: \"upload-mode fa fa-exclamation-triangle\"\n            },\n\n            initialize: function(app, options) {\n                var self = this;\n                this.app = app;\n                this.model = options.model;\n                this.setElement(this._template());\n                this.$source = this.$(\".upload-source\");\n                this.$settings = this.$(\".upload-settings\");\n                this.$status = this.$(\".upload-status\");\n                this.$text = this.$(\".upload-text\");\n                this.$text_content = this.$(\".upload-text-content\");\n                this.$info_text = this.$(\".upload-info-text\");\n                this.$info_progress = this.$(\".upload-info-progress\");\n                this.$file_name = this.$(\".upload-file-name\");\n                this.$file_desc = this.$(\".upload-file-desc\");\n                this.$file_size = this.$(\".upload-file-size\");\n                this.$progress_bar = this.$(\".upload-progress-bar\");\n                this.$percentage = this.$(\".upload-percentage\");\n\n                // build upload functions\n                this.uploadinput = this.$el.uploadinput({\n                    ondragover: function() {\n                        self.model.get(\"enabled\") && self.$el.addClass(\"warning\");\n                    },\n                    ondragleave: function() {\n                        self.$el.removeClass(\"warning\");\n                    },\n                    onchange: function(files) {\n                        if (self.model.get(\"status\") != \"running\" && files && files.length > 0) {\n                            self.model.reset({\n                                file_data: files[0],\n                                file_name: files[0].name,\n                                file_size: files[0].size,\n                                file_mode: files[0].mode || \"local\"\n                            });\n                            self._refreshReady();\n                        }\n                    }\n                });\n\n                // source selection popup\n                this.button_menu = new Ui.ButtonMenu({\n                    icon: \"fa-caret-down\",\n                    title: \"Select\",\n                    pull: \"left\"\n                });\n                this.$source.append(this.button_menu.$el);\n                this.button_menu.addMenu({\n                    icon: \"fa-laptop\",\n                    title: \"Choose local file\",\n                    onclick: function() {\n                        self.uploadinput.dialog();\n                    }\n                });\n                if (this.app.ftp_upload_site) {\n                    this.button_menu.addMenu({\n                        icon: \"fa-folder-open-o\",\n                        title: \"Choose FTP file\",\n                        onclick: function() {\n                            self._showFtp();\n                        }\n                    });\n                }\n                this.button_menu.addMenu({\n                    icon: \"fa-edit\",\n                    title: \"Paste/Fetch data\",\n                    onclick: function() {\n                        self.model.reset({\n                            file_mode: \"new\",\n                            file_name: \"New File\"\n                        });\n                    }\n                });\n\n                // add ftp file viewer\n                this.ftp = new Popover.View({\n                    title: \"Choose FTP file:\",\n                    container: this.$source.find(\".ui-button-menu\"),\n                    placement: \"right\"\n                });\n\n                // append popup to settings icon\n                this.settings = new Popover.View({\n                    title: \"Upload configuration\",\n                    container: this.$settings,\n                    placement: \"bottom\"\n                });\n\n                // handle text editing event\n                this.$text_content.on(\"change input\", function(e) {\n                    self.model.set({\n                        url_paste: $(e.target).val(),\n                        file_size: $(e.target).val().length\n                    });\n                    self._refreshReady();\n                });\n\n                // handle settings popover\n                this.$settings\n                    .on(\"click\", function(e) {\n                        self._showSettings();\n                    })\n                    .on(\"mousedown\", function(e) {\n                        e.preventDefault();\n                    });\n\n                // model events\n                this.listenTo(this.model, \"change:percentage\", function() {\n                    self._refreshPercentage();\n                });\n                this.listenTo(this.model, \"change:status\", function() {\n                    self._refreshStatus();\n                });\n                this.listenTo(this.model, \"change:info\", function() {\n                    self._refreshInfo();\n                });\n                this.listenTo(this.model, \"change:file_name\", function() {\n                    self._refreshFileName();\n                });\n                this.listenTo(this.model, \"change:file_mode\", function() {\n                    self._refreshMode();\n                });\n                this.listenTo(this.model, \"change:file_size\", function() {\n                    self._refreshFileSize();\n                });\n                this.listenTo(this.model, \"remove\", function() {\n                    self.remove();\n                });\n                this.app.collection.on(\"reset\", function() {\n                    self.remove();\n                });\n            },\n\n            render: function() {\n                this.$el.attr(\"id\", \"upload-row-\" + this.model.id);\n                this.$file_name.html(_.escape(this.model.get(\"file_name\") || \"-\"));\n                this.$file_desc.html(this.model.get(\"file_desc\") || \"Unavailable\");\n                this.$file_size.html(Utils.bytesToString(this.model.get(\"file_size\")));\n                this.$status.removeClass().addClass(this.status_classes.init);\n            },\n\n            /** Remove view */\n            remove: function() {\n                // call the base class remove method\n                Backbone.View.prototype.remove.apply(this);\n            },\n\n            //\n            // handle model events\n            //\n\n            /** Refresh ready or not states */\n            _refreshReady: function() {\n                this.app.collection.each(function(model) {\n                    model.set(\"status\", (model.get(\"file_size\") > 0 && \"ready\") || \"init\");\n                });\n            },\n\n            /** Refresh mode and e.g. show/hide textarea field */\n            _refreshMode: function() {\n                var file_mode = this.model.get(\"file_mode\");\n                if (file_mode == \"new\") {\n                    this.height = this.$el.height();\n                    this.$text\n                        .css({\n                            width: this.$el.width() - 16 + \"px\",\n                            top: this.$el.height() - 8 + \"px\"\n                        })\n                        .show();\n                    this.$el.height(this.$el.height() - 8 + this.$text.height() + 16);\n                    this.$text_content.val(\"\").trigger(\"keyup\");\n                } else {\n                    this.$el.height(this.height);\n                    this.$text.hide();\n                }\n            },\n\n            /** Refresh information */\n            _refreshInfo: function() {\n                var info = this.model.get(\"info\");\n                if (info) {\n                    this.$info_text.html(\"<strong>Failed: </strong>\" + info).show();\n                } else {\n                    this.$info_text.hide();\n                }\n            },\n\n            /** Refresh percentage */\n            _refreshPercentage: function() {\n                var percentage = parseInt(this.model.get(\"percentage\"));\n                if (percentage != 0) {\n                    this.$progress_bar.css({ width: percentage + \"%\" });\n                } else {\n                    this.$progress_bar.addClass(\"no-transition\");\n                    this.$progress_bar.css({ width: \"0%\" });\n                    this.$progress_bar[0].offsetHeight;\n                    this.$progress_bar.removeClass(\"no-transition\");\n                }\n                this.$percentage.html(percentage != 100 ? percentage + \"%\" : \"Adding to history...\");\n            },\n\n            /** Refresh status */\n            _refreshStatus: function() {\n                var status = this.model.get(\"status\");\n                this.$status.removeClass().addClass(this.status_classes[status]);\n                this.model.set(\"enabled\", status != \"running\");\n                this.$text_content.attr(\"disabled\", !this.model.get(\"enabled\"));\n                this.$el.removeClass(\"success danger warning\");\n                if (status == \"running\" || status == \"ready\") {\n                    this.model.set(\"percentage\", 0);\n                }\n                this.$source.find(\".button\")[status == \"running\" ? \"addClass\" : \"removeClass\"](\"disabled\");\n                if (status == \"success\") {\n                    this.$el.addClass(\"success\");\n                    this.model.set(\"percentage\", 100);\n                    this.$percentage.html(\"100%\");\n                }\n                if (status == \"error\") {\n                    this.$el.addClass(\"danger\");\n                    this.model.set(\"percentage\", 0);\n                    this.$info_progress.hide();\n                    this.$info_text.show();\n                } else {\n                    this.$info_progress.show();\n                    this.$info_text.hide();\n                }\n            },\n\n            /** File name */\n            _refreshFileName: function() {\n                this.$file_name.html(this.model.get(\"file_name\") || \"-\");\n            },\n\n            /** File size */\n            _refreshFileSize: function() {\n                this.$file_size.html(Utils.bytesToString(this.model.get(\"file_size\")));\n            },\n\n            /** Show/hide ftp popup */\n            _showFtp: function() {\n                if (!this.ftp.visible) {\n                    var self = this;\n                    this.ftp.empty();\n                    this.ftp.append(\n                        new UploadFtp({\n                            ftp_upload_site: this.app.ftp_upload_site,\n                            onchange: function(ftp_file) {\n                                self.ftp.hide();\n                                if (self.model.get(\"status\") != \"running\" && ftp_file) {\n                                    self.model.reset({\n                                        file_mode: \"ftp\",\n                                        file_name: ftp_file.path,\n                                        file_size: ftp_file.size,\n                                        file_path: ftp_file.path\n                                    });\n                                    self._refreshReady();\n                                }\n                            }\n                        }).$el\n                    );\n                    this.ftp.show();\n                } else {\n                    this.ftp.hide();\n                }\n            },\n\n            /** Show/hide settings popup */\n            _showSettings: function() {\n                if (!this.settings.visible) {\n                    this.settings.empty();\n                    this.settings.append(new UploadSettings(this).$el);\n                    this.settings.show();\n                } else {\n                    this.settings.hide();\n                }\n            },\n\n            /** Template */\n            _template: function() {\n                return (\n                    '<tr class=\"upload-row\">' +\n                    \"<td>\" +\n                    '<div class=\"upload-source\"/>' +\n                    '<div class=\"upload-text-column\">' +\n                    '<div class=\"upload-text\">' +\n                    '<div class=\"upload-text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div>' +\n                    '<textarea class=\"upload-text-content form-control\"/>' +\n                    \"</div>\" +\n                    \"</div>\" +\n                    \"</td>\" +\n                    \"<td>\" +\n                    '<div class=\"upload-status\"/>' +\n                    \"</td>\" +\n                    \"<td>\" +\n                    '<div class=\"upload-file-desc upload-title\"/>' +\n                    \"</td>\" +\n                    \"<td>\" +\n                    '<div class=\"upload-file-name upload-title\"/>' +\n                    \"</td>\" +\n                    \"<td>\" +\n                    '<div class=\"upload-file-size upload-size\"/>' +\n                    \"</td>\" +\n                    '<td><div class=\"upload-settings upload-icon-button fa fa-gear\"/></td>' +\n                    \"<td>\" +\n                    '<div class=\"upload-info\">' +\n                    '<div class=\"upload-info-text\"/>' +\n                    '<div class=\"upload-info-progress progress\">' +\n                    '<div class=\"upload-progress-bar progress-bar progress-bar-success\"/>' +\n                    '<div class=\"upload-percentage\">0%</div>' +\n                    \"</div>\" +\n                    \"</div>\" +\n                    \"</td>\" +\n                    \"</tr>\"\n                );\n            }\n        });\n    }\n);\n"]}