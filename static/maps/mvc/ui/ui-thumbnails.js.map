{"version":3,"sources":["mvc/ui/ui-thumbnails.js"],"names":["define","Utils","Ui","Tabs","View","Backbone","extend","events","initialize","options","this","model","Model","get","collection","tabs","Collection","setElement","$el","addClass","render","first","delAll","_renderDefault","self","index","title_length","indexOf","title","append","id","length","substr","title_icon","image_src","placement","uid","_renderList","each","_templateRegularItem","attributes","new_value","undefined","removeClass","before","$","after","attr","change_handler","_onclick","e","value","target","closest","_ondblclick","_templateThumbnailItem","description"],"mappings":"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","file":"../../../scripts/mvc/ui/ui-thumbnails.js","sourcesContent":["/** This class renders the selection grid. */\ndefine([\"utils/utils\", \"mvc/ui/ui-misc\", \"mvc/ui/ui-tabs\"], function(Utils, Ui, Tabs) {\n    var View = Backbone.View.extend({\n        events: {\n            \"click .ui-thumbnails-item\": \"_onclick\",\n            \"dblclick .ui-thumbnails-item\": \"_ondblclick\"\n        },\n\n        initialize: function(options) {\n            this.model = options.model || new Backbone.Model(options);\n            this.collection = new Backbone.Collection(this.model.get(\"collection\"));\n            this.tabs = new Tabs.View({});\n            this.setElement(this.tabs.$el.addClass(\"ui-thumbnails\"));\n            this.render();\n            this.listenTo(this.model, \"change\", this.render, this);\n            this.listenTo(this.collection, \"reset change add remove\", this.render, this);\n        },\n\n        render: function() {\n            this.first = null;\n            this.tabs.delAll();\n            this._renderDefault();\n            this._renderList();\n        },\n\n        _renderDefault: function() {\n            var self = this;\n            var index = [];\n            var title_length = 20;\n            var $el = $(\"<div/>\").addClass(\"ui-thumbnails-grid\");\n            this.collection.each(function(model) {\n                if (model.get(\"keywords\").indexOf(\"default\") !== -1) {\n                    var title = model.get(\"title\");\n                    $el.append(\n                        $(\n                            self._templateThumbnailItem({\n                                id: model.id,\n                                title: title.length < title_length ? title : title.substr(0, title_length) + \"...\",\n                                title_icon: model.get(\"title_icon\"),\n                                image_src: model.get(\"image_src\")\n                            })\n                        ).tooltip({\n                            title: model.get(\"description\"),\n                            placement: \"bottom\"\n                        })\n                    );\n                }\n            });\n            if ($el.children().length > 0) {\n                this.tabs.add({\n                    id: Utils.uid(),\n                    title: self.model.get(\"title_default\"),\n                    $el: $el\n                });\n            }\n        },\n\n        _renderList: function() {\n            var self = this;\n            if (this.collection.length > 0) {\n                this.first = this.first || this.collection.first().id;\n                var $el = $(\"<div/>\").addClass(\"ui-thumbnails-grid\");\n                this.collection.each(function(model) {\n                    $el.append(self._templateRegularItem(model.attributes));\n                });\n                this.tabs.add({\n                    id: Utils.uid(),\n                    title: self.model.get(\"title_list\"),\n                    $el: $el\n                });\n            }\n        },\n\n        /** Set/Get value */\n        value: function(new_value) {\n            if (new_value !== undefined) {\n                new_value = new_value == \"__first\" ? this.first : new_value;\n                var before = this.$(\".ui-thumbnail-current\").attr(\"value\");\n                this.$(\".ui-thumbnail-current\").removeClass(\"ui-thumbnail-current\");\n                this.$('[value=\"' + new_value + '\"]').addClass(\"ui-thumbnail-current\");\n                var after = this.$(\".ui-thumbnail-current\").attr(\"value\");\n                var change_handler = this.model.get(\"onchange\");\n                after != before && change_handler && change_handler(after);\n            }\n            return this.$(\".ui-thumbnail-current\").attr(\"value\");\n        },\n\n        /** Add click handler */\n        _onclick: function(e) {\n            this.value(\n                $(e.target)\n                    .closest(\".ui-thumbnails-item\")\n                    .attr(\"value\")\n            );\n        },\n\n        /** Add double click handler */\n        _ondblclick: function(e) {\n            this.model.get(\"ondblclick\") && this.model.get(\"ondblclick\")(this.value());\n        },\n\n        /* Thumbnail template with image */\n        _templateThumbnailItem: function(options) {\n            return (\n                '<div class=\"ui-thumbnails-item ui-thumbnails-item-float\" value=\"' +\n                options.id +\n                '\">' +\n                '<img class=\"ui-thumbnails-image\" src=\"' +\n                options.image_src +\n                '\">' +\n                '<div class=\"ui-thumbnails-title ui-form-info\">' +\n                '<span class=\"fa ' +\n                options.title_icon +\n                '\"/>' +\n                options.title +\n                \"</div>\" +\n                \"<div>\"\n            );\n        },\n\n        /* Thumbnail template with image and description */\n        _templateRegularItem: function(options) {\n            return (\n                '<div class=\"ui-thumbnails-item\" value=\"' +\n                options.id +\n                '\">' +\n                \"<table>\" +\n                \"<tr>\" +\n                \"<td>\" +\n                '<img class=\"ui-thumbnails-image\" src=\"' +\n                options.image_src +\n                '\">' +\n                \"</td>\" +\n                \"<td>\" +\n                '<div class=\"ui-thumbnails-description-title ui-form-info\">' +\n                options.title +\n                \"</div>\" +\n                '<div class=\"ui-thumbnails-description-text ui-form-info\">' +\n                options.description +\n                \"</div>\" +\n                \"</td>\" +\n                \"</tr>\" +\n                \"<div>\"\n            );\n        }\n    });\n\n    return { View: View };\n});\n"]}