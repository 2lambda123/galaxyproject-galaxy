{"version":3,"sources":["galaxy.pages.js"],"names":["init_galaxy_elts","wym","$","_doc","body","each","this","click","createRange","range","selectNodeContents","selection","window","get_item_info","dialog_type","item_singular","item_plural","item_controller","ITEM_HISTORY","item_class","ITEM_DATASET","ITEM_WORKFLOW","ITEM_PAGE","ITEM_VISUALIZATION","item_list_action","toLowerCase","ajax_url","list_objects_url","replace","singular","plural","controller","make_item_importable","item_id","item_type","set_accessible_url","ajax","type","id","accessible","url","data","CONTROLS","DIALOG_HISTORY_LINK","DIALOG_DATASET_LINK","DIALOG_WORKFLOW_LINK","DIALOG_EMBED_HISTORY","DIALOG_EMBED_DATASET","DIALOG_EMBED_WORKFLOW","WYMeditor","editor","prototype","dialog","dialogType","dialogFeatures","bodyHtml","selected","DIALOG_LINK","attr","HREF","srcSelector","val","SRC","_options","hrefSelector","curURL","curTitle","undefined","show_modal","Make link","sId","_exec","CREATE_LINK","sName","titleSelector","link","sStamp","hide_modal","TITLE","text","indexOf","attribute_input","addClass","removeClass","remove","DIALOG_IMAGE","dialogImageSelector","Cancel","_selected_image","altSelector","ALT","Insert","sUrl","x","newRow","table","insertRow","y","insertCell","DIALOG_TABLE","DIALOG_VISUALIZATION_LINK","item_info","iRows","iCols","createElement","TABLE","dict_format","captionSelector","createCaption","innerHTML","buttons","make_importable","grid","summarySelector","node","findUp","container","MAIN_CONTAINERS","get","after","DIALOG_PAGE_LINK","Galaxy","Close","GridView","url_base","embedded","title","append","list_ajax_url","Array","item_name","get_name_and_link_url","getJSON","returned_item_info","item_elt_id","item_embed_html","link_text","hide","name","statusText","message","wymeditor","editor_base_path","iframe_base_path","css","DIALOG_EMBED_PAGE","DIALOG_EMBED_VISUALIZATION","wymeditors","save_url","annotations","stringify","Object","_","success","modal","show","$el","changed","do_close","document","page_list_url","iclass","containers_menu","containersItems","tagname","join","insert","insert_link_menu_button","ajaxError","e","responseText","Ignore error","skin","basePath","iframeBasePath","boxHtml","TOOLS","STATUS","toolsItems","save","callback","page_id","content","xhtml","JSON","location","items","k","v","make_popupmenu","Insert History Link","Insert Dataset Link","Insert Workflow Link","Insert Page Link","Insert Visualization Link","embed_object_button","Embed History","Embed Dataset","Embed Workflow","Embed Visualization"],"mappings":"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","file":"../scripts/galaxy.pages.js","sourcesContent":["var CONTROLS = {\n    // Item types.\n    ITEM_HISTORY: \"item_history\",\n    ITEM_DATASET: \"item_dataset\",\n    ITEM_WORKFLOW: \"item_workflow\",\n    ITEM_PAGE: \"item_page\",\n    ITEM_VISUALIZATION: \"item_visualization\",\n\n    // Link dialogs.\n    DIALOG_HISTORY_LINK: \"link_history\",\n    DIALOG_DATASET_LINK: \"link_dataset\",\n    DIALOG_WORKFLOW_LINK: \"link_workflow\",\n    DIALOG_PAGE_LINK: \"link_page\",\n    DIALOG_VISUALIZATION_LINK: \"link_visualization\",\n\n    // Embed dialogs.\n    DIALOG_EMBED_HISTORY: \"embed_history\",\n    DIALOG_EMBED_DATASET: \"embed_dataset\",\n    DIALOG_EMBED_WORKFLOW: \"embed_workflow\",\n    DIALOG_EMBED_PAGE: \"embed_page\",\n    DIALOG_EMBED_VISUALIZATION: \"embed_visualization\"\n};\n\n// Initialize Galaxy elements.\nfunction init_galaxy_elts(wym) {\n    // Set up events to make annotation easy.\n    $(\".annotation\", wym._doc.body).each(function() {\n        $(this).click(function() {\n            // Works in Safari, not in Firefox.\n            var range = wym._doc.createRange();\n            range.selectNodeContents(this);\n            var selection = window.getSelection();\n            selection.removeAllRanges();\n            selection.addRange(range);\n            var t = \"\";\n        });\n    });\n}\n\n// Based on the dialog type, return a dictionary of information about an item\nfunction get_item_info(dialog_type) {\n    var item_singular, item_plural, item_controller;\n    switch (dialog_type) {\n        case CONTROLS.ITEM_HISTORY:\n            item_singular = \"History\";\n            item_plural = \"Histories\";\n            item_controller = \"history\";\n            item_class = \"History\";\n            break;\n        case CONTROLS.ITEM_DATASET:\n            item_singular = \"Dataset\";\n            item_plural = \"Datasets\";\n            item_controller = \"dataset\";\n            item_class = \"HistoryDatasetAssociation\";\n            break;\n        case CONTROLS.ITEM_WORKFLOW:\n            item_singular = \"Workflow\";\n            item_plural = \"Workflows\";\n            item_controller = \"workflow\";\n            item_class = \"StoredWorkflow\";\n            break;\n        case CONTROLS.ITEM_PAGE:\n            item_singular = \"Page\";\n            item_plural = \"Pages\";\n            item_controller = \"page\";\n            item_class = \"Page\";\n            break;\n        case CONTROLS.ITEM_VISUALIZATION:\n            item_singular = \"Visualization\";\n            item_plural = \"Visualizations\";\n            item_controller = \"visualization\";\n            item_class = \"Visualization\";\n            break;\n    }\n\n    // Build ajax URL that lists items for selection.\n    var item_list_action = \"list_\" + item_plural.toLowerCase() + \"_for_selection\";\n    var ajax_url = list_objects_url.replace(\"LIST_ACTION\", item_list_action);\n\n    // Set up and return dict.\n    return {\n        singular: item_singular,\n        plural: item_plural,\n        controller: item_controller,\n        iclass: item_class,\n        list_ajax_url: ajax_url\n    };\n}\n\n// Make an item importable.\nfunction make_item_importable(item_controller, item_id, item_type) {\n    var ajax_url = set_accessible_url.replace(\"ITEM_CONTROLLER\", item_controller);\n    $.ajax({\n        type: \"POST\",\n        url: ajax_url,\n        data: { id: item_id, accessible: \"True\" },\n        error: function() {\n            alert(\"Making \" + item_type + \" accessible failed\");\n        }\n    });\n}\n\n// Completely replace WYM's dialog handling\nWYMeditor.editor.prototype.dialog = function(dialogType, dialogFeatures, bodyHtml) {\n    var wym = this;\n    var sStamp = wym.uniqueStamp();\n    var selected = wym.selected();\n\n    // Swap out URL attribute for id/name attribute in link creation to enable anchor creation in page.\n    function set_link_id() {\n        // When \"set link id\" link clicked, update UI.\n        $(\"#set_link_id\").click(function() {\n            // Set label.\n            $(\"#link_attribute_label\").text(\"ID/Name\");\n\n            // Set input elt class, value.\n            var attribute_input = $(\".wym_href\");\n            attribute_input.addClass(\"wym_id\").removeClass(\"wym_href\");\n            if (selected) attribute_input.val($(selected).attr(\"id\"));\n\n            // Remove link.\n            $(this).remove();\n        });\n    }\n\n    // LINK DIALOG\n    if (dialogType == WYMeditor.DIALOG_LINK) {\n        if (selected) {\n            $(wym._options.hrefSelector).val($(selected).attr(WYMeditor.HREF));\n            $(wym._options.srcSelector).val($(selected).attr(WYMeditor.SRC));\n            $(wym._options.titleSelector).val($(selected).attr(WYMeditor.TITLE));\n            $(wym._options.altSelector).val($(selected).attr(WYMeditor.ALT));\n        }\n        // Get current URL, title.\n        var curURL, curTitle;\n        if (selected) {\n            curURL = $(selected).attr(\"href\");\n            if (curURL == undefined) curURL = \"\";\n            curTitle = $(selected).attr(\"title\");\n            if (curTitle == undefined) curTitle = \"\";\n        }\n        show_modal(\n            \"Create Link\",\n            \"<div><div><label id='link_attribute_label'>URL <span style='float: right; font-size: 90%'><a href='#' id='set_link_id'>Create in-page anchor</a></span></label><br><input type='text' class='wym_href' value='\" +\n                curURL +\n                \"' size='40' /></div>\" +\n                \"<div><label>Title</label><br><input type='text' class='wym_title' value='\" +\n                curTitle +\n                \"' size='40' /></div><div>\",\n            {\n                \"Make link\": function() {\n                    // Get URL, name/title.\n                    var sUrl = $(wym._options.hrefSelector).val() || \"\",\n                        sId = $(\".wym_id\").val() || \"\",\n                        sName = $(wym._options.titleSelector).val() || \"\";\n\n                    if (sUrl || sId) {\n                        // Create link.\n                        wym._exec(WYMeditor.CREATE_LINK, sStamp);\n\n                        // Set link attributes.\n                        var link = $(\"a[href=\" + sStamp + \"]\", wym._doc.body);\n                        link\n                            .attr(WYMeditor.HREF, sUrl)\n                            .attr(WYMeditor.TITLE, sName)\n                            .attr(\"id\", sId);\n\n                        // If link's text is default (wym-...), change it to the title.\n                        if (link.text().indexOf(\"wym-\") === 0) {\n                            link.text(sName);\n                        }\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            },\n            {},\n            set_link_id\n        );\n    }\n\n    // IMAGE DIALOG\n    if (dialogType == WYMeditor.DIALOG_IMAGE) {\n        if (wym._selected_image) {\n            $(wym._options.dialogImageSelector + \" \" + wym._options.srcSelector).val(\n                $(wym._selected_image).attr(WYMeditor.SRC)\n            );\n            $(wym._options.dialogImageSelector + \" \" + wym._options.titleSelector).val(\n                $(wym._selected_image).attr(WYMeditor.TITLE)\n            );\n            $(wym._options.dialogImageSelector + \" \" + wym._options.altSelector).val(\n                $(wym._selected_image).attr(WYMeditor.ALT)\n            );\n        }\n        show_modal(\n            \"Image\",\n            \"<div class='row'>\" +\n                \"<label>URL</label><br>\" +\n                \"<input type='text' class='wym_src' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Alt text</label><br>\" +\n                \"<input type='text' class='wym_alt' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Title</label><br>\" +\n                \"<input type='text' class='wym_title' value='' size='40' />\" +\n                \"</div>\",\n            {\n                Insert: function() {\n                    var sUrl = $(wym._options.srcSelector).val();\n                    if (sUrl.length > 0) {\n                        wym._exec(WYMeditor.INSERT_IMAGE, sStamp);\n                        $(\"img[src$=\" + sStamp + \"]\", wym._doc.body)\n                            .attr(WYMeditor.SRC, sUrl)\n                            .attr(WYMeditor.TITLE, $(wym._options.titleSelector).val())\n                            .attr(WYMeditor.ALT, $(wym._options.altSelector).val());\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            }\n        );\n        return;\n    }\n\n    // TABLE DIALOG\n    if (dialogType == WYMeditor.DIALOG_TABLE) {\n        show_modal(\n            \"Table\",\n            \"<div class='row'>\" +\n                \"<label>Caption</label><br>\" +\n                \"<input type='text' class='wym_caption' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Summary</label><br>\" +\n                \"<input type='text' class='wym_summary' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Number Of Rows<br></label>\" +\n                \"<input type='text' class='wym_rows' value='3' size='3' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Number Of Cols<br></label>\" +\n                \"<input type='text' class='wym_cols' value='2' size='3' />\" +\n                \"</div>\",\n            {\n                Insert: function() {\n                    var iRows = $(wym._options.rowsSelector).val();\n                    var iCols = $(wym._options.colsSelector).val();\n\n                    if (iRows > 0 && iCols > 0) {\n                        var table = wym._doc.createElement(WYMeditor.TABLE);\n                        var newRow = null;\n                        var newCol = null;\n\n                        var sCaption = $(wym._options.captionSelector).val();\n\n                        //we create the caption\n                        var newCaption = table.createCaption();\n                        newCaption.innerHTML = sCaption;\n\n                        //we create the rows and cells\n                        for (var x = 0; x < iRows; x++) {\n                            newRow = table.insertRow(x);\n                            for (var y = 0; y < iCols; y++) {\n                                newRow.insertCell(y);\n                            }\n                        }\n\n                        //set the summary attr\n                        $(table).attr(\"summary\", $(wym._options.summarySelector).val());\n\n                        //append the table after the selected container\n                        var node = $(wym.findUp(wym.container(), WYMeditor.MAIN_CONTAINERS)).get(0);\n                        if (!node || !node.parentNode) $(wym._doc.body).append(table);\n                        else $(node).after(table);\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            }\n        );\n    }\n\n    // INSERT \"GALAXY ITEM\" LINK DIALOG\n    if (\n        dialogType == CONTROLS.DIALOG_HISTORY_LINK ||\n        dialogType == CONTROLS.DIALOG_DATASET_LINK ||\n        dialogType == CONTROLS.DIALOG_WORKFLOW_LINK ||\n        dialogType == CONTROLS.DIALOG_PAGE_LINK ||\n        dialogType == CONTROLS.DIALOG_VISUALIZATION_LINK\n    ) {\n        // Based on item type, set useful vars.\n        var item_info;\n        switch (dialogType) {\n            case CONTROLS.DIALOG_HISTORY_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_HISTORY);\n                break;\n            case CONTROLS.DIALOG_DATASET_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_DATASET);\n                break;\n            case CONTROLS.DIALOG_WORKFLOW_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_WORKFLOW);\n                break;\n            case CONTROLS.DIALOG_PAGE_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_PAGE);\n                break;\n            case CONTROLS.DIALOG_VISUALIZATION_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_VISUALIZATION);\n                break;\n        }\n\n        require([\"mvc/grid/grid-view\"], function(GridView) {\n            var grid = new GridView({\n                url_base: item_info.list_ajax_url,\n                dict_format: true,\n                embedded: true\n            });\n            Galaxy.modal.show({\n                title: \"Insert Link to \" + item_info.singular,\n                body: $(\"<div/>\")\n                    .append(grid.$el)\n                    .append(\n                        $(\"<div/>\")\n                            .append('<input id=\"make-importable\" type=\"checkbox\" checked/>')\n                            .append(\n                                \"Make the selected \" +\n                                    item_info.plural.toLowerCase() +\n                                    \" accessible so that they can viewed by everyone.\"\n                            )\n                    ),\n                closing_events: true,\n                buttons: {\n                    Insert: function() {\n                        // Make selected items accessible (importable) ?\n                        var make_importable = false;\n                        if ($(\"#make-importable:checked\").val() != null) make_importable = true;\n\n                        // Insert links to history for each checked item.\n                        var item_ids = new Array();\n                        grid.$(\"input[name=id]:checked\").each(function() {\n                            var item_id = $(this).val();\n\n                            // Make item importable?\n                            if (make_importable)\n                                make_item_importable(item_info.controller, item_id, item_info.singular);\n\n                            // Insert link(s) to item(s). This is done by getting item info and then manipulating wym.\n                            var url_template = get_name_and_link_url + item_id;\n                            var ajax_url = url_template.replace(\"ITEM_CONTROLLER\", item_info.controller);\n                            $.getJSON(ajax_url, function(returned_item_info) {\n                                // Get link text.\n                                wym._exec(WYMeditor.CREATE_LINK, sStamp);\n                                var link_text = $(\"a[href=\" + sStamp + \"]\", wym._doc.body).text();\n\n                                // Insert link: need to do different actions depending on link text.\n                                if (\n                                    link_text == \"\" || // Firefox.\n                                    link_text == sStamp // Safari\n                                ) {\n                                    // User selected no text; create link from scratch and use default text.\n                                    wym.insert(\n                                        \"<a href='\" +\n                                            returned_item_info.link +\n                                            \"'>\" +\n                                            item_info.singular +\n                                            \" '\" +\n                                            returned_item_info.name +\n                                            \"'</a>\"\n                                    );\n                                } else {\n                                    // Link created from selected text; add href and title.\n                                    $(\"a[href=\" + sStamp + \"]\", wym._doc.body)\n                                        .attr(WYMeditor.HREF, returned_item_info.link)\n                                        .attr(WYMeditor.TITLE, item_info.singular + item_id);\n                                }\n                            });\n                        });\n                        Galaxy.modal.hide();\n                    },\n                    Close: function() {\n                        Galaxy.modal.hide();\n                    }\n                }\n            });\n        });\n    }\n    // EMBED GALAXY OBJECT DIALOGS\n    if (\n        dialogType == CONTROLS.DIALOG_EMBED_HISTORY ||\n        dialogType == CONTROLS.DIALOG_EMBED_DATASET ||\n        dialogType == CONTROLS.DIALOG_EMBED_WORKFLOW ||\n        dialogType == CONTROLS.DIALOG_EMBED_PAGE ||\n        dialogType == CONTROLS.DIALOG_EMBED_VISUALIZATION\n    ) {\n        // Based on item type, set useful vars.\n        var item_info;\n        switch (dialogType) {\n            case CONTROLS.DIALOG_EMBED_HISTORY:\n                item_info = get_item_info(CONTROLS.ITEM_HISTORY);\n                break;\n            case CONTROLS.DIALOG_EMBED_DATASET:\n                item_info = get_item_info(CONTROLS.ITEM_DATASET);\n                break;\n            case CONTROLS.DIALOG_EMBED_WORKFLOW:\n                item_info = get_item_info(CONTROLS.ITEM_WORKFLOW);\n                break;\n            case CONTROLS.DIALOG_EMBED_PAGE:\n                item_info = get_item_info(CONTROLS.ITEM_PAGE);\n                break;\n            case CONTROLS.DIALOG_EMBED_VISUALIZATION:\n                item_info = get_item_info(CONTROLS.ITEM_VISUALIZATION);\n                break;\n        }\n\n        require([\"mvc/grid/grid-view\"], function(GridView) {\n            var grid = new GridView({\n                url_base: item_info.list_ajax_url,\n                dict_format: true,\n                embedded: true\n            });\n            Galaxy.modal.show({\n                title: \"Insert Link to \" + item_info.singular,\n                body: $(\"<div/>\")\n                    .append(grid.$el)\n                    .append(\n                        $(\"<div/>\")\n                            .append('<input id=\"make-importable\" type=\"checkbox\" checked/>')\n                            .append(\n                                \"Make the selected \" +\n                                    item_info.plural.toLowerCase() +\n                                    \" accessible so that they can viewed by everyone.\"\n                            )\n                    ),\n                closing_events: true,\n                buttons: {\n                    Embed: function() {\n                        // Make selected items accessible (importable) ?\n                        var make_importable = false;\n                        if ($(\"#make-importable:checked\").val() != null) make_importable = true;\n\n                        grid.$(\"input[name=id]:checked\").each(function() {\n                            // Get item ID and name.\n                            var item_id = $(this).val();\n                            // Use ':first' because there are many labels in table; the first one is the item name.\n                            var item_name = $(\"label[for='\" + item_id + \"']:first\").text();\n\n                            if (make_importable)\n                                make_item_importable(item_info.controller, item_id, item_info.singular);\n\n                            // Embedded item HTML; item class is embedded in div container classes; this is necessary because the editor strips\n                            // all non-standard attributes when it returns its content (e.g. it will not return an element attribute of the form\n                            // item_class='History').\n                            var item_elt_id = item_info.iclass + \"-\" + item_id;\n                            var item_embed_html = [\n                                \"<div id='\",\n                                item_elt_id,\n                                \"' class='embedded-item \",\n                                item_info.singular.toLowerCase(),\n                                \" placeholder'>\",\n                                \"<p class='title'>\",\n                                \"Embedded Galaxy \",\n                                item_info.singular,\n                                \" '\",\n                                item_name,\n                                \"'\",\n                                \"</p>\",\n                                \"<p class='content'>\",\n                                \"[Do not edit this block; Galaxy will fill it in with the annotated \",\n                                item_info.singular.toLowerCase(),\n                                \" when it is displayed.]\",\n                                \"</p>\",\n                                \"</div>\"\n                            ].join(\"\");\n\n                            // Insert embedded item into document.\n                            wym.insert(item_embed_html);\n                        });\n                        Galaxy.modal.hide();\n                    },\n                    Close: function() {\n                        Galaxy.modal.hide();\n                    }\n                }\n            });\n        });\n    }\n};\n\n$(function() {\n    // Generic error handling\n    $(document).ajaxError(function(e, x) {\n        // console.log( e, x );\n        var message = x.responseText || x.statusText || \"Could not connect to server\";\n        show_modal(\"Server error\", message, { \"Ignore error\": hide_modal });\n        return false;\n    });\n    // Create editor\n    $(\"[name=page_content]\").wymeditor({\n        skin: \"galaxy\",\n        basePath: editor_base_path,\n        iframeBasePath: iframe_base_path,\n        boxHtml:\n            \"<table class='wym_box' width='100%' height='100%'>\" +\n            \"<tr><td><div class='wym_area_top'>\" +\n            WYMeditor.TOOLS +\n            \"</div></td></tr>\" +\n            \"<tr height='100%'><td>\" +\n            \"<div class='wym_area_main' style='height: 100%;'>\" +\n            // + WYMeditor.HTML\n            WYMeditor.IFRAME +\n            WYMeditor.STATUS +\n            \"</div>\" +\n            \"</div>\" +\n            \"</td></tr></table>\",\n        toolsItems: [\n            { name: \"Bold\", title: \"Strong\", css: \"wym_tools_strong\" },\n            { name: \"Italic\", title: \"Emphasis\", css: \"wym_tools_emphasis\" },\n            {\n                name: \"Superscript\",\n                title: \"Superscript\",\n                css: \"wym_tools_superscript\"\n            },\n            {\n                name: \"Subscript\",\n                title: \"Subscript\",\n                css: \"wym_tools_subscript\"\n            },\n            {\n                name: \"InsertOrderedList\",\n                title: \"Ordered_List\",\n                css: \"wym_tools_ordered_list\"\n            },\n            {\n                name: \"InsertUnorderedList\",\n                title: \"Unordered_List\",\n                css: \"wym_tools_unordered_list\"\n            },\n            { name: \"Indent\", title: \"Indent\", css: \"wym_tools_indent\" },\n            { name: \"Outdent\", title: \"Outdent\", css: \"wym_tools_outdent\" },\n            { name: \"Undo\", title: \"Undo\", css: \"wym_tools_undo\" },\n            { name: \"Redo\", title: \"Redo\", css: \"wym_tools_redo\" },\n            { name: \"CreateLink\", title: \"Link\", css: \"wym_tools_link\" },\n            { name: \"Unlink\", title: \"Unlink\", css: \"wym_tools_unlink\" },\n            { name: \"InsertImage\", title: \"Image\", css: \"wym_tools_image\" },\n            { name: \"InsertTable\", title: \"Table\", css: \"wym_tools_table\" }\n        ]\n    });\n    // Get the editor object\n    var editor = $.wymeditors(0);\n    var save = function(callback) {\n        show_modal(\"Saving page\", \"progress\");\n\n        // Do save.\n        $.ajax({\n            url: save_url,\n            type: \"POST\",\n            data: {\n                id: page_id,\n                content: editor.xhtml(),\n                annotations: JSON.stringify(new Object()),\n                // annotations: JSON.stringify(annotations),\n                _: \"true\"\n            },\n            success: function() {\n                callback();\n            }\n        });\n    };\n    // Save button\n    $(\"#save-button\").click(function() {\n        save(function() {\n            hide_modal();\n        });\n    });\n    // Close button\n    $(\"#close-button\").click(function() {\n        // var new_content = editor.xhtml();\n        // var changed = ( initial_content != new_content );\n        var changed = false;\n        if (changed) {\n            var do_close = function() {\n                window.onbeforeunload = undefined;\n                window.document.location = page_list_url;\n            };\n            show_modal(\n                \"Close editor\",\n                \"There are unsaved changes to your page which will be lost.\",\n                {\n                    Cancel: hide_modal,\n                    \"Save Changes\": function() {\n                        save(do_close);\n                    }\n                },\n                {\n                    \"Don't Save\": do_close\n                }\n            );\n        } else {\n            window.document.location = page_list_url;\n        }\n    });\n\n    // Initialize galaxy elements.\n    //init_galaxy_elts(editor);\n\n    //\n    // Containers, Galaxy style\n    //\n    var containers_menu = $(\n        \"<div class='galaxy-page-editor-button'><a id='insert-galaxy-link' class='action-button popup' href='#'>Paragraph type</a></div>\"\n    );\n    $(\".wym_area_top\").append(containers_menu);\n\n    // Add menu options.\n    var items = {};\n    $.each(editor._options.containersItems, function(k, v) {\n        var tagname = v.name;\n        items[v.title.replace(\"_\", \" \")] = function() {\n            editor.container(tagname);\n        };\n    });\n    make_popupmenu(containers_menu, items);\n\n    //\n    // Create 'Insert Link to Galaxy Object' menu.\n    //\n\n    // Add menu button.\n    var insert_link_menu_button = $(\n        \"<div><a id='insert-galaxy-link' class='action-button popup' href='#'>Insert Link to Galaxy Object</a></div>\"\n    ).addClass(\"galaxy-page-editor-button\");\n    $(\".wym_area_top\").append(insert_link_menu_button);\n\n    // Add menu options.\n    make_popupmenu(insert_link_menu_button, {\n        \"Insert History Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_HISTORY_LINK);\n        },\n        \"Insert Dataset Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_DATASET_LINK);\n        },\n        \"Insert Workflow Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_WORKFLOW_LINK);\n        },\n        \"Insert Page Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_PAGE_LINK);\n        },\n        \"Insert Visualization Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_VISUALIZATION_LINK);\n        }\n    });\n\n    //\n    // Create 'Embed Galaxy Object' menu.\n    //\n\n    // Add menu button.\n    var embed_object_button = $(\n        \"<div><a id='embed-galaxy-object' class='action-button popup' href='#'>Embed Galaxy Object</a></div>\"\n    ).addClass(\"galaxy-page-editor-button\");\n    $(\".wym_area_top\").append(embed_object_button);\n\n    // Add menu options.\n    make_popupmenu(embed_object_button, {\n        \"Embed History\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_HISTORY);\n        },\n        \"Embed Dataset\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_DATASET);\n        },\n        \"Embed Workflow\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_WORKFLOW);\n        },\n        \"Embed Visualization\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_VISUALIZATION);\n        }\n        //\"Embed Page\": function() {\n        //    editor.dialog(CONTROLS.DIALOG_EMBED_PAGE);\n        //}\n    });\n});\n"]}