{"version":3,"sources":["webpack:///analysis.bundled.js","webpack:///./galaxy/scripts/apps/analysis.js","webpack:///./galaxy/scripts/utils/utils.js","webpack:///./galaxy/scripts/mvc/ui/ui-misc.js?fd98","webpack:///./galaxy/scripts/mvc/ui/ui-modal.js","webpack:///./galaxy/scripts/mvc/ui/ui-portlet.js?0568","webpack:///./galaxy/scripts/mvc/dataset/data.js?f841*","webpack:///./galaxy/scripts/mvc/dataset/states.js","webpack:///./galaxy/scripts/mvc/ui/ui-buttons.js?4ced","webpack:///./galaxy/scripts/mvc/ui/ui-table.js?4ded","webpack:///./galaxy/scripts/mvc/ui/icon-button.js?40a6*","webpack:///./galaxy/scripts/mvc/ui/ui-frames.js","webpack:///./galaxy/scripts/ui/editable-text.js?53d0","webpack:///./galaxy/scripts/viz/trackster/util.js?c726","webpack:///./galaxy/scripts/mvc/citation/citation-model.js?63a3","webpack:///./galaxy/scripts/mvc/tool/tool-form.js?a6b7","webpack:///./galaxy/scripts/mvc/ui/ui-list.js?ecf1","webpack:///./galaxy/scripts/mvc/ui/ui-options.js?405a","webpack:///./galaxy/scripts/mvc/ui/ui-select-default.js?402d","webpack:///./galaxy/scripts/ui/fa-icon-button.js","webpack:///./galaxy/scripts/mvc/ui/ui-popover.js","webpack:///./galaxy/scripts/mvc/ui/ui-select.js","webpack:///./galaxy/scripts/mvc/user/user-model.js","webpack:///./galaxy/scripts/galaxy.js","webpack:///./galaxy/scripts/layout/masthead.js","webpack:///./galaxy/scripts/layout/menu.js","webpack:///./galaxy/scripts/layout/page.js","webpack:///./galaxy/scripts/layout/scratchbook.js","webpack:///./galaxy/scripts/libs/bibtex.js?8f2e","webpack:///./galaxy/scripts/mvc/citation/citation-view.js?b4c0","webpack:///./galaxy/scripts/mvc/collection/collection-li.js","webpack:///./galaxy/scripts/mvc/collection/collection-model.js","webpack:///./galaxy/scripts/mvc/collection/list-collection-creator.js","webpack:///./galaxy/scripts/mvc/dataset/dataset-li.js","webpack:///./galaxy/scripts/mvc/form/form-data.js?6144","webpack:///./galaxy/scripts/mvc/form/form-input.js?af7f","webpack:///./galaxy/scripts/mvc/form/form-parameters.js?0ee1","webpack:///./galaxy/scripts/mvc/form/form-repeat.js?7c22","webpack:///./galaxy/scripts/mvc/form/form-section.js?2ccb","webpack:///./galaxy/scripts/mvc/form/form-view.js?db3b","webpack:///./galaxy/scripts/mvc/history/hdca-model.js","webpack:///./galaxy/scripts/mvc/history/history-content-model.js","webpack:///./galaxy/scripts/mvc/history/history-contents.js","webpack:///./galaxy/scripts/mvc/list/list-item.js","webpack:///./galaxy/scripts/mvc/tool/tool-form-base.js?81c1","webpack:///./galaxy/scripts/mvc/tool/tools.js?fad9","webpack:///./galaxy/scripts/mvc/ui/popup-menu.js","webpack:///./galaxy/scripts/mvc/ui/ui-color-picker.js?fa1d","webpack:///./galaxy/scripts/mvc/ui/ui-drilldown.js?de06","webpack:///./galaxy/scripts/mvc/ui/ui-select-content.js?e092","webpack:///./galaxy/scripts/mvc/ui/ui-select-ftp.js?cf41","webpack:///./galaxy/scripts/mvc/ui/ui-select-library.js?fd76","webpack:///./galaxy/scripts/mvc/ui/ui-slider.js?93a7","webpack:///./galaxy/scripts/mvc/upload/upload-model.js","webpack:///./galaxy/scripts/mvc/user/user-quotameter.js","webpack:///./galaxy/scripts/utils/deferred.js?8fee","webpack:///./galaxy/scripts/utils/metrics-logger.js","webpack:///./galaxy/scripts/mvc/annotation.js","webpack:///./galaxy/scripts/mvc/collection/collection-view.js","webpack:///./galaxy/scripts/mvc/dataset/dataset-li-edit.js","webpack:///./galaxy/scripts/mvc/dataset/dataset-model.js","webpack:///./galaxy/scripts/mvc/history/hda-li.js","webpack:///./galaxy/scripts/mvc/history/hda-model.js","webpack:///./galaxy/scripts/mvc/history/hdca-li.js","webpack:///./galaxy/scripts/mvc/history/history-model.js","webpack:///./galaxy/scripts/mvc/list/list-view.js","webpack:///./galaxy/scripts/mvc/tag.js","webpack:///./galaxy/scripts/mvc/upload/upload-ftp.js","webpack:///./galaxy/scripts/mvc/upload/upload-settings.js","webpack:///./galaxy/scripts/ui/hoverhighlight.js","webpack:///./galaxy/scripts/ui/search-input.js","webpack:///./galaxy/scripts/utils/natural-sort.js","webpack:///./galaxy/scripts/utils/uploadbox.js","webpack:///./galaxy/scripts/apps/history-panel.js","webpack:///./galaxy/scripts/apps/tool-panel.js","webpack:///./galaxy/scripts/mvc/collection/collection-li-edit.js","webpack:///./galaxy/scripts/mvc/collection/collection-view-edit.js","webpack:///./galaxy/scripts/mvc/collection/list-of-pairs-collection-creator.js","webpack:///./galaxy/scripts/mvc/collection/pair-collection-creator.js","webpack:///./galaxy/scripts/mvc/history/copy-dialog.js","webpack:///./galaxy/scripts/mvc/history/hda-li-edit.js","webpack:///./galaxy/scripts/mvc/history/hdca-li-edit.js","webpack:///./galaxy/scripts/mvc/history/history-view-edit-current.js","webpack:///./galaxy/scripts/mvc/history/history-view-edit.js","webpack:///./galaxy/scripts/mvc/history/history-view.js","webpack:///./galaxy/scripts/mvc/history/options-menu.js","webpack:///./galaxy/scripts/mvc/ui/ui-tabs.js","webpack:///./galaxy/scripts/mvc/upload/composite/composite-row.js","webpack:///./galaxy/scripts/mvc/upload/composite/composite-view.js","webpack:///./galaxy/scripts/mvc/upload/default/default-row.js","webpack:///./galaxy/scripts/mvc/upload/default/default-view.js","webpack:///./galaxy/scripts/mvc/upload/upload-button.js","webpack:///./galaxy/scripts/mvc/upload/upload-view.js","webpack:///./galaxy/scripts/ui/loading-indicator.js","webpack:///./galaxy/scripts/utils/levenshtein.js"],"names":["webpackJsonp","module","exports","__webpack_require__","_","Backbone","jQuery","$","GalaxyApp","QUERY_STRING","PANEL","ToolPanel","HistoryPanel","PAGE","ToolForm","Tours","window","app","options","bootstrapped","Galaxy","debug","config","toolPanel","el","userIsAnonymous","user","isAnonymous","search_url","toolbox","toolbox_in_panel","stored_workflow_menu_entries","nginx_upload_path","ftp_upload_site","default_genome","default_extension","centerPanel","CenterPanel","historyPanel","galaxyRoot","root","allow_user_dataset_purge","analysisPage","PageLayoutView","extend","left","center","right","page","params","tool_panel","upload","uploadButton","currHistoryPanel","historyView","listenToGalaxy","display","view","target","remove","Router","initialize","this","execute","callback","args","name","queryObj","parse","pop","push","apply","routes","(/)","(/)root*","(/)tours(/)(:tour_id)","show_tours","tour_id","giveTour","ToursView","home","tool_id","job_id","show","_loadCenterIframe","_loadToolForm","workflow_id","m_c","m_a","id","View","url","prop","render","loadCurrentHistory","listenTo","fetch","urlRoot","connectToQuotaMeter","masthead","quotaMeter","history","start","pushState","call","__WEBPACK_AMD_DEFINE_ARRAY__","__WEBPACK_AMD_DEFINE_RESULT__","iframe","src","deepeach","dict","i","d","isObject","new_dict","isJSON","text","test","replace","sanitize","content","html","isEmpty","value","Array","length","undefined","indexOf","textify","lst","isArray","toString","pos","lastIndexOf","substr","get","top","__utils__get__","cache_key","JSON","stringify","cache","success","console","request","data","response","error","ajaxConfig","contentType","type","isEmptyObject","param","dataType","ajax","done","parseJSON","e","fail","response_text","responseText","always","complete","cssGetAttribute","classname","appendTo","css","cssLoadFile","merge","optionsDefault","defaults","roundToDecimalPlaces","number","numPlaces","placesMultiplier","Math","round","bytesToString","size","normal_font","numberPlaces","unit","tb","gb","mb","kb","rounded","uid","__utils__uid__","time","Date","hours","getHours","minutes","getMinutes","datetime","getDate","getMonth","getFullYear","Utils","Select","Slider","Options","Drilldown","Buttons","Modal","Label","tagName","model","Model","setElement","title","new_title","set","$el","removeClass","addClass","Message","message","status","cls","persistent","update","fadeIn","timeout","clearTimeout","self","setTimeout","fadeOut","Input","placeholder","disabled","visible","area","color","style","events","input","new_val","attr","val","removeAttr","_onchange","Hidden","append","$info","$hidden","hide","Button","ButtonDefault","ButtonIcon","ButtonCheck","ButtonMenu","ButtonLink","RadioButton","Checkbox","Radio","container","body","backdrop","height","width","closing_events","closing_callback","title_separator","buttonList","_template","prepend","$header","$dialog","$body","$footer","$backdrop","$buttons","document","on","keyCode","canceled","off","find","empty","buttons","counter","each","$button","click","getButton","enableButton","disableButton","showButton","hideButton","scrollTop","Ui","icon","scrollable","nopadding","operations","collapsible","collapsible_button","collapsed","$title_text","$title_icon","$content","$operations","tooltip","onclick","attributes","collapse","expand","item","header","footer","hideOperation","showOperation","setOperation","setIcon","disable","enable","Frames","mod_icon_btn","DatasetMetadata","Dataset","hda_ldda","metadata","_set_metadata","keys","k","new_key","split","silent","get_metadata","attribute","TabularDataset","prototype","chunk_url","first_data_chunk","offset","at_eof","url_viz","get_next_chunk","next_chunk","Deferred","getJSON","chunk","rval","ck_data","resolve","DatasetCollection","Collection","TabularDatasetChunkedView","row_count","loading_chunk","TabularButtonTracksterView","expand_to_container","scroll_elt","attempt_to_fetch","func","scrolled_to_bottom","loading_indicator","when","then","result","_renderChunk","data_table","cellpadding","column_names","header_container","header_row","join","j","first_chunk","scroll","_renderCell","cell_contents","index","colspan","$cell","column_types","_renderRow","line","cells","row","num_columns","slice","TopLevelTabularDatasetChunkedView","parents","p","EmbeddedTabularDatasetChunkedView","position","overflow","innerHeight","scrollHeight","col","chrom","end","dataset_id","genome_build","file_ext","parent","modal","frame","log","search","str","array","match","btn_viz","IconButtonView","IconButton","icon_class","mouseover tr","mouseleave","is_numeric","n","isNaN","parseFloat","isFinite","children","eq","btn_viz_pars","gene_region","create_trackster_action","vis_url","dataset_params","dbkey","listTracksParams","Cancel","table_html","View in saved visualization","Add to visualization","vis_id","add","View in new visualization","createTabularDatasetChunkedView","dataset_config","parent_elt","embedded","STATES","UPLOAD","QUEUED","RUNNING","SETTING_METADATA","NEW","EMPTY","OK","PAUSED","FAILED_METADATA","NOT_VIEWABLE","DISCARDED","ERROR","READY_STATES","NOT_READY_STATES","ButtonBase","floating","cls_wait","placement","wait","unwait","href","icons","$title","$icon","current","total","onchange","icon_cls","$menu","pull","onunload","tag","$root","preventDefault","addMenu","menuOptions","divider","_templateMenu","$item","_templateMenuItem","_templateDivider","tmpl","download","margin","ondblclick","onconfirm","cls_tr","dblclick","$thead","$tbody","$tmessage","_row","addHeader","wrapper","appendHeader","align","fade","_commit","del","_refresh","delAll","new_value","before","after","_onclick","old_value","closest","_ondblclick","on_click","menu_options","is_menu_button","enabled","tooltip_config","bind","new_elem","template","toJSON","replaceWith","event","isFunction","buffer","IconButtonCollection","IconButtonMenuView","collection","button","elt","make_popupmenu","create_icon_buttons_menu","global_config","map","button_config","FrameView","menu","option","$option","defaultOptions","cols","rows","cell","top_min","frame_max","top_max","frame_z","frame_counter","frame_uid","frame_list","frame_shadow","_frameInit","_frameResize","_panelRefresh","resize","Close","frame_id","_toPixelCoord","parseInt","_frameInsert","trigger","$frame","_panelAnimationComplete","mousemove","mouseup","mousewheel","DOMMouseScroll","mousedown .frame","mousedown .frame-background","mousedown .frame-scroll-up","mousedown .frame-scroll-down","mousedown .f-close","_eventFrameMouseDown","hasClass","_frameIdentify","xy","x","originalEvent","pageX","y","pageY","_frameDragStart","_eventFrameMouseMove","event_xy_new","event_xy_delta","_frameScreen","min_dim","max","_toGridCoord","_frameOffset","l","_eventFrameMouseUp","_frameDragStop","_eventFrameClose","_eventHide","_eventPanelScroll","frames","srcElement","stopPropagation","_panelScroll","detail","wheelDelta","_eventPanelScroll_up","_eventPanelScroll_down","_frameFocus","_frameGrid","grid_location","px","sign","g","_toGrid","_toPixel","_isCollision","is_collision_pair","a","b","_locationRank","loc","animate","promise","delta","top_new","min","screen_location","grid_rank","substring","new_loc","place_list","f","sort","place","_framePlace","has_focus","__WEBPACK_AMD_DEFINE_FACTORY__","factory","fn","make_text_editable","config_dict","num_cols","num_rows","use_textarea","on_finish","help_text","input_elt","button_elt","set_text","new_text","cur_text","trim","keyup","blur","focus","select","commatize","rgx","is_deferred","ServerStateDeferred","ajax_settings","interval","success_fn","go","deferred","_go","get_random_color","colors","new_color","nr","ng","nb","other_color","or","og","ob","n_brightness","o_brightness","diff","brightness","r","difference","r1","g1","b1","r2","g2","b2","ok","num_tries","random","abs","parseBibtex","baseMVC","_l","BibtexParser","logNamespace","Citation","LoggableMixin","_logNamespace","parsed","err","errors","reduce","all","_fields","entry","first","entries","rawFields","Fields","key","lowerKey","toLowerCase","entryType","EntryType","fields","BaseCitationCollection","partial","HistoryCitationCollection","history_id","ToolCitationCollection","ToolFormBase","customize","execute_btn","version","portlet","submit","job_remap","inputs","label","ignore","help","job_def","tool_version","create","validate","emit","action","$f","method","enctype","_templateSuccess","refreshContents","err_data","error_messages","matchResponse","input_id","highlight","err_msg","_templateError","job_inputs","batch_n","batch_src","job_input_id","input_value","input_field","field_list","input_def","input_list","optional","batch","values","jobs","njobs","njobs_text","$message","outputs","output","hid","Portlet","multiple","v","v_id","v_name","_templateRow","Base","error_text","wait_text","_changeValue","_changeWait","_changeData","_changeVisible","$options","all_button","_getValue","_templateOptions","_templateOption","_messageShow","_setValue","selected","BaseIcons","pair","empty_text","searchable","_changeDisabled","$select","$dropdown","$resize","$resize_icon","select2","currentY","currentHeight","minHeight","closeOnSelect","exists","sorter","findWhere","setOnChange","escape","faIconButton","tooltipConfig","classes","concat","faIcon","with_close","$close","is","has","_get_placement","newTitle","_get_width","$container","container_width","container_height","_get_height","container_position","minimumInputLength","initialData","select_data","_getIndex","splice","select_opt","containerCssClass","dropdownCssClass","escapeMarkup","formatResult","formatSelection","initSelection","dropdownAutoWidth","findIndex","User","username","email","total_disk_usage","nice_total_disk_usage","quota_percent","is_admin","resp","changes","isAdmin","loadFromApi","idOrCurrent","CURRENT_ID_STR","userFn","newModel","clearSessionStorage","sessionStorage","removeItem","userInfo","unshift","getCurrentUserFromApi","currentUser","BASE_MVC","userModel","metricsLogger","addLogging","localize","_init","DEBUGGING_KEY","NAMESPACE_KEY","localDebugging","localStorage","getItem","storageErr","Events","logger","_processOptions","_initConfig","_patchGalaxy","_initLogger","loggerOptions","_initLocale","_initUser","_setUpListeners","patchExisting","hasOwnProperty","patchWith","consoleLogger","consoleLevel","MetricsLogger","ALL","consoleNamespaceWhitelist","arguments","userJSON","lastAjax","ev","xhr","location","debugging","setting","setItem","debuggingNamespaces","namespaces","csv","newSettings","userEmail","Menu","Scratchbook","QuotaMeter","$navbarBrandLink","$navbarBrandImage","$navbarBrandTitle","$navbarTabs","$quoteMeter","Tab","m","UserQuotaMeter","$download_link","q","brand","logo_url","logo_src","reset","user_requests","lims_doc_url","helpTab","support_url","mailing_lists","screencasts_url","wiki_url","citation_url","terms_url","biostar_url","biostar_url_redirect","userTab","use_remote_user","allow_user_creation","activeView","active_view","$toggle","$note","click .dropdown-toggle","visibility","_formatUrl","menuItem","_buildMenuItem","_toggleClick","buildLink","popover","charAt","Masthead","Panel","BaseMVC","className","_panelIds","message_box_visible","message_box_content","message_box_class","show_inactivity_warning","inactivity_box_content","pick","omit","$messagebox","$inactivebox","renderMessageBox","renderInactivityBox","renderPanels","level","toggle","verificationLink","forEach","panelId","hideSidePanels","buttonActive","active","show_note","note_cls","onbeforeunload","buttonLoad","note","history_cache","addDataset","current_dataset","historyId","dataset_ids","_findDataset","dataset","history_details","dataset_list","_loadDatasetOffset","new_dataset_id","_loadDataset","new_dataset","__WEBPACK_AMD_REQUIRE_ARRAY__","DATA","is_tabular","data_type","addTrackster","viz_id","visualization","trackster","viz","Visualization","ui","TracksterUI","frame_config","view_config","stand_alone","latest_revision","drawables","create_visualization","viewport","bookmarks","open","$galaxy_main","arg0","accumulator","tempStorage","parser","getErrors","STATES_","ENTRY_OR_JUNK","OBJECT_TYPE","ENTRY_KEY","KV_KEY","EQUALS","KV_VALUE","DATA_","CALLBACK_","CHAR_","LINE_","CHAR_IN_LINE_","SKIPWS_","SKIPCOMMENT_","PARSETMP_","SKIPTILLEOL_","VALBRACES_","BRACETYPE_","BRACECOUNT_","STATE_","ERRORS_","ENTRY_TYPES_","inproceedings","proceedings","article","techreport","misc","mastersthesis","book","phdthesis","incollection","unpublished","inbook","manual","periodical","booklet","masterthesis","conference","online","MACROS_","jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","processCharacter_","error_","processEntry_","raw","CHARCONV_","re","rep","len","processed","c","skip","ObjectType","AnotherIteration","ot","Key","EntryKey","Value","\"","{","delim","doneParsingValue","macro","citationModel","CitationView","formattedReference","ref","authorsAndYear","_asSentence","author","year","pages","address","volume","journal","booktitle","howpublished","institution","_formatBookInfo","doiUrl","doi","info","chapter","editor","publisher","series","issn","CitationListView","renderCitation","click .citations-to-bibtex","click .citations-to-formatted","citation","citationView","rawTextarea","citationsElement","showFormatted","showBibtex","partialWarningElement","LIST_ITEM","DATASET_LI","FoldoutListItemView","ListItemView","DCListItemView","linkTarget","hasUser","changed","_renderSubtitle","templates","subtitle","_getFoldoutPanelOptions","$selector","modelString","warnings","wrapTemplate","purged","deleted","titleBarTemplate","subtitleTemplate","titleBar","DCEListItemView","DatasetDCEListItemView","DatasetListItemView","_fetchModelDetails","inReadyState","hasDetails","NestedDCDCEListItemView","_swapNewRender","$newRender","state","DATASET_MODEL","DatasetCollectionElementMixin","model_class","element_identifier","element_index","element_type","_mergeObject","object","element_id","constructor","idAttribute","DatasetCollectionElement","DCECollection","DatasetDCE","DatasetAssociation","mixin","warn","objStr","DatasetDCECollection","SearchableModelMixin","collection_type","collectionClass","elements","_createElementsModel","unset","json","populated","isDeletedOrPurged","getVisibleContents","filters","delete","save","undelete","searchAttributes","idAndName","ListDatasetCollection","attrs","PairDatasetCollection","NestedDCDCE","NestedDCDCECollection","NestedPairDCDCE","NestedPairDCDCECollection","ListPairedDatasetCollection","HDCA","UI_MODAL","naturalSort","createListCollection","contents","listCollectionCreatorModal","creationFn","element","history_content_type","createHDCA","DatasetCollectionElementView","toggleClass","source","discard","parentWidth","margin-right","destroy","click .name","click .discard","dragstart","dragend","dragover","drop","_click","_clickName","prompt","_clickDiscard","_dragstart","dataTransfer","effectAllowed","setData","_dragend","_sendToParent","ListCollectionCreator","elementViewClass","HistoryListDatasetCollection","minElements","defaultAttributes","TypeError","oncreate","oncancel","autoscrollDist","highlightClr","metric","creator","initialElements","_instanceSetUp","_elementsSetUp","_setUpBehaviors","selectedIds","$dragging","blocking","invalidElements","workingElements","elementViews","_ensureElementIds","_validateElements","_mangleDuplicateNames","_sortElements","uniqueId","filter","problem","_isElementInvalid","contains","SAFETY","existingNames","currName","Error","list","speed","_renderInvalid","main","_renderHeader","_renderMiddle","_renderFooter","_addPluginComponents","invalidInitial","problems","helpContent","_invalidElementsAlert","$middle","middle","_renderList","hoverhighlight","_showAlert","_validationWarning","what","clear","VALIDATION_CLASS","_disableNameAndCreate","isUndefined","$list","_renderClearSelected","$tmp","removeElementView","elementView","_createElementView","invoke","_listenToElementView","addElementView","without","stopListening","_renderNoElementsLeft","noElementsLeft","_elementToJSON","createList","_errorHandler","once","readyState","responseJSON","click .more-help","click .less-help","click .main-help","click .header .alert button","click .reset","click .clear-selected","click .collection-elements","dragover .collection-elements","drop .collection-elements","collection-element.dragstart .collection-elements","collection-element.dragend   .collection-elements","change .collection-name","keydown .collection-name","click .cancel-create","click .create-collection","_clickMoreHelp","_clickLessHelp","_toggleHelp","alertClass","_hideAlert","clearSelectedElements","_dragoverElements","_checkForAutoscroll","clientY","$nearest","_getNearestElement","$placeholder","$element","AUTOSCROLL_SPEED","upperDist","lowerDist","outerHeight","WIGGLE","lis","toArray","$li","halfHeight","floor","_dropElements","dropEffect","insertBefore","insertAfter","last","_syncOrderToDom","newElements","_elementDragstart","_elementDragend","_changeName","_getName","_nameCheckForEnter","_clickCreate","collectionCreatorModal","CreatorClass","reject","_collectionCreator","_super","changedAttributes","expanded","fxSpeed","_renderPrimaryActions","_renderDisplayButton","displayBtnData","urls","_renderDetails","noAccess","$details","_renderSecondaryActions","_renderSummary","_renderDetailMessages","_renderDisplayApplications","summaryRenderFn","summaries","unknown","$warnings","detailMessages","templateFn","displayApplications","_renderDownloadButton","_renderShowParamsButton","show_params","hasData","_renderMetaFileDownloadButton","meta_file","meta_download","file_type","clone","click .display-btn","click .params-btn","click .download-btn","failed_metadata","detailsTemplate","noAccessTemplate","summaryTemplates","detailMessageTemplates","resubmitted","displayApplicationsTemplate","details","Manager","checksum","sum","section","field","flat_id","flat_dict","result_dict","element_list","convert","identifier","head","node","section_label","block_indices","block_prefix","block_label","test_param","selectedCase","_matchCase","flat","collapsible_value","payload","p_id","_iterate","matchCase","matchModel","visitInputs","new_id","separator","child","truevalue","falsevalue","cases","prefix","context","app_options","text_enable","text_disable","cls_enable","cls_disable","$field","$preview","$collapsible","$collapsible_text","$collapsible_icon","$error_text","$error","help_argument","collapsible_state","SelectContent","SelectLibrary","SelectFtp","ColorPicker","types","data_column","genomebuild","data_collection","integer","float","boolean","drill_down","hidden","hidden_data","baseurl","library_data","ftpfile","fieldClass","incompatible","_fieldSelect","_fieldText","_fieldData","extensions","flavor","is_workflow","SelectClass","_fieldDrilldown","str_value","String","_fieldSlider","precise","_fieldHidden","_fieldBoolean","_fieldColor","_fieldLibrary","_fieldFtp","Table","button_new","title_new","onnew","table","button_delete","ondel","table_row","hideOptions","Repeat","InputElement","Parameters","parameters","_addConditional","_addRepeat","_addSection","_addRow","sustain_conditionals","case_def","section_id","section_row","nonhidden","sub_section_id","sub_section","block_index","repeat","n_cache","sustain_repeats","input_element","text_value","collapsible_preview","argument","FormSection","FormData","initial_errors","new_model","isEqual","new_options","opt","is_dynamic","$panel","_renderForm","current_check","force","new_check","DC_MODEL","HISTORY_CONTENT","buildHDCASave","isNew","hcontentMixin","HistoryContentMixin","ListDC","PairDC","ListPairedDC","HistoryPairDatasetCollection","HistoryListPairedDatasetCollection","typeIdStr","type_id","_typeIdStr","_createTypeId","isVisible","show_deleted","show_hidden","unhide","nameAndId","HistoryContent","HDA_MODEL","HDCA_MODEL","HistoryContents","HistoryDatasetAssociation","validationError","models","ids","notReady","running","filterFn","getByHid","getVisible","filteredHdas","visibleAndUndeleted","haveDetails","fetchUpdated","since","traditional","_filtersFromMap","update_time-ge","toISOString","filterMap","fetchAllDetails","detailsFlag","fetchCollectionCounts","qv","ajaxQueue","ajaxFn","startingLength","responses","ajaxFns","chain","reverse","notify","curr","shift","isCopyable","contentsJSON","copyableModelClasses","copy","isString","LibraryDatasetDatasetAssociation","HistoryDatasetCollectionAssociation","post","matches","matchesWhat","elementIdentifiers","collectionType","typeToModel","paired","hdca","element_identifiers","print","ExpandableView","_buildNewRender","_queueNewRender","queue","next","$where","$newDetails","toggleExpanded","_expand","slideDown","duration","step","slideUp","SelectableViewMixin","DraggableViewMixin","isSelectable","_renderWarnings","_renderTitleBar","selectable","showSelector","draggable","draggableOn","click .title-bar","keydown .title-bar","click .selector","_clickTitleBar","altKey","toggleSelect","_keyDownTitleBar","KEYCODE_SPACE","KEYCODE_RETURN","elTemplato","foldoutStyle","foldoutPanelClass","foldout","_createFoldoutPanel","_attachFoldout","FoldoutClass","_getFoldoutPanelClass","$whereTo","_expandByDrilldown","FormBase","CitationModel","_buildForm","process","_buildModel","description","_operations","_updateModel","_footer","hide_message","build_url","build_data","tool_model","error_message","redirect","large","model_url","update_url","current_state","versions_button","narrow","sustain_version","versions","menu_button","origin","requirements","_templateRequirements","sharable_url","_templateHelp","citations","$citations","citation_list_view","$tmpl","nreq","requirements_message","req","requirements_link","util","VisibilityMixin","is_visible","ToolParameter","num_samples","unescape","set_value","ToolParameterCollection","DataToolParameter","IntegerToolParameter","get_samples","d3","scale","linear","domain","ticks","FloatToolParameter","SelectToolParameter","subModelTypes","Tool","p_class","remove_inputs","tool","incompatible_inputs","only_samplable_inputs","valid_inputs","apply_search_results","results","set_input_value","set_input_values","inputs_dict","input_name","run","_run","rerun","target_dataset","regions","target_dataset_id","get_inputs_dict","input_dict","additional_params","run_deferred","ss_deferred","ToolCollection","ToolSectionLabel","ToolSection","elems","clear_search_results","cur_label","all_hidden","ToolSearch","search_hint_string","min_chars_for_search","clear_btn_url","query","clear_key","do_search","timer","ga","clear_search","tool_search","tools","layout","parse_elt","elt_dict","panel_elt","BaseView","update_visible","ToolLinkView","$link","tool_link","formStyle","form","ToolSectionLabelView","ToolSectionView","update_open","panel_section","section_body","tool_view","label_view","click .toolSectionTitle > a","ToolSearchView","keyup :input","click #search-clear-btn","focus_and_select","query_changed","evData","which","ToolPanelView","handle_search_results","search_view","section_title_view","ToolFormView","tool_form","tool_panel_view","tool_form_view","show_tool","variable","PopupMenu","_renderAndShow","clickEvent","_getShownPosition","_setUpCloseBehavior","li","check","checked","menuWidth","scrollLeft","closePopup","one","addItem","findIndexByHtml","findItemByHtml","button_element","initial_options","convertedOptions","optionVal","optionKey","newOption","convertLinksToOptions","$parent","selector","elem","linkHref","confirmText","confirm","fromExistingDom","$buttonElement","$menuElement","menuElementLinkSelector","make_popup_menus","menuSelector","buttonSelectorBuildFn","popupMenusCreated","fromDom","standard","base","theme","$view","$value","_build","$boxes","_templateCheck","rgb","hex","_content","padding","line_def","bottom","_templateContent","$label","$line","$box","_templateBox","header_index","_setState","header_id","is_expanded","$subgroup","attach","iterate","has_options","new_header","$group","Batch","DISABLED","ENABLED","LINKED","Configurations","data_multiple","workflow_data","workflow_data_multiple","workflow_data_collection","module_data","module_data_collection","src_labels","hda","button_product","$batch_div","$batch","linked","_changeCurrent","_changeType","id_list","_batch","$batchfield","batchmode","button_type","config_id","button_data","button_width","margin-left","select_options","items","map_over_type","List","ftpfile_list","Libraries","LibraryDatasets","library_id","libraries","datasets","library_select","library_current","useslider","$slider","slider","$text","pressed","_isParameter","extension","genome","url_paste","file_name","file_mode","file_size","file_path","file_data","percentage","space_to_tab","to_posix_lines","warnAtPercent","errorAtPercent","isOverQuota","_render_quota","modelJson","percent","$meter","_templateQuotaMeter","$bar","_render_usage","usage","_templateUsage","meterHtml","has_deferred","toUpperCase","ready","_typeof","Symbol","iterator","obj","userId","LoggingCache","LOG","DEBUG","INFO","WARN","METRIC","NONE","logLevel","defaultNamespace","clientPrefix","maxCacheSize","postSize","addTime","cacheKeyPrefix","postUrl","delayPostInMs","getPingData","onServerResponse","_parseLevel","_sending","_waiting","_postSize","_initCache","maxSize","_emitToConsole","upper","namespace","logArguments","_addToCache","newLength","_buildEntry","_postCache","count","entriesLength","postData","metrics","_delayPost","whitelist","_hasStorage","_initStorage","_cache","_fetchAndParse","overage","_unparseAndStore","removed","AnnotationEditor","HiddenUntilActivatedViewMixin","hiddenUntilActivated","$activator","$annotation","newAnnotation","annotation","previous","LIST_VIEW","DC_LI","ModelListPanel","CollectionView","DatasetDCEViewClass","NestedDCDCEViewClass","modelCollectionKey","panelStack","parentName","_filterCollection","_getItemViewClass","_getItemViewOptions","_setUpItemViewListeners","panel","expanded:drilldown","drilldown","_expandDrilldownPanel","collapsed:drilldown","_collapseDrilldownPanel","click .navigation .back","close","controlsTemplate","controls","ListCollectionView","PairCollectionView","ListOfPairsCollectionView","TAGS","ANNOTATIONS","DatasetListItemEdit","purgeAllowed","tagsEditorShown","annotationEditorShown","actions","_renderEditButton","_renderDeleteButton","editBtnData","edit","deletedAlready","_renderTags","_renderAnnotation","_makeDbkeyEditLink","_renderErrButton","_renderRerunButton","_renderVisualizationsButton","report_error","creating_job","visualizations","$visualizations","_addScratchBookFn","addBack","$links","tagsEditor","TagsEditor","onshowFirstTime","onshow","onhide","annotationEditor","editableDbkey","click .undelete-link","click .purge-link","click .edit-btn","click .delete-btn","click .rerun-btn","click .report-err-btn","click .visualization-btn","click .dbkey a","_clickUndeleteLink","_clickPurgeLink","purge","visualizationsTemplate","searchableMixin","accessible","meta_files","misc_blurb","misc_info","tags","_generateUrls","currModel","newState","responseObj","messageBuriedInUnfortunatelyFormattedError","searchAliases","format","database","blurb","DatasetAssociationCollection","HDAListItemView","DATASET","DC_VIEW","HDCAListItemView","change:populated change:visible","HISTORY_CONTENTS","UTILS","History","historyJSON","updateTimeoutId","msg","errorHandler","makeArray","newId","clearUpdateTimeout","nice_size","ownedByCurrUser","contentsCount","memo","num","numOfUnfinishedJobs","unfinishedJobIds","numOfUnfinishedShownContents","_getSizeAndRunning","refresh","lastUpdateTime","serverResponseDatetime","getResponseHeader","checkForUpdates","_delayThenUpdate","delay","UPDATE_DELAY","historyData","_delete","allDatasets","all_datasets","newHistory","setAsCurrent","getHistoryData","getHistory","getContents","detailIdsFn","hdcaDetailIds","df","historyFn","contentsFn","historyXHR","contentsXHR","ControlledFetchMixin","_buildFetchData","_fetchOptions","fetchDefaults","_fetchDefaults","_buildFetchFilters","HistoryCollection","DEFAULT_ORDER","sortOrders","update_time","getter","h","asc","update_time-asc","name-dsc","size-asc","includeDeleted","setOrder","order","currentHistoryId","allFetched","setUpListeners","change:deleted","copied","original","newData","setCurrent","set-as-current","oldCurrentId","sortOrder","comparator","fetchOptions","limit","fetchData","numFetched","hdas","historyOptions","xhrOptions","LoadingIndicator","ListPanel","viewClass","emptyMsg","noneFoundMsg","searchPlaceholder","searchFor","indicator","selecting","lastSelected","dragItems","views","$scrollContainer","freeViews","loading","_showLoadingIndicator","loading-done","_hideLoadingIndicator","_setUpCollectionListeners","_setUpViewListeners","renderItems","addItemView","removeItemView","view:selected","shiftKey","lastSelectedView","viewFromModelId","selectRange","showSelectors","view:de-selected","_renderControls","_renderTitle","_renderSearch","$controls","_renderMultiselectActionMenu","multiselectActions","$newMenu","$actions","$messages","$emptyMessage","itemModel","_createItemView","_attachItems","_renderEmptyMessage","_filterItem","every","matchesAll","ViewClass","getSelectedModels","expandAll","collapseAll","_attachView","viewFromModel","viewsWhereModel","properties","viewRange","viewA","viewB","indexA","indexB","searchInput","initialVal","onfirstsearch","_firstSearch","onsearch","searchItems","onclear","clearSearch","THROTTLE_SELECTORS_AT","hideSelectors","hideSelector","toggleSelectors","selectAll","deselectAll","deselect","range","getSelectedViews","scrollPosition","scrollTo","scrollToTop","scrollToItem","itemTop","offsetTop","scrollToId","click .select-all","click .deselect-all","elTemplate","setModel","freeModel","oldModelId","_setUpModelListeners","$input","_getTagsUsed","tagsToCSV","tagsArray","added","_addNewTagToTagsUsed","newTag","tagsUsed","class_add","class_remove","class_partial","onadd","onremove","ftp_files","_fill","_templateTable","_add","$select_all","ftp_file","model_index","_find","_templateInfo","$it","filtered","where","path","ctime","class_check","class_uncheck","$cover","$table","parameter","$checkbox","scope","$this","targetSelector","mouseover","background","mouseout","parentNode","clearSearchInput","searchTerms","firstSearch","inputTemplate","KEYCODE_ESC","escWillClear","minSearchLen","$clearBtn","$loadingIndicator","toggleLoadingIndicator","$parentNode","inputVal","oninit","s","nC","fromCharCode","xN","yN","xD","getTime","yD","oFxNcL","oFyNcL","cLoc","numS","props","uploadpost","cnf","progress","maxfilesize","error_filesize","error_default","error_server","error_login","sizes","files","file","XMLHttpRequest","setRequestHeader","onreadystatechange","DONE","statusText","addEventListener","lengthComputable","loaded","send","uploadinput","opts","ondragover","ondragleave","change","dialog","uploadbox","queue_running","current_index","queue_index","mode","duplicate","announce","queue_length","queue_stop","stop","configure","compatible","File","FileList","dragleave","alert","RightPanel","historyOptionsMenu","CurrentHistoryView","refreshButton","optionsButton","viewMultiButton","optionsMenu","anonymous","_templateBody","LeftPanel","Tools","Upload","_renderWorkflowMenu","handle_minwidth_hint","_templateTool","menu_entry","stored_workflow","encoded_stored_workflow_id","DATASET_LI_EDIT","DCListItemEdit","DCEListItemEdit","DatasetDCEListItemEdit","NestedDCDCEListItemEdit","DC_EDIT","CollectionViewEdit","nameSelector","newName","previousName","ListCollectionViewEdit","PairCollectionViewEdit","NestedPairCollectionViewEdit","ListOfPairsCollectionViewEdit","levenshteinDistance","LIST_COLLECTION_CREATOR","autoPairFnBuilder","getRegExps","_regexps","RegExp","createPair","listA","listB","aInBIndex","bInAIndex","_pair","preprocessMatch","regexps","matchTo","possible","bestMatch","score","scoreThreshold","createListOfPairsCollection","pairedCollectionCreatorModal","PairView","currentTarget","opacity","PairedCollectionCreator","DEFAULT_FILTERS","automaticallyPair","strategy","matchPercentage","twoPassAutopairing","initialList","commonFilters","strategies","DEFAULT_STRATEGY","removeExtensions","unpairedPanelHidden","pairedPanelHidden","_dataSetUp","illumina","Rs","simple","lcs","levenshtein","unpaired","_sortInitialList","_ensureIds","autoPair","_sortDatasetList","_splitByFilters","_filter","regexFilters","stringFilter","_addToUnpaired","binSearchSortedIndex","low","hi","mid","compared","autopairSimple","autopairLevenshtein","distance","autopairLCS","_naiveStartingAndEndingLCS","s1","s2","fwdLCS","revLCS","fwd","rev","_createPair","_guessNameForPair","forward","fwdName","revName","lastDotIndex","_unpair","unpairAll","pairs","_pairToJSON","ajaxData","_ajaxErrHandler","_renderFilters","_renderUnpaired","_renderPaired","$fwd","$rev","$prd","_renderUnpairedDisplayStr","_renderUnpairedEmpty","_renderPairButton","_renderUnpairedDataset","_adjUnpairedOnScrollbar","_renderUnpairedNotShown","numFiltered","$msg","$unpairedColumns","$firstDataset","ucRight","outerWidth","dsRight","rightDiff","_renderPairedEmpty","pairView","_chooseFiltersPopover","filterChoice","val1","val2","$popoverContent","filterSet","splitView","msgClass","hideUnpaired","click .forward-column .column-title","click .reverse-column .column-title","click .unpair-all-link","change .forward-unpaired-filter input","focus .forward-unpaired-filter input","click .autopair-link","click .choose-filters .filter-choice","click .clear-filters-link","change .reverse-unpaired-filter input","focus .reverse-unpaired-filter input","click .forward-column .dataset.unpaired","click .reverse-column .dataset.unpaired","click .paired-column .dataset.unpaired","click .unpaired-columns","mousedown .unpaired-columns .dataset","click .paired-column-title","mousedown .flexible-partition-drag","click .paired-columns .dataset.paired","click .paired-columns","click .paired-columns .pair-name","click .unpair-btn","dragover .paired-columns .column-datasets","drop .paired-columns .column-datasets","pair.dragstart .paired-columns .column-datasets","pair.dragend   .paired-columns .column-datasets","change .remove-extensions","toggleExtensions","_clickShowOnlyUnpaired","hidePaired","_clickShowOnlyPaired","_clickUnpairAll","_clickAutopair","_clickFilterChoice","$selected","_hideChooseFilters","_clearFilters","_clickUnpairedDataset","toggleSelectUnpaired","$dataset","waitToPair","pairAllSelected","fwds","revs","clearSelectedUnpaired","_mousedownUnpaired","$startTarget","moveListener","_clickPairRow","rowIndex","_startPartitionDrag","endDrag","unbind","trackMouse","startingY","adjPartition","adj","$unpaired","$paired","unpairedHi","pairedHi","movingUpwards","flex","selectPair","clearSelectedPaired","_clickPairName","$name","$pair","customizedName","_clickUnpair","pairIndex","_dragoverPairedColumns","_getNearestPairedDatasetLi","_dropPairedColumns","_syncPairsToDom","newPaired","_pairDragstart","_pairDragend","_printList","_printPair","LIST_CREATOR","createPairCollection","pairCollectionCreatorModal","PairedDatasetCollectionElementView","PairCollectionCreator","_createForwardElementView","_createReverseElementView","swap","click .swap","MODAL","CopyDialog","defaultName","submitLabel","errorMessage","progressive","activeLabel","allLabel","anonWarning","_showAjaxIndicator","margin-top","checkNameAndCopy","copyAllDatasets","rejectWith","autoClose","defaultCopyNameFn","nameFn","defaultCopyName","defaultCopyWhat","allowAll","originalClosingCallback","isAnon","copyWhat","cancelled","ImportDialog","historyCopyDialog","useImport","HDA_LI","HDAListItemEdit","click .unhide-link","HDCA_LI","DC_VIEW_EDIT","HDCAListItemEdit","HISTORY_MODEL","HISTORY_VIEW_EDIT","HistoryViewPrefs","SessionStorageModel","storageKey","HistoryViewEdit","HDCAViewClass","preferences","currentContentId","loadHistoryWithDetails","contentsData","switchToHistory","createNewHistory","displayMessage","loadHistory","oldState","storage","_debouncedScrollCaptureHandler","debounce","prependTo","_renderQuotaMessage","quotaMsg","$emptyMsg","$toolMenu","_setCurrentContentById","setCurrentContent","galaxy","pathToMatch","fullpath","useToURLRegexMap","hdaId","hdaUse","regex","use","showQuotaMessage","hideQuotaMessage","clearMessages","$target","not","quotaMsgTemplate","HISTORY_VIEW","HDA_LI_EDIT","HDCA_LI_EDIT","PAIR_COLLECTION_CREATOR","LIST_OF_PAIRS_COLLECTION_CREATOR","HistoryView","HDAViewClass","dataDropped","dropTargetOff","_renderCounts","_handleHdaDeletionChange","change:visible","_handleHdaVisibleChange","change:purged","updateHistoryDiskSize","toggleLink","_class","msgs","showDeleted","showHidden","toggleHDATagEditors","toggleHDAAnnotationEditors","_collectionActions","showOrHide","click .show-selectors-btn","click .toggle-deleted-link","toggleShowDeleted","click .toggle-hidden-link","toggleShowHidden","dropTargetOn","dropTarget","dropHandlers","dragenter","$dropTarget","_renderDropTarget","_renderDropTargetHelp","evName","border","border-radius","font-size","font-style","_dropHandlers","dropTargetToggle","getData","USER","HistoryPrefs","expandedIds","addExpanded","removeExpanded","storageKeyPrefix","historyStorageKey","clearAll","views:ready view:attached view:removed","_renderSelectButton","FETCH_COLLECTION_COUNTS_DELAY","initiallyExpanded","_loadHistoryFromXHR","JSONToModel","newHistoryJSON","newHdaJSON","_setUpWebStorage","isBoolean","change:show_deleted","newVal","change:show_hidden","$existing","click .messages [class$=message]","store","inputSelector","_parseErrorMessage","sentryId","_bePolite","raven","Raven","lastEventId","agent","navigator","userAgent","getAllResponseHeaders","responseHeaders","compact","$msgContainer","$detailsLink","_messageToModalOptions","functions","pre","Ok","scrollToHid","buildMenu","menuOption","anon","galaxy_main","$nav","first_tab","current_id","$tabs","$tab_new","_template_tab_new","$tab_title","_template_tab","$tab_content","_template_tab_content","$del_icon","delRemovable","retitle","UploadSettings","UploadFtp","Popover","status_classes","init","_refreshReady","button_menu","_showFtp","ftp","settings","_showSettings","_refreshPercentage","_refreshStatus","_refreshInfo","_refreshFileName","_refreshMode","_refreshFileSize","offsetHeight","UploadModel","UploadRow","select_extension","select_genome","list_extensions","list_genomes","currentFtp","btnStart","_eventStart","btnClose","ext","composite_files","file_desc","_showExtensionInfo","_eventAnnounce","_updateScreen","upload_row","toData","_eventSuccess","_eventError","_eventProgress","it","extension_popup","_templateDescription","description_url","queued","_removeRow","showExtensionInfo","_refreshGenome","_refreshExtension","upload_size","ui_button","btnLocal","btnFtp","_eventFtp","btnCreate","_eventCreate","btnStop","_eventStop","btnReset","_eventReset","_eventComplete","updateExtension","updateGenome","_eventRemove","_uploadPercentage","upload_completed","currentHistory","defaults_only","_percentage","_status","Tabs","UploadButton","UploadViewDefault","UploadViewComposite","auto","current_history","ui_button_view","datatypes","a_text","b_text","datatypes_disable_auto","genomes","current_user","tabs","default_view","composite_view","$indicator","cover","z-index","background-color","text-align","matrix"],"mappings":"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SAAU,MACV,SAAU,MACV,YAAa,MACb,YAAa,MACb,aAAc,MACd,YAAa,MACb,YAAa,MACb,SAAU,MACV,SAAU,MACV,YAAa,MACb,YAAa,MACb,YAAa,MACb,aAAc,MACd,YAAa,MACb,cAAe,MACf,cAAe,MACf,eAAgB,MAChB,cAAe,MACf,SAAU,MACV,YAAa,MACb,YAAa,MACb,YAAa,MACb,aAAc,MACd,YAAa,MACb,YAAa,MACb,UAAW,MACX,QAAS,MACT,YAAa,MACb,YAAa,MACb,aAAc,MACd,YAAa,MACb,YAAa,MACb,SAAU,MACV,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,aAAc,MACd,aAAc,MACd,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,SAAU,MACV,SAAU,MACV,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,aAAc,MACd,aAAc,MACd,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,aAAc,MACd,aAAc,MACd,YAAa,MACb,YAAa,MACb,cAAe,MACf,YAAa,MACb,cAAe,MACf,YAAa,MACb,cAAe,MACf,YAAa,MACb,YAAa,MACb,YAAa,MACb,QAAS,MACT,aAAc,MACd,eAAgB,MAChB,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,QAAS,MACT,QAAS,MACT,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,SAAU,MACV,SAAU,MACV,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,SAAU,MACV,SAAU,MACV,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,YAAa,MACb,aAAc,M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B,MACjB,gBAAiB,MACjB,gBAAiB,MACjB,gBAAiB,MACjB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MAClB,iBAAkB,MA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","file":"analysis.bundled.js","sourcesContent":["webpackJsonp([3,1],[\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* WEBPACK VAR INJECTION */(function(_, Backbone) {'use strict';\n\t\n\tvar jQuery = __webpack_require__(1),\n\t    $ = jQuery,\n\t    GalaxyApp = __webpack_require__(31).GalaxyApp,\n\t    QUERY_STRING = __webpack_require__(67),\n\t    PANEL = __webpack_require__(10),\n\t    ToolPanel = __webpack_require__(96),\n\t    HistoryPanel = __webpack_require__(94),\n\t    PAGE = __webpack_require__(34),\n\t    ToolForm = __webpack_require__(20),\n\t    Tours = __webpack_require__(26);\n\t\n\t/** define the 'Analyze Data'/analysis/main/home page for Galaxy\n\t *  * has a masthead\n\t *  * a left tool menu to allow the user to load tools in the center panel\n\t *  * a right history menu that shows the user's current data\n\t *  * a center panel\n\t *  Both panels (generally) persist while the center panel shows any\n\t *  UI needed for the current step of an analysis, like:\n\t *      * tool forms to set tool parameters,\n\t *      * tables showing the contents of datasets\n\t *      * etc.\n\t */\n\twindow.app = function app(options, bootstrapped) {\n\t    window.Galaxy = new GalaxyApp(options, bootstrapped);\n\t    Galaxy.debug('analysis app');\n\t    // TODO: use router as App base (combining with Galaxy)\n\t\n\t    // .................................................... panels and page\n\t    var config = options.config,\n\t        toolPanel = new ToolPanel({\n\t        el: '#left',\n\t        userIsAnonymous: Galaxy.user.isAnonymous(),\n\t        search_url: config.search_url,\n\t        toolbox: config.toolbox,\n\t        toolbox_in_panel: config.toolbox_in_panel,\n\t        stored_workflow_menu_entries: config.stored_workflow_menu_entries,\n\t        nginx_upload_path: config.nginx_upload_path,\n\t        ftp_upload_site: config.ftp_upload_site,\n\t        default_genome: config.default_genome,\n\t        default_extension: config.default_extension\n\t    }),\n\t        centerPanel = new PANEL.CenterPanel({\n\t        el: '#center'\n\t    }),\n\t        historyPanel = new HistoryPanel({\n\t        el: '#right',\n\t        galaxyRoot: Galaxy.root,\n\t        userIsAnonymous: Galaxy.user.isAnonymous(),\n\t        allow_user_dataset_purge: config.allow_user_dataset_purge\n\t    }),\n\t        analysisPage = new PAGE.PageLayoutView(_.extend(options, {\n\t        el: 'body',\n\t        left: toolPanel,\n\t        center: centerPanel,\n\t        right: historyPanel\n\t    }));\n\t\n\t    // .................................................... decorate the galaxy object\n\t    // TODO: most of this is becoming unnecessary as we move to apps\n\t    Galaxy.page = analysisPage;\n\t    Galaxy.params = Galaxy.config.params;\n\t\n\t    // add tool panel to Galaxy object\n\t    Galaxy.toolPanel = toolPanel.tool_panel;\n\t    Galaxy.upload = toolPanel.uploadButton;\n\t\n\t    Galaxy.currHistoryPanel = historyPanel.historyView;\n\t    Galaxy.currHistoryPanel.listenToGalaxy(Galaxy);\n\t\n\t    //HACK: move there\n\t    Galaxy.app = {\n\t        display: function display(view, target) {\n\t            // TODO: Remove this line after select2 update\n\t            $('.select2-hidden-accessible').remove();\n\t            centerPanel.display(view);\n\t        }\n\t    };\n\t\n\t    // .................................................... routes\n\t    /**  */\n\t    var router = new (Backbone.Router.extend({\n\t        // TODO: not many client routes at this point - fill and remove from server.\n\t        // since we're at root here, this may be the last to be routed entirely on the client.\n\t        initialize: function initialize(options) {\n\t            this.options = options;\n\t        },\n\t\n\t        /** override to parse query string into obj and send to each route */\n\t        execute: function execute(callback, args, name) {\n\t            Galaxy.debug('router execute:', callback, args, name);\n\t            var queryObj = QUERY_STRING.parse(args.pop());\n\t            args.push(queryObj);\n\t            if (callback) {\n\t                callback.apply(this, args);\n\t            }\n\t        },\n\t\n\t        routes: {\n\t            '(/)': 'home',\n\t            // TODO: remove annoying 'root' from root urls\n\t            '(/)root*': 'home',\n\t            '(/)tours(/)(:tour_id)': 'show_tours'\n\t        },\n\t\n\t        show_tours: function show_tours(tour_id) {\n\t            if (tour_id) {\n\t                Tours.giveTour(tour_id);\n\t            } else {\n\t                centerPanel.display(new Tours.ToursView());\n\t            }\n\t        },\n\t\n\t        /**  */\n\t        home: function home(params) {\n\t            // TODO: to router, remove Globals\n\t            // load a tool by id (tool_id) or rerun a previous tool execution (job_id)\n\t            if (params.tool_id || params.job_id) {\n\t                if (params.tool_id === 'upload1') {\n\t                    Galaxy.upload.show();\n\t                    this._loadCenterIframe('welcome');\n\t                } else {\n\t                    this._loadToolForm(params);\n\t                }\n\t            } else {\n\t                // show the workflow run form\n\t                if (params.workflow_id) {\n\t                    this._loadCenterIframe('workflow/run?id=' + params.workflow_id);\n\t                    // load the center iframe with controller.action: galaxy.org/?m_c=history&m_a=list -> history/list\n\t                } else if (params.m_c) {\n\t                    this._loadCenterIframe(params.m_c + '/' + params.m_a);\n\t                    // show the workflow run form\n\t                } else {\n\t                    this._loadCenterIframe('welcome');\n\t                }\n\t            }\n\t        },\n\t\n\t        /** load the center panel with a tool form described by the given params obj */\n\t        _loadToolForm: function _loadToolForm(params) {\n\t            //TODO: load tool form code async\n\t            params.id = params.tool_id;\n\t            centerPanel.display(new ToolForm.View(params));\n\t        },\n\t\n\t        /** load the center panel iframe using the given url */\n\t        _loadCenterIframe: function _loadCenterIframe(url, root) {\n\t            root = root || Galaxy.root;\n\t            url = root + url;\n\t            centerPanel.$('#galaxy_main').prop('src', url);\n\t        }\n\t\n\t    }))(options);\n\t\n\t    // .................................................... when the page is ready\n\t    // render and start the router\n\t    $(function () {\n\t        analysisPage.render().right.historyView.loadCurrentHistory();\n\t\n\t        // use galaxy to listen to history size changes and then re-fetch the user's total size (to update the quota meter)\n\t        // TODO: we have to do this here (and after every page.render()) because the masthead is re-created on each\n\t        // page render. It's re-created each time because there is no render function and can't be re-rendered without\n\t        // re-creating it.\n\t        Galaxy.listenTo(analysisPage.right.historyView, 'history-size-change', function () {\n\t            // fetch to update the quota meter adding 'current' for any anon-user's id\n\t            Galaxy.user.fetch({ url: Galaxy.user.urlRoot() + '/' + (Galaxy.user.id || 'current') });\n\t        });\n\t        analysisPage.right.historyView.connectToQuotaMeter(analysisPage.masthead.quotaMeter);\n\t\n\t        // start the router - which will call any of the routes above\n\t        Backbone.history.start({\n\t            root: Galaxy.root,\n\t            pushState: true\n\t        });\n\t    });\n\t};\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(3)))\n\n/***/ },\n/* 1 */,\n/* 2 */,\n/* 3 */,\n/* 4 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(_, $, jQuery) {'use strict';\n\t\n\t/**\n\t * Galaxy utilities comprises small functions, which at this point\n\t * do not require their own classes/files\n\t*/\n\t\n\t// dependencies\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t\n\t    /** Builds a basic iframe\n\t    */\n\t    function iframe(src) {\n\t        return '<iframe src=\"' + src + '\" frameborder=\"0\" style=\"width: 100%; height: 100%;\"/>';\n\t    }\n\t\n\t    /** Traverse through json\n\t    */\n\t    function deepeach(dict, callback) {\n\t        for (var i in dict) {\n\t            var d = dict[i];\n\t            if (_.isObject(d)) {\n\t                var new_dict = callback(d);\n\t                new_dict && (dict[i] = new_dict);\n\t                deepeach(d, callback);\n\t            }\n\t        }\n\t    }\n\t\n\t    /**\n\t     * Check if a string is a json string\n\t     * @param{String}   text - Content to be validated\n\t     */\n\t    function isJSON(text) {\n\t        return (/^[\\],:{}\\s]*$/.test(text.replace(/\\\\[\"\\\\\\/bfnrtu]/g, '@').replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, ']').replace(/(?:^|:|,)(?:\\s*\\[)+/g, ''))\n\t        );\n\t    };\n\t\n\t    /**\n\t     * Sanitize/escape a string\n\t     * @param{String}   content - Content to be sanitized\n\t     */\n\t    function sanitize(content) {\n\t        return $('<div/>').text(content).html();\n\t    };\n\t\n\t    /**\n\t     * Checks if a value or list of values is `empty`\n\t     * usually used for selectable options\n\t     * @param{String}   value - Value or list to be validated\n\t     */\n\t    function isEmpty(value) {\n\t        if (!(value instanceof Array)) {\n\t            value = [value];\n\t        }\n\t        if (value.length === 0) {\n\t            return true;\n\t        }\n\t        for (var i in value) {\n\t            if (['__null__', '__undefined__', null, undefined].indexOf(value[i]) > -1) {\n\t                return true;\n\t            }\n\t        }\n\t        return false;\n\t    };\n\t\n\t    /**\n\t     * Convert list to pretty string\n\t     * @param{String}   lst - List of strings to be converted in human readable list sentence\n\t     */\n\t    function textify(lst) {\n\t        if ($.isArray(lst)) {\n\t            var lst = lst.toString().replace(/,/g, ', ');\n\t            var pos = lst.lastIndexOf(', ');\n\t            if (pos != -1) {\n\t                lst = lst.substr(0, pos) + ' or ' + lst.substr(pos + 2);\n\t            }\n\t            return lst;\n\t        }\n\t        return '';\n\t    };\n\t\n\t    /**\n\t     * Request handler for GET\n\t     * @param{String}   url     - Url request is made to\n\t     * @param{Function} success - Callback on success\n\t     * @param{Function} error   - Callback on error\n\t     * @param{Boolean}  cache   - Use cached data if available\n\t     */\n\t    function get(options) {\n\t        top.__utils__get__ = top.__utils__get__ || {};\n\t        var cache_key = JSON.stringify(options);\n\t        if (options.cache && top.__utils__get__[cache_key]) {\n\t            options.success && options.success(top.__utils__get__[cache_key]);\n\t            window.console.debug('utils.js::get() - Fetching from cache [' + options.url + '].');\n\t        } else {\n\t            request({\n\t                url: options.url,\n\t                data: options.data,\n\t                success: function success(response) {\n\t                    top.__utils__get__[cache_key] = response;\n\t                    options.success && options.success(response);\n\t                },\n\t                error: function error(response) {\n\t                    options.error && options.error(response);\n\t                }\n\t            });\n\t        }\n\t    };\n\t\n\t    /**\n\t     * Request handler\n\t     * @param{String}   method  - Request method ['GET', 'POST', 'DELETE', 'PUT']\n\t     * @param{String}   url     - Url request is made to\n\t     * @param{Object}   data    - Data send to url\n\t     * @param{Function} success - Callback on success\n\t     * @param{Function} error   - Callback on error\n\t     */\n\t    function request(options) {\n\t        // prepare ajax\n\t        var ajaxConfig = {\n\t            contentType: 'application/json',\n\t            type: options.type || 'GET',\n\t            data: options.data || {},\n\t            url: options.url\n\t        };\n\t        // encode data into url\n\t        if (ajaxConfig.type == 'GET' || ajaxConfig.type == 'DELETE') {\n\t            if (!$.isEmptyObject(ajaxConfig.data)) {\n\t                ajaxConfig.url += ajaxConfig.url.indexOf('?') == -1 ? '?' : '&';\n\t                ajaxConfig.url += $.param(ajaxConfig.data, true);\n\t            }\n\t            ajaxConfig.data = null;\n\t        } else {\n\t            ajaxConfig.dataType = 'json';\n\t            ajaxConfig.url = ajaxConfig.url;\n\t            ajaxConfig.data = JSON.stringify(ajaxConfig.data);\n\t        }\n\t\n\t        // make request\n\t        $.ajax(ajaxConfig).done(function (response) {\n\t            if (typeof response === 'string') {\n\t                try {\n\t                    response = response.replace('Infinity,', '\"Infinity\",');\n\t                    response = jQuery.parseJSON(response);\n\t                } catch (e) {\n\t                    console.debug(e);\n\t                }\n\t            }\n\t            options.success && options.success(response);\n\t        }).fail(function (response) {\n\t            var response_text = null;\n\t            try {\n\t                response_text = jQuery.parseJSON(response.responseText);\n\t            } catch (e) {\n\t                response_text = response.responseText;\n\t            }\n\t            options.error && options.error(response_text, response);\n\t        }).always(function () {\n\t            options.complete && options.complete();\n\t        });\n\t    };\n\t\n\t    /**\n\t     * Read a property value from CSS\n\t     * @param{String}   classname   - CSS class\n\t     * @param{String}   name        - CSS property\n\t     */\n\t    function cssGetAttribute(classname, name) {\n\t        var el = $('<div class=\"' + classname + '\"></div>');\n\t        el.appendTo(':eq(0)');\n\t        var value = el.css(name);\n\t        el.remove();\n\t        return value;\n\t    };\n\t\n\t    /**\n\t     * Load a CSS file\n\t     * @param{String}   url - Url of CSS file\n\t     */\n\t    function cssLoadFile(url) {\n\t        if (!$('link[href^=\"' + url + '\"]').length) {\n\t            $('<link href=\"' + Galaxy.root + url + '\" rel=\"stylesheet\">').appendTo('head');\n\t        }\n\t    };\n\t\n\t    /**\n\t     * Safely merge to dictionaries\n\t     * @param{Object}   options         - Target dictionary\n\t     * @param{Object}   optionsDefault  - Source dictionary\n\t     */\n\t    function merge(options, optionsDefault) {\n\t        if (options) {\n\t            return _.defaults(options, optionsDefault);\n\t        } else {\n\t            return optionsDefault;\n\t        }\n\t    };\n\t\n\t    /**\n\t     * Round floaing point 'number' to 'numPlaces' number of decimal places.\n\t     * @param{Object}   number      a floaing point number\n\t     * @param{Object}   numPlaces   number of decimal places\n\t     */\n\t    function roundToDecimalPlaces(number, numPlaces) {\n\t        var placesMultiplier = 1;\n\t        for (var i = 0; i < numPlaces; i++) {\n\t            placesMultiplier *= 10;\n\t        }\n\t        return Math.round(number * placesMultiplier) / placesMultiplier;\n\t    }\n\t\n\t    // calculate on import\n\t    var kb = 1024,\n\t        mb = kb * kb,\n\t        gb = mb * kb,\n\t        tb = gb * kb;\n\t    /**\n\t     * Format byte size to string with units\n\t     * @param{Integer}   size           - Size in bytes\n\t     * @param{Boolean}   normal_font    - Switches font between normal and bold\n\t     */\n\t    function bytesToString(size, normal_font, numberPlaces) {\n\t        numberPlaces = numberPlaces !== undefined ? numberPlaces : 1;\n\t        // identify unit\n\t        var unit = \"\";\n\t        if (size >= tb) {\n\t            size = size / tb;unit = 'TB';\n\t        } else if (size >= gb) {\n\t            size = size / gb;unit = 'GB';\n\t        } else if (size >= mb) {\n\t            size = size / mb;unit = 'MB';\n\t        } else if (size >= kb) {\n\t            size = size / kb;unit = 'KB';\n\t        } else if (size > 0) {\n\t            unit = 'b';\n\t        } else {\n\t            return normal_font ? '0 b' : '<strong>-</strong>';\n\t        }\n\t        // return formatted string\n\t        var rounded = unit == 'b' ? size : roundToDecimalPlaces(size, numberPlaces);\n\t        if (normal_font) {\n\t            return rounded + ' ' + unit;\n\t        } else {\n\t            return '<strong>' + rounded + '</strong> ' + unit;\n\t        }\n\t    };\n\t\n\t    /**\n\t     * Create a unique id\n\t     */\n\t    function uid() {\n\t        top.__utils__uid__ = top.__utils__uid__ || 0;\n\t        return 'uid-' + top.__utils__uid__++;\n\t    };\n\t\n\t    /**\n\t     * Create a time stamp\n\t     */\n\t    function time() {\n\t        var d = new Date();\n\t        var hours = (d.getHours() < 10 ? \"0\" : \"\") + d.getHours();\n\t        var minutes = (d.getMinutes() < 10 ? \"0\" : \"\") + d.getMinutes();\n\t        return datetime = d.getDate() + \"/\" + (d.getMonth() + 1) + \"/\" + d.getFullYear() + \", \" + hours + \":\" + minutes;\n\t    };\n\t\n\t    return {\n\t        cssLoadFile: cssLoadFile,\n\t        cssGetAttribute: cssGetAttribute,\n\t        get: get,\n\t        merge: merge,\n\t        iframe: iframe,\n\t        bytesToString: bytesToString,\n\t        uid: uid,\n\t        time: time,\n\t        request: request,\n\t        sanitize: sanitize,\n\t        textify: textify,\n\t        isEmpty: isEmpty,\n\t        deepeach: deepeach,\n\t        isJSON: isJSON\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(1)))\n\n/***/ },\n/* 5 */,\n/* 6 */,\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $) {'use strict';\n\t\n\t/**\n\t *  This class contains backbone wrappers for basic ui elements such as Images, Labels, Buttons, Input fields etc.\n\t */\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(23), __webpack_require__(60), __webpack_require__(22), __webpack_require__(56), __webpack_require__(13), __webpack_require__(8)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, Select, Slider, Options, Drilldown, Buttons, Modal) {\n\t\n\t    /** Label wrapper */\n\t    var Label = Backbone.View.extend({\n\t        tagName: 'label',\n\t        initialize: function initialize(options) {\n\t            this.model = options && options.model || new Backbone.Model(options);\n\t            this.tagName = options.tagName || this.tagName;\n\t            this.setElement($('<' + this.tagName + '/>'));\n\t            this.listenTo(this.model, 'change', this.render, this);\n\t            this.render();\n\t        },\n\t        title: function title(new_title) {\n\t            this.model.set('title', new_title);\n\t        },\n\t        value: function value() {\n\t            return this.model.get('title');\n\t        },\n\t        render: function render() {\n\t            this.$el.removeClass().addClass('ui-label').addClass(this.model.get('cls')).html(this.model.get('title'));\n\t            return this;\n\t        }\n\t    });\n\t\n\t    /** Displays messages used e.g. in the tool form */\n\t    var Message = Backbone.View.extend({\n\t        initialize: function initialize(options) {\n\t            this.model = options && options.model || new Backbone.Model({\n\t                message: null,\n\t                status: 'info',\n\t                cls: '',\n\t                persistent: false\n\t            }).set(options);\n\t            this.listenTo(this.model, 'change', this.render, this);\n\t            this.render();\n\t        },\n\t        update: function update(options) {\n\t            this.model.set(options);\n\t        },\n\t        render: function render() {\n\t            this.$el.removeClass().addClass('ui-message').addClass(this.model.get('cls'));\n\t            var status = this.model.get('status');\n\t            if (this.model.get('large')) {\n\t                this.$el.addClass((status == 'success' && 'done' || status == 'danger' && 'error' || status) + 'messagelarge');\n\t            } else {\n\t                this.$el.addClass('alert').addClass('alert-' + status);\n\t            }\n\t            if (this.model.get('message')) {\n\t                this.$el.html(this.model.get('message'));\n\t                this.$el.fadeIn();\n\t                this.timeout && window.clearTimeout(this.timeout);\n\t                if (!this.model.get('persistent')) {\n\t                    var self = this;\n\t                    this.timeout = window.setTimeout(function () {\n\t                        self.$el.fadeOut();\n\t                    }, 3000);\n\t                }\n\t            } else {\n\t                this.$el.fadeOut();\n\t            }\n\t            return this;\n\t        }\n\t    });\n\t\n\t    /** Renders an input element used e.g. in the tool form */\n\t    var Input = Backbone.View.extend({\n\t        initialize: function initialize(options) {\n\t            this.model = options && options.model || new Backbone.Model({\n\t                type: 'text',\n\t                placeholder: '',\n\t                disabled: false,\n\t                visible: true,\n\t                cls: '',\n\t                area: false,\n\t                color: null,\n\t                style: null\n\t            }).set(options);\n\t            this.tagName = this.model.get('area') ? 'textarea' : 'input';\n\t            this.setElement($('<' + this.tagName + '/>'));\n\t            this.listenTo(this.model, 'change', this.render, this);\n\t            this.render();\n\t        },\n\t        events: {\n\t            'input': '_onchange'\n\t        },\n\t        value: function value(new_val) {\n\t            new_val !== undefined && this.model.set('value', typeof new_val === 'string' ? new_val : '');\n\t            return this.model.get('value');\n\t        },\n\t        render: function render() {\n\t            this.$el.removeClass().addClass('ui-' + this.tagName).addClass(this.model.get('cls')).addClass(this.model.get('style')).attr('id', this.model.id).attr('type', this.model.get('type')).attr('placeholder', this.model.get('placeholder')).css('color', this.model.get('color') || '').css('border-color', this.model.get('color') || '');\n\t            if (this.model.get('value') !== this.$el.val()) {\n\t                this.$el.val(this.model.get('value'));\n\t            }\n\t            this.model.get('disabled') ? this.$el.attr('disabled', true) : this.$el.removeAttr('disabled');\n\t            this.$el[this.model.get('visible') ? 'show' : 'hide']();\n\t            return this;\n\t        },\n\t        _onchange: function _onchange() {\n\t            this.value(this.$el.val());\n\t            this.model.get('onchange') && this.model.get('onchange')(this.model.get('value'));\n\t        }\n\t    });\n\t\n\t    /** Creates a hidden element input field used e.g. in the tool form */\n\t    var Hidden = Backbone.View.extend({\n\t        initialize: function initialize(options) {\n\t            this.model = options && options.model || new Backbone.Model(options);\n\t            this.setElement($('<div/>').append(this.$info = $('<div/>')).append(this.$hidden = $('<div/>')));\n\t            this.listenTo(this.model, 'change', this.render, this);\n\t            this.render();\n\t        },\n\t        value: function value(new_val) {\n\t            new_val !== undefined && this.model.set('value', new_val);\n\t            return this.model.get('value');\n\t        },\n\t        render: function render() {\n\t            this.$el.attr('id', this.model.id);\n\t            this.$hidden.val(this.model.get('value'));\n\t            this.model.get('info') ? this.$info.show().html(this.model.get('info')) : this.$info.hide();\n\t            return this;\n\t        }\n\t    });\n\t\n\t    return {\n\t        Button: Buttons.ButtonDefault,\n\t        ButtonIcon: Buttons.ButtonIcon,\n\t        ButtonCheck: Buttons.ButtonCheck,\n\t        ButtonMenu: Buttons.ButtonMenu,\n\t        ButtonLink: Buttons.ButtonLink,\n\t        Input: Input,\n\t        Label: Label,\n\t        Message: Message,\n\t        Modal: Modal,\n\t        RadioButton: Options.RadioButton,\n\t        Checkbox: Options.Checkbox,\n\t        Radio: Options.Radio,\n\t        Select: Select,\n\t        Hidden: Hidden,\n\t        Slider: Slider,\n\t        Drilldown: Drilldown\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1)))\n\n/***/ },\n/* 8 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {'use strict';\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t    var View = Backbone.View.extend({\n\t        // defaults\n\t        optionsDefault: {\n\t            container: 'body',\n\t            title: 'ui-modal',\n\t            cls: 'ui-modal',\n\t            body: '',\n\t            backdrop: true,\n\t            height: null,\n\t            width: null,\n\t            closing_events: false,\n\t            closing_callback: null,\n\t            title_separator: true\n\t        },\n\t\n\t        // button list\n\t        buttonList: {},\n\t\n\t        // initialize\n\t        initialize: function initialize(options) {\n\t            this.setElement(this._template());\n\t            this.options = _.defaults(options || {}, this.optionsDefault);\n\t            $(this.options.container).prepend(this.el);\n\t\n\t            // link elements\n\t            this.$header = this.$('.modal-header');\n\t            this.$dialog = this.$('.modal-dialog');\n\t            this.$body = this.$('.modal-body');\n\t            this.$footer = this.$('.modal-footer');\n\t            this.$backdrop = this.$('.modal-backdrop');\n\t            this.$buttons = this.$('.buttons');\n\t\n\t            // optional render\n\t            options && this.render();\n\t        },\n\t\n\t        /**\n\t         * Displays modal\n\t        */\n\t        show: function show(options) {\n\t            if (options) {\n\t                this.options = _.defaults(options, this.optionsDefault);\n\t                this.render();\n\t            }\n\t            if (!this.visible) {\n\t                this.visible = true;\n\t                this.$el.fadeIn('fast');\n\t                if (this.options.closing_events) {\n\t                    var self = this;\n\t                    $(document).on('keyup.ui-modal', function (e) {\n\t                        e.keyCode == 27 && self.hide(true);\n\t                    });\n\t                    this.$backdrop.on('click', function () {\n\t                        self.hide(true);\n\t                    });\n\t                }\n\t            }\n\t        },\n\t\n\t        /**\n\t         * Hide modal\n\t        */\n\t        hide: function hide(canceled) {\n\t            this.visible = false;\n\t            this.$el.fadeOut('fast');\n\t            this.options.closing_callback && this.options.closing_callback(canceled);\n\t            $(document).off('keyup.ui-modal');\n\t            this.$backdrop.off('click');\n\t        },\n\t\n\t        /**\n\t         * Render modal\n\t        */\n\t        render: function render() {\n\t            var self = this;\n\t            if (this.options.body == 'progress') {\n\t                this.options.body = $('<div class=\"progress progress-striped active\">' + '<div class=\"progress-bar progress-bar-info\" style=\"width:100%\"/>' + '</div>');\n\t            }\n\t\n\t            // fix main content\n\t            this.$el.removeClass().addClass('modal').addClass(this.options.cls);\n\t            this.$header.find('.title').html(this.options.title);\n\t            this.$body.html(this.options.body);\n\t\n\t            // append buttons\n\t            this.$buttons.empty();\n\t            this.buttonList = {};\n\t            if (this.options.buttons) {\n\t                var counter = 0;\n\t                $.each(this.options.buttons, function (name, callback) {\n\t                    var $button = $('<button/>').attr('id', 'button-' + counter++).text(name).click(callback);\n\t                    self.$buttons.append($button).append('&nbsp;');\n\t                    self.buttonList[name] = $button;\n\t                });\n\t            } else {\n\t                this.$footer.hide();\n\t            }\n\t\n\t            // configure background, separator line\n\t            this.$backdrop[this.options.backdrop && 'addClass' || 'removeClass']('in');\n\t            this.$header[!this.options.title_separator && 'addClass' || 'removeClass']('no-separator');\n\t\n\t            // fix dimensions\n\t            if (this.options.height) {\n\t                this.$body.css('height', this.options.height);\n\t                this.$body.css('overflow', 'hidden');\n\t            } else {\n\t                this.$body.css('max-height', $(window).height() / 2);\n\t            }\n\t            if (this.options.width) {\n\t                this.$dialog.css('width', this.options.width);\n\t            }\n\t        },\n\t\n\t        /**\n\t         * Returns the button dom\n\t         * @param{String}   name    - Button name/title\n\t        */\n\t        getButton: function getButton(name) {\n\t            return this.buttonList[name];\n\t        },\n\t\n\t        /**\n\t         * Enables a button\n\t         * @param{String}   name    - Button name/title\n\t        */\n\t        enableButton: function enableButton(name) {\n\t            this.getButton(name).prop('disabled', false);\n\t        },\n\t\n\t        /**\n\t         * Disables a button\n\t         * @param{String}   name    - Button name/title\n\t        */\n\t        disableButton: function disableButton(name) {\n\t            this.getButton(name).prop('disabled', true);\n\t        },\n\t\n\t        /**\n\t         * Show a button\n\t         * @param{String}   name    - Button name/title\n\t        */\n\t        showButton: function showButton(name) {\n\t            this.getButton(name).show();\n\t        },\n\t\n\t        /**\n\t         * Hide a button\n\t         * @param{String}   name    - Button name/title\n\t        */\n\t        hideButton: function hideButton(name) {\n\t            this.getButton(name).hide();\n\t        },\n\t\n\t        /**\n\t         * Returns scroll top for body element\n\t        */\n\t        scrollTop: function scrollTop() {\n\t            return this.$body.scrollTop();\n\t        },\n\t\n\t        /**\n\t         * Returns the modal template\n\t        */\n\t        _template: function _template() {\n\t            return '<div class=\"ui-modal\">' + '<div class=\"modal-backdrop fade\"/>' + '<div class=\"modal-dialog\">' + '<div class=\"modal-content\">' + '<div class=\"modal-header\">' + '<h4 class=\"title\"/>' + '</div>' + '<div class=\"modal-body\"/>' + '<div class=\"modal-footer\">' + '<div class=\"buttons\"/>' + '</div>' + '</div>' + '</div>' + '</div>';\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 9 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {'use strict';\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(7)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, Ui) {\n\t    var View = Backbone.View.extend({\n\t        visible: false,\n\t        initialize: function initialize(options) {\n\t            var self = this;\n\t            this.model = options && options.model || new Backbone.Model({\n\t                id: Utils.uid(),\n\t                cls: 'ui-portlet',\n\t                title: '',\n\t                icon: '',\n\t                buttons: null,\n\t                body: null,\n\t                scrollable: true,\n\t                nopadding: false,\n\t                operations: null,\n\t                collapsible: false,\n\t                collapsible_button: false,\n\t                collapsed: false\n\t            }).set(options);\n\t            this.setElement(this._template());\n\t\n\t            // link all dom elements\n\t            this.$body = this.$('.portlet-body');\n\t            this.$title_text = this.$('.portlet-title-text');\n\t            this.$title_icon = this.$('.portlet-title-icon');\n\t            this.$header = this.$('.portlet-header');\n\t            this.$content = this.$('.portlet-content');\n\t            this.$footer = this.$('.portlet-footer');\n\t            this.$backdrop = this.$('.portlet-backdrop');\n\t            this.$buttons = this.$('.portlet-buttons');\n\t            this.$operations = this.$('.portlet-operations');\n\t\n\t            // add body to component list\n\t            this.model.get('body') && this.append(this.model.get('body'));\n\t\n\t            // add icon for collapsible option\n\t            this.collapsible_button = new Ui.ButtonIcon({\n\t                icon: 'fa-eye',\n\t                tooltip: 'Collapse/Expand',\n\t                cls: 'ui-button-icon-plain',\n\t                onclick: function onclick() {\n\t                    self[self.collapsed ? 'expand' : 'collapse']();\n\t                }\n\t            });\n\t            this.render();\n\t        },\n\t\n\t        render: function render() {\n\t            var self = this;\n\t            var options = this.model.attributes;\n\t            this.$el.removeClass().addClass(options.cls).attr('id', options.id);\n\t            this.$header[options.title ? 'show' : 'hide']();\n\t            this.$title_text.html(options.title);\n\t            _.each([this.$content, this.$body], function ($el) {\n\t                $el[options.nopadding ? 'addClass' : 'removeClass']('no-padding');\n\t            });\n\t\n\t            // render title icon\n\t            if (options.icon) {\n\t                this.$title_icon.removeClass().addClass('portlet-title-icon fa').addClass(options.icon).show();\n\t            } else {\n\t                this.$title_icon.hide();\n\t            }\n\t\n\t            // make portlet collapsible\n\t            this.$title_text[options.collapsible ? 'addClass' : 'removeClass']('no-highlight collapsible').off();\n\t            if (options.collapsible) {\n\t                this.$title_text.on('click', function () {\n\t                    self[self.collapsed ? 'expand' : 'collapse']();\n\t                });\n\t                options.collapsed ? this.collapse() : this.expand();\n\t            }\n\t\n\t            // render buttons\n\t            if (options.buttons) {\n\t                this.$buttons.empty().show();\n\t                $.each(this.model.get('buttons'), function (name, item) {\n\t                    item.$el.prop('id', name);\n\t                    self.$buttons.append(item.$el);\n\t                });\n\t            } else {\n\t                this.$buttons.hide();\n\t            }\n\t\n\t            // render operations\n\t            this.$operations.empty;\n\t            if (options.collapsible_button) {\n\t                this.$operations.append(this.collapsible_button.$el);\n\t            }\n\t            if (options.operations) {\n\t                $.each(options.operations, function (name, item) {\n\t                    item.$el.prop('id', name);\n\t                    self.$operations.append(item.$el);\n\t                });\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /** Append new doms to body */\n\t        append: function append($el) {\n\t            this.$body.append($el);\n\t        },\n\t\n\t        /** Remove all content */\n\t        empty: function empty() {\n\t            this.$body.empty();\n\t        },\n\t\n\t        /** Return header element */\n\t        header: function header() {\n\t            return this.$header;\n\t        },\n\t\n\t        /** Return body element */\n\t        body: function body() {\n\t            return this.$body;\n\t        },\n\t\n\t        /** Return footer element */\n\t        footer: function footer() {\n\t            return this.$footer;\n\t        },\n\t\n\t        /** Show portlet */\n\t        show: function show() {\n\t            this.visible = true;\n\t            this.$el.fadeIn('fast');\n\t        },\n\t\n\t        /** Hide portlet */\n\t        hide: function hide() {\n\t            this.visible = false;\n\t            this.$el.fadeOut('fast');\n\t        },\n\t\n\t        /** Enable a particular button */\n\t        enableButton: function enableButton(id) {\n\t            this.$buttons.find('#' + id).prop('disabled', false);\n\t        },\n\t\n\t        /** Disable a particular button */\n\t        disableButton: function disableButton(id) {\n\t            this.$buttons.find('#' + id).prop('disabled', true);\n\t        },\n\t\n\t        /** Hide a particular operation */\n\t        hideOperation: function hideOperation(id) {\n\t            this.$operations.find('#' + id).hide();\n\t        },\n\t\n\t        /** Show a particular operation */\n\t        showOperation: function showOperation(id) {\n\t            this.$operations.find('#' + id).show();\n\t        },\n\t\n\t        /** Replaces the event callback of an existing operation */\n\t        setOperation: function setOperation(id, callback) {\n\t            this.$operations.find('#' + id).off('click').on('click', callback);\n\t        },\n\t\n\t        /** Change title */\n\t        title: function title(new_title) {\n\t            new_title && this.$title_text.html(new_title);\n\t            return this.$title_text.html();\n\t        },\n\t\n\t        /** Collapse portlet */\n\t        collapse: function collapse() {\n\t            this.collapsed = true;\n\t            this.$content.height('0%');\n\t            this.$body.hide();\n\t            this.$footer.hide();\n\t            this.collapsible_button.setIcon('fa-eye-slash');\n\t        },\n\t\n\t        /** Expand portlet */\n\t        expand: function expand() {\n\t            this.collapsed = false;\n\t            this.$content.height('100%');\n\t            this.$body.fadeIn('fast');\n\t            this.$footer.fadeIn('fast');\n\t            this.collapsible_button.setIcon('fa-eye');\n\t        },\n\t\n\t        /** Disable content access */\n\t        disable: function disable() {\n\t            this.$backdrop.show();\n\t        },\n\t\n\t        /** Enable content access */\n\t        enable: function enable() {\n\t            this.$backdrop.hide();\n\t        },\n\t\n\t        _template: function _template() {\n\t            return $('<div/>').append($('<div/>').addClass('portlet-header').append($('<div/>').addClass('portlet-operations')).append($('<div/>').addClass('portlet-title').append($('<i/>').addClass('portlet-title-icon')).append($('<span/>').addClass('portlet-title-text')))).append($('<div/>').addClass('portlet-content').append($('<div/>').addClass('portlet-body')).append($('<div/>').addClass('portlet-buttons'))).append($('<div/>').addClass('portlet-footer')).append($('<div/>').addClass('portlet-backdrop'));\n\t        }\n\t    });\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 10 */,\n/* 11 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {'use strict';\n\t\n\t// Additional dependencies: jQuery, underscore.\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(8), __webpack_require__(16), __webpack_require__(15)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Modal, Frames, mod_icon_btn) {\n\t\n\t    /**\n\t     * Dataset metedata.\n\t     */\n\t    var DatasetMetadata = Backbone.Model.extend({});\n\t\n\t    /**\n\t     * A dataset. In Galaxy, datasets are associated with a history, so\n\t     * this object is also known as a HistoryDatasetAssociation.\n\t     */\n\t    var Dataset = Backbone.Model.extend({\n\t        defaults: {\n\t            id: '',\n\t            type: '',\n\t            name: '',\n\t            hda_ldda: 'hda',\n\t            metadata: null\n\t        },\n\t\n\t        initialize: function initialize() {\n\t            // Metadata can be passed in as a model or a set of attributes; if it's\n\t            // already a model, there's no need to set metadata.\n\t            if (!this.get('metadata')) {\n\t                this._set_metadata();\n\t            }\n\t\n\t            // Update metadata on change.\n\t            this.on('change', this._set_metadata, this);\n\t        },\n\t\n\t        _set_metadata: function _set_metadata() {\n\t            var metadata = new DatasetMetadata();\n\t\n\t            // Move metadata from dataset attributes to metadata object.\n\t            _.each(_.keys(this.attributes), function (k) {\n\t                if (k.indexOf('metadata_') === 0) {\n\t                    // Found metadata.\n\t                    var new_key = k.split('metadata_')[1];\n\t                    metadata.set(new_key, this.attributes[k]);\n\t                    delete this.attributes[k];\n\t                }\n\t            }, this);\n\t\n\t            // Because this is an internal change, silence it.\n\t            this.set('metadata', metadata, { 'silent': true });\n\t        },\n\t\n\t        /**\n\t         * Returns dataset metadata for a given attribute.\n\t         */\n\t        get_metadata: function get_metadata(attribute) {\n\t            return this.attributes.metadata.get(attribute);\n\t        },\n\t\n\t        urlRoot: Galaxy.root + \"api/datasets\"\n\t    });\n\t\n\t    /**\n\t     * A tabular dataset. This object extends dataset to provide incremental chunked data.\n\t     */\n\t    var TabularDataset = Dataset.extend({\n\t        defaults: _.extend({}, Dataset.prototype.defaults, {\n\t            chunk_url: null,\n\t            first_data_chunk: null,\n\t            offset: 0,\n\t            at_eof: false\n\t        }),\n\t\n\t        initialize: function initialize(options) {\n\t            Dataset.prototype.initialize.call(this);\n\t\n\t            // If first data chunk is available, next chunk is 1.\n\t            if (this.attributes.first_data_chunk) {\n\t                this.attributes.offset = this.attributes.first_data_chunk.offset;\n\t            }\n\t            this.attributes.chunk_url = Galaxy.root + 'dataset/display?dataset_id=' + this.id;\n\t            this.attributes.url_viz = Galaxy.root + 'visualization';\n\t        },\n\t\n\t        /**\n\t         * Returns a jQuery Deferred object that resolves to the next data chunk or null if at EOF.\n\t         */\n\t        get_next_chunk: function get_next_chunk() {\n\t            // If already at end of file, do nothing.\n\t            if (this.attributes.at_eof) {\n\t                return null;\n\t            }\n\t\n\t            // Get next chunk.\n\t            var self = this,\n\t                next_chunk = $.Deferred();\n\t            $.getJSON(this.attributes.chunk_url, {\n\t                offset: self.attributes.offset\n\t            }).success(function (chunk) {\n\t                var rval;\n\t                if (chunk.ck_data !== '') {\n\t                    // Found chunk.\n\t                    rval = chunk;\n\t                    self.attributes.offset = chunk.offset;\n\t                } else {\n\t                    // At EOF.\n\t                    self.attributes.at_eof = true;\n\t                    rval = null;\n\t                }\n\t                next_chunk.resolve(rval);\n\t            });\n\t\n\t            return next_chunk;\n\t        }\n\t    });\n\t\n\t    var DatasetCollection = Backbone.Collection.extend({\n\t        model: Dataset\n\t    });\n\t\n\t    /**\n\t     * Provides a base for table-based, dynamic view of a tabular dataset.\n\t     * Do not instantiate directly; use either TopLevelTabularDatasetChunkedView\n\t     * or EmbeddedTabularDatasetChunkedView.\n\t     */\n\t    var TabularDatasetChunkedView = Backbone.View.extend({\n\t\n\t        /**\n\t         * Initialize view and, importantly, set a scroll element.\n\t         */\n\t        initialize: function initialize(options) {\n\t            // Row count for rendering.\n\t            this.row_count = 0;\n\t            this.loading_chunk = false;\n\t\n\t            // load trackster button\n\t            new TabularButtonTracksterView({\n\t                model: options.model,\n\t                $el: this.$el\n\t            });\n\t        },\n\t\n\t        expand_to_container: function expand_to_container() {\n\t            if (this.$el.height() < this.scroll_elt.height()) {\n\t                this.attempt_to_fetch();\n\t            }\n\t        },\n\t\n\t        attempt_to_fetch: function attempt_to_fetch(func) {\n\t            var self = this;\n\t            if (!this.loading_chunk && this.scrolled_to_bottom()) {\n\t                this.loading_chunk = true;\n\t                this.loading_indicator.show();\n\t                $.when(self.model.get_next_chunk()).then(function (result) {\n\t                    if (result) {\n\t                        self._renderChunk(result);\n\t                        self.loading_chunk = false;\n\t                    }\n\t                    self.loading_indicator.hide();\n\t                    self.expand_to_container();\n\t                });\n\t            }\n\t        },\n\t\n\t        render: function render() {\n\t            // Add loading indicator.\n\t            this.loading_indicator = $('<div/>').attr('id', 'loading_indicator');\n\t            this.$el.append(this.loading_indicator);\n\t\n\t            // Add data table and header.\n\t            var data_table = $('<table/>').attr({\n\t                id: 'content_table',\n\t                cellpadding: 0\n\t            });\n\t            this.$el.append(data_table);\n\t            var column_names = this.model.get_metadata('column_names'),\n\t                header_container = $('<thead/>').appendTo(data_table),\n\t                header_row = $('<tr/>').appendTo(header_container);\n\t            if (column_names) {\n\t                header_row.append('<th>' + column_names.join('</th><th>') + '</th>');\n\t            } else {\n\t                for (var j = 1; j <= this.model.get_metadata('columns'); j++) {\n\t                    header_row.append('<th>' + j + '</th>');\n\t                }\n\t            }\n\t\n\t            // Render first chunk.\n\t            var self = this,\n\t                first_chunk = this.model.get('first_data_chunk');\n\t            if (first_chunk) {\n\t                // First chunk is bootstrapped, so render now.\n\t                this._renderChunk(first_chunk);\n\t            } else {\n\t                // No bootstrapping, so get first chunk and then render.\n\t                $.when(self.model.get_next_chunk()).then(function (result) {\n\t                    self._renderChunk(result);\n\t                });\n\t            }\n\t\n\t            // -- Show new chunks during scrolling. --\n\t\n\t            // Set up chunk loading when scrolling using the scrolling element.\n\t            this.scroll_elt.scroll(function () {\n\t                self.attempt_to_fetch();\n\t            });\n\t        },\n\t\n\t        /**\n\t         * Returns true if user has scrolled to the bottom of the view.\n\t         */\n\t        scrolled_to_bottom: function scrolled_to_bottom() {\n\t            return false;\n\t        },\n\t\n\t        // -- Helper functions. --\n\t\n\t        _renderCell: function _renderCell(cell_contents, index, colspan) {\n\t            var $cell = $('<td>').text(cell_contents);\n\t            var column_types = this.model.get_metadata('column_types');\n\t            if (colspan !== undefined) {\n\t                $cell.attr('colspan', colspan).addClass('stringalign');\n\t            } else if (column_types) {\n\t                if (index < column_types.length) {\n\t                    if (column_types[index] === 'str' || column_types[index] === 'list') {\n\t                        /* Left align all str columns, right align the rest */\n\t                        $cell.addClass('stringalign');\n\t                    }\n\t                }\n\t            }\n\t            return $cell;\n\t        },\n\t\n\t        _renderRow: function _renderRow(line) {\n\t            // Check length of cells to ensure this is a complete row.\n\t            var cells = line.split('\\t'),\n\t                row = $('<tr>'),\n\t                num_columns = this.model.get_metadata('columns');\n\t\n\t            if (this.row_count % 2 !== 0) {\n\t                row.addClass('dark_row');\n\t            }\n\t\n\t            if (cells.length === num_columns) {\n\t                _.each(cells, function (cell_contents, index) {\n\t                    row.append(this._renderCell(cell_contents, index));\n\t                }, this);\n\t            } else if (cells.length > num_columns) {\n\t                // SAM file or like format with optional metadata included.\n\t                _.each(cells.slice(0, num_columns - 1), function (cell_contents, index) {\n\t                    row.append(this._renderCell(cell_contents, index));\n\t                }, this);\n\t                row.append(this._renderCell(cells.slice(num_columns - 1).join('\\t'), num_columns - 1));\n\t            } else if (num_columns > 5 && cells.length === num_columns - 1) {\n\t                // SAM file or like format with optional metadata missing.\n\t                _.each(cells, function (cell_contents, index) {\n\t                    row.append(this._renderCell(cell_contents, index));\n\t                }, this);\n\t                row.append($('<td>'));\n\t            } else {\n\t                // Comment line, just return the one cell.\n\t                row.append(this._renderCell(line, 0, num_columns));\n\t            }\n\t\n\t            this.row_count++;\n\t            return row;\n\t        },\n\t\n\t        _renderChunk: function _renderChunk(chunk) {\n\t            var data_table = this.$el.find('table');\n\t            _.each(chunk.ck_data.split('\\n'), function (line, index) {\n\t                if (line !== '') {\n\t                    data_table.append(this._renderRow(line));\n\t                }\n\t            }, this);\n\t        }\n\t    });\n\t\n\t    /**\n\t     * Tabular view that is placed at the top level of page. Scrolling occurs\n\t     * view top-level elements outside of view.\n\t     */\n\t    var TopLevelTabularDatasetChunkedView = TabularDatasetChunkedView.extend({\n\t\n\t        initialize: function initialize(options) {\n\t            TabularDatasetChunkedView.prototype.initialize.call(this, options);\n\t\n\t            // Scrolling happens in top-level elements.\n\t            scroll_elt = _.find(this.$el.parents(), function (p) {\n\t                return $(p).css('overflow') === 'auto';\n\t            });\n\t\n\t            // If no scrolling element found, use window.\n\t            if (!scroll_elt) {\n\t                scroll_elt = window;\n\t            }\n\t\n\t            // Wrap scrolling element for easy access.\n\t            this.scroll_elt = $(scroll_elt);\n\t        },\n\t\n\t        /**\n\t         * Returns true if user has scrolled to the bottom of the view.\n\t         */\n\t        scrolled_to_bottom: function scrolled_to_bottom() {\n\t            return this.$el.height() - this.scroll_elt.scrollTop() - this.scroll_elt.height() <= 0;\n\t        }\n\t\n\t    });\n\t\n\t    /**\n\t     * Tabular view tnat is embedded in a page. Scrolling occurs in view's el.\n\t     */\n\t    var EmbeddedTabularDatasetChunkedView = TabularDatasetChunkedView.extend({\n\t\n\t        initialize: function initialize(options) {\n\t            TabularDatasetChunkedView.prototype.initialize.call(this, options);\n\t\n\t            // Because view is embedded, set up div to do scrolling.\n\t            this.scroll_elt = this.$el.css({\n\t                position: 'relative',\n\t                overflow: 'scroll',\n\t                height: options.height || '500px'\n\t            });\n\t        },\n\t\n\t        /**\n\t         * Returns true if user has scrolled to the bottom of the view.\n\t         */\n\t        scrolled_to_bottom: function scrolled_to_bottom() {\n\t            return this.$el.scrollTop() + this.$el.innerHeight() >= this.el.scrollHeight;\n\t        }\n\t\n\t    });\n\t\n\t    // button for trackster visualization\n\t    var TabularButtonTracksterView = Backbone.View.extend({\n\t\n\t        // gene region columns\n\t        col: {\n\t            chrom: null,\n\t            start: null,\n\t            end: null\n\t        },\n\t\n\t        // url for trackster\n\t        url_viz: null,\n\t\n\t        // dataset id\n\t        dataset_id: null,\n\t\n\t        // database key\n\t        genome_build: null,\n\t\n\t        // data type\n\t        file_ext: null,\n\t\n\t        // backbone initialize\n\t        initialize: function initialize(options) {\n\t            // check if environment is available\n\t            var Galaxy = parent.Galaxy;\n\t\n\t            // link galaxy modal or create one\n\t            if (Galaxy && Galaxy.modal) {\n\t                this.modal = Galaxy.modal;\n\t            }\n\t\n\t            // link galaxy frames\n\t            if (Galaxy && Galaxy.frame) {\n\t                this.frame = Galaxy.frame;\n\t            }\n\t\n\t            // check\n\t            if (!this.modal || !this.frame) {\n\t                return;\n\t            }\n\t\n\t            // model/metadata\n\t            var model = options.model;\n\t            var metadata = model.get('metadata');\n\t\n\t            // check for datatype\n\t            if (!model.get('file_ext')) {\n\t                return;\n\t            }\n\t\n\t            // get data type\n\t            this.file_ext = model.get('file_ext');\n\t\n\t            // check for bed-file format\n\t            if (this.file_ext == 'bed') {\n\t                // verify that metadata exists\n\t                if (metadata.get('chromCol') && metadata.get('startCol') && metadata.get('endCol')) {\n\t                    // read in columns\n\t                    this.col.chrom = metadata.get('chromCol') - 1;\n\t                    this.col.start = metadata.get('startCol') - 1;\n\t                    this.col.end = metadata.get('endCol') - 1;\n\t                } else {\n\t                    console.log('TabularButtonTrackster : Bed-file metadata incomplete.');\n\t                    return;\n\t                }\n\t            }\n\t\n\t            // check for vcf-file format\n\t            if (this.file_ext == 'vcf') {\n\t                // search array\n\t\n\t                var search = function search(str, array) {\n\t                    for (var j = 0; j < array.length; j++) {\n\t                        if (array[j].match(str)) return j;\n\t                    }return -1;\n\t                };\n\t\n\t                ;\n\t\n\t                // load\n\t                this.col.chrom = search('Chrom', metadata.get('column_names'));\n\t                this.col.start = search('Pos', metadata.get('column_names'));\n\t                this.col.end = null;\n\t\n\t                // verify that metadata exists\n\t                if (this.col.chrom == -1 || this.col.start == -1) {\n\t                    console.log('TabularButtonTrackster : VCF-file metadata incomplete.');\n\t                    return;\n\t                }\n\t            }\n\t\n\t            // check\n\t            if (this.col.chrom === undefined) {\n\t                return;\n\t            }\n\t\n\t            // get dataset id\n\t            if (model.id) {\n\t                this.dataset_id = model.id;\n\t            } else {\n\t                console.log('TabularButtonTrackster : Dataset identification is missing.');\n\t                return;\n\t            }\n\t\n\t            // get url\n\t            if (model.get('url_viz')) {\n\t                this.url_viz = model.get('url_viz');\n\t            } else {\n\t                console.log('TabularButtonTrackster : Url for visualization controller is missing.');\n\t                return;\n\t            }\n\t\n\t            // get genome_build / database key\n\t            if (model.get('genome_build')) {\n\t                this.genome_build = model.get('genome_build');\n\t            }\n\t\n\t            // create the icon\n\t            var btn_viz = new mod_icon_btn.IconButtonView({\n\t                model: new mod_icon_btn.IconButton({\n\t                    title: 'Visualize',\n\t                    icon_class: 'chart_curve',\n\t                    id: 'btn_viz'\n\t                })\n\t            });\n\t\n\t            // set element\n\t            this.setElement(options.$el);\n\t\n\t            // add to element\n\t            this.$el.append(btn_viz.render().$el);\n\t\n\t            // hide the button\n\t            this.hide();\n\t        },\n\t\n\t        // backbone events\n\t        events: {\n\t            'mouseover tr': 'show',\n\t            'mouseleave': 'hide'\n\t        },\n\t\n\t        // show button\n\t        show: function show(e) {\n\t            // is numeric\n\t            function is_numeric(n) {\n\t                return !isNaN(parseFloat(n)) && isFinite(n);\n\t            };\n\t\n\t            // check\n\t            if (this.col.chrom === null) return;\n\t\n\t            // get selected data line\n\t            var row = $(e.target).parent();\n\t\n\t            // verify that location has been found\n\t            var chrom = row.children().eq(this.col.chrom).html();\n\t            var start = row.children().eq(this.col.start).html();\n\t\n\t            // end is optional\n\t            var end = this.col.end ? row.children().eq(this.col.end).html() : start;\n\t\n\t            // double check location\n\t            if (!chrom.match(\"^#\") && chrom !== \"\" && is_numeric(start)) {\n\t\n\t                // get target gene region\n\t                var btn_viz_pars = {\n\t                    dataset_id: this.dataset_id,\n\t                    gene_region: chrom + \":\" + start + \"-\" + end\n\t                };\n\t\n\t                // get button position\n\t                var offset = row.offset();\n\t                var left = offset.left - 10;\n\t                var top = offset.top - $(window).scrollTop() + 3;\n\t\n\t                // update css\n\t                $('#btn_viz').css({ 'position': 'fixed', 'top': top + 'px', 'left': left + 'px' });\n\t                $('#btn_viz').off('click');\n\t                $('#btn_viz').click(this.create_trackster_action(this.url_viz, btn_viz_pars, this.genome_build));\n\t\n\t                // show the button\n\t                $('#btn_viz').show();\n\t            } else {\n\t                // hide the button\n\t                $('#btn_viz').hide();\n\t            }\n\t        },\n\t\n\t        // hide button\n\t        hide: function hide() {\n\t            this.$el.find('#btn_viz').hide();\n\t        },\n\t\n\t        // create action\n\t        create_trackster_action: function create_trackster_action(vis_url, dataset_params, dbkey) {\n\t            // link this\n\t            var self = this;\n\t\n\t            // create function\n\t            return function () {\n\t                var listTracksParams = {};\n\t                if (dbkey) {\n\t                    listTracksParams['f-dbkey'] = dbkey;\n\t                }\n\t                $.ajax({\n\t                    url: vis_url + '/list_tracks?' + $.param(listTracksParams),\n\t                    dataType: 'html',\n\t                    error: function error() {\n\t                        // show error message\n\t                        self.modal.show({\n\t                            title: 'Something went wrong!',\n\t                            body: 'Unfortunately we could not add this dataset to the track browser. Please try again or contact us.',\n\t                            buttons: {\n\t                                'Cancel': function Cancel() {\n\t                                    self.modal.hide();\n\t                                }\n\t                            }\n\t                        });\n\t                    },\n\t                    success: function success(table_html) {\n\t                        self.modal.show({\n\t                            title: 'View Data in a New or Saved Visualization',\n\t                            buttons: {\n\t                                'Cancel': function Cancel() {\n\t                                    self.modal.hide();\n\t                                },\n\t                                'View in saved visualization': function ViewInSavedVisualization() {\n\t                                    // show modal with saved visualizations\n\t                                    self.modal.show({\n\t                                        title: 'Add Data to Saved Visualization',\n\t                                        body: table_html,\n\t                                        buttons: {\n\t                                            'Cancel': function Cancel() {\n\t                                                self.modal.hide();\n\t                                            },\n\t                                            'Add to visualization': function AddToVisualization() {\n\t                                                // hide\n\t                                                self.modal.hide();\n\t\n\t                                                // search selected fields\n\t                                                self.modal.$el.find('input[name=id]:checked').each(function () {\n\t                                                    // get visualization id\n\t                                                    var vis_id = $(this).val();\n\t                                                    dataset_params.id = vis_id;\n\t\n\t                                                    // add widget\n\t                                                    self.frame.add({\n\t                                                        title: 'Trackster',\n\t                                                        type: 'url',\n\t                                                        content: vis_url + '/trackster?' + $.param(dataset_params)\n\t                                                    });\n\t                                                });\n\t                                            }\n\t                                        }\n\t                                    });\n\t                                },\n\t                                'View in new visualization': function ViewInNewVisualization() {\n\t                                    // hide\n\t                                    self.modal.hide();\n\t\n\t                                    // add widget\n\t                                    self.frame.add({\n\t                                        title: 'Trackster',\n\t                                        type: 'url',\n\t                                        content: vis_url + '/trackster?' + $.param(dataset_params)\n\t                                    });\n\t                                }\n\t                            }\n\t                        });\n\t                    }\n\t                });\n\t                return false;\n\t            };\n\t        }\n\t    });\n\t\n\t    // -- Utility functions. --\n\t\n\t    /**\n\t     * Create a model, attach it to a view, render view, and attach it to a parent element.\n\t     */\n\t    var createModelAndView = function createModelAndView(model, view, model_config, parent_elt) {\n\t        // Create model, view.\n\t        var a_view = new view({\n\t            model: new model(model_config)\n\t        });\n\t\n\t        // Render view and add to parent element.\n\t        a_view.render();\n\t        if (parent_elt) {\n\t            parent_elt.append(a_view.$el);\n\t        }\n\t\n\t        return a_view;\n\t    };\n\t\n\t    /**\n\t     * Create a tabular dataset chunked view (and requisite tabular dataset model)\n\t     * and appends to parent_elt.\n\t     */\n\t    var createTabularDatasetChunkedView = function createTabularDatasetChunkedView(options) {\n\t        // If no model, create and set model from dataset config.\n\t        if (!options.model) {\n\t            options.model = new TabularDataset(options.dataset_config);\n\t        }\n\t\n\t        var parent_elt = options.parent_elt;\n\t        var embedded = options.embedded;\n\t\n\t        // Clean up options so that only needed options are passed to view.\n\t        delete options.embedded;\n\t        delete options.parent_elt;\n\t        delete options.dataset_config;\n\t\n\t        // Create and set up view.\n\t        var view = embedded ? new EmbeddedTabularDatasetChunkedView(options) : new TopLevelTabularDatasetChunkedView(options);\n\t        view.render();\n\t\n\t        if (parent_elt) {\n\t            parent_elt.append(view.$el);\n\t            // If we're sticking this in another element, once it's appended check\n\t            // to make sure we've filled enough space.\n\t            // Without this, the scroll elements don't work.\n\t            view.expand_to_container();\n\t        }\n\t\n\t        return view;\n\t    };\n\t\n\t    return {\n\t        Dataset: Dataset,\n\t        TabularDataset: TabularDataset,\n\t        DatasetCollection: DatasetCollection,\n\t        TabularDatasetChunkedView: TabularDatasetChunkedView,\n\t        createTabularDatasetChunkedView: createTabularDatasetChunkedView\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 12 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;'use strict';\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t\n\t    'use strict';\n\t    //==============================================================================\n\t    /** Map of possible HDA/collection/job states to their string equivalents.\n\t     *      A port of galaxy.model.Dataset.states.\n\t     */\n\t\n\t    var STATES = {\n\t        // NOT ready states\n\t        /** is uploading and not ready */\n\t        UPLOAD: 'upload',\n\t        /** the job that will produce the dataset queued in the runner */\n\t        QUEUED: 'queued',\n\t        /** the job that will produce the dataset is running */\n\t        RUNNING: 'running',\n\t        /** metadata for the dataset is being discovered/set */\n\t        SETTING_METADATA: 'setting_metadata',\n\t\n\t        // ready states\n\t        /** was created without a tool */\n\t        NEW: 'new',\n\t        /** has no data */\n\t        EMPTY: 'empty',\n\t        /** has successfully completed running */\n\t        OK: 'ok',\n\t\n\t        /** the job that will produce the dataset paused */\n\t        PAUSED: 'paused',\n\t        /** metadata discovery/setting failed or errored (but otherwise ok) */\n\t        FAILED_METADATA: 'failed_metadata',\n\t        //TODO: not in trans.app.model.Dataset.states - is in database\n\t        /** not accessible to the current user (i.e. due to permissions) */\n\t        NOT_VIEWABLE: 'noPermission',\n\t        /** deleted while uploading */\n\t        DISCARDED: 'discarded',\n\t        /** the tool producing this dataset failed */\n\t        ERROR: 'error'\n\t    };\n\t\n\t    STATES.READY_STATES = [STATES.OK, STATES.EMPTY, STATES.PAUSED, STATES.FAILED_METADATA, STATES.NOT_VIEWABLE, STATES.DISCARDED, STATES.ERROR];\n\t\n\t    STATES.NOT_READY_STATES = [STATES.UPLOAD, STATES.QUEUED, STATES.RUNNING, STATES.SETTING_METADATA, STATES.NEW];\n\t\n\t    //==============================================================================\n\t    return STATES;\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n/* 13 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $) {'use strict';\n\t\n\t/** This class contains all button views.\n\t*/\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils) {\n\t    /** This renders the default button which is used e.g. at the bottom of the upload modal.\n\t    */\n\t    var ButtonBase = Backbone.View.extend({\n\t        initialize: function initialize(options) {\n\t            this.options = Utils.merge(options, {\n\t                id: Utils.uid(),\n\t                title: '',\n\t                floating: 'right',\n\t                icon: '',\n\t                cls: 'ui-button btn btn-default',\n\t                cls_wait: 'btn btn-info'\n\t            });\n\t            this.setElement(this._template(this.options));\n\t            var self = this;\n\t            $(this.el).on('click', function () {\n\t                $('.tooltip').hide();\n\t                if (options.onclick && !self.disabled) {\n\t                    options.onclick();\n\t                }\n\t            });\n\t            $(this.el).tooltip({ title: options.tooltip, placement: 'bottom' });\n\t        },\n\t\n\t        // disable\n\t        disable: function disable() {\n\t            this.$el.addClass('disabled');\n\t            this.disabled = true;\n\t        },\n\t\n\t        // enable\n\t        enable: function enable() {\n\t            this.$el.removeClass('disabled');\n\t            this.disabled = false;\n\t        },\n\t\n\t        // show spinner\n\t        wait: function wait() {\n\t            this.$el.removeClass(this.options.cls).addClass(this.options.cls_wait).prop('disabled', true);\n\t            this.$('.icon').removeClass(this.options.icon).addClass('fa-spinner fa-spin');\n\t            this.$('.title').html('Sending...');\n\t        },\n\t\n\t        // hide spinner\n\t        unwait: function unwait() {\n\t            this.$el.removeClass(this.options.cls_wait).addClass(this.options.cls).prop('disabled', false);\n\t            this.$('.icon').removeClass('fa-spinner fa-spin').addClass(this.options.icon);\n\t            this.$('.title').html(this.options.title);\n\t        },\n\t\n\t        // template\n\t        _template: function _template(options) {\n\t            var str = '<button id=\"' + options.id + '\" type=\"submit\" style=\"float: ' + options.floating + ';\" type=\"button\" class=\"' + options.cls + '\">';\n\t            if (options.icon) {\n\t                str += '<i class=\"icon fa ' + options.icon + '\"/>&nbsp;';\n\t            }\n\t            str += '<span class=\"title\">' + options.title + '</span>' + '</button>';\n\t            return str;\n\t        }\n\t    });\n\t\n\t    /** This button allows the right-click/open-in-new-tab feature, its used e.g. for panel buttons.\n\t    */\n\t    var ButtonLink = ButtonBase.extend({\n\t        initialize: function initialize(options) {\n\t            ButtonBase.prototype.initialize.call(this, options);\n\t        },\n\t        _template: function _template(options) {\n\t            return '<a id=\"' + options.id + '\" class=\"' + options.cls + '\" href=\"' + (options.href || 'javascript:void(0)') + '\"' + ' title=\"' + options.title + '\" target=\"' + (options.target || '_top') + '\">' + '<span class=\"' + options.icon + '\"/>' + '</a>';\n\t        }\n\t    });\n\t\n\t    /** The check button is used in the tool form and allows to distinguish between multiple states e.g. all, partially and nothing selected.\n\t    */\n\t    var ButtonCheck = Backbone.View.extend({\n\t        initialize: function initialize(options) {\n\t            // configure options\n\t            this.options = Utils.merge(options, {\n\t                title: 'Select/Unselect all',\n\t                icons: ['fa fa-square-o', 'fa fa-minus-square-o', 'fa fa-check-square-o'],\n\t                value: 0\n\t            });\n\t\n\t            // create new element\n\t            this.setElement(this._template());\n\t            this.$title = this.$('.title');\n\t            this.$icon = this.$('.icon');\n\t\n\t            // set initial value\n\t            this.value(this.options.value);\n\t\n\t            // set title\n\t            this.$title.html(this.options.title);\n\t\n\t            // add event handler\n\t            var self = this;\n\t            this.$el.on('click', function () {\n\t                self.current = self.current === 0 && 2 || 0;\n\t                self.value(self.current);\n\t                self.options.onclick && self.options.onclick();\n\t            });\n\t        },\n\t\n\t        /* Sets a new value and/or returns the current value.\n\t        * @param{Integer}   new_val - Set a new value 0=unchecked, 1=partial and 2=checked.\n\t        * OR:\n\t        * @param{Integer}   new_val - Number of selected options.\n\t        * @param{Integer}   total   - Total number of available options.\n\t        */\n\t        value: function value(new_val, total) {\n\t            if (new_val !== undefined) {\n\t                if (total) {\n\t                    if (new_val !== 0) {\n\t                        new_val = new_val !== total && 1 || 2;\n\t                    }\n\t                }\n\t                this.current = new_val;\n\t                this.$icon.removeClass().addClass('icon').addClass(this.options.icons[new_val]);\n\t                this.options.onchange && this.options.onchange(new_val);\n\t            }\n\t            return this.current;\n\t        },\n\t\n\t        /** Template containing the check button and the title\n\t        */\n\t        _template: function _template() {\n\t            return '<div class=\"ui-button-check\" >' + '<span class=\"icon\"/>' + '<span class=\"title\"/>' + '</div>';\n\t        }\n\t    });\n\t\n\t    /** This renders a differently styled, more compact button version.\n\t        TODO: Consolidate with icon-button.js and/or button-default.js.\n\t    */\n\t    var ButtonIcon = Backbone.View.extend({\n\t        initialize: function initialize(options) {\n\t            // get options\n\t            this.options = Utils.merge(options, {\n\t                id: Utils.uid(),\n\t                title: '',\n\t                floating: 'right',\n\t                cls: 'ui-button-icon',\n\t                icon: '',\n\t                tooltip: '',\n\t                onclick: null\n\t            });\n\t\n\t            // create new element\n\t            this.setElement(this._template(this.options));\n\t\n\t            // link button element\n\t            this.$button = this.$el.find('.button');\n\t\n\t            // add event\n\t            var self = this;\n\t            $(this.el).on('click', function () {\n\t                // hide all tooltips\n\t                $('.tooltip').hide();\n\t\n\t                // execute onclick callback\n\t                if (options.onclick && !self.disabled) {\n\t                    options.onclick();\n\t                }\n\t            });\n\t\n\t            // add tooltip\n\t            this.$button.tooltip({ title: options.tooltip, placement: 'bottom' });\n\t        },\n\t\n\t        // disable\n\t        disable: function disable() {\n\t            this.$button.addClass('disabled');\n\t            this.disabled = true;\n\t        },\n\t\n\t        // enable\n\t        enable: function enable() {\n\t            this.$button.removeClass('disabled');\n\t            this.disabled = false;\n\t        },\n\t\n\t        // change icon\n\t        setIcon: function setIcon(icon_cls) {\n\t            this.$('i').removeClass(this.options.icon).addClass(icon_cls);\n\t            this.options.icon = icon_cls;\n\t        },\n\t\n\t        // template\n\t        _template: function _template(options) {\n\t            // width\n\t            var width = '';\n\t            if (options.title) {\n\t                width = 'width: auto;';\n\t            }\n\t\n\t            // string\n\t            var str = '<div id=\"' + options.id + '\" style=\"float: ' + options.floating + '; ' + width + '\" class=\"' + options.cls + '\">' + '<div class=\"button\">';\n\t            if (options.title) {\n\t                str += '<i class=\"icon fa ' + options.icon + '\"/>&nbsp;' + '<span class=\"title\">' + options.title + '</span>';\n\t            } else {\n\t                str += '<i class=\"icon fa ' + options.icon + '\"/>';\n\t            }\n\t            str += '</div>' + '</div>';\n\t            return str;\n\t        }\n\t    });\n\t\n\t    /** This class creates a button with dropdown menu. It extends the functionality of the Ui.ButtonIcon class.\n\t        TODO: Consolidate class, use common base class\n\t    */\n\t    var ButtonMenu = Backbone.View.extend({\n\t        // optional sub menu\n\t        $menu: null,\n\t\n\t        // initialize\n\t        initialize: function initialize(options) {\n\t            // get options\n\t            this.options = Utils.merge(options, {\n\t                // same as Ui.ButtonIcon\n\t                id: '',\n\t                title: '',\n\t                floating: 'right',\n\t                pull: 'right',\n\t                icon: null,\n\t                onclick: null,\n\t                cls: 'ui-button-icon ui-button-menu',\n\t                tooltip: '',\n\t\n\t                // additional options\n\t                target: '',\n\t                href: '',\n\t                onunload: null,\n\t                visible: true,\n\t                tag: ''\n\t            });\n\t\n\t            // add template for tab\n\t            this.setElement($(this._template(this.options)));\n\t\n\t            // find root\n\t            var $root = $(this.el).find('.root');\n\t\n\t            // link head\n\t            var self = this;\n\t            $root.on('click', function (e) {\n\t                // hide all tooltips\n\t                $('.tooltip').hide();\n\t\n\t                // prevent default\n\t                e.preventDefault();\n\t\n\t                // add click event\n\t                if (self.options.onclick) {\n\t                    self.options.onclick();\n\t                }\n\t            });\n\t\n\t            // visiblity\n\t            if (!this.options.visible) this.hide();\n\t\n\t            // add tooltip\n\t            $root.tooltip({ title: options.tooltip, placement: 'bottom' });\n\t        },\n\t\n\t        // show\n\t        show: function show() {\n\t            $(this.el).show();\n\t        },\n\t\n\t        // hide\n\t        hide: function hide() {\n\t            $(this.el).hide();\n\t        },\n\t\n\t        // add menu item\n\t        addMenu: function addMenu(options) {\n\t            // menu option defaults\n\t            var menuOptions = {\n\t                title: '',\n\t                target: '',\n\t                href: '',\n\t                onclick: null,\n\t                divider: false,\n\t                icon: null,\n\t                cls: 'button-menu btn-group'\n\t            };\n\t\n\t            // get options\n\t            menuOptions = Utils.merge(options, menuOptions);\n\t\n\t            // check if submenu element is available\n\t            if (!this.$menu) {\n\t                // insert submenu element into root\n\t                $(this.el).append(this._templateMenu());\n\t\n\t                // update element link\n\t                this.$menu = $(this.el).find('.menu');\n\t            }\n\t\n\t            // create\n\t            var $item = $(this._templateMenuItem(menuOptions));\n\t\n\t            // add events\n\t            $item.on('click', function (e) {\n\t                if (menuOptions.onclick) {\n\t                    e.preventDefault();\n\t                    menuOptions.onclick();\n\t                }\n\t            });\n\t\n\t            // append menu\n\t            this.$menu.append($item);\n\t\n\t            // append divider\n\t            if (menuOptions.divider) {\n\t                this.$menu.append($(this._templateDivider()));\n\t            }\n\t        },\n\t\n\t        // fill template header\n\t        _templateMenuItem: function _templateMenuItem(options) {\n\t            var tmpl = '<li>' + '<a class=\"dropdown-item\" href=\"' + options.href + '\" target=\"' + options.target + '\" ';\n\t            if (options.download) {\n\t                tmpl += 'download=\"' + options.download + '\"';\n\t            }\n\t            tmpl += '>';\n\t            if (options.icon) {\n\t                tmpl += '<i class=\"fa ' + options.icon + '\"/>';\n\t            }\n\t            tmpl += ' ' + options.title + '</a>' + '</li>';\n\t            return tmpl;\n\t        },\n\t\n\t        // fill template header\n\t        _templateMenu: function _templateMenu() {\n\t            return '<ul class=\"menu dropdown-menu pull-' + this.options.pull + '\" role=\"menu\"/>';\n\t        },\n\t\n\t        _templateDivider: function _templateDivider() {\n\t            return '<li class=\"divider\"/>';\n\t        },\n\t\n\t        // element\n\t        _template: function _template(options) {\n\t            // TODO: width/margin should be set in css\n\t            var width = '';\n\t            var margin = '';\n\t            if (options.title) {\n\t                width = 'width: auto;';\n\t            } else {\n\t                margin = 'margin: 0px;';\n\t            }\n\t            var str = '<div id=\"' + options.id + '\" style=\"float: ' + options.floating + '; ' + width + '\" class=\"dropdown ' + options.cls + '\">' + '<div class=\"root button dropdown-toggle\" data-toggle=\"dropdown\" style=\"' + margin + '\">' + '<i class=\"icon fa ' + options.icon + '\"/>';\n\t            if (options.title) {\n\t                str += '&nbsp;<span class=\"title\">' + options.title + '</span>';\n\t            }\n\t            str += '</div>' + '</div>';\n\t            return str;\n\t        }\n\t    });\n\t\n\t    return {\n\t        ButtonDefault: ButtonBase,\n\t        ButtonLink: ButtonLink,\n\t        ButtonIcon: ButtonIcon,\n\t        ButtonCheck: ButtonCheck,\n\t        ButtonMenu: ButtonMenu\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1)))\n\n/***/ },\n/* 14 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $) {'use strict';\n\t\n\t// dependencies\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils) {\n\t\n\t    /**\n\t     *  This class creates a ui table element.\n\t     */\n\t    var View = Backbone.View.extend({\n\t        // current row\n\t        row: null,\n\t\n\t        // count rows\n\t        row_count: 0,\n\t\n\t        // defaults options\n\t        optionsDefault: {\n\t            content: 'No content available.',\n\t            onchange: null,\n\t            ondblclick: null,\n\t            onconfirm: null,\n\t            cls: 'ui-table',\n\t            cls_tr: ''\n\t        },\n\t\n\t        // events\n\t        events: {\n\t            'click': '_onclick',\n\t            'dblclick': '_ondblclick'\n\t        },\n\t\n\t        // initialize\n\t        initialize: function initialize(options) {\n\t            // configure options\n\t            this.options = Utils.merge(options, this.optionsDefault);\n\t\n\t            // create new element\n\t            var $el = $(this._template(this.options));\n\t\n\t            // link sub-elements\n\t            this.$thead = $el.find('thead');\n\t            this.$tbody = $el.find('tbody');\n\t            this.$tmessage = $el.find('tmessage');\n\t\n\t            // set element\n\t            this.setElement($el);\n\t\n\t            // initialize row\n\t            this.row = this._row();\n\t        },\n\t\n\t        // add header cell\n\t        addHeader: function addHeader($el) {\n\t            var wrapper = $('<th></th>');\n\t            wrapper.append($el);\n\t            this.row.append(wrapper);\n\t        },\n\t\n\t        // header\n\t        appendHeader: function appendHeader() {\n\t            // append header row\n\t            this.$thead.append(this.row);\n\t\n\t            // row\n\t            this.row = $('<tr></tr>');\n\t        },\n\t\n\t        // add row cell\n\t        add: function add($el, width, align) {\n\t            var wrapper = $('<td></td>');\n\t            if (width) {\n\t                wrapper.css('width', width);\n\t            }\n\t            if (align) {\n\t                wrapper.css('text-align', align);\n\t            }\n\t            wrapper.append($el);\n\t            this.row.append(wrapper);\n\t        },\n\t\n\t        // append\n\t        append: function append(id, fade) {\n\t            this._commit(id, fade, false);\n\t        },\n\t\n\t        // prepend\n\t        prepend: function prepend(id, fade) {\n\t            this._commit(id, fade, true);\n\t        },\n\t\n\t        // get element\n\t        get: function get(id) {\n\t            return this.$el.find('#' + id);\n\t        },\n\t\n\t        // delete\n\t        del: function del(id) {\n\t            var item = this.$tbody.find('#' + id);\n\t            if (item.length > 0) {\n\t                item.remove();\n\t                this.row_count--;\n\t                this._refresh();\n\t            }\n\t        },\n\t\n\t        // delete all\n\t        delAll: function delAll() {\n\t            this.$tbody.empty();\n\t            this.row_count = 0;\n\t            this._refresh();\n\t        },\n\t\n\t        // value\n\t        value: function value(new_value) {\n\t            // get current id/value\n\t            this.before = this.$tbody.find('.current').attr('id');\n\t\n\t            // check if new_value is defined\n\t            if (new_value !== undefined) {\n\t                this.$tbody.find('tr').removeClass('current');\n\t                if (new_value) {\n\t                    this.$tbody.find('#' + new_value).addClass('current');\n\t                }\n\t            }\n\t\n\t            // get current id/value\n\t            var after = this.$tbody.find('.current').attr('id');\n\t            if (after === undefined) {\n\t                return null;\n\t            } else {\n\t                // fire onchange\n\t                if (after != this.before && this.options.onchange) {\n\t                    this.options.onchange(new_value);\n\t                }\n\t\n\t                // return current value\n\t                return after;\n\t            }\n\t        },\n\t\n\t        // size\n\t        size: function size() {\n\t            return this.$tbody.find('tr').length;\n\t        },\n\t\n\t        // commit\n\t        _commit: function _commit(id, fade, prepend) {\n\t            // remove previous item with same id\n\t            this.del(id);\n\t\n\t            // add\n\t            this.row.attr('id', id);\n\t\n\t            // add row\n\t            if (prepend) {\n\t                this.$tbody.prepend(this.row);\n\t            } else {\n\t                this.$tbody.append(this.row);\n\t            }\n\t\n\t            // fade mode\n\t            if (fade) {\n\t                this.row.hide();\n\t                this.row.fadeIn();\n\t            }\n\t\n\t            // row\n\t            this.row = this._row();\n\t\n\t            // row count\n\t            this.row_count++;\n\t            this._refresh();\n\t        },\n\t\n\t        // create new row\n\t        _row: function _row() {\n\t            return $('<tr class=\"' + this.options.cls_tr + '\"></tr>');\n\t        },\n\t\n\t        // onclick\n\t        _onclick: function _onclick(e) {\n\t            // get values\n\t            var old_value = this.value();\n\t            var new_value = $(e.target).closest('tr').attr('id');\n\t            if (new_value != '') {\n\t                // check equality\n\t                if (new_value && old_value != new_value) {\n\t                    if (this.options.onconfirm) {\n\t                        this.options.onconfirm(new_value);\n\t                    } else {\n\t                        this.value(new_value);\n\t                    }\n\t                }\n\t            }\n\t        },\n\t\n\t        // ondblclick\n\t        _ondblclick: function _ondblclick(e) {\n\t            var value = this.value();\n\t            if (value && this.options.ondblclick) {\n\t                this.options.ondblclick(value);\n\t            }\n\t        },\n\t\n\t        // refresh\n\t        _refresh: function _refresh() {\n\t            if (this.row_count == 0) {\n\t                this.$tmessage.show();\n\t            } else {\n\t                this.$tmessage.hide();\n\t            }\n\t        },\n\t\n\t        // load html template\n\t        _template: function _template(options) {\n\t            return '<div>' + '<table class=\"' + options.cls + '\">' + '<thead></thead>' + '<tbody></tbody>' + '</table>' + '<tmessage>' + options.content + '</tmessage>' + '<div>';\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1)))\n\n/***/ },\n/* 15 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    //jquery\n\t    //backbone\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t    //=============================================================================\n\t    /**\n\t     * backbone model for icon buttons\n\t     */\n\t    var IconButton = Backbone.Model.extend({\n\t        defaults: {\n\t            title: \"\",\n\t            icon_class: \"\",\n\t            on_click: null,\n\t            menu_options: null,\n\t            is_menu_button: true,\n\t            id: null,\n\t            href: null,\n\t            target: null,\n\t            enabled: true,\n\t            visible: true,\n\t            tooltip_config: {}\n\t        }\n\t    });\n\t\n\t    /**\n\t     *  backbone view for icon buttons\n\t     */\n\t    var IconButtonView = Backbone.View.extend({\n\t\n\t        initialize: function initialize() {\n\t            // better rendering this way\n\t            this.model.attributes.tooltip_config = { placement: 'bottom' };\n\t            this.model.bind('change', this.render, this);\n\t        },\n\t\n\t        render: function render() {\n\t            // hide tooltip\n\t            this.$el.tooltip('hide');\n\t\n\t            var new_elem = this.template(this.model.toJSON());\n\t            // configure tooltip\n\t            new_elem.tooltip(this.model.get('tooltip_config'));\n\t            this.$el.replaceWith(new_elem);\n\t            this.setElement(new_elem);\n\t            return this;\n\t        },\n\t\n\t        events: {\n\t            'click': 'click'\n\t        },\n\t\n\t        click: function click(event) {\n\t            // if on_click pass to that function\n\t            if (_.isFunction(this.model.get('on_click'))) {\n\t                this.model.get('on_click')(event);\n\t                return false;\n\t            }\n\t            // otherwise, bubble up ( to href or whatever )\n\t            return true;\n\t        },\n\t\n\t        // generate html element\n\t        template: function template(options) {\n\t            var buffer = 'title=\"' + options.title + '\" class=\"icon-button';\n\t\n\t            if (options.is_menu_button) {\n\t                buffer += ' menu-button';\n\t            }\n\t\n\t            buffer += ' ' + options.icon_class;\n\t\n\t            if (!options.enabled) {\n\t                buffer += '_disabled';\n\t            }\n\t\n\t            // close class tag\n\t            buffer += '\"';\n\t\n\t            if (options.id) {\n\t                buffer += ' id=\"' + options.id + '\"';\n\t            }\n\t\n\t            buffer += ' href=\"' + options.href + '\"';\n\t            // add target for href\n\t            if (options.target) {\n\t                buffer += ' target=\"' + options.target + '\"';\n\t            }\n\t            // set visibility\n\t            if (!options.visible) {\n\t                buffer += ' style=\"display: none;\"';\n\t            }\n\t\n\t            // enabled/disabled\n\t            if (options.enabled) {\n\t                buffer = '<a ' + buffer + '/>';\n\t            } else {\n\t                buffer = '<span ' + buffer + '/>';\n\t            }\n\t\n\t            // return element\n\t            return $(buffer);\n\t        }\n\t    });\n\t\n\t    // define collection\n\t    var IconButtonCollection = Backbone.Collection.extend({\n\t        model: IconButton\n\t    });\n\t\n\t    /**\n\t     * menu with multiple icon buttons\n\t     * views are not needed nor used for individual buttons\n\t     */\n\t    var IconButtonMenuView = Backbone.View.extend({\n\t\n\t        tagName: 'div',\n\t\n\t        initialize: function initialize() {\n\t            this.render();\n\t        },\n\t\n\t        render: function render() {\n\t            // initialize icon buttons\n\t            var self = this;\n\t            this.collection.each(function (button) {\n\t                // create and add icon button to menu\n\t                var elt = $('<a/>').attr('href', 'javascript:void(0)').attr('title', button.attributes.title).addClass('icon-button menu-button').addClass(button.attributes.icon_class).appendTo(self.$el).click(button.attributes.on_click);\n\t\n\t                // configure tooltip\n\t                if (button.attributes.tooltip_config) {\n\t                    elt.tooltip(button.attributes.tooltip_config);\n\t                }\n\t\n\t                // add popup menu to icon\n\t                var menu_options = button.get('options');\n\t                if (menu_options) {\n\t                    make_popupmenu(elt, menu_options);\n\t                }\n\t            });\n\t\n\t            // return\n\t            return this;\n\t        }\n\t    });\n\t\n\t    /**\n\t     * Returns an IconButtonMenuView for the provided configuration.\n\t     * Configuration is a list of dictionaries where each dictionary\n\t     * defines an icon button. Each dictionary must have the following\n\t     * elements: icon_class, title, and on_click.\n\t     */\n\t    var create_icon_buttons_menu = function create_icon_buttons_menu(config, global_config) {\n\t        // initialize global configuration\n\t        if (!global_config) global_config = {};\n\t\n\t        // create and initialize menu\n\t        var buttons = new IconButtonCollection(_.map(config, function (button_config) {\n\t            return new IconButton(_.extend(button_config, global_config));\n\t        }));\n\t\n\t        // return menu\n\t        return new IconButtonMenuView({ collection: buttons });\n\t    };\n\t\n\t    //=============================================================================\n\t    return {\n\t        IconButton: IconButton,\n\t        IconButtonView: IconButtonView,\n\t        IconButtonCollection: IconButtonCollection,\n\t        IconButtonMenuView: IconButtonMenuView,\n\t        create_icon_buttons_menu: create_icon_buttons_menu\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 16 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {'use strict';\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t\n\t    /** Frame view */\n\t    var FrameView = Backbone.View.extend({\n\t        initialize: function initialize(options) {\n\t            var self = this;\n\t            this.model = options && options.model || new Backbone.Model(options);\n\t            this.setElement($('<div/>').addClass('corner frame'));\n\t            this.$el.append($('<div/>').addClass('f-header corner').append($('<div/>').addClass('f-title')).append($('<div/>').addClass('f-icon f-close fa fa-close').tooltip({ title: 'Close', placement: 'bottom' }))).append($('<div/>').addClass('f-content')).append($('<div/>').addClass('f-resize f-icon corner fa fa-expand').tooltip({ title: 'Resize' })).append($('<div/>').addClass('f-cover'));\n\t            this.$header = this.$('.f-header');\n\t            this.$title = this.$('.f-title');\n\t            this.$content = this.$('.f-content');\n\t            this.render();\n\t            this.listenTo(this.model, 'change', this.render, this);\n\t        },\n\t\n\t        render: function render() {\n\t            var self = this;\n\t            var options = this.model.attributes;\n\t            this.$title.html(options.title || '');\n\t            this.$header.find('.f-icon-left').remove();\n\t            _.each(options.menu, function (option) {\n\t                var $option = $('<div/>').addClass('f-icon-left').addClass(option.icon);\n\t                if (_.isFunction(option.disabled) && option.disabled()) {\n\t                    $option.attr('disabled', true);\n\t                } else {\n\t                    $option.on('click', function () {\n\t                        option.onclick(self);\n\t                    }).tooltip({ title: option.tooltip, placement: 'bottom' });\n\t                }\n\t                self.$header.append($option);\n\t            });\n\t            if (options.url) {\n\t                this.$content.html($('<iframe/>').addClass('f-iframe').attr('scrolling', 'auto').attr('src', options.url + (options.url.indexOf('?') === -1 ? '?' : '&') + 'widget=True'));\n\t            } else if (options.content) {\n\t                _.isFunction(options.content) ? options.content(self.$content) : self.$content.html(options.content);\n\t            }\n\t        }\n\t    });\n\t\n\t    /** Scratchbook viewer */\n\t    var View = Backbone.View.extend({\n\t        defaultOptions: {\n\t            frame: { // default frame size in cells\n\t                cols: 6,\n\t                rows: 3\n\t            },\n\t            rows: 1000, // maximum number of rows\n\t            cell: 130, // cell size in px\n\t            margin: 5, // margin between frames\n\t            scroll: 5, // scroll speed\n\t            top_min: 40, // top margin\n\t            frame_max: 9, // maximum number of frames\n\t            visible: true },\n\t\n\t        cols: 0, // number of columns\n\t        top: 0, // scroll/element top\n\t        top_max: 0, // viewport scrolling state\n\t        frame_z: 0, // frame z-index\n\t        frame_counter: 0, // frame counter\n\t        frame_uid: 0, // unique frame id counter\n\t        frame_list: {}, // list of all frames\n\t        frame_shadow: null, // frame shown as placeholder when moving active frames\n\t        visible: false, // flag indicating if scratchbook viewer is visible or not\n\t        event: {}, // dictionary keeping track of current event\n\t\n\t        initialize: function initialize(options) {\n\t            var self = this;\n\t            this.options = _.defaults(options || {}, this.defaultOptions);\n\t            this.visible = this.options.visible;\n\t            this.top = this.top_max = this.options.top_min;\n\t            this.setElement($('<div/>').addClass('galaxy-frame').append($('<div/>').addClass('frame-background')).append($('<div/>').addClass('frame-menu frame-scroll-up fa fa-chevron-up fa-2x')).append($('<div/>').addClass('frame-menu frame-scroll-down fa fa-chevron-down fa-2x')));\n\t\n\t            // initialize shadow to guiding drag/resize events\n\t            this.frame_shadow = new Backbone.View({ el: $('<div/>').addClass('corner frame-shadow') });\n\t            this.$el.append(this.frame_shadow.$el);\n\t            this._frameInit(this.frame_shadow, '#frame-shadow');\n\t            this._frameResize(this.frame_shadow, { width: 0, height: 0 });\n\t            this.frame_list['#frame-shadow'] = this.frame_shadow;\n\t\n\t            // initialize panel\n\t            this.visible ? this.show() : this.hide();\n\t            this._panelRefresh();\n\t            $(window).resize(function () {\n\t                self.visible && self._panelRefresh();\n\t            });\n\t        },\n\t\n\t        /** Render */\n\t        render: function render() {\n\t            this.$('.frame-scroll-up')[this.top != this.options.top_min && 'show' || 'hide']();\n\t            this.$('.frame-scroll-down')[this.top != this.top_max && 'show' || 'hide']();\n\t        },\n\t\n\t        /**\n\t         * Adds and displays a new frame.\n\t         *\n\t         * options:\n\t         *  url     : loaded into an iframe\n\t         *  content : content is treated as a function or raw HTML, function is passed a single\n\t         *              argument that is the frame's content DOM element\n\t         */\n\t        add: function add(options) {\n\t            if (this.frame_counter >= this.options.frame_max) {\n\t                Galaxy.modal.show({\n\t                    title: 'Warning',\n\t                    body: 'You have reached the maximum number of allowed frames (' + this.options.frame_max + ').',\n\t                    buttons: { 'Close': function Close() {\n\t                            Galaxy.modal.hide();\n\t                        } }\n\t                });\n\t            } else {\n\t                var frame_id = '#frame-' + this.frame_uid++;\n\t                if ($(frame_id).length !== 0) {\n\t                    Galaxy.modal.show({\n\t                        title: 'Error',\n\t                        body: 'This frame already exists. This page might contain multiple frame managers.',\n\t                        buttons: { 'Close': function Close() {\n\t                                Galaxy.modal.hide();\n\t                            } }\n\t                    });\n\t                } else {\n\t                    // initialize new frame elements\n\t                    this.top = this.options.top_min;\n\t                    var frame = new FrameView(options);\n\t                    this.$el.append(frame.$el);\n\t\n\t                    // set dimensions\n\t                    options.width = this._toPixelCoord('width', this.options.frame.cols);\n\t                    options.height = this._toPixelCoord('height', this.options.frame.rows);\n\t\n\t                    // set default z-index and add to ui and frame list\n\t                    this.frame_z = parseInt(frame.$el.css('z-index'));\n\t                    this.frame_list[frame_id] = frame;\n\t                    this.frame_counter++;\n\t                    this._frameInit(frame, frame_id);\n\t                    this._frameResize(frame, { width: options.width, height: options.height });\n\t                    this._frameInsert(frame, { top: 0, left: 0 }, true);\n\t                    !this.visible && this.show();\n\t                    this.trigger('add');\n\t                }\n\t            }\n\t        },\n\t\n\t        /** Remove a frame */\n\t        del: function del(frame) {\n\t            var self = this;\n\t            var $frame = frame.$el;\n\t            $frame.fadeOut('fast', function () {\n\t                $frame.remove();\n\t                delete self.frame_list[frame.id];\n\t                self.frame_counter--;\n\t                self._panelRefresh(true);\n\t                self._panelAnimationComplete();\n\t                self.trigger('remove');\n\t            });\n\t        },\n\t\n\t        /** Show panel */\n\t        show: function show() {\n\t            this.visible = true;\n\t            this.$el.fadeIn('fast');\n\t            this.trigger('show');\n\t        },\n\t\n\t        /** Hide panel */\n\t        hide: function hide() {\n\t            if (!this.event.type) {\n\t                this.visible = false;\n\t                this.$el.fadeOut('fast', function () {\n\t                    $(this).hide();\n\t                });\n\t                this.trigger('hide');\n\t            }\n\t        },\n\t\n\t        /** Returns the number of frames */\n\t        length: function length() {\n\t            return this.frame_counter;\n\t        },\n\t\n\t        /*\n\t            EVENT HANDLING\n\t        */\n\t        events: {\n\t            // global frame events\n\t            'mousemove': '_eventFrameMouseMove',\n\t            'mouseup': '_eventFrameMouseUp',\n\t            'mouseleave': '_eventFrameMouseUp',\n\t            'mousewheel': '_eventPanelScroll',\n\t            'DOMMouseScroll': '_eventPanelScroll',\n\t\n\t            // events fixed to elements\n\t            'mousedown .frame': '_eventFrameMouseDown',\n\t            'mousedown .frame-background': '_eventHide',\n\t            'mousedown .frame-scroll-up': '_eventPanelScroll_up',\n\t            'mousedown .frame-scroll-down': '_eventPanelScroll_down',\n\t            'mousedown .f-close': '_eventFrameClose'\n\t        },\n\t\n\t        /** Start drag/resize event */\n\t        _eventFrameMouseDown: function _eventFrameMouseDown(e) {\n\t            $('.tooltip').hide();\n\t            if (!this.event.type) {\n\t                if ($(e.target).hasClass('f-header') || $(e.target).hasClass('f-title')) {\n\t                    this.event.type = 'drag';\n\t                }\n\t                if ($(e.target).hasClass('f-resize')) {\n\t                    this.event.type = 'resize';\n\t                }\n\t                if (this.event.type) {\n\t                    e.preventDefault();\n\t                    this.event.target = this._frameIdentify(e.target);\n\t                    this.event.xy = {\n\t                        x: e.originalEvent.pageX,\n\t                        y: e.originalEvent.pageY\n\t                    };\n\t                    this._frameDragStart(this.event.target);\n\t                }\n\t            }\n\t        },\n\t\n\t        /** Processes drag/resize events */\n\t        _eventFrameMouseMove: function _eventFrameMouseMove(e) {\n\t            if (this.event.type) {\n\t                // get mouse motion and delta\n\t                var event_xy_new = {\n\t                    x: e.originalEvent.pageX,\n\t                    y: e.originalEvent.pageY\n\t                };\n\t                var event_xy_delta = {\n\t                    x: event_xy_new.x - this.event.xy.x,\n\t                    y: event_xy_new.y - this.event.xy.y\n\t                };\n\t                this.event.xy = event_xy_new;\n\t\n\t                // get current screen position and size of frame\n\t                var p = this._frameScreen(this.event.target);\n\t\n\t                // drag/resize event\n\t                if (this.event.type == 'resize') {\n\t                    p.width += event_xy_delta.x;\n\t                    p.height += event_xy_delta.y;\n\t                    var min_dim = this.options.cell - this.options.margin - 1;\n\t                    p.width = Math.max(p.width, min_dim);\n\t                    p.height = Math.max(p.height, min_dim);\n\t                    this._frameResize(this.event.target, p);\n\t                    p.width = this._toGridCoord('width', p.width) + 1;\n\t                    p.height = this._toGridCoord('height', p.height) + 1;\n\t                    p.width = this._toPixelCoord('width', p.width);\n\t                    p.height = this._toPixelCoord('height', p.height);\n\t                    this._frameResize(this.frame_shadow, p);\n\t                    this._frameInsert(this.frame_shadow, {\n\t                        top: this._toGridCoord('top', p.top),\n\t                        left: this._toGridCoord('left', p.left)\n\t                    });\n\t                } else if (this.event.type == 'drag') {\n\t                    p.left += event_xy_delta.x;\n\t                    p.top += event_xy_delta.y;\n\t                    this._frameOffset(this.event.target, p);\n\t                    var l = {\n\t                        top: this._toGridCoord('top', p.top),\n\t                        left: this._toGridCoord('left', p.left)\n\t                    };\n\t                    l.left !== 0 && l.left++;\n\t                    this._frameInsert(this.frame_shadow, l);\n\t                }\n\t            }\n\t        },\n\t\n\t        /** Stop drag/resize events */\n\t        _eventFrameMouseUp: function _eventFrameMouseUp(e) {\n\t            if (this.event.type) {\n\t                this._frameDragStop(this.event.target);\n\t                this.event.type = null;\n\t            }\n\t        },\n\t\n\t        /** Destroy a frame */\n\t        _eventFrameClose: function _eventFrameClose(e) {\n\t            if (!this.event.type) {\n\t                e.preventDefault();\n\t                this.del(this._frameIdentify(e.target));\n\t            }\n\t        },\n\t\n\t        /** Hide all frames */\n\t        _eventHide: function _eventHide(e) {\n\t            !this.event.type && this.hide();\n\t        },\n\t\n\t        /** Fired when scrolling occurs on panel */\n\t        _eventPanelScroll: function _eventPanelScroll(e) {\n\t            if (!this.event.type && this.visible) {\n\t                // Stop propagation if scrolling is happening inside a frame.\n\t                // TODO: could propagate scrolling if at top/bottom of frame.\n\t                var frames = $(e.srcElement).parents('.frame');\n\t                if (frames.length !== 0) {\n\t                    e.stopPropagation();\n\t                } else {\n\t                    e.preventDefault();\n\t                    this._panelScroll(e.originalEvent.detail ? e.originalEvent.detail : e.originalEvent.wheelDelta / -3);\n\t                }\n\t            }\n\t        },\n\t\n\t        /** Handle scroll up event */\n\t        _eventPanelScroll_up: function _eventPanelScroll_up(e) {\n\t            if (!this.event.type) {\n\t                e.preventDefault();\n\t                this._panelScroll(-this.options.scroll);\n\t            }\n\t        },\n\t\n\t        /** Handle scroll down */\n\t        _eventPanelScroll_down: function _eventPanelScroll_down(e) {\n\t            if (!this.event.type) {\n\t                e.preventDefault();\n\t                this._panelScroll(this.options.scroll);\n\t            }\n\t        },\n\t\n\t        /*\n\t            FRAME EVENTS SUPPORT\n\t        */\n\t\n\t        /** Identify the target frame */\n\t        _frameIdentify: function _frameIdentify(target) {\n\t            return this.frame_list['#' + $(target).closest('.frame').attr('id')];\n\t        },\n\t\n\t        /** Provides drag support */\n\t        _frameDragStart: function _frameDragStart(frame) {\n\t            this._frameFocus(frame, true);\n\t            var p = this._frameScreen(frame);\n\t            this._frameResize(this.frame_shadow, p);\n\t            this._frameGrid(this.frame_shadow, frame.grid_location);\n\t            frame.grid_location = null;\n\t            this.frame_shadow.$el.show();\n\t            $('.f-cover').show();\n\t        },\n\t\n\t        /** Removes drag support */\n\t        _frameDragStop: function _frameDragStop(frame) {\n\t            this._frameFocus(frame, false);\n\t            var p = this._frameScreen(this.frame_shadow);\n\t            this._frameResize(frame, p);\n\t            this._frameGrid(frame, this.frame_shadow.grid_location, true);\n\t            this.frame_shadow.grid_location = null;\n\t            this.frame_shadow.$el.hide();\n\t            $('.f-cover').hide();\n\t            this._panelAnimationComplete();\n\t        },\n\t\n\t        /*\n\t            GRID/PIXEL CONVERTER\n\t        */\n\t\n\t        /** Converts a pixel to a grid dimension */\n\t        _toGridCoord: function _toGridCoord(type, px) {\n\t            var sign = type == 'width' || type == 'height' ? 1 : -1;\n\t            type == 'top' && (px -= this.top);\n\t            return parseInt((px + sign * this.options.margin) / this.options.cell, 10);\n\t        },\n\t\n\t        /** Converts a grid to a pixels dimension */\n\t        _toPixelCoord: function _toPixelCoord(type, g) {\n\t            var sign = type == 'width' || type == 'height' ? 1 : -1;\n\t            var px = g * this.options.cell - sign * this.options.margin;\n\t            type == 'top' && (px += this.top);\n\t            return px;\n\t        },\n\t\n\t        /** Converts a pixel to a grid coordinate set */\n\t        _toGrid: function _toGrid(px) {\n\t            return {\n\t                top: this._toGridCoord('top', px.top),\n\t                left: this._toGridCoord('left', px.left),\n\t                width: this._toGridCoord('width', px.width),\n\t                height: this._toGridCoord('height', px.height)\n\t            };\n\t        },\n\t\n\t        /** Converts a pixel to a grid coordinate set */\n\t        _toPixel: function _toPixel(g) {\n\t            return {\n\t                top: this._toPixelCoord('top', g.top),\n\t                left: this._toPixelCoord('left', g.left),\n\t                width: this._toPixelCoord('width', g.width),\n\t                height: this._toPixelCoord('height', g.height)\n\t            };\n\t        },\n\t\n\t        /* \n\t            COLLISION DETECTION\n\t        */\n\t\n\t        /** Check collisions for a grid coordinate set */\n\t        _isCollision: function _isCollision(g) {\n\t            function is_collision_pair(a, b) {\n\t                return !(a.left > b.left + b.width - 1 || a.left + a.width - 1 < b.left || a.top > b.top + b.height - 1 || a.top + a.height - 1 < b.top);\n\t            }\n\t            for (var i in this.frame_list) {\n\t                var frame = this.frame_list[i];\n\t                if (frame.grid_location !== null && is_collision_pair(g, frame.grid_location)) {\n\t                    return true;\n\t                }\n\t            }\n\t            return false;\n\t        },\n\t\n\t        /** Return location/grid rank */\n\t        _locationRank: function _locationRank(loc) {\n\t            return loc.top * this.cols + loc.left;\n\t        },\n\t\n\t        /*\n\t            PANEL/WINDOW FUNCTIONS\n\t        */\n\t\n\t        /** Refresh panel */\n\t        _panelRefresh: function _panelRefresh(animate) {\n\t            this.cols = parseInt($(window).width() / this.options.cell, 10) + 1;\n\t            this._frameInsert(null, null, animate);\n\t        },\n\t\n\t        /** Complete panel animation / frames not moving */\n\t        _panelAnimationComplete: function _panelAnimationComplete() {\n\t            var self = this;\n\t            $('.frame').promise().done(function () {\n\t                self._panelScroll(0, true);\n\t            });\n\t        },\n\t\n\t        /** Scroll panel */\n\t        _panelScroll: function _panelScroll(delta, animate) {\n\t            var top_new = this.top - this.options.scroll * delta;\n\t            top_new = Math.max(top_new, this.top_max);\n\t            top_new = Math.min(top_new, this.options.top_min);\n\t            if (this.top != top_new) {\n\t                for (var i in this.frame_list) {\n\t                    var frame = this.frame_list[i];\n\t                    if (frame.grid_location !== null) {\n\t                        var screen_location = {\n\t                            top: frame.screen_location.top - (this.top - top_new),\n\t                            left: frame.screen_location.left\n\t                        };\n\t                        this._frameOffset(frame, screen_location, animate);\n\t                    }\n\t                }\n\t                this.top = top_new;\n\t            }\n\t            this.render();\n\t        },\n\t\n\t        /*\n\t            FRAME FUNCTIONS\n\t        */\n\t\n\t        /** Initialize a new frame */\n\t        _frameInit: function _frameInit(frame, id) {\n\t            frame.id = id;\n\t            frame.screen_location = {};\n\t            frame.grid_location = {};\n\t            frame.grid_rank = null;\n\t            frame.$el.attr('id', id.substring(1));\n\t        },\n\t\n\t        /** Insert frame at given location */\n\t        _frameInsert: function _frameInsert(frame, new_loc, animate) {\n\t            var self = this;\n\t            var place_list = [];\n\t            if (frame) {\n\t                frame.grid_location = null;\n\t                place_list.push([frame, this._locationRank(new_loc)]);\n\t            }\n\t            _.each(this.frame_list, function (f) {\n\t                if (f.grid_location !== null) {\n\t                    f.grid_location = null;\n\t                    place_list.push([f, f.grid_rank]);\n\t                }\n\t            });\n\t            place_list.sort(function (a, b) {\n\t                return a[1] < b[1] ? -1 : a[1] > b[1] ? 1 : 0;\n\t            });\n\t            _.each(place_list, function (place) {\n\t                self._framePlace(place[0], animate);\n\t            });\n\t            this.top_max = 0;\n\t            _.each(this.frame_list, function (f) {\n\t                if (f.grid_location !== null) {\n\t                    self.top_max = Math.max(self.top_max, f.grid_location.top + f.grid_location.height);\n\t                }\n\t            });\n\t            this.top_max = $(window).height() - this.top_max * this.options.cell - 2 * this.options.margin;\n\t            this.top_max = Math.min(this.top_max, this.options.top_min);\n\t            this.render();\n\t        },\n\t\n\t        /** Naive frame placement */\n\t        _framePlace: function _framePlace(frame, animate) {\n\t            frame.grid_location = null;\n\t            var g = this._toGrid(this._frameScreen(frame));\n\t            var done = false;\n\t            for (var i = 0; i < this.options.rows; i++) {\n\t                for (var j = 0; j < Math.max(1, this.cols - g.width); j++) {\n\t                    g.top = i;\n\t                    g.left = j;\n\t                    if (!this._isCollision(g)) {\n\t                        done = true;\n\t                        break;\n\t                    }\n\t                }\n\t                if (done) {\n\t                    break;\n\t                }\n\t            }\n\t            if (done) {\n\t                this._frameGrid(frame, g, animate);\n\t            } else {\n\t                console.log('Grid dimensions exceeded.');\n\t            }\n\t        },\n\t\n\t        /** Handle frame focussing */\n\t        _frameFocus: function _frameFocus(frame, has_focus) {\n\t            frame.$el.css('z-index', this.frame_z + (has_focus ? 1 : 0));\n\t        },\n\t\n\t        /** New left/top position frame */\n\t        _frameOffset: function _frameOffset(frame, p, animate) {\n\t            frame.screen_location.left = p.left;\n\t            frame.screen_location.top = p.top;\n\t            if (animate) {\n\t                this._frameFocus(frame, true);\n\t                var self = this;\n\t                frame.$el.animate({ top: p.top, left: p.left }, 'fast', function () {\n\t                    self._frameFocus(frame, false);\n\t                });\n\t            } else {\n\t                frame.$el.css({ top: p.top, left: p.left });\n\t            }\n\t        },\n\t\n\t        /** Resize frame */\n\t        _frameResize: function _frameResize(frame, p) {\n\t            frame.$el.css({ width: p.width, height: p.height });\n\t            frame.screen_location.width = p.width;\n\t            frame.screen_location.height = p.height;\n\t        },\n\t\n\t        /** Push frame to new grid location */\n\t        _frameGrid: function _frameGrid(frame, l, animate) {\n\t            frame.grid_location = l;\n\t            this._frameOffset(frame, this._toPixel(l), animate);\n\t            frame.grid_rank = this._locationRank(l);\n\t        },\n\t\n\t        /** Get frame dimensions */\n\t        _frameScreen: function _frameScreen(frame) {\n\t            var p = frame.screen_location;\n\t            return { top: p.top, left: p.left, width: p.width, height: p.height };\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n/* 17 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;'use strict';\n\t\n\t// from: https://raw.githubusercontent.com/umdjs/umd/master/jqueryPlugin.js\n\t// Uses AMD or browser globals to create a jQuery plugin.\n\t(function (factory) {\n\t    if (true) {\n\t        //TODO: So...this turns out to be an all or nothing thing. If I load jQuery in the define below, it will\n\t        //  (of course) wipe the old jquery *and all the plugins loaded into it*. So the define below *is still\n\t        //  relying on jquery being loaded globally* in order to preserve plugins.\n\t        !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(1)], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory), __WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ? (__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t    } else {\n\t        // Browser globals\n\t        factory(jQuery);\n\t    }\n\t})(function (jQuery) {\n\t    'use_strict';\n\t\n\t    var $ = jQuery;\n\t\n\t    // ============================================================================\n\t    /**\n\t     * Make an element with text editable: (a) when user clicks on text, a textbox/area\n\t     * is provided for editing; (b) when enter key pressed, element's text is set and on_finish\n\t     * is called.\n\t     */\n\t    $.fn.make_text_editable = function (config_dict) {\n\t        // Get config options.\n\t        var num_cols = \"num_cols\" in config_dict ? config_dict.num_cols : 30,\n\t            num_rows = \"num_rows\" in config_dict ? config_dict.num_rows : 4,\n\t            use_textarea = \"use_textarea\" in config_dict ? config_dict.use_textarea : false,\n\t            on_finish = \"on_finish\" in config_dict ? config_dict.on_finish : null,\n\t            help_text = \"help_text\" in config_dict ? config_dict.help_text : null;\n\t\n\t        // Add element behavior.\n\t        var container = $(this);\n\t        container.addClass(\"editable-text\").click(function (e) {\n\t            // If there's already an input element, editing is active, so do nothing.\n\t            if ($(this).children(\":input\").length > 0) {\n\t                return;\n\t            }\n\t\n\t            container.removeClass(\"editable-text\");\n\t\n\t            // Handler for setting element text.\n\t            var set_text = function set_text(new_text) {\n\t                container.find(\":input\").remove();\n\t\n\t                if (new_text !== \"\") {\n\t                    container.text(new_text);\n\t                } else {\n\t                    // No text; need a line so that there is a click target.\n\t                    container.html(\"<br>\");\n\t                }\n\t                container.addClass(\"editable-text\");\n\t\n\t                if (on_finish) {\n\t                    on_finish(new_text);\n\t                }\n\t            };\n\t\n\t            // Create input element(s) for editing.\n\t            var cur_text = \"cur_text\" in config_dict ? config_dict.cur_text : container.text(),\n\t                input_elt,\n\t                button_elt;\n\t\n\t            if (use_textarea) {\n\t                input_elt = $(\"<textarea/>\").attr({ rows: num_rows, cols: num_cols }).text($.trim(cur_text)).keyup(function (e) {\n\t                    if (e.keyCode === 27) {\n\t                        // Escape key.\n\t                        set_text(cur_text);\n\t                    }\n\t                });\n\t                button_elt = $(\"<button/>\").text(\"Done\").click(function () {\n\t                    set_text(input_elt.val());\n\t                    // Return false so that click does not propogate to container.\n\t                    return false;\n\t                });\n\t            } else {\n\t                input_elt = $(\"<input type='text'/>\").attr({ value: $.trim(cur_text), size: num_cols }).blur(function () {\n\t                    set_text(cur_text);\n\t                }).keyup(function (e) {\n\t                    if (e.keyCode === 27) {\n\t                        // Escape key.\n\t                        $(this).trigger(\"blur\");\n\t                    } else if (e.keyCode === 13) {\n\t                        // Enter key.\n\t                        set_text($(this).val());\n\t                    }\n\t\n\t                    // Do not propogate event to avoid unwanted side effects.\n\t                    e.stopPropagation();\n\t                });\n\t            }\n\t\n\t            // Replace text with input object(s) and focus & select.\n\t            container.text(\"\");\n\t            container.append(input_elt);\n\t            if (button_elt) {\n\t                container.append(button_elt);\n\t            }\n\t            input_elt.focus();\n\t            input_elt.select();\n\t\n\t            // Do not propogate to elements below b/c that blurs input and prevents it from being used.\n\t            e.stopPropagation();\n\t        });\n\t\n\t        // Add help text if there some.\n\t        if (help_text) {\n\t            container.attr(\"title\", help_text).tooltip();\n\t        }\n\t\n\t        return container;\n\t    };\n\t\n\t    // ============================================================================\n\t});\n\n/***/ },\n/* 18 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $) {'use strict';\n\t\n\t!(__WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t\n\t    /**\n\t     * Stringifies a number adding commas for digit grouping as per North America.\n\t     */\n\t    function commatize(number) {\n\t        number += ''; // Convert to string\n\t        var rgx = /(\\d+)(\\d{3})/;\n\t        while (rgx.test(number)) {\n\t            number = number.replace(rgx, '$1' + ',' + '$2');\n\t        }\n\t        return number;\n\t    }\n\t\n\t    /**\n\t     * Helper to determine if object is jQuery deferred.\n\t     */\n\t    var is_deferred = function is_deferred(d) {\n\t        return 'promise' in d;\n\t    };\n\t\n\t    /**\n\t     * Implementation of a server-state based deferred. Server is repeatedly polled, and when\n\t     * condition is met, deferred is resolved.\n\t     */\n\t    var ServerStateDeferred = Backbone.Model.extend({\n\t        defaults: {\n\t            ajax_settings: {},\n\t            interval: 1000,\n\t            success_fn: function success_fn(result) {\n\t                return true;\n\t            }\n\t        },\n\t\n\t        /**\n\t         * Returns a deferred that resolves when success function returns true.\n\t         */\n\t        go: function go() {\n\t            var deferred = $.Deferred(),\n\t                self = this,\n\t                ajax_settings = self.get('ajax_settings'),\n\t                success_fn = self.get('success_fn'),\n\t                interval = self.get('interval'),\n\t                _go = function _go() {\n\t                $.ajax(ajax_settings).success(function (result) {\n\t                    if (success_fn(result)) {\n\t                        // Result is good, so resolve.\n\t                        deferred.resolve(result);\n\t                    } else {\n\t                        // Result not good, try again.\n\t                        setTimeout(_go, interval);\n\t                    }\n\t                });\n\t            };\n\t            _go();\n\t            return deferred;\n\t        }\n\t    });\n\t\n\t    /**\n\t     * Returns a random color in hexadecimal format that is sufficiently different from a single color\n\t     * or set of colors.\n\t     * @param colors a color or list of colors in the format '#RRGGBB'\n\t     */\n\t    var get_random_color = function get_random_color(colors) {\n\t        // Default for colors is white.\n\t        if (!colors) {\n\t            colors = \"#ffffff\";\n\t        }\n\t\n\t        // If needed, create list of colors.\n\t        if (typeof colors === \"string\") {\n\t            colors = [colors];\n\t        }\n\t\n\t        // Convert colors to numbers.\n\t        for (var i = 0; i < colors.length; i++) {\n\t            colors[i] = parseInt(colors[i].slice(1), 16);\n\t        }\n\t\n\t        // -- Perceived brightness and difference formulas are from\n\t        // -- http://www.w3.org/WAI/ER/WD-AERT/#color-contrast\n\t\n\t        // Compute perceived color brightness (based on RGB-YIQ transformation):\n\t        var brightness = function brightness(r, g, b) {\n\t            return (r * 299 + g * 587 + b * 114) / 1000;\n\t        };\n\t\n\t        // Compute color difference:\n\t        var difference = function difference(r1, g1, b1, r2, g2, b2) {\n\t            return Math.max(r1, r2) - Math.min(r1, r2) + (Math.max(g1, g2) - Math.min(g1, g2)) + (Math.max(b1, b2) - Math.min(b1, b2));\n\t        };\n\t\n\t        // Create new random color.\n\t        var new_color,\n\t            nr,\n\t            ng,\n\t            nb,\n\t            other_color,\n\t            or,\n\t            og,\n\t            ob,\n\t            n_brightness,\n\t            o_brightness,\n\t            diff,\n\t            ok = false,\n\t            num_tries = 0;\n\t        do {\n\t            // New color is never white b/c random in [0,1)\n\t            new_color = Math.round(Math.random() * 0xffffff);\n\t            nr = (new_color & 0xff0000) >> 16;\n\t            ng = (new_color & 0x00ff00) >> 8;\n\t            nb = new_color & 0x0000ff;\n\t            n_brightness = brightness(nr, ng, nb);\n\t            ok = true;\n\t            for (i = 0; i < colors.length; i++) {\n\t                other_color = colors[i];\n\t                or = (other_color & 0xff0000) >> 16;\n\t                og = (other_color & 0x00ff00) >> 8;\n\t                ob = other_color & 0x0000ff;\n\t                o_brightness = brightness(or, og, ob);\n\t                diff = difference(nr, ng, nb, or, og, ob);\n\t                // These thresholds may need to be adjusted. Brightness difference range is 125;\n\t                // color difference range is 500.\n\t                if (Math.abs(n_brightness - o_brightness) < 40 || diff < 200) {\n\t                    ok = false;\n\t                    break;\n\t                }\n\t            }\n\t\n\t            num_tries++;\n\t        } while (!ok && num_tries <= 10);\n\t\n\t        // Add 0x1000000 to left pad number with 0s.\n\t        return '#' + (0x1000000 + new_color).toString(16).substr(1, 6);\n\t    };\n\t\n\t    return {\n\t        commatize: commatize,\n\t        is_deferred: is_deferred,\n\t        ServerStateDeferred: ServerStateDeferred,\n\t        get_random_color: get_random_color\n\t    };\n\t}.call(exports, __webpack_require__, exports, module), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1)))\n\n/***/ },\n/* 19 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(36), __webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (parseBibtex, baseMVC, _l) {\n\t    /* global Backbone */\n\t    // we use amd here to require, but bibtex uses a global or commonjs pattern.\n\t    // webpack will load via commonjs and plain requirejs will load as global. Check both\n\t    parseBibtex = parseBibtex || window.BibtexParser;\n\t\n\t    var logNamespace = 'citation';\n\t    //==============================================================================\n\t    /** @class model for tool citations.\n\t     *  @name Citation\n\t     *  @augments Backbone.Model\n\t     */\n\t    var Citation = Backbone.Model.extend(baseMVC.LoggableMixin).extend({\n\t        _logNamespace: logNamespace,\n\t\n\t        defaults: {\n\t            content: ''\n\t        },\n\t\n\t        initialize: function initialize() {\n\t            var parsed;\n\t            try {\n\t                // TODO: to model.parse/.validate\n\t                parsed = parseBibtex(this.attributes.content);\n\t            } catch (err) {\n\t                return;\n\t            }\n\t            // bibtex returns successfully parsed in .entries and any parsing errors in .errors\n\t            if (parsed.errors.length) {\n\t                // the gen. form of these errors seems to be [ line, col, char, error message ]\n\t                var errors = parsed.errors.reduce(function (all, current) {\n\t                    return all + '; ' + current;\n\t                });\n\t                // throw new Error( 'Error parsing bibtex: ' + errors );\n\t                this.log('Error parsing bibtex: ' + errors);\n\t            }\n\t\n\t            this._fields = {};\n\t            this.entry = _.first(parsed.entries);\n\t            if (this.entry) {\n\t                var rawFields = this.entry.Fields;\n\t                for (var key in rawFields) {\n\t                    var value = rawFields[key];\n\t                    var lowerKey = key.toLowerCase();\n\t                    this._fields[lowerKey] = value;\n\t                }\n\t            }\n\t        },\n\t        entryType: function entryType() {\n\t            return this.entry ? this.entry.EntryType : undefined;\n\t        },\n\t        fields: function fields() {\n\t            return this._fields;\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    /** @class Backbone collection of citations.\n\t     */\n\t    var BaseCitationCollection = Backbone.Collection.extend(baseMVC.LoggableMixin).extend({\n\t        _logNamespace: logNamespace,\n\t\n\t        /** root api url */\n\t        urlRoot: Galaxy.root + 'api',\n\t        partial: true, // Assume some tools in history/workflow may not be properly annotated yet.\n\t        model: Citation\n\t    });\n\t\n\t    var HistoryCitationCollection = BaseCitationCollection.extend({\n\t        /** complete api url */\n\t        url: function url() {\n\t            return this.urlRoot + '/histories/' + this.history_id + '/citations';\n\t        }\n\t    });\n\t\n\t    var ToolCitationCollection = BaseCitationCollection.extend({\n\t        /** complete api url */\n\t        url: function url() {\n\t            return this.urlRoot + '/tools/' + this.tool_id + '/citations';\n\t        },\n\t        partial: false });\n\t\n\t    //==============================================================================\n\t\n\t    return {\n\t        Citation: Citation,\n\t        HistoryCitationCollection: HistoryCitationCollection,\n\t        ToolCitationCollection: ToolCitationCollection\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2)))\n\n/***/ },\n/* 20 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function($, _) {'use strict';\n\t\n\t/**\n\t    This is the regular tool form.\n\t*/\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(7), __webpack_require__(52)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, Ui, ToolFormBase) {\n\t    var View = ToolFormBase.extend({\n\t        initialize: function initialize(options) {\n\t            var self = this;\n\t            ToolFormBase.prototype.initialize.call(this, Utils.merge({\n\t                customize: function customize(options) {\n\t                    // build execute button\n\t                    options.buttons = {\n\t                        execute: execute_btn = new Ui.Button({\n\t                            icon: 'fa-check',\n\t                            tooltip: 'Execute: ' + options.name + ' (' + options.version + ')',\n\t                            title: 'Execute',\n\t                            cls: 'ui-button btn btn-primary',\n\t                            floating: 'clear',\n\t                            onclick: function onclick() {\n\t                                execute_btn.wait();\n\t                                self.portlet.disable();\n\t                                self.submit(options, function () {\n\t                                    execute_btn.unwait();\n\t                                    self.portlet.enable();\n\t                                });\n\t                            }\n\t                        })\n\t                    };\n\t                    // remap feature\n\t                    if (options.job_id && options.job_remap) {\n\t                        options.inputs['rerun_remap_job_id'] = {\n\t                            label: 'Resume dependencies from this job',\n\t                            name: 'rerun_remap_job_id',\n\t                            type: 'select',\n\t                            display: 'radio',\n\t                            ignore: '__ignore__',\n\t                            value: '__ignore__',\n\t                            options: [['Yes', options.job_id], ['No', '__ignore__']],\n\t                            help: 'The previous run of this tool failed and other tools were waiting for it to finish successfully. Use this option to resume those tools using the new output(s) of this tool run.'\n\t                        };\n\t                    }\n\t                }\n\t            }, options));\n\t        },\n\t\n\t        /** Submit a regular job.\n\t         * @param{dict}     options   - Specifies tool id and version\n\t         * @param{function} callback  - Called when request has completed\n\t         */\n\t        submit: function submit(options, callback) {\n\t            var self = this;\n\t            var job_def = {\n\t                tool_id: options.id,\n\t                tool_version: options.version,\n\t                inputs: this.data.create()\n\t            };\n\t            this.trigger('reset');\n\t            if (!self.validate(job_def)) {\n\t                Galaxy.emit.debug('tool-form::submit()', 'Submission canceled. Validation failed.');\n\t                callback && callback();\n\t                return;\n\t            }\n\t            if (options.action !== Galaxy.root + 'tool_runner/index') {\n\t                var $f = $('<form/>').attr({ action: options.action, method: options.method, enctype: options.enctype });\n\t                _.each(job_def.inputs, function (value, key) {\n\t                    $f.append($('<input/>').attr({ 'name': key, 'value': value }));\n\t                });\n\t                $f.hide().appendTo('body').submit().remove();\n\t                callback && callback();\n\t                return;\n\t            }\n\t            Galaxy.emit.debug('tool-form::submit()', 'Validation complete.', job_def);\n\t            Utils.request({\n\t                type: 'POST',\n\t                url: Galaxy.root + 'api/tools',\n\t                data: job_def,\n\t                success: function success(response) {\n\t                    callback && callback();\n\t                    self.$el.empty().append(self._templateSuccess(response));\n\t                    parent.Galaxy && parent.Galaxy.currHistoryPanel && parent.Galaxy.currHistoryPanel.refreshContents();\n\t                },\n\t                error: function error(response) {\n\t                    callback && callback();\n\t                    Galaxy.emit.debug('tool-form::submit', 'Submission failed.', response);\n\t                    if (response && response.err_data) {\n\t                        var error_messages = self.data.matchResponse(response.err_data);\n\t                        for (var input_id in error_messages) {\n\t                            self.highlight(input_id, error_messages[input_id]);\n\t                            break;\n\t                        }\n\t                    } else {\n\t                        var modal = parent.Galaxy.modal;\n\t                        modal && modal.show({\n\t                            title: 'Job submission failed',\n\t                            body: response && response.err_msg || self._templateError(job_def),\n\t                            buttons: {\n\t                                'Close': function Close() {\n\t                                    modal.hide();\n\t                                }\n\t                            }\n\t                        });\n\t                    }\n\t                }\n\t            });\n\t        },\n\t\n\t        /** Validate job dictionary.\n\t         * @param{dict}     job_def   - Job execution dictionary\n\t        */\n\t        validate: function validate(job_def) {\n\t            var job_inputs = job_def.inputs;\n\t            var batch_n = -1;\n\t            var batch_src = null;\n\t            for (var job_input_id in job_inputs) {\n\t                var input_value = job_inputs[job_input_id];\n\t                var input_id = this.data.match(job_input_id);\n\t                var input_field = this.field_list[input_id];\n\t                var input_def = this.input_list[input_id];\n\t                if (!input_id || !input_def || !input_field) {\n\t                    Galaxy.emit.debug('tool-form::validate()', 'Retrieving input objects failed.');\n\t                    continue;\n\t                }\n\t                if (!input_def.optional && input_value == null) {\n\t                    this.highlight(input_id);\n\t                    return false;\n\t                }\n\t                if (input_value && input_value.batch) {\n\t                    var n = input_value.values.length;\n\t                    var src = n > 0 && input_value.values[0] && input_value.values[0].src;\n\t                    if (src) {\n\t                        if (batch_src === null) {\n\t                            batch_src = src;\n\t                        } else if (batch_src !== src) {\n\t                            this.highlight(input_id, 'Please select either dataset or dataset list fields for all batch mode fields.');\n\t                            return false;\n\t                        }\n\t                    }\n\t                    if (batch_n === -1) {\n\t                        batch_n = n;\n\t                    } else if (batch_n !== n) {\n\t                        this.highlight(input_id, 'Please make sure that you select the same number of inputs for all batch mode fields. This field contains <b>' + n + '</b> selection(s) while a previous field contains <b>' + batch_n + '</b>.');\n\t                        return false;\n\t                    }\n\t                }\n\t            }\n\t            return true;\n\t        },\n\t\n\t        _templateSuccess: function _templateSuccess(response) {\n\t            if (response.jobs && response.jobs.length > 0) {\n\t                var njobs = response.jobs.length;\n\t                var njobs_text = njobs == 1 ? '1 job has' : njobs + ' jobs have';\n\t                var $message = $('<div/>').addClass('donemessagelarge').append($('<p/>').text(njobs_text + ' been successfully added to the queue - resulting in the following datasets:'));\n\t                _.each(response.outputs, function (output) {\n\t                    $message.append($('<p/>').addClass('messagerow').append($('<b/>').text(output.hid + ': ' + output.name)));\n\t                });\n\t                $message.append($('<p/>').append('<b/>').text('You can check the status of queued jobs and view the resulting data by refreshing the History pane. When the job has been run the status will change from \\'running\\' to \\'finished\\' if completed successfully or \\'error\\' if problems were encountered.'));\n\t                return $message;\n\t            } else {\n\t                return this._templateError(response);\n\t            }\n\t        },\n\t\n\t        _templateError: function _templateError(response) {\n\t            return $('<div/>').addClass('errormessagelarge').append($('<p/>').text('The server could not complete the request. Please contact the Galaxy Team if this error persists.')).append($('<pre/>').text(JSON.stringify(response, null, 4)));\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n/* 21 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $) {'use strict';\n\t\n\t// dependencies\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(9), __webpack_require__(7)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, Portlet, Ui) {\n\t\n\t    // ui list element\n\t    var View = Backbone.View.extend({\n\t        // create portlet to keep track of selected list elements\n\t        initialize: function initialize(options) {\n\t            // link this\n\t            var self = this;\n\t\n\t            // initialize options\n\t            this.options = options;\n\t            this.name = options.name || 'element';\n\t            this.multiple = options.multiple || false;\n\t\n\t            // create message handler\n\t            this.message = new Ui.Message();\n\t\n\t            // create portlet\n\t            this.portlet = new Portlet.View({ cls: 'ui-portlet-section' });\n\t\n\t            // create select field containing the options which can be inserted into the list\n\t            this.select = new Ui.Select.View({ optional: options.optional });\n\t\n\t            // create insert new list element button\n\t            this.button = new Ui.ButtonIcon({\n\t                icon: 'fa fa-sign-in',\n\t                floating: 'left',\n\t                tooltip: 'Insert new ' + this.name,\n\t                onclick: function onclick() {\n\t                    self.add({\n\t                        id: self.select.value(),\n\t                        name: self.select.text()\n\t                    });\n\t                }\n\t            });\n\t\n\t            // build main element\n\t            this.setElement(this._template(options));\n\t            this.$('.ui-list-message').append(this.message.$el);\n\t            this.$('.ui-list-portlet').append(this.portlet.$el);\n\t            this.$('.ui-list-button').append(this.button.$el);\n\t            this.$('.ui-list-select').append(this.select.$el);\n\t        },\n\t\n\t        /** Return/Set currently selected list elements */\n\t        value: function value(val) {\n\t            // set new value\n\t            if (val !== undefined) {\n\t                this.portlet.empty();\n\t                if ($.isArray(val)) {\n\t                    for (var i in val) {\n\t                        var v = val[i];\n\t                        var v_id = null;\n\t                        var v_name = null;\n\t                        if ($.type(v) != 'string') {\n\t                            v_id = v.id;\n\t                            v_name = v.name;\n\t                        } else {\n\t                            v_id = v_name = v;\n\t                        }\n\t                        if (v_id != null) {\n\t                            this.add({\n\t                                id: v_id,\n\t                                name: v_name\n\t                            });\n\t                        }\n\t                    }\n\t                }\n\t                this._refresh();\n\t            }\n\t            // get current value\n\t            var lst = [];\n\t            this.$('.ui-list-id').each(function () {\n\t                lst.push({\n\t                    id: $(this).prop('id'),\n\t                    name: $(this).find('.ui-list-name').html()\n\t                });\n\t            });\n\t            if (lst.length == 0) {\n\t                return null;\n\t            }\n\t            return lst;\n\t        },\n\t\n\t        /** Add row */\n\t        add: function add(options) {\n\t            var self = this;\n\t            if (this.$('[id=\"' + options.id + '\"]').length === 0) {\n\t                if (!Utils.isEmpty(options.id)) {\n\t                    var $el = $(this._templateRow({\n\t                        id: options.id,\n\t                        name: options.name\n\t                    }));\n\t                    $el.on('click', function () {\n\t                        $el.remove();\n\t                        self._refresh();\n\t                    });\n\t                    $el.on('mouseover', function () {\n\t                        $el.addClass('portlet-highlight');\n\t                    });\n\t                    $el.on('mouseout', function () {\n\t                        $el.removeClass('portlet-highlight');\n\t                    });\n\t                    this.portlet.append($el);\n\t                    this._refresh();\n\t                } else {\n\t                    this.message.update({ message: 'Please select a valid ' + this.name + '.', status: 'danger' });\n\t                }\n\t            } else {\n\t                this.message.update({ message: 'This ' + this.name + ' is already in the list.' });\n\t            }\n\t        },\n\t\n\t        /** Update available options */\n\t        update: function update(options) {\n\t            this.select.update(options);\n\t        },\n\t\n\t        /** Refresh view */\n\t        _refresh: function _refresh() {\n\t            if (this.$('.ui-list-id').length > 0) {\n\t                !this.multiple && this.button.disable();\n\t                this.$('.ui-list-portlet').show();\n\t            } else {\n\t                this.button.enable();\n\t                this.$('.ui-list-portlet').hide();\n\t            }\n\t            this.options.onchange && this.options.onchange();\n\t        },\n\t\n\t        /** Main Template */\n\t        _template: function _template(options) {\n\t            return '<div class=\"ui-list\">' + '<div class=\"ui-margin-top\">' + '<span class=\"ui-list-button\"/>' + '<span class=\"ui-list-select\"/>' + '</div>' + '<div class=\"ui-list-message\"/>' + '<div class=\"ui-list-portlet\"/>' + '</div>';\n\t        },\n\t\n\t        /** Row Template */\n\t        _templateRow: function _templateRow(options) {\n\t            return '<div id=\"' + options.id + '\" class=\"ui-list-id\">' + '<span class=\"ui-list-delete fa fa-trash\"/>' + '<span class=\"ui-list-name\">' + options.name + '</span>' + '</div>';\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1)))\n\n/***/ },\n/* 22 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {'use strict';\n\t\n\t/** Base class for options based ui elements **/\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(13)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, Buttons) {\n\t    var Base = Backbone.View.extend({\n\t        initialize: function initialize(options) {\n\t            var self = this;\n\t            this.model = options && options.model || new Backbone.Model({\n\t                visible: true,\n\t                data: [],\n\t                id: Utils.uid(),\n\t                error_text: 'No options available.',\n\t                wait_text: 'Please wait...',\n\t                multiple: false,\n\t                optional: false,\n\t                onchange: function onchange() {}\n\t            }).set(options);\n\t            this.listenTo(this.model, 'change:value', this._changeValue, this);\n\t            this.listenTo(this.model, 'change:wait', this._changeWait, this);\n\t            this.listenTo(this.model, 'change:data', this._changeData, this);\n\t            this.listenTo(this.model, 'change:visible', this._changeVisible, this);\n\t            this.on('change', function () {\n\t                self.model.get('onchange')(self.value());\n\t            });\n\t            this.render();\n\t        },\n\t\n\t        render: function render() {\n\t            var self = this;\n\t            this.$el.empty().removeClass().addClass('ui-options').append(this.$message = $('<div/>')).append(this.$menu = $('<div/>').addClass('ui-options-menu')).append(this.$options = $(this._template()));\n\t\n\t            // add select/unselect all button\n\t            this.all_button = null;\n\t            if (this.model.get('multiple')) {\n\t                this.all_button = new Buttons.ButtonCheck({\n\t                    onclick: function onclick() {\n\t                        self.$('input').prop('checked', self.all_button.value() !== 0);\n\t                        self.value(self._getValue());\n\t                        self.trigger('change');\n\t                    }\n\t                });\n\t                this.$menu.append(this.all_button.$el);\n\t            }\n\t\n\t            // finalize dom\n\t            this._changeData();\n\t            this._changeWait();\n\t            this._changeVisible();\n\t        },\n\t\n\t        _changeData: function _changeData() {\n\t            var self = this;\n\t            this.$options.empty();\n\t            if (this._templateOptions) {\n\t                this.$options.append(this._templateOptions(this.model.get('data')));\n\t            } else {\n\t                _.each(this.model.get('data'), function (option) {\n\t                    self.$options.append($(self._templateOption(option)).addClass('ui-option').tooltip({ title: option.tooltip, placement: 'bottom' }));\n\t                });\n\t            }\n\t            var self = this;\n\t            this.$('input').on('change', function () {\n\t                self.value(self._getValue());\n\t                self.trigger('change');\n\t            });\n\t            this._changeValue();\n\t            this._changeWait();\n\t        },\n\t\n\t        _changeVisible: function _changeVisible() {\n\t            this.$el[this.model.get('visible') ? 'show' : 'hide']();\n\t        },\n\t\n\t        _changeWait: function _changeWait() {\n\t            if (this.model.get('wait')) {\n\t                if (this.length() === 0) {\n\t                    this._messageShow(this.model.get('wait_text'), 'info');\n\t                    this.$options.hide();\n\t                    this.$menu.hide();\n\t                }\n\t            } else {\n\t                if (this.length() === 0) {\n\t                    this._messageShow(this.model.get('error_text'), 'danger');\n\t                    this.$options.hide();\n\t                    this.$menu.hide();\n\t                } else {\n\t                    this.$message.hide();\n\t                    this.$options.css('display', 'inline-block');\n\t                    this.$menu.show();\n\t                }\n\t            }\n\t        },\n\t\n\t        _changeValue: function _changeValue() {\n\t            this._setValue(this.model.get('value'));\n\t            if (this._getValue() === null && !this.model.get('multiple') && !this.model.get('optional')) {\n\t                this._setValue(this.first());\n\t            }\n\t            this.all_button && this.all_button.value($.isArray(this._getValue()) ? this._getValue().length : 0, this.length());\n\t        },\n\t\n\t        /** Return/Set current selection */\n\t        value: function value(new_value) {\n\t            new_value !== undefined && this.model.set('value', new_value);\n\t            return this._getValue();\n\t        },\n\t\n\t        /** Return first available option */\n\t        first: function first() {\n\t            var options = this.$('input').first();\n\t            return options.length > 0 ? options.val() : null;\n\t        },\n\t\n\t        /** Show a spinner indicating that the select options are currently loaded */\n\t        wait: function wait() {\n\t            this.model.set('wait', true);\n\t        },\n\t\n\t        /** Hide spinner indicating that the request has been completed */\n\t        unwait: function unwait() {\n\t            this.model.set('wait', false);\n\t        },\n\t\n\t        /** Returns the number of options */\n\t        length: function length() {\n\t            return this.$('.ui-option').length;\n\t        },\n\t\n\t        /** Set value to dom */\n\t        _setValue: function _setValue(new_value) {\n\t            var self = this;\n\t            if (new_value !== undefined) {\n\t                this.$('input').prop('checked', false);\n\t                if (new_value !== null) {\n\t                    var values = $.isArray(new_value) ? new_value : [new_value];\n\t                    _.each(values, function (v) {\n\t                        self.$('input[value=\"' + v + '\"]').first().prop('checked', true);\n\t                    });\n\t                }\n\t            }\n\t        },\n\t\n\t        /** Return current selection */\n\t        _getValue: function _getValue() {\n\t            var selected = [];\n\t            this.$(':checked').each(function () {\n\t                selected.push($(this).val());\n\t            });\n\t            if (Utils.isEmpty(selected)) {\n\t                return null;\n\t            }\n\t            return this.model.get('multiple') ? selected : selected[0];\n\t        },\n\t\n\t        /** Show message instead if options */\n\t        _messageShow: function _messageShow(text, status) {\n\t            this.$message.show().removeClass().addClass('ui-message alert alert-' + status).html(text);\n\t        },\n\t\n\t        /** Main template function */\n\t        _template: function _template() {\n\t            return $('<div/>').addClass('ui-options-list');\n\t        }\n\t    });\n\t\n\t    /** Iconized **/\n\t    var BaseIcons = Base.extend({\n\t        _templateOption: function _templateOption(pair) {\n\t            var id = Utils.uid();\n\t            return $('<div/>').addClass('ui-option').append($('<input/>').attr({\n\t                id: id,\n\t                type: this.model.get('type'),\n\t                name: this.model.id,\n\t                value: pair.value })).append($('<label/>').addClass('ui-options-label').attr('for', id).html(pair.label));\n\t        }\n\t    });\n\t\n\t    /** Radio button field **/\n\t    var Radio = {};\n\t    Radio.View = BaseIcons.extend({\n\t        initialize: function initialize(options) {\n\t            options.type = 'radio';\n\t            BaseIcons.prototype.initialize.call(this, options);\n\t        }\n\t    });\n\t\n\t    /** Checkbox options field **/\n\t    var Checkbox = {};\n\t    Checkbox.View = BaseIcons.extend({\n\t        initialize: function initialize(options) {\n\t            options.type = 'checkbox';\n\t            options.multiple = true;\n\t            BaseIcons.prototype.initialize.call(this, options);\n\t        }\n\t    });\n\t\n\t    /** Radio button options field styled as classic buttons **/\n\t    var RadioButton = {};\n\t    RadioButton.View = Base.extend({\n\t        initialize: function initialize(options) {\n\t            Base.prototype.initialize.call(this, options);\n\t        },\n\t\n\t        /** Set current value */\n\t        _setValue: function _setValue(new_value) {\n\t            if (new_value !== undefined) {\n\t                this.$('input').prop('checked', false);\n\t                this.$('label').removeClass('active');\n\t                this.$('[value=\"' + new_value + '\"]').prop('checked', true).closest('label').addClass('active');\n\t            }\n\t        },\n\t\n\t        /** Template for a single option */\n\t        _templateOption: function _templateOption(pair) {\n\t            var $el = $('<label/>').addClass('btn btn-default');\n\t            pair.icon && $el.append($('<i/>').addClass('fa').addClass(pair.icon).addClass(!pair.label && 'no-padding'));\n\t            $el.append($('<input/>').attr({ type: 'radio', name: this.model.id, value: pair.value }));\n\t            pair.label && $el.append(pair.label);\n\t            return $el;\n\t        },\n\t\n\t        /** Main template function */\n\t        _template: function _template() {\n\t            return $('<div/>').addClass('btn-group ui-radiobutton').attr('data-toggle', 'buttons');\n\t        }\n\t    });\n\t\n\t    return {\n\t        Base: Base,\n\t        BaseIcons: BaseIcons,\n\t        Radio: Radio,\n\t        RadioButton: RadioButton,\n\t        Checkbox: Checkbox\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n/* 23 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {'use strict';\n\t\n\t/**\n\t *  This class creates/wraps a default html select field as backbone class.\n\t */\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(13)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, Buttons) {\n\t    var View = Backbone.View.extend({\n\t        initialize: function initialize(options) {\n\t            var self = this;\n\t            this.model = options && options.model || new Backbone.Model({\n\t                id: Utils.uid(),\n\t                cls: 'ui-select',\n\t                error_text: 'No options available',\n\t                empty_text: 'Nothing selected',\n\t                visible: true,\n\t                wait: false,\n\t                multiple: false,\n\t                searchable: true,\n\t                optional: false,\n\t                disabled: false,\n\t                onchange: function onchange() {}\n\t            }).set(options);\n\t            this.on('change', function () {\n\t                self.model.get('onchange')(self.value());\n\t            });\n\t            this.listenTo(this.model, 'change:data', this._changeData, this);\n\t            this.listenTo(this.model, 'change:disabled', this._changeDisabled, this);\n\t            this.listenTo(this.model, 'change:wait', this._changeWait, this);\n\t            this.listenTo(this.model, 'change:visible', this._changeVisible, this);\n\t            this.listenTo(this.model, 'change:value', this._changeValue, this);\n\t            this.listenTo(this.model, 'change:multiple change:searchable change:cls change:id', this.render, this);\n\t            this.render();\n\t        },\n\t\n\t        render: function render() {\n\t            var self = this;\n\t            this.$el.empty().append(this.$select = $('<select/>')).append(this.$dropdown = $('<div/>')).append(this.$resize = $('<div/>').append(this.$resize_icon = $('<i/>')));\n\t\n\t            // set element properties\n\t            this.$el.addClass(this.model.get('cls')).attr('id', this.model.get('id'));\n\t\n\t            // set select properties\n\t            this.$select.addClass('select').attr('id', this.model.get('id') + '_select').prop('multiple', this.model.get('multiple')).on('change', function () {\n\t                self.value(self._getValue());\n\t                self.trigger('change');\n\t            });\n\t\n\t            // render drop down\n\t            this.$dropdown.hide();\n\t            if (!this.model.get('multiple')) {\n\t                this.$dropdown.show().on('click', function () {\n\t                    self.$select.select2 && self.$select.select2('open');\n\t                });\n\t            }\n\t\n\t            // render resize options for classic multi-select field\n\t            this.$resize.hide();\n\t            if (this.model.get('multiple') && !this.model.get('searchable')) {\n\t                this.$resize_icon.addClass('fa fa-angle-double-right fa-rotate-45');\n\t                this.$resize.show().removeClass().addClass('icon-resize').off('mousedown').on('mousedown', function (event) {\n\t                    var currentY = event.pageY;\n\t                    var currentHeight = self.$select.height();\n\t                    self.minHeight = self.minHeight || currentHeight;\n\t                    $('#dd-helper').show().on('mousemove', function (event) {\n\t                        self.$select.height(Math.max(currentHeight + (event.pageY - currentY), self.minHeight));\n\t                    }).on('mouseup mouseleave', function () {\n\t                        $('#dd-helper').hide().off();\n\t                    });\n\t                });\n\t            }\n\t\n\t            // build select all button\n\t            this.all_button = null;\n\t            if (this.model.get('multiple')) {\n\t                if (this.model.get('searchable')) {\n\t                    this.all_button = new Buttons.ButtonCheck({\n\t                        onclick: function onclick() {\n\t                            var new_value = [];\n\t                            self.all_button.value() !== 0 && _.each(self.model.get('data'), function (option) {\n\t                                new_value.push(option.value);\n\t                            });\n\t                            self.value(new_value);\n\t                            self.trigger('change');\n\t                        }\n\t                    });\n\t                    this.$el.prepend(this.all_button.$el);\n\t                } else {\n\t                    this.$el.addClass('ui-select-multiple');\n\t                }\n\t            }\n\t\n\t            // finalize dom\n\t            this._changeData();\n\t            this._changeWait();\n\t            this._changeVisible();\n\t        },\n\t\n\t        _changeData: function _changeData() {\n\t            var self = this;\n\t            this.$select.find('option').remove();\n\t            if (!this.model.get('multiple') && this.model.get('optional')) {\n\t                this.$select.append(this._templateOption({ value: '__null__', label: self.model.get('empty_text') }));\n\t            }\n\t            _.each(this.model.get('data'), function (option) {\n\t                self.$select.append(self._templateOption(option));\n\t            });\n\t            if (this.length() == 0) {\n\t                this.$select.prop('disabled', true).append(this._templateOption({ value: '__null__', label: this.model.get('error_text') }));\n\t            } else {\n\t                this.$select.prop('disabled', false);\n\t            }\n\t            this.$select.select2('destroy');\n\t            if (this.model.get('searchable')) {\n\t                this.$select.select2({ closeOnSelect: !this.model.get('multiple') });\n\t                this.$('.select2-container .select2-search input').off('blur');\n\t            }\n\t            this._changeValue();\n\t        },\n\t\n\t        _changeDisabled: function _changeDisabled() {\n\t            this.$select.prop('disabled', this.model.get('disabled'));\n\t        },\n\t\n\t        _changeWait: function _changeWait() {\n\t            this.$dropdown.removeClass().addClass('icon-dropdown fa').addClass(this.model.get('wait') ? 'fa-spinner fa-spin' : 'fa-caret-down');\n\t        },\n\t\n\t        _changeVisible: function _changeVisible() {\n\t            this.$el[this.model.get('visible') ? 'show' : 'hide']();\n\t            this.$select[this.model.get('visible') ? 'show' : 'hide']();\n\t        },\n\t\n\t        _changeValue: function _changeValue() {\n\t            this._setValue(this.model.get('value'));\n\t            if (this._getValue() === null && !this.model.get('multiple') && !this.model.get('optional')) {\n\t                this._setValue(this.first());\n\t            }\n\t            var value = this._getValue();\n\t            this.all_button && this.all_button.value($.isArray(value) ? value.length : 0, this.length());\n\t        },\n\t\n\t        /** Return/Set current selection */\n\t        value: function value(new_value) {\n\t            new_value !== undefined && this.model.set('value', new_value);\n\t            return this._getValue();\n\t        },\n\t\n\t        /** Return the first select option */\n\t        first: function first() {\n\t            var options = this.$select.find('option').first();\n\t            return options.length > 0 ? options.val() : null;\n\t        },\n\t\n\t        /** Check if a value is an existing option */\n\t        exists: function exists(value) {\n\t            return this.$select.find('option[value=\"' + value + '\"]').length > 0;\n\t        },\n\t\n\t        /** Return the label/text of the current selection */\n\t        text: function text() {\n\t            return this.$select.find('option:selected').first().text();\n\t        },\n\t\n\t        /** Show the select field */\n\t        show: function show() {\n\t            this.model.set('visible', true);\n\t        },\n\t\n\t        /** Hide the select field */\n\t        hide: function hide() {\n\t            this.model.set('visible', false);\n\t        },\n\t\n\t        /** Show a spinner indicating that the select options are currently loaded */\n\t        wait: function wait() {\n\t            this.model.set('wait', true);\n\t        },\n\t\n\t        /** Hide spinner indicating that the request has been completed */\n\t        unwait: function unwait() {\n\t            this.model.set('wait', false);\n\t        },\n\t\n\t        /** Returns true if the field is disabled */\n\t        disabled: function disabled() {\n\t            return this.model.get('disabled');\n\t        },\n\t\n\t        /** Enable the select field */\n\t        enable: function enable() {\n\t            this.model.set('disabled', false);\n\t        },\n\t\n\t        /** Disable the select field */\n\t        disable: function disable() {\n\t            this.model.set('disabled', true);\n\t        },\n\t\n\t        /** Update all available options at once */\n\t        add: function add(options, sorter) {\n\t            _.each(this.model.get('data'), function (v) {\n\t                !_.findWhere(options, v) && options.push(v);\n\t            });\n\t            sorter && options && options.sort(sorter);\n\t            this.model.set('data', options);\n\t        },\n\t\n\t        /** Update available options */\n\t        update: function update(options) {\n\t            this.model.set('data', options);\n\t        },\n\t\n\t        /** Set the custom onchange callback function */\n\t        setOnChange: function setOnChange(callback) {\n\t            this.model.set('onchange', callback);\n\t        },\n\t\n\t        /** Number of available options */\n\t        length: function length() {\n\t            return $.isArray(this.model.get('data')) ? this.model.get('data').length : 0;\n\t        },\n\t\n\t        /** Set value to dom */\n\t        _setValue: function _setValue(new_value) {\n\t            if (new_value !== undefined) {\n\t                new_value = new_value !== null ? new_value : '__null__';\n\t                this.$select.val(new_value);\n\t                this.$select.select2 && this.$select.select2('val', new_value);\n\t            }\n\t        },\n\t\n\t        /** Get value from dom */\n\t        _getValue: function _getValue() {\n\t            var val = this.$select.val();\n\t            return Utils.isEmpty(val) ? null : val;\n\t        },\n\t\n\t        /** Template for select options */\n\t        _templateOption: function _templateOption(options) {\n\t            return $('<option/>').attr('value', options.value).html(_.escape(options.label));\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n/* 24 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function($, _) {'use strict';\n\t\n\t(function (root, factory) {\n\t    if (true) {\n\t        !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory), __WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ? (__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t    } else {\n\t        root.faIconButton = factory();\n\t    }\n\t})(undefined, function () {\n\t    //============================================================================\n\t    /** Returns a jQuery object containing a clickable font-awesome button.\n\t     *      options:\n\t     *          tooltipConfig   : option map for bootstrap tool tip\n\t     *          classes         : array of class names (will always be classed as icon-btn)\n\t     *          disabled        : T/F - add the 'disabled' class?\n\t     *          title           : tooltip/title string\n\t     *          target          : optional href target\n\t     *          href            : optional href\n\t     *          faIcon          : which font awesome icon to use\n\t     *          onclick         : function to call when the button is clicked\n\t     */\n\t    var faIconButton = function faIconButton(options) {\n\t        options = options || {};\n\t        options.tooltipConfig = options.tooltipConfig || { placement: 'bottom' };\n\t\n\t        options.classes = ['icon-btn'].concat(options.classes || []);\n\t        if (options.disabled) {\n\t            options.classes.push('disabled');\n\t        }\n\t\n\t        var html = ['<a class=\"', options.classes.join(' '), '\"', options.title ? ' title=\"' + options.title + '\"' : '', !options.disabled && options.target ? ' target=\"' + options.target + '\"' : '', ' href=\"', !options.disabled && options.href ? options.href : 'javascript:void(0);', '\">',\n\t        // could go with something less specific here - like 'html'\n\t        '<span class=\"fa ', options.faIcon, '\"></span>', '</a>'].join('');\n\t        var $button = $(html).tooltip(options.tooltipConfig);\n\t        if (_.isFunction(options.onclick)) {\n\t            $button.click(options.onclick);\n\t        }\n\t        return $button;\n\t    };\n\t\n\t    //============================================================================\n\t    return faIconButton;\n\t});\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n/* 25 */,\n/* 26 */,\n/* 27 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {'use strict';\n\t\n\t/**\n\t * Popover wrapper\n\t*/\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils) {\n\t    var View = Backbone.View.extend({\n\t        optionsDefault: {\n\t            with_close: true,\n\t            title: null,\n\t            placement: 'top',\n\t            container: 'body',\n\t            body: null\n\t        },\n\t\n\t        initialize: function initialize(options) {\n\t            this.setElement(this._template());\n\t            this.uid = Utils.uid();\n\t            this.options = _.defaults(options || {}, this.optionsDefault);\n\t            this.options.container.parent().append(this.el);\n\t            this.$title = this.$('.popover-title-label');\n\t            this.$close = this.$('.popover-close');\n\t            this.$body = this.$('.popover-content');\n\t\n\t            // add initial content\n\t            this.options.body && this.append(this.options.body);\n\t\n\t            // add event to hide if click is outside of popup and not on container\n\t            var self = this;\n\t            $('body').on('mousedown.' + this.uid, function (e) {\n\t                // the 'is' for buttons that trigger popups\n\t                // the 'has' for icons within a button that triggers a popup\n\t                self.visible && !$(self.options.container).is(e.target) && !$(self.el).is(e.target) && $(self.el).has(e.target).length === 0 && self.hide();\n\t            });\n\t        },\n\t\n\t        /**\n\t         * Render popover\n\t        */\n\t        render: function render() {\n\t            this.$title.html(this.options.title);\n\t            this.$el.removeClass().addClass('ui-popover popover fade in').addClass(this.options.placement);\n\t            this.$el.css(this._get_placement(this.options.placement));\n\t\n\t            // configure close option\n\t            var self = this;\n\t            if (this.options.with_close) {\n\t                this.$close.on('click', function () {\n\t                    self.hide();\n\t                }).show();\n\t            } else {\n\t                this.$close.off().hide();\n\t            }\n\t        },\n\t\n\t        /**\n\t         * Set the popover title\n\t         * @params{ String }    newTitle    - New popover title\n\t        */\n\t        title: function title(newTitle) {\n\t            if (newTitle !== undefined) {\n\t                this.options.title = newTitle;\n\t                this.$title.html(newTitle);\n\t            }\n\t        },\n\t\n\t        /**\n\t         * Show popover\n\t        */\n\t        show: function show() {\n\t            this.render();\n\t            this.$el.show();\n\t            this.visible = true;\n\t        },\n\t\n\t        /**\n\t         * Hide popover\n\t        */\n\t        hide: function hide() {\n\t            this.$el.hide();\n\t            this.visible = false;\n\t        },\n\t\n\t        /**\n\t         * Append new content to the popover\n\t         * @params{ Object }  $el - Dom element\n\t        */\n\t        append: function append($el) {\n\t            this.$body.append($el);\n\t        },\n\t\n\t        /**\n\t         * Remove all content\n\t        */\n\t        empty: function empty() {\n\t            this.$body.empty();\n\t        },\n\t\n\t        /**\n\t         * Remove popover\n\t        */\n\t        remove: function remove() {\n\t            $('body').off('mousedown.' + this.uid);\n\t            this.$el.remove();\n\t        },\n\t\n\t        /**\n\t         * Improve popover location/placement\n\t        */\n\t        _get_placement: function _get_placement(placement) {\n\t            // get popover dimensions\n\t            var width = this._get_width(this.$el);\n\t            var height = this.$el.height();\n\t\n\t            // get container details\n\t            var $container = this.options.container;\n\t            var container_width = this._get_width($container);\n\t            var container_height = this._get_height($container);\n\t            var container_position = $container.position();\n\t\n\t            // get position\n\t            var top = left = 0;\n\t            if (['top', 'bottom'].indexOf(placement) != -1) {\n\t                left = container_position.left - width + (container_width + width) / 2;\n\t                switch (placement) {\n\t                    case 'top':\n\t                        top = container_position.top - height - 5;\n\t                        break;\n\t                    case 'bottom':\n\t                        top = container_position.top + container_height + 5;\n\t                        break;\n\t                }\n\t            } else {\n\t                top = container_position.top - height + (container_height + height) / 2;\n\t                switch (placement) {\n\t                    case 'right':\n\t                        left = container_position.left + container_width;\n\t                        break;\n\t                }\n\t            }\n\t            return { top: top, left: left };\n\t        },\n\t\n\t        /**\n\t         * Returns padding/margin corrected width\n\t        */\n\t        _get_width: function _get_width($el) {\n\t            return $el.width() + parseInt($el.css('padding-left')) + parseInt($el.css('margin-left')) + parseInt($el.css('padding-right')) + parseInt($el.css('margin-right'));\n\t        },\n\t\n\t        /**\n\t         * Returns padding corrected height\n\t        */\n\t        _get_height: function _get_height($el) {\n\t            return $el.height() + parseInt($el.css('padding-top')) + parseInt($el.css('padding-bottom'));\n\t        },\n\t\n\t        /**\n\t         * Return the popover template\n\t        */\n\t        _template: function _template(options) {\n\t            return '<div class=\"ui-popover popover fade in\">' + '<div class=\"arrow\"/>' + '<div class=\"popover-title\">' + '<div class=\"popover-title-label\"/>' + '<div class=\"popover-close fa fa-times-circle\"/>' + '</div>' + '<div class=\"popover-content\"/>' + '</div>';\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 28 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _) {'use strict';\n\t\n\t// dependencies\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils) {\n\t\n\t    /**\n\t     * A plugin for initializing select2 input items.\n\t     * Make sure the select2 library itself is loaded beforehand.\n\t     * Also the element to which select2 will be appended has to \n\t     * be created before select2 initialization (and passed as option).\n\t     */\n\t    var View = Backbone.View.extend({\n\t        // options\n\t        optionsDefault: {\n\t            css: '',\n\t            placeholder: 'No data available',\n\t            data: [],\n\t            value: null,\n\t            multiple: false,\n\t            minimumInputLength: 0,\n\t            // example format of initial data: \"id:name,55:anotherrole@role.com,27:role@role.com\"\n\t            initialData: ''\n\t        },\n\t\n\t        // initialize\n\t        initialize: function initialize(options) {\n\t            // configure options\n\t            this.options = Utils.merge(options, this.optionsDefault);\n\t\n\t            // create new element\n\t            this.setElement(this._template(this.options));\n\t\n\t            // check if container exists\n\t            if (!this.options.container) {\n\t                console.log('ui-select::initialize() : container not specified.');\n\t                return;\n\t            }\n\t\n\t            // add to dom\n\t            this.options.container.append(this.$el);\n\t\n\t            // link selection dictionary\n\t            this.select_data = this.options.data;\n\t\n\t            // refresh\n\t            this._refresh();\n\t\n\t            if (!this.options.multiple) {\n\t                // initial value\n\t                if (this.options.value) {\n\t                    this._setValue(this.options.value);\n\t                }\n\t\n\t                // add change event\n\t                var self = this;\n\t                if (this.options.onchange) {\n\t                    this.$el.on('change', function () {\n\t                        self.options.onchange(self.value());\n\t                    });\n\t                }\n\t            }\n\t        },\n\t\n\t        // value\n\t        value: function value(new_value) {\n\t            // get current id/value\n\t            var before = this._getValue();\n\t\n\t            // check if new_value is defined\n\t            if (new_value !== undefined) {\n\t                this._setValue(new_value);\n\t            }\n\t\n\t            // get current id/value\n\t            var after = this._getValue();\n\t\n\t            // fire onchange\n\t            if (after != before && this.options.onchange) {\n\t                this.options.onchange(after);\n\t            }\n\t\n\t            // return current value\n\t            return after;\n\t        },\n\t\n\t        // label\n\t        text: function text() {\n\t            return this.$el.select2('data').text;\n\t        },\n\t\n\t        // disabled\n\t        disabled: function disabled() {\n\t            return !this.$el.select2('enable');\n\t        },\n\t\n\t        // enable\n\t        enable: function enable() {\n\t            this.$el.select2('enable', true);\n\t        },\n\t\n\t        // disable\n\t        disable: function disable() {\n\t            this.$el.select2('enable', false);\n\t        },\n\t\n\t        // add\n\t        add: function add(options) {\n\t            // add options\n\t            this.select_data.push({\n\t                id: options.id,\n\t                text: options.text\n\t            });\n\t\n\t            // refresh\n\t            this._refresh();\n\t        },\n\t\n\t        // remove\n\t        del: function del(id) {\n\t            // search option\n\t            var index = this._getIndex(id);\n\t\n\t            // check if found\n\t            if (index != -1) {\n\t                // remove options\n\t                this.select_data.splice(index, 1);\n\t\n\t                // refresh\n\t                this._refresh();\n\t            }\n\t        },\n\t\n\t        // remove\n\t        remove: function remove() {\n\t            this.$el.select2('destroy');\n\t        },\n\t\n\t        // update\n\t        update: function update(options) {\n\t            // copy options\n\t            this.select_data = [];\n\t            for (var key in options.data) {\n\t                this.select_data.push(options.data[key]);\n\t            }\n\t\n\t            // refresh\n\t            this._refresh();\n\t        },\n\t\n\t        // refresh\n\t        _refresh: function _refresh() {\n\t            // add select2 data based on type of input\n\t            if (!this.options.multiple) {\n\t                var selected = this._getValue();\n\t                var select_opt = {\n\t                    data: this.select_data,\n\t                    containerCssClass: this.options.css,\n\t                    placeholder: this.options.placeholder,\n\t                    dropdownAutoWidth: true\n\t                };\n\t                this.$el.select2(select_opt);\n\t                // select previous value (if exists)\n\t                this._setValue(selected);\n\t            } else {\n\t                var select_opt = {\n\t                    multiple: this.options.multiple,\n\t                    containerCssClass: this.options.css,\n\t                    placeholder: this.options.placeholder,\n\t                    minimumInputLength: this.options.minimumInputLength,\n\t                    ajax: this.options.ajax,\n\t                    dropdownCssClass: this.options.dropdownCssClass,\n\t                    escapeMarkup: this.options.escapeMarkup,\n\t                    formatResult: this.options.formatResult,\n\t                    formatSelection: this.options.formatSelection,\n\t                    initSelection: this.options.initSelection,\n\t                    initialData: this.options.initialData\n\t                };\n\t                this.$el.select2(select_opt);\n\t            }\n\t        },\n\t\n\t        // get index\n\t        _getIndex: function _getIndex(value) {\n\t            // returns the index of the searched value\n\t            _.findIndex(this.select_data, { id: value });\n\t        },\n\t\n\t        // get value\n\t        _getValue: function _getValue() {\n\t            return this.$el.select2('val');\n\t        },\n\t\n\t        // set value\n\t        _setValue: function _setValue(new_value) {\n\t            var index = this._getIndex(new_value);\n\t            if (index == -1) {\n\t                if (this.select_data.length > 0) {\n\t                    new_value = this.select_data[0].id;\n\t                }\n\t            }\n\t            this.$el.select2('val', new_value);\n\t        },\n\t\n\t        // element\n\t        _template: function _template(options) {\n\t            return '<input type=\"hidden\" value=\"' + this.options.initialData + '\"/>';\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2)))\n\n/***/ },\n/* 29 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;'use strict';\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(2), __webpack_require__(3), __webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (_, Backbone, baseMVC, _l) {\n\t    'use strict';\n\t\n\t    var logNamespace = 'user';\n\t    //==============================================================================\n\t    /** @class Model for a Galaxy user (including anonymous users).\n\t     *  @name User\n\t     */\n\t    var User = Backbone.Model.extend(baseMVC.LoggableMixin).extend(\n\t    /** @lends User.prototype */{\n\t        _logNamespace: logNamespace,\n\t\n\t        /** API location for this resource */\n\t        urlRoot: function urlRoot() {\n\t            return Galaxy.root + 'api/users';\n\t        },\n\t\n\t        /** Model defaults\n\t         *  Note: don't check for anon-users with the username as the default is '(anonymous user)'\n\t         *      a safer method is if( !user.get( 'email' ) ) -> anon user\n\t         */\n\t        defaults: /** @lends User.prototype */{\n\t            id: null,\n\t            username: '(' + _l(\"anonymous user\") + ')',\n\t            email: \"\",\n\t            total_disk_usage: 0,\n\t            nice_total_disk_usage: \"\",\n\t            quota_percent: null,\n\t            is_admin: false\n\t        },\n\t\n\t        /** Set up and bind events\n\t         *  @param {Object} data Initial model data.\n\t         */\n\t        initialize: function initialize(data) {\n\t            this.log('User.initialize:', data);\n\t\n\t            this.on('loaded', function (model, resp) {\n\t                this.log(this + ' has loaded:', model, resp);\n\t            });\n\t            this.on('change', function (model, data) {\n\t                this.log(this + ' has changed:', model, data.changes);\n\t            });\n\t        },\n\t\n\t        isAnonymous: function isAnonymous() {\n\t            return !this.get('email');\n\t        },\n\t\n\t        isAdmin: function isAdmin() {\n\t            return this.get('is_admin');\n\t        },\n\t\n\t        /** Load a user with the API using an id.\n\t         *      If getting an anonymous user or no access to a user id, pass the User.CURRENT_ID_STR\n\t         *      (e.g. 'current') and the API will return the current transaction's user data.\n\t         *  @param {String} idOrCurrent encoded user id or the User.CURRENT_ID_STR\n\t         *  @param {Object} options hash to pass to Backbone.Model.fetch. Can contain success, error fns.\n\t         *  @fires loaded when the model has been loaded from the API, passing the newModel and AJAX response.\n\t         */\n\t        loadFromApi: function loadFromApi(idOrCurrent, options) {\n\t            idOrCurrent = idOrCurrent || User.CURRENT_ID_STR;\n\t\n\t            options = options || {};\n\t            var model = this,\n\t                userFn = options.success;\n\t\n\t            /** @ignore */\n\t            options.success = function (newModel, response) {\n\t                model.trigger('loaded', newModel, response);\n\t                if (userFn) {\n\t                    userFn(newModel, response);\n\t                }\n\t            };\n\t\n\t            // requests for the current user must have a sep. constructed url (fetch don't work, ma)\n\t            if (idOrCurrent === User.CURRENT_ID_STR) {\n\t                options.url = this.urlRoot + '/' + User.CURRENT_ID_STR;\n\t            }\n\t            return Backbone.Model.prototype.fetch.call(this, options);\n\t        },\n\t\n\t        /** Clears all data from the sessionStorage.\n\t         */\n\t        clearSessionStorage: function clearSessionStorage() {\n\t            for (var key in sessionStorage) {\n\t                //TODO: store these under the user key so we don't have to do this\n\t                // currently only history\n\t                if (key.indexOf('history:') === 0) {\n\t                    sessionStorage.removeItem(key);\n\t                } else if (key === 'history-panel') {\n\t                    sessionStorage.removeItem(key);\n\t                }\n\t            }\n\t        },\n\t\n\t        /** string representation */\n\t        toString: function toString() {\n\t            var userInfo = [this.get('username')];\n\t            if (this.get('id')) {\n\t                userInfo.unshift(this.get('id'));\n\t                userInfo.push(this.get('email'));\n\t            }\n\t            return 'User(' + userInfo.join(':') + ')';\n\t        }\n\t    });\n\t\n\t    // string to send to tell server to return this transaction's user (see api/users.py)\n\t    User.CURRENT_ID_STR = 'current';\n\t\n\t    // class method to load the current user via the api and return that model\n\t    User.getCurrentUserFromApi = function (options) {\n\t        var currentUser = new User();\n\t        currentUser.loadFromApi(User.CURRENT_ID_STR, options);\n\t        return currentUser;\n\t    };\n\t\n\t    // (stub) collection for users (shouldn't be common unless admin UI)\n\t    var UserCollection = Backbone.Collection.extend(baseMVC.LoggableMixin).extend({\n\t        model: User,\n\t        urlRoot: function urlRoot() {\n\t            return Galaxy.root + 'api/users';\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    return {\n\t        User: User\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n/* 30 */,\n/* 31 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function($) {'use strict';\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(2), __webpack_require__(3), __webpack_require__(6), __webpack_require__(29), __webpack_require__(66), __webpack_require__(63), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (_, Backbone, BASE_MVC, userModel, metricsLogger, addLogging, localize) {\n\t\n\t    // TODO: move into a singleton pattern and have dependents import Galaxy\n\t    // ============================================================================\n\t    /** Base galaxy client-side application.\n\t     *      Iniitializes:\n\t     *          logger      : the logger/metrics-logger\n\t     *          localize    : the string localizer\n\t     *          config      : the current configuration (any k/v in\n\t     *              galaxy.ini available from the configuration API)\n\t     *          user        : the current user (as a mvc/user/user-model)\n\t     */\n\t    function GalaxyApp(options, bootstrapped) {\n\t        var self = this;\n\t        return self._init(options || {}, bootstrapped || {});\n\t    }\n\t\n\t    // add logging shortcuts for this object\n\t    addLogging(GalaxyApp, 'GalaxyApp');\n\t\n\t    // a debug flag can be set via local storage and made available during script/page loading\n\t    var DEBUGGING_KEY = 'galaxy:debug',\n\t        NAMESPACE_KEY = DEBUGGING_KEY + ':namespaces',\n\t        localDebugging = false;\n\t    try {\n\t        localDebugging = localStorage.getItem(DEBUGGING_KEY) == 'true';\n\t    } catch (storageErr) {\n\t        console.log(localize('localStorage not available for debug flag retrieval'));\n\t    }\n\t\n\t    /** initalize options and sub-components */\n\t    GalaxyApp.prototype._init = function __init(options, bootstrapped) {\n\t        var self = this;\n\t        _.extend(self, Backbone.Events);\n\t        if (localDebugging) {\n\t            self.logger = console;\n\t            console.debug('debugging galaxy:', 'options:', options, 'bootstrapped:', bootstrapped);\n\t        }\n\t\n\t        self._processOptions(options);\n\t        // special case for root\n\t        self.root = options.root || '/';\n\t\n\t        self._initConfig(options.config || {});\n\t        self._patchGalaxy(window.Galaxy);\n\t\n\t        self._initLogger(self.options.loggerOptions || {});\n\t        // at this point, either logging or not and namespaces are enabled - chat it up\n\t        self.debug('GalaxyApp.options: ', self.options);\n\t        self.debug('GalaxyApp.config: ', self.config);\n\t        self.debug('GalaxyApp.logger: ', self.logger);\n\t\n\t        self._initLocale();\n\t        self.debug('GalaxyApp.localize: ', self.localize);\n\t\n\t        self.config = options.config || {};\n\t        self.debug('GalaxyApp.config: ', self.config);\n\t\n\t        self._initUser(options.user || {});\n\t        self.debug('GalaxyApp.user: ', self.user);\n\t\n\t        self._setUpListeners();\n\t        self.trigger('ready', self);\n\t\n\t        return self;\n\t    };\n\t\n\t    /** default options */\n\t    GalaxyApp.prototype.defaultOptions = {\n\t        /** monkey patch attributes from existing window.Galaxy object? */\n\t        patchExisting: true,\n\t        /** root url of this app */\n\t        root: '/'\n\t    };\n\t\n\t    /** filter to options present in defaultOptions (and default to them) */\n\t    GalaxyApp.prototype._processOptions = function _processOptions(options) {\n\t        var self = this,\n\t            defaults = self.defaultOptions;\n\t\n\t        self.options = {};\n\t        for (var k in defaults) {\n\t            if (defaults.hasOwnProperty(k)) {\n\t                self.options[k] = options.hasOwnProperty(k) ? options[k] : defaults[k];\n\t            }\n\t        }\n\t        return self;\n\t    };\n\t\n\t    /** parse the config and any extra info derived from it */\n\t    GalaxyApp.prototype._initConfig = function _initConfig(config) {\n\t        var self = this;\n\t        self.config = config;\n\t\n\t        // give precendence to localdebugging for this setting\n\t        self.config.debug = localDebugging || self.config.debug;\n\t\n\t        return self;\n\t    };\n\t\n\t    /** add an option from options if the key matches an option in defaultOptions */\n\t    GalaxyApp.prototype._patchGalaxy = function _patchGalaxy(patchWith) {\n\t        var self = this;\n\t        // in case req or plain script tag order has created a prev. version of the Galaxy obj...\n\t        if (self.options.patchExisting && patchWith) {\n\t            // self.debug( 'found existing Galaxy object:', patchWith );\n\t            // ...(for now) monkey patch any added attributes that the previous Galaxy may have had\n\t            //TODO: move those attributes to more formal assignment in GalaxyApp\n\t            for (var k in patchWith) {\n\t                if (patchWith.hasOwnProperty(k)) {\n\t                    // self.debug( '\\t patching in ' + k + ' to Galaxy:', self[ k ] );\n\t                    self[k] = patchWith[k];\n\t                }\n\t            }\n\t        }\n\t    };\n\t\n\t    /** set up the metrics logger (utils/metrics-logger) and pass loggerOptions */\n\t    GalaxyApp.prototype._initLogger = function _initLogger(loggerOptions) {\n\t        var self = this;\n\t\n\t        // default to console logging at the debug level if the debug flag is set\n\t        if (self.config.debug) {\n\t            loggerOptions.consoleLogger = loggerOptions.consoleLogger || console;\n\t            loggerOptions.consoleLevel = loggerOptions.consoleLevel || metricsLogger.MetricsLogger.ALL;\n\t            // load any logging namespaces from localStorage if we can\n\t            try {\n\t                loggerOptions.consoleNamespaceWhitelist = localStorage.getItem(NAMESPACE_KEY).split(',');\n\t            } catch (storageErr) {}\n\t        }\n\t\n\t        self.logger = new metricsLogger.MetricsLogger(loggerOptions);\n\t        self.emit = {};\n\t        ['log', 'debug', 'info', 'warn', 'error', 'metric'].map(function (i) {\n\t            self.emit[i] = function (data) {\n\t                self.logger.emit(i, arguments[0], Array.prototype.slice.call(arguments, 1));\n\t            };\n\t        });\n\t\n\t        if (self.config.debug) {\n\t            // add this logger to mvc's loggable mixin so that all models can use the logger\n\t            BASE_MVC.LoggableMixin.logger = self.logger;\n\t        }\n\t        return self;\n\t    };\n\t\n\t    /** add the localize fn to this object and the window namespace (as '_l') */\n\t    GalaxyApp.prototype._initLocale = function _initLocale(options) {\n\t        var self = this;\n\t        self.debug('_initLocale:', options);\n\t        self.localize = localize;\n\t        // add to window as global shortened alias\n\t        // TODO: temporary - remove when can require for plugins\n\t        window._l = self.localize;\n\t        return self;\n\t    };\n\t\n\t    /** set up the current user as a Backbone model (mvc/user/user-model) */\n\t    GalaxyApp.prototype._initUser = function _initUser(userJSON) {\n\t        var self = this;\n\t        self.debug('_initUser:', userJSON);\n\t        self.user = new userModel.User(userJSON);\n\t        self.user.logger = self.logger;\n\t        return self;\n\t    };\n\t\n\t    /** Set up DOM/jQuery/Backbone event listeners enabled for all pages */\n\t    GalaxyApp.prototype._setUpListeners = function _setUpListeners() {\n\t        var self = this;\n\t\n\t        // hook to jq beforeSend to record the most recent ajax call and cache some data about it\n\t        /** cached info about the last ajax call made through jQuery */\n\t        self.lastAjax = {};\n\t        $(document).bind('ajaxSend', function (ev, xhr, options) {\n\t            var data = options.data;\n\t            try {\n\t                data = JSON.parse(data);\n\t            } catch (err) {}\n\t\n\t            self.lastAjax = {\n\t                url: location.href.slice(0, -1) + options.url,\n\t                data: data\n\t            };\n\t            //TODO:?? we might somehow manage to *retry* ajax using either this hook or Backbone.sync\n\t        });\n\t        return self;\n\t    };\n\t\n\t    /** Turn debugging/console-output on/off by passing boolean. Pass nothing to get current setting. */\n\t    GalaxyApp.prototype.debugging = function _debugging(setting) {\n\t        var self = this;\n\t        try {\n\t            if (setting === undefined) {\n\t                return localStorage.getItem(DEBUGGING_KEY) === 'true';\n\t            }\n\t            if (setting) {\n\t                localStorage.setItem(DEBUGGING_KEY, true);\n\t                return true;\n\t            }\n\t\n\t            localStorage.removeItem(DEBUGGING_KEY);\n\t            // also remove all namespaces\n\t            self.debuggingNamespaces(null);\n\t        } catch (storageErr) {\n\t            console.log(localize('localStorage not available for debug flag retrieval'));\n\t        }\n\t        return false;\n\t    };\n\t\n\t    /** Add, remove, or clear namespaces from the debugging filters\n\t     *  Pass no arguments to retrieve the existing namespaces as an array.\n\t     *  Pass in null to clear all namespaces (all logging messages will show now).\n\t     *  Pass in an array of strings or single string of the namespaces to filter to.\n\t     *  Returns the new/current namespaces as an array;\n\t     */\n\t    GalaxyApp.prototype.debuggingNamespaces = function _debuggingNamespaces(namespaces) {\n\t        var self = this;\n\t        try {\n\t            if (namespaces === undefined) {\n\t                var csv = localStorage.getItem(NAMESPACE_KEY);\n\t                return typeof csv === 'string' ? csv.split(',') : [];\n\t            } else if (namespaces === null) {\n\t                localStorage.removeItem(NAMESPACE_KEY);\n\t            } else {\n\t                localStorage.setItem(NAMESPACE_KEY, namespaces);\n\t            }\n\t            var newSettings = self.debuggingNamespaces();\n\t            if (self.logger) {\n\t                self.logger.options.consoleNamespaceWhitelist = newSettings;\n\t            }\n\t            return newSettings;\n\t        } catch (storageErr) {\n\t            console.log(localize('localStorage not available for debug namespace retrieval'));\n\t        }\n\t    };\n\t\n\t    /** string rep */\n\t    GalaxyApp.prototype.toString = function toString() {\n\t        var userEmail = this.user ? this.user.get('email') || '(anonymous)' : 'uninitialized';\n\t        return 'GalaxyApp(' + userEmail + ')';\n\t    };\n\t\n\t    // ============================================================================\n\t    return {\n\t        GalaxyApp: GalaxyApp\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))\n\n/***/ },\n/* 32 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $) {'use strict';\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(33), __webpack_require__(35), __webpack_require__(62)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, Menu, Scratchbook, QuotaMeter) {\n\t\n\t    /** Masthead **/\n\t    var View = Backbone.View.extend({\n\t        initialize: function initialize(options) {\n\t            var self = this;\n\t            this.options = options;\n\t            this.setElement(this._template());\n\t            this.$navbarBrandLink = this.$('.navbar-brand-link');\n\t            this.$navbarBrandImage = this.$('.navbar-brand-image');\n\t            this.$navbarBrandTitle = this.$('.navbar-brand-title');\n\t            this.$navbarTabs = this.$('.navbar-tabs');\n\t            this.$quoteMeter = this.$('.quota-meter-container');\n\t\n\t            // build tabs\n\t            this.collection = new Menu.Collection();\n\t            this.collection.on('add', function (model) {\n\t                self.$navbarTabs.append(new Menu.Tab({ model: model }).render().$el);\n\t            }).on('reset', function () {\n\t                self.$navbarTabs.empty();\n\t            }).on('dispatch', function (callback) {\n\t                self.collection.each(function (m) {\n\t                    callback(m);\n\t                });\n\t            }).fetch(this.options);\n\t\n\t            // scratchbook\n\t            Galaxy.frame = this.frame = new Scratchbook({ collection: this.collection });\n\t\n\t            // set up the quota meter (And fetch the current user data from trans)\n\t            // add quota meter to masthead\n\t            Galaxy.quotaMeter = this.quotaMeter = new QuotaMeter.UserQuotaMeter({\n\t                model: Galaxy.user,\n\t                el: this.$quoteMeter\n\t            });\n\t\n\t            // loop through beforeunload functions if the user attempts to unload the page\n\t            $(window).on('click', function (e) {\n\t                var $download_link = $(e.target).closest('a[download]');\n\t                if ($download_link.length == 1) {\n\t                    if ($('iframe[id=download]').length === 0) {\n\t                        $('body').append($('<iframe/>').attr('id', 'download').hide());\n\t                    }\n\t                    $('iframe[id=download]').attr('src', $download_link.attr('href'));\n\t                    e.preventDefault();\n\t                }\n\t            }).on('beforeunload', function () {\n\t                var text = '';\n\t                self.collection.each(function (model) {\n\t                    var q = model.get('onbeforeunload') && model.get('onbeforeunload')();\n\t                    q && (text += q + ' ');\n\t                });\n\t                if (text !== '') {\n\t                    return text;\n\t                }\n\t            });\n\t        },\n\t\n\t        render: function render() {\n\t            this.$navbarBrandTitle.html('Galaxy ' + (this.options.brand && '/ ' + this.options.brand || ''));\n\t            this.$navbarBrandLink.attr('href', this.options.logo_url);\n\t            this.$navbarBrandImage.attr('src', this.options.logo_src);\n\t            this.quotaMeter.render();\n\t            return this;\n\t        },\n\t\n\t        /** body template */\n\t        _template: function _template() {\n\t            return '<div id=\"masthead\" class=\"navbar navbar-fixed-top navbar-inverse\">' + '<div class=\"navbar-header\">' + '<div class=\"navbar-tabs\"/>' + '</div>' + '<div class=\"navbar-brand\">' + '<a class=\"navbar-brand-link\">' + '<img class=\"navbar-brand-image\"/>' + '<span class=\"navbar-brand-title\"/>' + '</a>' + '</div>' + '<div class=\"quota-meter-container\"/>' + '<div class=\"navbar-icons\"/>' + '</div>';\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1)))\n\n/***/ },\n/* 33 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, jQuery, $, _) {'use strict';\n\t\n\t/** Masthead Collection **/\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(26)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Tours) {\n\t    var Collection = Backbone.Collection.extend({\n\t        model: Backbone.Model.extend({\n\t            defaults: {\n\t                visible: true,\n\t                target: '_parent'\n\t            }\n\t        }),\n\t        fetch: function fetch(options) {\n\t            options = options || {};\n\t            this.reset();\n\t\n\t            //\n\t            // Analyze data tab.\n\t            //\n\t            this.add({\n\t                id: 'analysis',\n\t                title: 'Analyze Data',\n\t                url: '',\n\t                tooltip: 'Analysis home view'\n\t            });\n\t\n\t            //\n\t            // Workflow tab.\n\t            //\n\t            this.add({\n\t                id: 'workflow',\n\t                title: 'Workflow',\n\t                url: 'workflow',\n\t                tooltip: 'Chain tools into workflows',\n\t                disabled: !Galaxy.user.id\n\t            });\n\t\n\t            //\n\t            // 'Shared Items' or Libraries tab.\n\t            //\n\t            this.add({\n\t                id: 'shared',\n\t                title: 'Shared Data',\n\t                url: 'library/index',\n\t                tooltip: 'Access published resources',\n\t                menu: [{\n\t                    title: 'Data Libraries',\n\t                    url: 'library/list'\n\t                }, {\n\t                    title: 'Histories',\n\t                    url: 'history/list_published'\n\t                }, {\n\t                    title: 'Workflows',\n\t                    url: 'workflow/list_published'\n\t                }, {\n\t                    title: 'Visualizations',\n\t                    url: 'visualization/list_published'\n\t                }, {\n\t                    title: 'Pages',\n\t                    url: 'page/list_published'\n\t                }]\n\t            });\n\t\n\t            //\n\t            // Lab menu.\n\t            //\n\t            options.user_requests && this.add({\n\t                id: 'lab',\n\t                title: 'Lab',\n\t                menu: [{\n\t                    title: 'Sequencing Requests',\n\t                    url: 'requests/index'\n\t                }, {\n\t                    title: 'Find Samples',\n\t                    url: 'requests/find_samples_index'\n\t                }, {\n\t                    title: 'Help',\n\t                    url: options.lims_doc_url\n\t                }]\n\t            });\n\t\n\t            //\n\t            // Visualization tab.\n\t            //\n\t            this.add({\n\t                id: 'visualization',\n\t                title: 'Visualization',\n\t                url: 'visualization/list',\n\t                tooltip: 'Visualize datasets',\n\t                disabled: !Galaxy.user.id,\n\t                menu: [{\n\t                    title: 'New Track Browser',\n\t                    url: 'visualization/trackster',\n\t                    target: '_frame'\n\t                }, {\n\t                    title: 'Saved Visualizations',\n\t                    url: 'visualization/list',\n\t                    target: '_frame'\n\t                }, {\n\t                    title: 'Interactive Environments',\n\t                    url: 'visualization/gie_list',\n\t                    target: 'galaxy_main'\n\t                }]\n\t            });\n\t\n\t            //\n\t            // Admin.\n\t            //\n\t            Galaxy.user.get('is_admin') && this.add({\n\t                id: 'admin',\n\t                title: 'Admin',\n\t                url: 'admin',\n\t                tooltip: 'Administer this Galaxy',\n\t                cls: 'admin-only'\n\t            });\n\t\n\t            //\n\t            // Help tab.\n\t            //\n\t            var helpTab = {\n\t                id: 'help',\n\t                title: 'Help',\n\t                tooltip: 'Support, contact, and community hubs',\n\t                menu: [{\n\t                    title: 'Support',\n\t                    url: options.support_url,\n\t                    target: '_blank'\n\t                }, {\n\t                    title: 'Search',\n\t                    url: options.search_url,\n\t                    target: '_blank'\n\t                }, {\n\t                    title: 'Mailing Lists',\n\t                    url: options.mailing_lists,\n\t                    target: '_blank'\n\t                }, {\n\t                    title: 'Videos',\n\t                    url: options.screencasts_url,\n\t                    target: '_blank'\n\t                }, {\n\t                    title: 'Wiki',\n\t                    url: options.wiki_url,\n\t                    target: '_blank'\n\t                }, {\n\t                    title: 'How to Cite Galaxy',\n\t                    url: options.citation_url,\n\t                    target: '_blank'\n\t                }, {\n\t                    title: 'Interactive Tours',\n\t                    url: 'tours',\n\t                    onclick: function onclick() {\n\t                        if (Galaxy.app) {\n\t                            Galaxy.app.display(new Tours.ToursView());\n\t                        } else {\n\t                            // Redirect and use clientside routing to go to tour index\n\t                            window.location = Galaxy.root + \"tours\";\n\t                        }\n\t                    }\n\t                }]\n\t            };\n\t            options.terms_url && helpTab.menu.push({\n\t                title: 'Terms and Conditions',\n\t                url: options.terms_url,\n\t                target: '_blank'\n\t            });\n\t            options.biostar_url && helpTab.menu.unshift({\n\t                title: 'Ask a question',\n\t                url: 'biostar/biostar_question_redirect',\n\t                target: '_blank'\n\t            });\n\t            options.biostar_url && helpTab.menu.unshift({\n\t                title: 'Galaxy Biostar',\n\t                url: options.biostar_url_redirect,\n\t                target: '_blank'\n\t            });\n\t            this.add(helpTab);\n\t\n\t            //\n\t            // User tab.\n\t            //\n\t            if (!Galaxy.user.id) {\n\t                var userTab = {\n\t                    id: 'user',\n\t                    title: 'User',\n\t                    cls: 'loggedout-only',\n\t                    tooltip: 'Account registration or login',\n\t                    menu: [{\n\t                        title: 'Login',\n\t                        url: 'user/login',\n\t                        target: 'galaxy_main'\n\t                    }]\n\t                };\n\t                options.allow_user_creation && userTab.menu.push({\n\t                    title: 'Register',\n\t                    url: 'user/create',\n\t                    target: 'galaxy_main'\n\t                });\n\t                this.add(userTab);\n\t            } else {\n\t                var userTab = {\n\t                    id: 'user',\n\t                    title: 'User',\n\t                    cls: 'loggedin-only',\n\t                    tooltip: 'Account preferences and saved data',\n\t                    menu: [{\n\t                        title: 'Logged in as ' + Galaxy.user.get('email')\n\t                    }, {\n\t                        title: 'Preferences',\n\t                        url: 'user?cntrller=user',\n\t                        target: 'galaxy_main'\n\t                    }, {\n\t                        title: 'Custom Builds',\n\t                        url: 'user/dbkeys',\n\t                        target: 'galaxy_main'\n\t                    }, {\n\t                        title: 'Logout',\n\t                        url: 'user/logout',\n\t                        target: '_top',\n\t                        divider: true\n\t                    }, {\n\t                        title: 'Saved Histories',\n\t                        url: 'history/list',\n\t                        target: 'galaxy_main'\n\t                    }, {\n\t                        title: 'Saved Datasets',\n\t                        url: 'dataset/list',\n\t                        target: 'galaxy_main'\n\t                    }, {\n\t                        title: 'Saved Pages',\n\t                        url: 'page/list',\n\t                        target: '_top'\n\t                    }, {\n\t                        title: 'API Keys',\n\t                        url: 'user/api_keys?cntrller=user',\n\t                        target: 'galaxy_main'\n\t                    }]\n\t                };\n\t                options.use_remote_user && userTab.menu.push({\n\t                    title: 'Public Name',\n\t                    url: 'user/edit_username?cntrller=user',\n\t                    target: 'galaxy_main'\n\t                });\n\t                this.add(userTab);\n\t            }\n\t            var activeView = this.get(options.active_view);\n\t            activeView && activeView.set('active', true);\n\t            return new jQuery.Deferred().resolve().promise();\n\t        }\n\t    });\n\t\n\t    /** Masthead tab **/\n\t    var Tab = Backbone.View.extend({\n\t        initialize: function initialize(options) {\n\t            this.model = options.model;\n\t            this.setElement(this._template());\n\t            this.$dropdown = this.$('.dropdown');\n\t            this.$toggle = this.$('.dropdown-toggle');\n\t            this.$menu = this.$('.dropdown-menu');\n\t            this.$note = this.$('.dropdown-note');\n\t            this.listenTo(this.model, 'change', this.render, this);\n\t        },\n\t\n\t        events: {\n\t            'click .dropdown-toggle': '_toggleClick'\n\t        },\n\t\n\t        render: function render() {\n\t            var self = this;\n\t            $('.tooltip').remove();\n\t            this.$el.attr('id', this.model.id).css({ visibility: this.model.get('visible') && 'visible' || 'hidden' });\n\t            this.model.set('url', this._formatUrl(this.model.get('url')));\n\t            this.$note.html(this.model.get('note') || '').removeClass().addClass('dropdown-note').addClass(this.model.get('note_cls')).css({ 'display': this.model.get('show_note') && 'block' || 'none' });\n\t            this.$toggle.html(this.model.get('title') || '').removeClass().addClass('dropdown-toggle').addClass(this.model.get('cls')).addClass(this.model.get('icon') && 'dropdown-icon fa ' + this.model.get('icon')).addClass(this.model.get('toggle') && 'toggle').attr('target', this.model.get('target')).attr('href', this.model.get('url')).attr('title', this.model.get('tooltip')).tooltip('destroy');\n\t            this.model.get('tooltip') && this.$toggle.tooltip({ placement: 'bottom' });\n\t            this.$dropdown.removeClass().addClass('dropdown').addClass(this.model.get('disabled') && 'disabled').addClass(this.model.get('active') && 'active');\n\t            if (this.model.get('menu') && this.model.get('show_menu')) {\n\t                this.$menu.show();\n\t                $('#dd-helper').show().off().on('click', function () {\n\t                    $('#dd-helper').hide();\n\t                    self.model.set('show_menu', false);\n\t                });\n\t            } else {\n\t                self.$menu.hide();\n\t                $('#dd-helper').hide();\n\t            }\n\t            this.$menu.empty().removeClass('dropdown-menu');\n\t            if (this.model.get('menu')) {\n\t                _.each(this.model.get('menu'), function (menuItem) {\n\t                    self.$menu.append(self._buildMenuItem(menuItem));\n\t                    menuItem.divider && self.$menu.append($('<li/>').addClass('divider'));\n\t                });\n\t                self.$menu.addClass('dropdown-menu');\n\t                self.$toggle.append($('<b/>').addClass('caret'));\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /** Add new menu item */\n\t        _buildMenuItem: function _buildMenuItem(options) {\n\t            var self = this;\n\t            options = _.defaults(options || {}, {\n\t                title: '',\n\t                url: '',\n\t                target: '_parent'\n\t            });\n\t            options.url = self._formatUrl(options.url);\n\t            return $('<li/>').append($('<a/>').attr('href', options.url).attr('target', options.target).html(options.title).on('click', function (e) {\n\t                e.preventDefault();\n\t                self.model.set('show_menu', false);\n\t                if (options.onclick) {\n\t                    options.onclick();\n\t                } else {\n\t                    Galaxy.frame.add(options);\n\t                }\n\t            }));\n\t        },\n\t\n\t        /** Handle click event */\n\t        _toggleClick: function _toggleClick(e) {\n\t            var self = this;\n\t            var model = this.model;\n\t            e.preventDefault();\n\t            $('.tooltip').hide();\n\t            model.trigger('dispatch', function (m) {\n\t                model.id !== m.id && m.get('menu') && m.set('show_menu', false);\n\t            });\n\t            if (!model.get('disabled')) {\n\t                if (!model.get('menu')) {\n\t                    model.get('onclick') ? model.get('onclick')() : Galaxy.frame.add(model.attributes);\n\t                } else {\n\t                    model.set('show_menu', true);\n\t                }\n\t            } else {\n\t                var buildLink = function buildLink(label, url) {\n\t                    return $('<div/>').append($('<a/>').attr('href', Galaxy.root + url).html(label)).html();\n\t                };\n\t\n\t                this.$toggle.popover && this.$toggle.popover('destroy');\n\t                this.$toggle.popover({\n\t                    html: true,\n\t                    placement: 'bottom',\n\t                    content: 'Please ' + buildLink('login', 'user/login?use_panels=True') + ' or ' + buildLink('register', 'user/create?use_panels=True') + ' to use this feature.'\n\t                }).popover('show');\n\t                setTimeout(function () {\n\t                    self.$toggle.popover('destroy');\n\t                }, 5000);\n\t            }\n\t        },\n\t\n\t        /** Url formatting */\n\t        _formatUrl: function _formatUrl(url) {\n\t            return typeof url == 'string' && url.indexOf('//') === -1 && url.charAt(0) != '/' ? Galaxy.root + url : url;\n\t        },\n\t\n\t        /** body tempate */\n\t        _template: function _template() {\n\t            return '<ul class=\"nav navbar-nav\">' + '<li class=\"dropdown\">' + '<a class=\"dropdown-toggle\"/>' + '<ul class=\"dropdown-menu\"/>' + '<div class=\"dropdown-note\"/>' + '</li>' + '</ul>';\n\t        }\n\t    });\n\t\n\t    return {\n\t        Collection: Collection,\n\t        Tab: Tab\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1), __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n/* 34 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {'use strict';\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(32), __webpack_require__(10), __webpack_require__(8), __webpack_require__(6)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Masthead, Panel, Modal, BaseMVC) {\n\t\n\t    // ============================================================================\n\t    var PageLayoutView = Backbone.View.extend(BaseMVC.LoggableMixin).extend({\n\t        _logNamespace: 'layout',\n\t\n\t        el: 'body',\n\t        className: 'full-content',\n\t\n\t        _panelIds: ['left', 'center', 'right'],\n\t\n\t        defaultOptions: {\n\t            message_box_visible: false,\n\t            message_box_content: '',\n\t            message_box_class: 'info',\n\t            show_inactivity_warning: false,\n\t            inactivity_box_content: ''\n\t        },\n\t\n\t        initialize: function initialize(options) {\n\t            // TODO: remove globals\n\t            this.log(this + '.initialize:', options);\n\t            _.extend(this, _.pick(options, this._panelIds));\n\t            this.options = _.defaults(_.omit(options.config, this._panelIds), this.defaultOptions);\n\t            Galaxy.modal = this.modal = new Modal.View();\n\t            this.masthead = new Masthead.View(this.options);\n\t            this.$el.attr('scroll', 'no');\n\t            this.$el.html(this._template());\n\t            this.$el.append(this.masthead.frame.$el);\n\t            this.$('#masthead').replaceWith(this.masthead.$el);\n\t            this.$el.append(this.modal.$el);\n\t            this.$messagebox = this.$('#messagebox');\n\t            this.$inactivebox = this.$('#inactivebox');\n\t        },\n\t\n\t        render: function render() {\n\t            // TODO: Remove this line after select2 update\n\t            $('.select2-hidden-accessible').remove();\n\t            this.log(this + '.render:');\n\t            this.masthead.render();\n\t            this.renderMessageBox();\n\t            this.renderInactivityBox();\n\t            this.renderPanels();\n\t            return this;\n\t        },\n\t\n\t        /** Render message box */\n\t        renderMessageBox: function renderMessageBox() {\n\t            if (this.options.message_box_visible) {\n\t                var content = this.options.message_box_content || '';\n\t                var level = this.options.message_box_class || 'info';\n\t                this.$el.addClass('has-message-box');\n\t                this.$messagebox.attr('class', 'panel-' + level + '-message').html(content).toggle(!!content).show();\n\t            } else {\n\t                this.$el.removeClass('has-message-box');\n\t                this.$messagebox.hide();\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /** Render inactivity warning */\n\t        renderInactivityBox: function renderInactivityBox() {\n\t            if (this.options.show_inactivity_warning) {\n\t                var content = this.options.inactivity_box_content || '';\n\t                var verificationLink = $('<a/>').attr('href', Galaxy.root + 'user/resend_verification').text('Resend verification');\n\t                this.$el.addClass('has-inactivity-box');\n\t                this.$inactivebox.html(content + ' ').append(verificationLink).toggle(!!content).show();\n\t            } else {\n\t                this.$el.removeClass('has-inactivity-box');\n\t                this.$inactivebox.hide();\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /** Render panels */\n\t        renderPanels: function renderPanels() {\n\t            var page = this;\n\t            this._panelIds.forEach(function (panelId) {\n\t                if (_.has(page, panelId)) {\n\t                    page[panelId].setElement('#' + panelId);\n\t                    page[panelId].render();\n\t                }\n\t            });\n\t            if (!this.left) {\n\t                this.center.$el.css('left', 0);\n\t            }\n\t            if (!this.right) {\n\t                this.center.$el.css('right', 0);\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /** body template */\n\t        _template: function _template() {\n\t            return ['<div id=\"everything\">', '<div id=\"background\"/>', '<div id=\"masthead\"/>', '<div id=\"messagebox\"/>', '<div id=\"inactivebox\" class=\"panel-warning-message\" />', this.left ? '<div id=\"left\" />' : '', this.center ? '<div id=\"center\" class=\"inbound\" />' : '', this.right ? '<div id=\"right\" />' : '', '</div>', '<div id=\"dd-helper\" />'].join('');\n\t        },\n\t\n\t        /** hide both side panels if previously shown */\n\t        hideSidePanels: function hideSidePanels() {\n\t            if (this.left) {\n\t                this.left.hide();\n\t            }\n\t            if (this.right) {\n\t                this.right.hide();\n\t            }\n\t        },\n\t\n\t        toString: function toString() {\n\t            return 'PageLayoutView';\n\t        }\n\t    });\n\t\n\t    // ============================================================================\n\t    return {\n\t        PageLayoutView: PageLayoutView\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 35 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {'use strict';\n\t\n\t/** Frame manager uses the ui-frames to create the scratch book masthead icon and functionality **/\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(16)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Frames) {\n\t    return Backbone.View.extend({\n\t        initialize: function initialize(options) {\n\t            var self = this;\n\t            options = options || {};\n\t            this.frames = new Frames.View({ visible: false });\n\t            this.setElement(this.frames.$el);\n\t            this.buttonActive = options.collection.add({\n\t                id: 'enable-scratchbook',\n\t                icon: 'fa-th',\n\t                tooltip: 'Enable/Disable Scratchbook',\n\t                onclick: function onclick() {\n\t                    self.active = !self.active;\n\t                    self.buttonActive.set({\n\t                        toggle: self.active,\n\t                        show_note: self.active,\n\t                        note_cls: self.active && 'fa fa-check'\n\t                    });\n\t                    !self.active && self.frames.hide();\n\t                },\n\t                onbeforeunload: function onbeforeunload() {\n\t                    if (self.frames.length() > 0) {\n\t                        return 'You opened ' + self.frames.length() + ' frame(s) which will be lost.';\n\t                    }\n\t                }\n\t            });\n\t            this.buttonLoad = options.collection.add({\n\t                id: 'show-scratchbook',\n\t                icon: 'fa-eye',\n\t                tooltip: 'Show/Hide Scratchbook',\n\t                show_note: true,\n\t                visible: false,\n\t                onclick: function onclick(e) {\n\t                    self.frames.visible ? self.frames.hide() : self.frames.show();\n\t                }\n\t            });\n\t            this.frames.on('add remove', function () {\n\t                this.visible && this.length() == 0 && this.hide();\n\t                self.buttonLoad.set({ 'note': this.length(), 'visible': this.length() > 0 });\n\t            }).on('show hide ', function () {\n\t                self.buttonLoad.set({ 'toggle': this.visible, 'icon': this.visible && 'fa-eye' || 'fa-eye-slash' });\n\t            });\n\t            this.history_cache = {};\n\t        },\n\t\n\t        /** Add a dataset to the frames */\n\t        addDataset: function addDataset(dataset_id) {\n\t            var self = this;\n\t            var current_dataset = null;\n\t            if (Galaxy && Galaxy.currHistoryPanel) {\n\t                var history_id = Galaxy.currHistoryPanel.collection.historyId;\n\t                this.history_cache[history_id] = { name: Galaxy.currHistoryPanel.model.get('name'), dataset_ids: [] };\n\t                Galaxy.currHistoryPanel.collection.each(function (model) {\n\t                    !model.get('deleted') && model.get('visible') && self.history_cache[history_id].dataset_ids.push(model.get('id'));\n\t                });\n\t            }\n\t            var _findDataset = function _findDataset(dataset, offset) {\n\t                if (dataset) {\n\t                    var history_details = self.history_cache[dataset.get('history_id')];\n\t                    if (history_details && history_details.dataset_ids) {\n\t                        var dataset_list = history_details.dataset_ids;\n\t                        var pos = dataset_list.indexOf(dataset.get('id'));\n\t                        if (pos !== -1 && pos + offset >= 0 && pos + offset < dataset_list.length) {\n\t                            return dataset_list[pos + offset];\n\t                        }\n\t                    }\n\t                }\n\t            };\n\t            var _loadDatasetOffset = function _loadDatasetOffset(dataset, offset, frame) {\n\t                var new_dataset_id = _findDataset(dataset, offset);\n\t                if (new_dataset_id) {\n\t                    self._loadDataset(new_dataset_id, function (new_dataset, config) {\n\t                        current_dataset = new_dataset;\n\t                        frame.model.set(config);\n\t                    });\n\t                } else {\n\t                    frame.model.trigger('change');\n\t                }\n\t            };\n\t            this._loadDataset(dataset_id, function (dataset, config) {\n\t                current_dataset = dataset;\n\t                self.add(_.extend({ menu: [{ icon: 'fa fa-chevron-circle-left',\n\t                        tooltip: 'Previous in History',\n\t                        onclick: function onclick(frame) {\n\t                            _loadDatasetOffset(current_dataset, -1, frame);\n\t                        },\n\t                        disabled: function disabled() {\n\t                            return !_findDataset(current_dataset, -1);\n\t                        } }, { icon: 'fa fa-chevron-circle-right',\n\t                        tooltip: 'Next in History',\n\t                        onclick: function onclick(frame) {\n\t                            _loadDatasetOffset(current_dataset, 1, frame);\n\t                        },\n\t                        disabled: function disabled() {\n\t                            return !_findDataset(current_dataset, 1);\n\t                        } }] }, config));\n\t            });\n\t        },\n\t\n\t        _loadDataset: function _loadDataset(dataset_id, callback) {\n\t            var self = this;\n\t            __webpack_require__.e/* require */(1, function(__webpack_require__) { /* WEBPACK VAR INJECTION */(function($, _) {var __WEBPACK_AMD_REQUIRE_ARRAY__ = [__webpack_require__(11)]; (function (DATA) {\n\t                var dataset = new DATA.Dataset({ id: dataset_id });\n\t                $.when(dataset.fetch()).then(function () {\n\t                    var is_tabular = _.find(['tabular', 'interval'], function (data_type) {\n\t                        return dataset.get('data_type').indexOf(data_type) !== -1;\n\t                    });\n\t                    var title = dataset.get('name');\n\t                    var history_details = self.history_cache[dataset.get('history_id')];\n\t                    if (history_details) {\n\t                        title = history_details.name + ': ' + title;\n\t                    }\n\t                    callback(dataset, is_tabular ? {\n\t                        title: title,\n\t                        url: null,\n\t                        content: DATA.createTabularDatasetChunkedView({\n\t                            model: new DATA.TabularDataset(dataset.toJSON()),\n\t                            embedded: true,\n\t                            height: '100%'\n\t                        }).$el\n\t                    } : {\n\t                        title: title,\n\t                        url: Galaxy.root + 'datasets/' + dataset_id + '/display/?preview=True',\n\t                        content: null\n\t                    });\n\t                });\n\t            }.apply(null, __WEBPACK_AMD_REQUIRE_ARRAY__));\n\t/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(1), __webpack_require__(2)))});\n\t        },\n\t\n\t        /** Add a trackster visualization to the frames. */\n\t        addTrackster: function addTrackster(viz_id) {\n\t            var self = this;\n\t            __webpack_require__.e/* require */(0, function(__webpack_require__) { /* WEBPACK VAR INJECTION */(function($, _) {var __WEBPACK_AMD_REQUIRE_ARRAY__ = [__webpack_require__(30), __webpack_require__(92)]; (function (visualization, trackster) {\n\t                var viz = new visualization.Visualization({ id: viz_id });\n\t                $.when(viz.fetch()).then(function () {\n\t                    var ui = new trackster.TracksterUI(Galaxy.root);\n\t\n\t                    // Construct frame config based on dataset's type.\n\t                    var frame_config = {\n\t                        title: viz.get('name'),\n\t                        type: 'other',\n\t                        content: function content(parent_elt) {\n\t                            // Create view config.\n\t                            var view_config = {\n\t                                container: parent_elt,\n\t                                name: viz.get('title'),\n\t                                id: viz.id,\n\t                                // FIXME: this will not work with custom builds b/c the dbkey needed to be encoded.\n\t                                dbkey: viz.get('dbkey'),\n\t                                stand_alone: false\n\t                            },\n\t                                latest_revision = viz.get('latest_revision'),\n\t                                drawables = latest_revision.config.view.drawables;\n\t\n\t                            // Set up datasets in drawables.\n\t                            _.each(drawables, function (d) {\n\t                                d.dataset = {\n\t                                    hda_ldda: d.hda_ldda,\n\t                                    id: d.dataset_id\n\t                                };\n\t                            });\n\t                            view = ui.create_visualization(view_config, latest_revision.config.viewport, latest_revision.config.view.drawables, latest_revision.config.bookmarks, false);\n\t                        }\n\t                    };\n\t                    self.add(frame_config);\n\t                });\n\t            }.apply(null, __WEBPACK_AMD_REQUIRE_ARRAY__));\n\t/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(1), __webpack_require__(2)))});\n\t        },\n\t\n\t        /** Add and display a new frame/window based on options. */\n\t        add: function add(options) {\n\t            if (options.target == '_blank') {\n\t                window.open(options.url);\n\t            } else if (options.target == '_top' || options.target == '_parent' || options.target == '_self') {\n\t                window.location = options.url;\n\t            } else if (!this.active) {\n\t                var $galaxy_main = $(window.parent.document).find('#galaxy_main');\n\t                if (options.target == 'galaxy_main' || options.target == 'center') {\n\t                    if ($galaxy_main.length === 0) {\n\t                        window.location = options.url + (href.indexOf('?') == -1 ? '?' : '&') + 'use_panels=True';\n\t                    } else {\n\t                        $galaxy_main.attr('src', options.url);\n\t                    }\n\t                } else window.location = options.url;\n\t            } else {\n\t                this.frames.add(options);\n\t            }\n\t        }\n\t    });\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 36 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\t/**\n\t * Parser.js\n\t * Copyright 2012-13 Mayank Lahiri\n\t * mlahiri@gmail.com\n\t * Released under the BSD License.\n\t *\n\t * A forgiving Bibtex parser that can:\n\t * \n\t * (1) operate in streaming or block mode, extracting entries as dictionaries. \n\t * (2) convert Latex special characters to UTF-8.\n\t * (3) best-effort parse malformed entries.\n\t * (4) run in a CommonJS environment or a browser, without any dependencies.\n\t * (5) be advanced-compiled by Google Closure Compiler.\n\t * \n\t * Handwritten as a labor of love, not auto-generated from a grammar. \n\t *\n\t * Modes of usage:\n\t *\n\t * (1) Synchronous, string\n\t *\n\t *   var entries = BibtexParser(text);\n\t *   console.log(entries);\n\t *\n\t * (2) Asynchronous, stream\n\t *\n\t *   var entryCallback = function(entry) { console.log(entry); }\n\t *   var parser = new BibtexParser(entryCallback);\n\t *   parser.parse(chunk1);\n\t *   parser.parse(chunk2);\n\t *   ...\n\t * \n\t * @param {text|function(Object)} arg Either a Bibtex string or callback \n\t *                                    function for processing parsed entries.\n\t * @constructor\n\t */\n\tfunction BibtexParser(arg0) {\n\t  // Determine how this function is to be used\n\t  if (typeof arg0 == 'string') {\n\t    var accumulator = function accumulator(entry) {\n\t      entries.push(entry);\n\t    };\n\t\n\t    // Passed a string, synchronous call without 'new'\n\t    var tempStorage = {};\n\t    var entries = [];\n\t\n\t    var parser = BibtexParser.call(tempStorage, accumulator);\n\t    parser.parse(arg0);\n\t    return {\n\t      'entries': entries,\n\t      'errors': parser.getErrors()\n\t    };\n\t  }\n\t  if (typeof arg0 != 'function') {\n\t    throw 'Invalid parser construction.';\n\t  }\n\t\n\t  /** @enum {number} */\n\t  this.STATES_ = {\n\t    ENTRY_OR_JUNK: 0,\n\t    OBJECT_TYPE: 1,\n\t    ENTRY_KEY: 2,\n\t    KV_KEY: 3,\n\t    EQUALS: 4,\n\t    KV_VALUE: 5\n\t  };\n\t  /** @private */this.DATA_ = {};\n\t  /** @private */this.CALLBACK_ = arg0;\n\t  /** @private */this.CHAR_ = 0;\n\t  /** @private */this.LINE_ = 1;\n\t  /** @private */this.CHAR_IN_LINE_ = 0;\n\t  /** @private */this.SKIPWS_ = true;\n\t  /** @private */this.SKIPCOMMENT_ = true;\n\t  /** @private */this.PARSETMP_ = {};\n\t  /** @private */this.SKIPTILLEOL_ = false;\n\t  /** @private */this.VALBRACES_ = null;\n\t  /** @private */this.BRACETYPE_ = null;\n\t  /** @private */this.BRACECOUNT_ = 0;\n\t  /** @private */this.STATE_ = this.STATES_.ENTRY_OR_JUNK;\n\t  /** @private */this.ERRORS_ = [];\n\t  /** @private */this.ENTRY_TYPES_ = {\n\t    'inproceedings': 1,\n\t    'proceedings': 2,\n\t    'article': 3,\n\t    'techreport': 4,\n\t    'misc': 5,\n\t    'mastersthesis': 6,\n\t    'book': 7,\n\t    'phdthesis': 8,\n\t    'incollection': 9,\n\t    'unpublished': 10,\n\t    'inbook': 11,\n\t    'manual': 12,\n\t    'periodical': 13,\n\t    'booklet': 14,\n\t    'masterthesis': 15,\n\t    'conference': 16,\n\t    'online': 998 // Galaxy MOD: Handle @online entries for preprints.\n\t    , 'data': 999 // Galaxy MOD: Handle @data citations coming from figshare.\n\t  };\n\t  /** @private */this.MACROS_ = {\n\t    'jan': 'January',\n\t    'feb': 'February',\n\t    'mar': 'March',\n\t    'apr': 'April',\n\t    'may': 'May',\n\t    'jun': 'June',\n\t    'jul': 'July',\n\t    'aug': 'August',\n\t    'sep': 'September',\n\t    'oct': 'October',\n\t    'nov': 'November',\n\t    'dec': 'December',\n\t    'Jan': 'January',\n\t    'Feb': 'February',\n\t    'Mar': 'March',\n\t    'Apr': 'April',\n\t    'May': 'May',\n\t    'Jun': 'June',\n\t    'Jul': 'July',\n\t    'Aug': 'August',\n\t    'Sep': 'September',\n\t    'Oct': 'October',\n\t    'Nov': 'November',\n\t    'Dec': 'December'\n\t  };\n\t\n\t  /**\n\t   * Gets an array of all errors encountered during parsing.\n\t   * Array entries are of the format:\n\t   *  [ line number, character in line, character in stream, error text ]\n\t   *\n\t   * @returns Array<Array>\n\t   * @public\n\t   */\n\t  this.getErrors = function () {\n\t    return this.ERRORS_;\n\t  };\n\t\n\t  /**\n\t   * Processes a chunk of data\n\t   * @public\n\t   */\n\t  this.parse = function (chunk) {\n\t    for (var i = 0; i < chunk.length; i++) {\n\t      this.processCharacter_(chunk[i]);\n\t    }\n\t  };\n\t\n\t  /**\n\t   * Logs error at current stream position.\n\t   *\n\t   * @private\n\t   */\n\t  this.error_ = function (text) {\n\t    this.ERRORS_.push([this.LINE_, this.CHAR_IN_LINE_, this.CHAR_, text]);\n\t  };\n\t\n\t  /**\n\t   * Called after an entire entry has been parsed from the stream.\n\t   * Performs post-processing and invokes the entry callback pointed to by\n\t   * this.CALLBACK_. Parsed (but unprocessed) entry data is in this.DATA_.\n\t   */\n\t  this.processEntry_ = function () {\n\t    var data = this.DATA_;\n\t    if (data.Fields) for (var f in data.Fields) {\n\t      var raw = data.Fields[f];\n\t\n\t      // Convert Latex/Bibtex special characters to UTF-8 equivalents\n\t      for (var i = 0; i < this.CHARCONV_.length; i++) {\n\t        var re = this.CHARCONV_[i][0];\n\t        var rep = this.CHARCONV_[i][1];\n\t        raw = raw.replace(re, rep);\n\t      }\n\t\n\t      // Basic substitutions\n\t      raw = raw.replace(/[\\n\\r\\t]/g, ' ').replace(/\\s\\s+/g, ' ').replace(/^\\s+|\\s+$/g, '');\n\t\n\t      // Remove braces and backslashes\n\t      var len = raw.length;\n\t      var processed = '';\n\t      for (var i = 0; i < len; i++) {\n\t        var c = raw[i];\n\t        var skip = false;\n\t        if (c == '\\\\' && i < len - 1) c = raw[++i];else {\n\t          if (c == '{' || c == '}') skip = true;\n\t        }\n\t        if (!skip) processed += c;\n\t      }\n\t      data.Fields[f] = processed;\n\t    }\n\t\n\t    if (data.ObjectType == 'string') {\n\t      for (var f in data.Fields) {\n\t        this.MACROS_[f] = data.Fields[f];\n\t      }\n\t    } else {\n\t      // Parsed a new Bibtex entry\n\t      this.CALLBACK_(data);\n\t    }\n\t  };\n\t\n\t  /**\n\t   * Processes next character in the stream, invoking the callback after \n\t   * each entry has been found and processed.\n\t   * \n\t   * @private\n\t   * @param {string} c Next character in input stream\n\t   */\n\t  this.processCharacter_ = function (c) {\n\t    // Housekeeping\n\t    this.CHAR_++;\n\t    this.CHAR_IN_LINE_++;\n\t    if (c == '\\n') {\n\t      this.LINE_++;\n\t      this.CHAR_IN_LINE_ = 1;\n\t    }\n\t\n\t    // Convenience states for skipping whitespace when needed\n\t    if (this.SKIPTILLEOL_) {\n\t      if (c == '\\n') this.SKIPTILLEOL_ = false;\n\t      return;\n\t    }\n\t    if (this.SKIPCOMMENT_ && c == '%') {\n\t      this.SKIPTILLEOL_ = true;\n\t      return;\n\t    }\n\t    if (this.SKIPWS_ && /\\s/.test(c)) return;\n\t    this.SKIPWS_ = false;\n\t    this.SKIPCOMMENT_ = false;\n\t    this.SKIPTILLEOL_ = false;\n\t\n\t    // Main state machine\n\t    var AnotherIteration = true;\n\t    while (AnotherIteration) {\n\t      //console.log(this.LINE_, this.CHAR_IN_LINE_, this.STATE_, c)\n\t      AnotherIteration = false;\n\t      switch (this.STATE_) {\n\t        // -- Scan for an object marker ('@')\n\t        // -- Reset temporary data structure in case previous entry was garbled\n\t        case this.STATES_.ENTRY_OR_JUNK:\n\t          if (c == '@') {\n\t            // SUCCESS:     Parsed a valid start-of-object marker.\n\t            // NEXT_STATE:  OBJECT_TYPE\n\t            this.STATE_ = this.STATES_.OBJECT_TYPE;\n\t            this.DATA_ = {\n\t              ObjectType: ''\n\t            };\n\t          }\n\t          this.BRACETYPE_ = null;\n\t          this.SKIPWS_ = true;\n\t          this.SKIPCOMMENT_ = true;\n\t          break;\n\t\n\t        // Start at first non-whitespace character after start-of-object '@'\n\t        // -- Accept [A-Za-z], break on non-matching character\n\t        // -- Populate this.DATA_.EntryType and this.DATA_.ObjectType\n\t        case this.STATES_.OBJECT_TYPE:\n\t          if (/[A-Za-z]/.test(c)) {\n\t            this.DATA_.ObjectType += c.toLowerCase();\n\t            this.SKIPWS_ = true;\n\t            this.SKIPCOMMENT_ = true;\n\t          } else {\n\t            // Break from state and validate object type\n\t            var ot = this.DATA_.ObjectType;\n\t            if (ot == 'comment') {\n\t              this.STATE_ = this.STATES_.ENTRY_OR_JUNK;\n\t            } else {\n\t              if (ot == 'string') {\n\t                this.DATA_.ObjectType = ot;\n\t                this.DATA_.Fields = {};\n\t                this.BRACETYPE_ = c;\n\t                this.BRACECOUNT_ = 1;\n\t                this.STATE_ = this.STATES_.KV_KEY;\n\t                this.SKIPWS_ = true;\n\t                this.SKIPCOMMENT_ = true;\n\t                this.PARSETMP_ = {\n\t                  Key: ''\n\t                };\n\t              } else {\n\t                if (ot == 'preamble') {\n\t                  this.STATE_ = this.STATES_.ENTRY_OR_JUNK;\n\t                } else {\n\t                  if (ot in this.ENTRY_TYPES_) {\n\t                    // SUCCESS:     Parsed a valid object type.\n\t                    // NEXT_STATE:  ENTRY_KEY\n\t                    this.DATA_.ObjectType = 'entry';\n\t                    this.DATA_.EntryType = ot;\n\t                    this.DATA_.EntryKey = '';\n\t                    this.STATE_ = this.STATES_.ENTRY_KEY;\n\t                    AnotherIteration = true;\n\t                  } else {\n\t                    // ERROR:       Unrecognized object type.\n\t                    // NEXT_STATE:  ENTRY_OR_JUNK\n\t                    this.error_('Unrecognized object type: \"' + this.DATA_.ObjectType + '\"');\n\t                    this.STATE_ = this.STATES_.ENTRY_OR_JUNK;\n\t                  }\n\t                }\n\t              }\n\t            }\n\t          }\n\t          break;\n\t\n\t        // Start at first non-alphabetic character after an entry type\n\t        // -- Populate this.DATA_.EntryKey\n\t        case this.STATES_.ENTRY_KEY:\n\t          if ((c === '{' || c === '(') && this.BRACETYPE_ == null) {\n\t            this.BRACETYPE_ = c;\n\t            this.BRACECOUNT_ = 1;\n\t            this.SKIPWS_ = true;\n\t            this.SKIPCOMMENT_ = true;\n\t            break;\n\t          }\n\t          if (/[,%\\s]/.test(c)) {\n\t            if (this.DATA_.EntryKey.length < 1) {\n\t              // Skip comments and whitespace before entry key\n\t              this.SKIPWS_ = true;\n\t              this.SKIPCOMMENT_ = true;\n\t            } else {\n\t              if (this.BRACETYPE_ == null) {\n\t                // ERROR:       No opening brace for object\n\t                // NEXT_STATE:  ENTRY_OR_JUNK\n\t                this.error_('No opening brace for object.');\n\t                this.STATE_ = this.STATES_.ENTRY_OR_JUNK;\n\t              } else {\n\t                // SUCCESS:     Parsed an entry key\n\t                // NEXT_STATE:  KV_KEY\n\t                this.SKIPWS_ = true;\n\t                this.SKIPCOMMENT_ = true;\n\t                AnotherIteration = true;\n\t                this.STATE_ = this.STATES_.KV_KEY;\n\t                this.PARSETMP_.Key = '';\n\t                this.DATA_.Fields = {};\n\t              }\n\t            }\n\t          } else {\n\t            this.DATA_.EntryKey += c;\n\t            this.SKIPWS_ = false;\n\t            this.SKIPCOMMENT_ = false;\n\t          }\n\t          break;\n\t\n\t        // Start at first non-whitespace/comment character after entry key.\n\t        // -- Populate this.PARSETMP_.Key\n\t        case this.STATES_.KV_KEY:\n\t          // Test for end of entry\n\t          if (c == '}' && this.BRACETYPE_ == '{' || c == ')' && this.BRACETYPE_ == '(') {\n\t            // SUCCESS:       Parsed an entry, possible incomplete\n\t            // NEXT_STATE:    ENTRY_OR_JUNK\n\t            this.processEntry_();\n\t            this.SKIPWS_ = true;\n\t            this.SKIPCOMMENT_ = true;\n\t            this.STATE_ = this.STATES_.ENTRY_OR_JUNK;\n\t            break;\n\t          }\n\t          if (/[\\-A-Za-z:]/.test(c)) {\n\t            // Add to key\n\t            this.PARSETMP_.Key += c;\n\t            this.SKIPWS_ = false;\n\t            this.SKIPCOMMENT_ = false;\n\t          } else {\n\t            // Either end of key or we haven't encountered start of key\n\t            if (this.PARSETMP_.Key.length < 1) {\n\t              // Keep going till we see a key\n\t              this.SKIPWS_ = true;\n\t              this.SKIPCOMMENT_ = true;\n\t            } else {\n\t              // SUCCESS:       Found full key in K/V pair\n\t              // NEXT_STATE:    EQUALS\n\t              this.SKIPWS_ = true;\n\t              this.SKIPCOMMENT_ = true;\n\t              this.STATE_ = this.STATES_.EQUALS;\n\t              AnotherIteration = true;\n\t            }\n\t          }\n\t          break;\n\t\n\t        // Start at first non-alphabetic character after K/V pair key.\n\t        case this.STATES_.EQUALS:\n\t          if (c == '}' && this.BRACETYPE_ == '{' || c == ')' && this.BRACETYPE_ == '(') {\n\t            // ERROR:         K/V pair with key but no value\n\t            // NEXT_STATE:    ENTRY_OR_JUNK\n\t            this.error_('Key-value pair has key \"' + this.PARSETMP_.Key + '\", but no value.');\n\t            this.processEntry_();\n\t            this.SKIPWS_ = true;\n\t            this.SKIPCOMMENT_ = true;\n\t            this.STATE_ = this.STATES_.ENTRY_OR_JUNK;\n\t            break;\n\t          }\n\t          if (c == '=') {\n\t            // SUCCESS:       found an equal signs separating key and value\n\t            // NEXT_STATE:    KV_VALUE\n\t            this.SKIPWS_ = true;\n\t            this.SKIPCOMMENT_ = true;\n\t            this.STATE_ = this.STATES_.KV_VALUE;\n\t            this.PARSETMP_.Value = '';\n\t            this.VALBRACES_ = { '\"': [], '{': [] };\n\t          }\n\t          break;\n\t\n\t        // Start at first non-whitespace/comment character after '=' \n\t        // -- Populate this.PARSETMP_.Value\n\t        case this.STATES_.KV_VALUE:\n\t          var delim = this.VALBRACES_;\n\t          var val = this.PARSETMP_.Value;\n\t          var doneParsingValue = false;\n\t\n\t          // Test for special characters\n\t          if (c == '\"' || c == '{' || c == '}' || c == ',') {\n\t            if (c == ',') {\n\t              // This comma can mean:\n\t              // (1) just another comma literal\n\t              // (2) end of a macro reference\n\t              if (0 === delim['\"'].length + delim['{'].length) {\n\t                // end of a macro reference\n\t                var macro = this.PARSETMP_.Value.trim();\n\t                if (macro in this.MACROS_) {\n\t                  // Successful macro reference\n\t                  this.PARSETMP_.Value = this.MACROS_[macro];\n\t                } else {\n\t                  // Reference to an undefined macro\n\t                  this.error_('Reference to an undefined macro: ' + macro);\n\t                }\n\t                doneParsingValue = true;\n\t              }\n\t            }\n\t            if (c == '\"') {\n\t              // This quote can mean:\n\t              // (1) opening delimiter\n\t              // (2) closing delimiter\n\t              // (3) literal, if we have a '{' on the stack\n\t              if (0 === delim['\"'].length + delim['{'].length) {\n\t                // opening delimiter\n\t                delim['\"'].push(this.CHAR_);\n\t                this.SKIPWS_ = false;\n\t                this.SKIPCOMMENT_ = false;\n\t                break;\n\t              }\n\t              if (delim['\"'].length == 1 && delim['{'].length == 0 && (val.length == 0 || val[val.length - 1] != '\\\\')) {\n\t                // closing delimiter\n\t                doneParsingValue = true;\n\t              } else {\n\t                // literal, add to value\n\t              }\n\t            }\n\t            if (c == '{') {\n\t              // This brace can mean:\n\t              // (1) opening delimiter\n\t              // (2) stacked verbatim delimiter\n\t              if (val.length == 0 || val[val.length - 1] != '\\\\') {\n\t                delim['{'].push(this.CHAR_);\n\t                this.SKIPWS_ = false;\n\t                this.SKIPCOMMENT_ = false;\n\t              } else {\n\t                // literal, add to value\n\t              }\n\t            }\n\t            if (c == '}') {\n\t              // This brace can mean:\n\t              // (1) closing delimiter\n\t              // (2) closing stacked verbatim delimiter\n\t              // (3) end of object definition if value was a macro\n\t              if (0 === delim['\"'].length + delim['{'].length) {\n\t                // end of object definition, after macro\n\t                var macro = this.PARSETMP_.Value.trim();\n\t                if (macro in this.MACROS_) {\n\t                  // Successful macro reference\n\t                  this.PARSETMP_.Value = this.MACROS_[macro];\n\t                } else {\n\t                  // Reference to an undefined macro\n\t                  this.error_('Reference to an undefined macro: ' + macro);\n\t                }\n\t                AnotherIteration = true;\n\t                doneParsingValue = true;\n\t              } else {\n\t                if (val.length == 0 || val[val.length - 1] != '\\\\') {\n\t                  if (delim['{'].length > 0) {\n\t                    // pop stack for stacked verbatim delimiter\n\t                    delim['{'].splice(delim['{'].length - 1, 1);\n\t                    if (0 == delim['{'].length + delim['\"'].length) {\n\t                      // closing delimiter\n\t                      doneParsingValue = true;\n\t                    } else {\n\t                      // end verbatim block\n\t                    }\n\t                  }\n\t                } else {\n\t                    // literal, add to value\n\t                  }\n\t              }\n\t            }\n\t          }\n\t\n\t          // If here, then we are either done parsing the value or \n\t          // have a literal that should be added to the value.\n\t          if (doneParsingValue) {\n\t            // SUCCESS:     value parsed\n\t            // NEXT_STATE:  KV_KEY\n\t            this.SKIPWS_ = true;\n\t            this.SKIPCOMMENT_ = true;\n\t            this.STATE_ = this.STATES_.KV_KEY;\n\t            this.DATA_.Fields[this.PARSETMP_.Key] = this.PARSETMP_.Value;\n\t            this.PARSETMP_ = { Key: '' };\n\t            this.VALBRACES_ = null;\n\t          } else {\n\t            this.PARSETMP_.Value += c;\n\t          }\n\t          break;\n\t      } // end switch (this.STATE_)\n\t    } // end while(AnotherIteration)\n\t  }; // end function processCharacter \n\t\n\t  /** @private */this.CHARCONV_ = [[/\\\\space /g, ' '], [/\\\\textdollar /g, '$'], [/\\\\textquotesingle /g, '\\''], [/\\\\ast /g, '*'], [/\\\\textbackslash /g, '\\\\'], [/\\\\\\^\\{\\}/g, '^'], [/\\\\textasciigrave /g, '`'], [/\\\\lbrace /g, '{'], [/\\\\vert /g, '|'], [/\\\\rbrace /g, '}'], [/\\\\textasciitilde /g, '~'], [/\\\\textexclamdown /g, '¡'], [/\\\\textcent /g, '¢'], [/\\\\textsterling /g, '£'], [/\\\\textcurrency /g, '¤'], [/\\\\textyen /g, '¥'], [/\\\\textbrokenbar /g, '¦'], [/\\\\textsection /g, '§'], [/\\\\textasciidieresis /g, '¨'], [/\\\\textcopyright /g, '©'], [/\\\\textordfeminine /g, 'ª'], [/\\\\guillemotleft /g, '«'], [/\\\\lnot /g, '¬'], [/\\\\textregistered /g, '®'], [/\\\\textasciimacron /g, '¯'], [/\\\\textdegree /g, '°'], [/\\\\pm /g, '±'], [/\\\\textasciiacute /g, '´'], [/\\\\mathrm\\{\\\\mu\\}/g, 'µ'], [/\\\\textparagraph /g, '¶'], [/\\\\cdot /g, '·'], [/\\\\c\\{\\}/g, '¸'], [/\\\\textordmasculine /g, 'º'], [/\\\\guillemotright /g, '»'], [/\\\\textonequarter /g, '¼'], [/\\\\textonehalf /g, '½'], [/\\\\textthreequarters /g, '¾'], [/\\\\textquestiondown /g, '¿'], [/\\\\`\\{A\\}/g, 'À'], [/\\\\'\\{A\\}/g, 'Á'], [/\\\\\\^\\{A\\}/g, 'Â'], [/\\\\~\\{A\\}/g, 'Ã'], [/\\\\\"\\{A\\}/g, 'Ä'], [/\\\\AA /g, 'Å'], [/\\\\AE /g, 'Æ'], [/\\\\c\\{C\\}/g, 'Ç'], [/\\\\`\\{E\\}/g, 'È'], [/\\\\'\\{E\\}/g, 'É'], [/\\\\\\^\\{E\\}/g, 'Ê'], [/\\\\\"\\{E\\}/g, 'Ë'], [/\\\\`\\{I\\}/g, 'Ì'], [/\\\\'\\{I\\}/g, 'Í'], [/\\\\\\^\\{I\\}/g, 'Î'], [/\\\\\"\\{I\\}/g, 'Ï'], [/\\\\DH /g, 'Ð'], [/\\\\~\\{N\\}/g, 'Ñ'], [/\\\\`\\{O\\}/g, 'Ò'], [/\\\\'\\{O\\}/g, 'Ó'], [/\\\\\\^\\{O\\}/g, 'Ô'], [/\\\\~\\{O\\}/g, 'Õ'], [/\\\\\"\\{O\\}/g, 'Ö'], [/\\\\texttimes /g, '×'], [/\\\\O /g, 'Ø'], [/\\\\`\\{U\\}/g, 'Ù'], [/\\\\'\\{U\\}/g, 'Ú'], [/\\\\\\^\\{U\\}/g, 'Û'], [/\\\\\"\\{U\\}/g, 'Ü'], [/\\\\'\\{Y\\}/g, 'Ý'], [/\\\\TH /g, 'Þ'], [/\\\\ss /g, 'ß'], [/\\\\`\\{a\\}/g, 'à'], [/\\\\'\\{a\\}/g, 'á'], [/\\\\\\^\\{a\\}/g, 'â'], [/\\\\~\\{a\\}/g, 'ã'], [/\\\\\"\\{a\\}/g, 'ä'], [/\\\\aa /g, 'å'], [/\\\\ae /g, 'æ'], [/\\\\c\\{c\\}/g, 'ç'], [/\\\\`\\{e\\}/g, 'è'], [/\\\\'\\{e\\}/g, 'é'], [/\\\\\\^\\{e\\}/g, 'ê'], [/\\\\\"\\{e\\}/g, 'ë'], [/\\\\`\\{\\\\i\\}/g, 'ì'], [/\\\\'\\{\\\\i\\}/g, 'í'], [/\\\\\\^\\{\\\\i\\}/g, 'î'], [/\\\\\"\\{\\\\i\\}/g, 'ï'], [/\\\\dh /g, 'ð'], [/\\\\~\\{n\\}/g, 'ñ'], [/\\\\`\\{o\\}/g, 'ò'], [/\\\\'\\{o\\}/g, 'ó'], [/\\\\\\^\\{o\\}/g, 'ô'], [/\\\\~\\{o\\}/g, 'õ'], [/\\\\\"\\{o\\}/g, 'ö'], [/\\\\div /g, '÷'], [/\\\\o /g, 'ø'], [/\\\\`\\{u\\}/g, 'ù'], [/\\\\'\\{u\\}/g, 'ú'], [/\\\\\\^\\{u\\}/g, 'û'], [/\\\\\"\\{u\\}/g, 'ü'], [/\\\\'\\{y\\}/g, 'ý'], [/\\\\th /g, 'þ'], [/\\\\\"\\{y\\}/g, 'ÿ'], [/\\\\=\\{A\\}/g, 'Ā'], [/\\\\=\\{a\\}/g, 'ā'], [/\\\\u\\{A\\}/g, 'Ă'], [/\\\\u\\{a\\}/g, 'ă'], [/\\\\k\\{A\\}/g, 'Ą'], [/\\\\k\\{a\\}/g, 'ą'], [/\\\\'\\{C\\}/g, 'Ć'], [/\\\\'\\{c\\}/g, 'ć'], [/\\\\\\^\\{C\\}/g, 'Ĉ'], [/\\\\\\^\\{c\\}/g, 'ĉ'], [/\\\\.\\{C\\}/g, 'Ċ'], [/\\\\.\\{c\\}/g, 'ċ'], [/\\\\v\\{C\\}/g, 'Č'], [/\\\\v\\{c\\}/g, 'č'], [/\\\\v\\{D\\}/g, 'Ď'], [/\\\\v\\{d\\}/g, 'ď'], [/\\\\DJ /g, 'Đ'], [/\\\\dj /g, 'đ'], [/\\\\=\\{E\\}/g, 'Ē'], [/\\\\=\\{e\\}/g, 'ē'], [/\\\\u\\{E\\}/g, 'Ĕ'], [/\\\\u\\{e\\}/g, 'ĕ'], [/\\\\.\\{E\\}/g, 'Ė'], [/\\\\.\\{e\\}/g, 'ė'], [/\\\\k\\{E\\}/g, 'Ę'], [/\\\\k\\{e\\}/g, 'ę'], [/\\\\v\\{E\\}/g, 'Ě'], [/\\\\v\\{e\\}/g, 'ě'], [/\\\\\\^\\{G\\}/g, 'Ĝ'], [/\\\\\\^\\{g\\}/g, 'ĝ'], [/\\\\u\\{G\\}/g, 'Ğ'], [/\\\\u\\{g\\}/g, 'ğ'], [/\\\\.\\{G\\}/g, 'Ġ'], [/\\\\.\\{g\\}/g, 'ġ'], [/\\\\c\\{G\\}/g, 'Ģ'], [/\\\\c\\{g\\}/g, 'ģ'], [/\\\\\\^\\{H\\}/g, 'Ĥ'], [/\\\\\\^\\{h\\}/g, 'ĥ'], [/\\\\Elzxh /g, 'ħ'], [/\\\\~\\{I\\}/g, 'Ĩ'], [/\\\\~\\{\\\\i\\}/g, 'ĩ'], [/\\\\=\\{I\\}/g, 'Ī'], [/\\\\=\\{\\\\i\\}/g, 'ī'], [/\\\\u\\{I\\}/g, 'Ĭ'], [/\\\\u\\{\\\\i\\}/g, 'ĭ'], [/\\\\k\\{I\\}/g, 'Į'], [/\\\\k\\{i\\}/g, 'į'], [/\\\\.\\{I\\}/g, 'İ'], [/\\\\i /g, 'ı'], [/\\\\\\^\\{J\\}/g, 'Ĵ'], [/\\\\\\^\\{\\\\j\\}/g, 'ĵ'], [/\\\\c\\{K\\}/g, 'Ķ'], [/\\\\c\\{k\\}/g, 'ķ'], [/\\\\'\\{L\\}/g, 'Ĺ'], [/\\\\'\\{l\\}/g, 'ĺ'], [/\\\\c\\{L\\}/g, 'Ļ'], [/\\\\c\\{l\\}/g, 'ļ'], [/\\\\v\\{L\\}/g, 'Ľ'], [/\\\\v\\{l\\}/g, 'ľ'], [/\\\\L /g, 'Ł'], [/\\\\l /g, 'ł'], [/\\\\'\\{N\\}/g, 'Ń'], [/\\\\'\\{n\\}/g, 'ń'], [/\\\\c\\{N\\}/g, 'Ņ'], [/\\\\c\\{n\\}/g, 'ņ'], [/\\\\v\\{N\\}/g, 'Ň'], [/\\\\v\\{n\\}/g, 'ň'], [/\\\\NG /g, 'Ŋ'], [/\\\\ng /g, 'ŋ'], [/\\\\=\\{O\\}/g, 'Ō'], [/\\\\=\\{o\\}/g, 'ō'], [/\\\\u\\{O\\}/g, 'Ŏ'], [/\\\\u\\{o\\}/g, 'ŏ'], [/\\\\H\\{O\\}/g, 'Ő'], [/\\\\H\\{o\\}/g, 'ő'], [/\\\\OE /g, 'Œ'], [/\\\\oe /g, 'œ'], [/\\\\'\\{R\\}/g, 'Ŕ'], [/\\\\'\\{r\\}/g, 'ŕ'], [/\\\\c\\{R\\}/g, 'Ŗ'], [/\\\\c\\{r\\}/g, 'ŗ'], [/\\\\v\\{R\\}/g, 'Ř'], [/\\\\v\\{r\\}/g, 'ř'], [/\\\\'\\{S\\}/g, 'Ś'], [/\\\\'\\{s\\}/g, 'ś'], [/\\\\\\^\\{S\\}/g, 'Ŝ'], [/\\\\\\^\\{s\\}/g, 'ŝ'], [/\\\\c\\{S\\}/g, 'Ş'], [/\\\\c\\{s\\}/g, 'ş'], [/\\\\v\\{S\\}/g, 'Š'], [/\\\\v\\{s\\}/g, 'š'], [/\\\\c\\{T\\}/g, 'Ţ'], [/\\\\c\\{t\\}/g, 'ţ'], [/\\\\v\\{T\\}/g, 'Ť'], [/\\\\v\\{t\\}/g, 'ť'], [/\\\\~\\{U\\}/g, 'Ũ'], [/\\\\~\\{u\\}/g, 'ũ'], [/\\\\=\\{U\\}/g, 'Ū'], [/\\\\=\\{u\\}/g, 'ū'], [/\\\\u\\{U\\}/g, 'Ŭ'], [/\\\\u\\{u\\}/g, 'ŭ'], [/\\\\r\\{U\\}/g, 'Ů'], [/\\\\r\\{u\\}/g, 'ů'], [/\\\\H\\{U\\}/g, 'Ű'], [/\\\\H\\{u\\}/g, 'ű'], [/\\\\k\\{U\\}/g, 'Ų'], [/\\\\k\\{u\\}/g, 'ų'], [/\\\\\\^\\{W\\}/g, 'Ŵ'], [/\\\\\\^\\{w\\}/g, 'ŵ'], [/\\\\\\^\\{Y\\}/g, 'Ŷ'], [/\\\\\\^\\{y\\}/g, 'ŷ'], [/\\\\\"\\{Y\\}/g, 'Ÿ'], [/\\\\'\\{Z\\}/g, 'Ź'], [/\\\\'\\{z\\}/g, 'ź'], [/\\\\.\\{Z\\}/g, 'Ż'], [/\\\\.\\{z\\}/g, 'ż'], [/\\\\v\\{Z\\}/g, 'Ž'], [/\\\\v\\{z\\}/g, 'ž'], [/\\\\texthvlig /g, 'ƕ'], [/\\\\textnrleg /g, 'ƞ'], [/\\\\eth /g, 'ƪ'], [/\\\\textdoublepipe /g, 'ǂ'], [/\\\\'\\{g\\}/g, 'ǵ'], [/\\\\Elztrna /g, 'ɐ'], [/\\\\Elztrnsa /g, 'ɒ'], [/\\\\Elzopeno /g, 'ɔ'], [/\\\\Elzrtld /g, 'ɖ'], [/\\\\Elzschwa /g, 'ə'], [/\\\\varepsilon /g, 'ɛ'], [/\\\\Elzpgamma /g, 'ɣ'], [/\\\\Elzpbgam /g, 'ɤ'], [/\\\\Elztrnh /g, 'ɥ'], [/\\\\Elzbtdl /g, 'ɬ'], [/\\\\Elzrtll /g, 'ɭ'], [/\\\\Elztrnm /g, 'ɯ'], [/\\\\Elztrnmlr /g, 'ɰ'], [/\\\\Elzltlmr /g, 'ɱ'], [/\\\\Elzltln /g, 'ɲ'], [/\\\\Elzrtln /g, 'ɳ'], [/\\\\Elzclomeg /g, 'ɷ'], [/\\\\textphi /g, 'ɸ'], [/\\\\Elztrnr /g, 'ɹ'], [/\\\\Elztrnrl /g, 'ɺ'], [/\\\\Elzrttrnr /g, 'ɻ'], [/\\\\Elzrl /g, 'ɼ'], [/\\\\Elzrtlr /g, 'ɽ'], [/\\\\Elzfhr /g, 'ɾ'], [/\\\\Elzrtls /g, 'ʂ'], [/\\\\Elzesh /g, 'ʃ'], [/\\\\Elztrnt /g, 'ʇ'], [/\\\\Elzrtlt /g, 'ʈ'], [/\\\\Elzpupsil /g, 'ʊ'], [/\\\\Elzpscrv /g, 'ʋ'], [/\\\\Elzinvv /g, 'ʌ'], [/\\\\Elzinvw /g, 'ʍ'], [/\\\\Elztrny /g, 'ʎ'], [/\\\\Elzrtlz /g, 'ʐ'], [/\\\\Elzyogh /g, 'ʒ'], [/\\\\Elzglst /g, 'ʔ'], [/\\\\Elzreglst /g, 'ʕ'], [/\\\\Elzinglst /g, 'ʖ'], [/\\\\textturnk /g, 'ʞ'], [/\\\\Elzdyogh /g, 'ʤ'], [/\\\\Elztesh /g, 'ʧ'], [/\\\\textasciicaron /g, 'ˇ'], [/\\\\Elzverts /g, 'ˈ'], [/\\\\Elzverti /g, 'ˌ'], [/\\\\Elzlmrk /g, 'ː'], [/\\\\Elzhlmrk /g, 'ˑ'], [/\\\\Elzsbrhr /g, '˒'], [/\\\\Elzsblhr /g, '˓'], [/\\\\Elzrais /g, '˔'], [/\\\\Elzlow /g, '˕'], [/\\\\textasciibreve /g, '˘'], [/\\\\textperiodcentered /g, '˙'], [/\\\\r\\{\\}/g, '˚'], [/\\\\k\\{\\}/g, '˛'], [/\\\\texttildelow /g, '˜'], [/\\\\H\\{\\}/g, '˝'], [/\\\\tone\\{55\\}/g, '˥'], [/\\\\tone\\{44\\}/g, '˦'], [/\\\\tone\\{33\\}/g, '˧'], [/\\\\tone\\{22\\}/g, '˨'], [/\\\\tone\\{11\\}/g, '˩'], [/\\\\cyrchar\\\\C/g, '̏'], [/\\\\Elzpalh /g, '̡'], [/\\\\Elzrh /g, '̢'], [/\\\\Elzsbbrg /g, '̪'], [/\\\\Elzxl /g, '̵'], [/\\\\Elzbar /g, '̶'], [/\\\\'\\{A\\}/g, 'Ά'], [/\\\\'\\{E\\}/g, 'Έ'], [/\\\\'\\{H\\}/g, 'Ή'], [/\\\\'\\{\\}\\{I\\}/g, 'Ί'], [/\\\\'\\{\\}O/g, 'Ό'], [/\\\\mathrm\\{'Y\\}/g, 'Ύ'], [/\\\\mathrm\\{'\\\\Omega\\}/g, 'Ώ'], [/\\\\acute\\{\\\\ddot\\{\\\\iota\\}\\}/g, 'ΐ'], [/\\\\Alpha /g, 'Α'], [/\\\\Beta /g, 'Β'], [/\\\\Gamma /g, 'Γ'], [/\\\\Delta /g, 'Δ'], [/\\\\Epsilon /g, 'Ε'], [/\\\\Zeta /g, 'Ζ'], [/\\\\Eta /g, 'Η'], [/\\\\Theta /g, 'Θ'], [/\\\\Iota /g, 'Ι'], [/\\\\Kappa /g, 'Κ'], [/\\\\Lambda /g, 'Λ'], [/\\\\Xi /g, 'Ξ'], [/\\\\Pi /g, 'Π'], [/\\\\Rho /g, 'Ρ'], [/\\\\Sigma /g, 'Σ'], [/\\\\Tau /g, 'Τ'], [/\\\\Upsilon /g, 'Υ'], [/\\\\Phi /g, 'Φ'], [/\\\\Chi /g, 'Χ'], [/\\\\Psi /g, 'Ψ'], [/\\\\Omega /g, 'Ω'], [/\\\\mathrm\\{\\\\ddot\\{I\\}\\}/g, 'Ϊ'], [/\\\\mathrm\\{\\\\ddot\\{Y\\}\\}/g, 'Ϋ'], [/\\\\'\\{\\$\\\\alpha\\$\\}/g, 'ά'], [/\\\\acute\\{\\\\epsilon\\}/g, 'έ'], [/\\\\acute\\{\\\\eta\\}/g, 'ή'], [/\\\\acute\\{\\\\iota\\}/g, 'ί'], [/\\\\acute\\{\\\\ddot\\{\\\\upsilon\\}\\}/g, 'ΰ'], [/\\\\alpha /g, 'α'], [/\\\\beta /g, 'β'], [/\\\\gamma /g, 'γ'], [/\\\\delta /g, 'δ'], [/\\\\epsilon /g, 'ε'], [/\\\\zeta /g, 'ζ'], [/\\\\eta /g, 'η'], [/\\\\texttheta /g, 'θ'], [/\\\\iota /g, 'ι'], [/\\\\kappa /g, 'κ'], [/\\\\lambda /g, 'λ'], [/\\\\mu /g, 'μ'], [/\\\\nu /g, 'ν'], [/\\\\xi /g, 'ξ'], [/\\\\pi /g, 'π'], [/\\\\rho /g, 'ρ'], [/\\\\varsigma /g, 'ς'], [/\\\\sigma /g, 'σ'], [/\\\\tau /g, 'τ'], [/\\\\upsilon /g, 'υ'], [/\\\\varphi /g, 'φ'], [/\\\\chi /g, 'χ'], [/\\\\psi /g, 'ψ'], [/\\\\omega /g, 'ω'], [/\\\\ddot\\{\\\\iota\\}/g, 'ϊ'], [/\\\\ddot\\{\\\\upsilon\\}/g, 'ϋ'], [/\\\\'\\{o\\}/g, 'ό'], [/\\\\acute\\{\\\\upsilon\\}/g, 'ύ'], [/\\\\acute\\{\\\\omega\\}/g, 'ώ'], [/\\\\Pisymbol\\{ppi022\\}\\{87\\}/g, 'ϐ'], [/\\\\textvartheta /g, 'ϑ'], [/\\\\Upsilon /g, 'ϒ'], [/\\\\phi /g, 'ϕ'], [/\\\\varpi /g, 'ϖ'], [/\\\\Stigma /g, 'Ϛ'], [/\\\\Digamma /g, 'Ϝ'], [/\\\\digamma /g, 'ϝ'], [/\\\\Koppa /g, 'Ϟ'], [/\\\\Sampi /g, 'Ϡ'], [/\\\\varkappa /g, 'ϰ'], [/\\\\varrho /g, 'ϱ'], [/\\\\textTheta /g, 'ϴ'], [/\\\\backepsilon /g, '϶'], [/\\\\cyrchar\\\\CYRYO /g, 'Ё'], [/\\\\cyrchar\\\\CYRDJE /g, 'Ђ'], [/\\\\cyrchar\\{\\\\'\\\\CYRG\\}/g, 'Ѓ'], [/\\\\cyrchar\\\\CYRIE /g, 'Є'], [/\\\\cyrchar\\\\CYRDZE /g, 'Ѕ'], [/\\\\cyrchar\\\\CYRII /g, 'І'], [/\\\\cyrchar\\\\CYRYI /g, 'Ї'], [/\\\\cyrchar\\\\CYRJE /g, 'Ј'], [/\\\\cyrchar\\\\CYRLJE /g, 'Љ'], [/\\\\cyrchar\\\\CYRNJE /g, 'Њ'], [/\\\\cyrchar\\\\CYRTSHE /g, 'Ћ'], [/\\\\cyrchar\\{\\\\'\\\\CYRK\\}/g, 'Ќ'], [/\\\\cyrchar\\\\CYRUSHRT /g, 'Ў'], [/\\\\cyrchar\\\\CYRDZHE /g, 'Џ'], [/\\\\cyrchar\\\\CYRA /g, 'А'], [/\\\\cyrchar\\\\CYRB /g, 'Б'], [/\\\\cyrchar\\\\CYRV /g, 'В'], [/\\\\cyrchar\\\\CYRG /g, 'Г'], [/\\\\cyrchar\\\\CYRD /g, 'Д'], [/\\\\cyrchar\\\\CYRE /g, 'Е'], [/\\\\cyrchar\\\\CYRZH /g, 'Ж'], [/\\\\cyrchar\\\\CYRZ /g, 'З'], [/\\\\cyrchar\\\\CYRI /g, 'И'], [/\\\\cyrchar\\\\CYRISHRT /g, 'Й'], [/\\\\cyrchar\\\\CYRK /g, 'К'], [/\\\\cyrchar\\\\CYRL /g, 'Л'], [/\\\\cyrchar\\\\CYRM /g, 'М'], [/\\\\cyrchar\\\\CYRN /g, 'Н'], [/\\\\cyrchar\\\\CYRO /g, 'О'], [/\\\\cyrchar\\\\CYRP /g, 'П'], [/\\\\cyrchar\\\\CYRR /g, 'Р'], [/\\\\cyrchar\\\\CYRS /g, 'С'], [/\\\\cyrchar\\\\CYRT /g, 'Т'], [/\\\\cyrchar\\\\CYRU /g, 'У'], [/\\\\cyrchar\\\\CYRF /g, 'Ф'], [/\\\\cyrchar\\\\CYRH /g, 'Х'], [/\\\\cyrchar\\\\CYRC /g, 'Ц'], [/\\\\cyrchar\\\\CYRCH /g, 'Ч'], [/\\\\cyrchar\\\\CYRSH /g, 'Ш'], [/\\\\cyrchar\\\\CYRSHCH /g, 'Щ'], [/\\\\cyrchar\\\\CYRHRDSN /g, 'Ъ'], [/\\\\cyrchar\\\\CYRERY /g, 'Ы'], [/\\\\cyrchar\\\\CYRSFTSN /g, 'Ь'], [/\\\\cyrchar\\\\CYREREV /g, 'Э'], [/\\\\cyrchar\\\\CYRYU /g, 'Ю'], [/\\\\cyrchar\\\\CYRYA /g, 'Я'], [/\\\\cyrchar\\\\cyra /g, 'а'], [/\\\\cyrchar\\\\cyrb /g, 'б'], [/\\\\cyrchar\\\\cyrv /g, 'в'], [/\\\\cyrchar\\\\cyrg /g, 'г'], [/\\\\cyrchar\\\\cyrd /g, 'д'], [/\\\\cyrchar\\\\cyre /g, 'е'], [/\\\\cyrchar\\\\cyrzh /g, 'ж'], [/\\\\cyrchar\\\\cyrz /g, 'з'], [/\\\\cyrchar\\\\cyri /g, 'и'], [/\\\\cyrchar\\\\cyrishrt /g, 'й'], [/\\\\cyrchar\\\\cyrk /g, 'к'], [/\\\\cyrchar\\\\cyrl /g, 'л'], [/\\\\cyrchar\\\\cyrm /g, 'м'], [/\\\\cyrchar\\\\cyrn /g, 'н'], [/\\\\cyrchar\\\\cyro /g, 'о'], [/\\\\cyrchar\\\\cyrp /g, 'п'], [/\\\\cyrchar\\\\cyrr /g, 'р'], [/\\\\cyrchar\\\\cyrs /g, 'с'], [/\\\\cyrchar\\\\cyrt /g, 'т'], [/\\\\cyrchar\\\\cyru /g, 'у'], [/\\\\cyrchar\\\\cyrf /g, 'ф'], [/\\\\cyrchar\\\\cyrh /g, 'х'], [/\\\\cyrchar\\\\cyrc /g, 'ц'], [/\\\\cyrchar\\\\cyrch /g, 'ч'], [/\\\\cyrchar\\\\cyrsh /g, 'ш'], [/\\\\cyrchar\\\\cyrshch /g, 'щ'], [/\\\\cyrchar\\\\cyrhrdsn /g, 'ъ'], [/\\\\cyrchar\\\\cyrery /g, 'ы'], [/\\\\cyrchar\\\\cyrsftsn /g, 'ь'], [/\\\\cyrchar\\\\cyrerev /g, 'э'], [/\\\\cyrchar\\\\cyryu /g, 'ю'], [/\\\\cyrchar\\\\cyrya /g, 'я'], [/\\\\cyrchar\\\\cyryo /g, 'ё'], [/\\\\cyrchar\\\\cyrdje /g, 'ђ'], [/\\\\cyrchar\\{\\\\'\\\\cyrg\\}/g, 'ѓ'], [/\\\\cyrchar\\\\cyrie /g, 'є'], [/\\\\cyrchar\\\\cyrdze /g, 'ѕ'], [/\\\\cyrchar\\\\cyrii /g, 'і'], [/\\\\cyrchar\\\\cyryi /g, 'ї'], [/\\\\cyrchar\\\\cyrje /g, 'ј'], [/\\\\cyrchar\\\\cyrlje /g, 'љ'], [/\\\\cyrchar\\\\cyrnje /g, 'њ'], [/\\\\cyrchar\\\\cyrtshe /g, 'ћ'], [/\\\\cyrchar\\{\\\\'\\\\cyrk\\}/g, 'ќ'], [/\\\\cyrchar\\\\cyrushrt /g, 'ў'], [/\\\\cyrchar\\\\cyrdzhe /g, 'џ'], [/\\\\cyrchar\\\\CYROMEGA /g, 'Ѡ'], [/\\\\cyrchar\\\\cyromega /g, 'ѡ'], [/\\\\cyrchar\\\\CYRYAT /g, 'Ѣ'], [/\\\\cyrchar\\\\CYRIOTE /g, 'Ѥ'], [/\\\\cyrchar\\\\cyriote /g, 'ѥ'], [/\\\\cyrchar\\\\CYRLYUS /g, 'Ѧ'], [/\\\\cyrchar\\\\cyrlyus /g, 'ѧ'], [/\\\\cyrchar\\\\CYRIOTLYUS /g, 'Ѩ'], [/\\\\cyrchar\\\\cyriotlyus /g, 'ѩ'], [/\\\\cyrchar\\\\CYRBYUS /g, 'Ѫ'], [/\\\\cyrchar\\\\CYRIOTBYUS /g, 'Ѭ'], [/\\\\cyrchar\\\\cyriotbyus /g, 'ѭ'], [/\\\\cyrchar\\\\CYRKSI /g, 'Ѯ'], [/\\\\cyrchar\\\\cyrksi /g, 'ѯ'], [/\\\\cyrchar\\\\CYRPSI /g, 'Ѱ'], [/\\\\cyrchar\\\\cyrpsi /g, 'ѱ'], [/\\\\cyrchar\\\\CYRFITA /g, 'Ѳ'], [/\\\\cyrchar\\\\CYRIZH /g, 'Ѵ'], [/\\\\cyrchar\\\\CYRUK /g, 'Ѹ'], [/\\\\cyrchar\\\\cyruk /g, 'ѹ'], [/\\\\cyrchar\\\\CYROMEGARND /g, 'Ѻ'], [/\\\\cyrchar\\\\cyromegarnd /g, 'ѻ'], [/\\\\cyrchar\\\\CYROMEGATITLO /g, 'Ѽ'], [/\\\\cyrchar\\\\cyromegatitlo /g, 'ѽ'], [/\\\\cyrchar\\\\CYROT /g, 'Ѿ'], [/\\\\cyrchar\\\\cyrot /g, 'ѿ'], [/\\\\cyrchar\\\\CYRKOPPA /g, 'Ҁ'], [/\\\\cyrchar\\\\cyrkoppa /g, 'ҁ'], [/\\\\cyrchar\\\\cyrthousands /g, '҂'], [/\\\\cyrchar\\\\cyrhundredthousands /g, '҈'], [/\\\\cyrchar\\\\cyrmillions /g, '҉'], [/\\\\cyrchar\\\\CYRSEMISFTSN /g, 'Ҍ'], [/\\\\cyrchar\\\\cyrsemisftsn /g, 'ҍ'], [/\\\\cyrchar\\\\CYRRTICK /g, 'Ҏ'], [/\\\\cyrchar\\\\cyrrtick /g, 'ҏ'], [/\\\\cyrchar\\\\CYRGUP /g, 'Ґ'], [/\\\\cyrchar\\\\cyrgup /g, 'ґ'], [/\\\\cyrchar\\\\CYRGHCRS /g, 'Ғ'], [/\\\\cyrchar\\\\cyrghcrs /g, 'ғ'], [/\\\\cyrchar\\\\CYRGHK /g, 'Ҕ'], [/\\\\cyrchar\\\\cyrghk /g, 'ҕ'], [/\\\\cyrchar\\\\CYRZHDSC /g, 'Җ'], [/\\\\cyrchar\\\\cyrzhdsc /g, 'җ'], [/\\\\cyrchar\\\\CYRZDSC /g, 'Ҙ'], [/\\\\cyrchar\\\\cyrzdsc /g, 'ҙ'], [/\\\\cyrchar\\\\CYRKDSC /g, 'Қ'], [/\\\\cyrchar\\\\cyrkdsc /g, 'қ'], [/\\\\cyrchar\\\\CYRKVCRS /g, 'Ҝ'], [/\\\\cyrchar\\\\cyrkvcrs /g, 'ҝ'], [/\\\\cyrchar\\\\CYRKHCRS /g, 'Ҟ'], [/\\\\cyrchar\\\\cyrkhcrs /g, 'ҟ'], [/\\\\cyrchar\\\\CYRKBEAK /g, 'Ҡ'], [/\\\\cyrchar\\\\cyrkbeak /g, 'ҡ'], [/\\\\cyrchar\\\\CYRNDSC /g, 'Ң'], [/\\\\cyrchar\\\\cyrndsc /g, 'ң'], [/\\\\cyrchar\\\\CYRNG /g, 'Ҥ'], [/\\\\cyrchar\\\\cyrng /g, 'ҥ'], [/\\\\cyrchar\\\\CYRPHK /g, 'Ҧ'], [/\\\\cyrchar\\\\cyrphk /g, 'ҧ'], [/\\\\cyrchar\\\\CYRABHHA /g, 'Ҩ'], [/\\\\cyrchar\\\\cyrabhha /g, 'ҩ'], [/\\\\cyrchar\\\\CYRSDSC /g, 'Ҫ'], [/\\\\cyrchar\\\\cyrsdsc /g, 'ҫ'], [/\\\\cyrchar\\\\CYRTDSC /g, 'Ҭ'], [/\\\\cyrchar\\\\cyrtdsc /g, 'ҭ'], [/\\\\cyrchar\\\\CYRY /g, 'Ү'], [/\\\\cyrchar\\\\cyry /g, 'ү'], [/\\\\cyrchar\\\\CYRYHCRS /g, 'Ұ'], [/\\\\cyrchar\\\\cyryhcrs /g, 'ұ'], [/\\\\cyrchar\\\\CYRHDSC /g, 'Ҳ'], [/\\\\cyrchar\\\\cyrhdsc /g, 'ҳ'], [/\\\\cyrchar\\\\CYRTETSE /g, 'Ҵ'], [/\\\\cyrchar\\\\cyrtetse /g, 'ҵ'], [/\\\\cyrchar\\\\CYRCHRDSC /g, 'Ҷ'], [/\\\\cyrchar\\\\cyrchrdsc /g, 'ҷ'], [/\\\\cyrchar\\\\CYRCHVCRS /g, 'Ҹ'], [/\\\\cyrchar\\\\cyrchvcrs /g, 'ҹ'], [/\\\\cyrchar\\\\CYRSHHA /g, 'Һ'], [/\\\\cyrchar\\\\cyrshha /g, 'һ'], [/\\\\cyrchar\\\\CYRABHCH /g, 'Ҽ'], [/\\\\cyrchar\\\\cyrabhch /g, 'ҽ'], [/\\\\cyrchar\\\\CYRABHCHDSC /g, 'Ҿ'], [/\\\\cyrchar\\\\cyrabhchdsc /g, 'ҿ'], [/\\\\cyrchar\\\\CYRpalochka /g, 'Ӏ'], [/\\\\cyrchar\\\\CYRKHK /g, 'Ӄ'], [/\\\\cyrchar\\\\cyrkhk /g, 'ӄ'], [/\\\\cyrchar\\\\CYRNHK /g, 'Ӈ'], [/\\\\cyrchar\\\\cyrnhk /g, 'ӈ'], [/\\\\cyrchar\\\\CYRCHLDSC /g, 'Ӌ'], [/\\\\cyrchar\\\\cyrchldsc /g, 'ӌ'], [/\\\\cyrchar\\\\CYRAE /g, 'Ӕ'], [/\\\\cyrchar\\\\cyrae /g, 'ӕ'], [/\\\\cyrchar\\\\CYRSCHWA /g, 'Ә'], [/\\\\cyrchar\\\\cyrschwa /g, 'ә'], [/\\\\cyrchar\\\\CYRABHDZE /g, 'Ӡ'], [/\\\\cyrchar\\\\cyrabhdze /g, 'ӡ'], [/\\\\cyrchar\\\\CYROTLD /g, 'Ө'], [/\\\\cyrchar\\\\cyrotld /g, 'ө'], [/\\\\hspace\\{0.6em\\}/g, ' '], [/\\\\hspace\\{1em\\}/g, ' '], [/\\\\hspace\\{0.33em\\}/g, ' '], [/\\\\hspace\\{0.25em\\}/g, ' '], [/\\\\hspace\\{0.166em\\}/g, ' '], [/\\\\hphantom\\{0\\}/g, ' '], [/\\\\hphantom\\{,\\}/g, ' '], [/\\\\hspace\\{0.167em\\}/g, ' '], [/\\\\mkern1mu /g, ' '], [/\\\\textendash /g, '–'], [/\\\\textemdash /g, '—'], [/\\\\rule\\{1em\\}\\{1pt\\}/g, '―'], [/\\\\Vert /g, '‖'], [/\\\\Elzreapos /g, '‛'], [/\\\\textquotedblleft /g, '“'], [/\\\\textquotedblright /g, '”'], [/\\\\textdagger /g, '†'], [/\\\\textdaggerdbl /g, '‡'], [/\\\\textbullet /g, '•'], [/\\\\ldots /g, '…'], [/\\\\textperthousand /g, '‰'], [/\\\\textpertenthousand /g, '‱'], [/\\\\backprime /g, '‵'], [/\\\\guilsinglleft /g, '‹'], [/\\\\guilsinglright /g, '›'], [/\\\\mkern4mu /g, ' '], [/\\\\nolinebreak /g, '⁠'], [/\\\\ensuremath\\{\\\\Elzpes\\}/g, '₧'], [/\\\\mbox\\{\\\\texteuro\\} /g, '€'], [/\\\\dddot /g, '⃛'], [/\\\\ddddot /g, '⃜'], [/\\\\mathbb\\{C\\}/g, 'ℂ'], [/\\\\mathscr\\{g\\}/g, 'ℊ'], [/\\\\mathscr\\{H\\}/g, 'ℋ'], [/\\\\mathfrak\\{H\\}/g, 'ℌ'], [/\\\\mathbb\\{H\\}/g, 'ℍ'], [/\\\\hslash /g, 'ℏ'], [/\\\\mathscr\\{I\\}/g, 'ℐ'], [/\\\\mathfrak\\{I\\}/g, 'ℑ'], [/\\\\mathscr\\{L\\}/g, 'ℒ'], [/\\\\mathscr\\{l\\}/g, 'ℓ'], [/\\\\mathbb\\{N\\}/g, 'ℕ'], [/\\\\cyrchar\\\\textnumero /g, '№'], [/\\\\wp /g, '℘'], [/\\\\mathbb\\{P\\}/g, 'ℙ'], [/\\\\mathbb\\{Q\\}/g, 'ℚ'], [/\\\\mathscr\\{R\\}/g, 'ℛ'], [/\\\\mathfrak\\{R\\}/g, 'ℜ'], [/\\\\mathbb\\{R\\}/g, 'ℝ'], [/\\\\Elzxrat /g, '℞'], [/\\\\texttrademark /g, '™'], [/\\\\mathbb\\{Z\\}/g, 'ℤ'], [/\\\\Omega /g, 'Ω'], [/\\\\mho /g, '℧'], [/\\\\mathfrak\\{Z\\}/g, 'ℨ'], [/\\\\ElsevierGlyph\\{2129\\}/g, '℩'], [/\\\\AA /g, 'Å'], [/\\\\mathscr\\{B\\}/g, 'ℬ'], [/\\\\mathfrak\\{C\\}/g, 'ℭ'], [/\\\\mathscr\\{e\\}/g, 'ℯ'], [/\\\\mathscr\\{E\\}/g, 'ℰ'], [/\\\\mathscr\\{F\\}/g, 'ℱ'], [/\\\\mathscr\\{M\\}/g, 'ℳ'], [/\\\\mathscr\\{o\\}/g, 'ℴ'], [/\\\\aleph /g, 'ℵ'], [/\\\\beth /g, 'ℶ'], [/\\\\gimel /g, 'ℷ'], [/\\\\daleth /g, 'ℸ'], [/\\\\textfrac\\{1\\}\\{3\\}/g, '⅓'], [/\\\\textfrac\\{2\\}\\{3\\}/g, '⅔'], [/\\\\textfrac\\{1\\}\\{5\\}/g, '⅕'], [/\\\\textfrac\\{2\\}\\{5\\}/g, '⅖'], [/\\\\textfrac\\{3\\}\\{5\\}/g, '⅗'], [/\\\\textfrac\\{4\\}\\{5\\}/g, '⅘'], [/\\\\textfrac\\{1\\}\\{6\\}/g, '⅙'], [/\\\\textfrac\\{5\\}\\{6\\}/g, '⅚'], [/\\\\textfrac\\{1\\}\\{8\\}/g, '⅛'], [/\\\\textfrac\\{3\\}\\{8\\}/g, '⅜'], [/\\\\textfrac\\{5\\}\\{8\\}/g, '⅝'], [/\\\\textfrac\\{7\\}\\{8\\}/g, '⅞'], [/\\\\leftarrow /g, '←'], [/\\\\uparrow /g, '↑'], [/\\\\rightarrow /g, '→'], [/\\\\downarrow /g, '↓'], [/\\\\leftrightarrow /g, '↔'], [/\\\\updownarrow /g, '↕'], [/\\\\nwarrow /g, '↖'], [/\\\\nearrow /g, '↗'], [/\\\\searrow /g, '↘'], [/\\\\swarrow /g, '↙'], [/\\\\nleftarrow /g, '↚'], [/\\\\nrightarrow /g, '↛'], [/\\\\arrowwaveright /g, '↜'], [/\\\\arrowwaveright /g, '↝'], [/\\\\twoheadleftarrow /g, '↞'], [/\\\\twoheadrightarrow /g, '↠'], [/\\\\leftarrowtail /g, '↢'], [/\\\\rightarrowtail /g, '↣'], [/\\\\mapsto /g, '↦'], [/\\\\hookleftarrow /g, '↩'], [/\\\\hookrightarrow /g, '↪'], [/\\\\looparrowleft /g, '↫'], [/\\\\looparrowright /g, '↬'], [/\\\\leftrightsquigarrow /g, '↭'], [/\\\\nleftrightarrow /g, '↮'], [/\\\\Lsh /g, '↰'], [/\\\\Rsh /g, '↱'], [/\\\\ElsevierGlyph\\{21B3\\}/g, '↳'], [/\\\\curvearrowleft /g, '↶'], [/\\\\curvearrowright /g, '↷'], [/\\\\circlearrowleft /g, '↺'], [/\\\\circlearrowright /g, '↻'], [/\\\\leftharpoonup /g, '↼'], [/\\\\leftharpoondown /g, '↽'], [/\\\\upharpoonright /g, '↾'], [/\\\\upharpoonleft /g, '↿'], [/\\\\rightharpoonup /g, '⇀'], [/\\\\rightharpoondown /g, '⇁'], [/\\\\downharpoonright /g, '⇂'], [/\\\\downharpoonleft /g, '⇃'], [/\\\\rightleftarrows /g, '⇄'], [/\\\\dblarrowupdown /g, '⇅'], [/\\\\leftrightarrows /g, '⇆'], [/\\\\leftleftarrows /g, '⇇'], [/\\\\upuparrows /g, '⇈'], [/\\\\rightrightarrows /g, '⇉'], [/\\\\downdownarrows /g, '⇊'], [/\\\\leftrightharpoons /g, '⇋'], [/\\\\rightleftharpoons /g, '⇌'], [/\\\\nLeftarrow /g, '⇍'], [/\\\\nLeftrightarrow /g, '⇎'], [/\\\\nRightarrow /g, '⇏'], [/\\\\Leftarrow /g, '⇐'], [/\\\\Uparrow /g, '⇑'], [/\\\\Rightarrow /g, '⇒'], [/\\\\Downarrow /g, '⇓'], [/\\\\Leftrightarrow /g, '⇔'], [/\\\\Updownarrow /g, '⇕'], [/\\\\Lleftarrow /g, '⇚'], [/\\\\Rrightarrow /g, '⇛'], [/\\\\rightsquigarrow /g, '⇝'], [/\\\\DownArrowUpArrow /g, '⇵'], [/\\\\forall /g, '∀'], [/\\\\complement /g, '∁'], [/\\\\partial /g, '∂'], [/\\\\exists /g, '∃'], [/\\\\nexists /g, '∄'], [/\\\\varnothing /g, '∅'], [/\\\\nabla /g, '∇'], [/\\\\in /g, '∈'], [/\\\\not\\\\in /g, '∉'], [/\\\\ni /g, '∋'], [/\\\\not\\\\ni /g, '∌'], [/\\\\prod /g, '∏'], [/\\\\coprod /g, '∐'], [/\\\\sum /g, '∑'], [/\\\\mp /g, '∓'], [/\\\\dotplus /g, '∔'], [/\\\\setminus /g, '∖'], [/\\\\circ /g, '∘'], [/\\\\bullet /g, '∙'], [/\\\\surd /g, '√'], [/\\\\propto /g, '∝'], [/\\\\infty /g, '∞'], [/\\\\rightangle /g, '∟'], [/\\\\angle /g, '∠'], [/\\\\measuredangle /g, '∡'], [/\\\\sphericalangle /g, '∢'], [/\\\\mid /g, '∣'], [/\\\\nmid /g, '∤'], [/\\\\parallel /g, '∥'], [/\\\\nparallel /g, '∦'], [/\\\\wedge /g, '∧'], [/\\\\vee /g, '∨'], [/\\\\cap /g, '∩'], [/\\\\cup /g, '∪'], [/\\\\int /g, '∫'], [/\\\\int\\\\!\\\\int /g, '∬'], [/\\\\int\\\\!\\\\int\\\\!\\\\int /g, '∭'], [/\\\\oint /g, '∮'], [/\\\\surfintegral /g, '∯'], [/\\\\volintegral /g, '∰'], [/\\\\clwintegral /g, '∱'], [/\\\\ElsevierGlyph\\{2232\\}/g, '∲'], [/\\\\ElsevierGlyph\\{2233\\}/g, '∳'], [/\\\\therefore /g, '∴'], [/\\\\because /g, '∵'], [/\\\\Colon /g, '∷'], [/\\\\ElsevierGlyph\\{2238\\}/g, '∸'], [/\\\\mathbin\\{\\{:\\}\\\\!\\\\!\\{\\-\\}\\\\!\\\\!\\{:\\}\\}/g, '∺'], [/\\\\homothetic /g, '∻'], [/\\\\sim /g, '∼'], [/\\\\backsim /g, '∽'], [/\\\\lazysinv /g, '∾'], [/\\\\wr /g, '≀'], [/\\\\not\\\\sim /g, '≁'], [/\\\\ElsevierGlyph\\{2242\\}/g, '≂'], [/\\\\NotEqualTilde /g, '≂-00338'], [/\\\\simeq /g, '≃'], [/\\\\not\\\\simeq /g, '≄'], [/\\\\cong /g, '≅'], [/\\\\approxnotequal /g, '≆'], [/\\\\not\\\\cong /g, '≇'], [/\\\\approx /g, '≈'], [/\\\\not\\\\approx /g, '≉'], [/\\\\approxeq /g, '≊'], [/\\\\tildetrpl /g, '≋'], [/\\\\not\\\\apid /g, '≋-00338'], [/\\\\allequal /g, '≌'], [/\\\\asymp /g, '≍'], [/\\\\Bumpeq /g, '≎'], [/\\\\NotHumpDownHump /g, '≎-00338'], [/\\\\bumpeq /g, '≏'], [/\\\\NotHumpEqual /g, '≏-00338'], [/\\\\doteq /g, '≐'], [/\\\\not\\\\doteq/g, '≐-00338'], [/\\\\doteqdot /g, '≑'], [/\\\\fallingdotseq /g, '≒'], [/\\\\risingdotseq /g, '≓'], [/\\\\eqcirc /g, '≖'], [/\\\\circeq /g, '≗'], [/\\\\estimates /g, '≙'], [/\\\\ElsevierGlyph\\{225A\\}/g, '≚'], [/\\\\starequal /g, '≛'], [/\\\\triangleq /g, '≜'], [/\\\\ElsevierGlyph\\{225F\\}/g, '≟'], [/\\\\not =/g, '≠'], [/\\\\equiv /g, '≡'], [/\\\\not\\\\equiv /g, '≢'], [/\\\\leq /g, '≤'], [/\\\\geq /g, '≥'], [/\\\\leqq /g, '≦'], [/\\\\geqq /g, '≧'], [/\\\\lneqq /g, '≨'], [/\\\\lvertneqq /g, '≨-0FE00'], [/\\\\gneqq /g, '≩'], [/\\\\gvertneqq /g, '≩-0FE00'], [/\\\\ll /g, '≪'], [/\\\\NotLessLess /g, '≪-00338'], [/\\\\gg /g, '≫'], [/\\\\NotGreaterGreater /g, '≫-00338'], [/\\\\between /g, '≬'], [/\\\\not\\\\kern\\-0.3em\\\\times /g, '≭'], [/\\\\not</g, '≮'], [/\\\\not>/g, '≯'], [/\\\\not\\\\leq /g, '≰'], [/\\\\not\\\\geq /g, '≱'], [/\\\\lessequivlnt /g, '≲'], [/\\\\greaterequivlnt /g, '≳'], [/\\\\ElsevierGlyph\\{2274\\}/g, '≴'], [/\\\\ElsevierGlyph\\{2275\\}/g, '≵'], [/\\\\lessgtr /g, '≶'], [/\\\\gtrless /g, '≷'], [/\\\\notlessgreater /g, '≸'], [/\\\\notgreaterless /g, '≹'], [/\\\\prec /g, '≺'], [/\\\\succ /g, '≻'], [/\\\\preccurlyeq /g, '≼'], [/\\\\succcurlyeq /g, '≽'], [/\\\\precapprox /g, '≾'], [/\\\\NotPrecedesTilde /g, '≾-00338'], [/\\\\succapprox /g, '≿'], [/\\\\NotSucceedsTilde /g, '≿-00338'], [/\\\\not\\\\prec /g, '⊀'], [/\\\\not\\\\succ /g, '⊁'], [/\\\\subset /g, '⊂'], [/\\\\supset /g, '⊃'], [/\\\\not\\\\subset /g, '⊄'], [/\\\\not\\\\supset /g, '⊅'], [/\\\\subseteq /g, '⊆'], [/\\\\supseteq /g, '⊇'], [/\\\\not\\\\subseteq /g, '⊈'], [/\\\\not\\\\supseteq /g, '⊉'], [/\\\\subsetneq /g, '⊊'], [/\\\\varsubsetneqq /g, '⊊-0FE00'], [/\\\\supsetneq /g, '⊋'], [/\\\\varsupsetneq /g, '⊋-0FE00'], [/\\\\uplus /g, '⊎'], [/\\\\sqsubset /g, '⊏'], [/\\\\NotSquareSubset /g, '⊏-00338'], [/\\\\sqsupset /g, '⊐'], [/\\\\NotSquareSuperset /g, '⊐-00338'], [/\\\\sqsubseteq /g, '⊑'], [/\\\\sqsupseteq /g, '⊒'], [/\\\\sqcap /g, '⊓'], [/\\\\sqcup /g, '⊔'], [/\\\\oplus /g, '⊕'], [/\\\\ominus /g, '⊖'], [/\\\\otimes /g, '⊗'], [/\\\\oslash /g, '⊘'], [/\\\\odot /g, '⊙'], [/\\\\circledcirc /g, '⊚'], [/\\\\circledast /g, '⊛'], [/\\\\circleddash /g, '⊝'], [/\\\\boxplus /g, '⊞'], [/\\\\boxminus /g, '⊟'], [/\\\\boxtimes /g, '⊠'], [/\\\\boxdot /g, '⊡'], [/\\\\vdash /g, '⊢'], [/\\\\dashv /g, '⊣'], [/\\\\top /g, '⊤'], [/\\\\perp /g, '⊥'], [/\\\\truestate /g, '⊧'], [/\\\\forcesextra /g, '⊨'], [/\\\\Vdash /g, '⊩'], [/\\\\Vvdash /g, '⊪'], [/\\\\VDash /g, '⊫'], [/\\\\nvdash /g, '⊬'], [/\\\\nvDash /g, '⊭'], [/\\\\nVdash /g, '⊮'], [/\\\\nVDash /g, '⊯'], [/\\\\vartriangleleft /g, '⊲'], [/\\\\vartriangleright /g, '⊳'], [/\\\\trianglelefteq /g, '⊴'], [/\\\\trianglerighteq /g, '⊵'], [/\\\\original /g, '⊶'], [/\\\\image /g, '⊷'], [/\\\\multimap /g, '⊸'], [/\\\\hermitconjmatrix /g, '⊹'], [/\\\\intercal /g, '⊺'], [/\\\\veebar /g, '⊻'], [/\\\\rightanglearc /g, '⊾'], [/\\\\ElsevierGlyph\\{22C0\\}/g, '⋀'], [/\\\\ElsevierGlyph\\{22C1\\}/g, '⋁'], [/\\\\bigcap /g, '⋂'], [/\\\\bigcup /g, '⋃'], [/\\\\diamond /g, '⋄'], [/\\\\cdot /g, '⋅'], [/\\\\star /g, '⋆'], [/\\\\divideontimes /g, '⋇'], [/\\\\bowtie /g, '⋈'], [/\\\\ltimes /g, '⋉'], [/\\\\rtimes /g, '⋊'], [/\\\\leftthreetimes /g, '⋋'], [/\\\\rightthreetimes /g, '⋌'], [/\\\\backsimeq /g, '⋍'], [/\\\\curlyvee /g, '⋎'], [/\\\\curlywedge /g, '⋏'], [/\\\\Subset /g, '⋐'], [/\\\\Supset /g, '⋑'], [/\\\\Cap /g, '⋒'], [/\\\\Cup /g, '⋓'], [/\\\\pitchfork /g, '⋔'], [/\\\\lessdot /g, '⋖'], [/\\\\gtrdot /g, '⋗'], [/\\\\verymuchless /g, '⋘'], [/\\\\verymuchgreater /g, '⋙'], [/\\\\lesseqgtr /g, '⋚'], [/\\\\gtreqless /g, '⋛'], [/\\\\curlyeqprec /g, '⋞'], [/\\\\curlyeqsucc /g, '⋟'], [/\\\\not\\\\sqsubseteq /g, '⋢'], [/\\\\not\\\\sqsupseteq /g, '⋣'], [/\\\\Elzsqspne /g, '⋥'], [/\\\\lnsim /g, '⋦'], [/\\\\gnsim /g, '⋧'], [/\\\\precedesnotsimilar /g, '⋨'], [/\\\\succnsim /g, '⋩'], [/\\\\ntriangleleft /g, '⋪'], [/\\\\ntriangleright /g, '⋫'], [/\\\\ntrianglelefteq /g, '⋬'], [/\\\\ntrianglerighteq /g, '⋭'], [/\\\\vdots /g, '⋮'], [/\\\\cdots /g, '⋯'], [/\\\\upslopeellipsis /g, '⋰'], [/\\\\downslopeellipsis /g, '⋱'], [/\\\\barwedge /g, '⌅'], [/\\\\perspcorrespond /g, '⌆'], [/\\\\lceil /g, '⌈'], [/\\\\rceil /g, '⌉'], [/\\\\lfloor /g, '⌊'], [/\\\\rfloor /g, '⌋'], [/\\\\recorder /g, '⌕'], [/\\\\mathchar\"2208/g, '⌖'], [/\\\\ulcorner /g, '⌜'], [/\\\\urcorner /g, '⌝'], [/\\\\llcorner /g, '⌞'], [/\\\\lrcorner /g, '⌟'], [/\\\\frown /g, '⌢'], [/\\\\smile /g, '⌣'], [/\\\\langle /g, '〈'], [/\\\\rangle /g, '〉'], [/\\\\ElsevierGlyph\\{E838\\}/g, '⌽'], [/\\\\Elzdlcorn /g, '⎣'], [/\\\\lmoustache /g, '⎰'], [/\\\\rmoustache /g, '⎱'], [/\\\\textvisiblespace /g, '␣'], [/\\\\ding\\{172\\}/g, '①'], [/\\\\ding\\{173\\}/g, '②'], [/\\\\ding\\{174\\}/g, '③'], [/\\\\ding\\{175\\}/g, '④'], [/\\\\ding\\{176\\}/g, '⑤'], [/\\\\ding\\{177\\}/g, '⑥'], [/\\\\ding\\{178\\}/g, '⑦'], [/\\\\ding\\{179\\}/g, '⑧'], [/\\\\ding\\{180\\}/g, '⑨'], [/\\\\ding\\{181\\}/g, '⑩'], [/\\\\circledS /g, 'Ⓢ'], [/\\\\Elzdshfnc /g, '┆'], [/\\\\Elzsqfnw /g, '┙'], [/\\\\diagup /g, '╱'], [/\\\\ding\\{110\\}/g, '■'], [/\\\\square /g, '□'], [/\\\\blacksquare /g, '▪'], [/\\\\fbox\\{~~\\}/g, '▭'], [/\\\\Elzvrecto /g, '▯'], [/\\\\ElsevierGlyph\\{E381\\}/g, '▱'], [/\\\\ding\\{115\\}/g, '▲'], [/\\\\bigtriangleup /g, '△'], [/\\\\blacktriangle /g, '▴'], [/\\\\vartriangle /g, '▵'], [/\\\\blacktriangleright /g, '▸'], [/\\\\triangleright /g, '▹'], [/\\\\ding\\{116\\}/g, '▼'], [/\\\\bigtriangledown /g, '▽'], [/\\\\blacktriangledown /g, '▾'], [/\\\\triangledown /g, '▿'], [/\\\\blacktriangleleft /g, '◂'], [/\\\\triangleleft /g, '◃'], [/\\\\ding\\{117\\}/g, '◆'], [/\\\\lozenge /g, '◊'], [/\\\\bigcirc /g, '○'], [/\\\\ding\\{108\\}/g, '●'], [/\\\\Elzcirfl /g, '◐'], [/\\\\Elzcirfr /g, '◑'], [/\\\\Elzcirfb /g, '◒'], [/\\\\ding\\{119\\}/g, '◗'], [/\\\\Elzrvbull /g, '◘'], [/\\\\Elzsqfl /g, '◧'], [/\\\\Elzsqfr /g, '◨'], [/\\\\Elzsqfse /g, '◪'], [/\\\\bigcirc /g, '◯'], [/\\\\ding\\{72\\}/g, '★'], [/\\\\ding\\{73\\}/g, '☆'], [/\\\\ding\\{37\\}/g, '☎'], [/\\\\ding\\{42\\}/g, '☛'], [/\\\\ding\\{43\\}/g, '☞'], [/\\\\rightmoon /g, '☾'], [/\\\\mercury /g, '☿'], [/\\\\venus /g, '♀'], [/\\\\male /g, '♂'], [/\\\\jupiter /g, '♃'], [/\\\\saturn /g, '♄'], [/\\\\uranus /g, '♅'], [/\\\\neptune /g, '♆'], [/\\\\pluto /g, '♇'], [/\\\\aries /g, '♈'], [/\\\\taurus /g, '♉'], [/\\\\gemini /g, '♊'], [/\\\\cancer /g, '♋'], [/\\\\leo /g, '♌'], [/\\\\virgo /g, '♍'], [/\\\\libra /g, '♎'], [/\\\\scorpio /g, '♏'], [/\\\\sagittarius /g, '♐'], [/\\\\capricornus /g, '♑'], [/\\\\aquarius /g, '♒'], [/\\\\pisces /g, '♓'], [/\\\\ding\\{171\\}/g, '♠'], [/\\\\diamond /g, '♢'], [/\\\\ding\\{168\\}/g, '♣'], [/\\\\ding\\{170\\}/g, '♥'], [/\\\\ding\\{169\\}/g, '♦'], [/\\\\quarternote /g, '♩'], [/\\\\eighthnote /g, '♪'], [/\\\\flat /g, '♭'], [/\\\\natural /g, '♮'], [/\\\\sharp /g, '♯'], [/\\\\ding\\{33\\}/g, '✁'], [/\\\\ding\\{34\\}/g, '✂'], [/\\\\ding\\{35\\}/g, '✃'], [/\\\\ding\\{36\\}/g, '✄'], [/\\\\ding\\{38\\}/g, '✆'], [/\\\\ding\\{39\\}/g, '✇'], [/\\\\ding\\{40\\}/g, '✈'], [/\\\\ding\\{41\\}/g, '✉'], [/\\\\ding\\{44\\}/g, '✌'], [/\\\\ding\\{45\\}/g, '✍'], [/\\\\ding\\{46\\}/g, '✎'], [/\\\\ding\\{47\\}/g, '✏'], [/\\\\ding\\{48\\}/g, '✐'], [/\\\\ding\\{49\\}/g, '✑'], [/\\\\ding\\{50\\}/g, '✒'], [/\\\\ding\\{51\\}/g, '✓'], [/\\\\ding\\{52\\}/g, '✔'], [/\\\\ding\\{53\\}/g, '✕'], [/\\\\ding\\{54\\}/g, '✖'], [/\\\\ding\\{55\\}/g, '✗'], [/\\\\ding\\{56\\}/g, '✘'], [/\\\\ding\\{57\\}/g, '✙'], [/\\\\ding\\{58\\}/g, '✚'], [/\\\\ding\\{59\\}/g, '✛'], [/\\\\ding\\{60\\}/g, '✜'], [/\\\\ding\\{61\\}/g, '✝'], [/\\\\ding\\{62\\}/g, '✞'], [/\\\\ding\\{63\\}/g, '✟'], [/\\\\ding\\{64\\}/g, '✠'], [/\\\\ding\\{65\\}/g, '✡'], [/\\\\ding\\{66\\}/g, '✢'], [/\\\\ding\\{67\\}/g, '✣'], [/\\\\ding\\{68\\}/g, '✤'], [/\\\\ding\\{69\\}/g, '✥'], [/\\\\ding\\{70\\}/g, '✦'], [/\\\\ding\\{71\\}/g, '✧'], [/\\\\ding\\{73\\}/g, '✩'], [/\\\\ding\\{74\\}/g, '✪'], [/\\\\ding\\{75\\}/g, '✫'], [/\\\\ding\\{76\\}/g, '✬'], [/\\\\ding\\{77\\}/g, '✭'], [/\\\\ding\\{78\\}/g, '✮'], [/\\\\ding\\{79\\}/g, '✯'], [/\\\\ding\\{80\\}/g, '✰'], [/\\\\ding\\{81\\}/g, '✱'], [/\\\\ding\\{82\\}/g, '✲'], [/\\\\ding\\{83\\}/g, '✳'], [/\\\\ding\\{84\\}/g, '✴'], [/\\\\ding\\{85\\}/g, '✵'], [/\\\\ding\\{86\\}/g, '✶'], [/\\\\ding\\{87\\}/g, '✷'], [/\\\\ding\\{88\\}/g, '✸'], [/\\\\ding\\{89\\}/g, '✹'], [/\\\\ding\\{90\\}/g, '✺'], [/\\\\ding\\{91\\}/g, '✻'], [/\\\\ding\\{92\\}/g, '✼'], [/\\\\ding\\{93\\}/g, '✽'], [/\\\\ding\\{94\\}/g, '✾'], [/\\\\ding\\{95\\}/g, '✿'], [/\\\\ding\\{96\\}/g, '❀'], [/\\\\ding\\{97\\}/g, '❁'], [/\\\\ding\\{98\\}/g, '❂'], [/\\\\ding\\{99\\}/g, '❃'], [/\\\\ding\\{100\\}/g, '❄'], [/\\\\ding\\{101\\}/g, '❅'], [/\\\\ding\\{102\\}/g, '❆'], [/\\\\ding\\{103\\}/g, '❇'], [/\\\\ding\\{104\\}/g, '❈'], [/\\\\ding\\{105\\}/g, '❉'], [/\\\\ding\\{106\\}/g, '❊'], [/\\\\ding\\{107\\}/g, '❋'], [/\\\\ding\\{109\\}/g, '❍'], [/\\\\ding\\{111\\}/g, '❏'], [/\\\\ding\\{112\\}/g, '❐'], [/\\\\ding\\{113\\}/g, '❑'], [/\\\\ding\\{114\\}/g, '❒'], [/\\\\ding\\{118\\}/g, '❖'], [/\\\\ding\\{120\\}/g, '❘'], [/\\\\ding\\{121\\}/g, '❙'], [/\\\\ding\\{122\\}/g, '❚'], [/\\\\ding\\{123\\}/g, '❛'], [/\\\\ding\\{124\\}/g, '❜'], [/\\\\ding\\{125\\}/g, '❝'], [/\\\\ding\\{126\\}/g, '❞'], [/\\\\ding\\{161\\}/g, '❡'], [/\\\\ding\\{162\\}/g, '❢'], [/\\\\ding\\{163\\}/g, '❣'], [/\\\\ding\\{164\\}/g, '❤'], [/\\\\ding\\{165\\}/g, '❥'], [/\\\\ding\\{166\\}/g, '❦'], [/\\\\ding\\{167\\}/g, '❧'], [/\\\\ding\\{182\\}/g, '❶'], [/\\\\ding\\{183\\}/g, '❷'], [/\\\\ding\\{184\\}/g, '❸'], [/\\\\ding\\{185\\}/g, '❹'], [/\\\\ding\\{186\\}/g, '❺'], [/\\\\ding\\{187\\}/g, '❻'], [/\\\\ding\\{188\\}/g, '❼'], [/\\\\ding\\{189\\}/g, '❽'], [/\\\\ding\\{190\\}/g, '❾'], [/\\\\ding\\{191\\}/g, '❿'], [/\\\\ding\\{192\\}/g, '➀'], [/\\\\ding\\{193\\}/g, '➁'], [/\\\\ding\\{194\\}/g, '➂'], [/\\\\ding\\{195\\}/g, '➃'], [/\\\\ding\\{196\\}/g, '➄'], [/\\\\ding\\{197\\}/g, '➅'], [/\\\\ding\\{198\\}/g, '➆'], [/\\\\ding\\{199\\}/g, '➇'], [/\\\\ding\\{200\\}/g, '➈'], [/\\\\ding\\{201\\}/g, '➉'], [/\\\\ding\\{202\\}/g, '➊'], [/\\\\ding\\{203\\}/g, '➋'], [/\\\\ding\\{204\\}/g, '➌'], [/\\\\ding\\{205\\}/g, '➍'], [/\\\\ding\\{206\\}/g, '➎'], [/\\\\ding\\{207\\}/g, '➏'], [/\\\\ding\\{208\\}/g, '➐'], [/\\\\ding\\{209\\}/g, '➑'], [/\\\\ding\\{210\\}/g, '➒'], [/\\\\ding\\{211\\}/g, '➓'], [/\\\\ding\\{212\\}/g, '➔'], [/\\\\ding\\{216\\}/g, '➘'], [/\\\\ding\\{217\\}/g, '➙'], [/\\\\ding\\{218\\}/g, '➚'], [/\\\\ding\\{219\\}/g, '➛'], [/\\\\ding\\{220\\}/g, '➜'], [/\\\\ding\\{221\\}/g, '➝'], [/\\\\ding\\{222\\}/g, '➞'], [/\\\\ding\\{223\\}/g, '➟'], [/\\\\ding\\{224\\}/g, '➠'], [/\\\\ding\\{225\\}/g, '➡'], [/\\\\ding\\{226\\}/g, '➢'], [/\\\\ding\\{227\\}/g, '➣'], [/\\\\ding\\{228\\}/g, '➤'], [/\\\\ding\\{229\\}/g, '➥'], [/\\\\ding\\{230\\}/g, '➦'], [/\\\\ding\\{231\\}/g, '➧'], [/\\\\ding\\{232\\}/g, '➨'], [/\\\\ding\\{233\\}/g, '➩'], [/\\\\ding\\{234\\}/g, '➪'], [/\\\\ding\\{235\\}/g, '➫'], [/\\\\ding\\{236\\}/g, '➬'], [/\\\\ding\\{237\\}/g, '➭'], [/\\\\ding\\{238\\}/g, '➮'], [/\\\\ding\\{239\\}/g, '➯'], [/\\\\ding\\{241\\}/g, '➱'], [/\\\\ding\\{242\\}/g, '➲'], [/\\\\ding\\{243\\}/g, '➳'], [/\\\\ding\\{244\\}/g, '➴'], [/\\\\ding\\{245\\}/g, '➵'], [/\\\\ding\\{246\\}/g, '➶'], [/\\\\ding\\{247\\}/g, '➷'], [/\\\\ding\\{248\\}/g, '➸'], [/\\\\ding\\{249\\}/g, '➹'], [/\\\\ding\\{250\\}/g, '➺'], [/\\\\ding\\{251\\}/g, '➻'], [/\\\\ding\\{252\\}/g, '➼'], [/\\\\ding\\{253\\}/g, '➽'], [/\\\\ding\\{254\\}/g, '➾'], [/\\\\longleftarrow /g, '⟵'], [/\\\\longrightarrow /g, '⟶'], [/\\\\longleftrightarrow /g, '⟷'], [/\\\\Longleftarrow /g, '⟸'], [/\\\\Longrightarrow /g, '⟹'], [/\\\\Longleftrightarrow /g, '⟺'], [/\\\\longmapsto /g, '⟼'], [/\\\\sim\\\\joinrel\\\\leadsto/g, '⟿'], [/\\\\ElsevierGlyph\\{E212\\}/g, '⤅'], [/\\\\UpArrowBar /g, '⤒'], [/\\\\DownArrowBar /g, '⤓'], [/\\\\ElsevierGlyph\\{E20C\\}/g, '⤣'], [/\\\\ElsevierGlyph\\{E20D\\}/g, '⤤'], [/\\\\ElsevierGlyph\\{E20B\\}/g, '⤥'], [/\\\\ElsevierGlyph\\{E20A\\}/g, '⤦'], [/\\\\ElsevierGlyph\\{E211\\}/g, '⤧'], [/\\\\ElsevierGlyph\\{E20E\\}/g, '⤨'], [/\\\\ElsevierGlyph\\{E20F\\}/g, '⤩'], [/\\\\ElsevierGlyph\\{E210\\}/g, '⤪'], [/\\\\ElsevierGlyph\\{E21C\\}/g, '⤳'], [/\\\\ElsevierGlyph\\{E21D\\}/g, '⤳-00338'], [/\\\\ElsevierGlyph\\{E21A\\}/g, '⤶'], [/\\\\ElsevierGlyph\\{E219\\}/g, '⤷'], [/\\\\Elolarr /g, '⥀'], [/\\\\Elorarr /g, '⥁'], [/\\\\ElzRlarr /g, '⥂'], [/\\\\ElzrLarr /g, '⥄'], [/\\\\Elzrarrx /g, '⥇'], [/\\\\LeftRightVector /g, '⥎'], [/\\\\RightUpDownVector /g, '⥏'], [/\\\\DownLeftRightVector /g, '⥐'], [/\\\\LeftUpDownVector /g, '⥑'], [/\\\\LeftVectorBar /g, '⥒'], [/\\\\RightVectorBar /g, '⥓'], [/\\\\RightUpVectorBar /g, '⥔'], [/\\\\RightDownVectorBar /g, '⥕'], [/\\\\DownLeftVectorBar /g, '⥖'], [/\\\\DownRightVectorBar /g, '⥗'], [/\\\\LeftUpVectorBar /g, '⥘'], [/\\\\LeftDownVectorBar /g, '⥙'], [/\\\\LeftTeeVector /g, '⥚'], [/\\\\RightTeeVector /g, '⥛'], [/\\\\RightUpTeeVector /g, '⥜'], [/\\\\RightDownTeeVector /g, '⥝'], [/\\\\DownLeftTeeVector /g, '⥞'], [/\\\\DownRightTeeVector /g, '⥟'], [/\\\\LeftUpTeeVector /g, '⥠'], [/\\\\LeftDownTeeVector /g, '⥡'], [/\\\\UpEquilibrium /g, '⥮'], [/\\\\ReverseUpEquilibrium /g, '⥯'], [/\\\\RoundImplies /g, '⥰'], [/\\\\ElsevierGlyph\\{E214\\}/g, '⥼'], [/\\\\ElsevierGlyph\\{E215\\}/g, '⥽'], [/\\\\Elztfnc /g, '⦀'], [/\\\\ElsevierGlyph\\{3018\\}/g, '⦅'], [/\\\\Elroang /g, '⦆'], [/\\\\ElsevierGlyph\\{E291\\}/g, '⦔'], [/\\\\Elzddfnc /g, '⦙'], [/\\\\Angle /g, '⦜'], [/\\\\Elzlpargt /g, '⦠'], [/\\\\ElsevierGlyph\\{E260\\}/g, '⦵'], [/\\\\ElsevierGlyph\\{E61B\\}/g, '⦶'], [/\\\\ElzLap /g, '⧊'], [/\\\\Elzdefas /g, '⧋'], [/\\\\LeftTriangleBar /g, '⧏'], [/\\\\NotLeftTriangleBar /g, '⧏-00338'], [/\\\\RightTriangleBar /g, '⧐'], [/\\\\NotRightTriangleBar /g, '⧐-00338'], [/\\\\ElsevierGlyph\\{E372\\}/g, '⧜'], [/\\\\blacklozenge /g, '⧫'], [/\\\\RuleDelayed /g, '⧴'], [/\\\\Elxuplus /g, '⨄'], [/\\\\ElzThr /g, '⨅'], [/\\\\Elxsqcup /g, '⨆'], [/\\\\ElzInf /g, '⨇'], [/\\\\ElzSup /g, '⨈'], [/\\\\ElzCint /g, '⨍'], [/\\\\clockoint /g, '⨏'], [/\\\\ElsevierGlyph\\{E395\\}/g, '⨐'], [/\\\\sqrint /g, '⨖'], [/\\\\ElsevierGlyph\\{E25A\\}/g, '⨥'], [/\\\\ElsevierGlyph\\{E25B\\}/g, '⨪'], [/\\\\ElsevierGlyph\\{E25C\\}/g, '⨭'], [/\\\\ElsevierGlyph\\{E25D\\}/g, '⨮'], [/\\\\ElzTimes /g, '⨯'], [/\\\\ElsevierGlyph\\{E25E\\}/g, '⨴'], [/\\\\ElsevierGlyph\\{E25E\\}/g, '⨵'], [/\\\\ElsevierGlyph\\{E259\\}/g, '⨼'], [/\\\\amalg /g, '⨿'], [/\\\\ElzAnd /g, '⩓'], [/\\\\ElzOr /g, '⩔'], [/\\\\ElsevierGlyph\\{E36E\\}/g, '⩕'], [/\\\\ElOr /g, '⩖'], [/\\\\perspcorrespond /g, '⩞'], [/\\\\Elzminhat /g, '⩟'], [/\\\\ElsevierGlyph\\{225A\\}/g, '⩣'], [/\\\\stackrel\\{*\\}\\{=\\}/g, '⩮'], [/\\\\Equal /g, '⩵'], [/\\\\leqslant /g, '⩽'], [/\\\\nleqslant /g, '⩽-00338'], [/\\\\geqslant /g, '⩾'], [/\\\\ngeqslant /g, '⩾-00338'], [/\\\\lessapprox /g, '⪅'], [/\\\\gtrapprox /g, '⪆'], [/\\\\lneq /g, '⪇'], [/\\\\gneq /g, '⪈'], [/\\\\lnapprox /g, '⪉'], [/\\\\gnapprox /g, '⪊'], [/\\\\lesseqqgtr /g, '⪋'], [/\\\\gtreqqless /g, '⪌'], [/\\\\eqslantless /g, '⪕'], [/\\\\eqslantgtr /g, '⪖'], [/\\\\Pisymbol\\{ppi020\\}\\{117\\}/g, '⪝'], [/\\\\Pisymbol\\{ppi020\\}\\{105\\}/g, '⪞'], [/\\\\NestedLessLess /g, '⪡'], [/\\\\NotNestedLessLess /g, '⪡-00338'], [/\\\\NestedGreaterGreater /g, '⪢'], [/\\\\NotNestedGreaterGreater /g, '⪢-00338'], [/\\\\preceq /g, '⪯'], [/\\\\not\\\\preceq /g, '⪯-00338'], [/\\\\succeq /g, '⪰'], [/\\\\not\\\\succeq /g, '⪰-00338'], [/\\\\precneqq /g, '⪵'], [/\\\\succneqq /g, '⪶'], [/\\\\precapprox /g, '⪷'], [/\\\\succapprox /g, '⪸'], [/\\\\precnapprox /g, '⪹'], [/\\\\succnapprox /g, '⪺'], [/\\\\subseteqq /g, '⫅'], [/\\\\nsubseteqq /g, '⫅-00338'], [/\\\\supseteqq /g, '⫆'], [/\\\\nsupseteqq/g, '⫆-00338'], [/\\\\subsetneqq /g, '⫋'], [/\\\\supsetneqq /g, '⫌'], [/\\\\ElsevierGlyph\\{E30D\\}/g, '⫫'], [/\\\\Elztdcol /g, '⫶'], [/\\\\ElsevierGlyph\\{300A\\}/g, '《'], [/\\\\ElsevierGlyph\\{300B\\}/g, '》'], [/\\\\ElsevierGlyph\\{3018\\}/g, '〘'], [/\\\\ElsevierGlyph\\{3019\\}/g, '〙'], [/\\\\openbracketleft /g, '〚'], [/\\\\openbracketright /g, '〛']];\n\t\n\t  return this;\n\t} // end function BibtexParser\n\t\n\tif (typeof module !== 'undefined' && module.exports) {\n\t  module.exports = BibtexParser;\n\t}\n\n/***/ },\n/* 37 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(6), __webpack_require__(19), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (baseMVC, citationModel, _l) {\n\t\n\t    var CitationView = Backbone.View.extend({\n\t        tagName: 'div',\n\t        className: 'citations',\n\t        render: function render() {\n\t            this.$el.append(\"<p>\" + this.formattedReference() + \"</p>\");\n\t            return this;\n\t        },\n\t        formattedReference: function formattedReference() {\n\t            var model = this.model;\n\t            var entryType = model.entryType();\n\t            var fields = model.fields();\n\t\n\t            var ref = \"\";\n\t            // Code inspired by...\n\t            // https://github.com/vkaravir/bib-publication-list/blob/master/src/bib-publication-list.js\n\t            var authorsAndYear = this._asSentence((fields.author ? fields.author : \"\") + (fields.year ? \" (\" + fields.year + \")\" : \"\")) + \" \";\n\t            var title = fields.title || \"\";\n\t            var pages = fields.pages ? \"pp. \" + fields.pages : \"\";\n\t            var address = fields.address;\n\t            if (entryType == \"article\") {\n\t                var volume = (fields.volume ? fields.volume : \"\") + (fields.number ? \" (\" + fields.number + \")\" : \"\") + (pages ? \", \" + pages : \"\");\n\t                ref = authorsAndYear + this._asSentence(title) + (fields.journal ? \"In <em>\" + fields.journal + \", \" : \"\") + this._asSentence(volume) + this._asSentence(fields.address) + \"<\\/em>\";\n\t            } else if (entryType == \"inproceedings\" || entryType == \"proceedings\") {\n\t                ref = authorsAndYear + this._asSentence(title) + (fields.booktitle ? \"In <em>\" + fields.booktitle + \", \" : \"\") + (pages ? pages : \"\") + (address ? \", \" + address : \"\") + \".<\\/em>\";\n\t            } else if (entryType == \"mastersthesis\" || entryType == \"phdthesis\") {\n\t                ref = authorsAndYear + this._asSentence(title) + (fields.howpublished ? fields.howpublished + \". \" : \"\") + (fields.note ? fields.note + \".\" : \"\");\n\t            } else if (entryType == \"techreport\") {\n\t                ref = authorsAndYear + this._asSentence(title) + this._asSentence(fields.institution) + this._asSentence(fields.number) + this._asSentence(fields.type);\n\t            } else if (entryType == \"book\" || entryType == \"inbook\" || entryType == \"incollection\") {\n\t                ref = authorsAndYear + \" \" + this._formatBookInfo(fields);\n\t            } else {\n\t                ref = authorsAndYear + \" \" + this._asSentence(title) + this._asSentence(fields.howpublished) + this._asSentence(fields.note);\n\t            }\n\t            var doiUrl = \"\";\n\t            if (fields.doi) {\n\t                doiUrl = 'http://dx.doi.org/' + fields.doi;\n\t                ref += '[<a href=\"' + doiUrl + '\" target=\"_blank\">doi:' + fields.doi + \"</a>]\";\n\t            }\n\t            var url = fields.url || doiUrl;\n\t            if (url) {\n\t                ref += '[<a href=\"' + url + '\" target=\"_blank\">Link</a>]';\n\t            }\n\t            return ref;\n\t        },\n\t        _formatBookInfo: function _formatBookInfo(fields) {\n\t            var info = \"\";\n\t            if (fields.chapter) {\n\t                info += fields.chapter + \" in \";\n\t            }\n\t            if (fields.title) {\n\t                info += \"<em>\" + fields.title + \"<\\/em>\";\n\t            }\n\t            if (fields.editor) {\n\t                info += \", Edited by \" + fields.editor + \", \";\n\t            }\n\t            if (fields.publisher) {\n\t                info += \", \" + fields.publisher;\n\t            }\n\t            if (fields.pages) {\n\t                info += \", pp. \" + fields.pages + \"\";\n\t            }\n\t            if (fields.series) {\n\t                info += \", <em>\" + fields.series + \"<\\/em>\";\n\t            }\n\t            if (fields.volume) {\n\t                info += \", Vol.\" + fields.volume;\n\t            }\n\t            if (fields.issn) {\n\t                info += \", ISBN: \" + fields.issn;\n\t            }\n\t            return info + \".\";\n\t        },\n\t        _asSentence: function _asSentence(str) {\n\t            return str && str.trim() ? str + \". \" : \"\";\n\t        }\n\t    });\n\t\n\t    var CitationListView = Backbone.View.extend({\n\t        el: '#citations',\n\t        /**\n\t         * Set up view.\n\t         */\n\t        initialize: function initialize() {\n\t            this.listenTo(this.collection, 'add', this.renderCitation);\n\t        },\n\t\n\t        events: {\n\t            'click .citations-to-bibtex': 'showBibtex',\n\t            'click .citations-to-formatted': 'showFormatted'\n\t        },\n\t\n\t        renderCitation: function renderCitation(citation) {\n\t            var citationView = new CitationView({ model: citation });\n\t            this.$(\".citations-formatted\").append(citationView.render().el);\n\t            var rawTextarea = this.$(\".citations-bibtex-text\");\n\t            rawTextarea.val(rawTextarea.val() + \"\\n\\r\" + citation.attributes.content);\n\t        },\n\t\n\t        render: function render() {\n\t            this.$el.html(this.citationsElement());\n\t            this.collection.each(function (item) {\n\t                this.renderCitation(item);\n\t            }, this);\n\t            this.showFormatted();\n\t        },\n\t\n\t        showBibtex: function showBibtex() {\n\t            this.$(\".citations-to-formatted\").show();\n\t            this.$(\".citations-to-bibtex\").hide();\n\t            this.$(\".citations-bibtex\").show();\n\t            this.$(\".citations-formatted\").hide();\n\t            this.$(\".citations-bibtex-text\").select();\n\t        },\n\t\n\t        showFormatted: function showFormatted() {\n\t            this.$(\".citations-to-formatted\").hide();\n\t            this.$(\".citations-to-bibtex\").show();\n\t            this.$(\".citations-bibtex\").hide();\n\t            this.$(\".citations-formatted\").show();\n\t        },\n\t\n\t        partialWarningElement: function partialWarningElement() {\n\t            if (this.collection.partial) {\n\t                return ['<div style=\"padding:5px 10px\">', '<b>Warning: This is a experimental feature.</b> Most Galaxy tools will not annotate', ' citations explicitly at this time. When writing up your analysis, please manually', ' review your histories and find all references', ' that should be cited in order to completely describe your work. Also, please remember to', ' <a href=\"https://wiki.galaxyproject.org/CitingGalaxy\">cite Galaxy</a>.', '</div>'].join('');\n\t            } else {\n\t                return '';\n\t            }\n\t        },\n\t\n\t        citationsElement: function citationsElement() {\n\t            return ['<div class=\"toolForm\">', '<div class=\"toolFormTitle\">', _l(\"Citations\"), ' <button type=\"button\" class=\"btn btn-xs citations-to-bibtex\" title=\"Show all in BibTeX format.\"><i class=\"fa fa-pencil-square-o\"></i> Show BibTeX</button>', ' <button type=\"button\" class=\"btn btn-xs citations-to-formatted\" title=\"Return to formatted citation list.\"><i class=\"fa fa-times\"></i> Hide BibTeX</button>', '</div>', '<div class=\"toolFormBody\" style=\"padding:5px 10px\">', this.partialWarningElement(), '<span class=\"citations-formatted\" style=\"word-wrap: break-word;\"></span>', '</div>', '<div class=\"citations-bibtex toolFormBody\" style=\"padding:5px 10px\">', '<textarea style=\"width: 100%; height: 500px;\" class=\"citations-bibtex-text\"></textarea>', '</div>', '</div>'].join('');\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    return {\n\t        CitationView: CitationView,\n\t        CitationListView: CitationListView\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3)))\n\n/***/ },\n/* 38 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(_, $, jQuery) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(51), __webpack_require__(41), __webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (LIST_ITEM, DATASET_LI, BASE_MVC, _l) {\n\t\n\t    'use strict';\n\t    //==============================================================================\n\t\n\t    var FoldoutListItemView = LIST_ITEM.FoldoutListItemView,\n\t        ListItemView = LIST_ITEM.ListItemView;\n\t    /** @class Read only view for DatasetCollection.\n\t     */\n\t    var DCListItemView = FoldoutListItemView.extend(\n\t    /** @lends DCListItemView.prototype */{\n\t        //TODO: may not be needed\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        className: FoldoutListItemView.prototype.className + \" dataset-collection\",\n\t        id: function id() {\n\t            return ['dataset_collection', this.model.get('id')].join('-');\n\t        },\n\t\n\t        /** override to add linkTarget */\n\t        initialize: function initialize(attributes) {\n\t            this.linkTarget = attributes.linkTarget || '_blank';\n\t            this.hasUser = attributes.hasUser;\n\t            FoldoutListItemView.prototype.initialize.call(this, attributes);\n\t        },\n\t\n\t        /** event listeners */\n\t        _setUpListeners: function _setUpListeners() {\n\t            FoldoutListItemView.prototype._setUpListeners.call(this);\n\t            this.listenTo(this.model, 'change', function (model, options) {\n\t                // if the model has changed deletion status render it entirely\n\t                if (_.has(model.changed, 'deleted')) {\n\t                    this.render();\n\t\n\t                    // if the model has been decorated after the fact with the element count,\n\t                    // render the subtitle where the count is displayed\n\t                } else if (_.has(model.changed, 'element_count')) {\n\t                    this.$('> .title-bar .subtitle').replaceWith(this._renderSubtitle());\n\t                }\n\t            });\n\t        },\n\t\n\t        // ......................................................................... rendering\n\t        /** render a subtitle to show the user what sort of collection this is */\n\t        _renderSubtitle: function _renderSubtitle() {\n\t            return $(this.templates.subtitle(this.model.toJSON(), this));\n\t        },\n\t\n\t        // ......................................................................... foldout\n\t        /** override to add linktarget to sub-panel */\n\t        _getFoldoutPanelOptions: function _getFoldoutPanelOptions() {\n\t            var options = FoldoutListItemView.prototype._getFoldoutPanelOptions.call(this);\n\t            return _.extend(options, {\n\t                linkTarget: this.linkTarget,\n\t                hasUser: this.hasUser\n\t            });\n\t        },\n\t\n\t        /** override to not catch sub-panel selectors */\n\t        $selector: function $selector() {\n\t            return this.$('> .selector');\n\t        },\n\t\n\t        // ......................................................................... misc\n\t        /** String representation */\n\t        toString: function toString() {\n\t            var modelString = this.model ? this.model + '' : '(no model)';\n\t            return 'DCListItemView(' + modelString + ')';\n\t        }\n\t    });\n\t\n\t    // ............................................................................ TEMPLATES\n\t    /** underscore templates */\n\t    DCListItemView.prototype.templates = function () {\n\t\n\t        var warnings = _.extend({}, FoldoutListItemView.prototype.templates.warnings, {\n\t            error: BASE_MVC.wrapTemplate([\n\t            // error during index fetch - show error on dataset\n\t            '<% if( model.error ){ %>', '<div class=\"errormessagesmall\">', _l('There was an error getting the data for this collection'), ': <%- model.error %>', '</div>', '<% } %>']),\n\t            purged: BASE_MVC.wrapTemplate(['<% if( model.purged ){ %>', '<div class=\"purged-msg warningmessagesmall\">', _l('This collection has been deleted and removed from disk'), '</div>', '<% } %>']),\n\t            deleted: BASE_MVC.wrapTemplate([\n\t            // deleted not purged\n\t            '<% if( model.deleted && !model.purged ){ %>', '<div class=\"deleted-msg warningmessagesmall\">', _l('This collection has been deleted'), '</div>', '<% } %>'])\n\t        });\n\t\n\t        // use element identifier\n\t        var titleBarTemplate = BASE_MVC.wrapTemplate(['<div class=\"title-bar clear\" tabindex=\"0\">', '<div class=\"title\">', '<span class=\"name\"><%- collection.element_identifier || collection.name %></span>', '</div>', '<div class=\"subtitle\"></div>', '</div>'], 'collection');\n\t\n\t        // use element identifier\n\t        var subtitleTemplate = BASE_MVC.wrapTemplate(['<div class=\"subtitle\">', '<% var countText = collection.element_count? ( collection.element_count + \" \" ) : \"\"; %>', '<%        if( collection.collection_type === \"list\" ){ %>', _l('a list of <%- countText %>datasets'), '<% } else if( collection.collection_type === \"paired\" ){ %>', _l('a pair of datasets'), '<% } else if( collection.collection_type === \"list:paired\" ){ %>', _l('a list of <%- countText %>dataset pairs'), '<% } %>', '</div>'], 'collection');\n\t\n\t        return _.extend({}, FoldoutListItemView.prototype.templates, {\n\t            warnings: warnings,\n\t            titleBar: titleBarTemplate,\n\t            subtitle: subtitleTemplate\n\t        });\n\t    }();\n\t\n\t    //==============================================================================\n\t    /** @class Read only view for DatasetCollectionElement.\n\t     */\n\t    var DCEListItemView = ListItemView.extend(\n\t    /** @lends DCEListItemView.prototype */{\n\t        //TODO: this might be expendable - compacted with HDAListItemView\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        /** add the DCE class to the list item */\n\t        className: ListItemView.prototype.className + \" dataset-collection-element\",\n\t\n\t        /** set up */\n\t        initialize: function initialize(attributes) {\n\t            if (attributes.logger) {\n\t                this.logger = this.model.logger = attributes.logger;\n\t            }\n\t            this.log('DCEListItemView.initialize:', attributes);\n\t            ListItemView.prototype.initialize.call(this, attributes);\n\t        },\n\t\n\t        // ......................................................................... misc\n\t        /** String representation */\n\t        toString: function toString() {\n\t            var modelString = this.model ? this.model + '' : '(no model)';\n\t            return 'DCEListItemView(' + modelString + ')';\n\t        }\n\t    });\n\t\n\t    // ............................................................................ TEMPLATES\n\t    /** underscore templates */\n\t    DCEListItemView.prototype.templates = function () {\n\t\n\t        // use the element identifier here - since that will persist and the user will need it\n\t        var titleBarTemplate = BASE_MVC.wrapTemplate(['<div class=\"title-bar clear\" tabindex=\"0\">', '<div class=\"title\">', '<span class=\"name\"><%- element.element_identifier %></span>', '</div>', '<div class=\"subtitle\"></div>', '</div>'], 'element');\n\t\n\t        return _.extend({}, ListItemView.prototype.templates, {\n\t            titleBar: titleBarTemplate\n\t        });\n\t    }();\n\t\n\t    //==============================================================================\n\t    /** @class Read only view for a DatasetCollectionElement that is also an DatasetAssociation\n\t     *      (a dataset contained in a dataset collection).\n\t     */\n\t    var DatasetDCEListItemView = DATASET_LI.DatasetListItemView.extend(\n\t    /** @lends DatasetDCEListItemView.prototype */{\n\t\n\t        className: DATASET_LI.DatasetListItemView.prototype.className + \" dataset-collection-element\",\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        /** set up */\n\t        initialize: function initialize(attributes) {\n\t            if (attributes.logger) {\n\t                this.logger = this.model.logger = attributes.logger;\n\t            }\n\t            this.log('DatasetDCEListItemView.initialize:', attributes);\n\t            DATASET_LI.DatasetListItemView.prototype.initialize.call(this, attributes);\n\t        },\n\t\n\t        /** In this override, only get details if in the ready state.\n\t         *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n\t         */\n\t        _fetchModelDetails: function _fetchModelDetails() {\n\t            var view = this;\n\t            if (view.model.inReadyState() && !view.model.hasDetails()) {\n\t                return view.model.fetch({ silent: true });\n\t            }\n\t            return jQuery.when();\n\t        },\n\t\n\t        // ......................................................................... misc\n\t        /** String representation */\n\t        toString: function toString() {\n\t            var modelString = this.model ? this.model + '' : '(no model)';\n\t            return 'DatasetDCEListItemView(' + modelString + ')';\n\t        }\n\t    });\n\t\n\t    // ............................................................................ TEMPLATES\n\t    /** underscore templates */\n\t    DatasetDCEListItemView.prototype.templates = function () {\n\t\n\t        // use the element identifier here and not the dataset name\n\t        //TODO:?? can we steal the DCE titlebar?\n\t        var titleBarTemplate = BASE_MVC.wrapTemplate(['<div class=\"title-bar clear\" tabindex=\"0\">', '<span class=\"state-icon\"></span>', '<div class=\"title\">', '<span class=\"name\"><%- element.element_identifier %></span>', '</div>', '</div>'], 'element');\n\t\n\t        return _.extend({}, DATASET_LI.DatasetListItemView.prototype.templates, {\n\t            titleBar: titleBarTemplate\n\t        });\n\t    }();\n\t\n\t    //==============================================================================\n\t    /** @class Read only view for a DatasetCollectionElement that is also a DatasetCollection\n\t     *      (a nested DC).\n\t     */\n\t    var NestedDCDCEListItemView = DCListItemView.extend(\n\t    /** @lends NestedDCDCEListItemView.prototype */{\n\t\n\t        className: DCListItemView.prototype.className + \" dataset-collection-element\",\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        // comment this out to suppress log output\n\t        //logger              : console,\n\t\n\t        /** In this override, add the state as a class for use with state-based CSS */\n\t        _swapNewRender: function _swapNewRender($newRender) {\n\t            DCListItemView.prototype._swapNewRender.call(this, $newRender);\n\t            //TODO: model currently has no state\n\t            var state = this.model.get('state') || 'ok';\n\t            //if( this.model.has( 'state' ) ){\n\t            this.$el.addClass('state-' + state);\n\t            //}\n\t            return this.$el;\n\t        },\n\t\n\t        // ......................................................................... misc\n\t        /** String representation */\n\t        toString: function toString() {\n\t            var modelString = this.model ? this.model + '' : '(no model)';\n\t            return 'NestedDCDCEListItemView(' + modelString + ')';\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    return {\n\t        DCListItemView: DCListItemView,\n\t        DCEListItemView: DCEListItemView,\n\t        DatasetDCEListItemView: DatasetDCEListItemView,\n\t        NestedDCDCEListItemView: NestedDCDCEListItemView\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(1)))\n\n/***/ },\n/* 39 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(_, Backbone, jQuery) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(78), __webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (DATASET_MODEL, BASE_MVC, _l) {\n\t\n\t    'use strict';\n\t\n\t    var logNamespace = 'collections';\n\t    //==============================================================================\n\t    /*\n\t    Notes:\n\t    \n\t    Terminology:\n\t        DatasetCollection/DC : a container of datasets or nested DatasetCollections\n\t        Element/DatasetCollectionElement/DCE : an item contained in a DatasetCollection\n\t        HistoryDatasetCollectionAssociation/HDCA: a DatasetCollection contained in a history\n\t    \n\t    \n\t    This all seems too complex unfortunately:\n\t    \n\t    - Terminology collision between DatasetCollections (DCs) and Backbone Collections.\n\t    - In the DatasetCollections API JSON, DC Elements use a 'Has A' stucture to *contain*\n\t        either a dataset or a nested DC. This would make the hierarchy much taller. I've\n\t        decided to merge the contained JSON with the DC element json - making the 'has a'\n\t        relation into an 'is a' relation. This seems simpler to me and allowed a lot of\n\t        DRY in both models and views, but may make tracking or tracing within these models\n\t        more difficult (since DatasetCollectionElements are now *also* DatasetAssociations\n\t        or DatasetCollections (nested)). This also violates the rule of thumb about\n\t        favoring aggregation over inheritance.\n\t    - Currently, there are three DatasetCollection subclasses: List, Pair, and ListPaired.\n\t        These each should a) be usable on their own, b) be usable in the context of\n\t        nesting within a collection model (at least in the case of ListPaired), and\n\t        c) be usable within the context of other container models (like History or\n\t        LibraryFolder, etc.). I've tried to separate/extract classes in order to\n\t        handle those three situations, but it's proven difficult to do in a simple,\n\t        readable manner.\n\t    - Ideally, histories and libraries would inherit from the same server models as\n\t        dataset collections do since they are (in essence) dataset collections themselves -\n\t        making the whole nested structure simpler. This would be a large, error-prone\n\t        refactoring and migration.\n\t    \n\t    Many of the classes and heirarchy are meant as extension points so, while the\n\t    relations and flow may be difficult to understand initially, they'll allow us to\n\t    handle the growth or flux dataset collection in the future (w/o actually implementing\n\t    any YAGNI).\n\t    \n\t    */\n\t    //_________________________________________________________________________________________________ ELEMENTS\n\t    /** @class mixin for Dataset collection elements.\n\t     *      When collection elements are passed from the API, the underlying element is\n\t     *          in a sub-object 'object' (IOW, a DCE representing an HDA will have HDA json in element.object).\n\t     *      This mixin uses the constructor and parse methods to merge that JSON with the DCE attribtues\n\t     *          effectively changing a DCE from a container to a subclass (has a --> is a).\n\t     */\n\t    var DatasetCollectionElementMixin = {\n\t\n\t        /** default attributes used by elements in a dataset collection */\n\t        defaults: {\n\t            model_class: 'DatasetCollectionElement',\n\t            element_identifier: null,\n\t            element_index: null,\n\t            element_type: null\n\t        },\n\t\n\t        /** merge the attributes of the sub-object 'object' into this model */\n\t        _mergeObject: function _mergeObject(attributes) {\n\t            // if we don't preserve and correct ids here, the element id becomes the object id\n\t            // and collision in backbone's _byId will occur and only\n\t            _.extend(attributes, attributes.object, { element_id: attributes.id });\n\t            delete attributes.object;\n\t            return attributes;\n\t        },\n\t\n\t        /** override to merge this.object into this */\n\t        constructor: function constructor(attributes, options) {\n\t            // console.debug( '\\t DatasetCollectionElement.constructor:', attributes, options );\n\t            attributes = this._mergeObject(attributes);\n\t            this.idAttribute = 'element_id';\n\t            Backbone.Model.apply(this, arguments);\n\t        },\n\t\n\t        /** when the model is fetched, merge this.object into this */\n\t        parse: function parse(response, options) {\n\t            var attributes = response;\n\t            attributes = this._mergeObject(attributes);\n\t            return attributes;\n\t        }\n\t    };\n\t\n\t    //TODO: unused?\n\t    /** @class Concrete class of Generic DatasetCollectionElement */\n\t    var DatasetCollectionElement = Backbone.Model.extend(BASE_MVC.LoggableMixin).extend(DatasetCollectionElementMixin).extend({ _logNamespace: logNamespace });\n\t\n\t    //==============================================================================\n\t    /** @class Base/Abstract Backbone collection for Generic DCEs. */\n\t    var DCECollection = Backbone.Collection.extend(BASE_MVC.LoggableMixin).extend(\n\t    /** @lends DCECollection.prototype */{\n\t        _logNamespace: logNamespace,\n\t\n\t        model: DatasetCollectionElement,\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        //TODO: unused?\n\t        /** Set up.\n\t         *  @see Backbone.Collection#initialize\n\t         */\n\t        initialize: function initialize(attributes, options) {\n\t            this.debug(this + '(DCECollection).initialize:', attributes, options);\n\t            options = options || {};\n\t            //this._setUpListeners();\n\t        },\n\t\n\t        /** String representation. */\n\t        toString: function toString() {\n\t            return ['DatasetCollectionElementCollection(', this.length, ')'].join('');\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    /** @class Backbone model for a dataset collection element that is a dataset (HDA).\n\t     */\n\t    var DatasetDCE = DATASET_MODEL.DatasetAssociation.extend(BASE_MVC.mixin(DatasetCollectionElementMixin,\n\t    /** @lends DatasetDCE.prototype */{\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        /** url fn */\n\t        url: function url() {\n\t            // won't always be an hda\n\t            if (!this.has('history_id')) {\n\t                console.warn('no endpoint for non-hdas within a collection yet');\n\t                // (a little silly since this api endpoint *also* points at hdas)\n\t                return Galaxy.root + 'api/datasets';\n\t            }\n\t            return Galaxy.root + 'api/histories/' + this.get('history_id') + '/contents/' + this.get('id');\n\t        },\n\t\n\t        defaults: _.extend({}, DATASET_MODEL.DatasetAssociation.prototype.defaults, DatasetCollectionElementMixin.defaults),\n\t\n\t        // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n\t        //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n\t        //  - re-apply manually for now\n\t        /** call the mixin constructor */\n\t        constructor: function constructor(attributes, options) {\n\t            this.debug('\\t DatasetDCE.constructor:', attributes, options);\n\t            //DATASET_MODEL.DatasetAssociation.prototype.constructor.call( this, attributes, options );\n\t            DatasetCollectionElementMixin.constructor.call(this, attributes, options);\n\t        },\n\t\n\t        //TODO: unused?\n\t        /** set up */\n\t        initialize: function initialize(attributes, options) {\n\t            this.debug(this + '(DatasetDCE).initialize:', attributes, options);\n\t            DATASET_MODEL.DatasetAssociation.prototype.initialize.call(this, attributes, options);\n\t        },\n\t\n\t        /** Does this model already contain detailed data (as opposed to just summary level data)? */\n\t        hasDetails: function hasDetails() {\n\t            // dataset collection api does return genome_build but doesn't return annotation\n\t            return _.has(this.attributes, 'annotation');\n\t        },\n\t\n\t        /** String representation. */\n\t        toString: function toString() {\n\t            var objStr = this.get('element_identifier');\n\t            return ['DatasetDCE(', objStr, ')'].join('');\n\t        }\n\t    }));\n\t\n\t    //==============================================================================\n\t    /** @class DCECollection of DatasetDCE's (a list of datasets, a pair of datasets).\n\t     */\n\t    var DatasetDCECollection = DCECollection.extend(\n\t    /** @lends DatasetDCECollection.prototype */{\n\t        model: DatasetDCE,\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        //TODO: unused?\n\t        /** set up */\n\t        initialize: function initialize(attributes, options) {\n\t            this.debug(this + '(DatasetDCECollection).initialize:', attributes, options);\n\t            DCECollection.prototype.initialize.call(this, attributes, options);\n\t        },\n\t\n\t        /** String representation. */\n\t        toString: function toString() {\n\t            return ['DatasetDCECollection(', this.length, ')'].join('');\n\t        }\n\t    });\n\t\n\t    //_________________________________________________________________________________________________ COLLECTIONS\n\t    /** @class Backbone model for Dataset Collections.\n\t     *      The DC API returns an array of JSON objects under the attribute elements.\n\t     *      This model:\n\t     *          - removes that array/attribute ('elements') from the model,\n\t     *          - creates a bbone collection (of the class defined in the 'collectionClass' attribute),\n\t     *          - passes that json onto the bbone collection\n\t     *          - caches the bbone collection in this.elements\n\t     */\n\t    var DatasetCollection = Backbone.Model.extend(BASE_MVC.LoggableMixin).extend(BASE_MVC.SearchableModelMixin).extend( /** @lends DatasetCollection.prototype */{\n\t        _logNamespace: logNamespace,\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        /** default attributes for a model */\n\t        defaults: {\n\t            /* 'list', 'paired', or 'list:paired' */\n\t            collection_type: null,\n\t            //??\n\t            deleted: false\n\t        },\n\t\n\t        /** Which class to use for elements */\n\t        collectionClass: DCECollection,\n\t\n\t        /** set up: create elements instance var and (on changes to elements) update them  */\n\t        initialize: function initialize(model, options) {\n\t            this.debug(this + '(DatasetCollection).initialize:', model, options, this);\n\t            //historyContent.HistoryContent.prototype.initialize.call( this, attrs, options );\n\t            this.elements = this._createElementsModel();\n\t            this.on('change:elements', function () {\n\t                this.log('change:elements');\n\t                //TODO: prob. better to update the collection instead of re-creating it\n\t                this.elements = this._createElementsModel();\n\t            });\n\t        },\n\t\n\t        /** move elements model attribute to full collection */\n\t        _createElementsModel: function _createElementsModel() {\n\t            this.debug(this + '._createElementsModel', this.collectionClass, this.get('elements'), this.elements);\n\t            //TODO: same patterns as DatasetCollectionElement _createObjectModel - refactor to BASE_MVC.hasSubModel?\n\t            var elements = this.get('elements') || [];\n\t            this.unset('elements', { silent: true });\n\t            this.elements = new this.collectionClass(elements);\n\t            //this.debug( 'collectionClass:', this.collectionClass + '', this.elements );\n\t            return this.elements;\n\t        },\n\t\n\t        // ........................................................................ common queries\n\t        /** pass the elements back within the model json when this is serialized */\n\t        toJSON: function toJSON() {\n\t            var json = Backbone.Model.prototype.toJSON.call(this);\n\t            if (this.elements) {\n\t                json.elements = this.elements.toJSON();\n\t            }\n\t            return json;\n\t        },\n\t\n\t        /** Is this collection in a 'ready' state no processing (for the collection) is left\n\t         *  to do on the server.\n\t         */\n\t        inReadyState: function inReadyState() {\n\t            var populated = this.get('populated');\n\t            return this.isDeletedOrPurged() || populated;\n\t        },\n\t\n\t        //TODO:?? the following are the same interface as DatasetAssociation - can we combine?\n\t        /** Does the DC contain any elements yet? Is a fetch() required? */\n\t        hasDetails: function hasDetails() {\n\t            //TODO: this is incorrect for (accidentally) empty collections\n\t            this.debug('hasDetails:', this.elements.length);\n\t            return this.elements.length !== 0;\n\t        },\n\t\n\t        /** Given the filters, what models in this.elements would be returned? */\n\t        getVisibleContents: function getVisibleContents(filters) {\n\t            // filters unused for now\n\t            return this.elements;\n\t        },\n\t\n\t        // ........................................................................ ajax\n\t        /** save this dataset, _Mark_ing it as deleted (just a flag) */\n\t        'delete': function _delete(options) {\n\t            if (this.get('deleted')) {\n\t                return jQuery.when();\n\t            }\n\t            return this.save({ deleted: true }, options);\n\t        },\n\t        /** save this dataset, _Mark_ing it as undeleted */\n\t        undelete: function undelete(options) {\n\t            if (!this.get('deleted') || this.get('purged')) {\n\t                return jQuery.when();\n\t            }\n\t            return this.save({ deleted: false }, options);\n\t        },\n\t\n\t        /** Is this collection deleted or purged? */\n\t        isDeletedOrPurged: function isDeletedOrPurged() {\n\t            return this.get('deleted') || this.get('purged');\n\t        },\n\t\n\t        // ........................................................................ searchable\n\t        /** searchable attributes for collections */\n\t        searchAttributes: ['name'],\n\t\n\t        // ........................................................................ misc\n\t        /** String representation */\n\t        toString: function toString() {\n\t            var idAndName = [this.get('id'), this.get('name') || this.get('element_identifier')];\n\t            return 'DatasetCollection(' + idAndName.join(',') + ')';\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    /** Model for a DatasetCollection containing datasets (non-nested).\n\t     */\n\t    var ListDatasetCollection = DatasetCollection.extend(\n\t    /** @lends ListDatasetCollection.prototype */{\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        /** override since we know the collection will only contain datasets */\n\t        collectionClass: DatasetDCECollection,\n\t\n\t        //TODO: unused?\n\t        initialize: function initialize(attrs, options) {\n\t            this.debug(this + '(ListDatasetCollection).initialize:', attrs, options);\n\t            DatasetCollection.prototype.initialize.call(this, attrs, options);\n\t        },\n\t\n\t        /** String representation. */\n\t        toString: function toString() {\n\t            return ['ListDatasetCollection(', this.get('name'), ')'].join('');\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    /** Model for a DatasetCollection containing fwd/rev datasets (a list of 2).\n\t     */\n\t    var PairDatasetCollection = ListDatasetCollection.extend(\n\t    /** @lends PairDatasetCollection.prototype */{\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        //TODO: unused?\n\t        /**  */\n\t        initialize: function initialize(attrs, options) {\n\t            this.debug(this + '(PairDatasetCollection).initialize:', attrs, options);\n\t            ListDatasetCollection.prototype.initialize.call(this, attrs, options);\n\t        },\n\t\n\t        /** String representation. */\n\t        toString: function toString() {\n\t            return ['PairDatasetCollection(', this.get('name'), ')'].join('');\n\t        }\n\t    });\n\t\n\t    //_________________________________________________________________________________________________ NESTED COLLECTIONS\n\t    // this is where things get weird, man. Weird.\n\t    //TODO: it might be possible to compact all the following...I think.\n\t    //==============================================================================\n\t    /** @class Backbone model for a Generic DatasetCollectionElement that is also a DatasetCollection\n\t     *      (a nested collection). Currently only list:paired.\n\t     */\n\t    var NestedDCDCE = DatasetCollection.extend(BASE_MVC.mixin(DatasetCollectionElementMixin,\n\t    /** @lends NestedDCDCE.prototype */{\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n\t        //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n\t        //  - re-apply manually it now\n\t        /** call the mixin constructor */\n\t        constructor: function constructor(attributes, options) {\n\t            this.debug('\\t NestedDCDCE.constructor:', attributes, options);\n\t            DatasetCollectionElementMixin.constructor.call(this, attributes, options);\n\t        },\n\t\n\t        /** String representation. */\n\t        toString: function toString() {\n\t            var objStr = this.object ? '' + this.object : this.get('element_identifier');\n\t            return ['NestedDCDCE(', objStr, ')'].join('');\n\t        }\n\t    }));\n\t\n\t    //==============================================================================\n\t    /** @class Backbone collection containing Generic NestedDCDCE's (nested dataset collections).\n\t     */\n\t    var NestedDCDCECollection = DCECollection.extend(\n\t    /** @lends NestedDCDCECollection.prototype */{\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        /** This is a collection of nested collections */\n\t        model: NestedDCDCE,\n\t\n\t        //TODO: unused?\n\t        /** set up */\n\t        initialize: function initialize(attrs, options) {\n\t            this.debug(this + '(NestedDCDCECollection).initialize:', attrs, options);\n\t            DCECollection.prototype.initialize.call(this, attrs, options);\n\t        },\n\t\n\t        /** String representation. */\n\t        toString: function toString() {\n\t            return ['NestedDCDCECollection(', this.length, ')'].join('');\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    /** @class Backbone model for a paired dataset collection within a list:paired dataset collection.\n\t     */\n\t    var NestedPairDCDCE = PairDatasetCollection.extend(BASE_MVC.mixin(DatasetCollectionElementMixin,\n\t    /** @lends NestedPairDCDCE.prototype */{\n\t        //TODO:?? possibly rename to NestedDatasetCollection?\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n\t        //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n\t        //  - re-apply manually it now\n\t        /** This is both a collection and a collection element - call the constructor */\n\t        constructor: function constructor(attributes, options) {\n\t            this.debug('\\t NestedPairDCDCE.constructor:', attributes, options);\n\t            //DatasetCollection.constructor.call( this, attributes, options );\n\t            DatasetCollectionElementMixin.constructor.call(this, attributes, options);\n\t        },\n\t\n\t        /** String representation. */\n\t        toString: function toString() {\n\t            var objStr = this.object ? '' + this.object : this.get('element_identifier');\n\t            return ['NestedPairDCDCE(', objStr, ')'].join('');\n\t        }\n\t    }));\n\t\n\t    //==============================================================================\n\t    /** @class Backbone collection for a backbone collection containing paired dataset collections.\n\t     */\n\t    var NestedPairDCDCECollection = NestedDCDCECollection.extend(\n\t    /** @lends PairDCDCECollection.prototype */{\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        /** We know this collection is composed of only nested pair collections */\n\t        model: NestedPairDCDCE,\n\t\n\t        //TODO: unused?\n\t        /** set up */\n\t        initialize: function initialize(attrs, options) {\n\t            this.debug(this + '(NestedPairDCDCECollection).initialize:', attrs, options);\n\t            NestedDCDCECollection.prototype.initialize.call(this, attrs, options);\n\t        },\n\t\n\t        /** String representation. */\n\t        toString: function toString() {\n\t            return ['NestedPairDCDCECollection(', this.length, ')'].join('');\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    /** @class Backbone Model for a DatasetCollection (list) that contains DatasetCollections (pairs).\n\t     */\n\t    var ListPairedDatasetCollection = DatasetCollection.extend(\n\t    /** @lends ListPairedDatasetCollection.prototype */{\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        /** list:paired is the only collection that itself contains collections */\n\t        collectionClass: NestedPairDCDCECollection,\n\t\n\t        //TODO: unused?\n\t        /** set up */\n\t        initialize: function initialize(attributes, options) {\n\t            this.debug(this + '(ListPairedDatasetCollection).initialize:', attributes, options);\n\t            DatasetCollection.prototype.initialize.call(this, attributes, options);\n\t        },\n\t\n\t        /** String representation. */\n\t        toString: function toString() {\n\t            return ['ListPairedDatasetCollection(', this.get('name'), ')'].join('');\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    return {\n\t        ListDatasetCollection: ListDatasetCollection,\n\t        PairDatasetCollection: PairDatasetCollection,\n\t        ListPairedDatasetCollection: ListPairedDatasetCollection\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(3), __webpack_require__(1)))\n\n/***/ },\n/* 40 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, $, jQuery) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(48), __webpack_require__(12), __webpack_require__(6), __webpack_require__(8), __webpack_require__(90), __webpack_require__(5), __webpack_require__(88)], __WEBPACK_AMD_DEFINE_RESULT__ = function (HDCA, STATES, BASE_MVC, UI_MODAL, naturalSort, _l) {\n\t\n\t    'use strict';\n\t\n\t    var logNamespace = 'collections';\n\t    /*==============================================================================\n\t    TODO:\n\t        use proper Element model and not just json\n\t        straighten out createFn, collection.createHDCA\n\t        possibly stop using modals for this\n\t        It would be neat to do a drag and drop\n\t    \n\t    ==============================================================================*/\n\t    /** A view for both DatasetDCEs and NestedDCDCEs\n\t     *  (things that implement collection-model:DatasetCollectionElementMixin)\n\t     */\n\t    var DatasetCollectionElementView = Backbone.View.extend(BASE_MVC.LoggableMixin).extend({\n\t        _logNamespace: logNamespace,\n\t\n\t        //TODO: use proper class (DatasetDCE or NestedDCDCE (or the union of both))\n\t        tagName: 'li',\n\t        className: 'collection-element',\n\t\n\t        initialize: function initialize(attributes) {\n\t            this.element = attributes.element || {};\n\t            this.selected = attributes.selected || false;\n\t        },\n\t\n\t        render: function render() {\n\t            this.$el.attr('data-element-id', this.element.id).attr('draggable', true).html(this.template({ element: this.element }));\n\t            if (this.selected) {\n\t                this.$el.addClass('selected');\n\t            }\n\t            return this;\n\t        },\n\t\n\t        //TODO: lots of unused space in the element - possibly load details and display them horiz.\n\t        template: _.template(['<a class=\"name\" title=\"', _l('Click to rename'), '\" href=\"javascript:void(0)\">', '<%- element.name %>', '</a>', '<button class=\"discard btn btn-sm\" title=\"', _l('Remove this dataset from the list'), '\">', _l('Discard'), '</button>'].join('')),\n\t\n\t        /** select this element and pub */\n\t        select: function select(toggle) {\n\t            this.$el.toggleClass('selected', toggle);\n\t            this.trigger('select', {\n\t                source: this,\n\t                selected: this.$el.hasClass('selected')\n\t            });\n\t        },\n\t\n\t        /** animate the removal of this element and pub */\n\t        discard: function discard() {\n\t            var view = this,\n\t                parentWidth = this.$el.parent().width();\n\t            this.$el.animate({ 'margin-right': parentWidth }, 'fast', function () {\n\t                view.trigger('discard', {\n\t                    source: view\n\t                });\n\t                view.destroy();\n\t            });\n\t        },\n\t\n\t        /** remove the DOM and any listeners */\n\t        destroy: function destroy() {\n\t            this.off();\n\t            this.$el.remove();\n\t        },\n\t\n\t        events: {\n\t            'click': '_click',\n\t            'click .name': '_clickName',\n\t            'click .discard': '_clickDiscard',\n\t\n\t            'dragstart': '_dragstart',\n\t            'dragend': '_dragend',\n\t            'dragover': '_sendToParent',\n\t            'drop': '_sendToParent'\n\t        },\n\t\n\t        /** select when the li is clicked */\n\t        _click: function _click(ev) {\n\t            ev.stopPropagation();\n\t            this.select(ev);\n\t        },\n\t\n\t        /** rename a pair when the name is clicked */\n\t        _clickName: function _clickName(ev) {\n\t            ev.stopPropagation();\n\t            ev.preventDefault();\n\t            var promptString = [_l('Enter a new name for the element'), ':\\n(', _l('Note that changing the name here will not rename the dataset'), ')'].join(''),\n\t                response = prompt(_l('Enter a new name for the element') + ':', this.element.name);\n\t            if (response) {\n\t                this.element.name = response;\n\t                this.render();\n\t            }\n\t            //TODO: cancelling with ESC leads to closure of the creator...\n\t        },\n\t\n\t        /** discard when the discard button is clicked */\n\t        _clickDiscard: function _clickDiscard(ev) {\n\t            ev.stopPropagation();\n\t            this.discard();\n\t        },\n\t\n\t        /** dragging pairs for re-ordering */\n\t        _dragstart: function _dragstart(ev) {\n\t            if (ev.originalEvent) {\n\t                ev = ev.originalEvent;\n\t            }\n\t            ev.dataTransfer.effectAllowed = 'move';\n\t            ev.dataTransfer.setData('text/plain', JSON.stringify(this.element));\n\t\n\t            this.$el.addClass('dragging');\n\t            this.$el.parent().trigger('collection-element.dragstart', [this]);\n\t        },\n\t\n\t        /** dragging for re-ordering */\n\t        _dragend: function _dragend(ev) {\n\t            this.$el.removeClass('dragging');\n\t            this.$el.parent().trigger('collection-element.dragend', [this]);\n\t        },\n\t\n\t        /** manually bubble up an event to the parent/container */\n\t        _sendToParent: function _sendToParent(ev) {\n\t            this.$el.parent().trigger(ev);\n\t        },\n\t\n\t        /** string rep */\n\t        toString: function toString() {\n\t            return 'DatasetCollectionElementView()';\n\t        }\n\t    });\n\t\n\t    // ============================================================================\n\t    /** An interface for building collections.\n\t     */\n\t    var ListCollectionCreator = Backbone.View.extend(BASE_MVC.LoggableMixin).extend({\n\t        _logNamespace: logNamespace,\n\t\n\t        /** the class used to display individual elements */\n\t        elementViewClass: DatasetCollectionElementView,\n\t        /** the class this creator will create and save */\n\t        collectionClass: HDCA.HistoryListDatasetCollection,\n\t        className: 'list-collection-creator collection-creator flex-row-container',\n\t\n\t        /** minimum number of valid elements to start with in order to build a collection of this type */\n\t        minElements: 1,\n\t\n\t        defaultAttributes: {\n\t            //TODO: remove - use new collectionClass().save()\n\t            /** takes elements and creates the proper collection - returns a promise */\n\t            creationFn: function creationFn() {\n\t                throw new TypeError('no creation fn for creator');\n\t            },\n\t            /** fn to call when the collection is created (scoped to this) */\n\t            oncreate: function oncreate() {},\n\t            /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n\t            oncancel: function oncancel() {},\n\t            /** distance from list edge to begin autoscrolling list */\n\t            autoscrollDist: 24,\n\t            /** Color passed to hoverhighlight */\n\t            highlightClr: 'rgba( 64, 255, 255, 1.0 )'\n\t        },\n\t\n\t        /** set up initial options, instance vars, behaviors */\n\t        initialize: function initialize(attributes) {\n\t            this.metric('ListCollectionCreator.initialize', attributes);\n\t            var creator = this;\n\t            _.each(this.defaultAttributes, function (value, key) {\n\t                value = attributes[key] || value;\n\t                creator[key] = value;\n\t            });\n\t\n\t            /** unordered, original list - cache to allow reversal */\n\t            creator.initialElements = attributes.elements || [];\n\t\n\t            this._instanceSetUp();\n\t            this._elementsSetUp();\n\t            this._setUpBehaviors();\n\t        },\n\t\n\t        /** set up instance vars */\n\t        _instanceSetUp: function _instanceSetUp() {\n\t            /** Ids of elements that have been selected by the user - to preserve over renders */\n\t            this.selectedIds = {};\n\t            /** DOM elements currently being dragged */\n\t            this.$dragging = null;\n\t            /** Used for blocking UI events during ajax/operations (don't post twice) */\n\t            this.blocking = false;\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ process raw list\n\t        /** set up main data */\n\t        _elementsSetUp: function _elementsSetUp() {\n\t            //this.debug( '-- _dataSetUp' );\n\t            /** a list of invalid elements and the reasons they aren't valid */\n\t            this.invalidElements = [];\n\t            //TODO: handle fundamental problem of syncing DOM, views, and list here\n\t            /** data for list in progress */\n\t            this.workingElements = [];\n\t            /** views for workingElements */\n\t            this.elementViews = [];\n\t\n\t            // copy initial list, sort, add ids if needed\n\t            this.workingElements = this.initialElements.slice(0);\n\t            this._ensureElementIds();\n\t            this._validateElements();\n\t            this._mangleDuplicateNames();\n\t            this._sortElements();\n\t        },\n\t\n\t        /** add ids to dataset objs in initial list if none */\n\t        _ensureElementIds: function _ensureElementIds() {\n\t            this.workingElements.forEach(function (element) {\n\t                if (!element.hasOwnProperty('id')) {\n\t                    element.id = _.uniqueId();\n\t                }\n\t            });\n\t            return this.workingElements;\n\t        },\n\t\n\t        /** separate working list into valid and invalid elements for this collection */\n\t        _validateElements: function _validateElements() {\n\t            var creator = this,\n\t                existingNames = {};\n\t            creator.invalidElements = [];\n\t\n\t            this.workingElements = this.workingElements.filter(function (element) {\n\t                var problem = creator._isElementInvalid(element);\n\t                if (problem) {\n\t                    creator.invalidElements.push({\n\t                        element: element,\n\t                        text: problem\n\t                    });\n\t                }\n\t                return !problem;\n\t            });\n\t            return this.workingElements;\n\t        },\n\t\n\t        /** describe what is wrong with a particular element if anything */\n\t        _isElementInvalid: function _isElementInvalid(element) {\n\t            if (element.history_content_type !== 'dataset') {\n\t                return _l(\"is not a dataset\");\n\t            }\n\t            if (element.state !== STATES.OK) {\n\t                if (_.contains(STATES.NOT_READY_STATES, element.state)) {\n\t                    return _l(\"hasn't finished running yet\");\n\t                }\n\t                return _l(\"has errored, is paused, or is not accessible\");\n\t            }\n\t            if (element.deleted || element.purged) {\n\t                return _l(\"has been deleted or purged\");\n\t            }\n\t            return null;\n\t        },\n\t\n\t        /** mangle duplicate names using a mac-like '(counter)' addition to any duplicates */\n\t        _mangleDuplicateNames: function _mangleDuplicateNames() {\n\t            var SAFETY = 900,\n\t                counter = 1,\n\t                existingNames = {};\n\t            this.workingElements.forEach(function (element) {\n\t                var currName = element.name;\n\t                while (existingNames.hasOwnProperty(currName)) {\n\t                    currName = element.name + ' (' + counter + ')';\n\t                    counter += 1;\n\t                    if (counter >= SAFETY) {\n\t                        throw new Error('Safety hit in while loop - thats impressive');\n\t                    }\n\t                }\n\t                element.name = currName;\n\t                existingNames[element.name] = true;\n\t            });\n\t        },\n\t\n\t        /** sort a list of elements */\n\t        _sortElements: function _sortElements(list) {\n\t            // // currently only natural sort by name\n\t            // this.workingElements.sort( function( a, b ){ return naturalSort( a.name, b.name ); });\n\t            // return this.workingElements;\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ rendering\n\t        // templates : ListCollectionCreator.templates,\n\t        /** render the entire interface */\n\t        render: function render(speed, callback) {\n\t            //this.debug( '-- _render' );\n\t            if (this.workingElements.length < this.minElements) {\n\t                return this._renderInvalid(speed, callback);\n\t            }\n\t\n\t            this.$el.empty().html(this.templates.main());\n\t            this._renderHeader(speed);\n\t            this._renderMiddle(speed);\n\t            this._renderFooter(speed);\n\t            this._addPluginComponents();\n\t            this.$('.collection-name').focus();\n\t            this.trigger('rendered', this);\n\t            return this;\n\t        },\n\t\n\t        /** render a simplified interface aimed at telling the user why they can't move forward */\n\t        _renderInvalid: function _renderInvalid(speed, callback) {\n\t            //this.debug( '-- _render' );\n\t            this.$el.empty().html(this.templates.invalidInitial({\n\t                problems: this.invalidElements,\n\t                elements: this.workingElements\n\t            }));\n\t            if (typeof this.oncancel === 'function') {\n\t                this.$('.cancel-create.btn').show();\n\t            }\n\t            this.trigger('rendered', this);\n\t            return this;\n\t        },\n\t\n\t        /** render the header section */\n\t        _renderHeader: function _renderHeader(speed, callback) {\n\t            var $header = this.$('.header').empty().html(this.templates.header()).find('.help-content').prepend($(this.templates.helpContent()));\n\t            //TODO: should only show once despite calling _renderHeader again\n\t            if (this.invalidElements.length) {\n\t                this._invalidElementsAlert();\n\t            }\n\t            return $header;\n\t        },\n\t\n\t        /** render the middle including the elements */\n\t        _renderMiddle: function _renderMiddle(speed, callback) {\n\t            var $middle = this.$('.middle').empty().html(this.templates.middle());\n\t            this._renderList(speed);\n\t            return $middle;\n\t        },\n\t\n\t        /** render the footer, completion controls, and cancel controls */\n\t        _renderFooter: function _renderFooter(speed, callback) {\n\t            var $footer = this.$('.footer').empty().html(this.templates.footer());\n\t            if (typeof this.oncancel === 'function') {\n\t                this.$('.cancel-create.btn').show();\n\t            }\n\t            return $footer;\n\t        },\n\t\n\t        /** add any jQuery/bootstrap/custom plugins to elements rendered */\n\t        _addPluginComponents: function _addPluginComponents() {\n\t            this.$('.help-content i').hoverhighlight('.collection-creator', this.highlightClr);\n\t        },\n\t\n\t        /** build and show an alert describing any elements that could not be included due to problems */\n\t        _invalidElementsAlert: function _invalidElementsAlert() {\n\t            this._showAlert(this.templates.invalidElements({ problems: this.invalidElements }), 'alert-warning');\n\t        },\n\t\n\t        /** add (or clear if clear is truthy) a validation warning to the DOM element described in what */\n\t        _validationWarning: function _validationWarning(what, clear) {\n\t            var VALIDATION_CLASS = 'validation-warning';\n\t            if (what === 'name') {\n\t                what = this.$('.collection-name').add(this.$('.collection-name-prompt'));\n\t                this.$('.collection-name').focus().select();\n\t            }\n\t            if (clear) {\n\t                what = what || this.$('.' + VALIDATION_CLASS);\n\t                what.removeClass(VALIDATION_CLASS);\n\t            } else {\n\t                what.addClass(VALIDATION_CLASS);\n\t            }\n\t        },\n\t\n\t        _disableNameAndCreate: function _disableNameAndCreate(disable) {\n\t            disable = !_.isUndefined(disable) ? disable : true;\n\t            if (disable) {\n\t                this.$('.collection-name').prop('disabled', true);\n\t                this.$('.create-collection').toggleClass('disabled', true);\n\t                // } else {\n\t                //     this.$( '.collection-name' ).prop( 'disabled', false );\n\t                //     this.$( '.create-collection' ).removeClass( 'disable' );\n\t            }\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ rendering elements\n\t        /** conv. to the main list display DOM */\n\t        $list: function $list() {\n\t            return this.$('.collection-elements');\n\t        },\n\t\n\t        /** show or hide the clear selected control based on the num of selected elements */\n\t        _renderClearSelected: function _renderClearSelected() {\n\t            if (_.size(this.selectedIds)) {\n\t                this.$('.collection-elements-controls > .clear-selected').show();\n\t            } else {\n\t                this.$('.collection-elements-controls > .clear-selected').hide();\n\t            }\n\t        },\n\t\n\t        /** render the elements in order (or a warning if no elements found) */\n\t        _renderList: function _renderList(speed, callback) {\n\t            //this.debug( '-- _renderList' );\n\t            var creator = this,\n\t                $tmp = jQuery('<div/>'),\n\t                $list = creator.$list();\n\t\n\t            _.each(this.elementViews, function (view) {\n\t                view.destroy();\n\t                creator.removeElementView(view);\n\t            });\n\t\n\t            // if( !this.workingElements.length ){\n\t            //     this._renderNoValidElements();\n\t            //     return;\n\t            // }\n\t\n\t            creator.workingElements.forEach(function (element) {\n\t                var elementView = creator._createElementView(element);\n\t                $tmp.append(elementView.$el);\n\t            });\n\t\n\t            creator._renderClearSelected();\n\t            $list.empty().append($tmp.children());\n\t            _.invoke(creator.elementViews, 'render');\n\t\n\t            if ($list.height() > $list.css('max-height')) {\n\t                $list.css('border-width', '1px 0px 1px 0px');\n\t            } else {\n\t                $list.css('border-width', '0px');\n\t            }\n\t        },\n\t\n\t        /** create an element view, cache in elementViews, set up listeners, and return */\n\t        _createElementView: function _createElementView(element) {\n\t            var elementView = new this.elementViewClass({\n\t                //TODO: use non-generic class or not all\n\t                // model : COLLECTION.DatasetDCE( element )\n\t                element: element,\n\t                selected: _.has(this.selectedIds, element.id)\n\t            });\n\t            this.elementViews.push(elementView);\n\t            this._listenToElementView(elementView);\n\t            return elementView;\n\t        },\n\t\n\t        /** listen to any element events */\n\t        _listenToElementView: function _listenToElementView(view) {\n\t            var creator = this;\n\t            creator.listenTo(view, {\n\t                select: function select(data) {\n\t                    var element = data.source.element;\n\t                    if (data.selected) {\n\t                        creator.selectedIds[element.id] = true;\n\t                    } else {\n\t                        delete creator.selectedIds[element.id];\n\t                    }\n\t                    creator.trigger('elements:select', data);\n\t                },\n\t                discard: function discard(data) {\n\t                    creator.trigger('elements:discard', data);\n\t                }\n\t            });\n\t        },\n\t\n\t        /** add a new element view based on the json in element */\n\t        addElementView: function addElementView(element) {\n\t            //TODO: workingElements is sorted, add element in appropo index\n\t            // add element, sort elements, find element index\n\t            // var view = this._createElementView( element );\n\t            // return view;\n\t        },\n\t\n\t        /** stop listening to view and remove from caches */\n\t        removeElementView: function removeElementView(view) {\n\t            delete this.selectedIds[view.element.id];\n\t            this._renderClearSelected();\n\t\n\t            this.elementViews = _.without(this.elementViews, view);\n\t            this.stopListening(view);\n\t        },\n\t\n\t        /** render a message in the list that no elements remain to create a collection */\n\t        _renderNoElementsLeft: function _renderNoElementsLeft() {\n\t            this._disableNameAndCreate(true);\n\t            this.$('.collection-elements').append(this.templates.noElementsLeft());\n\t        },\n\t\n\t        // /** render a message in the list that no valid elements were found to create a collection */\n\t        // _renderNoValidElements : function(){\n\t        //     this._disableNameAndCreate( true );\n\t        //     this.$( '.collection-elements' ).append( this.templates.noValidElements() );\n\t        // },\n\t\n\t        // ------------------------------------------------------------------------ API\n\t        /** convert element into JSON compatible with the collections API */\n\t        _elementToJSON: function _elementToJSON(element) {\n\t            // return element.toJSON();\n\t            return element;\n\t        },\n\t\n\t        /** create the collection via the API\n\t         *  @returns {jQuery.xhr Object} the jquery ajax request\n\t         */\n\t        createList: function createList(name) {\n\t            if (!this.workingElements.length) {\n\t                var message = _l('No valid elements for final list') + '. ';\n\t                message += '<a class=\"cancel-create\" href=\"javascript:void(0);\">' + _l('Cancel') + '</a> ';\n\t                message += _l('or');\n\t                message += ' <a class=\"reset\" href=\"javascript:void(0);\">' + _l('start over') + '</a>.';\n\t                this._showAlert(message);\n\t                return;\n\t            }\n\t\n\t            var creator = this,\n\t                elements = this.workingElements.map(function (element) {\n\t                return creator._elementToJSON(element);\n\t            });\n\t\n\t            creator.blocking = true;\n\t            return creator.creationFn(elements, name).always(function () {\n\t                creator.blocking = false;\n\t            }).fail(function (xhr, status, message) {\n\t                creator.trigger('error', {\n\t                    xhr: xhr,\n\t                    status: status,\n\t                    message: _l('An error occurred while creating this collection')\n\t                });\n\t            }).done(function (response, message, xhr) {\n\t                creator.trigger('collection:created', response, message, xhr);\n\t                creator.metric('collection:created', response);\n\t                if (typeof creator.oncreate === 'function') {\n\t                    creator.oncreate.call(this, response, message, xhr);\n\t                }\n\t            });\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ events\n\t        /** set up event handlers on self */\n\t        _setUpBehaviors: function _setUpBehaviors() {\n\t            this.on('error', this._errorHandler);\n\t\n\t            this.once('rendered', function () {\n\t                this.trigger('rendered:initial', this);\n\t            });\n\t\n\t            this.on('elements:select', function (data) {\n\t                this._renderClearSelected();\n\t            });\n\t\n\t            this.on('elements:discard', function (data) {\n\t                var element = data.source.element;\n\t                this.removeElementView(data.source);\n\t\n\t                this.workingElements = _.without(this.workingElements, element);\n\t                if (!this.workingElements.length) {\n\t                    this._renderNoElementsLeft();\n\t                }\n\t            });\n\t\n\t            //this.on( 'all', function(){\n\t            //    this.info( arguments );\n\t            //});\n\t            return this;\n\t        },\n\t\n\t        /** handle errors with feedback and details to the user (if available) */\n\t        _errorHandler: function _errorHandler(data) {\n\t            this.error(data);\n\t\n\t            var creator = this;\n\t            content = data.message || _l('An error occurred');\n\t            if (data.xhr) {\n\t                var xhr = data.xhr,\n\t                    message = data.message;\n\t                if (xhr.readyState === 0 && xhr.status === 0) {\n\t                    content += ': ' + _l('Galaxy could not be reached and may be updating.') + _l(' Try again in a few minutes.');\n\t                } else if (xhr.responseJSON) {\n\t                    content += ':<br /><pre>' + JSON.stringify(xhr.responseJSON) + '</pre>';\n\t                } else {\n\t                    content += ': ' + message;\n\t                }\n\t            }\n\t            creator._showAlert(content, 'alert-danger');\n\t        },\n\t\n\t        events: {\n\t            // header\n\t            'click .more-help': '_clickMoreHelp',\n\t            'click .less-help': '_clickLessHelp',\n\t            'click .main-help': '_toggleHelp',\n\t            'click .header .alert button': '_hideAlert',\n\t\n\t            'click .reset': 'reset',\n\t            'click .clear-selected': 'clearSelectedElements',\n\t\n\t            // elements - selection\n\t            'click .collection-elements': 'clearSelectedElements',\n\t\n\t            // elements - drop target\n\t            // 'dragenter .collection-elements': '_dragenterElements',\n\t            // 'dragleave .collection-elements': '_dragleaveElements',\n\t            'dragover .collection-elements': '_dragoverElements',\n\t            'drop .collection-elements': '_dropElements',\n\t\n\t            // these bubble up from the elements as custom events\n\t            'collection-element.dragstart .collection-elements': '_elementDragstart',\n\t            'collection-element.dragend   .collection-elements': '_elementDragend',\n\t\n\t            // footer\n\t            'change .collection-name': '_changeName',\n\t            'keydown .collection-name': '_nameCheckForEnter',\n\t            'click .cancel-create': function clickCancelCreate(ev) {\n\t                if (typeof this.oncancel === 'function') {\n\t                    this.oncancel.call(this);\n\t                }\n\t            },\n\t            'click .create-collection': '_clickCreate' //,\n\t        },\n\t\n\t        // ........................................................................ header\n\t        /** expand help */\n\t        _clickMoreHelp: function _clickMoreHelp(ev) {\n\t            ev.stopPropagation();\n\t            this.$('.main-help').addClass('expanded');\n\t            this.$('.more-help').hide();\n\t        },\n\t        /** collapse help */\n\t        _clickLessHelp: function _clickLessHelp(ev) {\n\t            ev.stopPropagation();\n\t            this.$('.main-help').removeClass('expanded');\n\t            this.$('.more-help').show();\n\t        },\n\t        /** toggle help */\n\t        _toggleHelp: function _toggleHelp(ev) {\n\t            ev.stopPropagation();\n\t            this.$('.main-help').toggleClass('expanded');\n\t            this.$('.more-help').toggle();\n\t        },\n\t\n\t        /** show an alert on the top of the interface containing message (alertClass is bootstrap's alert-*) */\n\t        _showAlert: function _showAlert(message, alertClass) {\n\t            alertClass = alertClass || 'alert-danger';\n\t            this.$('.main-help').hide();\n\t            this.$('.header .alert').attr('class', 'alert alert-dismissable').addClass(alertClass).show().find('.alert-message').html(message);\n\t        },\n\t        /** hide the alerts at the top */\n\t        _hideAlert: function _hideAlert(message) {\n\t            this.$('.main-help').show();\n\t            this.$('.header .alert').hide();\n\t        },\n\t\n\t        // ........................................................................ elements\n\t        /** reset all data to the initial state */\n\t        reset: function reset() {\n\t            this._instanceSetUp();\n\t            this._elementsSetUp();\n\t            this.render();\n\t        },\n\t\n\t        /** deselect all elements */\n\t        clearSelectedElements: function clearSelectedElements(ev) {\n\t            this.$('.collection-elements .collection-element').removeClass('selected');\n\t            this.$('.collection-elements-controls > .clear-selected').hide();\n\t        },\n\t\n\t        //_dragenterElements : function( ev ){\n\t        //    //this.debug( '_dragenterElements:', ev );\n\t        //},\n\t        //TODO: if selected are dragged out of the list area - remove the placeholder - cuz it won't work anyway\n\t        // _dragleaveElements : function( ev ){\n\t        //    //this.debug( '_dragleaveElements:', ev );\n\t        // },\n\t\n\t        /** track the mouse drag over the list adding a placeholder to show where the drop would occur */\n\t        _dragoverElements: function _dragoverElements(ev) {\n\t            //this.debug( '_dragoverElements:', ev );\n\t            ev.preventDefault();\n\t\n\t            var $list = this.$list();\n\t            this._checkForAutoscroll($list, ev.originalEvent.clientY);\n\t            var $nearest = this._getNearestElement(ev.originalEvent.clientY);\n\t\n\t            //TODO: no need to re-create - move instead\n\t            this.$('.element-drop-placeholder').remove();\n\t            var $placeholder = $('<div class=\"element-drop-placeholder\"></div>');\n\t            if (!$nearest.length) {\n\t                $list.append($placeholder);\n\t            } else {\n\t                $nearest.before($placeholder);\n\t            }\n\t        },\n\t\n\t        /** If the mouse is near enough to the list's top or bottom, scroll the list */\n\t        _checkForAutoscroll: function _checkForAutoscroll($element, y) {\n\t            var AUTOSCROLL_SPEED = 2,\n\t                offset = $element.offset(),\n\t                scrollTop = $element.scrollTop(),\n\t                upperDist = y - offset.top,\n\t                lowerDist = offset.top + $element.outerHeight() - y;\n\t            if (upperDist >= 0 && upperDist < this.autoscrollDist) {\n\t                $element.scrollTop(scrollTop - AUTOSCROLL_SPEED);\n\t            } else if (lowerDist >= 0 && lowerDist < this.autoscrollDist) {\n\t                $element.scrollTop(scrollTop + AUTOSCROLL_SPEED);\n\t            }\n\t        },\n\t\n\t        /** get the nearest element based on the mouse's Y coordinate.\n\t         *  If the y is at the end of the list, return an empty jQuery object.\n\t         */\n\t        _getNearestElement: function _getNearestElement(y) {\n\t            var WIGGLE = 4,\n\t                lis = this.$('.collection-elements li.collection-element').toArray();\n\t            for (var i = 0; i < lis.length; i++) {\n\t                var $li = $(lis[i]),\n\t                    top = $li.offset().top,\n\t                    halfHeight = Math.floor($li.outerHeight() / 2) + WIGGLE;\n\t                if (top + halfHeight > y && top - halfHeight < y) {\n\t                    return $li;\n\t                }\n\t            }\n\t            return $();\n\t        },\n\t\n\t        /** drop (dragged/selected elements) onto the list, re-ordering the internal list */\n\t        _dropElements: function _dropElements(ev) {\n\t            if (ev.originalEvent) {\n\t                ev = ev.originalEvent;\n\t            }\n\t            // both required for firefox\n\t            ev.preventDefault();\n\t            ev.dataTransfer.dropEffect = 'move';\n\t\n\t            // insert before the nearest element or after the last.\n\t            var $nearest = this._getNearestElement(ev.clientY);\n\t            if ($nearest.length) {\n\t                this.$dragging.insertBefore($nearest);\n\t            } else {\n\t                // no nearest before - insert after last element\n\t                this.$dragging.insertAfter(this.$('.collection-elements .collection-element').last());\n\t            }\n\t            // resync the creator's list based on the new DOM order\n\t            this._syncOrderToDom();\n\t            return false;\n\t        },\n\t\n\t        /** resync the creator's list of elements based on the DOM order */\n\t        _syncOrderToDom: function _syncOrderToDom() {\n\t            var creator = this,\n\t                newElements = [];\n\t            //TODO: doesn't seem wise to use the dom to store these - can't we sync another way?\n\t            this.$('.collection-elements .collection-element').each(function () {\n\t                var id = $(this).attr('data-element-id'),\n\t                    element = _.findWhere(creator.workingElements, { id: id });\n\t                if (element) {\n\t                    newElements.push(element);\n\t                } else {\n\t                    console.error('missing element: ', id);\n\t                }\n\t            });\n\t            this.workingElements = newElements;\n\t            this._renderList();\n\t        },\n\t\n\t        /** drag communication with element sub-views: dragstart */\n\t        _elementDragstart: function _elementDragstart(ev, element) {\n\t            // auto select the element causing the event and move all selected\n\t            element.select(true);\n\t            this.$dragging = this.$('.collection-elements .collection-element.selected');\n\t        },\n\t\n\t        /** drag communication with element sub-views: dragend - remove the placeholder */\n\t        _elementDragend: function _elementDragend(ev, element) {\n\t            $('.element-drop-placeholder').remove();\n\t            this.$dragging = null;\n\t        },\n\t\n\t        // ........................................................................ footer\n\t        /** handle a collection name change */\n\t        _changeName: function _changeName(ev) {\n\t            this._validationWarning('name', !!this._getName());\n\t        },\n\t\n\t        /** check for enter key press when in the collection name and submit */\n\t        _nameCheckForEnter: function _nameCheckForEnter(ev) {\n\t            if (ev.keyCode === 13 && !this.blocking) {\n\t                this._clickCreate();\n\t            }\n\t        },\n\t\n\t        /** get the current collection name */\n\t        _getName: function _getName() {\n\t            return _.escape(this.$('.collection-name').val());\n\t        },\n\t\n\t        /** attempt to create the current collection */\n\t        _clickCreate: function _clickCreate(ev) {\n\t            var name = this._getName();\n\t            if (!name) {\n\t                this._validationWarning('name');\n\t            } else if (!this.blocking) {\n\t                this.createList(name);\n\t            }\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ templates\n\t        //TODO: move to require text plugin and load these as text\n\t        //TODO: underscore currently unnecc. bc no vars are used\n\t        //TODO: better way of localizing text-nodes in long strings\n\t        /** underscore template fns attached to class */\n\t        templates: {\n\t            /** the skeleton */\n\t            main: _.template(['<div class=\"header flex-row no-flex\"></div>', '<div class=\"middle flex-row flex-row-container\"></div>', '<div class=\"footer flex-row no-flex\"></div>'].join('')),\n\t\n\t            /** the header (not including help text) */\n\t            header: _.template(['<div class=\"main-help well clear\">', '<a class=\"more-help\" href=\"javascript:void(0);\">', _l('More help'), '</a>', '<div class=\"help-content\">', '<a class=\"less-help\" href=\"javascript:void(0);\">', _l('Less'), '</a>', '</div>', '</div>', '<div class=\"alert alert-dismissable\">', '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" ', 'title=\"', _l('Close and show more help'), '\" aria-hidden=\"true\">&times;</button>', '<span class=\"alert-message\"></span>', '</div>'].join('')),\n\t\n\t            /** the middle: element list */\n\t            middle: _.template(['<div class=\"collection-elements-controls\">', '<a class=\"reset\" href=\"javascript:void(0);\" ', 'title=\"', _l('Undo all reordering and discards'), '\">', _l('Start over'), '</a>', '<a class=\"clear-selected\" href=\"javascript:void(0);\" ', 'title=\"', _l('De-select all selected datasets'), '\">', _l('Clear selected'), '</a>', '</div>', '<div class=\"collection-elements scroll-container flex-row\">', '</div>'].join('')),\n\t\n\t            /** creation and cancel controls */\n\t            footer: _.template(['<div class=\"attributes clear\">', '<div class=\"clear\">', '<input class=\"collection-name form-control pull-right\" ', 'placeholder=\"', _l('Enter a name for your new collection'), '\" />', '<div class=\"collection-name-prompt pull-right\">', _l('Name'), ':</div>', '</div>', '</div>', '<div class=\"actions clear vertically-spaced\">', '<div class=\"other-options pull-left\">', '<button class=\"cancel-create btn\" tabindex=\"-1\">', _l('Cancel'), '</button>', '<div class=\"create-other btn-group dropup\">', '<button class=\"btn btn-default dropdown-toggle\" data-toggle=\"dropdown\">', _l('Create a different kind of collection'), ' <span class=\"caret\"></span>', '</button>', '<ul class=\"dropdown-menu\" role=\"menu\">', '<li><a href=\"#\">', _l('Create a <i>single</i> pair'), '</a></li>', '<li><a href=\"#\">', _l('Create a list of <i>unpaired</i> datasets'), '</a></li>', '</ul>', '</div>', '</div>', '<div class=\"main-options pull-right\">', '<button class=\"create-collection btn btn-primary\">', _l('Create list'), '</button>', '</div>', '</div>'].join('')),\n\t\n\t            /** help content */\n\t            helpContent: _.template(['<p>', _l(['Collections of datasets are permanent, ordered lists of datasets that can be passed to tools and ', 'workflows in order to have analyses done on each member of the entire group. This interface allows ', 'you to create a collection and re-order the final collection.'].join('')), '</p>', '<ul>', '<li>', _l(['Rename elements in the list by clicking on ', '<i data-target=\".collection-element .name\">the existing name</i>.'].join('')), '</li>', '<li>', _l(['Discard elements from the final created list by clicking on the ', '<i data-target=\".collection-element .discard\">\"Discard\"</i> button.'].join('')), '</li>', '<li>', _l(['Reorder the list by clicking and dragging elements. Select multiple elements by clicking on ', '<i data-target=\".collection-element\">them</i> and you can then move those selected by dragging the ', 'entire group. Deselect them by clicking them again or by clicking the ', 'the <i data-target=\".clear-selected\">\"Clear selected\"</i> link.'].join('')), '</li>', '<li>', _l(['Click the <i data-target=\".reset\">\"Start over\"</i> link to begin again as if you had just opened ', 'the interface.'].join('')), '</li>', '<li>', _l(['Click the <i data-target=\".cancel-create\">\"Cancel\"</i> button to exit the interface.'].join('')), '</li>', '</ul><br />', '<p>', _l(['Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ', 'click <i data-target=\".create-collection\">\"Create list\"</i>.'].join('')), '</p>'].join('')),\n\t\n\t            /** shown in list when all elements are discarded */\n\t            invalidElements: _.template([_l('The following selections could not be included due to problems:'), '<ul><% _.each( problems, function( problem ){ %>', '<li><b><%- problem.element.name %></b>: <%- problem.text %></li>', '<% }); %></ul>'].join('')),\n\t\n\t            /** shown in list when all elements are discarded */\n\t            noElementsLeft: _.template(['<li class=\"no-elements-left-message\">', _l('No elements left! '), _l('Would you like to '), '<a class=\"reset\" href=\"javascript:void(0)\">', _l('start over'), '</a>?', '</li>'].join('')),\n\t\n\t            /** a simplified page communicating what went wrong and why the user needs to reselect something else */\n\t            invalidInitial: _.template(['<div class=\"header flex-row no-flex\">', '<div class=\"alert alert-warning\" style=\"display: block\">', '<span class=\"alert-message\">', '<% if( _.size( problems ) ){ %>', _l('The following selections could not be included due to problems'), ':', '<ul><% _.each( problems, function( problem ){ %>', '<li><b><%- problem.element.name %></b>: <%- problem.text %></li>', '<% }); %></ul>', '<% } else if( _.size( elements ) < 1 ){ %>', _l('No datasets were selected'), '.', '<% } %>', '<br />', _l('At least one element is needed for the collection'), '. ', _l('You may need to '), '<a class=\"cancel-create\" href=\"javascript:void(0)\">', _l('cancel'), '</a> ', _l('and reselect new elements'), '.', '</span>', '</div>', '</div>', '<div class=\"footer flex-row no-flex\">', '<div class=\"actions clear vertically-spaced\">', '<div class=\"other-options pull-left\">', '<button class=\"cancel-create btn\" tabindex=\"-1\">', _l('Cancel'), '</button>',\n\t            // _l( 'Create a different kind of collection' ),\n\t            '</div>', '</div>', '</div>'].join(''))\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ misc\n\t        /** string rep */\n\t        toString: function toString() {\n\t            return 'ListCollectionCreator';\n\t        }\n\t    });\n\t\n\t    //=============================================================================\n\t    /** Create a modal and load its body with the given CreatorClass creator type\n\t     *  @returns {Deferred} resolved when creator has built a collection.\n\t     */\n\t    var collectionCreatorModal = function _collectionCreatorModal(elements, options, CreatorClass) {\n\t\n\t        var deferred = jQuery.Deferred(),\n\t            modal = Galaxy.modal || new UI_MODAL.View(),\n\t            creator;\n\t\n\t        options = _.defaults(options || {}, {\n\t            elements: elements,\n\t            oncancel: function oncancel() {\n\t                modal.hide();\n\t                deferred.reject('cancelled');\n\t            },\n\t            oncreate: function oncreate(creator, response) {\n\t                modal.hide();\n\t                deferred.resolve(response);\n\t            }\n\t        });\n\t\n\t        creator = new CreatorClass(options);\n\t        modal.show({\n\t            title: options.title || _l('Create a collection'),\n\t            body: creator.$el,\n\t            width: '80%',\n\t            height: '100%',\n\t            closing_events: true\n\t        });\n\t        creator.render();\n\t        window._collectionCreator = creator;\n\t\n\t        //TODO: remove modal header\n\t        return deferred;\n\t    };\n\t\n\t    /** List collection flavor of collectionCreatorModal. */\n\t    var listCollectionCreatorModal = function _listCollectionCreatorModal(elements, options) {\n\t        options = options || {};\n\t        options.title = _l('Create a collection from a list of datasets');\n\t        return collectionCreatorModal(elements, options, ListCollectionCreator);\n\t    };\n\t\n\t    //==============================================================================\n\t    /** Use a modal to create a list collection, then add it to the given history contents.\n\t     *  @returns {Deferred} resolved when the collection is added to the history.\n\t     */\n\t    function createListCollection(contents) {\n\t        var elements = contents.toJSON(),\n\t            promise = listCollectionCreatorModal(elements, {\n\t            creationFn: function creationFn(elements, name) {\n\t                elements = elements.map(function (element) {\n\t                    return {\n\t                        id: element.id,\n\t                        name: element.name,\n\t                        //TODO: this allows for list:list even if the filter above does not - reconcile\n\t                        src: element.history_content_type === 'dataset' ? 'hda' : 'hdca'\n\t                    };\n\t                });\n\t                return contents.createHDCA(elements, 'list', name);\n\t            }\n\t        });\n\t        return promise;\n\t    }\n\t\n\t    //==============================================================================\n\t    return {\n\t        DatasetCollectionElementView: DatasetCollectionElementView,\n\t        ListCollectionCreator: ListCollectionCreator,\n\t\n\t        collectionCreatorModal: collectionCreatorModal,\n\t        listCollectionCreatorModal: listCollectionCreatorModal,\n\t        createListCollection: createListCollection\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1), __webpack_require__(1)))\n\n/***/ },\n/* 41 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(jQuery, Backbone, $, _) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(51), __webpack_require__(12), __webpack_require__(24), __webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (LIST_ITEM, STATES, faIconButton, BASE_MVC, _l) {\n\t    'use strict';\n\t\n\t    var logNamespace = 'dataset';\n\t    /*==============================================================================\n\t    TODO:\n\t        straighten out state rendering and templates used\n\t        inaccessible/STATES.NOT_VIEWABLE is a special case\n\t        simplify button rendering\n\t    \n\t    ==============================================================================*/\n\t    var _super = LIST_ITEM.ListItemView;\n\t    /** @class Read only list view for either LDDAs, HDAs, or HDADCEs.\n\t     *      Roughly, any DatasetInstance (and not a raw Dataset).\n\t     */\n\t    var DatasetListItemView = _super.extend(\n\t    /** @lends DatasetListItemView.prototype */{\n\t        _logNamespace: logNamespace,\n\t\n\t        className: _super.prototype.className + \" dataset\",\n\t        //TODO:?? doesn't exactly match an hda's type_id\n\t        id: function id() {\n\t            return ['dataset', this.model.get('id')].join('-');\n\t        },\n\t\n\t        /** Set up: instance vars, options, and event handlers */\n\t        initialize: function initialize(attributes) {\n\t            if (attributes.logger) {\n\t                this.logger = this.model.logger = attributes.logger;\n\t            }\n\t            this.log(this + '.initialize:', attributes);\n\t            _super.prototype.initialize.call(this, attributes);\n\t\n\t            /** where should pages from links be displayed? (default to new tab/window) */\n\t            this.linkTarget = attributes.linkTarget || '_blank';\n\t        },\n\t\n\t        /** event listeners */\n\t        _setUpListeners: function _setUpListeners() {\n\t            _super.prototype._setUpListeners.call(this);\n\t\n\t            // re-rendering on any model changes\n\t            this.listenTo(this.model, 'change', function (model, options) {\n\t                // if the model moved into the ready state and is expanded without details, fetch those details now\n\t                if (this.model.changedAttributes().state && this.model.inReadyState() && this.expanded && !this.model.hasDetails()) {\n\t                    // will render automatically (due to fetch -> change)\n\t                    this.model.fetch();\n\t                } else {\n\t                    this.render();\n\t                }\n\t            });\n\t        },\n\t\n\t        // ......................................................................... expandable\n\t        /** In this override, only get details if in the ready state, get rerunnable if in other states.\n\t         *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n\t         */\n\t        _fetchModelDetails: function _fetchModelDetails() {\n\t            var view = this;\n\t            if (view.model.inReadyState() && !view.model.hasDetails()) {\n\t                return view.model.fetch({ silent: true });\n\t            }\n\t            return jQuery.when();\n\t        },\n\t\n\t        // ......................................................................... removal\n\t        /** Remove this view's html from the DOM and remove all event listeners.\n\t         *  @param {Number or String} speed jq effect speed\n\t         *  @param {Function} callback      an optional function called when removal is done (scoped to this view)\n\t         */\n\t        remove: function remove(speed, callback) {\n\t            var view = this;\n\t            speed = speed || this.fxSpeed;\n\t            this.$el.fadeOut(speed, function () {\n\t                Backbone.View.prototype.remove.call(view);\n\t                if (callback) {\n\t                    callback.call(view);\n\t                }\n\t            });\n\t        },\n\t\n\t        // ......................................................................... rendering\n\t        /* TODO:\n\t            dataset states are the issue primarily making dataset rendering complex\n\t                each state should have it's own way of displaying/set of details\n\t                often with different actions that can be applied\n\t            throw in deleted/purged/visible and things get complicated easily\n\t            I've considered (a couple of times) - creating a view for each state\n\t                - but recreating the view during an update...seems wrong\n\t        */\n\t        /** Render this HDA, set up ui.\n\t         *  @param {Number or String} speed jq fx speed\n\t         *  @returns {Object} this\n\t         */\n\t        render: function render(speed) {\n\t            //HACK: hover exit doesn't seem to be called on prev. tooltips when RE-rendering - so: no tooltip hide\n\t            // handle that here by removing previous view's tooltips\n\t            //this.$el.find(\"[title]\").tooltip( \"destroy\" );\n\t            return _super.prototype.render.call(this, speed);\n\t        },\n\t\n\t        /** In this override, add the dataset state as a class for use with state-based CSS */\n\t        _swapNewRender: function _swapNewRender($newRender) {\n\t            _super.prototype._swapNewRender.call(this, $newRender);\n\t            if (this.model.has('state')) {\n\t                this.$el.addClass('state-' + this.model.get('state'));\n\t            }\n\t            return this.$el;\n\t        },\n\t\n\t        // ................................................................................ titlebar\n\t        /** In this override, add the dataset display button. */\n\t        _renderPrimaryActions: function _renderPrimaryActions() {\n\t            // render just the display for read-only\n\t            return [this._renderDisplayButton()];\n\t        },\n\t\n\t        /** Render icon-button to display dataset data */\n\t        _renderDisplayButton: function _renderDisplayButton() {\n\t            //TODO:?? too complex - possibly move into template\n\t            // don't show display if not viewable or not accessible\n\t            var state = this.model.get('state');\n\t            if (state === STATES.NOT_VIEWABLE || state === STATES.DISCARDED || !this.model.get('accessible')) {\n\t                return null;\n\t            }\n\t\n\t            var displayBtnData = {\n\t                target: this.linkTarget,\n\t                classes: 'display-btn'\n\t            };\n\t\n\t            // show a disabled display if the data's been purged\n\t            if (this.model.get('purged')) {\n\t                displayBtnData.disabled = true;\n\t                displayBtnData.title = _l('Cannot display datasets removed from disk');\n\t\n\t                // disable if still uploading\n\t            } else if (state === STATES.UPLOAD) {\n\t                displayBtnData.disabled = true;\n\t                displayBtnData.title = _l('This dataset must finish uploading before it can be viewed');\n\t\n\t                // disable if still new\n\t            } else if (state === STATES.NEW) {\n\t                displayBtnData.disabled = true;\n\t                displayBtnData.title = _l('This dataset is not yet viewable');\n\t            } else {\n\t                displayBtnData.title = _l('View data');\n\t\n\t                // default link for dataset\n\t                displayBtnData.href = this.model.urls.display;\n\t\n\t                // add frame manager option onclick event\n\t                var self = this;\n\t                displayBtnData.onclick = function (ev) {\n\t                    if (Galaxy.frame && Galaxy.frame.active) {\n\t                        // Add dataset to frames.\n\t                        Galaxy.frame.addDataset(self.model.get('id'));\n\t                        ev.preventDefault();\n\t                    }\n\t                };\n\t            }\n\t            displayBtnData.faIcon = 'fa-eye';\n\t            return faIconButton(displayBtnData);\n\t        },\n\t\n\t        // ......................................................................... rendering details\n\t        /** Render the enclosing div of the hda body and, if expanded, the html in the body\n\t         *  @returns {jQuery} rendered DOM\n\t         */\n\t        _renderDetails: function _renderDetails() {\n\t            //TODO: generalize to be allow different details for each state\n\t\n\t            // no access - render nothing but a message\n\t            if (this.model.get('state') === STATES.NOT_VIEWABLE) {\n\t                return $(this.templates.noAccess(this.model.toJSON(), this));\n\t            }\n\t\n\t            var $details = _super.prototype._renderDetails.call(this);\n\t            $details.find('.actions .left').empty().append(this._renderSecondaryActions());\n\t            $details.find('.summary').html(this._renderSummary()).prepend(this._renderDetailMessages());\n\t            $details.find('.display-applications').html(this._renderDisplayApplications());\n\t\n\t            //TODO: double tap\n\t            this._setUpBehaviors($details);\n\t            return $details;\n\t        },\n\t\n\t        /** Defer to the appropo summary rendering fn based on state */\n\t        _renderSummary: function _renderSummary() {\n\t            var json = this.model.toJSON(),\n\t                summaryRenderFn = this.templates.summaries[json.state];\n\t            summaryRenderFn = summaryRenderFn || this.templates.summaries.unknown;\n\t            return summaryRenderFn(json, this);\n\t        },\n\t\n\t        /** Render messages to be displayed only when the details are shown */\n\t        _renderDetailMessages: function _renderDetailMessages() {\n\t            var view = this,\n\t                $warnings = $('<div class=\"detail-messages\"></div>'),\n\t                json = view.model.toJSON();\n\t            //TODO:! unordered (map)\n\t            _.each(view.templates.detailMessages, function (templateFn) {\n\t                $warnings.append($(templateFn(json, view)));\n\t            });\n\t            return $warnings;\n\t        },\n\t\n\t        /** Render the external display application links */\n\t        _renderDisplayApplications: function _renderDisplayApplications() {\n\t            if (this.model.isDeletedOrPurged()) {\n\t                return '';\n\t            }\n\t            // render both old and new display apps using the same template\n\t            return [this.templates.displayApplications(this.model.get('display_apps'), this), this.templates.displayApplications(this.model.get('display_types'), this)].join('');\n\t        },\n\t\n\t        // ......................................................................... secondary/details actions\n\t        /** A series of links/buttons for less commonly used actions: re-run, info, etc. */\n\t        _renderSecondaryActions: function _renderSecondaryActions() {\n\t            this.debug('_renderSecondaryActions');\n\t            switch (this.model.get('state')) {\n\t                case STATES.NOT_VIEWABLE:\n\t                    return [];\n\t                case STATES.OK:\n\t                case STATES.FAILED_METADATA:\n\t                case STATES.ERROR:\n\t                    return [this._renderDownloadButton(), this._renderShowParamsButton()];\n\t            }\n\t            return [this._renderShowParamsButton()];\n\t        },\n\t\n\t        /** Render icon-button to show the input and output (stdout/err) for the job that created this.\n\t         *  @returns {jQuery} rendered DOM\n\t         */\n\t        _renderShowParamsButton: function _renderShowParamsButton() {\n\t            // gen. safe to show in all cases\n\t            return faIconButton({\n\t                title: _l('View details'),\n\t                classes: 'params-btn',\n\t                href: this.model.urls.show_params,\n\t                target: this.linkTarget,\n\t                faIcon: 'fa-info-circle'\n\t            });\n\t        },\n\t\n\t        /** Render icon-button/popupmenu to download the data (and/or the associated meta files (bai, etc.)) for this.\n\t         *  @returns {jQuery} rendered DOM\n\t         */\n\t        _renderDownloadButton: function _renderDownloadButton() {\n\t            //TODO: to (its own) template fn\n\t            // don't show anything if the data's been purged\n\t            if (this.model.get('purged') || !this.model.hasData()) {\n\t                return null;\n\t            }\n\t\n\t            // return either: a popupmenu with links to download assoc. meta files (if there are meta files)\n\t            //  or a single download icon-button (if there are no meta files)\n\t            if (!_.isEmpty(this.model.get('meta_files'))) {\n\t                return this._renderMetaFileDownloadButton();\n\t            }\n\t\n\t            return $(['<a class=\"download-btn icon-btn\" href=\"', this.model.urls.download, '\" title=\"' + _l('Download') + '\" download>', '<span class=\"fa fa-floppy-o\"></span>', '</a>'].join(''));\n\t        },\n\t\n\t        /** Render the download button which opens a dropdown with links to download assoc. meta files (indeces, etc.) */\n\t        _renderMetaFileDownloadButton: function _renderMetaFileDownloadButton() {\n\t            var urls = this.model.urls;\n\t            return $(['<div class=\"metafile-dropdown dropdown\">', '<a class=\"download-btn icon-btn\" href=\"javascript:void(0)\" data-toggle=\"dropdown\"', ' title=\"' + _l('Download') + '\">', '<span class=\"fa fa-floppy-o\"></span>', '</a>', '<ul class=\"dropdown-menu\" role=\"menu\" aria-labelledby=\"dLabel\">', '<li><a href=\"' + urls.download + '\" download>', _l('Download dataset'), '</a></li>', _.map(this.model.get('meta_files'), function (meta_file) {\n\t                return ['<li><a href=\"', urls.meta_download + meta_file.file_type, '\">', _l('Download'), ' ', meta_file.file_type, '</a></li>'].join('');\n\t            }).join('\\n'), '</ul>', '</div>'].join('\\n'));\n\t        },\n\t\n\t        // ......................................................................... misc\n\t        events: _.extend(_.clone(_super.prototype.events), {\n\t            'click .display-btn': function clickDisplayBtn(ev) {\n\t                this.trigger('display', this, ev);\n\t            },\n\t            'click .params-btn': function clickParamsBtn(ev) {\n\t                this.trigger('params', this, ev);\n\t            },\n\t            'click .download-btn': function clickDownloadBtn(ev) {\n\t                this.trigger('download', this, ev);\n\t            }\n\t        }),\n\t\n\t        // ......................................................................... misc\n\t        /** String representation */\n\t        toString: function toString() {\n\t            var modelString = this.model ? this.model + '' : '(no model)';\n\t            return 'DatasetListItemView(' + modelString + ')';\n\t        }\n\t    });\n\t\n\t    // ............................................................................ TEMPLATES\n\t    /** underscore templates */\n\t    DatasetListItemView.prototype.templates = function () {\n\t        //TODO: move to require text! plugin\n\t\n\t        var warnings = _.extend({}, _super.prototype.templates.warnings, {\n\t            failed_metadata: BASE_MVC.wrapTemplate([\n\t            // failed metadata is rendered as a warning on an otherwise ok dataset view\n\t            '<% if( model.state === \"failed_metadata\" ){ %>', '<div class=\"warningmessagesmall\">', _l('An error occurred setting the metadata for this dataset'), '</div>', '<% } %>']),\n\t            error: BASE_MVC.wrapTemplate([\n\t            // error during index fetch - show error on dataset\n\t            '<% if( model.error ){ %>', '<div class=\"errormessagesmall\">', _l('There was an error getting the data for this dataset'), ': <%- model.error %>', '</div>', '<% } %>']),\n\t            purged: BASE_MVC.wrapTemplate(['<% if( model.purged ){ %>', '<div class=\"purged-msg warningmessagesmall\">', _l('This dataset has been deleted and removed from disk'), '</div>', '<% } %>']),\n\t            deleted: BASE_MVC.wrapTemplate([\n\t            // deleted not purged\n\t            '<% if( model.deleted && !model.purged ){ %>', '<div class=\"deleted-msg warningmessagesmall\">', _l('This dataset has been deleted'), '</div>', '<% } %>'])\n\t\n\t            //NOTE: hidden warning is only needed for HDAs\n\t        });\n\t\n\t        var detailsTemplate = BASE_MVC.wrapTemplate(['<div class=\"details\">', '<div class=\"summary\"></div>', '<div class=\"actions clear\">', '<div class=\"left\"></div>', '<div class=\"right\"></div>', '</div>',\n\t\n\t        // do not display tags, annotation, display apps, or peek when deleted\n\t        '<% if( !dataset.deleted && !dataset.purged ){ %>', '<div class=\"tags-display\"></div>', '<div class=\"annotation-display\"></div>', '<div class=\"display-applications\"></div>', '<% if( dataset.peek ){ %>', '<pre class=\"dataset-peek\"><%= dataset.peek %></pre>', '<% } %>', '<% } %>', '</div>'], 'dataset');\n\t\n\t        var noAccessTemplate = BASE_MVC.wrapTemplate(['<div class=\"details\">', '<div class=\"summary\">', _l('You do not have permission to view this dataset'), '</div>', '</div>'], 'dataset');\n\t\n\t        //TODO: still toooooooooooooo complex - rework\n\t        var summaryTemplates = {};\n\t        summaryTemplates[STATES.OK] = summaryTemplates[STATES.FAILED_METADATA] = BASE_MVC.wrapTemplate(['<% if( dataset.misc_blurb ){ %>', '<div class=\"blurb\">', '<span class=\"value\"><%- dataset.misc_blurb %></span>', '</div>', '<% } %>', '<% if( dataset.file_ext ){ %>', '<div class=\"datatype\">', '<label class=\"prompt\">', _l('format'), '</label>', '<span class=\"value\"><%- dataset.file_ext %></span>', '</div>', '<% } %>', '<% if( dataset.metadata_dbkey ){ %>', '<div class=\"dbkey\">', '<label class=\"prompt\">', _l('database'), '</label>', '<span class=\"value\">', '<%- dataset.metadata_dbkey %>', '</span>', '</div>', '<% } %>', '<% if( dataset.misc_info ){ %>', '<div class=\"info\">', '<span class=\"value\"><%- dataset.misc_info %></span>', '</div>', '<% } %>'], 'dataset');\n\t        summaryTemplates[STATES.NEW] = BASE_MVC.wrapTemplate(['<div>', _l('This is a new dataset and not all of its data are available yet'), '</div>'], 'dataset');\n\t        summaryTemplates[STATES.NOT_VIEWABLE] = BASE_MVC.wrapTemplate(['<div>', _l('You do not have permission to view this dataset'), '</div>'], 'dataset');\n\t        summaryTemplates[STATES.DISCARDED] = BASE_MVC.wrapTemplate(['<div>', _l('The job creating this dataset was cancelled before completion'), '</div>'], 'dataset');\n\t        summaryTemplates[STATES.QUEUED] = BASE_MVC.wrapTemplate(['<div>', _l('This job is waiting to run'), '</div>'], 'dataset');\n\t        summaryTemplates[STATES.RUNNING] = BASE_MVC.wrapTemplate(['<div>', _l('This job is currently running'), '</div>'], 'dataset');\n\t        summaryTemplates[STATES.UPLOAD] = BASE_MVC.wrapTemplate(['<div>', _l('This dataset is currently uploading'), '</div>'], 'dataset');\n\t        summaryTemplates[STATES.SETTING_METADATA] = BASE_MVC.wrapTemplate(['<div>', _l('Metadata is being auto-detected'), '</div>'], 'dataset');\n\t        summaryTemplates[STATES.PAUSED] = BASE_MVC.wrapTemplate(['<div>', _l('This job is paused. Use the \"Resume Paused Jobs\" in the history menu to resume'), '</div>'], 'dataset');\n\t        summaryTemplates[STATES.ERROR] = BASE_MVC.wrapTemplate(['<% if( !dataset.purged ){ %>', '<div><%- dataset.misc_blurb %></div>', '<% } %>', '<span class=\"help-text\">', _l('An error occurred with this dataset'), ':</span>', '<div class=\"job-error-text\"><%- dataset.misc_info %></div>'], 'dataset');\n\t        summaryTemplates[STATES.EMPTY] = BASE_MVC.wrapTemplate(['<div>', _l('No data'), ': <i><%- dataset.misc_blurb %></i></div>'], 'dataset');\n\t        summaryTemplates.unknown = BASE_MVC.wrapTemplate(['<div>Error: unknown dataset state: \"<%- dataset.state %>\"</div>'], 'dataset');\n\t\n\t        // messages to be displayed only within the details section ('below the fold')\n\t        var detailMessageTemplates = {\n\t            resubmitted: BASE_MVC.wrapTemplate([\n\t            // deleted not purged\n\t            '<% if( model.resubmitted ){ %>', '<div class=\"resubmitted-msg infomessagesmall\">', _l('The job creating this dataset has been resubmitted'), '</div>', '<% } %>'])\n\t        };\n\t\n\t        // this is applied to both old and new style display apps\n\t        var displayApplicationsTemplate = BASE_MVC.wrapTemplate(['<% _.each( apps, function( app ){ %>', '<div class=\"display-application\">', '<span class=\"display-application-location\"><%- app.label %></span> ', '<span class=\"display-application-links\">', '<% _.each( app.links, function( link ){ %>', '<a target=\"<%- link.target %>\" href=\"<%- link.href %>\">', '<% print( _l( link.text ) ); %>', '</a> ', '<% }); %>', '</span>', '</div>', '<% }); %>'], 'apps');\n\t\n\t        return _.extend({}, _super.prototype.templates, {\n\t            warnings: warnings,\n\t            details: detailsTemplate,\n\t            noAccess: noAccessTemplate,\n\t            summaries: summaryTemplates,\n\t            detailMessages: detailMessageTemplates,\n\t            displayApplications: displayApplicationsTemplate\n\t        });\n\t    }();\n\t\n\t    // ============================================================================\n\t    return {\n\t        DatasetListItemView: DatasetListItemView\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1), __webpack_require__(3), __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n/* 42 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {'use strict';\n\t\n\t/*\n\t    This class maps the form dom to an api compatible javascript dictionary.\n\t*/\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils) {\n\t    var Manager = Backbone.Model.extend({\n\t        initialize: function initialize(app) {\n\t            this.app = app;\n\t        },\n\t\n\t        /** Creates a checksum.\n\t        */\n\t        checksum: function checksum() {\n\t            var sum = '';\n\t            var self = this;\n\t            this.app.section.$el.find('.section-row').each(function () {\n\t                var id = $(this).attr('id');\n\t                var field = self.app.field_list[id];\n\t                if (field) {\n\t                    sum += id + ':' + JSON.stringify(field.value && field.value()) + ':' + field.collapsed + ';';\n\t                }\n\t            });\n\t            return sum;\n\t        },\n\t\n\t        /** Convert dom into a dictionary of flat id/value pairs used e.g. on job submission.\n\t        */\n\t        create: function create() {\n\t            var self = this;\n\t\n\t            // get raw dictionary from dom\n\t            var dict = {};\n\t            this._iterate(this.app.section.$el, dict);\n\t\n\t            // add to result dictionary, label elements\n\t            var result_dict = {};\n\t            this.flat_dict = {};\n\t            function add(flat_id, input_id, input_value) {\n\t                self.flat_dict[flat_id] = input_id;\n\t                result_dict[flat_id] = input_value;\n\t                self.app.element_list[input_id] && self.app.element_list[input_id].$el.attr('tour_id', flat_id);\n\t            }\n\t            // converter between raw dictionary and job dictionary\n\t            function convert(identifier, head) {\n\t                for (var index in head) {\n\t                    var node = head[index];\n\t                    if (node.input) {\n\t                        var input = node.input;\n\t                        var flat_id = identifier;\n\t                        if (identifier != '') {\n\t                            flat_id += '|';\n\t                        }\n\t                        flat_id += input.name;\n\t                        switch (input.type) {\n\t                            case 'repeat':\n\t                                var section_label = 'section-';\n\t                                var block_indices = [];\n\t                                var block_prefix = null;\n\t                                for (var block_label in node) {\n\t                                    var pos = block_label.indexOf(section_label);\n\t                                    if (pos != -1) {\n\t                                        pos += section_label.length;\n\t                                        block_indices.push(parseInt(block_label.substr(pos)));\n\t                                        if (!block_prefix) {\n\t                                            block_prefix = block_label.substr(0, pos);\n\t                                        }\n\t                                    }\n\t                                }\n\t                                block_indices.sort(function (a, b) {\n\t                                    return a - b;\n\t                                });\n\t                                var index = 0;\n\t                                for (var i in block_indices) {\n\t                                    convert(flat_id + '_' + index++, node[block_prefix + block_indices[i]]);\n\t                                }\n\t                                break;\n\t                            case 'conditional':\n\t                                var value = self.app.field_list[input.id].value();\n\t                                add(flat_id + '|' + input.test_param.name, input.id, value);\n\t                                var selectedCase = _matchCase(input, value);\n\t                                if (selectedCase != -1) {\n\t                                    convert(flat_id, head[input.id + '-section-' + selectedCase]);\n\t                                }\n\t                                break;\n\t                            case 'section':\n\t                                convert(!input.flat && flat_id || '', node);\n\t                                break;\n\t                            default:\n\t                                var field = self.app.field_list[input.id];\n\t                                if (field && field.value) {\n\t                                    var value = field.value();\n\t                                    if (input.ignore === undefined || input.ignore != value) {\n\t                                        if (field.collapsed && input.collapsible_value) {\n\t                                            value = input.collapsible_value;\n\t                                        }\n\t                                        add(flat_id, input.id, value);\n\t                                        if (input.payload) {\n\t                                            for (var p_id in input.payload) {\n\t                                                add(p_id, input.id, input.payload[p_id]);\n\t                                            }\n\t                                        }\n\t                                    }\n\t                                }\n\t                        }\n\t                    }\n\t                }\n\t            }\n\t            convert('', dict);\n\t            return result_dict;\n\t        },\n\t\n\t        /** Matches flat ids to corresponding input element\n\t         * @param{string} flat_id - Flat input id to be looked up.\n\t         */\n\t        match: function match(flat_id) {\n\t            return this.flat_dict && this.flat_dict[flat_id];\n\t        },\n\t\n\t        /** Match conditional values to selected cases\n\t        */\n\t        matchCase: function matchCase(input, value) {\n\t            return _matchCase(input, value);\n\t        },\n\t\n\t        /** Matches a new tool model to the current input elements e.g. used to update dynamic options\n\t        */\n\t        matchModel: function matchModel(model, callback) {\n\t            var self = this;\n\t            visitInputs(model.inputs, function (input, name) {\n\t                self.flat_dict[name] && callback(input, self.flat_dict[name]);\n\t            });\n\t        },\n\t\n\t        /** Matches identifier from api response to input elements e.g. used to display validation errors\n\t        */\n\t        matchResponse: function matchResponse(response) {\n\t            var result = {};\n\t            var self = this;\n\t            function search(id, head) {\n\t                if (typeof head === 'string') {\n\t                    var input_id = self.flat_dict[id];\n\t                    input_id && (result[input_id] = head);\n\t                } else {\n\t                    for (var i in head) {\n\t                        var new_id = i;\n\t                        if (id !== '') {\n\t                            var separator = '|';\n\t                            if (head instanceof Array) {\n\t                                separator = '_';\n\t                            }\n\t                            new_id = id + separator + new_id;\n\t                        }\n\t                        search(new_id, head[i]);\n\t                    }\n\t                }\n\t            }\n\t            search('', response);\n\t            return result;\n\t        },\n\t\n\t        /** Map dom tree to dictionary tree with input elements.\n\t        */\n\t        _iterate: function _iterate(parent, dict) {\n\t            var self = this;\n\t            var children = $(parent).children();\n\t            children.each(function () {\n\t                var child = this;\n\t                var id = $(child).attr('id');\n\t                if ($(child).hasClass('section-row')) {\n\t                    var input = self.app.input_list[id];\n\t                    dict[id] = input && { input: input } || {};\n\t                    self._iterate(child, dict[id]);\n\t                } else {\n\t                    self._iterate(child, dict);\n\t                }\n\t            });\n\t        }\n\t    });\n\t\n\t    /** Match conditional values to selected cases\n\t     * @param{dict}   input     - Definition of conditional input parameter\n\t     * @param{dict}   value     - Current value\n\t     */\n\t    var _matchCase = function _matchCase(input, value) {\n\t        if (input.test_param.type == 'boolean') {\n\t            if (value == 'true') {\n\t                value = input.test_param.truevalue || 'true';\n\t            } else {\n\t                value = input.test_param.falsevalue || 'false';\n\t            }\n\t        }\n\t        for (var i in input.cases) {\n\t            if (input.cases[i].value == value) {\n\t                return i;\n\t            }\n\t        }\n\t        return -1;\n\t    };\n\t\n\t    /** Visits tool inputs\n\t     * @param{dict}   inputs    - Nested dictionary of input elements\n\t     * @param{dict}   callback  - Called with the mapped dictionary object and corresponding model node\n\t     */\n\t    var visitInputs = function visitInputs(inputs, callback, prefix, context) {\n\t        context = $.extend(true, {}, context);\n\t        _.each(inputs, function (input) {\n\t            if (input && input.type && input.name) {\n\t                context[input.name] = input;\n\t            }\n\t        });\n\t        for (var i in inputs) {\n\t            var node = inputs[i];\n\t            var name = prefix ? prefix + '|' + node.name : node.name;\n\t            switch (node.type) {\n\t                case 'repeat':\n\t                    _.each(node.cache, function (cache, j) {\n\t                        visitInputs(cache, callback, name + '_' + j, context);\n\t                    });\n\t                    break;\n\t                case 'conditional':\n\t                    if (node.test_param) {\n\t                        callback(node.test_param, name + '|' + node.test_param.name, context);\n\t                        var selectedCase = _matchCase(node, node.test_param.value);\n\t                        if (selectedCase != -1) {\n\t                            visitInputs(node.cases[selectedCase].inputs, callback, name, context);\n\t                        } else {\n\t                            Galaxy.emit.debug('form-data::visitInputs() - Invalid case for ' + name + '.');\n\t                        }\n\t                    } else {\n\t                        Galaxy.emit.debug('form-data::visitInputs() - Conditional test parameter missing for ' + name + '.');\n\t                    }\n\t                    break;\n\t                case 'section':\n\t                    visitInputs(node.inputs, callback, name, context);\n\t                    break;\n\t                default:\n\t                    callback(node, name, context);\n\t            }\n\t        }\n\t    };\n\t\n\t    return {\n\t        Manager: Manager,\n\t        visitInputs: visitInputs\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n/* 43 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {'use strict';\n\t\n\t/**\n\t    This class creates a form input element wrapper\n\t*/\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t    return Backbone.View.extend({\n\t        initialize: function initialize(app, options) {\n\t            this.app = app;\n\t            this.app_options = app.options || {};\n\t            this.field = options && options.field || new Backbone.View();\n\t            this.model = options && options.model || new Backbone.Model({\n\t                text_enable: this.app_options.text_enable || 'Enable',\n\t                text_disable: this.app_options.text_disable || 'Disable',\n\t                cls_enable: this.app_options.cls_enable || 'fa fa-caret-square-o-down',\n\t                cls_disable: this.app_options.cls_disable || 'fa fa-caret-square-o-up'\n\t            }).set(options);\n\t\n\t            // set element and link components\n\t            this.setElement(this._template());\n\t            this.$field = this.$('.ui-form-field');\n\t            this.$info = this.$('.ui-form-info');\n\t            this.$preview = this.$('.ui-form-preview');\n\t            this.$collapsible = this.$('.ui-form-collapsible');\n\t            this.$collapsible_text = this.$('.ui-form-collapsible-text');\n\t            this.$collapsible_icon = this.$('.ui-form-collapsible-icon');\n\t            this.$title = this.$('.ui-form-title');\n\t            this.$title_text = this.$('.ui-form-title-text');\n\t            this.$error_text = this.$('.ui-form-error-text');\n\t            this.$error = this.$('.ui-form-error');\n\t            this.$backdrop = this.$('.ui-form-backdrop');\n\t\n\t            // add field element\n\t            this.$field.prepend(this.field.$el);\n\t\n\t            // decide wether to expand or collapse fields\n\t            var collapsible_value = this.model.get('collapsible_value');\n\t            this.field.collapsed = collapsible_value !== undefined && JSON.stringify(this.model.get('value')) == JSON.stringify(collapsible_value);\n\t            this.listenTo(this.model, 'change', this.render, this);\n\t            this.render();\n\t\n\t            // add click handler\n\t            var self = this;\n\t            this.$collapsible.on('click', function () {\n\t                self.field.collapsed = !self.field.collapsed;\n\t                app.trigger && app.trigger('change');\n\t                self.render();\n\t            });\n\t        },\n\t\n\t        /** Set backdrop for input element\n\t        */\n\t        backdrop: function backdrop() {\n\t            this.model.set('backdrop', true);\n\t        },\n\t\n\t        /** Set error text\n\t        */\n\t        error: function error(text) {\n\t            this.model.set('error_text', text);\n\t        },\n\t\n\t        /** Reset this view\n\t        */\n\t        reset: function reset() {\n\t            this.model.set('error_text', null);\n\t        },\n\t\n\t        render: function render() {\n\t            // render help\n\t            $('.tooltip').hide();\n\t            var help_text = this.model.get('help', '');\n\t            var help_argument = this.model.get('argument');\n\t            if (help_argument && help_text.indexOf('(' + help_argument + ')') == -1) {\n\t                help_text += ' (' + help_argument + ')';\n\t            }\n\t            this.$info.html(help_text);\n\t            // render preview view for collapsed fields\n\t            this.$preview[this.field.collapsed && this.model.get('collapsible_preview') || this.model.get('disabled') ? 'show' : 'hide']().html(_.escape(this.model.get('text_value')));\n\t            // render error messages\n\t            var error_text = this.model.get('error_text');\n\t            this.$error[error_text ? 'show' : 'hide']();\n\t            this.$el[error_text ? 'addClass' : 'removeClass']('ui-error');\n\t            this.$error_text.html(error_text);\n\t            // render backdrop\n\t            this.$backdrop[this.model.get('backdrop') ? 'show' : 'hide']();\n\t            // render input field\n\t            this.field.collapsed || this.model.get('disabled') ? this.$field.hide() : this.$field.fadeIn('fast');\n\t            // render input field color and style\n\t            this.field.model && this.field.model.set({ 'color': this.model.get('color'), 'style': this.model.get('style') });\n\t            // render collapsible options\n\t            if (!this.model.get('disabled') && this.model.get('collapsible_value') !== undefined) {\n\t                var collapsible_state = this.field.collapsed ? 'enable' : 'disable';\n\t                this.$title_text.hide();\n\t                this.$collapsible.show();\n\t                this.$collapsible_text.text(this.model.get('label'));\n\t                this.$collapsible_icon.removeClass().addClass('icon').addClass(this.model.get('cls_' + collapsible_state)).attr('data-original-title', this.model.get('text_' + collapsible_state)).tooltip({ placement: 'bottom' });\n\t            } else {\n\t                this.$title_text.show().text(this.model.get('label'));\n\t                this.$collapsible.hide();\n\t            }\n\t        },\n\t\n\t        _template: function _template() {\n\t            return $('<div/>').addClass('ui-form-element').append($('<div/>').addClass('ui-form-error ui-error').append($('<span/>').addClass('fa fa-arrow-down')).append($('<span/>').addClass('ui-form-error-text'))).append($('<div/>').addClass('ui-form-title').append($('<div/>').addClass('ui-form-collapsible').append($('<i/>').addClass('ui-form-collapsible-icon')).append($('<span/>').addClass('ui-form-collapsible-text'))).append($('<span/>').addClass('ui-form-title-text'))).append($('<div/>').addClass('ui-form-field').append($('<span/>').addClass('ui-form-info')).append($('<div/>').addClass('ui-form-backdrop'))).append($('<div/>').addClass('ui-form-preview'));\n\t        }\n\t    });\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n/* 44 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {'use strict';\n\t\n\t/**\n\t    This class creates input elements. New input parameter types should be added to the types dictionary.\n\t*/\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(7), __webpack_require__(57), __webpack_require__(59), __webpack_require__(58), __webpack_require__(55)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, Ui, SelectContent, SelectLibrary, SelectFtp, ColorPicker) {\n\t\n\t    // create form view\n\t    return Backbone.Model.extend({\n\t        /** Available parameter types */\n\t        types: {\n\t            'text': '_fieldText',\n\t            'select': '_fieldSelect',\n\t            'data_column': '_fieldSelect',\n\t            'genomebuild': '_fieldSelect',\n\t            'data': '_fieldData',\n\t            'data_collection': '_fieldData',\n\t            'integer': '_fieldSlider',\n\t            'float': '_fieldSlider',\n\t            'boolean': '_fieldBoolean',\n\t            'drill_down': '_fieldDrilldown',\n\t            'color': '_fieldColor',\n\t            'hidden': '_fieldHidden',\n\t            'hidden_data': '_fieldHidden',\n\t            'baseurl': '_fieldHidden',\n\t            'library_data': '_fieldLibrary',\n\t            'ftpfile': '_fieldFtp'\n\t        },\n\t\n\t        initialize: function initialize(app, options) {\n\t            this.app = app;\n\t        },\n\t\n\t        /** Returns an input field for a given field type\n\t        */\n\t        create: function create(input_def) {\n\t            var fieldClass = this.types[input_def.type];\n\t            var field = typeof this[fieldClass] === 'function' ? this[fieldClass].call(this, input_def) : null;\n\t            if (!field) {\n\t                this.app.incompatible = true;\n\t                field = input_def.options ? this._fieldSelect(input_def) : this._fieldText(input_def);\n\t                Galaxy.emit.debug('form-parameters::_addRow()', 'Auto matched field type (' + input_def.type + ').');\n\t            }\n\t            input_def.value === undefined && (input_def.value = null);\n\t            field.value(input_def.value);\n\t            return field;\n\t        },\n\t\n\t        /** Data input field\n\t        */\n\t        _fieldData: function _fieldData(input_def) {\n\t            var self = this;\n\t            return new SelectContent.View({\n\t                id: 'field-' + input_def.id,\n\t                extensions: input_def.extensions,\n\t                optional: input_def.optional,\n\t                multiple: input_def.multiple,\n\t                type: input_def.type,\n\t                flavor: input_def.flavor,\n\t                data: input_def.options,\n\t                onchange: function onchange() {\n\t                    self.app.trigger('change');\n\t                }\n\t            });\n\t        },\n\t\n\t        /** Select/Checkbox/Radio options field\n\t        */\n\t        _fieldSelect: function _fieldSelect(input_def) {\n\t            // show text field e.g. in workflow editor\n\t            if (input_def.is_workflow) {\n\t                return this._fieldText(input_def);\n\t            }\n\t\n\t            // customize properties\n\t            if (input_def.type == 'data_column') {\n\t                input_def.error_text = 'Missing columns in referenced dataset.';\n\t            }\n\t\n\t            // configure options fields\n\t            var options = [];\n\t            _.each(input_def.options, function (option) {\n\t                options.push({ label: option[0], value: option[1] });\n\t            });\n\t\n\t            // identify display type\n\t            var SelectClass = Ui.Select;\n\t            switch (input_def.display) {\n\t                case 'checkboxes':\n\t                    SelectClass = Ui.Checkbox;\n\t                    break;\n\t                case 'radio':\n\t                    SelectClass = Ui.Radio;\n\t                    break;\n\t            }\n\t\n\t            // create select field\n\t            var self = this;\n\t            return new SelectClass.View({\n\t                id: 'field-' + input_def.id,\n\t                data: options,\n\t                error_text: input_def.error_text || 'No options available',\n\t                multiple: input_def.multiple,\n\t                optional: input_def.optional,\n\t                onchange: function onchange() {\n\t                    self.app.trigger('change');\n\t                }\n\t            });\n\t        },\n\t\n\t        /** Drill down options field\n\t        */\n\t        _fieldDrilldown: function _fieldDrilldown(input_def) {\n\t            // show text field e.g. in workflow editor\n\t            if (input_def.is_workflow) {\n\t                return this._fieldText(input_def);\n\t            }\n\t\n\t            // create drill down field\n\t            var self = this;\n\t            return new Ui.Drilldown.View({\n\t                id: 'field-' + input_def.id,\n\t                data: input_def.options,\n\t                display: input_def.display,\n\t                optional: input_def.optional,\n\t                onchange: function onchange() {\n\t                    self.app.trigger('change');\n\t                }\n\t            });\n\t        },\n\t\n\t        /** Text input field\n\t        */\n\t        _fieldText: function _fieldText(input_def) {\n\t            // field replaces e.g. a select field\n\t            if (input_def.options) {\n\t                input_def.area = input_def.multiple;\n\t                if (Utils.isEmpty(input_def.value)) {\n\t                    input_def.value = null;\n\t                } else {\n\t                    if ($.isArray(input_def.value)) {\n\t                        var str_value = '';\n\t                        for (var i in input_def.value) {\n\t                            str_value += String(input_def.value[i]);\n\t                            if (!input_def.multiple) {\n\t                                break;\n\t                            }\n\t                            str_value += '\\n';\n\t                        }\n\t                        input_def.value = str_value;\n\t                    }\n\t                }\n\t            }\n\t            // create input element\n\t            var self = this;\n\t            return new Ui.Input({\n\t                id: 'field-' + input_def.id,\n\t                area: input_def.area,\n\t                onchange: function onchange(new_value) {\n\t                    input_def.onchange ? input_def.onchange(new_value) : self.app.trigger('change');\n\t                }\n\t            });\n\t        },\n\t\n\t        /** Slider field\n\t        */\n\t        _fieldSlider: function _fieldSlider(input_def) {\n\t            var self = this;\n\t            return new Ui.Slider.View({\n\t                id: 'field-' + input_def.id,\n\t                precise: input_def.type == 'float',\n\t                is_workflow: input_def.is_workflow,\n\t                min: input_def.min,\n\t                max: input_def.max,\n\t                onchange: function onchange() {\n\t                    self.app.trigger('change');\n\t                }\n\t            });\n\t        },\n\t\n\t        /** Hidden field\n\t        */\n\t        _fieldHidden: function _fieldHidden(input_def) {\n\t            return new Ui.Hidden({\n\t                id: 'field-' + input_def.id,\n\t                info: input_def.info\n\t            });\n\t        },\n\t\n\t        /** Boolean field\n\t        */\n\t        _fieldBoolean: function _fieldBoolean(input_def) {\n\t            var self = this;\n\t            return new Ui.RadioButton.View({\n\t                id: 'field-' + input_def.id,\n\t                data: [{ label: 'Yes', value: 'true' }, { label: 'No', value: 'false' }],\n\t                onchange: function onchange() {\n\t                    self.app.trigger('change');\n\t                }\n\t            });\n\t        },\n\t\n\t        /** Color picker field\n\t        */\n\t        _fieldColor: function _fieldColor(input_def) {\n\t            var self = this;\n\t            return new ColorPicker({\n\t                id: 'field-' + input_def.id,\n\t                onchange: function onchange() {\n\t                    self.app.trigger('change');\n\t                }\n\t            });\n\t        },\n\t\n\t        /** Library dataset field\n\t        */\n\t        _fieldLibrary: function _fieldLibrary(input_def) {\n\t            var self = this;\n\t            return new SelectLibrary.View({\n\t                id: 'field-' + input_def.id,\n\t                optional: input_def.optional,\n\t                multiple: input_def.multiple,\n\t                onchange: function onchange() {\n\t                    self.app.trigger('change');\n\t                }\n\t            });\n\t        },\n\t\n\t        /** FTP file field\n\t        */\n\t        _fieldFtp: function _fieldFtp(input_def) {\n\t            var self = this;\n\t            return new SelectFtp.View({\n\t                id: 'field-' + input_def.id,\n\t                optional: input_def.optional,\n\t                multiple: input_def.multiple,\n\t                onchange: function onchange() {\n\t                    self.app.trigger('change');\n\t                }\n\t            });\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 45 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {'use strict';\n\t\n\t// dependencies\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(14), __webpack_require__(9), __webpack_require__(7)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, Table, Portlet, Ui) {\n\t\n\t    /** This class creates a ui component which enables the dynamic creation of portlets\n\t    */\n\t    var View = Backbone.View.extend({\n\t        initialize: function initialize(options) {\n\t            var self = this;\n\t            this.options = Utils.merge(options, {\n\t                title: 'Section',\n\t                empty_text: 'Not available.',\n\t                max: null,\n\t                min: null\n\t            });\n\t            this.setElement('<div/>');\n\t\n\t            // create button\n\t            this.button_new = new Ui.ButtonIcon({\n\t                icon: 'fa-plus',\n\t                title: 'Insert ' + this.options.title_new,\n\t                tooltip: 'Add new ' + this.options.title_new + ' block',\n\t                floating: 'clear',\n\t                onclick: function onclick() {\n\t                    if (options.onnew) {\n\t                        options.onnew();\n\t                    }\n\t                }\n\t            });\n\t\n\t            // create table\n\t            this.table = new Table.View({\n\t                cls: 'ui-table-plain',\n\t                content: ''\n\t            });\n\t            this.$el.append(this.table.$el);\n\t            this.$el.append($('<div/>').append(this.button_new.$el));\n\t\n\t            // reset list\n\t            this.list = {};\n\t            this.n = 0;\n\t        },\n\t\n\t        /** Number of repeat blocks\n\t        */\n\t        size: function size() {\n\t            return this.n;\n\t        },\n\t\n\t        /** Add new repeat block\n\t        */\n\t        add: function add(options) {\n\t            if (!options.id || this.list[options.id]) {\n\t                Galaxy.emit.debug('form-repeat::add()', 'Duplicate repeat block id.');\n\t                return;\n\t            }\n\t            this.n++;\n\t            var button_delete = new Ui.ButtonIcon({\n\t                icon: 'fa-trash-o',\n\t                tooltip: 'Delete this repeat block',\n\t                cls: 'ui-button-icon-plain',\n\t                onclick: function onclick() {\n\t                    if (options.ondel) {\n\t                        options.ondel();\n\t                    }\n\t                }\n\t            });\n\t            var portlet = new Portlet.View({\n\t                id: options.id,\n\t                title: 'placeholder',\n\t                cls: 'ui-portlet-repeat',\n\t                operations: {\n\t                    button_delete: button_delete\n\t                }\n\t            });\n\t            portlet.append(options.$el);\n\t            portlet.$el.addClass('section-row');\n\t            this.list[options.id] = portlet;\n\t            this.table.add(portlet.$el);\n\t            this.table.append('row_' + options.id, true);\n\t            if (this.options.max > 0 && this.n >= this.options.max) {\n\t                this.button_new.disable();\n\t            }\n\t            this._refresh();\n\t        },\n\t\n\t        /** Delete repeat block\n\t        */\n\t        del: function del(id) {\n\t            if (!this.list[id]) {\n\t                Galaxy.emit.debug('form-repeat::del()', 'Invalid repeat block id.');\n\t                return;\n\t            }\n\t            this.n--;\n\t            var table_row = this.table.get('row_' + id);\n\t            table_row.remove();\n\t            delete this.list[id];\n\t            this.button_new.enable();\n\t            this._refresh();\n\t        },\n\t\n\t        /** Hides add/del options\n\t        */\n\t        hideOptions: function hideOptions() {\n\t            this.button_new.$el.hide();\n\t            _.each(this.list, function (portlet) {\n\t                portlet.hideOperation('button_delete');\n\t            });\n\t            if (_.isEmpty(this.list)) {\n\t                this.$el.append($('<div/>').addClass('ui-form-info').html(this.options.empty_text));\n\t            }\n\t        },\n\t\n\t        /** Refresh view\n\t        */\n\t        _refresh: function _refresh() {\n\t            var index = 0;\n\t            for (var id in this.list) {\n\t                var portlet = this.list[id];\n\t                portlet.title(++index + ': ' + this.options.title);\n\t                if (this.n > this.options.min) {\n\t                    portlet.showOperation('button_delete');\n\t                } else {\n\t                    portlet.hideOperation('button_delete');\n\t                }\n\t            }\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n/* 46 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, jQuery, _, $) {'use strict';\n\t\n\t/**\n\t    This class creates a form section and populates it with input elements. It also handles repeat blocks and conditionals by recursively creating new sub sections.\n\t*/\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(14), __webpack_require__(7), __webpack_require__(9), __webpack_require__(45), __webpack_require__(43), __webpack_require__(44)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, Table, Ui, Portlet, Repeat, InputElement, Parameters) {\n\t    var View = Backbone.View.extend({\n\t        initialize: function initialize(app, options) {\n\t            this.app = app;\n\t            this.inputs = options.inputs;\n\t\n\t            // fix table style\n\t            options.cls = 'ui-table-plain';\n\t\n\t            // add table class for tr tag\n\t            // this assist in transforming the form into a json structure\n\t            options.cls_tr = 'section-row';\n\t\n\t            // create/render views\n\t            this.table = new Table.View(options);\n\t            this.parameters = new Parameters(app, options);\n\t            this.setElement(this.table.$el);\n\t            this.render();\n\t        },\n\t\n\t        /** Render section view\n\t        */\n\t        render: function render() {\n\t            this.table.delAll();\n\t            for (var i in this.inputs) {\n\t                this.add(this.inputs[i]);\n\t            }\n\t        },\n\t\n\t        /** Add a new input element\n\t        */\n\t        add: function add(input) {\n\t            var self = this;\n\t            var input_def = jQuery.extend(true, {}, input);\n\t            input_def.id = input.id = Utils.uid();\n\t\n\t            // add to sequential list of inputs\n\t            this.app.input_list[input_def.id] = input_def;\n\t\n\t            // identify field type\n\t            var type = input_def.type;\n\t            switch (type) {\n\t                case 'conditional':\n\t                    this._addConditional(input_def);\n\t                    break;\n\t                case 'repeat':\n\t                    this._addRepeat(input_def);\n\t                    break;\n\t                case 'section':\n\t                    this._addSection(input_def);\n\t                    break;\n\t                default:\n\t                    this._addRow(input_def);\n\t            }\n\t        },\n\t\n\t        /** Add a conditional block\n\t        */\n\t        _addConditional: function _addConditional(input_def) {\n\t            var self = this;\n\t            input_def.test_param.id = input_def.id;\n\t            this.app.options.sustain_conditionals && (input_def.test_param.disabled = true);\n\t            var field = this._addRow(input_def.test_param);\n\t\n\t            // set onchange event for test parameter\n\t            field.model && field.model.set('onchange', function (value) {\n\t                var selectedCase = self.app.data.matchCase(input_def, value);\n\t                for (var i in input_def.cases) {\n\t                    var case_def = input_def.cases[i];\n\t                    var section_id = input_def.id + '-section-' + i;\n\t                    var section_row = self.table.get(section_id);\n\t                    var nonhidden = false;\n\t                    for (var j in case_def.inputs) {\n\t                        if (!case_def.inputs[j].hidden) {\n\t                            nonhidden = true;\n\t                            break;\n\t                        }\n\t                    }\n\t                    if (i == selectedCase && nonhidden) {\n\t                        section_row.fadeIn('fast');\n\t                    } else {\n\t                        section_row.hide();\n\t                    }\n\t                }\n\t                self.app.trigger('change');\n\t            });\n\t\n\t            // add conditional sub sections\n\t            for (var i in input_def.cases) {\n\t                var sub_section_id = input_def.id + '-section-' + i;\n\t                var sub_section = new View(this.app, {\n\t                    inputs: input_def.cases[i].inputs\n\t                });\n\t                sub_section.$el.addClass('ui-table-section');\n\t                this.table.add(sub_section.$el);\n\t                this.table.append(sub_section_id);\n\t            }\n\t\n\t            // trigger refresh on conditional input field after all input elements have been created\n\t            field.trigger('change');\n\t        },\n\t\n\t        /** Add a repeat block\n\t        */\n\t        _addRepeat: function _addRepeat(input_def) {\n\t            var self = this;\n\t            var block_index = 0;\n\t\n\t            // create repeat block element\n\t            var repeat = new Repeat.View({\n\t                title: input_def.title || 'Repeat',\n\t                title_new: input_def.title || '',\n\t                min: input_def.min,\n\t                max: input_def.max,\n\t                onnew: function onnew() {\n\t                    create(input_def.inputs);\n\t                    self.app.trigger('change');\n\t                }\n\t            });\n\t\n\t            // helper function to create new repeat blocks\n\t            function create(inputs) {\n\t                var sub_section_id = input_def.id + '-section-' + block_index++;\n\t                var sub_section = new View(self.app, {\n\t                    inputs: inputs\n\t                });\n\t                repeat.add({\n\t                    id: sub_section_id,\n\t                    $el: sub_section.$el,\n\t                    ondel: function ondel() {\n\t                        repeat.del(sub_section_id);\n\t                        self.app.trigger('change');\n\t                    }\n\t                });\n\t            }\n\t\n\t            //\n\t            // add parsed/minimum number of repeat blocks\n\t            //\n\t            var n_cache = _.size(input_def.cache);\n\t            for (var i = 0; i < Math.max(Math.max(n_cache, input_def.min), input_def.default); i++) {\n\t                create(i < n_cache ? input_def.cache[i] : input_def.inputs);\n\t            }\n\t\n\t            // hide options\n\t            this.app.options.sustain_repeats && repeat.hideOptions();\n\t\n\t            // create input field wrapper\n\t            var input_element = new InputElement(this.app, {\n\t                label: input_def.title || input_def.name,\n\t                help: input_def.help,\n\t                field: repeat\n\t            });\n\t            this.table.add(input_element.$el);\n\t            this.table.append(input_def.id);\n\t        },\n\t\n\t        /** Add a customized section\n\t        */\n\t        _addSection: function _addSection(input_def) {\n\t            var portlet = new Portlet.View({\n\t                title: input_def.title || input_def.name,\n\t                cls: 'ui-portlet-section',\n\t                collapsible: true,\n\t                collapsible_button: true,\n\t                collapsed: !input_def.expanded\n\t            });\n\t            portlet.append(new View(this.app, { inputs: input_def.inputs }).$el);\n\t            portlet.append($('<div/>').addClass('ui-form-info').html(input_def.help));\n\t            this.app.on('expand', function (input_id) {\n\t                portlet.$('#' + input_id).length > 0 && portlet.expand();\n\t            });\n\t            this.table.add(portlet.$el);\n\t            this.table.append(input_def.id);\n\t        },\n\t\n\t        /** Add a single input field element\n\t        */\n\t        _addRow: function _addRow(input_def) {\n\t            var id = input_def.id;\n\t            var field = this.parameters.create(input_def);\n\t            this.app.field_list[id] = field;\n\t            var input_element = new InputElement(this.app, {\n\t                name: input_def.name,\n\t                label: input_def.label || input_def.name,\n\t                value: input_def.value,\n\t                text_value: input_def.text_value,\n\t                collapsible_value: input_def.collapsible_value,\n\t                collapsible_preview: input_def.collapsible_preview,\n\t                help: input_def.help,\n\t                argument: input_def.argument,\n\t                disabled: input_def.disabled,\n\t                color: input_def.color,\n\t                style: input_def.style,\n\t                backdrop: input_def.backdrop,\n\t                field: field\n\t            });\n\t            this.app.element_list[id] = input_element;\n\t            this.table.add(input_element.$el);\n\t            this.table.append(id);\n\t            input_def.hidden && this.table.get(id).hide();\n\t            return field;\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 47 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {'use strict';\n\t\n\t/**\n\t    This is the main class of the form plugin. It is referenced as 'app' in all lower level modules.\n\t*/\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(9), __webpack_require__(7), __webpack_require__(46), __webpack_require__(42)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, Portlet, Ui, FormSection, FormData) {\n\t    return Backbone.View.extend({\n\t        initialize: function initialize(options) {\n\t            this.options = Utils.merge(options, {\n\t                initial_errors: false,\n\t                cls: 'ui-portlet-limited',\n\t                icon: null\n\t            });\n\t            this.setElement('<div/>');\n\t            this.render();\n\t        },\n\t\n\t        /** Update available options */\n\t        update: function update(new_model) {\n\t            var self = this;\n\t            this.data.matchModel(new_model, function (node, input_id) {\n\t                var input = self.input_list[input_id];\n\t                if (input && input.options) {\n\t                    if (!_.isEqual(input.options, node.options)) {\n\t                        // backup new options\n\t                        input.options = node.options;\n\t\n\t                        // get/update field\n\t                        var field = self.field_list[input_id];\n\t                        if (field.update) {\n\t                            var new_options = [];\n\t                            if (['data', 'data_collection', 'drill_down'].indexOf(input.type) != -1) {\n\t                                new_options = input.options;\n\t                            } else {\n\t                                for (var i in node.options) {\n\t                                    var opt = node.options[i];\n\t                                    if (opt.length > 2) {\n\t                                        new_options.push({\n\t                                            'label': opt[0],\n\t                                            'value': opt[1]\n\t                                        });\n\t                                    }\n\t                                }\n\t                            }\n\t                            field.update(new_options);\n\t                            field.trigger('change');\n\t                            Galaxy.emit.debug('form-view::update()', 'Updating options for ' + input_id);\n\t                        }\n\t                    }\n\t                }\n\t            });\n\t        },\n\t\n\t        /** Set form into wait mode */\n\t        wait: function wait(active) {\n\t            for (var i in this.input_list) {\n\t                var field = this.field_list[i];\n\t                var input = this.input_list[i];\n\t                if (input.is_dynamic && field.wait && field.unwait) {\n\t                    if (active) {\n\t                        field.wait();\n\t                    } else {\n\t                        field.unwait();\n\t                    }\n\t                }\n\t            }\n\t        },\n\t\n\t        /** Highlight and scroll to input element (currently only used for error notifications)\n\t        */\n\t        highlight: function highlight(input_id, message, silent) {\n\t            var input_element = this.element_list[input_id];\n\t            if (input_element) {\n\t                input_element.error(message || 'Please verify this parameter.');\n\t                this.portlet.expand();\n\t                this.trigger('expand', input_id);\n\t                if (!silent) {\n\t                    if (self == top) {\n\t                        var $panel = this.$el.parents().filter(function () {\n\t                            return $(this).css('overflow') == 'auto';\n\t                        }).first();\n\t                        $panel.animate({ scrollTop: $panel.scrollTop() + input_element.$el.offset().top - 50 }, 500);\n\t                    } else {\n\t                        $('html, body').animate({ scrollTop: input_element.$el.offset().top - 20 }, 500);\n\t                    }\n\t                }\n\t            }\n\t        },\n\t\n\t        /** Highlights errors\n\t        */\n\t        errors: function errors(options) {\n\t            this.trigger('reset');\n\t            if (options && options.errors) {\n\t                var error_messages = this.data.matchResponse(options.errors);\n\t                for (var input_id in this.element_list) {\n\t                    var input = this.element_list[input_id];\n\t                    if (error_messages[input_id]) {\n\t                        this.highlight(input_id, error_messages[input_id], true);\n\t                    }\n\t                }\n\t            }\n\t        },\n\t\n\t        /** Render tool form\n\t        */\n\t        render: function render() {\n\t            // link this\n\t            var self = this;\n\t\n\t            // reset events\n\t            this.off('change');\n\t            this.off('reset');\n\t\n\t            // reset field list, which contains the input field elements\n\t            this.field_list = {};\n\t\n\t            // reset sequential input definition list, which contains the input definitions as provided from the api\n\t            this.input_list = {};\n\t\n\t            // reset input element list, which contains the dom elements of each input element (includes also the input field)\n\t            this.element_list = {};\n\t\n\t            // creates a json data structure from the input form\n\t            this.data = new FormData.Manager(this);\n\t\n\t            // create ui elements\n\t            this._renderForm();\n\t\n\t            // refresh data\n\t            this.data.create();\n\t\n\t            // show errors on startup\n\t            if (this.options.initial_errors) {\n\t                this.errors(this.options);\n\t            }\n\t\n\t            // add listener which triggers on checksum change\n\t            var current_check = this.data.checksum();\n\t            this.on('change', function (force) {\n\t                var new_check = self.data.checksum();\n\t                if (new_check != current_check || force) {\n\t                    current_check = new_check;\n\t                    self.options.onchange && self.options.onchange();\n\t                }\n\t            });\n\t\n\t            // add reset listener\n\t            this.on('reset', function () {\n\t                for (var i in this.element_list) {\n\t                    this.element_list[i].reset();\n\t                }\n\t            });\n\t            return this;\n\t        },\n\t\n\t        /** Renders the UI elements required for the form\n\t        */\n\t        _renderForm: function _renderForm() {\n\t            // create message view\n\t            this.message = new Ui.Message();\n\t\n\t            // create tool form section\n\t            this.section = new FormSection.View(this, {\n\t                inputs: this.options.inputs\n\t            });\n\t\n\t            // remove tooltips\n\t            $('.tooltip').remove();\n\t\n\t            // create portlet\n\t            this.portlet = new Portlet.View({\n\t                icon: this.options.icon,\n\t                title: this.options.title,\n\t                cls: this.options.cls,\n\t                operations: this.options.operations,\n\t                buttons: this.options.buttons,\n\t                collapsible: this.options.collapsible,\n\t                collapsed: this.options.collapsed\n\t            });\n\t\n\t            // append message\n\t            this.portlet.append(this.message.$el);\n\t\n\t            // append tool section\n\t            this.portlet.append(this.section.$el);\n\t\n\t            // start form\n\t            this.$el.empty();\n\t            this.$el.append(this.portlet.$el);\n\t\n\t            // show message if available in model\n\t            if (this.options.message) {\n\t                this.message.update({\n\t                    persistent: true,\n\t                    status: 'warning',\n\t                    message: this.options.message\n\t                });\n\t            }\n\t\n\t            // log\n\t            Galaxy.emit.debug('form-view::initialize()', 'Completed');\n\t        }\n\t    });\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 48 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(_) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(39), __webpack_require__(49), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (DC_MODEL, HISTORY_CONTENT, _l) {\n\t\n\t    'use strict';\n\t\n\t    /*==============================================================================\n\t    \n\t    Models for DatasetCollections contained within a history.\n\t    \n\t    TODO:\n\t        these might be compactable to one class if some duplication with\n\t        collection-model is used.\n\t    \n\t    ==============================================================================*/\n\t\n\t    var hcontentMixin = HISTORY_CONTENT.HistoryContentMixin,\n\t        ListDC = DC_MODEL.ListDatasetCollection,\n\t        PairDC = DC_MODEL.PairDatasetCollection,\n\t        ListPairedDC = DC_MODEL.ListPairedDatasetCollection;\n\t\n\t    //==============================================================================\n\t    /** Override to post to contents route w/o id. */\n\t    function buildHDCASave(_super) {\n\t        return function _save(attributes, options) {\n\t            if (this.isNew()) {\n\t                options = options || {};\n\t                options.url = this.urlRoot + this.get('history_id') + '/contents';\n\t                attributes = attributes || {};\n\t                attributes.type = 'dataset_collection';\n\t            }\n\t            return _super.call(this, attributes, options);\n\t        };\n\t    }\n\t\n\t    //==============================================================================\n\t    /** @class Backbone model for List Dataset Collection within a History.\n\t     */\n\t    var HistoryListDatasetCollection = ListDC.extend(hcontentMixin).extend(\n\t    /** @lends HistoryListDatasetCollection.prototype */{\n\t\n\t        defaults: _.extend(_.clone(ListDC.prototype.defaults), {\n\t            history_content_type: 'dataset_collection',\n\t            collection_type: 'list',\n\t            model_class: 'HistoryDatasetCollectionAssociation'\n\t        }),\n\t\n\t        initialize: function initialize(model, options) {\n\t            ListDC.prototype.initialize.call(this, model, options);\n\t            hcontentMixin.initialize.call(this, model, options);\n\t        },\n\t\n\t        /** Override to post to contents route w/o id. */\n\t        save: buildHDCASave(ListDC.prototype.save),\n\t\n\t        /** String representation. */\n\t        toString: function toString() {\n\t            return ['HistoryListDatasetCollection(', this.get('name'), ')'].join('');\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    /** @class Backbone model for Pair Dataset Collection within a History.\n\t     *  @constructs\n\t     */\n\t    var HistoryPairDatasetCollection = PairDC.extend(hcontentMixin).extend(\n\t    /** @lends HistoryPairDatasetCollection.prototype */{\n\t\n\t        defaults: _.extend(_.clone(PairDC.prototype.defaults), {\n\t            history_content_type: 'dataset_collection',\n\t            collection_type: 'paired',\n\t            model_class: 'HistoryDatasetCollectionAssociation'\n\t        }),\n\t\n\t        initialize: function initialize(model, options) {\n\t            PairDC.prototype.initialize.call(this, model, options);\n\t            hcontentMixin.initialize.call(this, model, options);\n\t        },\n\t\n\t        /** Override to post to contents route w/o id. */\n\t        save: buildHDCASave(PairDC.prototype.save),\n\t\n\t        /** String representation. */\n\t        toString: function toString() {\n\t            return ['HistoryPairDatasetCollection(', this.get('name'), ')'].join('');\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    /** @class Backbone model for List of Pairs Dataset Collection within a History.\n\t     *  @constructs\n\t     */\n\t    var HistoryListPairedDatasetCollection = ListPairedDC.extend(hcontentMixin).extend(\n\t    /** @lends HistoryListPairedDatasetCollection.prototype */{\n\t\n\t        defaults: _.extend(_.clone(ListPairedDC.prototype.defaults), {\n\t            history_content_type: 'dataset_collection',\n\t            collection_type: 'list:paired',\n\t            model_class: 'HistoryDatasetCollectionAssociation'\n\t        }),\n\t\n\t        initialize: function initialize(model, options) {\n\t            ListPairedDC.prototype.initialize.call(this, model, options);\n\t            hcontentMixin.initialize.call(this, model, options);\n\t        },\n\t\n\t        /** Override to post to contents route w/o id. */\n\t        save: buildHDCASave(ListPairedDC.prototype.save),\n\t\n\t        /** String representation. */\n\t        toString: function toString() {\n\t            return ['HistoryListPairedDatasetCollection(', this.get('name'), ')'].join('');\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    return {\n\t        HistoryListDatasetCollection: HistoryListDatasetCollection,\n\t        HistoryPairDatasetCollection: HistoryPairDatasetCollection,\n\t        HistoryListPairedDatasetCollection: HistoryListPairedDatasetCollection\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2)))\n\n/***/ },\n/* 49 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, jQuery) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(12), __webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (STATES, BASE_MVC, _l) {\n\t\n\t    'use strict';\n\t\n\t    var logNamespace = 'history';\n\t    //==============================================================================\n\t    /** How the type_id attribute is built for the history's mixed contents collection */\n\t    var typeIdStr = function _typeIdStr(type, id) {\n\t        return [type, id].join('-');\n\t    };\n\t\n\t    //==============================================================================\n\t    /** @class Mixin for HistoryContents content (HDAs, HDCAs).\n\t     */\n\t    var HistoryContentMixin = {\n\t        //TODO:?? into true Backbone.Model?\n\t\n\t        /** default attributes for a model */\n\t        defaults: {\n\t            /** parent (containing) history */\n\t            history_id: null,\n\t            /** some content_type (HistoryContents can contain mixed model classes) */\n\t            history_content_type: null,\n\t            /** indicating when/what order the content was generated in the context of the history */\n\t            hid: null,\n\t            /** whether the user wants the content shown (visible) */\n\t            visible: true\n\t        },\n\t\n\t        // ........................................................................ mixed content element\n\t        //TODO: there's got to be a way to move this into HistoryContents - if we can do that, this class might not be needed\n\t        // In order to be part of a MIXED bbone collection, we can't rely on the id\n\t        //  (which may collide btwn models of different classes)\n\t        // Build a new id (type_id) that prefixes the history_content_type so the bbone collection can differentiate\n\t        idAttribute: 'type_id',\n\t\n\t        /** override constructor to build type_id and insert into original attributes */\n\t        constructor: function constructor(attrs, options) {\n\t            attrs.type_id = typeIdStr(attrs.history_content_type, attrs.id);\n\t            this.debug('HistoryContentMixin.constructor:', attrs.type_id);\n\t            Backbone.Model.apply(this, arguments);\n\t        },\n\t\n\t        /** object level fn for building the type_id string */\n\t        _typeIdStr: function _typeIdStr() {\n\t            return typeIdStr(this.get('history_content_type'), this.get('id'));\n\t        },\n\t\n\t        /** add listener to re-create type_id when the id changes */\n\t        initialize: function initialize(attrs, options) {\n\t            this.on('change:id', this._createTypeId);\n\t        },\n\t\n\t        /** set the type_id in the model attributes */\n\t        _createTypeId: function _createTypeId() {\n\t            this.set('type_id', this._typeIdStr());\n\t        },\n\t\n\t        /** override because backbone tests boolean( idAttribute ), but it's not an empty string even for new models\n\t         *  due to our use of type_id.\n\t         */\n\t        isNew: function isNew() {\n\t            return !this.get('id');\n\t        },\n\t\n\t        // ........................................................................ common queries\n\t        /** the more common alias of visible */\n\t        hidden: function hidden() {\n\t            return !this.get('visible');\n\t        },\n\t\n\t        /** based on show_deleted, show_hidden (gen. from the container control),\n\t         *      would this ds show in the list of ds's?\n\t         *  @param {Boolean} show_deleted are we showing deleted hdas?\n\t         *  @param {Boolean} show_hidden are we showing hidden hdas?\n\t         */\n\t        isVisible: function isVisible(show_deleted, show_hidden) {\n\t            //TODO:?? Another unfortunate name collision\n\t            var isVisible = true;\n\t            if (!show_deleted && (this.get('deleted') || this.get('purged'))) {\n\t                isVisible = false;\n\t            }\n\t            if (!show_hidden && !this.get('visible')) {\n\t                isVisible = false;\n\t            }\n\t            return isVisible;\n\t        },\n\t\n\t        // ........................................................................ ajax\n\t        //TODO: global\n\t        //TODO: these are probably better done on the leaf classes\n\t        /** history content goes through the 'api/histories' API */\n\t        urlRoot: Galaxy.root + 'api/histories/',\n\t\n\t        /** full url spec. for this content */\n\t        url: function url() {\n\t            var url = this.urlRoot + this.get('history_id') + '/contents/' + this.get('history_content_type') + 's/' + this.get('id');\n\t            return url;\n\t        },\n\t\n\t        /** save this content as not visible */\n\t        hide: function hide(options) {\n\t            if (!this.get('visible')) {\n\t                return jQuery.when();\n\t            }\n\t            return this.save({ visible: false }, options);\n\t        },\n\t        /** save this content as visible */\n\t        unhide: function unhide(options) {\n\t            if (this.get('visible')) {\n\t                return jQuery.when();\n\t            }\n\t            return this.save({ visible: true }, options);\n\t        },\n\t\n\t        // ........................................................................ misc\n\t        /** String representation */\n\t        toString: function toString() {\n\t            var nameAndId = this.get('id') || '';\n\t            if (this.get('name')) {\n\t                nameAndId = this.get('hid') + ' :\"' + this.get('name') + '\",' + nameAndId;\n\t            }\n\t            return 'HistoryContent(' + nameAndId + ')';\n\t        }\n\t    };\n\t\n\t    //==============================================================================\n\t    //TODO: needed?\n\t    /** @class (Concrete/non-mixin) base model for content items.\n\t     */\n\t    var HistoryContent = Backbone.Model.extend(BASE_MVC.LoggableMixin).extend(HistoryContentMixin).extend({ _logNamespace: logNamespace });\n\t\n\t    //==============================================================================\n\t    return {\n\t        typeIdStr: typeIdStr,\n\t        HistoryContentMixin: HistoryContentMixin,\n\t        HistoryContent: HistoryContent\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1)))\n\n/***/ },\n/* 50 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, jQuery) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(49), __webpack_require__(80), __webpack_require__(48), __webpack_require__(12), __webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (HISTORY_CONTENT, HDA_MODEL, HDCA_MODEL, STATES, BASE_MVC, _l) {\n\t\n\t    'use strict';\n\t\n\t    var logNamespace = 'history';\n\t    //==============================================================================\n\t    /** @class Backbone collection for history content.\n\t     *      NOTE: history content seems like a dataset collection, but differs in that it is mixed:\n\t     *          each element can be either an HDA (dataset) or a DatasetCollection and co-exist on\n\t     *          the same level.\n\t     *      Dataset collections on the other hand are not mixed and (so far) can only contain either\n\t     *          HDAs or child dataset collections on one level.\n\t     *      This is why this does not inherit from any of the DatasetCollections (currently).\n\t     */\n\t    var HistoryContents = Backbone.Collection.extend(BASE_MVC.LoggableMixin).extend( /** @lends HistoryContents.prototype */{\n\t        //TODO:?? may want to inherit from some MixedModelCollection\n\t        //TODO:?? also consider inheriting from a 'DatasetList'\n\t        //TODO: can we decorate the mixed models using the model fn below (instead of having them build their own type_id)?\n\t\n\t        _logNamespace: logNamespace,\n\t\n\t        /** since history content is a mix, override model fn into a factory, creating based on history_content_type */\n\t        model: function model(attrs, options) {\n\t            //TODO: can we move the type_id stuff here?\n\t            //attrs.type_id = typeIdStr( attrs );\n\t\n\t            if (attrs.history_content_type === \"dataset\") {\n\t                return new HDA_MODEL.HistoryDatasetAssociation(attrs, options);\n\t            } else if (attrs.history_content_type === \"dataset_collection\") {\n\t                switch (attrs.collection_type) {\n\t                    case 'list':\n\t                        return new HDCA_MODEL.HistoryListDatasetCollection(attrs, options);\n\t                    case 'paired':\n\t                        return new HDCA_MODEL.HistoryPairDatasetCollection(attrs, options);\n\t                    case 'list:paired':\n\t                        return new HDCA_MODEL.HistoryListPairedDatasetCollection(attrs, options);\n\t                }\n\t                // This is a hack inside a hack:\n\t                // Raise a plain object with validationError to fake a model.validationError\n\t                // (since we don't have a model to use validate with)\n\t                // (the outer hack being the mixed content/model function in this collection)\n\t                return { validationError: 'Unknown collection_type: ' + attrs.history_content_type };\n\t            }\n\t            return { validationError: 'Unknown history_content_type: ' + attrs.history_content_type };\n\t        },\n\t\n\t        /** Set up.\n\t         *  @see Backbone.Collection#initialize\n\t         */\n\t        initialize: function initialize(models, options) {\n\t            options = options || {};\n\t            //TODO: could probably use the contents.history_id instead\n\t            this.historyId = options.historyId;\n\t            //this._setUpListeners();\n\t\n\t            // backbonejs uses collection.model.prototype.idAttribute to determine if a model is *already* in a collection\n\t            //  and either merged or replaced. In this case, our 'model' is a function so we need to add idAttribute\n\t            //  manually here - if we don't, contents will not merge but be replaced/swapped.\n\t            this.model.prototype.idAttribute = 'type_id';\n\t\n\t            this.on('all', function () {\n\t                this.debug(this + '.event:', arguments);\n\t            });\n\t        },\n\t\n\t        /** root api url */\n\t        urlRoot: Galaxy.root + 'api/histories',\n\t        /** complete api url */\n\t        url: function url() {\n\t            return this.urlRoot + '/' + this.historyId + '/contents';\n\t        },\n\t\n\t        // ........................................................................ common queries\n\t        /** Get the ids of every item in this collection\n\t         *  @returns array of encoded ids\n\t         */\n\t        ids: function ids() {\n\t            //TODO: is this still useful since type_id\n\t            return this.map(function (item) {\n\t                return item.get('id');\n\t            });\n\t        },\n\t\n\t        /** Get contents that are not ready\n\t         *  @returns array of content models\n\t         */\n\t        notReady: function notReady() {\n\t            return this.filter(function (content) {\n\t                return !content.inReadyState();\n\t            });\n\t        },\n\t\n\t        /** Get the id of every model in this collection not in a 'ready' state (running).\n\t         *  @returns an array of model ids\n\t         *  @see HistoryDatasetAssociation#inReadyState\n\t         */\n\t        running: function running() {\n\t            function filterFn(c) {\n\t                return !c.inReadyState();\n\t            }\n\t            return new HistoryContents(this.filter(filterFn));\n\t        },\n\t\n\t        /** Get the model with the given hid\n\t         *  @param {Int} hid the hid to search for\n\t         *  @returns {HistoryDatasetAssociation} the model with the given hid or undefined if not found\n\t         */\n\t        getByHid: function getByHid(hid) {\n\t            return _.first(this.filter(function (content) {\n\t                return content.get('hid') === hid;\n\t            }));\n\t        },\n\t\n\t        //TODO:?? this may belong in the containing view\n\t        /** Get every 'shown' model in this collection based on show_deleted/hidden\n\t         *  @param {Boolean} show_deleted are we showing deleted content?\n\t         *  @param {Boolean} show_hidden are we showing hidden content?\n\t         *  @returns array of content models\n\t         *  @see HistoryDatasetAssociation#isVisible\n\t         */\n\t        getVisible: function getVisible(show_deleted, show_hidden, filters) {\n\t            filters = filters || [];\n\t            //this.debug( 'filters:', filters );\n\t            // always filter by show deleted/hidden first\n\t            this.debug('checking isVisible');\n\t            var filteredHdas = new HistoryContents(this.filter(function (item) {\n\t                return item.isVisible(show_deleted, show_hidden);\n\t            }));\n\t\n\t            _.each(filters, function (filterFn) {\n\t                if (!_.isFunction(filterFn)) {\n\t                    return;\n\t                }\n\t                filteredHdas = new HistoryContents(filteredHdas.filter(filterFn));\n\t            });\n\t            return filteredHdas;\n\t        },\n\t\n\t        /** return a new contents collection of only hidden items */\n\t        hidden: function hidden() {\n\t            function filterFn(c) {\n\t                return c.hidden();\n\t            }\n\t            return new HistoryContents(this.filter(filterFn));\n\t        },\n\t\n\t        /** return a new contents collection of only hidden items */\n\t        deleted: function deleted() {\n\t            function filterFn(c) {\n\t                return c.get('deleted');\n\t            }\n\t            return new HistoryContents(this.filter(filterFn));\n\t        },\n\t\n\t        /** return a new contents collection of only hidden items */\n\t        visibleAndUndeleted: function visibleAndUndeleted() {\n\t            function filterFn(c) {\n\t                return c.get('visible') && !c.get('deleted');\n\t            }\n\t            return new HistoryContents(this.filter(filterFn));\n\t        },\n\t\n\t        /** return true if any contents don't have details */\n\t        haveDetails: function haveDetails() {\n\t            return this.all(function (content) {\n\t                return content.hasDetails();\n\t            });\n\t        },\n\t\n\t        // ........................................................................ ajax\n\t        /** override to use newest (versioned) api */\n\t        fetch: function fetch(options) {\n\t            options = options || {};\n\t            options.data = _.defaults(options.data || {}, {\n\t                v: 'dev'\n\t            });\n\t            return Backbone.Collection.prototype.fetch.call(this, options);\n\t        },\n\t\n\t        /** override to use newest (versioned) api */\n\t        fetchUpdated: function fetchUpdated(since, options) {\n\t            options = options || {};\n\t            options.traditional = true;\n\t            // TODO: this is painful - simplify here or move q/qv to named/mappable params\n\t            options.data = [{ name: 'v', value: 'dev' }];\n\t            if (since) {\n\t                options.data = options.data.concat(this._filtersFromMap({\n\t                    'update_time-ge': since.toISOString()\n\t                }));\n\t            }\n\t            options.merge = true;\n\t            options.remove = false;\n\t            return this.fetch(options);\n\t        },\n\t\n\t        _filtersFromMap: function _filtersFromMap(filterMap) {\n\t            var filters = [];\n\t            // TODO: this seems unnecessary\n\t            _.each(filterMap, function (val, key) {\n\t                filters.push({ name: 'q', value: key });\n\t                filters.push({ name: 'qv', value: val });\n\t            });\n\t            return filters;\n\t        },\n\t\n\t        /** fetch detailed model data for all contents in this collection */\n\t        fetchAllDetails: function fetchAllDetails(options) {\n\t            options = options || {};\n\t            var detailsFlag = { details: 'all' };\n\t            options.data = options.data ? _.extend(options.data, detailsFlag) : detailsFlag;\n\t            return this.fetch(options);\n\t        },\n\t\n\t        /** specialty fetch method for retrieving the element_counts of all hdcas in the history */\n\t        fetchCollectionCounts: function fetchCollectionCounts(options) {\n\t            options = options || {};\n\t            options.data = _.defaults({\n\t                keys: ['type_id', 'element_count'].join(','),\n\t                q: 'history_content_type',\n\t                qv: 'dataset_collection'\n\t            }, options.data || {});\n\t            options.merge = true;\n\t            options.remove = false;\n\t            return this.fetch(options);\n\t        },\n\t\n\t        /** using a queue, perform ajaxFn on each of the models in this collection */\n\t        ajaxQueue: function ajaxQueue(ajaxFn, options) {\n\t            var deferred = jQuery.Deferred(),\n\t                startingLength = this.length,\n\t                responses = [];\n\t\n\t            if (!startingLength) {\n\t                deferred.resolve([]);\n\t                return deferred;\n\t            }\n\t\n\t            // use reverse order (stylistic choice)\n\t            var ajaxFns = this.chain().reverse().map(function (content, i) {\n\t                return function () {\n\t                    var xhr = ajaxFn.call(content, options);\n\t                    // if successful, notify using the deferred to allow tracking progress\n\t                    xhr.done(function (response) {\n\t                        deferred.notify({ curr: i, total: startingLength, response: response, model: content });\n\t                    });\n\t                    // (regardless of previous error or success) if not last ajax call, shift and call the next\n\t                    //  if last fn, resolve deferred\n\t                    xhr.always(function (response) {\n\t                        responses.push(response);\n\t                        if (ajaxFns.length) {\n\t                            ajaxFns.shift()();\n\t                        } else {\n\t                            deferred.resolve(responses);\n\t                        }\n\t                    });\n\t                };\n\t            }).value();\n\t            // start the queue\n\t            ajaxFns.shift()();\n\t\n\t            return deferred;\n\t        },\n\t\n\t        isCopyable: function isCopyable(contentsJSON) {\n\t            var copyableModelClasses = ['HistoryDatasetAssociation', 'HistoryDatasetCollectionAssociation'];\n\t            return _.isObject(contentsJSON) && contentsJSON.id && _.contains(copyableModelClasses, contentsJSON.model_class);\n\t        },\n\t\n\t        /** copy an existing, accessible hda into this collection */\n\t        copy: function copy(json) {\n\t            var id, type, contentType;\n\t            if (_.isString(json)) {\n\t                id = json;\n\t                contentType = 'hda';\n\t                type = 'dataset';\n\t            } else {\n\t                id = json.id;\n\t                contentType = {\n\t                    'HistoryDatasetAssociation': 'hda',\n\t                    'LibraryDatasetDatasetAssociation': 'ldda',\n\t                    'HistoryDatasetCollectionAssociation': 'hdca'\n\t                }[json.model_class] || 'hda';\n\t                type = contentType === 'hdca' ? 'dataset_collection' : 'dataset';\n\t            }\n\t            var collection = this,\n\t                xhr = jQuery.post(this.url(), {\n\t                content: id,\n\t                source: contentType,\n\t                type: type\n\t            }).done(function (response) {\n\t                collection.add([response]);\n\t            }).fail(function (error, status, message) {\n\t                collection.trigger('error', collection, xhr, {}, 'Error copying contents', { type: type, id: id, source: contentType });\n\t            });\n\t            return xhr;\n\t        },\n\t\n\t        // ........................................................................ sorting/filtering\n\t        /** return a new collection of contents whose attributes contain the substring matchesWhat */\n\t        matches: function matches(matchesWhat) {\n\t            return this.filter(function (content) {\n\t                return content.matches(matchesWhat);\n\t            });\n\t        },\n\t\n\t        // ........................................................................ misc\n\t        /** */\n\t        createHDCA: function createHDCA(elementIdentifiers, collectionType, name, options) {\n\t            //precondition: elementIdentifiers is an array of plain js objects\n\t            //  in the proper form to create the collectionType\n\t            var contents = this,\n\t                typeToModel = {\n\t                list: HDCA_MODEL.HistoryListDatasetCollection,\n\t                paired: HDCA_MODEL.HistoryPairDatasetCollection\n\t            },\n\t                hdca = new typeToModel[collectionType]({\n\t                history_id: this.historyId,\n\t                name: name,\n\t                // should probably be able to just send in a bunch of json here and restruct per class\n\t                element_identifiers: elementIdentifiers\n\t            });\n\t            // do I even need to use new above, can I just pass the attrs here\n\t            return hdca.save().done(function (response) {\n\t                contents.add(hdca);\n\t            }).fail(function (xhr, status, message) {\n\t                contents.trigger('error', xhr, status, message);\n\t            });\n\t        },\n\t\n\t        /** In this override, copy the historyId to the clone */\n\t        clone: function clone() {\n\t            var clone = Backbone.Collection.prototype.clone.call(this);\n\t            clone.historyId = this.historyId;\n\t            return clone;\n\t        },\n\t\n\t        /** debugging */\n\t        print: function print() {\n\t            var contents = this;\n\t            contents.each(function (c) {\n\t                contents.debug(c);\n\t                if (c.elements) {\n\t                    contents.debug('\\t elements:', c.elements);\n\t                }\n\t            });\n\t        },\n\t\n\t        /** String representation. */\n\t        toString: function toString() {\n\t            return ['HistoryContents(', [this.historyId, this.length].join(), ')'].join('');\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    return {\n\t        HistoryContents: HistoryContents\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 51 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $, _, jQuery) {'use strict';\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (BASE_MVC, _l) {\n\t\n\t    'use strict';\n\t\n\t    var logNamespace = 'list';\n\t    //==============================================================================\n\t    /** A view which, when first rendered, shows only summary data/attributes, but\n\t     *      can be expanded to show further details (and optionally fetch those\n\t     *      details from the server).\n\t     */\n\t    var ExpandableView = Backbone.View.extend(BASE_MVC.LoggableMixin).extend({\n\t        _logNamespace: logNamespace,\n\t\n\t        //TODO: Although the reasoning behind them is different, this shares a lot with HiddenUntilActivated above: combine them\n\t        //PRECONDITION: model must have method hasDetails\n\t        //PRECONDITION: subclasses must have templates.el and templates.details\n\t\n\t        initialize: function initialize(attributes) {\n\t            /** are the details of this view expanded/shown or not? */\n\t            this.expanded = attributes.expanded || false;\n\t            this.log('\\t expanded:', this.expanded);\n\t            this.fxSpeed = attributes.fxSpeed !== undefined ? attributes.fxSpeed : this.fxSpeed;\n\t        },\n\t\n\t        // ........................................................................ render main\n\t        /** jq fx speed */\n\t        fxSpeed: 'fast',\n\t\n\t        /** Render this content, set up ui.\n\t         *  @param {Number or String} speed   the speed of the render\n\t         */\n\t        render: function render(speed) {\n\t            var $newRender = this._buildNewRender();\n\t            this._setUpBehaviors($newRender);\n\t            this._queueNewRender($newRender, speed);\n\t            return this;\n\t        },\n\t\n\t        /** Build a temp div containing the new children for the view's $el.\n\t         *      If the view is already expanded, build the details as well.\n\t         */\n\t        _buildNewRender: function _buildNewRender() {\n\t            // create a new render using a skeleton template, render title buttons, render body, and set up events, etc.\n\t            var $newRender = $(this.templates.el(this.model.toJSON(), this));\n\t            if (this.expanded) {\n\t                this.$details($newRender).replaceWith(this._renderDetails().show());\n\t            }\n\t            return $newRender;\n\t        },\n\t\n\t        /** Fade out the old el, swap in the new contents, then fade in.\n\t         *  @param {Number or String} speed   jq speed to use for rendering effects\n\t         *  @fires rendered when rendered\n\t         */\n\t        _queueNewRender: function _queueNewRender($newRender, speed) {\n\t            speed = speed === undefined ? this.fxSpeed : speed;\n\t            var view = this;\n\t\n\t            $(view).queue('fx', [function (next) {\n\t                this.$el.fadeOut(speed, next);\n\t            }, function (next) {\n\t                view._swapNewRender($newRender);\n\t                next();\n\t            }, function (next) {\n\t                this.$el.fadeIn(speed, next);\n\t            }, function (next) {\n\t                this.trigger('rendered', view);\n\t                next();\n\t            }]);\n\t        },\n\t\n\t        /** empty out the current el, move the $newRender's children in */\n\t        _swapNewRender: function _swapNewRender($newRender) {\n\t            return this.$el.empty().attr('class', _.isFunction(this.className) ? this.className() : this.className).append($newRender.children());\n\t        },\n\t\n\t        /** set up js behaviors, event handlers for elements within the given container\n\t         *  @param {jQuery} $container jq object that contains the elements to process (defaults to this.$el)\n\t         */\n\t        _setUpBehaviors: function _setUpBehaviors($where) {\n\t            $where = $where || this.$el;\n\t            // set up canned behavior on children (bootstrap, popupmenus, editable_text, etc.)\n\t            //make_popup_menus( $where );\n\t            $where.find('[title]').tooltip({ placement: 'bottom' });\n\t        },\n\t\n\t        // ......................................................................... details\n\t        /** shortcut to details DOM (as jQ) */\n\t        $details: function $details($where) {\n\t            $where = $where || this.$el;\n\t            return $where.find('> .details');\n\t        },\n\t\n\t        /** build the DOM for the details and set up behaviors on it */\n\t        _renderDetails: function _renderDetails() {\n\t            var $newDetails = $(this.templates.details(this.model.toJSON(), this));\n\t            this._setUpBehaviors($newDetails);\n\t            return $newDetails;\n\t        },\n\t\n\t        // ......................................................................... expansion/details\n\t        /** Show or hide the details\n\t         *  @param {Boolean} expand if true, expand; if false, collapse\n\t         */\n\t        toggleExpanded: function toggleExpanded(expand) {\n\t            expand = expand === undefined ? !this.expanded : expand;\n\t            if (expand) {\n\t                this.expand();\n\t            } else {\n\t                this.collapse();\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /** Render and show the full, detailed body of this view including extra data and controls.\n\t         *      note: if the model does not have detailed data, fetch that data before showing the body\n\t         *  @fires expanded when a body has been expanded\n\t         */\n\t        expand: function expand() {\n\t            var view = this;\n\t            return view._fetchModelDetails().always(function () {\n\t                view._expand();\n\t            });\n\t        },\n\t\n\t        /** Check for model details and, if none, fetch them.\n\t         *  @returns {jQuery.promise} the model.fetch.xhr if details are being fetched, an empty promise if not\n\t         */\n\t        _fetchModelDetails: function _fetchModelDetails() {\n\t            if (!this.model.hasDetails()) {\n\t                return this.model.fetch();\n\t            }\n\t            return jQuery.when();\n\t        },\n\t\n\t        /** Inner fn called when expand (public) has fetched the details */\n\t        _expand: function _expand() {\n\t            var view = this,\n\t                $newDetails = view._renderDetails();\n\t            view.$details().replaceWith($newDetails);\n\t            // needs to be set after the above or the slide will not show\n\t            view.expanded = true;\n\t            view.$details().slideDown({\n\t                duration: view.fxSpeed,\n\t                step: function step() {\n\t                    view.trigger('expanding', view);\n\t                },\n\t                complete: function complete() {\n\t                    view.trigger('expanded', view);\n\t                }\n\t            });\n\t        },\n\t\n\t        /** Hide the body/details of an HDA.\n\t         *  @fires collapsed when a body has been collapsed\n\t         */\n\t        collapse: function collapse() {\n\t            this.debug(this + '(ExpandableView).collapse');\n\t            var view = this;\n\t            view.expanded = false;\n\t            this.$details().slideUp({\n\t                duration: view.fxSpeed,\n\t                step: function step() {\n\t                    view.trigger('collapsing', view);\n\t                },\n\t                complete: function complete() {\n\t                    view.trigger('collapsed', view);\n\t                }\n\t            });\n\t        }\n\t\n\t    });\n\t\n\t    //==============================================================================\n\t    /** A view that is displayed in some larger list/grid/collection.\n\t     *      Inherits from Expandable, Selectable, Draggable.\n\t     *  The DOM contains warnings, a title bar, and a series of primary action controls.\n\t     *      Primary actions are meant to be easily accessible item functions (such as delete)\n\t     *      that are rendered in the title bar.\n\t     *\n\t     *  Details are rendered when the user clicks the title bar or presses enter/space when\n\t     *      the title bar is in focus.\n\t     *\n\t     *  Designed as a base class for history panel contents - but usable elsewhere (I hope).\n\t     */\n\t    var ListItemView = ExpandableView.extend(BASE_MVC.mixin(BASE_MVC.SelectableViewMixin, BASE_MVC.DraggableViewMixin, {\n\t\n\t        //TODO: that's a little contradictory\n\t        tagName: 'div',\n\t        className: 'list-item',\n\t\n\t        /** Set up the base class and all mixins */\n\t        initialize: function initialize(attributes) {\n\t            ExpandableView.prototype.initialize.call(this, attributes);\n\t            BASE_MVC.SelectableViewMixin.initialize.call(this, attributes);\n\t            BASE_MVC.DraggableViewMixin.initialize.call(this, attributes);\n\t            this._setUpListeners();\n\t        },\n\t\n\t        /** event listeners */\n\t        _setUpListeners: function _setUpListeners() {\n\t            // hide the primary actions in the title bar when selectable and narrow\n\t            this.on('selectable', function (isSelectable) {\n\t                if (isSelectable) {\n\t                    this.$('.primary-actions').hide();\n\t                } else {\n\t                    this.$('.primary-actions').show();\n\t                }\n\t            }, this);\n\t            //this.on( 'all', function( event ){\n\t            //    this.log( event );\n\t            //}, this );\n\t            return this;\n\t        },\n\t\n\t        // ........................................................................ rendering\n\t        /** In this override, call methods to build warnings, titlebar and primary actions */\n\t        _buildNewRender: function _buildNewRender() {\n\t            var $newRender = ExpandableView.prototype._buildNewRender.call(this);\n\t            $newRender.children('.warnings').replaceWith(this._renderWarnings());\n\t            $newRender.children('.title-bar').replaceWith(this._renderTitleBar());\n\t            $newRender.children('.primary-actions').append(this._renderPrimaryActions());\n\t            $newRender.find('> .title-bar .subtitle').replaceWith(this._renderSubtitle());\n\t            return $newRender;\n\t        },\n\t\n\t        /** In this override, render the selector controls and set up dragging before the swap */\n\t        _swapNewRender: function _swapNewRender($newRender) {\n\t            ExpandableView.prototype._swapNewRender.call(this, $newRender);\n\t            if (this.selectable) {\n\t                this.showSelector(0);\n\t            }\n\t            if (this.draggable) {\n\t                this.draggableOn();\n\t            }\n\t            return this.$el;\n\t        },\n\t\n\t        /** Render any warnings the item may need to show (e.g. \"I'm deleted\") */\n\t        _renderWarnings: function _renderWarnings() {\n\t            var view = this,\n\t                $warnings = $('<div class=\"warnings\"></div>'),\n\t                json = view.model.toJSON();\n\t            //TODO:! unordered (map)\n\t            _.each(view.templates.warnings, function (templateFn) {\n\t                $warnings.append($(templateFn(json, view)));\n\t            });\n\t            return $warnings;\n\t        },\n\t\n\t        /** Render the title bar (the main/exposed SUMMARY dom element) */\n\t        _renderTitleBar: function _renderTitleBar() {\n\t            return $(this.templates.titleBar(this.model.toJSON(), this));\n\t        },\n\t\n\t        /** Return an array of jQ objects containing common/easily-accessible item controls */\n\t        _renderPrimaryActions: function _renderPrimaryActions() {\n\t            // override this\n\t            return [];\n\t        },\n\t\n\t        /** Render the title bar (the main/exposed SUMMARY dom element) */\n\t        _renderSubtitle: function _renderSubtitle() {\n\t            return $(this.templates.subtitle(this.model.toJSON(), this));\n\t        },\n\t\n\t        // ......................................................................... events\n\t        /** event map */\n\t        events: {\n\t            // expand the body when the title is clicked or when in focus and space or enter is pressed\n\t            'click .title-bar': '_clickTitleBar',\n\t            'keydown .title-bar': '_keyDownTitleBar',\n\t\n\t            // dragging - don't work, originalEvent === null\n\t            //'dragstart .dataset-title-bar'  : 'dragStartHandler',\n\t            //'dragend .dataset-title-bar'    : 'dragEndHandler'\n\t\n\t            'click .selector': 'toggleSelect'\n\t        },\n\t\n\t        /** expand when the title bar is clicked */\n\t        _clickTitleBar: function _clickTitleBar(event) {\n\t            event.stopPropagation();\n\t            if (event.altKey) {\n\t                this.toggleSelect(event);\n\t                if (!this.selectable) {\n\t                    this.showSelector();\n\t                }\n\t            } else {\n\t                this.toggleExpanded();\n\t            }\n\t        },\n\t\n\t        /** expand when the title bar is in focus and enter or space is pressed */\n\t        _keyDownTitleBar: function _keyDownTitleBar(event) {\n\t            // bail (with propagation) if keydown and not space or enter\n\t            var KEYCODE_SPACE = 32,\n\t                KEYCODE_RETURN = 13;\n\t            if (event && event.type === 'keydown' && (event.keyCode === KEYCODE_SPACE || event.keyCode === KEYCODE_RETURN)) {\n\t                this.toggleExpanded();\n\t                event.stopPropagation();\n\t                return false;\n\t            }\n\t            return true;\n\t        },\n\t\n\t        // ......................................................................... misc\n\t        /** String representation */\n\t        toString: function toString() {\n\t            var modelString = this.model ? this.model + '' : '(no model)';\n\t            return 'ListItemView(' + modelString + ')';\n\t        }\n\t    }));\n\t\n\t    // ............................................................................ TEMPLATES\n\t    /** underscore templates */\n\t    ListItemView.prototype.templates = function () {\n\t        //TODO: move to require text! plugin\n\t\n\t        var elTemplato = BASE_MVC.wrapTemplate(['<div class=\"list-element\">',\n\t        // errors, messages, etc.\n\t        '<div class=\"warnings\"></div>',\n\t\n\t        // multi-select checkbox\n\t        '<div class=\"selector\">', '<span class=\"fa fa-2x fa-square-o\"></span>', '</div>',\n\t        // space for title bar buttons - gen. floated to the right\n\t        '<div class=\"primary-actions\"></div>', '<div class=\"title-bar\"></div>',\n\t\n\t        // expandable area for more details\n\t        '<div class=\"details\"></div>', '</div>']);\n\t\n\t        var warnings = {};\n\t\n\t        var titleBarTemplate = BASE_MVC.wrapTemplate([\n\t        // adding a tabindex here allows focusing the title bar and the use of keydown to expand the dataset display\n\t        '<div class=\"title-bar clear\" tabindex=\"0\">',\n\t        //TODO: prob. belongs in dataset-list-item\n\t        '<span class=\"state-icon\"></span>', '<div class=\"title\">', '<span class=\"name\"><%- element.name %></span>', '</div>', '<div class=\"subtitle\"></div>', '</div>'], 'element');\n\t\n\t        var subtitleTemplate = BASE_MVC.wrapTemplate([\n\t        // override this\n\t        '<div class=\"subtitle\"></div>']);\n\t\n\t        var detailsTemplate = BASE_MVC.wrapTemplate([\n\t        // override this\n\t        '<div class=\"details\"></div>']);\n\t\n\t        return {\n\t            el: elTemplato,\n\t            warnings: warnings,\n\t            titleBar: titleBarTemplate,\n\t            subtitle: subtitleTemplate,\n\t            details: detailsTemplate\n\t        };\n\t    }();\n\t\n\t    //==============================================================================\n\t    /** A view that is displayed in some larger list/grid/collection.\n\t     *  *AND* can display some sub-list of it's own when expanded (e.g. dataset collections).\n\t     *  This list will 'foldout' when the item is expanded depending on this.foldoutStyle:\n\t     *      If 'foldout': will expand vertically to show the nested list\n\t     *      If 'drilldown': will overlay the parent list\n\t     *\n\t     *  Inherits from ListItemView.\n\t     *\n\t     *  _renderDetails does the work of creating this.details: a sub-view that shows the nested list\n\t     */\n\t    var FoldoutListItemView = ListItemView.extend({\n\t\n\t        /** If 'foldout': show the sub-panel inside the expanded item\n\t         *  If 'drilldown': only fire events and handle by pub-sub\n\t         *      (allow the panel containing this item to attach it, hide itself, etc.)\n\t         */\n\t        foldoutStyle: 'foldout',\n\t        /** Panel view class to instantiate for the sub-panel */\n\t        foldoutPanelClass: null,\n\t\n\t        /** override to:\n\t         *      add attributes foldoutStyle and foldoutPanelClass for config poly\n\t         *      disrespect attributes.expanded if drilldown\n\t         */\n\t        initialize: function initialize(attributes) {\n\t            //TODO: hackish\n\t            if (this.foldoutStyle === 'drilldown') {\n\t                this.expanded = false;\n\t            }\n\t            this.foldoutStyle = attributes.foldoutStyle || this.foldoutStyle;\n\t            this.foldoutPanelClass = attributes.foldoutPanelClass || this.foldoutPanelClass;\n\t\n\t            ListItemView.prototype.initialize.call(this, attributes);\n\t            this.foldout = this._createFoldoutPanel();\n\t        },\n\t\n\t        //TODO:?? override to exclude foldout scope?\n\t        //$ : function( selector ){\n\t        //    var $found = ListItemView.prototype.$.call( this, selector );\n\t        //    return $found;\n\t        //},\n\t\n\t        /** in this override, attach the foldout panel when rendering details */\n\t        _renderDetails: function _renderDetails() {\n\t            //TODO: hackish\n\t            if (this.foldoutStyle === 'drilldown') {\n\t                return $();\n\t            }\n\t            var $newDetails = ListItemView.prototype._renderDetails.call(this);\n\t            return this._attachFoldout(this.foldout, $newDetails);\n\t        },\n\t\n\t        /** In this override, handle collection expansion. */\n\t        _createFoldoutPanel: function _createFoldoutPanel() {\n\t            var model = this.model;\n\t            var FoldoutClass = this._getFoldoutPanelClass(model),\n\t                options = this._getFoldoutPanelOptions(model),\n\t                foldout = new FoldoutClass(_.extend(options, {\n\t                model: model\n\t            }));\n\t            return foldout;\n\t        },\n\t\n\t        /** Stub to return proper foldout panel class */\n\t        _getFoldoutPanelClass: function _getFoldoutPanelClass() {\n\t            // override\n\t            return this.foldoutPanelClass;\n\t        },\n\t\n\t        /** Stub to return proper foldout panel options */\n\t        _getFoldoutPanelOptions: function _getFoldoutPanelOptions() {\n\t            return {\n\t                // propagate foldout style down\n\t                foldoutStyle: this.foldoutStyle,\n\t                fxSpeed: this.fxSpeed\n\t            };\n\t        },\n\t\n\t        /** Render the foldout panel inside the view, hiding controls */\n\t        _attachFoldout: function _attachFoldout(foldout, $whereTo) {\n\t            $whereTo = $whereTo || this.$('> .details');\n\t            this.foldout = foldout.render(0);\n\t            //TODO: hack\n\t            foldout.$('> .controls').hide();\n\t            return $whereTo.append(foldout.$el);\n\t        },\n\t\n\t        /** In this override, branch on foldoutStyle to show expanded */\n\t        expand: function expand() {\n\t            var view = this;\n\t            return view._fetchModelDetails().always(function () {\n\t                if (view.foldoutStyle === 'foldout') {\n\t                    view._expand();\n\t                } else if (view.foldoutStyle === 'drilldown') {\n\t                    view._expandByDrilldown();\n\t                }\n\t            });\n\t        },\n\t\n\t        /** For drilldown, set up close handler and fire expanded:drilldown\n\t         *      containing views can listen to this and handle other things\n\t         *      (like hiding themselves) by listening for expanded/collapsed:drilldown\n\t         */\n\t        _expandByDrilldown: function _expandByDrilldown() {\n\t            var view = this;\n\t            // attachment and rendering done by listener\n\t            view.listenTo(view.foldout, 'close', function () {\n\t                view.trigger('collapsed:drilldown', view, view.foldout);\n\t            });\n\t            view.trigger('expanded:drilldown', view, view.foldout);\n\t        }\n\t\n\t    });\n\t\n\t    // ............................................................................ TEMPLATES\n\t    /** underscore templates */\n\t    FoldoutListItemView.prototype.templates = function () {\n\t\n\t        //TODO:?? unnecessary?\n\t        // use element identifier\n\t        var detailsTemplate = BASE_MVC.wrapTemplate(['<div class=\"details\">',\n\t        // override with more info (that goes above the panel)\n\t        '</div>'], 'collection');\n\t\n\t        return _.extend({}, ListItemView.prototype.templates, {\n\t            details: detailsTemplate\n\t        });\n\t    }();\n\t\n\t    //==============================================================================\n\t    return {\n\t        ExpandableView: ExpandableView,\n\t        ListItemView: ListItemView,\n\t        FoldoutListItemView: FoldoutListItemView\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 52 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function($, _) {'use strict';\n\t\n\t/**\n\t    This is the base class of the tool form plugin. This class is e.g. inherited by the regular and the workflow tool form.\n\t*/\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(65), __webpack_require__(7), __webpack_require__(47), __webpack_require__(19), __webpack_require__(37)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, Deferred, Ui, FormBase, CitationModel, CitationView) {\n\t    return FormBase.extend({\n\t        initialize: function initialize(options) {\n\t            var self = this;\n\t            FormBase.prototype.initialize.call(this, options);\n\t            this.deferred = new Deferred();\n\t            if (options.inputs) {\n\t                this._buildForm(options);\n\t            } else {\n\t                this.deferred.execute(function (process) {\n\t                    self._buildModel(process, options, true);\n\t                });\n\t            }\n\t        },\n\t\n\t        /** Wait for deferred build processes before removal */\n\t        remove: function remove() {\n\t            var self = this;\n\t            this.$el.hide();\n\t            this.deferred.execute(function () {\n\t                FormBase.prototype.remove.call(self);\n\t                Galaxy.emit.debug('tool-form-base::remove()', 'Destroy view.');\n\t            });\n\t        },\n\t\n\t        /** Build form */\n\t        _buildForm: function _buildForm(options) {\n\t            var self = this;\n\t            this.options = Utils.merge(options, this.options);\n\t            this.options = Utils.merge({\n\t                icon: options.icon,\n\t                title: '<b>' + options.name + '</b> ' + options.description + ' (Galaxy Version ' + options.version + ')',\n\t                operations: this._operations(),\n\t                onchange: function onchange() {\n\t                    self.deferred.reset();\n\t                    self.deferred.execute(function (process) {\n\t                        self._updateModel(process);\n\t                    });\n\t                }\n\t            }, this.options);\n\t            this.options.customize && this.options.customize(this.options);\n\t            this.render();\n\t            if (!this.options.collapsible) {\n\t                this.$el.append($('<div/>').addClass('ui-margin-top-large').append(this._footer()));\n\t            }\n\t        },\n\t\n\t        /** Builds a new model through api call and recreates the entire form\n\t        */\n\t        _buildModel: function _buildModel(process, options, hide_message) {\n\t            var self = this;\n\t            this.options.id = options.id;\n\t            this.options.version = options.version;\n\t\n\t            // build request url\n\t            var build_url = '';\n\t            var build_data = {};\n\t            if (options.job_id) {\n\t                build_url = Galaxy.root + 'api/jobs/' + options.job_id + '/build_for_rerun';\n\t            } else {\n\t                build_url = Galaxy.root + 'api/tools/' + options.id + '/build';\n\t                if (Galaxy.params && Galaxy.params.tool_id == options.id) {\n\t                    build_data = $.extend({}, Galaxy.params);\n\t                    options.version && (build_data['tool_version'] = options.version);\n\t                }\n\t            }\n\t\n\t            // get initial model\n\t            Utils.get({\n\t                url: build_url,\n\t                data: build_data,\n\t                success: function success(new_model) {\n\t                    new_model = new_model.tool_model || new_model;\n\t                    if (!new_model.display) {\n\t                        window.location = Galaxy.root;\n\t                        return;\n\t                    }\n\t                    self._buildForm(new_model);\n\t                    !hide_message && self.message.update({\n\t                        status: 'success',\n\t                        message: 'Now you are using \\'' + self.options.name + '\\' version ' + self.options.version + ', id \\'' + self.options.id + '\\'.',\n\t                        persistent: false\n\t                    });\n\t                    Galaxy.emit.debug('tool-form-base::initialize()', 'Initial tool model ready.', new_model);\n\t                    process.resolve();\n\t                },\n\t                error: function error(response, xhr) {\n\t                    var error_message = response && response.err_msg || 'Uncaught error.';\n\t                    if (xhr.status == 401) {\n\t                        window.location = Galaxy.root + 'user/login?' + $.param({ redirect: Galaxy.root + '?tool_id=' + self.options.id });\n\t                    } else if (self.$el.is(':empty')) {\n\t                        self.$el.prepend(new Ui.Message({\n\t                            message: error_message,\n\t                            status: 'danger',\n\t                            persistent: true,\n\t                            large: true\n\t                        }).$el);\n\t                    } else {\n\t                        Galaxy.modal && Galaxy.modal.show({\n\t                            title: 'Tool request failed',\n\t                            body: error_message,\n\t                            buttons: {\n\t                                'Close': function Close() {\n\t                                    Galaxy.modal.hide();\n\t                                }\n\t                            }\n\t                        });\n\t                    }\n\t                    Galaxy.emit.debug('tool-form::initialize()', 'Initial tool model request failed.', response);\n\t                    process.reject();\n\t                }\n\t            });\n\t        },\n\t\n\t        /** Request a new model for an already created tool form and updates the form inputs\n\t        */\n\t        _updateModel: function _updateModel(process) {\n\t            // link this\n\t            var self = this;\n\t            var model_url = this.options.update_url || Galaxy.root + 'api/tools/' + this.options.id + '/build';\n\t            var current_state = {\n\t                tool_id: this.options.id,\n\t                tool_version: this.options.version,\n\t                inputs: $.extend(true, {}, self.data.create())\n\t            };\n\t            this.wait(true);\n\t\n\t            // log tool state\n\t            Galaxy.emit.debug('tool-form-base::_updateModel()', 'Sending current state.', current_state);\n\t\n\t            // post job\n\t            Utils.request({\n\t                type: 'POST',\n\t                url: model_url,\n\t                data: current_state,\n\t                success: function success(new_model) {\n\t                    self.update(new_model['tool_model'] || new_model);\n\t                    self.options.update && self.options.update(new_model);\n\t                    self.wait(false);\n\t                    Galaxy.emit.debug('tool-form-base::_updateModel()', 'Received new model.', new_model);\n\t                    process.resolve();\n\t                },\n\t                error: function error(response) {\n\t                    Galaxy.emit.debug('tool-form-base::_updateModel()', 'Refresh request failed.', response);\n\t                    process.reject();\n\t                }\n\t            });\n\t        },\n\t\n\t        /** Create tool operation menu\n\t        */\n\t        _operations: function _operations() {\n\t            var self = this;\n\t            var options = this.options;\n\t\n\t            // button for version selection\n\t            var versions_button = new Ui.ButtonMenu({\n\t                icon: 'fa-cubes',\n\t                title: !options.narrow && 'Versions' || null,\n\t                tooltip: 'Select another tool version'\n\t            });\n\t            if (!options.sustain_version && options.versions && options.versions.length > 1) {\n\t                for (var i in options.versions) {\n\t                    var version = options.versions[i];\n\t                    if (version != options.version) {\n\t                        versions_button.addMenu({\n\t                            title: 'Switch to ' + version,\n\t                            version: version,\n\t                            icon: 'fa-cube',\n\t                            onclick: function onclick() {\n\t                                // here we update the tool version (some tools encode the version also in the id)\n\t                                var id = options.id.replace(options.version, this.version);\n\t                                var version = this.version;\n\t                                // queue model request\n\t                                self.deferred.reset();\n\t                                self.deferred.execute(function (process) {\n\t                                    self._buildModel(process, { id: id, version: version });\n\t                                });\n\t                            }\n\t                        });\n\t                    }\n\t                }\n\t            } else {\n\t                versions_button.$el.hide();\n\t            }\n\t\n\t            // button for options e.g. search, help\n\t            var menu_button = new Ui.ButtonMenu({\n\t                icon: 'fa-caret-down',\n\t                title: !options.narrow && 'Options' || null,\n\t                tooltip: 'View available options'\n\t            });\n\t            if (options.biostar_url) {\n\t                menu_button.addMenu({\n\t                    icon: 'fa-question-circle',\n\t                    title: 'Question?',\n\t                    tooltip: 'Ask a question about this tool (Biostar)',\n\t                    onclick: function onclick() {\n\t                        window.open(options.biostar_url + '/p/new/post/');\n\t                    }\n\t                });\n\t                menu_button.addMenu({\n\t                    icon: 'fa-search',\n\t                    title: 'Search',\n\t                    tooltip: 'Search help for this tool (Biostar)',\n\t                    onclick: function onclick() {\n\t                        window.open(options.biostar_url + '/local/search/page/?q=' + options.name);\n\t                    }\n\t                });\n\t            };\n\t            menu_button.addMenu({\n\t                icon: 'fa-share',\n\t                title: 'Share',\n\t                tooltip: 'Share this tool',\n\t                onclick: function onclick() {\n\t                    prompt('Copy to clipboard: Ctrl+C, Enter', window.location.origin + Galaxy.root + 'root?tool_id=' + options.id);\n\t                }\n\t            });\n\t\n\t            // add admin operations\n\t            if (Galaxy.user && Galaxy.user.get('is_admin')) {\n\t                menu_button.addMenu({\n\t                    icon: 'fa-download',\n\t                    title: 'Download',\n\t                    tooltip: 'Download this tool',\n\t                    onclick: function onclick() {\n\t                        window.location.href = Galaxy.root + 'api/tools/' + options.id + '/download';\n\t                    }\n\t                });\n\t            }\n\t\n\t            // button for version selection\n\t            if (options.requirements && options.requirements.length > 0) {\n\t                menu_button.addMenu({\n\t                    icon: 'fa-info-circle',\n\t                    title: 'Requirements',\n\t                    tooltip: 'Display tool requirements',\n\t                    onclick: function onclick() {\n\t                        if (!this.visible || self.portlet.collapsed) {\n\t                            this.visible = true;\n\t                            self.portlet.expand();\n\t                            self.message.update({\n\t                                persistent: true,\n\t                                message: self._templateRequirements(options),\n\t                                status: 'info'\n\t                            });\n\t                        } else {\n\t                            this.visible = false;\n\t                            self.message.update({\n\t                                message: ''\n\t                            });\n\t                        }\n\t                    }\n\t                });\n\t            }\n\t\n\t            // add toolshed url\n\t            if (options.sharable_url) {\n\t                menu_button.addMenu({\n\t                    icon: 'fa-external-link',\n\t                    title: 'See in Tool Shed',\n\t                    tooltip: 'Access the repository',\n\t                    onclick: function onclick() {\n\t                        window.open(options.sharable_url);\n\t                    }\n\t                });\n\t            }\n\t\n\t            return {\n\t                menu: menu_button,\n\t                versions: versions_button\n\t            };\n\t        },\n\t\n\t        /** Create footer\n\t        */\n\t        _footer: function _footer() {\n\t            var options = this.options;\n\t            var $el = $('<div/>').append(this._templateHelp(options));\n\t            if (options.citations) {\n\t                var $citations = $('<div/>');\n\t                var citations = new CitationModel.ToolCitationCollection();\n\t                citations.tool_id = options.id;\n\t                var citation_list_view = new CitationView.CitationListView({ el: $citations, collection: citations });\n\t                citation_list_view.render();\n\t                citations.fetch();\n\t                $el.append($citations);\n\t            }\n\t            return $el;\n\t        },\n\t\n\t        /** Templates\n\t        */\n\t        _templateHelp: function _templateHelp(options) {\n\t            var $tmpl = $('<div/>').addClass('ui-form-help').append(options.help);\n\t            $tmpl.find('a').attr('target', '_blank');\n\t            return $tmpl;\n\t        },\n\t\n\t        _templateRequirements: function _templateRequirements(options) {\n\t            var nreq = options.requirements.length;\n\t            if (nreq > 0) {\n\t                var requirements_message = 'This tool requires ';\n\t                _.each(options.requirements, function (req, i) {\n\t                    requirements_message += req.name + (req.version ? ' (Version ' + req.version + ')' : '') + (i < nreq - 2 ? ', ' : i == nreq - 2 ? ' and ' : '');\n\t                });\n\t                var requirements_link = $('<a/>').attr('target', '_blank').attr('href', 'https://wiki.galaxyproject.org/Tools/Requirements').text('here');\n\t                return $('<span/>').append(requirements_message + '. Click ').append(requirements_link).append(' for more information.');\n\t            }\n\t            return 'No requirements found.';\n\t        }\n\t    });\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n/* 53 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $) {\"use strict\";\n\t\n\t/**\n\t * Model, view, and controller objects for Galaxy tools and tool panel.\n\t */\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(2), __webpack_require__(18), __webpack_require__(11), __webpack_require__(20)], __WEBPACK_AMD_DEFINE_RESULT__ = function (_, util, data, ToolForm) {\n\t    'use strict';\n\t\n\t    /**\n\t     * Mixin for tracking model visibility.\n\t     */\n\t\n\t    var VisibilityMixin = {\n\t        hidden: false,\n\t\n\t        show: function show() {\n\t            this.set(\"hidden\", false);\n\t        },\n\t\n\t        hide: function hide() {\n\t            this.set(\"hidden\", true);\n\t        },\n\t\n\t        toggle: function toggle() {\n\t            this.set(\"hidden\", !this.get(\"hidden\"));\n\t        },\n\t\n\t        is_visible: function is_visible() {\n\t            return !this.attributes.hidden;\n\t        }\n\t\n\t    };\n\t\n\t    /**\n\t     * A tool parameter.\n\t     */\n\t    var ToolParameter = Backbone.Model.extend({\n\t        defaults: {\n\t            name: null,\n\t            label: null,\n\t            type: null,\n\t            value: null,\n\t            html: null,\n\t            num_samples: 5\n\t        },\n\t\n\t        initialize: function initialize(options) {\n\t            this.attributes.html = unescape(this.attributes.html);\n\t        },\n\t\n\t        copy: function copy() {\n\t            return new ToolParameter(this.toJSON());\n\t        },\n\t\n\t        set_value: function set_value(value) {\n\t            this.set('value', value || '');\n\t        }\n\t    });\n\t\n\t    var ToolParameterCollection = Backbone.Collection.extend({\n\t        model: ToolParameter\n\t    });\n\t\n\t    /**\n\t     * A data tool parameter.\n\t     */\n\t    var DataToolParameter = ToolParameter.extend({});\n\t\n\t    /**\n\t     * An integer tool parameter.\n\t     */\n\t    var IntegerToolParameter = ToolParameter.extend({\n\t        set_value: function set_value(value) {\n\t            this.set('value', parseInt(value, 10));\n\t        },\n\t\n\t        /**\n\t         * Returns samples from a tool input.\n\t         */\n\t        get_samples: function get_samples() {\n\t            return d3.scale.linear().domain([this.get('min'), this.get('max')]).ticks(this.get('num_samples'));\n\t        }\n\t    });\n\t\n\t    var FloatToolParameter = IntegerToolParameter.extend({\n\t        set_value: function set_value(value) {\n\t            this.set('value', parseFloat(value));\n\t        }\n\t    });\n\t\n\t    /**\n\t     * A select tool parameter.\n\t     */\n\t    var SelectToolParameter = ToolParameter.extend({\n\t        /**\n\t         * Returns tool options.\n\t         */\n\t        get_samples: function get_samples() {\n\t            return _.map(this.get('options'), function (option) {\n\t                return option[0];\n\t            });\n\t        }\n\t    });\n\t\n\t    // Set up dictionary of parameter types.\n\t    ToolParameter.subModelTypes = {\n\t        'integer': IntegerToolParameter,\n\t        'float': FloatToolParameter,\n\t        'data': DataToolParameter,\n\t        'select': SelectToolParameter\n\t    };\n\t\n\t    /**\n\t     * A Galaxy tool.\n\t     */\n\t    var Tool = Backbone.Model.extend({\n\t        // Default attributes.\n\t        defaults: {\n\t            id: null,\n\t            name: null,\n\t            description: null,\n\t            target: null,\n\t            inputs: [],\n\t            outputs: []\n\t        },\n\t\n\t        urlRoot: Galaxy.root + 'api/tools',\n\t\n\t        initialize: function initialize(options) {\n\t\n\t            // Set parameters.\n\t            this.set('inputs', new ToolParameterCollection(_.map(options.inputs, function (p) {\n\t                var p_class = ToolParameter.subModelTypes[p.type] || ToolParameter;\n\t                return new p_class(p);\n\t            })));\n\t        },\n\t\n\t        /**\n\t         *\n\t         */\n\t        toJSON: function toJSON() {\n\t            var rval = Backbone.Model.prototype.toJSON.call(this);\n\t\n\t            // Convert inputs to JSON manually.\n\t            rval.inputs = this.get('inputs').map(function (i) {\n\t                return i.toJSON();\n\t            });\n\t            return rval;\n\t        },\n\t\n\t        /**\n\t         * Removes inputs of a particular type; this is useful because not all inputs can be handled by\n\t         * client and server yet.\n\t         */\n\t        remove_inputs: function remove_inputs(types) {\n\t            var tool = this,\n\t                incompatible_inputs = tool.get('inputs').filter(function (input) {\n\t                return types.indexOf(input.get('type')) !== -1;\n\t            });\n\t            tool.get('inputs').remove(incompatible_inputs);\n\t        },\n\t\n\t        /**\n\t         * Returns object copy, optionally including only inputs that can be sampled.\n\t         */\n\t        copy: function copy(only_samplable_inputs) {\n\t            var copy = new Tool(this.toJSON());\n\t\n\t            // Return only samplable inputs if flag is set.\n\t            if (only_samplable_inputs) {\n\t                var valid_inputs = new Backbone.Collection();\n\t                copy.get('inputs').each(function (input) {\n\t                    if (input.get_samples()) {\n\t                        valid_inputs.push(input);\n\t                    }\n\t                });\n\t                copy.set('inputs', valid_inputs);\n\t            }\n\t\n\t            return copy;\n\t        },\n\t\n\t        apply_search_results: function apply_search_results(results) {\n\t            _.indexOf(results, this.attributes.id) !== -1 ? this.show() : this.hide();\n\t            return this.is_visible();\n\t        },\n\t\n\t        /**\n\t         * Set a tool input's value.\n\t         */\n\t        set_input_value: function set_input_value(name, value) {\n\t            this.get('inputs').find(function (input) {\n\t                return input.get('name') === name;\n\t            }).set('value', value);\n\t        },\n\t\n\t        /**\n\t         * Set many input values at once.\n\t         */\n\t        set_input_values: function set_input_values(inputs_dict) {\n\t            var self = this;\n\t            _.each(_.keys(inputs_dict), function (input_name) {\n\t                self.set_input_value(input_name, inputs_dict[input_name]);\n\t            });\n\t        },\n\t\n\t        /**\n\t         * Run tool; returns a Deferred that resolves to the tool's output(s).\n\t         */\n\t        run: function run() {\n\t            return this._run();\n\t        },\n\t\n\t        /**\n\t         * Rerun tool using regions and a target dataset.\n\t         */\n\t        rerun: function rerun(target_dataset, regions) {\n\t            return this._run({\n\t                action: 'rerun',\n\t                target_dataset_id: target_dataset.id,\n\t                regions: regions\n\t            });\n\t        },\n\t\n\t        /**\n\t         * Returns input dict for tool's inputs.\n\t         */\n\t        get_inputs_dict: function get_inputs_dict() {\n\t            var input_dict = {};\n\t            this.get('inputs').each(function (input) {\n\t                input_dict[input.get('name')] = input.get('value');\n\t            });\n\t            return input_dict;\n\t        },\n\t\n\t        /**\n\t         * Run tool; returns a Deferred that resolves to the tool's output(s).\n\t         * NOTE: this method is a helper method and should not be called directly.\n\t         */\n\t        _run: function _run(additional_params) {\n\t            // Create payload.\n\t            var payload = _.extend({\n\t                tool_id: this.id,\n\t                inputs: this.get_inputs_dict()\n\t            }, additional_params);\n\t\n\t            // Because job may require indexing datasets, use server-side\n\t            // deferred to ensure that job is run. Also use deferred that\n\t            // resolves to outputs from tool.\n\t            var run_deferred = $.Deferred(),\n\t                ss_deferred = new util.ServerStateDeferred({\n\t                ajax_settings: {\n\t                    url: this.urlRoot,\n\t                    data: JSON.stringify(payload),\n\t                    dataType: \"json\",\n\t                    contentType: 'application/json',\n\t                    type: \"POST\"\n\t                },\n\t                interval: 2000,\n\t                success_fn: function success_fn(response) {\n\t                    return response !== \"pending\";\n\t                }\n\t            });\n\t\n\t            // Run job and resolve run_deferred to tool outputs.\n\t            $.when(ss_deferred.go()).then(function (result) {\n\t                run_deferred.resolve(new data.DatasetCollection(result));\n\t            });\n\t            return run_deferred;\n\t        }\n\t    });\n\t    _.extend(Tool.prototype, VisibilityMixin);\n\t\n\t    /**\n\t     * Tool view.\n\t     */\n\t    var ToolView = Backbone.View.extend({});\n\t\n\t    /**\n\t     * Wrap collection of tools for fast access/manipulation.\n\t     */\n\t    var ToolCollection = Backbone.Collection.extend({\n\t        model: Tool\n\t    });\n\t\n\t    /**\n\t     * Label or section header in tool panel.\n\t     */\n\t    var ToolSectionLabel = Backbone.Model.extend(VisibilityMixin);\n\t\n\t    /**\n\t     * Section of tool panel with elements (labels and tools).\n\t     */\n\t    var ToolSection = Backbone.Model.extend({\n\t        defaults: {\n\t            elems: [],\n\t            open: false\n\t        },\n\t\n\t        clear_search_results: function clear_search_results() {\n\t            _.each(this.attributes.elems, function (elt) {\n\t                elt.show();\n\t            });\n\t\n\t            this.show();\n\t            this.set(\"open\", false);\n\t        },\n\t\n\t        apply_search_results: function apply_search_results(results) {\n\t            var all_hidden = true,\n\t                cur_label;\n\t            _.each(this.attributes.elems, function (elt) {\n\t                if (elt instanceof ToolSectionLabel) {\n\t                    cur_label = elt;\n\t                    cur_label.hide();\n\t                } else if (elt instanceof Tool) {\n\t                    if (elt.apply_search_results(results)) {\n\t                        all_hidden = false;\n\t                        if (cur_label) {\n\t                            cur_label.show();\n\t                        }\n\t                    }\n\t                }\n\t            });\n\t\n\t            if (all_hidden) {\n\t                this.hide();\n\t            } else {\n\t                this.show();\n\t                this.set(\"open\", true);\n\t            }\n\t        }\n\t    });\n\t    _.extend(ToolSection.prototype, VisibilityMixin);\n\t\n\t    /**\n\t     * Tool search that updates results when query is changed. Result value of null\n\t     * indicates that query was not run; if not null, results are from search using\n\t     * query.\n\t     */\n\t    var ToolSearch = Backbone.Model.extend({\n\t        defaults: {\n\t            search_hint_string: \"search tools\",\n\t            min_chars_for_search: 3,\n\t            clear_btn_url: \"\",\n\t            search_url: \"\",\n\t            visible: true,\n\t            query: \"\",\n\t            results: null,\n\t            // ESC (27) will clear the input field and tool search filters\n\t            clear_key: 27\n\t        },\n\t\n\t        urlRoot: Galaxy.root + 'api/tools',\n\t\n\t        initialize: function initialize() {\n\t            this.on(\"change:query\", this.do_search);\n\t        },\n\t\n\t        /**\n\t         * Do the search and update the results.\n\t         */\n\t        do_search: function do_search() {\n\t            var query = this.attributes.query;\n\t\n\t            // If query is too short, do not search.\n\t            if (query.length < this.attributes.min_chars_for_search) {\n\t                this.set(\"results\", null);\n\t                return;\n\t            }\n\t\n\t            // Do search via AJAX.\n\t            var q = query;\n\t            // Stop previous ajax-request\n\t            if (this.timer) {\n\t                clearTimeout(this.timer);\n\t            }\n\t            // Start a new ajax-request in X ms\n\t            $(\"#search-clear-btn\").hide();\n\t            $(\"#search-spinner\").show();\n\t            var self = this;\n\t            this.timer = setTimeout(function () {\n\t                // log the search to analytics if present\n\t                if (typeof ga !== 'undefined') {\n\t                    ga('send', 'pageview', Galaxy.root + '?q=' + q);\n\t                }\n\t                $.get(self.urlRoot, { q: q }, function (data) {\n\t                    self.set(\"results\", data);\n\t                    $(\"#search-spinner\").hide();\n\t                    $(\"#search-clear-btn\").show();\n\t                }, \"json\");\n\t            }, 400);\n\t        },\n\t\n\t        clear_search: function clear_search() {\n\t            this.set(\"query\", \"\");\n\t            this.set(\"results\", null);\n\t        }\n\t\n\t    });\n\t    _.extend(ToolSearch.prototype, VisibilityMixin);\n\t\n\t    /**\n\t     * Tool Panel.\n\t     */\n\t    var ToolPanel = Backbone.Model.extend({\n\t\n\t        initialize: function initialize(options) {\n\t            this.attributes.tool_search = options.tool_search;\n\t            this.attributes.tool_search.on(\"change:results\", this.apply_search_results, this);\n\t            this.attributes.tools = options.tools;\n\t            this.attributes.layout = new Backbone.Collection(this.parse(options.layout));\n\t        },\n\t\n\t        /**\n\t         * Parse tool panel dictionary and return collection of tool panel elements.\n\t         */\n\t        parse: function parse(response) {\n\t            // Recursive function to parse tool panel elements.\n\t            var self = this,\n\t\n\t            // Helper to recursively parse tool panel.\n\t            parse_elt = function parse_elt(elt_dict) {\n\t                var type = elt_dict.model_class;\n\t                // There are many types of tools; for now, anything that ends in 'Tool'\n\t                // is treated as a generic tool.\n\t                if (type.indexOf('Tool') === type.length - 4) {\n\t                    return self.attributes.tools.get(elt_dict.id);\n\t                } else if (type === 'ToolSection') {\n\t                    // Parse elements.\n\t                    var elems = _.map(elt_dict.elems, parse_elt);\n\t                    elt_dict.elems = elems;\n\t                    return new ToolSection(elt_dict);\n\t                } else if (type === 'ToolSectionLabel') {\n\t                    return new ToolSectionLabel(elt_dict);\n\t                }\n\t            };\n\t\n\t            return _.map(response, parse_elt);\n\t        },\n\t\n\t        clear_search_results: function clear_search_results() {\n\t            this.get('layout').each(function (panel_elt) {\n\t                if (panel_elt instanceof ToolSection) {\n\t                    panel_elt.clear_search_results();\n\t                } else {\n\t                    // Label or tool, so just show.\n\t                    panel_elt.show();\n\t                }\n\t            });\n\t        },\n\t\n\t        apply_search_results: function apply_search_results() {\n\t            var results = this.get('tool_search').get('results');\n\t            if (results === null) {\n\t                this.clear_search_results();\n\t                return;\n\t            }\n\t\n\t            var cur_label = null;\n\t            this.get('layout').each(function (panel_elt) {\n\t                if (panel_elt instanceof ToolSectionLabel) {\n\t                    cur_label = panel_elt;\n\t                    cur_label.hide();\n\t                } else if (panel_elt instanceof Tool) {\n\t                    if (panel_elt.apply_search_results(results)) {\n\t                        if (cur_label) {\n\t                            cur_label.show();\n\t                        }\n\t                    }\n\t                } else {\n\t                    // Starting new section, so clear current label.\n\t                    cur_label = null;\n\t                    panel_elt.apply_search_results(results);\n\t                }\n\t            });\n\t        }\n\t    });\n\t\n\t    /**\n\t     * View classes for Galaxy tools and tool panel.\n\t     *\n\t     * Views use the templates defined below for rendering. Views update as needed\n\t     * based on (a) model/collection events and (b) user interactions; in this sense,\n\t     * they are controllers are well and the HTML is the real view in the MVC architecture.\n\t     */\n\t\n\t    /**\n\t     * Base view that handles visibility based on model's hidden attribute.\n\t     */\n\t    var BaseView = Backbone.View.extend({\n\t        initialize: function initialize() {\n\t            this.model.on(\"change:hidden\", this.update_visible, this);\n\t            this.update_visible();\n\t        },\n\t        update_visible: function update_visible() {\n\t            this.model.attributes.hidden ? this.$el.hide() : this.$el.show();\n\t        }\n\t    });\n\t\n\t    /**\n\t     * Link to a tool.\n\t     */\n\t    var ToolLinkView = BaseView.extend({\n\t        tagName: 'div',\n\t\n\t        render: function render() {\n\t            // create element\n\t            var $link = $('<div/>');\n\t            $link.append(templates.tool_link(this.model.toJSON()));\n\t\n\t            var formStyle = this.model.get('form_style', null);\n\t            // open upload dialog for upload tool\n\t            if (this.model.id === 'upload1') {\n\t                $link.find('a').on('click', function (e) {\n\t                    e.preventDefault();\n\t                    Galaxy.upload.show();\n\t                });\n\t            } else if (formStyle === 'regular') {\n\t                // regular tools\n\t                var self = this;\n\t                $link.find('a').on('click', function (e) {\n\t                    e.preventDefault();\n\t                    var form = new ToolForm.View({ id: self.model.id, version: self.model.get('version') });\n\t                    form.deferred.execute(function () {\n\t                        Galaxy.app.display(form);\n\t                    });\n\t                });\n\t            }\n\t\n\t            // add element\n\t            this.$el.append($link);\n\t            return this;\n\t        }\n\t    });\n\t\n\t    /**\n\t     * Panel label/section header.\n\t     */\n\t    var ToolSectionLabelView = BaseView.extend({\n\t        tagName: 'div',\n\t        className: 'toolPanelLabel',\n\t\n\t        render: function render() {\n\t            this.$el.append($(\"<span/>\").text(this.model.attributes.text));\n\t            return this;\n\t        }\n\t    });\n\t\n\t    /**\n\t     * Panel section.\n\t     */\n\t    var ToolSectionView = BaseView.extend({\n\t        tagName: 'div',\n\t        className: 'toolSectionWrapper',\n\t\n\t        initialize: function initialize() {\n\t            BaseView.prototype.initialize.call(this);\n\t            this.model.on(\"change:open\", this.update_open, this);\n\t        },\n\t\n\t        render: function render() {\n\t            // Build using template.\n\t            this.$el.append(templates.panel_section(this.model.toJSON()));\n\t\n\t            // Add tools to section.\n\t            var section_body = this.$el.find(\".toolSectionBody\");\n\t            _.each(this.model.attributes.elems, function (elt) {\n\t                if (elt instanceof Tool) {\n\t                    var tool_view = new ToolLinkView({ model: elt, className: \"toolTitle\" });\n\t                    tool_view.render();\n\t                    section_body.append(tool_view.$el);\n\t                } else if (elt instanceof ToolSectionLabel) {\n\t                    var label_view = new ToolSectionLabelView({ model: elt });\n\t                    label_view.render();\n\t                    section_body.append(label_view.$el);\n\t                } else {\n\t                    // TODO: handle nested section bodies?\n\t                }\n\t            });\n\t            return this;\n\t        },\n\t\n\t        events: {\n\t            'click .toolSectionTitle > a': 'toggle'\n\t        },\n\t\n\t        /**\n\t         * Toggle visibility of tool section.\n\t         */\n\t        toggle: function toggle() {\n\t            this.model.set(\"open\", !this.model.attributes.open);\n\t        },\n\t\n\t        /**\n\t         * Update whether section is open or close.\n\t         */\n\t        update_open: function update_open() {\n\t            this.model.attributes.open ? this.$el.children(\".toolSectionBody\").slideDown(\"fast\") : this.$el.children(\".toolSectionBody\").slideUp(\"fast\");\n\t        }\n\t    });\n\t\n\t    var ToolSearchView = Backbone.View.extend({\n\t        tagName: 'div',\n\t        id: 'tool-search',\n\t        className: 'bar',\n\t\n\t        events: {\n\t            'click': 'focus_and_select',\n\t            'keyup :input': 'query_changed',\n\t            'click #search-clear-btn': 'clear'\n\t        },\n\t\n\t        render: function render() {\n\t            this.$el.append(templates.tool_search(this.model.toJSON()));\n\t            if (!this.model.is_visible()) {\n\t                this.$el.hide();\n\t            }\n\t            this.$el.find('[title]').tooltip();\n\t            return this;\n\t        },\n\t\n\t        focus_and_select: function focus_and_select() {\n\t            this.$el.find(\":input\").focus().select();\n\t        },\n\t\n\t        clear: function clear() {\n\t            this.model.clear_search();\n\t            this.$el.find(\":input\").val('');\n\t            this.focus_and_select();\n\t            return false;\n\t        },\n\t\n\t        query_changed: function query_changed(evData) {\n\t            // check for the 'clear key' (ESC) first\n\t            if (this.model.attributes.clear_key && this.model.attributes.clear_key === evData.which) {\n\t                this.clear();\n\t                return false;\n\t            }\n\t            this.model.set(\"query\", this.$el.find(\":input\").val());\n\t        }\n\t    });\n\t\n\t    /**\n\t     * Tool panel view. Events triggered include:\n\t     * tool_link_click(click event, tool_model)\n\t     */\n\t    var ToolPanelView = Backbone.View.extend({\n\t        tagName: 'div',\n\t        className: 'toolMenu',\n\t\n\t        /**\n\t         * Set up view.\n\t         */\n\t        initialize: function initialize() {\n\t            this.model.get('tool_search').on(\"change:results\", this.handle_search_results, this);\n\t        },\n\t\n\t        render: function render() {\n\t            var self = this;\n\t\n\t            // Render search.\n\t            var search_view = new ToolSearchView({ model: this.model.get('tool_search') });\n\t            search_view.render();\n\t            self.$el.append(search_view.$el);\n\t\n\t            // Render panel.\n\t            this.model.get('layout').each(function (panel_elt) {\n\t                if (panel_elt instanceof ToolSection) {\n\t                    var section_title_view = new ToolSectionView({ model: panel_elt });\n\t                    section_title_view.render();\n\t                    self.$el.append(section_title_view.$el);\n\t                } else if (panel_elt instanceof Tool) {\n\t                    var tool_view = new ToolLinkView({ model: panel_elt, className: \"toolTitleNoSection\" });\n\t                    tool_view.render();\n\t                    self.$el.append(tool_view.$el);\n\t                } else if (panel_elt instanceof ToolSectionLabel) {\n\t                    var label_view = new ToolSectionLabelView({ model: panel_elt });\n\t                    label_view.render();\n\t                    self.$el.append(label_view.$el);\n\t                }\n\t            });\n\t\n\t            // Setup tool link click eventing.\n\t            self.$el.find(\"a.tool-link\").click(function (e) {\n\t                // Tool id is always the first class.\n\t                var tool_id = $(this).attr('class').split(/\\s+/)[0],\n\t                    tool = self.model.get('tools').get(tool_id);\n\t\n\t                self.trigger(\"tool_link_click\", e, tool);\n\t            });\n\t\n\t            return this;\n\t        },\n\t\n\t        handle_search_results: function handle_search_results() {\n\t            var results = this.model.get('tool_search').get('results');\n\t            if (results && results.length === 0) {\n\t                $(\"#search-no-results\").show();\n\t            } else {\n\t                $(\"#search-no-results\").hide();\n\t            }\n\t        }\n\t    });\n\t\n\t    /**\n\t     * View for working with a tool: setting parameters and inputs and executing the tool.\n\t     */\n\t    var ToolFormView = Backbone.View.extend({\n\t        className: 'toolForm',\n\t\n\t        render: function render() {\n\t            this.$el.children().remove();\n\t            this.$el.append(templates.tool_form(this.model.toJSON()));\n\t        }\n\t    });\n\t\n\t    /**\n\t     * Integrated tool menu + tool execution.\n\t     */\n\t    var IntegratedToolMenuAndView = Backbone.View.extend({\n\t        className: 'toolMenuAndView',\n\t\n\t        initialize: function initialize() {\n\t            this.tool_panel_view = new ToolPanelView({ collection: this.collection });\n\t            this.tool_form_view = new ToolFormView();\n\t        },\n\t\n\t        render: function render() {\n\t            // Render and append tool panel.\n\t            this.tool_panel_view.render();\n\t            this.tool_panel_view.$el.css(\"float\", \"left\");\n\t            this.$el.append(this.tool_panel_view.$el);\n\t\n\t            // Append tool form view.\n\t            this.tool_form_view.$el.hide();\n\t            this.$el.append(this.tool_form_view.$el);\n\t\n\t            // On tool link click, show tool.\n\t            var self = this;\n\t            this.tool_panel_view.on(\"tool_link_click\", function (e, tool) {\n\t                // Prevents click from activating link:\n\t                e.preventDefault();\n\t                // Show tool that was clicked on:\n\t                self.show_tool(tool);\n\t            });\n\t        },\n\t\n\t        /**\n\t         * Fetch and display tool.\n\t         */\n\t        show_tool: function show_tool(tool) {\n\t            var self = this;\n\t            tool.fetch().done(function () {\n\t                self.tool_form_view.model = tool;\n\t                self.tool_form_view.render();\n\t                self.tool_form_view.$el.show();\n\t                $('#left').width(\"650px\");\n\t            });\n\t        }\n\t    });\n\t\n\t    // TODO: move into relevant views\n\t    var templates = {\n\t        // the search bar at the top of the tool panel\n\t        tool_search: _.template(['<input id=\"tool-search-query\" class=\"search-query parent-width\" name=\"query\" ', 'placeholder=\"<%- search_hint_string %>\" autocomplete=\"off\" type=\"text\" />', '<a id=\"search-clear-btn\" title=\"clear search (esc)\"> </a>',\n\t        //TODO: replace with icon\n\t        '<span id=\"search-spinner\" class=\"search-spinner fa fa-spinner fa-spin\"></span>'].join('')),\n\t\n\t        // the category level container in the tool panel (e.g. 'Get Data', 'Text Manipulation')\n\t        panel_section: _.template(['<div class=\"toolSectionTitle\" id=\"title_<%- id %>\">', '<a href=\"javascript:void(0)\"><span><%- name %></span></a>', '</div>', '<div id=\"<%- id %>\" class=\"toolSectionBody\" style=\"display: none;\">', '<div class=\"toolSectionBg\"></div>', '<div>'].join('')),\n\t\n\t        // a single tool's link in the tool panel; will load the tool form in the center panel\n\t        tool_link: _.template(['<span class=\"labels\">', '<% _.each( labels, function( label ){ %>', '<span class=\"label label-default label-<%- label %>\">', '<%- label %>', '</span>', '<% }); %>', '</span>', '<a class=\"<%- id %> tool-link\" href=\"<%= link %>\" target=\"<%- target %>\" minsizehint=\"<%- min_width %>\">', '<%- name %>', '</a>', ' <%- description %>'].join('')),\n\t\n\t        // the tool form for entering tool parameters, viewing help and executing the tool\n\t        // loaded when a tool link is clicked in the tool panel\n\t        tool_form: _.template(['<div class=\"toolFormTitle\"><%- tool.name %> (version <%- tool.version %>)</div>', '<div class=\"toolFormBody\">', '<% _.each( tool.inputs, function( input ){ %>', '<div class=\"form-row\">', '<label for=\"<%- input.name %>\"><%- input.label %>:</label>', '<div class=\"form-row-input\">', '<%= input.html %>', '</div>', '<div class=\"toolParamHelp\" style=\"clear: both;\">', '<%- input.help %>', '</div>', '<div style=\"clear: both;\"></div>', '</div>', '<% }); %>', '</div>', '<div class=\"form-row form-actions\">', '<input type=\"submit\" class=\"btn btn-primary\" name=\"runtool_btn\" value=\"Execute\" />', '</div>', '<div class=\"toolHelp\">', '<div class=\"toolHelpBody\"><% tool.help %></div>', '</div>'].join(''), { variable: 'tool' })\n\t    };\n\t\n\t    // Exports\n\t    return {\n\t        ToolParameter: ToolParameter,\n\t        IntegerToolParameter: IntegerToolParameter,\n\t        SelectToolParameter: SelectToolParameter,\n\t        Tool: Tool,\n\t        ToolCollection: ToolCollection,\n\t        ToolSearch: ToolSearch,\n\t        ToolPanel: ToolPanel,\n\t        ToolPanelView: ToolPanelView,\n\t        ToolFormView: ToolFormView\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1)))\n\n/***/ },\n/* 54 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $, _, jQuery) {'use strict';\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    //jquery\n\t    //backbone\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t    // =============================================================================\n\t    /**\n\t     * view for a popup menu\n\t     */\n\t    var PopupMenu = Backbone.View.extend({\n\t        //TODO: maybe better as singleton off the Galaxy obj\n\t        /** Cache the desired button element and options, set up the button click handler\n\t         *  NOTE: attaches this view as HTML/jQ data on the button for later use.\n\t         */\n\t        initialize: function initialize($button, options) {\n\t            // default settings\n\t            this.$button = $button;\n\t            if (!this.$button.length) {\n\t                this.$button = $('<div/>');\n\t            }\n\t            this.options = options || [];\n\t            this.$button.data('popupmenu', this);\n\t\n\t            // set up button click -> open menu behavior\n\t            var menu = this;\n\t            this.$button.click(function (event) {\n\t                // if there's already a menu open, remove it\n\t                $('.popmenu-wrapper').remove();\n\t                menu._renderAndShow(event);\n\t                return false;\n\t            });\n\t        },\n\t\n\t        // render the menu, append to the page body at the click position, and set up the 'click-away' handlers, show\n\t        _renderAndShow: function _renderAndShow(clickEvent) {\n\t            this.render();\n\t            this.$el.appendTo('body').css(this._getShownPosition(clickEvent)).show();\n\t            this._setUpCloseBehavior();\n\t        },\n\t\n\t        // render the menu\n\t        // this menu doesn't attach itself to the DOM ( see _renderAndShow )\n\t        render: function render() {\n\t            // render the menu body absolute and hidden, fill with template\n\t            this.$el.addClass('popmenu-wrapper').hide().css({ position: 'absolute' }).html(this.template(this.$button.attr('id'), this.options));\n\t\n\t            // set up behavior on each link/anchor elem\n\t            if (this.options.length) {\n\t                var menu = this;\n\t                //precondition: there should be one option per li\n\t                this.$el.find('li').each(function (i, li) {\n\t                    var option = menu.options[i];\n\t\n\t                    // if the option has 'func', call that function when the anchor is clicked\n\t                    if (option.func) {\n\t                        $(this).children('a.popupmenu-option').click(function (event) {\n\t                            option.func.call(menu, event, option);\n\t                            // We must preventDefault otherwise clicking \"cancel\"\n\t                            // on a purge or something still navigates and causes\n\t                            // the action.\n\t                            event.preventDefault();\n\t                            // bubble up so that an option click will call the close behavior\n\t                        });\n\t                    }\n\t                });\n\t            }\n\t            return this;\n\t        },\n\t\n\t        template: function template(id, options) {\n\t            return ['<ul id=\"', id, '-menu\" class=\"dropdown-menu\">', this._templateOptions(options), '</ul>'].join('');\n\t        },\n\t\n\t        _templateOptions: function _templateOptions(options) {\n\t            if (!options.length) {\n\t                return '<li>(no options)</li>';\n\t            }\n\t            return _.map(options, function (option) {\n\t                if (option.divider) {\n\t                    return '<li class=\"divider\"></li>';\n\t                } else if (option.header) {\n\t                    return ['<li class=\"head\"><a href=\"javascript:void(0);\">', option.html, '</a></li>'].join('');\n\t                }\n\t                var href = option.href || 'javascript:void(0);',\n\t                    target = option.target ? ' target=\"' + option.target + '\"' : '',\n\t                    check = option.checked ? '<span class=\"fa fa-check\"></span>' : '';\n\t                return ['<li><a class=\"popupmenu-option\" href=\"', href, '\"', target, '>', check, option.html, '</a></li>'].join('');\n\t            }).join('');\n\t        },\n\t\n\t        // get the absolute position/offset for the menu\n\t        _getShownPosition: function _getShownPosition(clickEvent) {\n\t\n\t            // display menu horiz. centered on click...\n\t            var menuWidth = this.$el.width();\n\t            var x = clickEvent.pageX - menuWidth / 2;\n\t\n\t            // adjust to handle horiz. scroll and window dimensions ( draw entirely on visible screen area )\n\t            x = Math.min(x, $(document).scrollLeft() + $(window).width() - menuWidth - 5);\n\t            x = Math.max(x, $(document).scrollLeft() + 5);\n\t            return {\n\t                top: clickEvent.pageY,\n\t                left: x\n\t            };\n\t        },\n\t\n\t        // bind an event handler to all available frames so that when anything is clicked\n\t        // the menu is removed from the DOM and the event handler unbinds itself\n\t        _setUpCloseBehavior: function _setUpCloseBehavior() {\n\t            var menu = this;\n\t            //TODO: alternately: focus hack, blocking overlay, jquery.blockui\n\t\n\t            // function to close popup and unbind itself\n\t            function closePopup(event) {\n\t                $(document).off('click.close_popup');\n\t                if (window && window.parent !== window) {\n\t                    try {\n\t                        $(window.parent.document).off(\"click.close_popup\");\n\t                    } catch (err) {}\n\t                } else {\n\t                    try {\n\t                        $('iframe#galaxy_main').contents().off(\"click.close_popup\");\n\t                    } catch (err) {}\n\t                }\n\t                menu.remove();\n\t            }\n\t\n\t            $('html').one(\"click.close_popup\", closePopup);\n\t            if (window && window.parent !== window) {\n\t                try {\n\t                    $(window.parent.document).find('html').one(\"click.close_popup\", closePopup);\n\t                } catch (err) {}\n\t            } else {\n\t                try {\n\t                    $('iframe#galaxy_main').contents().one(\"click.close_popup\", closePopup);\n\t                } catch (err) {}\n\t            }\n\t        },\n\t\n\t        // add a menu option/item at the given index\n\t        addItem: function addItem(item, index) {\n\t            // append to end if no index\n\t            index = index >= 0 ? index : this.options.length;\n\t            this.options.splice(index, 0, item);\n\t            return this;\n\t        },\n\t\n\t        // remove a menu option/item at the given index\n\t        removeItem: function removeItem(index) {\n\t            if (index >= 0) {\n\t                this.options.splice(index, 1);\n\t            }\n\t            return this;\n\t        },\n\t\n\t        // search for a menu option by its html\n\t        findIndexByHtml: function findIndexByHtml(html) {\n\t            for (var i = 0; i < this.options.length; i++) {\n\t                if (_.has(this.options[i], 'html') && this.options[i].html === html) {\n\t                    return i;\n\t                }\n\t            }\n\t            return null;\n\t        },\n\t\n\t        // search for a menu option by its html\n\t        findItemByHtml: function findItemByHtml(html) {\n\t            return this.options[this.findIndexByHtml(html)];\n\t        },\n\t\n\t        // string representation\n\t        toString: function toString() {\n\t            return 'PopupMenu';\n\t        }\n\t    });\n\t    /** shortcut to new for when you don't need to preserve the ref */\n\t    PopupMenu.create = function _create($button, options) {\n\t        return new PopupMenu($button, options);\n\t    };\n\t\n\t    // -----------------------------------------------------------------------------\n\t    // the following class functions are bridges from the original make_popupmenu and make_popup_menus\n\t    // to the newer backbone.js PopupMenu\n\t\n\t    /** Create a PopupMenu from simple map initial_options activated by clicking button_element.\n\t     *      Converts initial_options to object array used by PopupMenu.\n\t     *  @param {jQuery|DOMElement} button_element element which, when clicked, activates menu\n\t     *  @param {Object} initial_options map of key -> values, where\n\t     *      key is option text, value is fn to call when option is clicked\n\t     *  @returns {PopupMenu} the PopupMenu created\n\t     */\n\t    PopupMenu.make_popupmenu = function (button_element, initial_options) {\n\t        var convertedOptions = [];\n\t        _.each(initial_options, function (optionVal, optionKey) {\n\t            var newOption = { html: optionKey };\n\t\n\t            // keys with null values indicate: header\n\t            if (optionVal === null) {\n\t                // !optionVal? (null only?)\n\t                newOption.header = true;\n\t\n\t                // keys with function values indicate: a menu option\n\t            } else if (jQuery.type(optionVal) === 'function') {\n\t                newOption.func = optionVal;\n\t            }\n\t            //TODO:?? any other special optionVals?\n\t            // there was no divider option originally\n\t            convertedOptions.push(newOption);\n\t        });\n\t        return new PopupMenu($(button_element), convertedOptions);\n\t    };\n\t\n\t    /** Find all anchors in $parent (using selector) and covert anchors into a PopupMenu options map.\n\t     *  @param {jQuery} $parent the element that contains the links to convert to options\n\t     *  @param {String} selector jq selector string to find links\n\t     *  @returns {Object[]} the options array to initialize a PopupMenu\n\t     */\n\t    //TODO: lose parent and selector, pass in array of links, use map to return options\n\t    PopupMenu.convertLinksToOptions = function ($parent, selector) {\n\t        $parent = $($parent);\n\t        selector = selector || 'a';\n\t        var options = [];\n\t        $parent.find(selector).each(function (elem, i) {\n\t            var option = {},\n\t                $link = $(elem);\n\t\n\t            // convert link text to the option text (html) and the href into the option func\n\t            option.html = $link.text();\n\t            if ($link.attr('href')) {\n\t                var linkHref = $link.attr('href'),\n\t                    linkTarget = $link.attr('target'),\n\t                    confirmText = $link.attr('confirm');\n\t\n\t                option.func = function () {\n\t                    // if there's a \"confirm\" attribute, throw up a confirmation dialog, and\n\t                    //  if the user cancels - do nothing\n\t                    if (confirmText && !confirm(confirmText)) {\n\t                        return;\n\t                    }\n\t\n\t                    // if there's no confirm attribute, or the user accepted the confirm dialog:\n\t                    switch (linkTarget) {\n\t                        // relocate the center panel\n\t                        case '_parent':\n\t                            window.parent.location = linkHref;\n\t                            break;\n\t\n\t                        // relocate the entire window\n\t                        case '_top':\n\t                            window.top.location = linkHref;\n\t                            break;\n\t\n\t                        // relocate this panel\n\t                        default:\n\t                            window.location = linkHref;\n\t                    }\n\t                };\n\t            }\n\t            options.push(option);\n\t        });\n\t        return options;\n\t    };\n\t\n\t    /** Create a single popupmenu from existing DOM button and anchor elements\n\t     *  @param {jQuery} $buttonElement the element that when clicked will open the menu\n\t     *  @param {jQuery} $menuElement the element that contains the anchors to convert into a menu\n\t     *  @param {String} menuElementLinkSelector jq selector string used to find anchors to be made into menu options\n\t     *  @returns {PopupMenu} the PopupMenu (Backbone View) that can render, control the menu\n\t     */\n\t    PopupMenu.fromExistingDom = function ($buttonElement, $menuElement, menuElementLinkSelector) {\n\t        $buttonElement = $($buttonElement);\n\t        $menuElement = $($menuElement);\n\t        var options = PopupMenu.convertLinksToOptions($menuElement, menuElementLinkSelector);\n\t        // we're done with the menu (having converted it to an options map)\n\t        $menuElement.remove();\n\t        return new PopupMenu($buttonElement, options);\n\t    };\n\t\n\t    /** Create all popupmenus within a document or a more specific element\n\t     *  @param {DOMElement} parent the DOM element in which to search for popupmenus to build (defaults to document)\n\t     *  @param {String} menuSelector jq selector string to find popupmenu menu elements (defaults to \"div[popupmenu]\")\n\t     *  @param {Function} buttonSelectorBuildFn the function to build the jq button selector.\n\t     *      Will be passed $menuElement, parent.\n\t     *      (Defaults to return '#' + $menuElement.attr( 'popupmenu' ); )\n\t     *  @returns {PopupMenu[]} array of popupmenus created\n\t     */\n\t    PopupMenu.make_popup_menus = function (parent, menuSelector, buttonSelectorBuildFn) {\n\t        parent = parent || document;\n\t        // orig. Glx popupmenu menus have a (non-std) attribute 'popupmenu'\n\t        //  which contains the id of the button that activates the menu\n\t        menuSelector = menuSelector || 'div[popupmenu]';\n\t        // default to (orig. Glx) matching button to menu by using the popupmenu attr of the menu as the id of the button\n\t        buttonSelectorBuildFn = buttonSelectorBuildFn || function ($menuElement, parent) {\n\t            return '#' + $menuElement.attr('popupmenu');\n\t        };\n\t\n\t        // aggregate and return all PopupMenus\n\t        var popupMenusCreated = [];\n\t        $(parent).find(menuSelector).each(function () {\n\t            var $menuElement = $(this),\n\t                $buttonElement = $(parent).find(buttonSelectorBuildFn($menuElement, parent));\n\t            popupMenusCreated.push(PopupMenu.fromDom($buttonElement, $menuElement));\n\t            $buttonElement.addClass('popup');\n\t        });\n\t        return popupMenusCreated;\n\t    };\n\t\n\t    // =============================================================================\n\t    return PopupMenu;\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 55 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $) {'use strict';\n\t\n\t/** Renders the color picker used e.g. in the tool form **/\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils) {\n\t    return Backbone.View.extend({\n\t        colors: {\n\t            standard: ['c00000', 'ff0000', 'ffc000', 'ffff00', '92d050', '00b050', '00b0f0', '0070c0', '002060', '7030a0'],\n\t            base: ['ffffff', '000000', 'eeece1', '1f497d', '4f81bd', 'c0504d', '9bbb59', '8064a2', '4bacc6', 'f79646'],\n\t            theme: [['f2f2f2', '7f7f7f', 'ddd9c3', 'c6d9f0', 'dbe5f1', 'f2dcdb', 'ebf1dd', 'e5e0ec', 'dbeef3', 'fdeada'], ['d8d8d8', '595959', 'c4bd97', '8db3e2', 'b8cce4', 'e5b9b7', 'd7e3bc', 'ccc1d9', 'b7dde8', 'fbd5b5'], ['bfbfbf', '3f3f3f', '938953', '548dd4', '95b3d7', 'd99694', 'c3d69b', 'b2a2c7', '92cddc', 'fac08f'], ['a5a5a5', '262626', '494429', '17365d', '366092', '953734', '76923c', '5f497a', '31859b', 'e36c09'], ['7f7f7e', '0c0c0c', '1d1b10', '0f243e', '244061', '632423', '4f6128', '3f3151', '205867', '974806']]\n\t        },\n\t        initialize: function initialize(options) {\n\t            this.options = Utils.merge(options, {});\n\t            this.setElement(this._template());\n\t\n\t            // link components\n\t            this.$panel = this.$('.ui-color-picker-panel');\n\t            this.$view = this.$('.ui-color-picker-view');\n\t            this.$value = this.$('.ui-color-picker-value');\n\t            this.$header = this.$('.ui-color-picker-header');\n\t\n\t            // build panel\n\t            this._build();\n\t\n\t            // hide panel on start up\n\t            this.visible = false;\n\t\n\t            // set initial value\n\t            this.value(this.options.value);\n\t\n\t            // link boxes\n\t            this.$boxes = this.$('.ui-color-picker-box');\n\t\n\t            // add event handler\n\t            var self = this;\n\t            this.$boxes.on('click', function () {\n\t                self.value($(this).css('background-color'));\n\t                self.$header.trigger('click');\n\t            });\n\t            this.$header.on('click', function () {\n\t                self.visible = !self.visible;\n\t                if (self.visible) {\n\t                    self.$view.fadeIn('fast');\n\t                } else {\n\t                    self.$view.fadeOut('fast');\n\t                }\n\t            });\n\t        },\n\t\n\t        // value\n\t        value: function value(new_val) {\n\t            if (new_val !== undefined && new_val !== null) {\n\t                // update color value\n\t                this.$value.css('background-color', new_val);\n\t\n\t                // check selected color in panel\n\t                this.$('.ui-color-picker-box').empty();\n\t                this.$(this._getValue()).html(this._templateCheck());\n\t\n\t                // trigger custom event\n\t                this.options.onchange && this.options.onchange(new_val);\n\t            }\n\t\n\t            // return current value\n\t            return this._getValue();\n\t        },\n\t\n\t        // get value from dom\n\t        _getValue: function _getValue() {\n\t            var rgb = this.$value.css('background-color');\n\t            rgb = rgb.match(/^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$/);\n\t            if (rgb) {\n\t                var hex = function hex(x) {\n\t                    return ('0' + parseInt(x).toString(16)).slice(-2);\n\t                };\n\t\n\t                return '#' + hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]);\n\t            } else {\n\t                return null;\n\t            }\n\t        },\n\t\n\t        // build panel\n\t        _build: function _build() {\n\t            var $content = this._content({\n\t                label: 'Theme Colors',\n\t                colors: this.colors.base,\n\t                padding: 10\n\t            });\n\t            for (var i in this.colors.theme) {\n\t                var line_def = {};\n\t                if (i == 0) {\n\t                    line_def['bottom'] = true;\n\t                } else {\n\t                    if (i != this.colors.theme.length - 1) {\n\t                        line_def['top'] = true;\n\t                        line_def['bottom'] = true;\n\t                    } else {\n\t                        line_def['top'] = true;\n\t                        line_def['padding'] = 5;\n\t                    }\n\t                }\n\t                line_def['colors'] = this.colors.theme[i];\n\t                this._content(line_def);\n\t            }\n\t            this._content({\n\t                label: 'Standard Colors',\n\t                colors: this.colors.standard,\n\t                padding: 5\n\t            });\n\t        },\n\t\n\t        // create content\n\t        _content: function _content(options) {\n\t            // get parameters\n\t            var label = options.label;\n\t            var colors = options.colors;\n\t            var padding = options.padding;\n\t            var top = options.top;\n\t            var bottom = options.bottom;\n\t\n\t            // create lines\n\t            var $content = $(this._templateContent());\n\t\n\t            // set label\n\t            var $label = $content.find('.label');\n\t            if (options.label) {\n\t                $label.html(options.label);\n\t            } else {\n\t                $label.hide();\n\t            }\n\t\n\t            // build line\n\t            var $line = $content.find('.line');\n\t            this.$panel.append($content);\n\t            for (var i in colors) {\n\t                var $box = $(this._templateBox(colors[i]));\n\t                if (top) {\n\t                    $box.css('border-top', 'none');\n\t                    $box.css('border-top-left-radius', '0px');\n\t                    $box.css('border-top-right-radius', '0px');\n\t                }\n\t                if (bottom) {\n\t                    $box.css('border-bottom', 'none');\n\t                    $box.css('border-bottom-left-radius', '0px');\n\t                    $box.css('border-bottom-right-radius', '0px');\n\t                }\n\t                $line.append($box);\n\t            }\n\t            if (padding) {\n\t                $line.css('padding-bottom', padding);\n\t            }\n\t            return $content;\n\t        },\n\t\n\t        // check icon\n\t        _templateCheck: function _templateCheck() {\n\t            return '<div class=\"ui-color-picker-check fa fa-check\"/>';\n\t        },\n\t\n\t        // content template\n\t        _templateContent: function _templateContent() {\n\t            return '<div class=\"ui-color-picker-content\">' + '<div class=\"label\"/>' + '<div class=\"line\"/>' + '</div>';\n\t        },\n\t\n\t        // box template\n\t        _templateBox: function _templateBox(color) {\n\t            return '<div id=\"' + color + '\" class=\"ui-color-picker-box\" style=\"background-color: #' + color + ';\"/>';\n\t        },\n\t\n\t        // template\n\t        _template: function _template() {\n\t            return '<div class=\"ui-color-picker\">' + '<div class=\"ui-color-picker-header\">' + '<div class=\"ui-color-picker-value\"/>' + '<div class=\"ui-color-picker-label\">Select a color</div>' + '</div>' + '<div class=\"ui-color-picker-view ui-input\">' + '<div class=\"ui-color-picker-panel\"/>' + '</div>';\n\t            '</div>';\n\t        }\n\t    });\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1)))\n\n/***/ },\n/* 56 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function($, _) {'use strict';\n\t\n\t/** This class creates/wraps a drill down element. */\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(22)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, Options) {\n\t\n\t    var View = Options.BaseIcons.extend({\n\t        initialize: function initialize(options) {\n\t            options.type = options.display || 'checkbox';\n\t            options.multiple = options.type == 'checkbox';\n\t            Options.BaseIcons.prototype.initialize.call(this, options);\n\t        },\n\t\n\t        /** Set states for selected values */\n\t        _setValue: function _setValue(new_value) {\n\t            Options.BaseIcons.prototype._setValue.call(this, new_value);\n\t            if (new_value !== undefined && new_value !== null && this.header_index) {\n\t                var self = this;\n\t                var values = $.isArray(new_value) ? new_value : [new_value];\n\t                _.each(values, function (v) {\n\t                    var list = self.header_index[v];\n\t                    _.each(list, function (element) {\n\t                        self._setState(element, true);\n\t                    });\n\t                });\n\t            }\n\t        },\n\t\n\t        /** Expand/collapse a sub group */\n\t        _setState: function _setState(header_id, is_expanded) {\n\t            var $button = this.$('.button-' + header_id);\n\t            var $subgroup = this.$('.subgroup-' + header_id);\n\t            $button.data('is_expanded', is_expanded);\n\t            if (is_expanded) {\n\t                $subgroup.show();\n\t                $button.removeClass('fa-plus-square').addClass('fa-minus-square');\n\t            } else {\n\t                $subgroup.hide();\n\t                $button.removeClass('fa-minus-square').addClass('fa-plus-square');\n\t            }\n\t        },\n\t\n\t        /** Template to create options tree */\n\t        _templateOptions: function _templateOptions() {\n\t            var self = this;\n\t            this.header_index = {};\n\t\n\t            // attach event handler\n\t            function attach($el, header_id) {\n\t                var $button = $el.find('.button-' + header_id);\n\t                $button.on('click', function () {\n\t                    self._setState(header_id, !$button.data('is_expanded'));\n\t                });\n\t            }\n\t\n\t            // recursive function which iterates through options\n\t            function iterate($tmpl, options, header) {\n\t                header = header || [];\n\t                for (i in options) {\n\t                    var level = options[i];\n\t                    var has_options = level.options && level.options.length > 0;\n\t                    var new_header = header.slice(0);\n\t                    self.header_index[level.value] = new_header.slice(0);\n\t                    var $group = $('<div/>');\n\t                    if (has_options) {\n\t                        var header_id = Utils.uid();\n\t                        var $button = $('<span/>').addClass('button-' + header_id).addClass('ui-drilldown-button fa fa-plus-square');\n\t                        var $subgroup = $('<div/>').addClass('subgroup-' + header_id).addClass('ui-drilldown-subgroup');\n\t                        $group.append($('<div/>').append($button).append(self._templateOption({ label: level.name, value: level.value })));\n\t                        new_header.push(header_id);\n\t                        iterate($subgroup, level.options, new_header);\n\t                        $group.append($subgroup);\n\t                        attach($group, header_id);\n\t                    } else {\n\t                        $group.append(self._templateOption({ label: level.name, value: level.value }));\n\t                    }\n\t                    $tmpl.append($group);\n\t                }\n\t            }\n\t\n\t            // iterate through options and create dom\n\t            var $tmpl = $('<div/>');\n\t            iterate($tmpl, this.model.get('data'));\n\t            return $tmpl;\n\t        },\n\t\n\t        /** Template for drill down view */\n\t        _template: function _template() {\n\t            return $('<div/>').addClass('ui-options-list drilldown-container').attr('id', this.model.id);\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n/* 57 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {'use strict';\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(7), __webpack_require__(23)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, Ui, Select) {\n\t\n\t    /** Batch mode variations */\n\t    var Batch = { DISABLED: 'disabled', ENABLED: 'enabled', LINKED: 'linked' };\n\t\n\t    /** List of available content selectors options */\n\t    var Configurations = {\n\t        data: [{ src: 'hda', icon: 'fa-file-o', tooltip: 'Single dataset', multiple: false, batch: Batch.DISABLED }, { src: 'hda', icon: 'fa-files-o', tooltip: 'Multiple datasets', multiple: true, batch: Batch.LINKED }, { src: 'hdca', icon: 'fa-folder-o', tooltip: 'Dataset collection', multiple: false, batch: Batch.LINKED }],\n\t        data_multiple: [{ src: 'hda', icon: 'fa-files-o', tooltip: 'Multiple datasets', multiple: true, batch: Batch.DISABLED }, { src: 'hdca', icon: 'fa-folder-o', tooltip: 'Dataset collection', multiple: false, batch: Batch.DISABLED }],\n\t        data_collection: [{ src: 'hdca', icon: 'fa-folder-o', tooltip: 'Dataset collection', multiple: false, batch: Batch.DISABLED }],\n\t        workflow_data: [{ src: 'hda', icon: 'fa-file-o', tooltip: 'Single dataset', multiple: false, batch: Batch.DISABLED }],\n\t        workflow_data_multiple: [{ src: 'hda', icon: 'fa-files-o', tooltip: 'Multiple datasets', multiple: true, batch: Batch.DISABLED }],\n\t        workflow_data_collection: [{ src: 'hdca', icon: 'fa-folder-o', tooltip: 'Dataset collection', multiple: false, batch: Batch.DISABLED }],\n\t        module_data: [{ src: 'hda', icon: 'fa-file-o', tooltip: 'Single dataset', multiple: false, batch: Batch.DISABLED }, { src: 'hda', icon: 'fa-files-o', tooltip: 'Multiple datasets', multiple: true, batch: Batch.ENABLED }],\n\t        module_data_collection: [{ src: 'hdca', icon: 'fa-folder-o', tooltip: 'Dataset collection', multiple: false, batch: Batch.DISABLED }, { src: 'hdca', icon: 'fa-folder', tooltip: 'Multiple collections', multiple: true, batch: Batch.ENABLED }]\n\t    };\n\t\n\t    /** View for hda and hdca content selector ui elements */\n\t    var View = Backbone.View.extend({\n\t        initialize: function initialize(options) {\n\t            var self = this;\n\t            this.model = options && options.model || new Backbone.Model({\n\t                src_labels: { 'hda': 'dataset', 'hdca': 'dataset collection' }\n\t            }).set(options);\n\t            this.setElement($('<div/>').addClass('ui-select-content'));\n\t            this.button_product = new Ui.RadioButton.View({\n\t                value: 'false',\n\t                data: [{ icon: 'fa fa-chain', value: 'false',\n\t                    tooltip: 'Linked inputs will be run in matched order with other datasets e.g. use this for matching forward and reverse reads.' }, { icon: 'fa fa-chain-broken', value: 'true',\n\t                    tooltip: 'Unlinked dataset inputs will be run against *all* other inputs.' }] });\n\t            var $batch_div = $('<div/>').addClass('ui-form-info').append($('<i/>').addClass('fa fa-sitemap')).append($('<span/>').html('This is a batch mode input field. Separate jobs will be triggered for each dataset selection.'));\n\t            this.$batch = {\n\t                linked: $batch_div.clone(),\n\t                enabled: $batch_div.clone().append($('<div/>').append($('<div/>').addClass('ui-form-title').html('Batch options:')).append(this.button_product.$el)).append($('<div/>').css('clear', 'both'))\n\t            };\n\t\n\t            // track current history elements\n\t            this.history = {};\n\t\n\t            // add listeners\n\t            this.listenTo(this.model, 'change:data', this._changeData, this);\n\t            this.listenTo(this.model, 'change:wait', this._changeWait, this);\n\t            this.listenTo(this.model, 'change:current', this._changeCurrent, this);\n\t            this.listenTo(this.model, 'change:value', this._changeValue, this);\n\t            this.listenTo(this.model, 'change:type change:optional change:multiple change:extensions', this._changeType, this);\n\t            this.render();\n\t\n\t            // add change event\n\t            this.on('change', function () {\n\t                options.onchange && options.onchange(self.value());\n\t            });\n\t        },\n\t\n\t        render: function render() {\n\t            this._changeType();\n\t            this._changeValue();\n\t            this._changeWait();\n\t        },\n\t\n\t        /** Indicate that select fields are being updated */\n\t        wait: function wait() {\n\t            this.model.set('wait', true);\n\t        },\n\t\n\t        /** Indicate that the options update has been completed */\n\t        unwait: function unwait() {\n\t            this.model.set('wait', false);\n\t        },\n\t\n\t        /** Update data representing selectable options */\n\t        update: function update(options) {\n\t            this.model.set('data', options);\n\t        },\n\t\n\t        /** Return the currently selected dataset values */\n\t        value: function value(new_value) {\n\t            new_value !== undefined && this.model.set('value', new_value);\n\t            var current = this.model.get('current');\n\t            if (this.config[current]) {\n\t                var id_list = this.fields[current].value();\n\t                if (id_list !== null) {\n\t                    id_list = $.isArray(id_list) ? id_list : [id_list];\n\t                    if (id_list.length > 0) {\n\t                        var result = this._batch({ values: [] });\n\t                        for (var i in id_list) {\n\t                            var details = this.history[id_list[i] + '_' + this.config[current].src];\n\t                            if (details) {\n\t                                result.values.push(details);\n\t                            } else {\n\t                                Galaxy.emit.debug('ui-select-content::value()', 'Requested details not found for \\'' + id_list[i] + '\\'.');\n\t                                return null;\n\t                            }\n\t                        }\n\t                        result.values.sort(function (a, b) {\n\t                            return a.hid - b.hid;\n\t                        });\n\t                        return result;\n\t                    }\n\t                }\n\t            } else {\n\t                Galaxy.emit.debug('ui-select-content::value()', 'Invalid value/source \\'' + new_value + '\\'.');\n\t            }\n\t            return null;\n\t        },\n\t\n\t        /** Change of current select field */\n\t        _changeCurrent: function _changeCurrent() {\n\t            var self = this;\n\t            _.each(this.fields, function (field, i) {\n\t                if (self.model.get('current') == i) {\n\t                    field.$el.show();\n\t                    _.each(self.$batch, function ($batchfield, batchmode) {\n\t                        $batchfield[self.config[i].batch == batchmode ? 'show' : 'hide']();\n\t                    });\n\t                    self.button_type.value(i);\n\t                } else {\n\t                    field.$el.hide();\n\t                }\n\t            });\n\t        },\n\t\n\t        /** Change of type */\n\t        _changeType: function _changeType() {\n\t            var self = this;\n\t\n\t            // identify selector type identifier i.e. [ flavor ]_[ type ]_[ multiple ]\n\t            var config_id = (this.model.get('flavor') ? this.model.get('flavor') + '_' : '') + String(this.model.get('type')) + (this.model.get('multiple') ? '_multiple' : '');\n\t            if (Configurations[config_id]) {\n\t                this.config = Configurations[config_id];\n\t            } else {\n\t                this.config = Configurations['data'];\n\t                Galaxy.emit.debug('ui-select-content::_changeType()', 'Invalid configuration/type id \\'' + config_id + '\\'.');\n\t            }\n\t\n\t            // prepare extension component of error message\n\t            var extensions = Utils.textify(this.model.get('extensions'));\n\t            var src_labels = this.model.get('src_labels');\n\t\n\t            // build views\n\t            this.fields = [];\n\t            this.button_data = [];\n\t            _.each(this.config, function (c, i) {\n\t                self.button_data.push({\n\t                    value: i,\n\t                    icon: c.icon,\n\t                    tooltip: c.tooltip\n\t                });\n\t                self.fields.push(new Select.View({\n\t                    optional: self.model.get('optional'),\n\t                    multiple: c.multiple,\n\t                    searchable: !c.multiple,\n\t                    error_text: 'No ' + (extensions ? extensions + ' ' : '') + (src_labels[c.src] || 'content') + ' available.',\n\t                    onchange: function onchange() {\n\t                        self.trigger('change');\n\t                    }\n\t                }));\n\t            });\n\t            this.button_type = new Ui.RadioButton.View({\n\t                value: this.model.get('current'),\n\t                data: this.button_data,\n\t                onchange: function onchange(value) {\n\t                    self.model.set('current', value);\n\t                    self.trigger('change');\n\t                }\n\t            });\n\t\n\t            // append views\n\t            this.$el.empty();\n\t            var button_width = 0;\n\t            if (this.fields.length > 1) {\n\t                this.$el.append(this.button_type.$el);\n\t                button_width = Math.max(0, this.fields.length * 35) + 'px';\n\t            }\n\t            _.each(this.fields, function (field) {\n\t                self.$el.append(field.$el.css({ 'margin-left': button_width }));\n\t            });\n\t            _.each(this.$batch, function ($batchfield, batchmode) {\n\t                self.$el.append($batchfield.css({ 'margin-left': button_width }));\n\t            });\n\t            this.model.set('current', 0);\n\t            this._changeCurrent();\n\t            this._changeData();\n\t        },\n\t\n\t        /** Change of wait flag */\n\t        _changeWait: function _changeWait() {\n\t            var self = this;\n\t            _.each(this.fields, function (field) {\n\t                field[self.model.get('wait') ? 'wait' : 'unwait']();\n\t            });\n\t        },\n\t\n\t        /** Change of available options */\n\t        _changeData: function _changeData() {\n\t            var options = this.model.get('data');\n\t            var self = this;\n\t            var select_options = {};\n\t            _.each(options, function (items, src) {\n\t                select_options[src] = [];\n\t                _.each(items, function (item) {\n\t                    select_options[src].push({\n\t                        hid: item.hid,\n\t                        label: item.hid + ': ' + item.name,\n\t                        value: item.id\n\t                    });\n\t                    self.history[item.id + '_' + src] = item;\n\t                });\n\t            });\n\t            _.each(this.config, function (c, i) {\n\t                select_options[c.src] && self.fields[i].add(select_options[c.src], function (a, b) {\n\t                    return b.hid - a.hid;\n\t                });\n\t            });\n\t        },\n\t\n\t        /** Change of incoming value */\n\t        _changeValue: function _changeValue() {\n\t            var new_value = this.model.get('value');\n\t            if (new_value && new_value.values && new_value.values.length > 0) {\n\t                // create list with content ids\n\t                var list = [];\n\t                _.each(new_value.values, function (value) {\n\t                    list.push(value.id);\n\t                });\n\t                // sniff first suitable field type from config list\n\t                var src = new_value.values[0].src;\n\t                var multiple = new_value.values.length > 1;\n\t                for (var i = 0; i < this.config.length; i++) {\n\t                    var field = this.fields[i];\n\t                    var c = this.config[i];\n\t                    if (c.src == src && [multiple, true].indexOf(c.multiple) !== -1) {\n\t                        this.model.set('current', i);\n\t                        field.value(list);\n\t                        break;\n\t                    }\n\t                }\n\t            } else {\n\t                _.each(this.fields, function (field) {\n\t                    field.value(null);\n\t                });\n\t            }\n\t        },\n\t\n\t        /** Assists in identifying the batch mode */\n\t        _batch: function _batch(result) {\n\t            result['batch'] = false;\n\t            var current = this.model.get('current');\n\t            var config = this.config[current];\n\t            if (config.src == 'hdca' && !config.multiple) {\n\t                var hdca = this.history[this.fields[current].value() + '_hdca'];\n\t                if (hdca && hdca.map_over_type) {\n\t                    result['batch'] = true;\n\t                }\n\t            }\n\t            if (config.batch == Batch.LINKED || config.batch == Batch.ENABLED) {\n\t                result['batch'] = true;\n\t                if (config.batch == Batch.ENABLED && this.button_product.value() === 'true') {\n\t                    result['product'] = true;\n\t                }\n\t            }\n\t            return result;\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n/* 58 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone) {'use strict';\n\t\n\t// dependencies\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(21)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, List) {\n\t\n\t    /**\n\t     * FTP file selector\n\t     */\n\t    var View = Backbone.View.extend({\n\t        // initialize\n\t        initialize: function initialize(options) {\n\t            // link this\n\t            var self = this;\n\t\n\t            // create ui-list view to keep track of selected ftp files\n\t            this.ftpfile_list = new List.View({\n\t                name: 'file',\n\t                optional: options.optional,\n\t                multiple: options.multiple,\n\t                onchange: function onchange() {\n\t                    options.onchange && options.onchange(self.value());\n\t                }\n\t            });\n\t\n\t            // create elements\n\t            this.setElement(this.ftpfile_list.$el);\n\t\n\t            // initial fetch of ftps\n\t            Utils.get({\n\t                url: Galaxy.root + 'api/remote_files',\n\t                success: function success(response) {\n\t                    var data = [];\n\t                    for (var i in response) {\n\t                        data.push({\n\t                            value: response[i]['path'],\n\t                            label: response[i]['path']\n\t                        });\n\t                    }\n\t                    self.ftpfile_list.update(data);\n\t                }\n\t            });\n\t        },\n\t\n\t        /** Return/Set currently selected ftp datasets */\n\t        value: function value(val) {\n\t            return this.ftpfile_list.value(val);\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3)))\n\n/***/ },\n/* 59 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone) {'use strict';\n\t\n\t// dependencies\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(7), __webpack_require__(14), __webpack_require__(21)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, Ui, Table, List) {\n\t\n\t    // collection of libraries\n\t    var Libraries = Backbone.Collection.extend({\n\t        url: Galaxy.root + 'api/libraries?deleted=false'\n\t    });\n\t\n\t    // collection of dataset\n\t    var LibraryDatasets = Backbone.Collection.extend({\n\t        initialize: function initialize() {\n\t            var self = this;\n\t            this.config = new Backbone.Model({ library_id: null });\n\t            this.config.on('change', function () {\n\t                self.fetch({ reset: true });\n\t            });\n\t        },\n\t        url: function url() {\n\t            return Galaxy.root + 'api/libraries/' + this.config.get('library_id') + '/contents';\n\t        }\n\t    });\n\t\n\t    // hda/hdca content selector ui element\n\t    var View = Backbone.View.extend({\n\t        // initialize\n\t        initialize: function initialize(options) {\n\t            // link this\n\t            var self = this;\n\t\n\t            // collections\n\t            this.libraries = new Libraries();\n\t            this.datasets = new LibraryDatasets();\n\t\n\t            // link app and options\n\t            this.options = options;\n\t\n\t            // select field for the library\n\t            // TODO: Remove this once the library API supports searching for library datasets\n\t            this.library_select = new Ui.Select.View({\n\t                onchange: function onchange(value) {\n\t                    self.datasets.config.set('library_id', value);\n\t                }\n\t            });\n\t\n\t            // create ui-list view to keep track of selected data libraries\n\t            this.dataset_list = new List.View({\n\t                name: 'dataset',\n\t                optional: options.optional,\n\t                multiple: options.multiple,\n\t                onchange: function onchange() {\n\t                    self.trigger('change');\n\t                }\n\t            });\n\t\n\t            // add reset handler for fetched libraries\n\t            this.libraries.on('reset', function () {\n\t                var data = [];\n\t                self.libraries.each(function (model) {\n\t                    data.push({\n\t                        value: model.id,\n\t                        label: model.get('name')\n\t                    });\n\t                });\n\t                self.library_select.update(data);\n\t            });\n\t\n\t            // add reset handler for fetched library datasets\n\t            this.datasets.on('reset', function () {\n\t                var data = [];\n\t                var library_current = self.library_select.text();\n\t                if (library_current !== null) {\n\t                    self.datasets.each(function (model) {\n\t                        if (model.get('type') === 'file') {\n\t                            data.push({\n\t                                value: model.id,\n\t                                label: model.get('name')\n\t                            });\n\t                        }\n\t                    });\n\t                }\n\t                self.dataset_list.update(data);\n\t            });\n\t\n\t            // add change event. fires on trigger\n\t            this.on('change', function () {\n\t                options.onchange && options.onchange(self.value());\n\t            });\n\t\n\t            // create elements\n\t            this.setElement(this._template());\n\t            this.$('.library-select').append(this.library_select.$el);\n\t            this.$el.append(this.dataset_list.$el);\n\t\n\t            // initial fetch of libraries\n\t            this.libraries.fetch({\n\t                reset: true,\n\t                success: function success() {\n\t                    self.library_select.trigger('change');\n\t                    if (self.options.value !== undefined) {\n\t                        self.value(self.options.value);\n\t                    }\n\t                }\n\t            });\n\t        },\n\t\n\t        /** Return/Set currently selected library datasets */\n\t        value: function value(val) {\n\t            return this.dataset_list.value(val);\n\t        },\n\t\n\t        /** Template */\n\t        _template: function _template() {\n\t            return '<div class=\"ui-select-library\">' + '<div class=\"library ui-margin-bottom\">' + '<span class=\"library-title\">Select Library</span>' + '<span class=\"library-select\"/>' + '</div>' + '</div>';\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3)))\n\n/***/ },\n/* 60 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $) {'use strict';\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils) {\n\t    var View = Backbone.View.extend({\n\t        initialize: function initialize(options) {\n\t            var self = this;\n\t            this.options = Utils.merge(options, {\n\t                id: Utils.uid(),\n\t                min: null,\n\t                max: null,\n\t                step: null,\n\t                precise: false,\n\t                split: 10000\n\t            });\n\t\n\t            // create new element\n\t            this.setElement(this._template(this.options));\n\t\n\t            // determine wether to use the slider\n\t            this.useslider = this.options.max !== null && this.options.min !== null && this.options.max > this.options.min;\n\t\n\t            // set default step size\n\t            if (this.options.step === null) {\n\t                this.options.step = 1.0;\n\t                if (this.options.precise && this.useslider) {\n\t                    this.options.step = (this.options.max - this.options.min) / this.options.split;\n\t                }\n\t            }\n\t\n\t            // create slider if min and max are defined properly\n\t            if (this.useslider) {\n\t                this.$slider = this.$('#slider');\n\t                this.$slider.slider(this.options);\n\t                this.$slider.on('slide', function (event, ui) {\n\t                    self.value(ui.value);\n\t                });\n\t            } else {\n\t                this.$('.ui-form-slider-text').css('width', '100%');\n\t            }\n\t\n\t            // link text input field\n\t            this.$text = this.$('#text');\n\t\n\t            // set initial value\n\t            this.options.value !== undefined && this.value(this.options.value);\n\t\n\t            // add text field event\n\t            var pressed = [];\n\t            this.$text.on('change', function () {\n\t                self.value($(this).val());\n\t            });\n\t            this.$text.on('keyup', function (e) {\n\t                pressed[e.which] = false;\n\t                self.options.onchange && self.options.onchange($(this).val());\n\t            });\n\t            this.$text.on('keydown', function (e) {\n\t                var v = e.which;\n\t                pressed[v] = true;\n\t                if (self.options.is_workflow && pressed[16] && v == 52) {\n\t                    self.value('$');\n\t                    event.preventDefault();\n\t                } else if (!(v == 8 || v == 9 || v == 13 || v == 37 || v == 39 || v >= 48 && v <= 57 && !pressed[16] || v >= 96 && v <= 105 || (v == 190 || v == 110) && $(this).val().indexOf('.') == -1 && self.options.precise || (v == 189 || v == 109) && $(this).val().indexOf('-') == -1 || self._isParameter($(this).val()) || pressed[91] || pressed[17])) {\n\t                    event.preventDefault();\n\t                }\n\t            });\n\t        },\n\t\n\t        /** Set and Return the current value\n\t        */\n\t        value: function value(new_val) {\n\t            if (new_val !== undefined) {\n\t                if (new_val !== null && new_val !== '' && !this._isParameter(new_val)) {\n\t                    isNaN(new_val) && (new_val = 0);\n\t                    this.options.max !== null && (new_val = Math.min(new_val, this.options.max));\n\t                    this.options.min !== null && (new_val = Math.max(new_val, this.options.min));\n\t                }\n\t                this.$slider && this.$slider.slider('value', new_val);\n\t                this.$text.val(new_val);\n\t                this.options.onchange && this.options.onchange(new_val);\n\t            }\n\t            return this.$text.val();\n\t        },\n\t\n\t        /** Return true if the field contains a workflow parameter i.e. $('name')\n\t        */\n\t        _isParameter: function _isParameter(value) {\n\t            return this.options.is_workflow && String(value).substring(0, 1) === '$';\n\t        },\n\t\n\t        /** Slider template\n\t        */\n\t        _template: function _template(options) {\n\t            return '<div id=\"' + options.id + '\" class=\"ui-form-slider\">' + '<input id=\"text\" type=\"text\" class=\"ui-form-slider-text\"/>' + '<div id=\"slider\" class=\"ui-form-slider-element\"/>' + '</div>';\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1)))\n\n/***/ },\n/* 61 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone) {'use strict';\n\t\n\t// dependencies\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t\n\t    // model\n\t    var Model = Backbone.Model.extend({\n\t        defaults: {\n\t            extension: 'auto',\n\t            genome: '?',\n\t            url_paste: '',\n\t            status: 'init',\n\t            info: null,\n\t            file_name: '',\n\t            file_mode: '',\n\t            file_size: 0,\n\t            file_type: null,\n\t            file_path: '',\n\t            file_data: null,\n\t            percentage: 0,\n\t            space_to_tab: false,\n\t            to_posix_lines: true,\n\t            enabled: true\n\t        },\n\t        reset: function reset(attr) {\n\t            this.clear().set(this.defaults).set(attr);\n\t        }\n\t    });\n\t\n\t    // collection\n\t    var Collection = Backbone.Collection.extend({\n\t        model: Model\n\t    });\n\t\n\t    // return\n\t    return {\n\t        Model: Model,\n\t        Collection: Collection\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3)))\n\n/***/ },\n/* 62 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (baseMVC, _l) {\n\t    'use strict';\n\t\n\t    var logNamespace = 'user';\n\t    //==============================================================================\n\t    /** @class View to display a user's disk/storage usage\n\t     *      either as a progress bar representing the percentage of a quota used\n\t     *      or a simple text element displaying the human readable size used.\n\t     *  @name UserQuotaMeter\n\t     *  @augments Backbone.View\n\t     */\n\t    var UserQuotaMeter = Backbone.View.extend(baseMVC.LoggableMixin).extend(\n\t    /** @lends UserQuotaMeter.prototype */{\n\t        _logNamespace: logNamespace,\n\t\n\t        /** Defaults for optional settings passed to initialize */\n\t        options: {\n\t            warnAtPercent: 85,\n\t            errorAtPercent: 100\n\t        },\n\t\n\t        /** Set up, accept options, and bind events */\n\t        initialize: function initialize(options) {\n\t            this.log(this + '.initialize:', options);\n\t            _.extend(this.options, options);\n\t\n\t            //this.bind( 'all', function( event, data ){ this.log( this + ' event:', event, data ); }, this );\n\t            this.listenTo(this.model, 'change:quota_percent change:total_disk_usage', this.render);\n\t        },\n\t\n\t        /** Re-load user model data from the api */\n\t        update: function update(options) {\n\t            this.log(this + ' updating user data...', options);\n\t            this.model.loadFromApi(this.model.get('id'), options);\n\t            return this;\n\t        },\n\t\n\t        /** Is the user over their quota (if there is one)?\n\t         * @returns {Boolean} true if over quota, false if no quota or under quota\n\t         */\n\t        isOverQuota: function isOverQuota() {\n\t            return this.model.get('quota_percent') !== null && this.model.get('quota_percent') >= this.options.errorAtPercent;\n\t        },\n\t\n\t        /** Render the meter when they have an applicable quota. Will render as a progress bar\n\t         *      with their percentage of that quota in text over the bar.\n\t         *  @fires quota:over when user is over quota (>= this.errorAtPercent)\n\t         *  @fires quota:under when user is under quota\n\t         *  @fires quota:under:approaching when user is >= this.warnAtPercent of their quota\n\t         *  @fires quota:under:ok when user is below this.warnAtPercent\n\t         *  @returns {jQuery} the rendered meter\n\t         */\n\t        _render_quota: function _render_quota() {\n\t            var modelJson = this.model.toJSON(),\n\t\n\t            //prevPercent = this.model.previous( 'quota_percent' ),\n\t            percent = modelJson.quota_percent,\n\t\n\t            //meter = $( UserQuotaMeter.templates.quota( modelJson ) );\n\t            $meter = $(this._templateQuotaMeter(modelJson)),\n\t                $bar = $meter.find('.progress-bar');\n\t            //this.log( this + '.rendering quota, percent:', percent, 'meter:', meter );\n\t\n\t            // OVER QUOTA: color the quota bar and show the quota error message\n\t            if (this.isOverQuota()) {\n\t                //this.log( '\\t over quota' );\n\t                $bar.attr('class', 'progress-bar progress-bar-danger');\n\t                $meter.find('.quota-meter-text').css('color', 'white');\n\t                //TODO: only trigger event if state has changed\n\t                this.trigger('quota:over', modelJson);\n\t\n\t                // APPROACHING QUOTA: color the quota bar\n\t            } else if (percent >= this.options.warnAtPercent) {\n\t                //this.log( '\\t approaching quota' );\n\t                $bar.attr('class', 'progress-bar progress-bar-warning');\n\t                //TODO: only trigger event if state has changed\n\t                this.trigger('quota:under quota:under:approaching', modelJson);\n\t\n\t                // otherwise, hide/don't use the msg box\n\t            } else {\n\t                $bar.attr('class', 'progress-bar progress-bar-success');\n\t                //TODO: only trigger event if state has changed\n\t                this.trigger('quota:under quota:under:ok', modelJson);\n\t            }\n\t            return $meter;\n\t        },\n\t\n\t        /** Render the meter when the user has NO applicable quota. Will render as text\n\t         *      showing the human readable sum storage their data is using.\n\t         *  @returns {jQuery} the rendered text\n\t         */\n\t        _render_usage: function _render_usage() {\n\t            //var usage = $( UserQuotaMeter.templates.usage( this.model.toJSON() ) );\n\t            var usage = $(this._templateUsage(this.model.toJSON()));\n\t            this.log(this + '.rendering usage:', usage);\n\t            return usage;\n\t        },\n\t\n\t        /** Render either the quota percentage meter or the human readable disk usage\n\t         *      depending on whether the user model has quota info (quota_percent === null -> no quota)\n\t         *  @returns {Object} this UserQuotaMeter\n\t         */\n\t        render: function render() {\n\t            //this.log( this + '.rendering' );\n\t            var meterHtml = null;\n\t\n\t            // no quota on server ('quota_percent' === null (can be valid at 0)), show usage instead\n\t            this.log(this + '.model.quota_percent:', this.model.get('quota_percent'));\n\t            if (this.model.get('quota_percent') === null || this.model.get('quota_percent') === undefined) {\n\t                meterHtml = this._render_usage();\n\t\n\t                // otherwise, render percent of quota (and warning, error)\n\t            } else {\n\t                meterHtml = this._render_quota();\n\t                //TODO: add the original text for unregistered quotas\n\t                //tooltip = \"Your disk quota is %s.  You can increase your quota by registering a Galaxy account.\"\n\t            }\n\t\n\t            this.$el.html(meterHtml);\n\t            this.$el.find('.quota-meter-text').tooltip();\n\t            return this;\n\t        },\n\t\n\t        _templateQuotaMeter: function _templateQuotaMeter(data) {\n\t            return ['<div id=\"quota-meter\" class=\"quota-meter progress\">', '<div class=\"progress-bar\" style=\"width: ', data.quota_percent, '%\"></div>', '<div class=\"quota-meter-text\" style=\"top: 6px\"', data.nice_total_disk_usage ? ' title=\"Using ' + data.nice_total_disk_usage + '\">' : '>', _l('Using'), ' ', data.quota_percent, '%', '</div>', '</div>'].join('');\n\t        },\n\t\n\t        _templateUsage: function _templateUsage(data) {\n\t            return ['<div id=\"quota-meter\" class=\"quota-meter\" style=\"background-color: transparent\">', '<div class=\"quota-meter-text\" style=\"top: 6px; color: white\">', data.nice_total_disk_usage ? _l('Using ') + data.nice_total_disk_usage : '', '</div>', '</div>'].join('');\n\t        },\n\t\n\t        toString: function toString() {\n\t            return 'UserQuotaMeter(' + this.model + ')';\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    return {\n\t        UserQuotaMeter: UserQuotaMeter\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 63 */,\n/* 64 */,\n/* 65 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $) {'use strict';\n\t\n\t/**\n\t *  This class defines a queue to ensure that multiple deferred callbacks are executed sequentially.\n\t */\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils) {\n\t    return Backbone.Model.extend({\n\t        initialize: function initialize() {\n\t            this.active = {};\n\t            this.last = null;\n\t        },\n\t\n\t        /** Adds a callback to the queue. Upon execution a deferred object is parsed to the callback i.e. callback( deferred ).\n\t         *  If the callback does not take any arguments, the deferred is resolved instantly.\n\t        */\n\t        execute: function execute(callback) {\n\t            var self = this;\n\t            var id = Utils.uid();\n\t            var has_deferred = callback.length > 0;\n\t\n\t            // register process\n\t            this.active[id] = true;\n\t\n\t            // deferred process\n\t            var process = $.Deferred();\n\t            process.promise().always(function () {\n\t                delete self.active[id];\n\t                has_deferred && Galaxy.emit.debug('deferred::execute()', this.state().charAt(0).toUpperCase() + this.state().slice(1) + ' ' + id);\n\t            });\n\t\n\t            // deferred queue\n\t            $.when(this.last).always(function () {\n\t                if (self.active[id]) {\n\t                    has_deferred && Galaxy.emit.debug('deferred::execute()', 'Running ' + id);\n\t                    callback(process);\n\t                    !has_deferred && process.resolve();\n\t                } else {\n\t                    process.reject();\n\t                }\n\t            });\n\t            this.last = process.promise();\n\t        },\n\t\n\t        /** Resets the promise queue. All currently queued but unexecuted callbacks/promises will be rejected.\n\t        */\n\t        reset: function reset() {\n\t            Galaxy.emit.debug('deferred::execute()', 'Reset');\n\t            for (var i in this.active) {\n\t                this.active[i] = false;\n\t            }\n\t        },\n\t\n\t        /** Returns true if all processes are done.\n\t        */\n\t        ready: function ready() {\n\t            return $.isEmptyObject(this.active);\n\t        }\n\t    });\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1)))\n\n/***/ },\n/* 66 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(jQuery) {'use strict';\n\t\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t    /*global window, jQuery, console */\n\t    /*=============================================================================\n\t    TODO:\n\t        while anon: logs saved to 'logs-null' - this will never post\n\t            unless we manually do so at/after login\n\t            OR prepend when userId and localStorage has 'logs-null'\n\t        wire up _delayPost and test\n\t    \n\t    =============================================================================*/\n\t    /** @class MetricsLogger\n\t     *\n\t     *  Object to cache, output, and post log/metric messages to the server.\n\t     *  Meant to be attached to the Galaxy object.\n\t     *\n\t     *  Log from objects by either attaching logger directly:\n\t     *      panel.logger.metric( 'user dataset deletion', panel.user.id, hda.toJSON() )\n\t     *  or using the LoggableMixin or addLogging function:\n\t     *      MyBackboneModel.extend( LoggableMixin ).extend({ ... })\n\t     *      addLogging( MyBackboneModel, 'my-backbone-model' )\n\t     *\n\t     *  Log from templates by calling directly from Galaxy object:\n\t     *      Galaxy.logger.metric( 'template loaded', { ownedByUser : true });\n\t     *\n\t     *  If you attempt to log an un-serializable object (circular reference, window, etc.),\n\t     *  that entry will not be cached (or sent). If you set consoleLevel and consoleLogger\n\t     *  appropriately, a warning will be shown when this happens:\n\t     *      > panel.metric( 'something weird with window', { window : window })\n\t     *      !'Metrics logger could not stringify logArguments: ...'\n\t     */\n\t    function MetricsLogger(options) {\n\t        options = options || {};\n\t        var self = this;\n\t\n\t        ///** get the current user's id from bootstrapped data or options */\n\t        self.userId = window.bootstrapped && window.bootstrapped.user ? window.bootstrapped.user.id : null;\n\t        self.userId = self.userId || options.userId || null;\n\t\n\t        /** the (optional) console to emit logs to */\n\t        self.consoleLogger = options.consoleLogger || null;\n\t\n\t        self._init(options);\n\t        return self;\n\t    }\n\t\n\t    //----------------------------------------------------------------------------- defaults and constants\n\t    // see: python std lib, logging\n\t    MetricsLogger.ALL = 0;\n\t    MetricsLogger.LOG = 0;\n\t    MetricsLogger.DEBUG = 10;\n\t    MetricsLogger.INFO = 20;\n\t    MetricsLogger.WARN = 30;\n\t    MetricsLogger.ERROR = 40;\n\t    // metrics levels here?\n\t    //MetricsLogger.MinorEvent  = 45;\n\t    //MetricsLogger.MajorEvent  = 50;\n\t    MetricsLogger.METRIC = 50;\n\t    MetricsLogger.NONE = 100;\n\t\n\t    /** default options - override these through the constructor */\n\t    MetricsLogger.defaultOptions = {\n\t        /** if an incoming message has a level >= this, it will be cached - can also be a string (e.g. 'debug') */\n\t        logLevel: MetricsLogger.NONE,\n\t        /** if an incoming message has a level >= this, it will be output to the console */\n\t        consoleLevel: MetricsLogger.NONE,\n\t        /** the default 'namespace' or label associated with an incoming message (if none is passed) */\n\t        defaultNamespace: 'Galaxy',\n\t        /** the namespaces output to the console (all namespaces will be output if this is falsy)\n\t         *  note: applies only to the console (not the event/metrics log/cache)\n\t         */\n\t        consoleNamespaceWhitelist: null,\n\t        /** the prefix attached to client-side logs to distinguish them in the metrics db */\n\t        clientPrefix: 'client.',\n\t\n\t        /** the maximum number of messages the cache should hold; if exceeded older messages are removed first */\n\t        maxCacheSize: 3000,\n\t        /** the number of messages accumulate before posting to the server; should be <= maxCacheSize */\n\t        postSize: 1000,\n\t        /** T/F whether to add a timestamp to incoming cached messages */\n\t        addTime: true,\n\t        /** string to prefix to userid for cache web storage */\n\t        cacheKeyPrefix: 'logs-',\n\t\n\t        /** the relative url to post messages to */\n\t        postUrl: '/api/metrics',\n\t        /** delay before trying post again after two failures */\n\t        delayPostInMs: 1000 * 60 * 10,\n\t\n\t        /** an (optional) function that should return an object; used to send additional data with the metrics */\n\t        getPingData: undefined,\n\t        /** an (optional) function that will handle the servers response after successfully posting messages */\n\t        onServerResponse: undefined\n\t    };\n\t\n\t    //----------------------------------------------------------------------------- set up\n\t    /** initialize the logger with options, set up instance vars and cache, and add onpageunload to window */\n\t    MetricsLogger.prototype._init = function _init(options) {\n\t        var self = this;\n\t        self.options = {};\n\t        for (var k in MetricsLogger.defaultOptions) {\n\t            if (MetricsLogger.defaultOptions.hasOwnProperty(k)) {\n\t                self.options[k] = options.hasOwnProperty(k) ? options[k] : MetricsLogger.defaultOptions[k];\n\t            }\n\t        }\n\t        self.options.logLevel = self._parseLevel(self.options.logLevel);\n\t        self.options.consoleLevel = self._parseLevel(self.options.consoleLevel);\n\t        //self._emitToConsole( 'debug', 'MetricsLogger', 'MetricsLogger.options:', self.options );\n\t\n\t        /** is the logger currently sending? */\n\t        self._sending = false;\n\t        /** the setTimeout id if the logger POST has failed more than once */\n\t        self._waiting = null;\n\t        /** the current number of entries to send in a POST */\n\t        self._postSize = self.options.postSize;\n\t\n\t        self._initCache();\n\t\n\t        return self;\n\t    };\n\t\n\t    /** initialize the cache */\n\t    MetricsLogger.prototype._initCache = function _initCache() {\n\t        try {\n\t            this.cache = new LoggingCache({\n\t                maxSize: this.options.maxCacheSize,\n\t                key: this.options.cacheKeyPrefix + this.userId\n\t            });\n\t        } catch (err) {\n\t            this._emitToConsole('warn', 'MetricsLogger', ['Could not intitialize logging cache:', err]);\n\t            this.options.logLevel = MetricsLogger.NONE;\n\t        }\n\t    };\n\t\n\t    /** return the numeric log level if level in 'none, debug, log, info, warn, error' */\n\t    MetricsLogger.prototype._parseLevel = function _parseLevel(level) {\n\t        var type = typeof level === 'undefined' ? 'undefined' : _typeof(level);\n\t        if (type === 'number') {\n\t            return level;\n\t        }\n\t        if (type === 'string') {\n\t            var upper = level.toUpperCase();\n\t            if (MetricsLogger.hasOwnProperty(upper)) {\n\t                return MetricsLogger[upper];\n\t            }\n\t        }\n\t        throw new Error('Unknown log level: ' + level);\n\t    };\n\t\n\t    //----------------------------------------------------------------------------- main entry point\n\t    /** record a log/message's arguments to the cache and/or the console based on level and namespace */\n\t    MetricsLogger.prototype.emit = function emit(level, namespace, logArguments) {\n\t        //this._emitToConsole( 'debug', 'MetricsLogger', [ 'emit:', level, namespace, logArguments ]);\n\t        var self = this;\n\t        namespace = namespace || self.options.defaultNamespace;\n\t        if (!level || !logArguments) {\n\t            return self;\n\t        }\n\t        // add to cache if proper level\n\t        //TODO: respect do not track?\n\t        //if( !navigator.doNotTrack && level >= self.options.logLevel ){\n\t        level = self._parseLevel(level);\n\t        if (level >= self.options.logLevel) {\n\t            self._addToCache(level, namespace, logArguments);\n\t        }\n\t        // also emit to consoleLogger if proper level for that\n\t        if (self.consoleLogger && level >= self.options.consoleLevel) {\n\t            self._emitToConsole(level, namespace, logArguments);\n\t        }\n\t        return self;\n\t    };\n\t\n\t    //----------------------------------------------------------------------------- cache\n\t    /** add a message to the cache and if messages.length is high enough post them to the server */\n\t    MetricsLogger.prototype._addToCache = function _addToCache(level, namespace, logArguments) {\n\t        this._emitToConsole('debug', 'MetricsLogger', ['_addToCache:', arguments, this.options.addTime, this.cache.length()]);\n\t        //this._emitToConsole( 'debug', 'MetricsLogger', [ '\\t logArguments:', logArguments ]);\n\t        var self = this;\n\t        // try add to the cache and if we've got _postSize number of entries, attempt to post them to the server\n\t        try {\n\t            var newLength = self.cache.add(self._buildEntry(level, namespace, logArguments));\n\t            if (newLength >= self._postSize) {\n\t                self._postCache();\n\t            }\n\t            // discard entry if an error occurs, but warn if level set to do so\n\t        } catch (err) {\n\t            self._emitToConsole('warn', 'MetricsLogger', ['Metrics logger could not stringify logArguments:', namespace, logArguments]);\n\t            self._emitToConsole('error', 'MetricsLogger', [err]);\n\t        }\n\t        return self;\n\t    };\n\t\n\t    /** build a log cache entry object from the given level, namespace, and arguments (optionally adding timestamp */\n\t    MetricsLogger.prototype._buildEntry = function _buildEntry(level, namespace, logArguments) {\n\t        this._emitToConsole('debug', 'MetricsLogger', ['_buildEntry:', arguments]);\n\t        var entry = {\n\t            level: level,\n\t            namespace: this.options.clientPrefix + namespace,\n\t            args: logArguments\n\t        };\n\t        if (this.options.addTime) {\n\t            entry.time = new Date().toISOString();\n\t        }\n\t        return entry;\n\t    };\n\t\n\t    /** post _postSize messages from the cache to the server, removing them if successful\n\t     *      if the post fails, wait until maxCacheSize is accumulated instead and try again then\n\t     *      in addition to the messages from the cache ('metrics'), any info from getPingData (if set) will be sent\n\t     *      onServerResponse will be called (if set) with any response from the server\n\t     */\n\t    MetricsLogger.prototype._postCache = function _postCache(options) {\n\t        options = options || {};\n\t        this._emitToConsole('info', 'MetricsLogger', ['_postCache', options, this._postSize]);\n\t\n\t        // short circuit if we're already sending\n\t        if (!this.options.postUrl || this._sending) {\n\t            return jQuery.when({});\n\t        }\n\t\n\t        var self = this,\n\t            postSize = options.count || self._postSize,\n\t\n\t        // do not splice - remove after *successful* post\n\t        entries = self.cache.get(postSize),\n\t            entriesLength = entries.length,\n\t\n\t        // use the optional getPingData to add any extra info we may want to send\n\t        postData = typeof self.options.getPingData === 'function' ? self.options.getPingData() : {};\n\t        //console.debug( postSize, entriesLength );\n\t\n\t        // add the metrics and send\n\t        postData.metrics = JSON.stringify(entries);\n\t        //console.debug( postData.metrics );\n\t        self._sending = true;\n\t        return jQuery.post(self.options.postUrl, postData).always(function () {\n\t            self._sending = false;\n\t        }).fail(function (xhr, status, message) {\n\t            // if we failed the previous time, set the next post target to the max num of entries\n\t            self._postSize = self.options.maxCacheSize;\n\t            //TODO:??\n\t            // log this failure to explain any gap in metrics\n\t            self.emit('error', 'MetricsLogger', ['_postCache error:', xhr.readyState, xhr.status, xhr.responseJSON || xhr.responseText]);\n\t            //TODO: still doesn't solve the problem that when cache == max, post will be tried on every emit\n\t            //TODO: see _delayPost\n\t        }).done(function (response) {\n\t            if (typeof self.options.onServerResponse === 'function') {\n\t                self.options.onServerResponse(response);\n\t            }\n\t            // only remove if post successful\n\t            self.cache.remove(entriesLength);\n\t            //console.debug( 'removed entries:', entriesLength, 'size now:', self.cache.length() );\n\t            // if we succeeded, reset the post target to the normal num of entries\n\t            self._postSize = self.options.postSize;\n\t        });\n\t        // return the xhr promise\n\t    };\n\t\n\t    /** set _waiting to true and, after delayPostInMs, set it back to false */\n\t    MetricsLogger.prototype._delayPost = function _delayPost() {\n\t        //TODO: this won't work between pages\n\t        var self = this;\n\t        self._waiting = setTimeout(function () {\n\t            self._waiting = null;\n\t        }, self.options.delayPostInMs);\n\t    };\n\t\n\t    //----------------------------------------------------------------------------- console\n\t    /** output message to console based on level and consoleLogger type */\n\t    MetricsLogger.prototype._emitToConsole = function _emitToConsole(level, namespace, logArguments) {\n\t        //console.debug( '_emitToConsole:', level, namespace, logArguments );\n\t        var self = this,\n\t            whitelist = self.options.consoleNamespaceWhitelist;\n\t        if (!self.consoleLogger) {\n\t            return self;\n\t        }\n\t        // if a whitelist for namespaces is set, bail if this namespace is not in the list\n\t        if (whitelist && whitelist.indexOf(namespace) === -1) {\n\t            return self;\n\t        }\n\t\n\t        var args = Array.prototype.slice.call(logArguments, 0);\n\t        args.unshift(namespace);\n\t        //TODO: script location and/or source maps?\n\t        //TODO: branch on navigator.userAgent == AIIEEE - it only has log\n\t        if (level >= MetricsLogger.METRIC && typeof self.consoleLogger.info === 'function') {\n\t            return self.consoleLogger.info.apply(self.consoleLogger, args);\n\t        } else if (level >= MetricsLogger.ERROR && typeof self.consoleLogger.error === 'function') {\n\t            return self.consoleLogger.error.apply(self.consoleLogger, args);\n\t        } else if (level >= MetricsLogger.WARN && typeof self.consoleLogger.warn === 'function') {\n\t            self.consoleLogger.warn.apply(self.consoleLogger, args);\n\t        } else if (level >= MetricsLogger.INFO && typeof self.consoleLogger.info === 'function') {\n\t            self.consoleLogger.info.apply(self.consoleLogger, args);\n\t        } else if (level >= MetricsLogger.DEBUG && typeof self.consoleLogger.debug === 'function') {\n\t            self.consoleLogger.debug.apply(self.consoleLogger, args);\n\t        } else if (typeof self.consoleLogger.log === 'function') {\n\t            self.consoleLogger.log.apply(self.consoleLogger, args);\n\t        }\n\t        return self;\n\t    };\n\t\n\t    //----------------------------------------------------------------------------- shortcuts\n\t    // generic functions when logging from non-namespaced object (e.g. templates)\n\t    /** log to default namespace */\n\t    MetricsLogger.prototype.log = function log() {\n\t        this.emit(1, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n\t    };\n\t\n\t    /** debug to default namespace */\n\t    MetricsLogger.prototype.debug = function debug() {\n\t        this.emit(MetricsLogger.DEBUG, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n\t    };\n\t\n\t    /** info to default namespace */\n\t    MetricsLogger.prototype.info = function info() {\n\t        this.emit(MetricsLogger.INFO, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n\t    };\n\t\n\t    /** warn to default namespace */\n\t    MetricsLogger.prototype.warn = function warn() {\n\t        this.emit(MetricsLogger.WARN, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n\t    };\n\t\n\t    /** error to default namespace */\n\t    MetricsLogger.prototype.error = function error() {\n\t        this.emit(MetricsLogger.ERROR, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n\t    };\n\t\n\t    /** metric to default namespace */\n\t    MetricsLogger.prototype.metric = function metric() {\n\t        this.emit(MetricsLogger.METRIC, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n\t    };\n\t\n\t    /* ============================================================================\n\t    TODO:\n\t        need a performance pass - the JSON un/parsing is a bit much\n\t    \n\t    ============================================================================ */\n\t    /** @class LoggingCache\n\t     *  Simple implementation of cache wrapping an array.\n\t     *\n\t     *  Formats an entry before it's cached and only keeps options.maxSize number\n\t     *  of entries. Older entries are deleted first.\n\t     */\n\t    function LoggingCache(options) {\n\t        var self = this;\n\t        return self._init(options || {});\n\t    }\n\t\n\t    /** default options */\n\t    LoggingCache.defaultOptions = {\n\t        /** maximum number of entries to keep before discarding oldest */\n\t        maxSize: 5000\n\t    };\n\t\n\t    /** initialize with options */\n\t    LoggingCache.prototype._init = function _init(options) {\n\t        if (!this._hasStorage()) {\n\t            //TODO: fall back to jstorage\n\t            throw new Error('LoggingCache needs localStorage');\n\t        }\n\t        if (!options.key) {\n\t            throw new Error('LoggingCache needs key for localStorage');\n\t        }\n\t        this.key = options.key;\n\t        this._initStorage();\n\t\n\t        this.maxSize = options.maxSize || LoggingCache.defaultOptions.maxSize;\n\t        return this;\n\t    };\n\t\n\t    /** tests for localStorage fns */\n\t    LoggingCache.prototype._hasStorage = function _hasStorage() {\n\t        //TODO: modernizr\n\t        var test = 'test';\n\t        try {\n\t            localStorage.setItem(test, test);\n\t            localStorage.removeItem(test);\n\t            return true;\n\t        } catch (e) {\n\t            return false;\n\t        }\n\t    };\n\t\n\t    /** if no localStorage set for key, initialize to empty array */\n\t    LoggingCache.prototype._initStorage = function _initStorage() {\n\t        if (localStorage.getItem(this.key) === null) {\n\t            return this.empty();\n\t        }\n\t        return this;\n\t    };\n\t\n\t    /** add an entry to the cache, removing the oldest beforehand if size >= maxSize */\n\t    LoggingCache.prototype.add = function add(entry) {\n\t        var self = this,\n\t            _cache = self._fetchAndParse(),\n\t            overage = _cache.length + 1 - self.maxSize;\n\t        if (overage > 0) {\n\t            _cache.splice(0, overage);\n\t        }\n\t        _cache.push(entry);\n\t        self._unparseAndStore(_cache);\n\t        return _cache.length;\n\t    };\n\t\n\t    /** get the entries from localStorage and parse them */\n\t    LoggingCache.prototype._fetchAndParse = function _fetchAndParse() {\n\t        var self = this;\n\t        return JSON.parse(localStorage.getItem(self.key));\n\t    };\n\t\n\t    /** stringify the entries and put them in localStorage */\n\t    LoggingCache.prototype._unparseAndStore = function _unparseAndStore(entries) {\n\t        var self = this;\n\t        return localStorage.setItem(self.key, JSON.stringify(entries));\n\t    };\n\t\n\t    ///** process the entry before caching */\n\t    //LoggingCache.prototype._preprocessEntry = function _preprocessEntry( entry ){\n\t    //    return JSON.stringify( entry );\n\t    //};\n\t\n\t    /** return the length --- oh, getters where are you? */\n\t    LoggingCache.prototype.length = function length() {\n\t        return this._fetchAndParse().length;\n\t    };\n\t\n\t    /** get count number of entries starting with the oldest */\n\t    LoggingCache.prototype.get = function get(count) {\n\t        return this._fetchAndParse().slice(0, count);\n\t    };\n\t\n\t    /** remove count number of entries starting with the oldest */\n\t    LoggingCache.prototype.remove = function remove(count) {\n\t        var _cache = this._fetchAndParse(),\n\t            removed = _cache.splice(0, count);\n\t        this._unparseAndStore(_cache);\n\t        return removed;\n\t    };\n\t\n\t    /** empty/clear the entire cache */\n\t    LoggingCache.prototype.empty = function empty() {\n\t        localStorage.setItem(this.key, '[]');\n\t        return this;\n\t    };\n\t\n\t    /** stringify count number of entries (but do not remove) */\n\t    LoggingCache.prototype.stringify = function stringify(count) {\n\t        return JSON.stringify(this.get(count));\n\t    };\n\t\n\t    /** outputs entire cache to console */\n\t    LoggingCache.prototype.print = function print() {\n\t        // popup? (really, carl? a popup?) - easier to copy/paste\n\t        console.log(JSON.stringify(this._fetchAndParse(), null, '  '));\n\t    };\n\t\n\t    //=============================================================================\n\t    return {\n\t        MetricsLogger: MetricsLogger,\n\t        LoggingCache: LoggingCache\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))\n\n/***/ },\n/* 67 */,\n/* 68 */,\n/* 69 */,\n/* 70 */,\n/* 71 */,\n/* 72 */,\n/* 73 */,\n/* 74 */,\n/* 75 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(6), __webpack_require__(5), __webpack_require__(17)], __WEBPACK_AMD_DEFINE_RESULT__ = function (baseMVC, _l) {\n\t    // =============================================================================\n\t    /** A view on any model that has a 'annotation' attribute\n\t     */\n\t    var AnnotationEditor = Backbone.View.extend(baseMVC.LoggableMixin).extend(baseMVC.HiddenUntilActivatedViewMixin).extend({\n\t\n\t        tagName: 'div',\n\t        className: 'annotation-display',\n\t\n\t        /** Set up listeners, parse options */\n\t        initialize: function initialize(options) {\n\t            options = options || {};\n\t            this.tooltipConfig = options.tooltipConfig || { placement: 'bottom' };\n\t            //console.debug( this, options );\n\t            // only listen to the model only for changes to annotations\n\t            this.listenTo(this.model, 'change:annotation', function () {\n\t                this.render();\n\t            });\n\t            this.hiddenUntilActivated(options.$activator, options);\n\t        },\n\t\n\t        /** Build the DOM elements, call select to on the created input, and set up behaviors */\n\t        render: function render() {\n\t            var view = this;\n\t            this.$el.html(this._template());\n\t            this.$el.find(\"[title]\").tooltip(this.tooltipConfig);\n\t\n\t            //TODO: handle empties better\n\t            this.$annotation().make_text_editable({\n\t                use_textarea: true,\n\t                on_finish: function on_finish(newAnnotation) {\n\t                    view.$annotation().text(newAnnotation);\n\t                    view.model.save({ annotation: newAnnotation }, { silent: true }).fail(function () {\n\t                        view.$annotation().text(view.model.previous('annotation'));\n\t                    });\n\t                }\n\t            });\n\t            return this;\n\t        },\n\t\n\t        /** @returns {String} the html text used to build the view's DOM */\n\t        _template: function _template() {\n\t            var annotation = this.model.get('annotation');\n\t            //if( !annotation ){\n\t            //    //annotation = [ '<em class=\"annotation-empty\">', _l( 'Click to add an annotation' ), '</em>' ].join( '' );\n\t            //    annotation = [ '<em class=\"annotation-empty\"></em>' ].join( '' );\n\t            //}\n\t            return [\n\t            //TODO: make prompt optional\n\t            '<label class=\"prompt\">', _l('Annotation'), '</label>',\n\t            // set up initial tags by adding as CSV to input vals (necc. to init select2)\n\t            '<div class=\"annotation\" title=\"', _l('Edit annotation'), '\">', _.escape(annotation), '</div>'].join('');\n\t        },\n\t\n\t        /** @returns {jQuery} the main element for this view */\n\t        $annotation: function $annotation() {\n\t            return this.$el.find('.annotation');\n\t        },\n\t\n\t        /** shut down event listeners and remove this view's DOM */\n\t        remove: function remove() {\n\t            this.$annotation.off();\n\t            this.stopListening(this.model);\n\t            Backbone.View.prototype.remove.call(this);\n\t        },\n\t\n\t        /** string rep */\n\t        toString: function toString() {\n\t            return ['AnnotationEditor(', this.model + '', ')'].join('');\n\t        }\n\t    });\n\t    // =============================================================================\n\t    return {\n\t        AnnotationEditor: AnnotationEditor\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2)))\n\n/***/ },\n/* 76 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(_) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(83), __webpack_require__(39), __webpack_require__(38), __webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (LIST_VIEW, DC_MODEL, DC_LI, BASE_MVC, _l) {\n\t\n\t    'use strict';\n\t\n\t    var logNamespace = 'collections';\n\t    /* =============================================================================\n\t    TODO:\n\t    \n\t    ============================================================================= */\n\t    /** @class non-editable, read-only View/Controller for a dataset collection.\n\t     */\n\t    var _super = LIST_VIEW.ModelListPanel;\n\t    var CollectionView = _super.extend(\n\t    /** @lends CollectionView.prototype */{\n\t        //MODEL is either a DatasetCollection (or subclass) or a DatasetCollectionElement (list of pairs)\n\t        _logNamespace: logNamespace,\n\t\n\t        className: _super.prototype.className + ' dataset-collection-panel',\n\t\n\t        /** sub view class used for datasets */\n\t        DatasetDCEViewClass: DC_LI.DatasetDCEListItemView,\n\t        /** sub view class used for nested collections */\n\t        NestedDCDCEViewClass: DC_LI.NestedDCDCEListItemView,\n\t        /** key of attribute in model to assign to this.collection */\n\t        modelCollectionKey: 'elements',\n\t\n\t        // ......................................................................... SET UP\n\t        /** Set up the view, set up storage, bind listeners to HistoryContents events\n\t         *  @param {Object} attributes optional settings for the panel\n\t         */\n\t        initialize: function initialize(attributes) {\n\t            _super.prototype.initialize.call(this, attributes);\n\t            this.linkTarget = attributes.linkTarget || '_blank';\n\t\n\t            this.hasUser = attributes.hasUser;\n\t            /** A stack of panels that currently cover or hide this panel */\n\t            this.panelStack = [];\n\t            /** The text of the link to go back to the panel containing this one */\n\t            this.parentName = attributes.parentName;\n\t            /** foldout or drilldown */\n\t            this.foldoutStyle = attributes.foldoutStyle || 'foldout';\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ sub-views\n\t        /** In this override, use model.getVisibleContents */\n\t        _filterCollection: function _filterCollection() {\n\t            //TODO: should *not* be model.getVisibleContents - visibility is not model related\n\t            return this.model.getVisibleContents();\n\t        },\n\t\n\t        /** override to return proper view class based on element_type */\n\t        _getItemViewClass: function _getItemViewClass(model) {\n\t            //this.debug( this + '._getItemViewClass:', model );\n\t            //TODO: subclasses use DCEViewClass - but are currently unused - decide\n\t            switch (model.get('element_type')) {\n\t                case 'hda':\n\t                    return this.DatasetDCEViewClass;\n\t                case 'dataset_collection':\n\t                    return this.NestedDCDCEViewClass;\n\t            }\n\t            throw new TypeError('Unknown element type:', model.get('element_type'));\n\t        },\n\t\n\t        /** override to add link target and anon */\n\t        _getItemViewOptions: function _getItemViewOptions(model) {\n\t            var options = _super.prototype._getItemViewOptions.call(this, model);\n\t            return _.extend(options, {\n\t                linkTarget: this.linkTarget,\n\t                hasUser: this.hasUser,\n\t                //TODO: could move to only nested: list:paired\n\t                foldoutStyle: this.foldoutStyle\n\t            });\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ collection sub-views\n\t        /** In this override, add/remove expanded/collapsed model ids to/from web storage */\n\t        _setUpItemViewListeners: function _setUpItemViewListeners(view) {\n\t            var panel = this;\n\t            _super.prototype._setUpItemViewListeners.call(panel, view);\n\t\n\t            // use pub-sub to: handle drilldown expansion and collapse\n\t            panel.listenTo(view, {\n\t                'expanded:drilldown': function expandedDrilldown(v, drilldown) {\n\t                    this._expandDrilldownPanel(drilldown);\n\t                },\n\t                'collapsed:drilldown': function collapsedDrilldown(v, drilldown) {\n\t                    this._collapseDrilldownPanel(drilldown);\n\t                }\n\t            });\n\t            return this;\n\t        },\n\t\n\t        /** Handle drill down by hiding this panels list and controls and showing the sub-panel */\n\t        _expandDrilldownPanel: function _expandDrilldownPanel(drilldown) {\n\t            this.panelStack.push(drilldown);\n\t            // hide this panel's controls and list, set the name for back navigation, and attach to the $el\n\t            this.$('> .controls').add(this.$list()).hide();\n\t            drilldown.parentName = this.model.get('name');\n\t            this.$el.append(drilldown.render().$el);\n\t        },\n\t\n\t        /** Handle drilldown close by freeing the panel and re-rendering this panel */\n\t        _collapseDrilldownPanel: function _collapseDrilldownPanel(drilldown) {\n\t            this.panelStack.pop();\n\t            this.render();\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ panel events\n\t        /** event map */\n\t        events: {\n\t            'click .navigation .back': 'close'\n\t        },\n\t\n\t        /** close/remove this collection panel */\n\t        close: function close(event) {\n\t            this.$el.remove();\n\t            this.trigger('close');\n\t        },\n\t\n\t        // ........................................................................ misc\n\t        /** string rep */\n\t        toString: function toString() {\n\t            return 'CollectionView(' + (this.model ? this.model.get('name') : '') + ')';\n\t        }\n\t    });\n\t\n\t    //------------------------------------------------------------------------------ TEMPLATES\n\t    CollectionView.prototype.templates = function () {\n\t\n\t        var controlsTemplate = BASE_MVC.wrapTemplate(['<div class=\"controls\">', '<div class=\"navigation\">', '<a class=\"back\" href=\"javascript:void(0)\">', '<span class=\"fa fa-icon fa-angle-left\"></span>', _l('Back to '), '<%- view.parentName %>', '</a>', '</div>', '<div class=\"title\">', '<div class=\"name\"><%- collection.name || collection.element_identifier %></div>', '<div class=\"subtitle\">',\n\t        //TODO: remove logic from template\n\t        '<% if( collection.collection_type === \"list\" ){ %>', _l('a list of datasets'), '<% } else if( collection.collection_type === \"paired\" ){ %>', _l('a pair of datasets'), '<% } else if( collection.collection_type === \"list:paired\" ){ %>', _l('a list of paired datasets'), '<% } %>', '</div>', '</div>', '</div>'], 'collection');\n\t\n\t        return _.extend(_.clone(_super.prototype.templates), {\n\t            controls: controlsTemplate\n\t        });\n\t    }();\n\t\n\t    // =============================================================================\n\t    /** @class non-editable, read-only View/Controller for a dataset collection. */\n\t    var ListCollectionView = CollectionView.extend(\n\t    /** @lends ListCollectionView.prototype */{\n\t\n\t        //TODO: not strictly needed - due to switch in CollectionView._getContentClass\n\t        /** sub view class used for datasets */\n\t        DatasetDCEViewClass: DC_LI.DatasetDCEListItemView,\n\t\n\t        // ........................................................................ misc\n\t        /** string rep */\n\t        toString: function toString() {\n\t            return 'ListCollectionView(' + (this.model ? this.model.get('name') : '') + ')';\n\t        }\n\t    });\n\t\n\t    // =============================================================================\n\t    /** @class non-editable, read-only View/Controller for a dataset collection. */\n\t    var PairCollectionView = ListCollectionView.extend(\n\t    /** @lends PairCollectionView.prototype */{\n\t\n\t        // ........................................................................ misc\n\t        /** string rep */\n\t        toString: function toString() {\n\t            return 'PairCollectionView(' + (this.model ? this.model.get('name') : '') + ')';\n\t        }\n\t    });\n\t\n\t    // =============================================================================\n\t    /** @class non-editable, read-only View/Controller for a dataset collection. */\n\t    var ListOfPairsCollectionView = CollectionView.extend(\n\t    /** @lends ListOfPairsCollectionView.prototype */{\n\t\n\t        //TODO: not strictly needed - due to switch in CollectionView._getContentClass\n\t        /** sub view class used for nested collections */\n\t        NestedDCDCEViewClass: DC_LI.NestedDCDCEListItemView.extend({\n\t            foldoutPanelClass: PairCollectionView\n\t        }),\n\t\n\t        // ........................................................................ misc\n\t        /** string rep */\n\t        toString: function toString() {\n\t            return 'ListOfPairsCollectionView(' + (this.model ? this.model.get('name') : '') + ')';\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    return {\n\t        CollectionView: CollectionView,\n\t        ListCollectionView: ListCollectionView,\n\t        PairCollectionView: PairCollectionView,\n\t        ListOfPairsCollectionView: ListOfPairsCollectionView\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2)))\n\n/***/ },\n/* 77 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(_, $) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(12), __webpack_require__(41), __webpack_require__(84), __webpack_require__(75), __webpack_require__(24), __webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (STATES, DATASET_LI, TAGS, ANNOTATIONS, faIconButton, BASE_MVC, _l) {\n\t\n\t    'use strict';\n\t    //==============================================================================\n\t\n\t    var _super = DATASET_LI.DatasetListItemView;\n\t    /** @class Editing view for DatasetAssociation.\n\t     */\n\t    var DatasetListItemEdit = _super.extend(\n\t    /** @lends DatasetListItemEdit.prototype */{\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        /** set up: options */\n\t        initialize: function initialize(attributes) {\n\t            _super.prototype.initialize.call(this, attributes);\n\t            //TODO: shouldn't this err if false?\n\t            this.hasUser = attributes.hasUser;\n\t\n\t            /** allow user purge of dataset files? */\n\t            this.purgeAllowed = attributes.purgeAllowed || false;\n\t\n\t            //TODO: move to HiddenUntilActivatedViewMixin\n\t            /** should the tags editor be shown or hidden initially? */\n\t            this.tagsEditorShown = attributes.tagsEditorShown || false;\n\t            /** should the tags editor be shown or hidden initially? */\n\t            this.annotationEditorShown = attributes.annotationEditorShown || false;\n\t        },\n\t\n\t        // ......................................................................... titlebar actions\n\t        /** In this override, add the other two primary actions: edit and delete */\n\t        _renderPrimaryActions: function _renderPrimaryActions() {\n\t            var actions = _super.prototype._renderPrimaryActions.call(this);\n\t            if (this.model.get('state') === STATES.NOT_VIEWABLE) {\n\t                return actions;\n\t            }\n\t            // render the display, edit attr and delete icon-buttons\n\t            return _super.prototype._renderPrimaryActions.call(this).concat([this._renderEditButton(), this._renderDeleteButton()]);\n\t        },\n\t\n\t        //TODO: move titleButtons into state renderers, remove state checks in the buttons\n\t\n\t        /** Render icon-button to edit the attributes (format, permissions, etc.) this dataset. */\n\t        _renderEditButton: function _renderEditButton() {\n\t            // don't show edit while uploading, in-accessible\n\t            // DO show if in error (ala previous history panel)\n\t            if (this.model.get('state') === STATES.DISCARDED || !this.model.get('accessible')) {\n\t                return null;\n\t            }\n\t\n\t            var purged = this.model.get('purged'),\n\t                deleted = this.model.get('deleted'),\n\t                editBtnData = {\n\t                title: _l('Edit attributes'),\n\t                href: this.model.urls.edit,\n\t                target: this.linkTarget,\n\t                faIcon: 'fa-pencil',\n\t                classes: 'edit-btn'\n\t            };\n\t\n\t            // disable if purged or deleted and explain why in the tooltip\n\t            if (deleted || purged) {\n\t                editBtnData.disabled = true;\n\t                if (purged) {\n\t                    editBtnData.title = _l('Cannot edit attributes of datasets removed from disk');\n\t                } else if (deleted) {\n\t                    editBtnData.title = _l('Undelete dataset to edit attributes');\n\t                }\n\t\n\t                // disable if still uploading or new\n\t            } else if (_.contains([STATES.UPLOAD, STATES.NEW], this.model.get('state'))) {\n\t                editBtnData.disabled = true;\n\t                editBtnData.title = _l('This dataset is not yet editable');\n\t            }\n\t            return faIconButton(editBtnData);\n\t        },\n\t\n\t        /** Render icon-button to delete this hda. */\n\t        _renderDeleteButton: function _renderDeleteButton() {\n\t            // don't show delete if...\n\t            if (!this.model.get('accessible')) {\n\t                return null;\n\t            }\n\t\n\t            var self = this,\n\t                deletedAlready = this.model.isDeletedOrPurged();\n\t            return faIconButton({\n\t                title: !deletedAlready ? _l('Delete') : _l('Dataset is already deleted'),\n\t                disabled: deletedAlready,\n\t                faIcon: 'fa-times',\n\t                classes: 'delete-btn',\n\t                onclick: function onclick() {\n\t                    // ...bler... tooltips being left behind in DOM (hover out never called on deletion)\n\t                    self.$el.find('.icon-btn.delete-btn').trigger('mouseout');\n\t                    self.model['delete']();\n\t                }\n\t            });\n\t        },\n\t\n\t        // ......................................................................... details\n\t        /** In this override, add tags and annotations controls, make the ? dbkey a link to editing page */\n\t        _renderDetails: function _renderDetails() {\n\t            //TODO: generalize to be allow different details for each state\n\t            var $details = _super.prototype._renderDetails.call(this),\n\t                state = this.model.get('state');\n\t\n\t            if (!this.model.isDeletedOrPurged() && _.contains([STATES.OK, STATES.FAILED_METADATA], state)) {\n\t                this._renderTags($details);\n\t                this._renderAnnotation($details);\n\t                this._makeDbkeyEditLink($details);\n\t            }\n\t\n\t            //TODO: TRIPLE tap, ugh.\n\t            this._setUpBehaviors($details);\n\t            return $details;\n\t        },\n\t\n\t        /** Add less commonly used actions in the details section based on state */\n\t        _renderSecondaryActions: function _renderSecondaryActions() {\n\t            var actions = _super.prototype._renderSecondaryActions.call(this);\n\t            switch (this.model.get('state')) {\n\t                case STATES.UPLOAD:\n\t                case STATES.NOT_VIEWABLE:\n\t                    return actions;\n\t                case STATES.ERROR:\n\t                    // error button comes first\n\t                    actions.unshift(this._renderErrButton());\n\t                    return actions.concat([this._renderRerunButton()]);\n\t                case STATES.OK:\n\t                case STATES.FAILED_METADATA:\n\t                    return actions.concat([this._renderRerunButton(), this._renderVisualizationsButton()]);\n\t            }\n\t            return actions.concat([this._renderRerunButton()]);\n\t        },\n\t\n\t        /** Render icon-button to report an error on this dataset to the galaxy admin. */\n\t        _renderErrButton: function _renderErrButton() {\n\t            return faIconButton({\n\t                title: _l('View or report this error'),\n\t                href: this.model.urls.report_error,\n\t                classes: 'report-error-btn',\n\t                target: this.linkTarget,\n\t                faIcon: 'fa-bug'\n\t            });\n\t        },\n\t\n\t        /** Render icon-button to re-run the job that created this dataset. */\n\t        _renderRerunButton: function _renderRerunButton() {\n\t            var creating_job = this.model.get('creating_job');\n\t            if (this.model.get('rerunnable')) {\n\t                return faIconButton({\n\t                    title: _l('Run this job again'),\n\t                    href: this.model.urls.rerun,\n\t                    classes: 'rerun-btn',\n\t                    target: this.linkTarget,\n\t                    faIcon: 'fa-refresh',\n\t                    onclick: function onclick(ev) {\n\t                        ev.preventDefault();\n\t                        // create webpack split point in order to load the tool form async\n\t                        // TODO: split not working (tool loads fine)\n\t                        !/* require */(/* empty */function() { var __WEBPACK_AMD_REQUIRE_ARRAY__ = [__webpack_require__(20)]; (function (ToolForm) {\n\t                            var form = new ToolForm.View({ 'job_id': creating_job });\n\t                            form.deferred.execute(function () {\n\t                                Galaxy.app.display(form);\n\t                            });\n\t                        }.apply(null, __WEBPACK_AMD_REQUIRE_ARRAY__));}());\n\t                    }\n\t                });\n\t            }\n\t        },\n\t\n\t        /** Render an icon-button or popupmenu of links based on the applicable visualizations */\n\t        _renderVisualizationsButton: function _renderVisualizationsButton() {\n\t            //TODO: someday - lazyload visualizations\n\t            var visualizations = this.model.get('visualizations');\n\t            if (this.model.isDeletedOrPurged() || !this.hasUser || !this.model.hasData() || _.isEmpty(visualizations)) {\n\t                return null;\n\t            }\n\t            if (!_.isObject(visualizations[0])) {\n\t                this.warn('Visualizations have been switched off');\n\t                return null;\n\t            }\n\t\n\t            var $visualizations = $(this.templates.visualizations(visualizations, this));\n\t            //HACK: need to re-write those directed at galaxy_main with linkTarget\n\t            $visualizations.find('[target=\"galaxy_main\"]').attr('target', this.linkTarget);\n\t            // use addBack here to include the root $visualizations elem (for the case of 1 visualization)\n\t            this._addScratchBookFn($visualizations.find('.visualization-link').addBack('.visualization-link'));\n\t            return $visualizations;\n\t        },\n\t\n\t        /** add scratchbook functionality to visualization links */\n\t        _addScratchBookFn: function _addScratchBookFn($links) {\n\t            var li = this;\n\t            $links.click(function (ev) {\n\t                if (Galaxy.frame && Galaxy.frame.active) {\n\t                    Galaxy.frame.add({\n\t                        title: 'Visualization',\n\t                        url: $(this).attr('href')\n\t                    });\n\t                    ev.preventDefault();\n\t                    ev.stopPropagation();\n\t                }\n\t            });\n\t        },\n\t\n\t        //TODO: if possible move these to readonly view - but display the owner's tags/annotation (no edit)\n\t        /** Render the tags list/control */\n\t        _renderTags: function _renderTags($where) {\n\t            if (!this.hasUser) {\n\t                return;\n\t            }\n\t            var view = this;\n\t            this.tagsEditor = new TAGS.TagsEditor({\n\t                model: this.model,\n\t                el: $where.find('.tags-display'),\n\t                onshowFirstTime: function onshowFirstTime() {\n\t                    this.render();\n\t                },\n\t                // persist state on the hda view (and not the editor) since these are currently re-created each time\n\t                onshow: function onshow() {\n\t                    view.tagsEditorShown = true;\n\t                },\n\t                onhide: function onhide() {\n\t                    view.tagsEditorShown = false;\n\t                },\n\t                $activator: faIconButton({\n\t                    title: _l('Edit dataset tags'),\n\t                    classes: 'tag-btn',\n\t                    faIcon: 'fa-tags'\n\t                }).appendTo($where.find('.actions .right'))\n\t            });\n\t            if (this.tagsEditorShown) {\n\t                this.tagsEditor.toggle(true);\n\t            }\n\t        },\n\t\n\t        /** Render the annotation display/control */\n\t        _renderAnnotation: function _renderAnnotation($where) {\n\t            if (!this.hasUser) {\n\t                return;\n\t            }\n\t            var view = this;\n\t            this.annotationEditor = new ANNOTATIONS.AnnotationEditor({\n\t                model: this.model,\n\t                el: $where.find('.annotation-display'),\n\t                onshowFirstTime: function onshowFirstTime() {\n\t                    this.render();\n\t                },\n\t                // persist state on the hda view (and not the editor) since these are currently re-created each time\n\t                onshow: function onshow() {\n\t                    view.annotationEditorShown = true;\n\t                },\n\t                onhide: function onhide() {\n\t                    view.annotationEditorShown = false;\n\t                },\n\t                $activator: faIconButton({\n\t                    title: _l('Edit dataset annotation'),\n\t                    classes: 'annotate-btn',\n\t                    faIcon: 'fa-comment'\n\t                }).appendTo($where.find('.actions .right'))\n\t            });\n\t            if (this.annotationEditorShown) {\n\t                this.annotationEditor.toggle(true);\n\t            }\n\t        },\n\t\n\t        /** If the format/dbkey/genome_build isn't set, make the display a link to the edit page */\n\t        _makeDbkeyEditLink: function _makeDbkeyEditLink($details) {\n\t            // make the dbkey a link to editing\n\t            if (this.model.get('metadata_dbkey') === '?' && !this.model.isDeletedOrPurged()) {\n\t                var editableDbkey = $('<a class=\"value\">?</a>').attr('href', this.model.urls.edit).attr('target', this.linkTarget);\n\t                $details.find('.dbkey .value').replaceWith(editableDbkey);\n\t            }\n\t        },\n\t\n\t        // ......................................................................... events\n\t        /** event map */\n\t        events: _.extend(_.clone(_super.prototype.events), {\n\t            'click .undelete-link': '_clickUndeleteLink',\n\t            'click .purge-link': '_clickPurgeLink',\n\t\n\t            'click .edit-btn': function clickEditBtn(ev) {\n\t                this.trigger('edit', this, ev);\n\t            },\n\t            'click .delete-btn': function clickDeleteBtn(ev) {\n\t                this.trigger('delete', this, ev);\n\t            },\n\t            'click .rerun-btn': function clickRerunBtn(ev) {\n\t                this.trigger('rerun', this, ev);\n\t            },\n\t            'click .report-err-btn': function clickReportErrBtn(ev) {\n\t                this.trigger('report-err', this, ev);\n\t            },\n\t            'click .visualization-btn': function clickVisualizationBtn(ev) {\n\t                this.trigger('visualize', this, ev);\n\t            },\n\t            'click .dbkey a': function clickDbkeyA(ev) {\n\t                this.trigger('edit', this, ev);\n\t            }\n\t        }),\n\t\n\t        /** listener for item undelete (in the messages section) */\n\t        _clickUndeleteLink: function _clickUndeleteLink(ev) {\n\t            this.model.undelete();\n\t            return false;\n\t        },\n\t\n\t        /** listener for item purge (in the messages section) */\n\t        _clickPurgeLink: function _clickPurgeLink(ev) {\n\t            //TODO: confirm dialog\n\t            this.model.purge();\n\t            return false;\n\t        },\n\t\n\t        // ......................................................................... misc\n\t        /** string rep */\n\t        toString: function toString() {\n\t            var modelString = this.model ? this.model + '' : '(no model)';\n\t            return 'HDAEditView(' + modelString + ')';\n\t        }\n\t    });\n\t\n\t    // ............................................................................ TEMPLATES\n\t    /** underscore templates */\n\t    DatasetListItemEdit.prototype.templates = function () {\n\t        //TODO: move to require text! plugin\n\t\n\t        var warnings = _.extend({}, _super.prototype.templates.warnings, {\n\t            failed_metadata: BASE_MVC.wrapTemplate([\n\t            // in this override, provide a link to the edit page\n\t            '<% if( dataset.state === \"failed_metadata\" ){ %>', '<div class=\"failed_metadata-warning warningmessagesmall\">', _l('An error occurred setting the metadata for this dataset'), '<br /><a href=\"<%- dataset.urls.edit %>\" target=\"<%- view.linkTarget %>\">', _l('Set it manually or retry auto-detection'), '</a>', '</div>', '<% } %>'], 'dataset'),\n\t\n\t            deleted: BASE_MVC.wrapTemplate([\n\t            // in this override, provide links to undelete or purge the dataset\n\t            '<% if( dataset.deleted && !dataset.purged ){ %>',\n\t            // deleted not purged\n\t            '<div class=\"deleted-msg warningmessagesmall\">', _l('This dataset has been deleted'), '<br /><a class=\"undelete-link\" href=\"javascript:void(0);\">', _l('Undelete it'), '</a>', '<% if( view.purgeAllowed ){ %>', '<br /><a class=\"purge-link\" href=\"javascript:void(0);\">', _l('Permanently remove it from disk'), '</a>', '<% } %>', '</div>', '<% } %>'], 'dataset')\n\t        });\n\t\n\t        var visualizationsTemplate = BASE_MVC.wrapTemplate(['<% if( visualizations.length === 1 ){ %>', '<a class=\"visualization-btn visualization-link icon-btn\" href=\"<%- visualizations[0].href %>\"', ' target=\"<%- visualizations[0].target %>\" title=\"', _l('Visualize in'), ' <%- visualizations[0].html %>\">', '<span class=\"fa fa-bar-chart-o\"></span>', '</a>', '<% } else { %>', '<div class=\"visualizations-dropdown dropdown\">', '<a class=\"visualization-btn icon-btn\" data-toggle=\"dropdown\" title=\"', _l('Visualize'), '\">', '<span class=\"fa fa-bar-chart-o\"></span>', '</a>', '<ul class=\"dropdown-menu\" role=\"menu\">', '<% _.each( visualizations, function( visualization ){ %>', '<li><a class=\"visualization-link\" href=\"<%- visualization.href %>\"', ' target=\"<%- visualization.target %>\">', '<%- visualization.html %>', '</a></li>', '<% }); %>', '</ul>', '</div>', '<% } %>'], 'visualizations');\n\t\n\t        return _.extend({}, _super.prototype.templates, {\n\t            warnings: warnings,\n\t            visualizations: visualizationsTemplate\n\t        });\n\t    }();\n\t\n\t    //==============================================================================\n\t    return {\n\t        DatasetListItemEdit: DatasetListItemEdit\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 78 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, jQuery) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(12), __webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (STATES, BASE_MVC, _l) {\n\t    'use strict';\n\t\n\t    var logNamespace = 'dataset';\n\t    //==============================================================================\n\t    var searchableMixin = BASE_MVC.SearchableModelMixin;\n\t    /** @class base model for any DatasetAssociation (HDAs, LDDAs, DatasetCollectionDAs).\n\t     *      No knowledge of what type (HDA/LDDA/DCDA) should be needed here.\n\t     *  The DA's are made searchable (by attribute) by mixing in SearchableModelMixin.\n\t     */\n\t    var DatasetAssociation = Backbone.Model.extend(BASE_MVC.LoggableMixin).extend(BASE_MVC.mixin(searchableMixin, /** @lends DatasetAssociation.prototype */{\n\t        _logNamespace: logNamespace,\n\t\n\t        /** default attributes for a model */\n\t        defaults: {\n\t            state: STATES.NEW,\n\t            deleted: false,\n\t            purged: false,\n\t\n\t            // unreliable attribute\n\t            name: '(unnamed dataset)',\n\t\n\t            //TODO: update to false when this is correctly passed from the API (when we have a security model for this)\n\t            accessible: true,\n\t\n\t            // sniffed datatype (sam, tabular, bed, etc.)\n\t            data_type: '',\n\t            file_ext: '',\n\t\n\t            // size in bytes\n\t            file_size: 0,\n\t\n\t            // array of associated file types (eg. [ 'bam_index', ... ])\n\t            meta_files: [],\n\t\n\t            misc_blurb: '',\n\t            misc_info: '',\n\t\n\t            tags: []\n\t            // do NOT default on annotation, as this default is valid and will be passed on 'save'\n\t            //  which is incorrect behavior when the model is only partially fetched (annos are not passed in summary data)\n\t            //annotation          : ''\n\t        },\n\t\n\t        /** instance vars and listeners */\n\t        initialize: function initialize(attributes, options) {\n\t            this.debug(this + '(Dataset).initialize', attributes, options);\n\t\n\t            //!! this state is not in trans.app.model.Dataset.states - set it here -\n\t            if (!this.get('accessible')) {\n\t                this.set('state', STATES.NOT_VIEWABLE);\n\t            }\n\t\n\t            /** Datasets rely/use some web controllers - have the model generate those URLs on startup */\n\t            this.urls = this._generateUrls();\n\t\n\t            this._setUpListeners();\n\t        },\n\t\n\t        /** returns misc. web urls for rendering things like re-run, display, etc. */\n\t        _generateUrls: function _generateUrls() {\n\t            //TODO: would be nice if the API did this\n\t            var id = this.get('id');\n\t            if (!id) {\n\t                return {};\n\t            }\n\t            var urls = {\n\t                'purge': 'datasets/' + id + '/purge_async',\n\t                'display': 'datasets/' + id + '/display/?preview=True',\n\t                'edit': 'datasets/' + id + '/edit',\n\t                'download': 'datasets/' + id + '/display?to_ext=' + this.get('file_ext'),\n\t                'report_error': 'dataset/errors?id=' + id,\n\t                'rerun': 'tool_runner/rerun?id=' + id,\n\t                'show_params': 'datasets/' + id + '/show_params',\n\t                'visualization': 'visualization',\n\t                'meta_download': 'dataset/get_metadata_file?hda_id=' + id + '&metadata_name='\n\t            };\n\t            //TODO: global\n\t            _.each(urls, function (value, key) {\n\t                urls[key] = Galaxy.root + value;\n\t            });\n\t            this.urls = urls;\n\t            return urls;\n\t        },\n\t\n\t        /** set up any event listeners\n\t         *  event: state:ready  fired when this DA moves into/is already in a ready state\n\t         */\n\t        _setUpListeners: function _setUpListeners() {\n\t            // if the state has changed and the new state is a ready state, fire an event\n\t            this.on('change:state', function (currModel, newState) {\n\t                this.log(this + ' has changed state:', currModel, newState);\n\t                if (this.inReadyState()) {\n\t                    this.trigger('state:ready', currModel, newState, this.previous('state'));\n\t                }\n\t            });\n\t            // the download url (currently) relies on having a correct file extension\n\t            this.on('change:id change:file_ext', function (currModel) {\n\t                this._generateUrls();\n\t            });\n\t        },\n\t\n\t        // ........................................................................ common queries\n\t        /** override to add urls */\n\t        toJSON: function toJSON() {\n\t            var json = Backbone.Model.prototype.toJSON.call(this);\n\t            //console.warn( 'returning json?' );\n\t            //return json;\n\t            return _.extend(json, {\n\t                urls: this.urls\n\t            });\n\t        },\n\t\n\t        /** Is this dataset deleted or purged? */\n\t        isDeletedOrPurged: function isDeletedOrPurged() {\n\t            return this.get('deleted') || this.get('purged');\n\t        },\n\t\n\t        /** Is this dataset in a 'ready' state; where 'Ready' states are states where no\n\t         *      processing (for the ds) is left to do on the server.\n\t         */\n\t        inReadyState: function inReadyState() {\n\t            var ready = _.contains(STATES.READY_STATES, this.get('state'));\n\t            return this.isDeletedOrPurged() || ready;\n\t        },\n\t\n\t        /** Does this model already contain detailed data (as opposed to just summary level data)? */\n\t        hasDetails: function hasDetails() {\n\t            // if it's inaccessible assume it has everything it needs\n\t            if (!this.get('accessible')) {\n\t                return true;\n\t            }\n\t            //?? this may not be reliable\n\t            return _.has(this.attributes, 'genome_build');\n\t        },\n\t\n\t        /** Convenience function to match dataset.has_data. */\n\t        hasData: function hasData() {\n\t            return this.get('file_size') > 0;\n\t        },\n\t\n\t        // ........................................................................ ajax\n\t        fetch: function fetch(options) {\n\t            var dataset = this;\n\t            return Backbone.Model.prototype.fetch.call(this, options).always(function () {\n\t                dataset._generateUrls();\n\t            });\n\t        },\n\t\n\t        //NOTE: subclasses of DA's will need to implement url and urlRoot in order to have these work properly\n\t        /** save this dataset, _Mark_ing it as deleted (just a flag) */\n\t        'delete': function _delete(options) {\n\t            if (this.get('deleted')) {\n\t                return jQuery.when();\n\t            }\n\t            return this.save({ deleted: true }, options);\n\t        },\n\t        /** save this dataset, _Mark_ing it as undeleted */\n\t        undelete: function undelete(options) {\n\t            if (!this.get('deleted') || this.get('purged')) {\n\t                return jQuery.when();\n\t            }\n\t            return this.save({ deleted: false }, options);\n\t        },\n\t\n\t        /** remove the file behind this dataset from the filesystem (if permitted) */\n\t        purge: function _purge(options) {\n\t            //TODO: use, override model.destroy, HDA.delete({ purge: true })\n\t            if (this.get('purged')) {\n\t                return jQuery.when();\n\t            }\n\t            options = options || {};\n\t            //var hda = this,\n\t            //    //xhr = jQuery.ajax( this.url() + '?' + jQuery.param({ purge: true }), _.extend({\n\t            //    xhr = jQuery.ajax( this.url(), _.extend({\n\t            //        type : 'DELETE',\n\t            //        data : {\n\t            //            purge : true\n\t            //        }\n\t            //    }, options ));\n\t            //\n\t            //xhr.done( function( response ){\n\t            //    hda.debug( 'response', response );\n\t            //    //hda.set({ deleted: true, purged: true });\n\t            //    hda.set( response );\n\t            //});\n\t            //return xhr;\n\t\n\t            options.url = this.urls.purge;\n\t\n\t            //TODO: ideally this would be a DELETE call to the api\n\t            //  using purge async for now\n\t            var hda = this,\n\t                xhr = jQuery.ajax(options);\n\t            xhr.done(function (message, status, responseObj) {\n\t                hda.set({ deleted: true, purged: true });\n\t            });\n\t            xhr.fail(function (xhr, status, message) {\n\t                // Exception messages are hidden within error page including:  '...not allowed in this Galaxy instance.'\n\t                // unbury and re-add to xhr\n\t                var error = _l(\"Unable to purge dataset\");\n\t                var messageBuriedInUnfortunatelyFormattedError = 'Removal of datasets by users ' + 'is not allowed in this Galaxy instance';\n\t                if (xhr.responseJSON && xhr.responseJSON.error) {\n\t                    error = xhr.responseJSON.error;\n\t                } else if (xhr.responseText.indexOf(messageBuriedInUnfortunatelyFormattedError) !== -1) {\n\t                    error = messageBuriedInUnfortunatelyFormattedError;\n\t                }\n\t                xhr.responseText = error;\n\t                hda.trigger('error', hda, xhr, options, _l(error), { error: error });\n\t            });\n\t            return xhr;\n\t        },\n\t\n\t        // ........................................................................ searching\n\t        // see base-mvc, SearchableModelMixin\n\t\n\t        /** what attributes of an HDA will be used in a text search */\n\t        searchAttributes: ['name', 'file_ext', 'genome_build', 'misc_blurb', 'misc_info', 'annotation', 'tags'],\n\t\n\t        /** our attr keys don't often match the labels we display to the user - so, when using\n\t         *      attribute specifiers ('name=\"bler\"') in a term, allow passing in aliases for the\n\t         *      following attr keys.\n\t         */\n\t        searchAliases: {\n\t            title: 'name',\n\t            format: 'file_ext',\n\t            database: 'genome_build',\n\t            blurb: 'misc_blurb',\n\t            description: 'misc_blurb',\n\t            info: 'misc_info',\n\t            tag: 'tags'\n\t        },\n\t\n\t        // ........................................................................ misc\n\t        /** String representation */\n\t        toString: function toString() {\n\t            var nameAndId = this.get('id') || '';\n\t            if (this.get('name')) {\n\t                nameAndId = '\"' + this.get('name') + '\",' + nameAndId;\n\t            }\n\t            return 'Dataset(' + nameAndId + ')';\n\t        }\n\t    }));\n\t\n\t    //==============================================================================\n\t    /** @class Backbone collection for dataset associations.\n\t     */\n\t    var DatasetAssociationCollection = Backbone.Collection.extend(BASE_MVC.LoggableMixin).extend(\n\t    /** @lends HistoryContents.prototype */{\n\t        _logNamespace: logNamespace,\n\t\n\t        model: DatasetAssociation,\n\t\n\t        /** root api url */\n\t        urlRoot: Galaxy.root + 'api/datasets',\n\t\n\t        /** url fn */\n\t        url: function url() {\n\t            return this.urlRoot;\n\t        },\n\t\n\t        // ........................................................................ common queries\n\t        /** Get the ids of every item in this collection\n\t         *  @returns array of encoded ids\n\t         */\n\t        ids: function ids() {\n\t            return this.map(function (item) {\n\t                return item.get('id');\n\t            });\n\t        },\n\t\n\t        /** Get contents that are not ready\n\t         *  @returns array of content models\n\t         */\n\t        notReady: function notReady() {\n\t            return this.filter(function (content) {\n\t                return !content.inReadyState();\n\t            });\n\t        },\n\t\n\t        /** return true if any datasets don't have details */\n\t        haveDetails: function haveDetails() {\n\t            return this.all(function (dataset) {\n\t                return dataset.hasDetails();\n\t            });\n\t        },\n\t\n\t        // ........................................................................ ajax\n\t        /** using a queue, perform ajaxFn on each of the models in this collection */\n\t        ajaxQueue: function ajaxQueue(ajaxFn, options) {\n\t            var deferred = jQuery.Deferred(),\n\t                startingLength = this.length,\n\t                responses = [];\n\t\n\t            if (!startingLength) {\n\t                deferred.resolve([]);\n\t                return deferred;\n\t            }\n\t\n\t            // use reverse order (stylistic choice)\n\t            var ajaxFns = this.chain().reverse().map(function (dataset, i) {\n\t                return function () {\n\t                    var xhr = ajaxFn.call(dataset, options);\n\t                    // if successful, notify using the deferred to allow tracking progress\n\t                    xhr.done(function (response) {\n\t                        deferred.notify({ curr: i, total: startingLength, response: response, model: dataset });\n\t                    });\n\t                    // (regardless of previous error or success) if not last ajax call, shift and call the next\n\t                    //  if last fn, resolve deferred\n\t                    xhr.always(function (response) {\n\t                        responses.push(response);\n\t                        if (ajaxFns.length) {\n\t                            ajaxFns.shift()();\n\t                        } else {\n\t                            deferred.resolve(responses);\n\t                        }\n\t                    });\n\t                };\n\t            }).value();\n\t            // start the queue\n\t            ajaxFns.shift()();\n\t\n\t            return deferred;\n\t        },\n\t\n\t        // ........................................................................ sorting/filtering\n\t        /** return a new collection of datasets whose attributes contain the substring matchesWhat */\n\t        matches: function matches(matchesWhat) {\n\t            return this.filter(function (dataset) {\n\t                return dataset.matches(matchesWhat);\n\t            });\n\t        },\n\t\n\t        // ........................................................................ misc\n\t        ///** Convert this ad-hoc collection of hdas to a formal collection tracked\n\t        //    by the server.\n\t        //**/\n\t        //promoteToHistoryDatasetCollection : function _promote( history, collection_type, options ){\n\t        //},\n\t\n\t        /** String representation. */\n\t        toString: function toString() {\n\t            return ['DatasetAssociationCollection(', this.length, ')'].join('');\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    return {\n\t        DatasetAssociation: DatasetAssociation,\n\t        DatasetAssociationCollection: DatasetAssociationCollection\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 79 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(_) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(41), __webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (DATASET_LI, BASE_MVC, _l) {\n\t\n\t    'use strict';\n\t\n\t    //==============================================================================\n\t\n\t    var _super = DATASET_LI.DatasetListItemView;\n\t    /** @class Read only view for HistoryDatasetAssociation.\n\t     *      Since there are no controls on the HDAView to hide the dataset,\n\t     *      the primary thing this class does (currently) is override templates\n\t     *      to render the HID.\n\t     */\n\t    var HDAListItemView = _super.extend(\n\t    /** @lends HDAListItemView.prototype */{\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        className: _super.prototype.className + \" history-content\",\n\t\n\t        initialize: function initialize(attributes, options) {\n\t            _super.prototype.initialize.call(this, attributes, options);\n\t        },\n\t\n\t        // ......................................................................... misc\n\t        /** String representation */\n\t        toString: function toString() {\n\t            var modelString = this.model ? this.model + '' : '(no model)';\n\t            return 'HDAListItemView(' + modelString + ')';\n\t        }\n\t    });\n\t\n\t    // ............................................................................ TEMPLATES\n\t    /** underscore templates */\n\t    HDAListItemView.prototype.templates = function () {\n\t        //TODO: move to require text! plugin\n\t\n\t        var titleBarTemplate = BASE_MVC.wrapTemplate([\n\t        // adding the hid display to the title\n\t        '<div class=\"title-bar clear\" tabindex=\"0\">', '<span class=\"state-icon\"></span>', '<div class=\"title\">',\n\t        //TODO: remove whitespace and use margin-right\n\t        '<span class=\"hid\"><%- dataset.hid %></span> ', '<span class=\"name\"><%- dataset.name %></span>', '</div>', '</div>'], 'dataset');\n\t\n\t        var warnings = _.extend({}, _super.prototype.templates.warnings, {\n\t            hidden: BASE_MVC.wrapTemplate([\n\t            // add a warning when hidden\n\t            '<% if( !dataset.visible ){ %>', '<div class=\"hidden-msg warningmessagesmall\">', _l('This dataset has been hidden'), '</div>', '<% } %>'], 'dataset')\n\t        });\n\t\n\t        return _.extend({}, _super.prototype.templates, {\n\t            titleBar: titleBarTemplate,\n\t            warnings: warnings\n\t        });\n\t    }();\n\t\n\t    //==============================================================================\n\t    return {\n\t        HDAListItemView: HDAListItemView\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2)))\n\n/***/ },\n/* 80 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(_) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(78), __webpack_require__(49), __webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (DATASET, HISTORY_CONTENT, BASE_MVC, _l) {\n\t\n\t    'use strict';\n\t\n\t    //==============================================================================\n\t\n\t    var _super = DATASET.DatasetAssociation,\n\t        hcontentMixin = HISTORY_CONTENT.HistoryContentMixin;\n\t    /** @class (HDA) model for a Galaxy dataset contained in and related to a history.\n\t     */\n\t    var HistoryDatasetAssociation = _super.extend(BASE_MVC.mixin(hcontentMixin,\n\t    /** @lends HistoryDatasetAssociation.prototype */{\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n\t        //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n\t        //  - re-apply manually it now\n\t        /** call the mixin constructor */\n\t        constructor: function constructor(attrs, options) {\n\t            hcontentMixin.constructor.call(this, attrs, options);\n\t        },\n\t\n\t        /** default attributes for a model */\n\t        defaults: _.extend({}, _super.prototype.defaults, hcontentMixin.defaults, {\n\t            model_class: 'HistoryDatasetAssociation'\n\t        }),\n\t\n\t        /** Set up the model, determine if accessible, bind listeners\n\t         */\n\t        initialize: function initialize(attributes, options) {\n\t            _super.prototype.initialize.call(this, attributes, options);\n\t            hcontentMixin.initialize.call(this, attributes, options);\n\t        },\n\t\n\t        // ........................................................................ misc\n\t        /** String representation */\n\t        toString: function toString() {\n\t            var nameAndId = this.get('id') || '';\n\t            if (this.get('name')) {\n\t                nameAndId = this.get('hid') + ' :\"' + this.get('name') + '\",' + nameAndId;\n\t            }\n\t            return 'HDA(' + nameAndId + ')';\n\t        }\n\t    }));\n\t\n\t    //==============================================================================\n\t    return {\n\t        HistoryDatasetAssociation: HistoryDatasetAssociation\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2)))\n\n/***/ },\n/* 81 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(_) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(12), __webpack_require__(38), __webpack_require__(76), __webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (STATES, DC_LI, DC_VIEW, BASE_MVC, _l) {\n\t\n\t    'use strict';\n\t\n\t    //==============================================================================\n\t\n\t    var _super = DC_LI.DCListItemView;\n\t    /** @class Read only view for HistoryDatasetCollectionAssociation (a dataset collection inside a history).\n\t     */\n\t    var HDCAListItemView = _super.extend(\n\t    /** @lends HDCAListItemView.prototype */{\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        className: _super.prototype.className + \" history-content\",\n\t\n\t        /** event listeners */\n\t        _setUpListeners: function _setUpListeners() {\n\t            _super.prototype._setUpListeners.call(this);\n\t\n\t            this.listenTo(this.model, {\n\t                'change:populated change:visible': function changePopulatedChangeVisible(model, options) {\n\t                    this.render();\n\t                }\n\t            });\n\t        },\n\t\n\t        /** Override to provide the proper collections panels as the foldout */\n\t        _getFoldoutPanelClass: function _getFoldoutPanelClass() {\n\t            switch (this.model.get('collection_type')) {\n\t                case 'list':\n\t                    return DC_VIEW.ListCollectionView;\n\t                case 'paired':\n\t                    return DC_VIEW.PairCollectionView;\n\t                case 'list:paired':\n\t                    return DC_VIEW.ListOfPairsCollectionView;\n\t            }\n\t            throw new TypeError('Uknown collection_type: ' + this.model.get('collection_type'));\n\t        },\n\t\n\t        /** In this override, add the state as a class for use with state-based CSS */\n\t        _swapNewRender: function _swapNewRender($newRender) {\n\t            _super.prototype._swapNewRender.call(this, $newRender);\n\t            //TODO: model currently has no state\n\t            var state = !this.model.get('populated') ? STATES.RUNNING : STATES.OK;\n\t            //if( this.model.has( 'state' ) ){\n\t            this.$el.addClass('state-' + state);\n\t            //}\n\t            return this.$el;\n\t        },\n\t\n\t        // ......................................................................... misc\n\t        /** String representation */\n\t        toString: function toString() {\n\t            var modelString = this.model ? this.model + '' : '(no model)';\n\t            return 'HDCAListItemView(' + modelString + ')';\n\t        }\n\t    });\n\t\n\t    /** underscore templates */\n\t    HDCAListItemView.prototype.templates = function () {\n\t\n\t        var warnings = _.extend({}, _super.prototype.templates.warnings, {\n\t            hidden: BASE_MVC.wrapTemplate([\n\t            // add a warning when hidden\n\t            '<% if( !collection.visible ){ %>', '<div class=\"hidden-msg warningmessagesmall\">', _l('This collection has been hidden'), '</div>', '<% } %>'], 'collection')\n\t        });\n\t\n\t        // could steal this from hda-base (or use mixed content)\n\t        var titleBarTemplate = BASE_MVC.wrapTemplate([\n\t        // adding the hid display to the title\n\t        '<div class=\"title-bar clear\" tabindex=\"0\">', '<span class=\"state-icon\"></span>', '<div class=\"title\">',\n\t        //TODO: remove whitespace and use margin-right\n\t        '<span class=\"hid\"><%- collection.hid %></span> ', '<span class=\"name\"><%- collection.name %></span>', '</div>', '<div class=\"subtitle\"></div>', '</div>'], 'collection');\n\t\n\t        return _.extend({}, _super.prototype.templates, {\n\t            warnings: warnings,\n\t            titleBar: titleBarTemplate\n\t        });\n\t    }();\n\t\n\t    //==============================================================================\n\t    return {\n\t        HDCAListItemView: HDCAListItemView\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2)))\n\n/***/ },\n/* 82 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, jQuery, _, $) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(50), __webpack_require__(4), __webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (HISTORY_CONTENTS, UTILS, BASE_MVC, _l) {\n\t\n\t    'use strict';\n\t\n\t    var logNamespace = 'history';\n\t    //==============================================================================\n\t    /** @class Model for a Galaxy history resource - both a record of user\n\t     *      tool use and a collection of the datasets those tools produced.\n\t     *  @name History\n\t     *  @augments Backbone.Model\n\t     */\n\t    var History = Backbone.Model.extend(BASE_MVC.LoggableMixin).extend(BASE_MVC.mixin(BASE_MVC.SearchableModelMixin, /** @lends History.prototype */{\n\t        _logNamespace: logNamespace,\n\t\n\t        // values from api (may need more)\n\t        defaults: {\n\t            model_class: 'History',\n\t            id: null,\n\t            name: 'Unnamed History',\n\t            state: 'new',\n\t\n\t            deleted: false\n\t        },\n\t\n\t        // ........................................................................ urls\n\t        urlRoot: Galaxy.root + 'api/histories',\n\t\n\t        // ........................................................................ set up/tear down\n\t        /** Set up the model\n\t         *  @param {Object} historyJSON model data for this History\n\t         *  @param {Object[]} contentsJSON   array of model data for this History's contents (hdas or collections)\n\t         *  @param {Object} options     any extra settings including logger\n\t         */\n\t        initialize: function initialize(historyJSON, contentsJSON, options) {\n\t            options = options || {};\n\t            this.logger = options.logger || null;\n\t            this.log(this + \".initialize:\", historyJSON, contentsJSON, options);\n\t\n\t            /** HistoryContents collection of the HDAs contained in this history. */\n\t            this.log('creating history contents:', contentsJSON);\n\t            this.contents = new HISTORY_CONTENTS.HistoryContents(contentsJSON || [], { historyId: this.get('id') });\n\t            //// if we've got hdas passed in the constructor, load them\n\t            //if( contentsJSON && _.isArray( contentsJSON ) ){\n\t            //    this.log( 'resetting history contents:', contentsJSON );\n\t            //    this.contents.reset( contentsJSON );\n\t            //}\n\t\n\t            this._setUpListeners();\n\t\n\t            /** cached timeout id for the dataset updater */\n\t            this.updateTimeoutId = null;\n\t            // set up update timeout if needed\n\t            //this.checkForUpdates();\n\t        },\n\t\n\t        /** set up any event listeners for this history including those to the contained HDAs\n\t         *  events: error:contents  if an error occurred with the contents collection\n\t         */\n\t        _setUpListeners: function _setUpListeners() {\n\t            this.on('error', function (model, xhr, options, msg, details) {\n\t                this.errorHandler(model, xhr, options, msg, details);\n\t            });\n\t\n\t            // hda collection listening\n\t            if (this.contents) {\n\t                this.listenTo(this.contents, 'error', function () {\n\t                    this.trigger.apply(this, ['error:contents'].concat(jQuery.makeArray(arguments)));\n\t                });\n\t            }\n\t            // if the model's id changes ('current' or null -> an actual id), update the contents history_id\n\t            this.on('change:id', function (model, newId) {\n\t                if (this.contents) {\n\t                    this.contents.historyId = newId;\n\t                }\n\t            });\n\t        },\n\t\n\t        //TODO: see base-mvc\n\t        //onFree : function(){\n\t        //    if( this.contents ){\n\t        //        this.contents.free();\n\t        //    }\n\t        //},\n\t\n\t        /** event listener for errors. Generally errors are handled outside this model */\n\t        errorHandler: function errorHandler(model, xhr, options, msg, details) {\n\t            // clear update timeout on model err\n\t            this.clearUpdateTimeout();\n\t        },\n\t\n\t        /** convert size in bytes to a more human readable version */\n\t        nice_size: function nice_size() {\n\t            return UTILS.bytesToString(this.get('size'), true, 2);\n\t        },\n\t\n\t        /** override to add nice_size */\n\t        toJSON: function toJSON() {\n\t            return _.extend(Backbone.Model.prototype.toJSON.call(this), {\n\t                nice_size: this.nice_size()\n\t            });\n\t        },\n\t\n\t        /** override to allow getting nice_size */\n\t        get: function get(key) {\n\t            if (key === 'nice_size') {\n\t                return this.nice_size();\n\t            }\n\t            return Backbone.Model.prototype.get.apply(this, arguments);\n\t        },\n\t\n\t        // ........................................................................ common queries\n\t        /** T/F is this history owned by the current user (Galaxy.user)\n\t         *      Note: that this will return false for an anon user even if the history is theirs.\n\t         */\n\t        ownedByCurrUser: function ownedByCurrUser() {\n\t            // no currUser\n\t            if (!Galaxy || !Galaxy.user) {\n\t                return false;\n\t            }\n\t            // user is anon or history isn't owned\n\t            if (Galaxy.user.isAnonymous() || Galaxy.user.id !== this.get('user_id')) {\n\t                return false;\n\t            }\n\t            return true;\n\t        },\n\t\n\t        /**  */\n\t        contentsCount: function contentsCount() {\n\t            return _.reduce(_.values(this.get('state_details')), function (memo, num) {\n\t                return memo + num;\n\t            }, 0);\n\t        },\n\t\n\t        /** Return the number of running jobs assoc with this history (note: unknown === 0) */\n\t        numOfUnfinishedJobs: function numOfUnfinishedJobs() {\n\t            var unfinishedJobIds = this.get('non_ready_jobs');\n\t            return unfinishedJobIds ? unfinishedJobIds.length : 0;\n\t        },\n\t\n\t        /** Return the number of running hda/hdcas in this history (note: unknown === 0) */\n\t        numOfUnfinishedShownContents: function numOfUnfinishedShownContents() {\n\t            var contents = this.contents.running().visibleAndUndeleted();\n\t            return contents ? contents.length : 0;\n\t        },\n\t\n\t        // ........................................................................ search\n\t        /** What model fields to search with */\n\t        searchAttributes: ['name', 'annotation', 'tags'],\n\t\n\t        /** Adding title and singular tag */\n\t        searchAliases: {\n\t            title: 'name',\n\t            tag: 'tags'\n\t        },\n\t\n\t        // ........................................................................ updates\n\t        _getSizeAndRunning: function _getSizeAndRunning() {\n\t            return this.fetch({ data: $.param({ keys: 'size,non_ready_jobs' }) });\n\t        },\n\t\n\t        /**  */\n\t        refresh: function refresh(options) {\n\t            options = options || {};\n\t            var self = this;\n\t\n\t            var lastUpdateTime = self.lastUpdateTime;\n\t            // note: if there was no previous update time, all summary contents will be fetched\n\t            return self.contents.fetchUpdated(lastUpdateTime).done(function (response, status, xhr) {\n\t                var serverResponseDatetime;\n\t                try {\n\t                    serverResponseDatetime = new Date(xhr.getResponseHeader('Date'));\n\t                } catch (err) {}\n\t                self.lastUpdateTime = serverResponseDatetime || new Date();\n\t                self.checkForUpdates(options);\n\t            });\n\t        },\n\t\n\t        /**  */\n\t        checkForUpdates: function checkForUpdates(options) {\n\t            options = options || {};\n\t            var delay = History.UPDATE_DELAY;\n\t            var self = this;\n\t\n\t            function _delayThenUpdate() {\n\t                // prevent buildup of updater timeouts by clearing previous if any, then set new and cache id\n\t                self.clearUpdateTimeout();\n\t                self.updateTimeoutId = setTimeout(function () {\n\t                    self.refresh(options);\n\t                }, delay);\n\t            }\n\t\n\t            // if there are still datasets in the non-ready state, recurse into this function with the new time\n\t            if (this.numOfUnfinishedShownContents() > 0) {\n\t                _delayThenUpdate();\n\t            } else {\n\t                // no datasets are running, but currently runnning jobs may still produce new datasets\n\t                // see if the history has any running jobs and continue to update if so\n\t                // (also update the size for the user in either case)\n\t                self._getSizeAndRunning().done(function (historyData) {\n\t                    if (self.numOfUnfinishedJobs() > 0) {\n\t                        _delayThenUpdate();\n\t                    } else {\n\t                        // otherwise, let listeners know that all updates have stopped\n\t                        self.trigger('ready');\n\t                    }\n\t                });\n\t            }\n\t        },\n\t\n\t        /** clear the timeout and the cached timeout id */\n\t        clearUpdateTimeout: function clearUpdateTimeout() {\n\t            if (this.updateTimeoutId) {\n\t                clearTimeout(this.updateTimeoutId);\n\t                this.updateTimeoutId = null;\n\t            }\n\t        },\n\t\n\t        // ........................................................................ ajax\n\t        /** save this history, _Mark_ing it as deleted (just a flag) */\n\t        _delete: function _delete(options) {\n\t            if (this.get('deleted')) {\n\t                return jQuery.when();\n\t            }\n\t            return this.save({ deleted: true }, options);\n\t        },\n\t        /** purge this history, _Mark_ing it as purged and removing all dataset data from the server */\n\t        purge: function purge(options) {\n\t            if (this.get('purged')) {\n\t                return jQuery.when();\n\t            }\n\t            return this.save({ deleted: true, purged: true }, options);\n\t        },\n\t        /** save this history, _Mark_ing it as undeleted */\n\t        undelete: function undelete(options) {\n\t            if (!this.get('deleted')) {\n\t                return jQuery.when();\n\t            }\n\t            return this.save({ deleted: false }, options);\n\t        },\n\t\n\t        /** Make a copy of this history on the server\n\t         *  @param {Boolean} current    if true, set the copy as the new current history (default: true)\n\t         *  @param {String} name        name of new history (default: none - server sets to: Copy of <current name>)\n\t         *  @fires copied               passed this history and the response JSON from the copy\n\t         *  @returns {xhr}\n\t         */\n\t        copy: function copy(current, name, allDatasets) {\n\t            current = current !== undefined ? current : true;\n\t            if (!this.id) {\n\t                throw new Error('You must set the history ID before copying it.');\n\t            }\n\t\n\t            var postData = { history_id: this.id };\n\t            if (current) {\n\t                postData.current = true;\n\t            }\n\t            if (name) {\n\t                postData.name = name;\n\t            }\n\t            if (!allDatasets) {\n\t                postData.all_datasets = false;\n\t            }\n\t\n\t            var history = this,\n\t                copy = jQuery.post(this.urlRoot, postData);\n\t            // if current - queue to setAsCurrent before firing 'copied'\n\t            if (current) {\n\t                return copy.then(function (response) {\n\t                    var newHistory = new History(response);\n\t                    return newHistory.setAsCurrent().done(function () {\n\t                        history.trigger('copied', history, response);\n\t                    });\n\t                });\n\t            }\n\t            return copy.done(function (response) {\n\t                history.trigger('copied', history, response);\n\t            });\n\t        },\n\t\n\t        setAsCurrent: function setAsCurrent() {\n\t            var history = this,\n\t                xhr = jQuery.getJSON(Galaxy.root + 'history/set_as_current?id=' + this.id);\n\t\n\t            xhr.done(function () {\n\t                history.trigger('set-as-current', history);\n\t            });\n\t            return xhr;\n\t        },\n\t\n\t        // ........................................................................ misc\n\t        toString: function toString() {\n\t            return 'History(' + this.get('id') + ',' + this.get('name') + ')';\n\t        }\n\t    }));\n\t\n\t    //------------------------------------------------------------------------------ CLASS VARS\n\t    /** When the history has running hdas,\n\t     *  this is the amount of time between update checks from the server\n\t     */\n\t    History.UPDATE_DELAY = 4000;\n\t\n\t    /** Get data for a history then its hdas using a sequential ajax call, return a deferred to receive both */\n\t    History.getHistoryData = function getHistoryData(historyId, options) {\n\t        options = options || {};\n\t        var detailIdsFn = options.detailIdsFn || [];\n\t        var hdcaDetailIds = options.hdcaDetailIds || [];\n\t        //console.debug( 'getHistoryData:', historyId, options );\n\t\n\t        var df = jQuery.Deferred(),\n\t            historyJSON = null;\n\t\n\t        function getHistory(id) {\n\t            // get the history data\n\t            if (historyId === 'current') {\n\t                return jQuery.getJSON(Galaxy.root + 'history/current_history_json');\n\t            }\n\t            return jQuery.ajax(Galaxy.root + 'api/histories/' + historyId);\n\t        }\n\t        function isEmpty(historyData) {\n\t            // get the number of hdas accrd. to the history\n\t            return historyData && historyData.empty;\n\t        }\n\t        function getContents(historyData) {\n\t            // get the hda data\n\t            // if no hdas accrd. to history: return empty immed.\n\t            if (isEmpty(historyData)) {\n\t                return [];\n\t            }\n\t            // if there are hdas accrd. to history: get those as well\n\t            if (_.isFunction(detailIdsFn)) {\n\t                detailIdsFn = detailIdsFn(historyData);\n\t            }\n\t            if (_.isFunction(hdcaDetailIds)) {\n\t                hdcaDetailIds = hdcaDetailIds(historyData);\n\t            }\n\t            var data = {\n\t                v: 'dev'\n\t            };\n\t            if (detailIdsFn.length) {\n\t                data.details = detailIdsFn.join(',');\n\t            }\n\t            return jQuery.ajax(Galaxy.root + 'api/histories/' + historyData.id + '/contents', { data: data });\n\t        }\n\t\n\t        // getting these concurrently is 400% slower (sqlite, local, vanilla) - so:\n\t        //  chain the api calls - getting history first then contents\n\t\n\t        var historyFn = options.historyFn || getHistory,\n\t            contentsFn = options.contentsFn || getContents;\n\t\n\t        // chain ajax calls: get history first, then hdas\n\t        var historyXHR = historyFn(historyId);\n\t        historyXHR.done(function (json) {\n\t            // set outer scope var here for use below\n\t            historyJSON = json;\n\t            df.notify({ status: 'history data retrieved', historyJSON: historyJSON });\n\t        });\n\t        historyXHR.fail(function (xhr, status, message) {\n\t            // call reject on the outer deferred to allow its fail callback to run\n\t            df.reject(xhr, 'loading the history');\n\t        });\n\t\n\t        var contentsXHR = historyXHR.then(contentsFn);\n\t        contentsXHR.then(function (contentsJSON) {\n\t            df.notify({ status: 'contents data retrieved', historyJSON: historyJSON, contentsJSON: contentsJSON });\n\t            // we've got both: resolve the outer scope deferred\n\t            df.resolve(historyJSON, contentsJSON);\n\t        });\n\t        contentsXHR.fail(function (xhr, status, message) {\n\t            // call reject on the outer deferred to allow its fail callback to run\n\t            df.reject(xhr, 'loading the contents', { history: historyJSON });\n\t        });\n\t\n\t        return df;\n\t    };\n\t\n\t    //==============================================================================\n\t    var ControlledFetchMixin = {\n\t\n\t        /** Override to convert certain options keys into API index parameters */\n\t        fetch: function fetch(options) {\n\t            options = options || {};\n\t            options.data = options.data || this._buildFetchData(options);\n\t            // use repeated params for arrays, e.g. q=1&qv=1&q=2&qv=2\n\t            options.traditional = true;\n\t            return Backbone.Collection.prototype.fetch.call(this, options);\n\t        },\n\t\n\t        /** These attribute keys are valid params to fetch/API-index */\n\t        _fetchOptions: [\n\t        /** model dependent string to control the order of models returned */\n\t        'order',\n\t        /** limit the number of models returned from a fetch */\n\t        'limit',\n\t        /** skip this number of models when fetching */\n\t        'offset',\n\t        /** what series of attributes to return (model dependent) */\n\t        'view',\n\t        /** individual keys to return for the models (see api/histories.index) */\n\t        'keys'],\n\t\n\t        /** Build the data dictionary to send to fetch's XHR as data */\n\t        _buildFetchData: function _buildFetchData(options) {\n\t            var data = {},\n\t                fetchDefaults = this._fetchDefaults();\n\t            options = _.defaults(options || {}, fetchDefaults);\n\t            data = _.pick(options, this._fetchOptions);\n\t\n\t            var filters = _.has(options, 'filters') ? options.filters : fetchDefaults.filters || {};\n\t            if (!_.isEmpty(filters)) {\n\t                _.extend(data, this._buildFetchFilters(filters));\n\t            }\n\t            return data;\n\t        },\n\t\n\t        /** Override to have defaults for fetch options and filters */\n\t        _fetchDefaults: function _fetchDefaults() {\n\t            // to be overridden\n\t            return {};\n\t        },\n\t\n\t        /** Convert dictionary filters to qqv style arrays */\n\t        _buildFetchFilters: function _buildFetchFilters(filters) {\n\t            var filterMap = {\n\t                q: [],\n\t                qv: []\n\t            };\n\t            _.each(filters, function (v, k) {\n\t                if (v === true) {\n\t                    v = 'True';\n\t                }\n\t                if (v === false) {\n\t                    v = 'False';\n\t                }\n\t                if (v === null) {\n\t                    v = 'None';\n\t                }\n\t                filterMap.q.push(k);\n\t                filterMap.qv.push(v);\n\t            });\n\t            return filterMap;\n\t        }\n\t    };\n\t\n\t    //==============================================================================\n\t    /** @class A collection of histories (per user).\n\t     *      (stub) currently unused.\n\t     */\n\t    var HistoryCollection = Backbone.Collection.extend(BASE_MVC.LoggableMixin).extend(ControlledFetchMixin).extend( /** @lends HistoryCollection.prototype */{\n\t        _logNamespace: logNamespace,\n\t\n\t        model: History,\n\t\n\t        /** @type {String} the default sortOrders key for sorting */\n\t        DEFAULT_ORDER: 'update_time',\n\t\n\t        /** @type {Object} map of collection sorting orders generally containing a getter to return the attribute\n\t         *      sorted by and asc T/F if it is an ascending sort.\n\t         */\n\t        sortOrders: {\n\t            'update_time': {\n\t                getter: function getter(h) {\n\t                    return new Date(h.get('update_time'));\n\t                },\n\t                asc: false\n\t            },\n\t            'update_time-asc': {\n\t                getter: function getter(h) {\n\t                    return new Date(h.get('update_time'));\n\t                },\n\t                asc: true\n\t            },\n\t            'name': {\n\t                getter: function getter(h) {\n\t                    return h.get('name');\n\t                },\n\t                asc: true\n\t            },\n\t            'name-dsc': {\n\t                getter: function getter(h) {\n\t                    return h.get('name');\n\t                },\n\t                asc: false\n\t            },\n\t            'size': {\n\t                getter: function getter(h) {\n\t                    return h.get('size');\n\t                },\n\t                asc: false\n\t            },\n\t            'size-asc': {\n\t                getter: function getter(h) {\n\t                    return h.get('size');\n\t                },\n\t                asc: true\n\t            }\n\t        },\n\t\n\t        initialize: function initialize(models, options) {\n\t            options = options || {};\n\t            this.log('HistoryCollection.initialize', arguments);\n\t\n\t            // instance vars\n\t            /** @type {boolean} should deleted histories be included */\n\t            this.includeDeleted = options.includeDeleted || false;\n\t            // set the sort order\n\t            this.setOrder(options.order || this.DEFAULT_ORDER);\n\t            /** @type {String} encoded id of the history that's current */\n\t            this.currentHistoryId = options.currentHistoryId;\n\t            /** @type {boolean} have all histories been fetched and in the collection? */\n\t            this.allFetched = options.allFetched || false;\n\t\n\t            // this.on( 'all', function(){\n\t            //    console.info( 'event:', arguments );\n\t            // });\n\t            this.setUpListeners();\n\t        },\n\t\n\t        urlRoot: Galaxy.root + 'api/histories',\n\t        url: function url() {\n\t            return this.urlRoot;\n\t        },\n\t\n\t        /** returns map of default filters and settings for fetching from the API */\n\t        _fetchDefaults: function _fetchDefaults() {\n\t            // to be overridden\n\t            var defaults = {\n\t                order: this.order,\n\t                view: 'detailed'\n\t            };\n\t            if (!this.includeDeleted) {\n\t                defaults.filters = {\n\t                    deleted: false,\n\t                    purged: false\n\t                };\n\t            } else {\n\t                defaults.filters = {\n\t                    // TODO: for bypassing defaults on current API\n\t                    deleted: null\n\t                };\n\t            }\n\t            return defaults;\n\t        },\n\t\n\t        /** set up reflexive event handlers */\n\t        setUpListeners: function setUpListeners() {\n\t            this.on({\n\t                // when a history is deleted, remove it from the collection (if optionally set to do so)\n\t                'change:deleted': function changeDeleted(history) {\n\t                    // TODO: this becomes complicated when more filters are used\n\t                    this.debug('change:deleted', this.includeDeleted, history.get('deleted'));\n\t                    if (!this.includeDeleted && history.get('deleted')) {\n\t                        this.remove(history);\n\t                    }\n\t                },\n\t                // listen for a history copy, setting it to current\n\t                'copied': function copied(original, newData) {\n\t                    this.setCurrent(new History(newData, []));\n\t                },\n\t                // when a history is made current, track the id in the collection\n\t                'set-as-current': function setAsCurrent(history) {\n\t                    var oldCurrentId = this.currentHistoryId;\n\t                    this.trigger('no-longer-current', oldCurrentId);\n\t                    this.currentHistoryId = history.id;\n\t                }\n\t            });\n\t        },\n\t\n\t        /** override to allow passing options.order and setting the sort order to one of sortOrders */\n\t        sort: function sort(options) {\n\t            options = options || {};\n\t            this.setOrder(options.order);\n\t            return Backbone.Collection.prototype.sort.call(this, options);\n\t        },\n\t\n\t        /** build the comparator used to sort this collection using the sortOrder map and the given order key\n\t         *  @event 'changed-order' passed the new order and the collection\n\t         */\n\t        setOrder: function setOrder(order) {\n\t            var collection = this,\n\t                sortOrder = this.sortOrders[order];\n\t            if (_.isUndefined(sortOrder)) {\n\t                return;\n\t            }\n\t\n\t            collection.order = order;\n\t            collection.comparator = function comparator(a, b) {\n\t                var currentHistoryId = collection.currentHistoryId;\n\t                // current always first\n\t                if (a.id === currentHistoryId) {\n\t                    return -1;\n\t                }\n\t                if (b.id === currentHistoryId) {\n\t                    return 1;\n\t                }\n\t                // then compare by an attribute\n\t                a = sortOrder.getter(a);\n\t                b = sortOrder.getter(b);\n\t                return sortOrder.asc ? a === b ? 0 : a > b ? 1 : -1 : a === b ? 0 : a > b ? -1 : 1;\n\t            };\n\t            collection.trigger('changed-order', collection.order, collection);\n\t            return collection;\n\t        },\n\t\n\t        /** override to provide order and offsets based on instance vars, set limit if passed,\n\t         *  and set allFetched/fire 'all-fetched' when xhr returns\n\t         */\n\t        fetch: function fetch(options) {\n\t            options = options || {};\n\t            if (this.allFetched) {\n\t                return jQuery.when({});\n\t            }\n\t            var collection = this,\n\t                fetchOptions = _.defaults(options, {\n\t                remove: false,\n\t                offset: collection.length >= 1 ? collection.length - 1 : 0,\n\t                order: collection.order\n\t            }),\n\t                limit = options.limit;\n\t            if (!_.isUndefined(limit)) {\n\t                fetchOptions.limit = limit;\n\t            }\n\t\n\t            return ControlledFetchMixin.fetch.call(this, fetchOptions).done(function _postFetchMore(fetchData) {\n\t                var numFetched = _.isArray(fetchData) ? fetchData.length : 0;\n\t                // anything less than a full page means we got all there is to get\n\t                if (!limit || numFetched < limit) {\n\t                    collection.allFetched = true;\n\t                    collection.trigger('all-fetched', collection);\n\t                }\n\t            });\n\t        },\n\t\n\t        /** create a new history and by default set it to be the current history */\n\t        create: function create(data, hdas, historyOptions, xhrOptions) {\n\t            //TODO: .create is actually a collection function that's overridden here\n\t            var collection = this,\n\t                xhr = jQuery.getJSON(Galaxy.root + 'history/create_new_current');\n\t            return xhr.done(function (newData) {\n\t                collection.setCurrent(new History(newData, [], historyOptions || {}));\n\t            });\n\t        },\n\t\n\t        /** set the current history to the given history, placing it first in the collection.\n\t         *  Pass standard bbone options for use in unshift.\n\t         *  @triggers new-current passed history and this collection\n\t         */\n\t        setCurrent: function setCurrent(history, options) {\n\t            options = options || {};\n\t            // new histories go in the front\n\t            this.unshift(history, options);\n\t            this.currentHistoryId = history.get('id');\n\t            if (!options.silent) {\n\t                this.trigger('new-current', history, this);\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /** override to reset allFetched flag to false */\n\t        reset: function reset(models, options) {\n\t            this.allFetched = false;\n\t            return Backbone.Collection.prototype.reset.call(this, models, options);\n\t        },\n\t\n\t        toString: function toString() {\n\t            return 'HistoryCollection(' + this.length + ')';\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    return {\n\t        History: History,\n\t        HistoryCollection: HistoryCollection\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 83 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(51), __webpack_require__(124), __webpack_require__(6), __webpack_require__(5), __webpack_require__(89)], __WEBPACK_AMD_DEFINE_RESULT__ = function (LIST_ITEM, LoadingIndicator, BASE_MVC, _l) {\n\t\n\t    'use strict';\n\t\n\t    var logNamespace = 'list';\n\t    /* ============================================================================\n\t    TODO:\n\t    \n\t    ============================================================================ */\n\t    /** @class View for a list/collection of models and the sub-views of those models.\n\t     *      Sub-views must (at least have the interface if not) inherit from ListItemView.\n\t     *      (For a list panel that also includes some 'container' model (History->HistoryContents)\n\t     *      use ModelWithListPanel)\n\t     *\n\t     *  Allows for:\n\t     *      searching collection/sub-views\n\t     *      selecting/multi-selecting sub-views\n\t     *\n\t     *  Currently used:\n\t     *      for dataset/dataset-choice\n\t     *      as superclass of ModelListPanel\n\t     */\n\t    var ListPanel = Backbone.View.extend(BASE_MVC.LoggableMixin).extend( /** @lends ListPanel.prototype */{\n\t        _logNamespace: logNamespace,\n\t\n\t        /** class to use for constructing the sub-views */\n\t        viewClass: LIST_ITEM.ListItemView,\n\t        /** class to used for constructing collection of sub-view models */\n\t        collectionClass: Backbone.Collection,\n\t\n\t        tagName: 'div',\n\t        className: 'list-panel',\n\t\n\t        /** (in ms) that jquery effects will use */\n\t        fxSpeed: 'fast',\n\t\n\t        /** string to display when the collection has no contents */\n\t        emptyMsg: _l('This list is empty'),\n\t        /** displayed when no items match the search terms */\n\t        noneFoundMsg: _l('No matching items found'),\n\t        /** string used for search placeholder */\n\t        searchPlaceholder: _l('search'),\n\t\n\t        // ......................................................................... SET UP\n\t        /** Set up the view, set up storage, bind listeners to HistoryContents events\n\t         *  @param {Object} attributes optional settings for the list\n\t         */\n\t        initialize: function initialize(attributes, options) {\n\t            attributes = attributes || {};\n\t            // set the logger if requested\n\t            if (attributes.logger) {\n\t                this.logger = attributes.logger;\n\t            }\n\t            this.log(this + '.initialize:', attributes);\n\t\n\t            // ---- instance vars\n\t            /** how quickly should jquery fx run? */\n\t            this.fxSpeed = _.has(attributes, 'fxSpeed') ? attributes.fxSpeed : this.fxSpeed;\n\t\n\t            /** filters for displaying subviews */\n\t            this.filters = [];\n\t            /** current search terms */\n\t            this.searchFor = attributes.searchFor || '';\n\t\n\t            /** loading indicator */\n\t            this.indicator = new LoadingIndicator(this.$el);\n\t\n\t            /** currently showing selectors on items? */\n\t            this.selecting = attributes.selecting !== undefined ? attributes.selecting : true;\n\t            //this.selecting = false;\n\t\n\t            /** cached selected item.model.ids to persist btwn renders */\n\t            this.selected = attributes.selected || [];\n\t            /** the last selected item.model.id */\n\t            this.lastSelected = null;\n\t\n\t            /** are sub-views draggable */\n\t            this.dragItems = attributes.dragItems || false;\n\t\n\t            /** list item view class (when passed models) */\n\t            this.viewClass = attributes.viewClass || this.viewClass;\n\t\n\t            /** list item views */\n\t            this.views = [];\n\t            /** list item models */\n\t            this.collection = attributes.collection || new this.collectionClass([]);\n\t\n\t            /** filter fns run over collection items to see if they should show in the list */\n\t            this.filters = attributes.filters || [];\n\t\n\t            /** override $scrollContainer fn via attributes - fn should return jq for elem to call scrollTo on */\n\t            this.$scrollContainer = attributes.$scrollContainer || this.$scrollContainer;\n\t\n\t            //TODO: remove\n\t            this.title = attributes.title || '';\n\t            this.subtitle = attributes.subtitle || '';\n\t\n\t            this._setUpListeners();\n\t        },\n\t\n\t        /** free any sub-views the list has */\n\t        freeViews: function freeViews() {\n\t            //TODO: stopListening? remove?\n\t            _.each(this.views, function (view) {\n\t                view.off();\n\t            });\n\t            this.views = [];\n\t            return this;\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ listeners\n\t        /** create any event listeners for the list\n\t         */\n\t        _setUpListeners: function _setUpListeners() {\n\t            this.off();\n\t\n\t            //TODO: move errorHandler down into list-view from history-view or\n\t            //  pass to global error handler (Galaxy)\n\t            this.on({\n\t                error: function error(model, xhr, options, msg, details) {\n\t                    //this.errorHandler( model, xhr, options, msg, details );\n\t                    console.error(model, xhr, options, msg, details);\n\t                },\n\t                // show hide the loading indicator\n\t                loading: function loading() {\n\t                    this._showLoadingIndicator('loading...', 40);\n\t                },\n\t                'loading-done': function loadingDone() {\n\t                    this._hideLoadingIndicator(40);\n\t                }\n\t            });\n\t\n\t            // throw the first render up as a diff namespace using once (for outside consumption)\n\t            this.once('rendered', function () {\n\t                this.trigger('rendered:initial', this);\n\t            });\n\t\n\t            // debugging\n\t            if (this.logger) {\n\t                this.on('all', function (event) {\n\t                    this.log(this + '', arguments);\n\t                });\n\t            }\n\t\n\t            this._setUpCollectionListeners();\n\t            this._setUpViewListeners();\n\t            return this;\n\t        },\n\t\n\t        /** listening for collection events */\n\t        _setUpCollectionListeners: function _setUpCollectionListeners() {\n\t            this.log(this + '._setUpCollectionListeners', this.collection);\n\t            this.collection.off();\n\t\n\t            // bubble up error events\n\t            this.listenTo(this.collection, {\n\t                error: function error(model, xhr, options, msg, details) {\n\t                    this.trigger('error', model, xhr, options, msg, details);\n\t                },\n\t                reset: function reset() {\n\t                    this.renderItems();\n\t                },\n\t                add: this.addItemView,\n\t                remove: this.removeItemView\n\t            });\n\t\n\t            // debugging\n\t            if (this.logger) {\n\t                this.listenTo(this.collection, 'all', function (event) {\n\t                    this.info(this + '(collection)', arguments);\n\t                });\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /** listening for sub-view events that bubble up with the 'view:' prefix */\n\t        _setUpViewListeners: function _setUpViewListeners() {\n\t            this.log(this + '._setUpViewListeners');\n\t\n\t            // shift to select a range\n\t            this.on({\n\t                'view:selected': function viewSelected(view, ev) {\n\t                    if (ev && ev.shiftKey && this.lastSelected) {\n\t                        var lastSelectedView = this.viewFromModelId(this.lastSelected);\n\t                        if (lastSelectedView) {\n\t                            this.selectRange(view, lastSelectedView);\n\t                        }\n\t                    } else if (ev && ev.altKey && !this.selecting) {\n\t                        this.showSelectors();\n\t                    }\n\t                    this.selected.push(view.model.id);\n\t                    this.lastSelected = view.model.id;\n\t                },\n\t\n\t                'view:de-selected': function viewDeSelected(view, ev) {\n\t                    this.selected = _.without(this.selected, view.model.id);\n\t                    //this.lastSelected = view.model.id;\n\t                }\n\t            });\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ rendering\n\t        /** Render this content, set up ui.\n\t         *  @param {Number or String} speed   the speed of the render\n\t         */\n\t        render: function render(speed) {\n\t            this.log(this + '.render', speed);\n\t            var $newRender = this._buildNewRender();\n\t            this._setUpBehaviors($newRender);\n\t            this._queueNewRender($newRender, speed);\n\t            return this;\n\t        },\n\t\n\t        /** Build a temp div containing the new children for the view's $el.\n\t         */\n\t        _buildNewRender: function _buildNewRender() {\n\t            this.debug(this + '(ListPanel)._buildNewRender');\n\t            var $newRender = $(this.templates.el({}, this));\n\t            this._renderControls($newRender);\n\t            this._renderTitle($newRender);\n\t            this._renderSubtitle($newRender);\n\t            this._renderSearch($newRender);\n\t            this.renderItems($newRender);\n\t            return $newRender;\n\t        },\n\t\n\t        /** Build a temp div containing the new children for the view's $el.\n\t         */\n\t        _renderControls: function _renderControls($newRender) {\n\t            this.debug(this + '(ListPanel)._renderControls');\n\t            var $controls = $(this.templates.controls({}, this));\n\t            $newRender.find('.controls').replaceWith($controls);\n\t            return $controls;\n\t        },\n\t\n\t        /**\n\t         */\n\t        _renderTitle: function _renderTitle($where) {\n\t            //$where = $where || this.$el;\n\t            //$where.find( '.title' ).replaceWith( ... )\n\t        },\n\t\n\t        /**\n\t         */\n\t        _renderSubtitle: function _renderSubtitle($where) {\n\t            //$where = $where || this.$el;\n\t            //$where.find( '.title' ).replaceWith( ... )\n\t        },\n\t\n\t        /** Fade out the old el, swap in the new contents, then fade in.\n\t         *  @param {Number or String} speed   jq speed to use for rendering effects\n\t         *  @fires rendered when rendered\n\t         */\n\t        _queueNewRender: function _queueNewRender($newRender, speed) {\n\t            speed = speed === undefined ? this.fxSpeed : speed;\n\t            var panel = this;\n\t            panel.log('_queueNewRender:', $newRender, speed);\n\t\n\t            $(panel).queue('fx', [function (next) {\n\t                this.$el.fadeOut(speed, next);\n\t            }, function (next) {\n\t                panel._swapNewRender($newRender);\n\t                next();\n\t            }, function (next) {\n\t                this.$el.fadeIn(speed, next);\n\t            }, function (next) {\n\t                panel.trigger('rendered', panel);\n\t                next();\n\t            }]);\n\t        },\n\t\n\t        /** empty out the current el, move the $newRender's children in */\n\t        _swapNewRender: function _swapNewRender($newRender) {\n\t            this.$el.empty().attr('class', this.className).append($newRender.children());\n\t            if (this.selecting) {\n\t                this.showSelectors(0);\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /**  */\n\t        _setUpBehaviors: function _setUpBehaviors($where) {\n\t            $where = $where || this.$el;\n\t            $where.find('.controls [title]').tooltip({ placement: 'bottom' });\n\t            // set up the pupup for actions available when multi selecting\n\t            this._renderMultiselectActionMenu($where);\n\t            return this;\n\t        },\n\t\n\t        /** render a menu containing the actions available to sets of selected items */\n\t        _renderMultiselectActionMenu: function _renderMultiselectActionMenu($where) {\n\t            $where = $where || this.$el;\n\t            var $menu = $where.find('.list-action-menu'),\n\t                actions = this.multiselectActions();\n\t            if (!actions.length) {\n\t                return $menu.empty();\n\t            }\n\t\n\t            var $newMenu = $(['<div class=\"list-action-menu btn-group\">', '<button class=\"list-action-menu-btn btn btn-default dropdown-toggle\" data-toggle=\"dropdown\">', _l('For all selected'), '...', '</button>', '<ul class=\"dropdown-menu pull-right\" role=\"menu\">', '</ul>', '</div>'].join(''));\n\t            var $actions = actions.map(function (action) {\n\t                var html = ['<li><a href=\"javascript:void(0);\">', action.html, '</a></li>'].join('');\n\t                return $(html).click(function (ev) {\n\t                    ev.preventDefault();\n\t                    return action.func(ev);\n\t                });\n\t            });\n\t            $newMenu.find('ul').append($actions);\n\t            $menu.replaceWith($newMenu);\n\t            return $newMenu;\n\t        },\n\t\n\t        /** return a list of plain objects used to render multiselect actions menu. Each object should have:\n\t         *      html: an html string used as the anchor contents\n\t         *      func: a function called when the anchor is clicked (passed the click event)\n\t         */\n\t        multiselectActions: function multiselectActions() {\n\t            return [];\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ sub-$element shortcuts\n\t        /** the scroll container for this panel - can be $el, $el.parent(), or grandparent depending on context */\n\t        $scrollContainer: function $scrollContainer() {\n\t            // override or set via attributes.$scrollContainer\n\t            return this.$el.parent().parent();\n\t        },\n\t        /**  */\n\t        $list: function $list($where) {\n\t            return ($where || this.$el).find('> .list-items');\n\t        },\n\t        /** container where list messages are attached */\n\t        $messages: function $messages($where) {\n\t            return ($where || this.$el).find('> .controls .messages');\n\t        },\n\t        /** the message displayed when no views can be shown (no views, none matching search) */\n\t        $emptyMessage: function $emptyMessage($where) {\n\t            return ($where || this.$el).find('> .empty-message');\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ hda sub-views\n\t        /**\n\t         *  @param {jQuery} $whereTo what dom element to prepend the sub-views to\n\t         *  @returns the visible item views\n\t         */\n\t        renderItems: function renderItems($whereTo) {\n\t            $whereTo = $whereTo || this.$el;\n\t            var panel = this;\n\t            panel.log(this + '.renderItems', $whereTo);\n\t\n\t            var $list = panel.$list($whereTo);\n\t            //TODO: free prev. views?\n\t            panel.views = panel._filterCollection().map(function (itemModel) {\n\t                //TODO: creates views each time - not neccessarily good\n\t                //TODO: pass speed here\n\t                return panel._createItemView(itemModel).render(0);\n\t            });\n\t            //panel.debug( item$els );\n\t            //panel.debug( newViews );\n\t\n\t            $list.empty();\n\t            if (panel.views.length) {\n\t                panel._attachItems($whereTo);\n\t                panel.$emptyMessage($whereTo).hide();\n\t            } else {\n\t                panel._renderEmptyMessage($whereTo).show();\n\t            }\n\t            panel.trigger('views:ready', panel.views);\n\t\n\t            return panel.views;\n\t        },\n\t\n\t        /** Filter the collection to only those models that should be currently viewed */\n\t        _filterCollection: function _filterCollection() {\n\t            // override this\n\t            var panel = this;\n\t            return panel.collection.filter(_.bind(panel._filterItem, panel));\n\t        },\n\t\n\t        /** Should the model be viewable in the current state?\n\t         *     Checks against this.filters and this.searchFor\n\t         */\n\t        _filterItem: function _filterItem(model) {\n\t            // override this\n\t            var panel = this;\n\t            return _.every(panel.filters.map(function (fn) {\n\t                return fn.call(model);\n\t            })) && (!panel.searchFor || model.matchesAll(panel.searchFor));\n\t        },\n\t\n\t        /** Create a view for a model and set up it's listeners */\n\t        _createItemView: function _createItemView(model) {\n\t            var ViewClass = this._getItemViewClass(model),\n\t                options = _.extend(this._getItemViewOptions(model), {\n\t                model: model\n\t            }),\n\t                view = new ViewClass(options);\n\t            this._setUpItemViewListeners(view);\n\t            return view;\n\t        },\n\t\n\t        /** Get the bbone view class based on the model */\n\t        _getItemViewClass: function _getItemViewClass(model) {\n\t            // override this\n\t            return this.viewClass;\n\t        },\n\t\n\t        /** Get the options passed to the new view based on the model */\n\t        _getItemViewOptions: function _getItemViewOptions(model) {\n\t            // override this\n\t            return {\n\t                //logger      : this.logger,\n\t                fxSpeed: this.fxSpeed,\n\t                expanded: false,\n\t                selectable: this.selecting,\n\t                selected: _.contains(this.selected, model.id),\n\t                draggable: this.dragItems\n\t            };\n\t        },\n\t\n\t        /** Set up listeners for new models */\n\t        _setUpItemViewListeners: function _setUpItemViewListeners(view) {\n\t            var panel = this;\n\t            // send all events to the panel, re-namspaceing them with the view prefix\n\t            this.listenTo(view, 'all', function () {\n\t                var args = Array.prototype.slice.call(arguments, 0);\n\t                args[0] = 'view:' + args[0];\n\t                panel.trigger.apply(panel, args);\n\t            });\n\t\n\t            // drag multiple - hijack ev.setData to add all selected items\n\t            this.listenTo(view, 'draggable:dragstart', function (ev, v) {\n\t                //TODO: set multiple drag data here\n\t                var json = {},\n\t                    selected = this.getSelectedModels();\n\t                if (selected.length) {\n\t                    json = selected.toJSON();\n\t                } else {\n\t                    json = [v.model.toJSON()];\n\t                }\n\t                ev.dataTransfer.setData('text', JSON.stringify(json));\n\t                //ev.dataTransfer.setDragImage( v.el, 60, 60 );\n\t            }, this);\n\t\n\t            // debugging\n\t            //if( this.logger ){\n\t            //    view.on( 'all', function( event ){\n\t            //        this.log( this + '(view)', arguments );\n\t            //    }, this );\n\t            //}\n\t            return panel;\n\t        },\n\t\n\t        /** Attach views in this.views to the model based on $whereTo */\n\t        _attachItems: function _attachItems($whereTo) {\n\t            //ASSUMES: $list has been emptied\n\t            this.$list($whereTo).append(this.views.map(function (view) {\n\t                return view.$el;\n\t            }));\n\t            return this;\n\t        },\n\t\n\t        /** render the empty/none-found message */\n\t        _renderEmptyMessage: function _renderEmptyMessage($whereTo) {\n\t            this.debug('_renderEmptyMessage', $whereTo, this.searchFor);\n\t            var text = this.searchFor ? this.noneFoundMsg : this.emptyMsg;\n\t            return this.$emptyMessage($whereTo).text(text);\n\t        },\n\t\n\t        /** collapse all item views */\n\t        expandAll: function expandAll() {\n\t            _.each(this.views, function (view) {\n\t                view.expand();\n\t            });\n\t        },\n\t\n\t        /** collapse all item views */\n\t        collapseAll: function collapseAll() {\n\t            _.each(this.views, function (view) {\n\t                view.collapse();\n\t            });\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ collection/views syncing\n\t        /** Add a view (if the model should be viewable) to the panel */\n\t        addItemView: function addItemView(model, collection, options) {\n\t            this.log(this + '.addItemView:', model);\n\t            var panel = this;\n\t            if (!panel._filterItem(model)) {\n\t                return undefined;\n\t            }\n\t\n\t            var view = panel._createItemView(model);\n\t            // hide the empty message if only view\n\t            $(view).queue('fx', [\n\t            //TODO:? could poss. pubsub this\n\t            function (next) {\n\t                panel.$emptyMessage().fadeOut(panel.fxSpeed, next);\n\t            }, function (next) {\n\t                panel._attachView(view);\n\t                next();\n\t            }]);\n\t            return view;\n\t        },\n\t\n\t        /** internal fn to add view (to both panel.views and panel.$list) */\n\t        _attachView: function _attachView(view) {\n\t            var panel = this;\n\t            // override to control where the view is added, how/whether it's rendered\n\t            panel.views.push(view);\n\t            panel.$list().append(view.render(0).$el.hide());\n\t            panel.trigger('view:attached', view);\n\t            view.$el.slideDown(panel.fxSpeed, function () {\n\t                panel.trigger('view:attached:rendered');\n\t            });\n\t        },\n\t\n\t        /** Remove a view from the panel (if found) */\n\t        removeItemView: function removeItemView(model, collection, options) {\n\t            this.log(this + '.removeItemView:', model);\n\t            var panel = this,\n\t                view = panel.viewFromModel(model);\n\t            if (!view) {\n\t                return undefined;\n\t            }\n\t            panel.views = _.without(panel.views, view);\n\t            panel.trigger('view:removed', view);\n\t\n\t            // potentially show the empty message if no views left\n\t            // use anonymous queue here - since remove can happen multiple times\n\t            $({}).queue('fx', [function (next) {\n\t                view.$el.fadeOut(panel.fxSpeed, next);\n\t            }, function (next) {\n\t                view.remove();\n\t                panel.trigger('view:removed:rendered');\n\t                if (!panel.views.length) {\n\t                    panel._renderEmptyMessage().fadeIn(panel.fxSpeed, next);\n\t                } else {\n\t                    next();\n\t                }\n\t            }]);\n\t            return view;\n\t        },\n\t\n\t        /** get views based on model.id */\n\t        viewFromModelId: function viewFromModelId(id) {\n\t            for (var i = 0; i < this.views.length; i++) {\n\t                if (this.views[i].model.id === id) {\n\t                    return this.views[i];\n\t                }\n\t            }\n\t            return undefined;\n\t        },\n\t\n\t        /** get views based on model */\n\t        viewFromModel: function viewFromModel(model) {\n\t            if (!model) {\n\t                return undefined;\n\t            }\n\t            return this.viewFromModelId(model.id);\n\t        },\n\t\n\t        /** get views based on model properties */\n\t        viewsWhereModel: function viewsWhereModel(properties) {\n\t            return this.views.filter(function (view) {\n\t                //return view.model.matches( properties );\n\t                //TODO: replace with _.matches (underscore 1.6.0)\n\t                var json = view.model.toJSON();\n\t                for (var key in properties) {\n\t                    if (properties.hasOwnProperty(key)) {\n\t                        if (json[key] !== properties[key]) {\n\t                            return false;\n\t                        }\n\t                    }\n\t                }\n\t                return true;\n\t            });\n\t        },\n\t\n\t        /** A range of views between (and including) viewA and viewB */\n\t        viewRange: function viewRange(viewA, viewB) {\n\t            if (viewA === viewB) {\n\t                return viewA ? [viewA] : [];\n\t            }\n\t\n\t            var indexA = this.views.indexOf(viewA),\n\t                indexB = this.views.indexOf(viewB);\n\t\n\t            // handle not found\n\t            if (indexA === -1 || indexB === -1) {\n\t                if (indexA === indexB) {\n\t                    return [];\n\t                }\n\t                return indexA === -1 ? [viewB] : [viewA];\n\t            }\n\t            // reverse if indeces are\n\t            //note: end inclusive\n\t            return indexA < indexB ? this.views.slice(indexA, indexB + 1) : this.views.slice(indexB, indexA + 1);\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ searching\n\t        /** render a search input for filtering datasets shown\n\t         *      (see SearchableMixin in base-mvc for implementation of the actual searching)\n\t         *      return will start the search\n\t         *      esc will clear the search\n\t         *      clicking the clear button will clear the search\n\t         *      uses searchInput in ui.js\n\t         */\n\t        _renderSearch: function _renderSearch($where) {\n\t            $where.find('.controls .search-input').searchInput({\n\t                placeholder: this.searchPlaceholder,\n\t                initialVal: this.searchFor,\n\t                onfirstsearch: _.bind(this._firstSearch, this),\n\t                onsearch: _.bind(this.searchItems, this),\n\t                onclear: _.bind(this.clearSearch, this)\n\t            });\n\t            return $where;\n\t        },\n\t\n\t        /** What to do on the first search entered */\n\t        _firstSearch: function _firstSearch(searchFor) {\n\t            // override to load model details if necc.\n\t            this.log('onFirstSearch', searchFor);\n\t            return this.searchItems(searchFor);\n\t        },\n\t\n\t        /** filter view list to those that contain the searchFor terms */\n\t        searchItems: function searchItems(searchFor) {\n\t            this.searchFor = searchFor;\n\t            this.trigger('search:searching', searchFor, this);\n\t            this.renderItems();\n\t            this.$('> .controls .search-query').val(searchFor);\n\t            return this;\n\t        },\n\t\n\t        /** clear the search filters and show all views that are normally shown */\n\t        clearSearch: function clearSearch(searchFor) {\n\t            //this.log( 'onSearchClear', this );\n\t            this.searchFor = '';\n\t            this.trigger('search:clear', this);\n\t            this.$('> .controls .search-query').val('');\n\t            this.renderItems();\n\t            return this;\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ selection\n\t        /** @type Integer when the number of list item views is >= to this, don't animate selectors */\n\t        THROTTLE_SELECTORS_AT: 20,\n\t\n\t        /** show selectors on all visible itemViews and associated controls */\n\t        showSelectors: function showSelectors(speed) {\n\t            speed = speed !== undefined ? speed : this.fxSpeed;\n\t            this.selecting = true;\n\t            this.$('.list-actions').slideDown(speed);\n\t            speed = this.views.length >= this.THROTTLE_SELECTORS_AT ? 0 : speed;\n\t            _.each(this.views, function (view) {\n\t                view.showSelector(speed);\n\t            });\n\t            //this.selected = [];\n\t            //this.lastSelected = null;\n\t        },\n\t\n\t        /** hide selectors on all visible itemViews and associated controls */\n\t        hideSelectors: function hideSelectors(speed) {\n\t            speed = speed !== undefined ? speed : this.fxSpeed;\n\t            this.selecting = false;\n\t            this.$('.list-actions').slideUp(speed);\n\t            speed = this.views.length >= this.THROTTLE_SELECTORS_AT ? 0 : speed;\n\t            _.each(this.views, function (view) {\n\t                view.hideSelector(speed);\n\t            });\n\t            this.selected = [];\n\t            this.lastSelected = null;\n\t        },\n\t\n\t        /** show or hide selectors on all visible itemViews and associated controls */\n\t        toggleSelectors: function toggleSelectors() {\n\t            if (!this.selecting) {\n\t                this.showSelectors();\n\t            } else {\n\t                this.hideSelectors();\n\t            }\n\t        },\n\t\n\t        /** select all visible items */\n\t        selectAll: function selectAll(event) {\n\t            _.each(this.views, function (view) {\n\t                view.select(event);\n\t            });\n\t        },\n\t\n\t        /** deselect all visible items */\n\t        deselectAll: function deselectAll(event) {\n\t            this.lastSelected = null;\n\t            _.each(this.views, function (view) {\n\t                view.deselect(event);\n\t            });\n\t        },\n\t\n\t        /** select a range of datasets between A and B */\n\t        selectRange: function selectRange(viewA, viewB) {\n\t            var range = this.viewRange(viewA, viewB);\n\t            _.each(range, function (view) {\n\t                view.select();\n\t            });\n\t            return range;\n\t        },\n\t\n\t        /** return an array of all currently selected itemViews */\n\t        getSelectedViews: function getSelectedViews() {\n\t            return _.filter(this.views, function (v) {\n\t                return v.selected;\n\t            });\n\t        },\n\t\n\t        /** return a collection of the models of all currenly selected items */\n\t        getSelectedModels: function getSelectedModels() {\n\t            return new this.collection.constructor(_.map(this.getSelectedViews(), function (view) {\n\t                return view.model;\n\t            }));\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ loading indicator\n\t        //TODO: questionable\n\t        /** hide the $el and display a loading indicator (in the $el's parent) when loading new data */\n\t        _showLoadingIndicator: function _showLoadingIndicator(msg, speed, callback) {\n\t            this.debug('_showLoadingIndicator', this.indicator, msg, speed, callback);\n\t            speed = speed !== undefined ? speed : this.fxSpeed;\n\t            if (!this.indicator) {\n\t                this.indicator = new LoadingIndicator(this.$el, this.$el.parent());\n\t                this.debug('\\t created', this.indicator);\n\t            }\n\t            if (!this.$el.is(':visible')) {\n\t                this.indicator.show(0, callback);\n\t            } else {\n\t                this.$el.fadeOut(speed);\n\t                this.indicator.show(msg, speed, callback);\n\t            }\n\t        },\n\t\n\t        /** hide the loading indicator */\n\t        _hideLoadingIndicator: function _hideLoadingIndicator(speed, callback) {\n\t            this.debug('_hideLoadingIndicator', this.indicator, speed, callback);\n\t            speed = speed !== undefined ? speed : this.fxSpeed;\n\t            if (this.indicator) {\n\t                this.indicator.hide(speed, callback);\n\t            }\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ scrolling\n\t        /** get the current scroll position of the panel in its parent */\n\t        scrollPosition: function scrollPosition() {\n\t            return this.$scrollContainer().scrollTop();\n\t        },\n\t\n\t        /** set the current scroll position of the panel in its parent */\n\t        scrollTo: function scrollTo(pos, speed) {\n\t            speed = speed || 0;\n\t            this.$scrollContainer().animate({ scrollTop: pos }, speed);\n\t            return this;\n\t        },\n\t\n\t        /** Scrolls the panel to the top. */\n\t        scrollToTop: function scrollToTop(speed) {\n\t            return this.scrollTo(0, speed);\n\t        },\n\t\n\t        /**  */\n\t        scrollToItem: function scrollToItem(view, speed) {\n\t            if (!view) {\n\t                return this;\n\t            }\n\t            //var itemTop = view.$el.offset().top;\n\t            var itemTop = view.el.offsetTop;\n\t            return this.scrollTo(itemTop, speed);\n\t        },\n\t\n\t        /** Scrolls the panel to show the content with the given id. */\n\t        scrollToId: function scrollToId(id, speed) {\n\t            return this.scrollToItem(this.viewFromModelId(id), speed);\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ panel events\n\t        /** event map */\n\t        events: {\n\t            'click .select-all': 'selectAll',\n\t            'click .deselect-all': 'deselectAll'\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ misc\n\t        /** Return a string rep of the panel */\n\t        toString: function toString() {\n\t            return 'ListPanel(' + this.collection + ')';\n\t        }\n\t    });\n\t\n\t    // ............................................................................ TEMPLATES\n\t    /** underscore templates */\n\t    ListPanel.prototype.templates = function () {\n\t        //TODO: move to require text! plugin\n\t\n\t        var elTemplate = BASE_MVC.wrapTemplate([\n\t        // temp container\n\t        '<div>', '<div class=\"controls\"></div>', '<div class=\"list-items\"></div>', '<div class=\"empty-message infomessagesmall\"></div>', '</div>']);\n\t\n\t        var controlsTemplate = BASE_MVC.wrapTemplate(['<div class=\"controls\">', '<div class=\"title\">', '<div class=\"name\"><%- view.title %></div>', '</div>', '<div class=\"subtitle\"><%- view.subtitle %></div>',\n\t        // buttons, controls go here\n\t        '<div class=\"actions\"></div>',\n\t        // deleted msg, etc.\n\t        '<div class=\"messages\"></div>', '<div class=\"search\">', '<div class=\"search-input\"></div>', '</div>',\n\t\n\t        // show when selectors are shown\n\t        '<div class=\"list-actions\">', '<div class=\"btn-group\">', '<button class=\"select-all btn btn-default\"', 'data-mode=\"select\">', _l('All'), '</button>', '<button class=\"deselect-all btn btn-default\"', 'data-mode=\"select\">', _l('None'), '</button>', '</div>', '<div class=\"list-action-menu btn-group\">', '</div>', '</div>', '</div>']);\n\t\n\t        return {\n\t            el: elTemplate,\n\t            controls: controlsTemplate\n\t        };\n\t    }();\n\t\n\t    //=============================================================================\n\t    /** View for a model that has a sub-collection (e.g. History, DatasetCollection)\n\t     *  Allows:\n\t     *      the model to be reset\n\t     *      auto assign panel.collection to panel.model[ panel.modelCollectionKey ]\n\t     *\n\t     */\n\t    var ModelListPanel = ListPanel.extend({\n\t\n\t        /** key of attribute in model to assign to this.collection */\n\t        modelCollectionKey: 'contents',\n\t\n\t        initialize: function initialize(attributes) {\n\t            ListPanel.prototype.initialize.call(this, attributes);\n\t            this.selecting = attributes.selecting !== undefined ? attributes.selecting : false;\n\t\n\t            this.setModel(this.model, attributes);\n\t        },\n\t\n\t        /** release/free/shutdown old models and set up panel for new models\n\t         *  @fires new-model with the panel as parameter\n\t         */\n\t        setModel: function setModel(model, attributes) {\n\t            attributes = attributes || {};\n\t            this.debug(this + '.setModel:', model, attributes);\n\t\n\t            this.freeModel();\n\t            this.freeViews();\n\t\n\t            if (model) {\n\t                var oldModelId = this.model ? this.model.get('id') : null;\n\t\n\t                // set up the new model with user, logger, storage, events\n\t                this.model = model;\n\t                if (this.logger) {\n\t                    this.model.logger = this.logger;\n\t                }\n\t                this._setUpModelListeners();\n\t\n\t                //TODO: relation btwn model, collection becoming tangled here\n\t                // free the collection, and assign the new collection to either\n\t                //  the model[ modelCollectionKey ], attributes.collection, or an empty vanilla collection\n\t                this.collection.off();\n\t                this.collection = this.model[this.modelCollectionKey] ? this.model[this.modelCollectionKey] : attributes.collection || new this.collectionClass([]);\n\t                this._setUpCollectionListeners();\n\t\n\t                if (oldModelId && model.get('id') !== oldModelId) {\n\t                    this.trigger('new-model', this);\n\t                }\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /** free the current model and all listeners for it, free any views for the model */\n\t        freeModel: function freeModel() {\n\t            // stop/release the previous model, and clear cache to sub-views\n\t            if (this.model) {\n\t                this.stopListening(this.model);\n\t                //TODO: see base-mvc\n\t                //this.model.free();\n\t                //this.model = null;\n\t            }\n\t            return this;\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ listening\n\t        /** listening for model events */\n\t        _setUpModelListeners: function _setUpModelListeners() {\n\t            // override\n\t            this.log(this + '._setUpModelListeners', this.model);\n\t            // bounce model errors up to the panel\n\t            this.listenTo(this.model, 'error', function () {\n\t                var args = Array.prototype.slice.call(arguments, 0);\n\t                //args.unshift( 'model:error' );\n\t                args.unshift('error');\n\t                this.trigger.apply(this, args);\n\t            }, this);\n\t            return this;\n\t        },\n\t\n\t        /** Build a temp div containing the new children for the view's $el.\n\t         */\n\t        _renderControls: function _renderControls($newRender) {\n\t            this.debug(this + '(ListPanel)._renderControls');\n\t            var json = this.model ? this.model.toJSON() : {},\n\t                $controls = $(this.templates.controls(json, this));\n\t            $newRender.find('.controls').replaceWith($controls);\n\t            return $controls;\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ misc\n\t        /** Return a string rep of the panel */\n\t        toString: function toString() {\n\t            return 'ModelListPanel(' + this.model + ')';\n\t        }\n\t    });\n\t\n\t    // ............................................................................ TEMPLATES\n\t    /** underscore templates */\n\t    ModelListPanel.prototype.templates = function () {\n\t        //TODO: move to require text! plugin\n\t\n\t        var controlsTemplate = BASE_MVC.wrapTemplate(['<div class=\"controls\">', '<div class=\"title\">',\n\t        //TODO: this is really the only difference - consider factoring titlebar out\n\t        '<div class=\"name\"><%- model.name %></div>', '</div>', '<div class=\"subtitle\"><%- view.subtitle %></div>', '<div class=\"actions\"></div>', '<div class=\"messages\"></div>', '<div class=\"search\">', '<div class=\"search-input\"></div>', '</div>', '<div class=\"list-actions\">', '<div class=\"btn-group\">', '<button class=\"select-all btn btn-default\"', 'data-mode=\"select\">', _l('All'), '</button>', '<button class=\"deselect-all btn btn-default\"', 'data-mode=\"select\">', _l('None'), '</button>', '</div>', '<div class=\"list-action-menu btn-group\">', '</div>', '</div>', '</div>']);\n\t\n\t        return _.extend(_.clone(ListPanel.prototype.templates), {\n\t            controls: controlsTemplate\n\t        });\n\t    }();\n\t\n\t    //=============================================================================\n\t    return {\n\t        ListPanel: ListPanel,\n\t        ModelListPanel: ModelListPanel\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 84 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (baseMVC, _l) {\n\t    // =============================================================================\n\t    /** A view on any model that has a 'tags' attribute (a list of tag strings)\n\t     *      Incorporates the select2 jQuery plugin for tags display/editing:\n\t     *      http://ivaynberg.github.io/select2/\n\t     */\n\t    var TagsEditor = Backbone.View.extend(baseMVC.LoggableMixin).extend(baseMVC.HiddenUntilActivatedViewMixin).extend({\n\t\n\t        tagName: 'div',\n\t        className: 'tags-display',\n\t\n\t        /** Set up listeners, parse options */\n\t        initialize: function initialize(options) {\n\t            //console.debug( this, options );\n\t            // only listen to the model only for changes to tags - re-render\n\t            this.listenTo(this.model, 'change:tags', function () {\n\t                this.render();\n\t            });\n\t            this.hiddenUntilActivated(options.$activator, options);\n\t        },\n\t\n\t        /** Build the DOM elements, call select to on the created input, and set up behaviors */\n\t        render: function render() {\n\t            var view = this;\n\t            this.$el.html(this._template());\n\t\n\t            this.$input().select2({\n\t                placeholder: 'Add tags',\n\t                width: '100%',\n\t                tags: function tags() {\n\t                    // initialize possible tags in the dropdown based on all the tags the user has used so far\n\t                    return view._getTagsUsed();\n\t                }\n\t            });\n\t\n\t            this._setUpBehaviors();\n\t            return this;\n\t        },\n\t\n\t        /** @returns {String} the html text used to build the view's DOM */\n\t        _template: function _template() {\n\t            return [\n\t            //TODO: make prompt optional\n\t            '<label class=\"prompt\">', _l('Tags'), '</label>',\n\t            // set up initial tags by adding as CSV to input vals (necc. to init select2)\n\t            '<input class=\"tags-input\" value=\"', this.tagsToCSV(), '\" />'].join('');\n\t        },\n\t\n\t        /** @returns {String} the sorted, comma-separated tags from the model */\n\t        tagsToCSV: function tagsToCSV() {\n\t            var tagsArray = this.model.get('tags');\n\t            if (!_.isArray(tagsArray) || _.isEmpty(tagsArray)) {\n\t                return '';\n\t            }\n\t            return tagsArray.map(function (tag) {\n\t                return _.escape(tag);\n\t            }).sort().join(',');\n\t        },\n\t\n\t        /** @returns {jQuery} the input for this view */\n\t        $input: function $input() {\n\t            return this.$el.find('input.tags-input');\n\t        },\n\t\n\t        /** @returns {String[]} all tags used by the current user */\n\t        _getTagsUsed: function _getTagsUsed() {\n\t            //TODO: global\n\t            return Galaxy.user.get('tags_used');\n\t        },\n\t\n\t        /** set up any event listeners on the view's DOM (mostly handled by select2) */\n\t        _setUpBehaviors: function _setUpBehaviors() {\n\t            var view = this;\n\t            this.$input().on('change', function (event) {\n\t                // save the model's tags in either remove or added event\n\t                view.model.save({ tags: event.val }, { silent: true });\n\t                // if it's new, add the tag to the users tags\n\t                if (event.added) {\n\t                    //??: solve weird behavior in FF on test.galaxyproject.org where\n\t                    //  event.added.text is string object: 'String{ 0=\"o\", 1=\"n\", 2=\"e\" }'\n\t                    view._addNewTagToTagsUsed(event.added.text + '');\n\t                }\n\t            });\n\t        },\n\t\n\t        /** add a new tag (if not already there) to the list of all tags used by the user\n\t         *  @param {String} newTag  the tag to add to the list of used\n\t         */\n\t        _addNewTagToTagsUsed: function _addNewTagToTagsUsed(newTag) {\n\t            //TODO: global\n\t            var tagsUsed = Galaxy.user.get('tags_used');\n\t            if (!_.contains(tagsUsed, newTag)) {\n\t                tagsUsed.push(newTag);\n\t                tagsUsed.sort();\n\t                Galaxy.user.set('tags_used', tagsUsed);\n\t            }\n\t        },\n\t\n\t        /** shut down event listeners and remove this view's DOM */\n\t        remove: function remove() {\n\t            this.$input.off();\n\t            this.stopListening(this.model);\n\t            Backbone.View.prototype.remove.call(this);\n\t        },\n\t\n\t        /** string rep */\n\t        toString: function toString() {\n\t            return ['TagsEditor(', this.model + '', ')'].join('');\n\t        }\n\t    });\n\t\n\t    // =============================================================================\n\t    return {\n\t        TagsEditor: TagsEditor\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2)))\n\n/***/ },\n/* 85 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $) {'use strict';\n\t\n\t/** This renders the content of the ftp popup **/\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils) {\n\t    return Backbone.View.extend({\n\t        // render\n\t        initialize: function initialize(options) {\n\t            // link options\n\t            this.options = Utils.merge(options, {\n\t                class_add: 'upload-icon-button fa fa-square-o',\n\t                class_remove: 'upload-icon-button fa fa-check-square-o',\n\t                class_partial: 'upload-icon-button fa fa-minus-square-o',\n\t                collection: null,\n\t                onchange: function onchange() {},\n\t                onadd: function onadd() {},\n\t                onremove: function onremove() {}\n\t            });\n\t\n\t            // link this\n\t            var self = this;\n\t\n\t            // link app\n\t            this.collection = this.options.collection;\n\t\n\t            // set template\n\t            this.setElement(this._template());\n\t\n\t            // list of rows\n\t            this.rows = [];\n\t\n\t            // load extension\n\t            Utils.get({\n\t                url: Galaxy.root + 'api/remote_files',\n\t                success: function success(ftp_files) {\n\t                    self._fill(ftp_files);\n\t                },\n\t                error: function error() {\n\t                    self._fill();\n\t                }\n\t            });\n\t        },\n\t\n\t        // fill table\n\t        _fill: function _fill(ftp_files) {\n\t            if (ftp_files && ftp_files.length > 0) {\n\t                // add table\n\t                this.$el.find('#upload-ftp-content').html($(this._templateTable()));\n\t\n\t                // add files to table\n\t                var size = 0;\n\t                for (index in ftp_files) {\n\t                    this.rows.push(this._add(ftp_files[index]));\n\t                    size += ftp_files[index].size;\n\t                }\n\t\n\t                // update stats\n\t                this.$el.find('#upload-ftp-number').html(ftp_files.length + ' files');\n\t                this.$el.find('#upload-ftp-disk').html(Utils.bytesToString(size, true));\n\t\n\t                // add event handler to select/unselect all\n\t                if (this.collection) {\n\t                    var self = this;\n\t                    this.$('._has_collection').show();\n\t                    this.$select_all = $('#upload-selectall');\n\t                    this.$select_all.addClass(this.options.class_add);\n\t                    this.$select_all.on('click', function () {\n\t                        var add = self.$select_all.hasClass(self.options.class_add);\n\t                        for (index in ftp_files) {\n\t                            var ftp_file = ftp_files[index];\n\t                            var model_index = self._find(ftp_file);\n\t                            if (!model_index && add || model_index && !add) {\n\t                                self.rows[index].trigger('click');\n\t                            }\n\t                        }\n\t                    });\n\t                    this._refresh();\n\t                }\n\t            } else {\n\t                this.$el.find('#upload-ftp-content').html($(this._templateInfo()));\n\t            }\n\t            this.$el.find('#upload-ftp-wait').hide();\n\t        },\n\t\n\t        // add\n\t        _add: function _add(ftp_file) {\n\t            // link this\n\t            var self = this;\n\t\n\t            // create new item\n\t            var $it = $(this._templateRow(ftp_file));\n\t\n\t            // identify icon\n\t            var $icon = $it.find('.icon');\n\t\n\t            // append to table\n\t            $(this.el).find('tbody').append($it);\n\t\n\t            // collection mode with add/remove triggers\n\t            if (this.collection) {\n\t                // find model and set initial 'add' icon class\n\t                var icon_class = '';\n\t                if (this._find(ftp_file)) {\n\t                    icon_class = this.options.class_remove;\n\t                } else {\n\t                    icon_class = this.options.class_add;\n\t                }\n\t                $icon.addClass(icon_class);\n\t\n\t                // click triggers add/remove events\n\t                $it.on('click', function () {\n\t                    var model_index = self._find(ftp_file);\n\t                    $icon.removeClass();\n\t                    if (!model_index) {\n\t                        self.options.onadd(ftp_file);\n\t                        $icon.addClass(self.options.class_remove);\n\t                    } else {\n\t                        self.options.onremove(model_index);\n\t                        $icon.addClass(self.options.class_add);\n\t                    }\n\t                    self._refresh();\n\t                });\n\t            } else {\n\t                // click triggers only change\n\t                $it.on('click', function () {\n\t                    self.options.onchange(ftp_file);\n\t                });\n\t            }\n\t\n\t            // return dom handler\n\t            return $it;\n\t        },\n\t\n\t        // refresh\n\t        _refresh: function _refresh() {\n\t            var filtered = this.collection.where({ file_mode: 'ftp', enabled: true });\n\t            this.$select_all.removeClass();\n\t            if (filtered.length == 0) {\n\t                this.$select_all.addClass(this.options.class_add);\n\t            } else {\n\t                if (filtered.length == this.rows.length) {\n\t                    this.$select_all.addClass(this.options.class_remove);\n\t                } else {\n\t                    this.$select_all.addClass(this.options.class_partial);\n\t                }\n\t            }\n\t        },\n\t\n\t        // get model index\n\t        _find: function _find(ftp_file) {\n\t            var item = this.collection.findWhere({\n\t                file_path: ftp_file.path,\n\t                file_mode: 'ftp',\n\t                enabled: true\n\t            });\n\t            return item && item.get('id');\n\t        },\n\t\n\t        // template row\n\t        _templateRow: function _templateRow(options) {\n\t            return '<tr class=\"upload-ftp-row\">' + '<td class=\"_has_collection\" style=\"display: none;\"><div class=\"icon\"/></td>' + '<td class=\"ftp-name\">' + options.path + '</td>' + '<td class=\"ftp-size\">' + Utils.bytesToString(options.size) + '</td>' + '<td class=\"ftp-time\">' + options.ctime + '</td>' + '</tr>';\n\t        },\n\t\n\t        // load table template\n\t        _templateTable: function _templateTable() {\n\t            return '<span style=\"whitespace: nowrap; float: left;\">Available files: </span>' + '<span style=\"whitespace: nowrap; float: right;\">' + '<span class=\"upload-icon fa fa-file-text-o\"/>' + '<span id=\"upload-ftp-number\"/>&nbsp;&nbsp;' + '<span class=\"upload-icon fa fa-hdd-o\"/>' + '<span id=\"upload-ftp-disk\"/>' + '</span>' + '<table class=\"grid\" style=\"float: left;\">' + '<thead>' + '<tr>' + '<th class=\"_has_collection\" style=\"display: none;\"><div id=\"upload-selectall\"></th>' + '<th>Name</th>' + '<th>Size</th>' + '<th>Created</th>' + '</tr>' + '</thead>' + '<tbody/>' + '</table>';\n\t        },\n\t\n\t        // load table template\n\t        _templateInfo: function _templateInfo() {\n\t            return '<div class=\"upload-ftp-warning warningmessage\">' + 'Your FTP directory does not contain any files.' + '</div>';\n\t        },\n\t\n\t        // load html template\n\t        _template: function _template() {\n\t            return '<div class=\"upload-ftp\">' + '<div id=\"upload-ftp-wait\" class=\"upload-ftp-wait fa fa-spinner fa-spin\"/>' + '<div class=\"upload-ftp-help\">This Galaxy server allows you to upload files via FTP. To upload some files, log in to the FTP server at <strong>' + this.options.ftp_upload_site + '</strong> using your Galaxy credentials (email address and password).</div>' + '<div id=\"upload-ftp-content\"/>' + '<div>';\n\t        }\n\t    });\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1)))\n\n/***/ },\n/* 86 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {'use strict';\n\t\n\t/** This renders the content of the settings popup, allowing users to specify flags i.e. for space-to-tab conversion **/\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils) {\n\t    return Backbone.View.extend({\n\t        options: {\n\t            class_check: 'fa-check-square-o',\n\t            class_uncheck: 'fa-square-o',\n\t            parameters: [{\n\t                id: 'space_to_tab',\n\t                title: 'Convert spaces to tabs'\n\t            }, {\n\t                id: 'to_posix_lines',\n\t                title: 'Use POSIX standard'\n\t            }]\n\t        },\n\t\n\t        initialize: function initialize(options) {\n\t            var self = this;\n\t            this.model = options.model;\n\t            this.setElement($('<div/>').addClass('upload-settings'));\n\t            this.$el.append($('<div/>').addClass('upload-settings-cover'));\n\t            this.$el.append($('<table/>').addClass('upload-settings-table ui-table-striped').append('<tbody/>'));\n\t            this.$cover = this.$('.upload-settings-cover');\n\t            this.$table = this.$('.upload-settings-table > tbody');\n\t            this.listenTo(this.model, 'change', this.render, this);\n\t            this.model.trigger('change');\n\t        },\n\t\n\t        render: function render() {\n\t            var self = this;\n\t            this.$table.empty();\n\t            _.each(this.options.parameters, function (parameter) {\n\t                var $checkbox = $('<div/>').addClass('upload-' + parameter.id + ' upload-icon-button fa').addClass(self.model.get(parameter.id) && self.options.class_check || self.options.class_uncheck).on('click', function () {\n\t                    self.model.get('enabled') && self.model.set(parameter.id, !self.model.get(parameter.id));\n\t                });\n\t                self.$table.append($('<tr/>').append($('<td/>').append($checkbox)).append($('<td/>').append(parameter.title)));\n\t            });\n\t            this.$cover[this.model.get('enabled') && 'hide' || 'show']();\n\t        }\n\t    });\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n/* 87 */,\n/* 88 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(jQuery, $) {'use strict';\n\t\n\t(function (factory) {\n\t    if (true) {\n\t        !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory), __WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ? (__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t    } else {\n\t        // Browser globals\n\t        factory(jQuery);\n\t    }\n\t})(function () {\n\t    //=============================================================================\n\t\n\t    jQuery.fn.extend({\n\t        hoverhighlight: function $hoverhighlight(scope, color) {\n\t            scope = scope || 'body';\n\t            if (!this.length) {\n\t                return this;\n\t            }\n\t\n\t            $(this).each(function () {\n\t                var $this = $(this),\n\t                    targetSelector = $this.data('target');\n\t\n\t                if (targetSelector) {\n\t                    $this.mouseover(function (ev) {\n\t                        $(targetSelector, scope).css({\n\t                            background: color\n\t                        });\n\t                    }).mouseout(function (ev) {\n\t                        $(targetSelector).css({\n\t                            background: ''\n\t                        });\n\t                    });\n\t                }\n\t            });\n\t            return this;\n\t        }\n\t    });\n\t});\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1), __webpack_require__(1)))\n\n/***/ },\n/* 89 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function($, jQuery) {'use strict';\n\t\n\t// from: https://raw.githubusercontent.com/umdjs/umd/master/jqueryPlugin.js\n\t// Uses AMD or browser globals to create a jQuery plugin.\n\t(function (factory) {\n\t    if (true) {\n\t        //TODO: So...this turns out to be an all or nothing thing. If I load jQuery in the define below, it will\n\t        //  (of course) wipe the old jquery *and all the plugins loaded into it*. So the define below *is still\n\t        //  relying on jquery being loaded globally* in order to preserve plugins.\n\t        !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory), __WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ? (__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t    } else {\n\t        // Browser globals\n\t        factory(jQuery);\n\t    }\n\t})(function () {\n\t    var _l = window._l || function (s) {\n\t        return s;\n\t    };\n\t\n\t    /** searchInput: (jQuery plugin)\n\t     *      Creates a search input, a clear button, and loading indicator\n\t     *      within the selected node.\n\t     *\n\t     *      When the user either presses return or enters some minimal number\n\t     *      of characters, a callback is called. Pressing ESC when the input\n\t     *      is focused will clear the input and call a separate callback.\n\t     */\n\t    function searchInput(parentNode, options) {\n\t        //TODO: consolidate with tool menu functionality, use there\n\t        var KEYCODE_ESC = 27,\n\t            KEYCODE_RETURN = 13,\n\t            $parentNode = $(parentNode),\n\t            firstSearch = true,\n\t            defaults = {\n\t            initialVal: '',\n\t            name: 'search',\n\t            placeholder: 'search',\n\t            classes: '',\n\t            onclear: function onclear() {},\n\t            onfirstsearch: null,\n\t            onsearch: function onsearch(inputVal) {},\n\t            minSearchLen: 0,\n\t            escWillClear: true,\n\t            oninit: function oninit() {}\n\t        };\n\t\n\t        // .................................................................... input rendering and events\n\t        // visually clear the search, trigger an event, and call the callback\n\t        function clearSearchInput(event) {\n\t            var $input = $(this).parent().children('input');\n\t            //console.debug( this, 'clear', $input );\n\t            $input.focus().val('').trigger('clear:searchInput');\n\t            options.onclear();\n\t        }\n\t\n\t        // search for searchTerms, trigger an event, call the appropo callback (based on whether this is the first)\n\t        function search(event, searchTerms) {\n\t            //console.debug( this, 'searching', searchTerms );\n\t            //TODO: I don't think this is classic jq custom event form? search.searchInput?\n\t            $(this).trigger('search:searchInput', searchTerms);\n\t            if (typeof options.onfirstsearch === 'function' && firstSearch) {\n\t                firstSearch = false;\n\t                options.onfirstsearch(searchTerms);\n\t            } else {\n\t                options.onsearch(searchTerms);\n\t            }\n\t        }\n\t\n\t        // .................................................................... input rendering and events\n\t        function inputTemplate() {\n\t            // class search-query is bootstrap 2.3 style that now lives in base.less\n\t            return ['<input type=\"text\" name=\"', options.name, '\" placeholder=\"', options.placeholder, '\" ', 'class=\"search-query ', options.classes, '\" ', '/>'].join('');\n\t        }\n\t\n\t        // the search input that responds to keyboard events and displays the search value\n\t        function $input() {\n\t            return $(inputTemplate())\n\t            // select all text on a focus\n\t            .focus(function (event) {\n\t                $(this).select();\n\t            })\n\t            // attach behaviors to esc, return if desired, search on some min len string\n\t            .keyup(function (event) {\n\t                event.preventDefault();\n\t                event.stopPropagation();\n\t                //TODO: doesn't work\n\t                if (!$(this).val()) {\n\t                    $(this).blur();\n\t                }\n\t\n\t                // esc key will clear if desired\n\t                if (event.which === KEYCODE_ESC && options.escWillClear) {\n\t                    clearSearchInput.call(this, event);\n\t                } else {\n\t                    var searchTerms = $(this).val();\n\t                    // return key or the search string len > minSearchLen (if not 0) triggers search\n\t                    if (event.which === KEYCODE_RETURN || options.minSearchLen && searchTerms.length >= options.minSearchLen) {\n\t                        search.call(this, event, searchTerms);\n\t                    } else if (!searchTerms.length) {\n\t                        clearSearchInput.call(this, event);\n\t                    }\n\t                }\n\t            }).on('change', function (event) {\n\t                search.call(this, event, $(this).val());\n\t            }).val(options.initialVal);\n\t        }\n\t\n\t        // .................................................................... clear button rendering and events\n\t        // a button for clearing the search bar, placed on the right hand side\n\t        function $clearBtn() {\n\t            return $(['<span class=\"search-clear fa fa-times-circle\" ', 'title=\"', _l('clear search (esc)'), '\"></span>'].join('')).tooltip({ placement: 'bottom' }).click(function (event) {\n\t                clearSearchInput.call(this, event);\n\t            });\n\t        }\n\t\n\t        // .................................................................... loadingIndicator rendering\n\t        // a button for clearing the search bar, placed on the right hand side\n\t        function $loadingIndicator() {\n\t            return $(['<span class=\"search-loading fa fa-spinner fa-spin\" ', 'title=\"', _l('loading...'), '\"></span>'].join('')).hide().tooltip({ placement: 'bottom' });\n\t        }\n\t\n\t        // .................................................................... commands\n\t        // visually swap the load, clear buttons\n\t        function toggleLoadingIndicator() {\n\t            $parentNode.find('.search-loading').toggle();\n\t            $parentNode.find('.search-clear').toggle();\n\t        }\n\t\n\t        // .................................................................... init\n\t        // string command (not constructor)\n\t        if (jQuery.type(options) === 'string') {\n\t            if (options === 'toggle-loading') {\n\t                toggleLoadingIndicator();\n\t            }\n\t            return $parentNode;\n\t        }\n\t\n\t        // initial render\n\t        if (jQuery.type(options) === 'object') {\n\t            options = jQuery.extend(true, {}, defaults, options);\n\t        }\n\t        //NOTE: prepended\n\t        return $parentNode.addClass('search-input').prepend([$input(), $clearBtn(), $loadingIndicator()]);\n\t    }\n\t\n\t    // as jq plugin\n\t    jQuery.fn.extend({\n\t        searchInput: function $searchInput(options) {\n\t            return this.each(function () {\n\t                return searchInput(this, options);\n\t            });\n\t        }\n\t    });\n\t});\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1), __webpack_require__(1)))\n\n/***/ },\n/* 90 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;'use strict';\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t    // Alphanumeric/natural sort fn\n\t    function naturalSort(a, b) {\n\t        // setup temp-scope variables for comparison evauluation\n\t        var re = /(-?[0-9\\.]+)/g,\n\t            x = a.toString().toLowerCase() || '',\n\t            y = b.toString().toLowerCase() || '',\n\t            nC = String.fromCharCode(0),\n\t            xN = x.replace(re, nC + '$1' + nC).split(nC),\n\t            yN = y.replace(re, nC + '$1' + nC).split(nC),\n\t            xD = new Date(x).getTime(),\n\t            yD = xD ? new Date(y).getTime() : null;\n\t        // natural sorting of dates\n\t        if (yD) {\n\t            if (xD < yD) {\n\t                return -1;\n\t            } else if (xD > yD) {\n\t                return 1;\n\t            }\n\t        }\n\t        // natural sorting through split numeric strings and default strings\n\t        var oFxNcL, oFyNcL;\n\t        for (var cLoc = 0, numS = Math.max(xN.length, yN.length); cLoc < numS; cLoc++) {\n\t            oFxNcL = parseFloat(xN[cLoc]) || xN[cLoc];\n\t            oFyNcL = parseFloat(yN[cLoc]) || yN[cLoc];\n\t            if (oFxNcL < oFyNcL) {\n\t                return -1;\n\t            } else if (oFxNcL > oFyNcL) {\n\t                return 1;\n\t            }\n\t        }\n\t        return 0;\n\t    }\n\t\n\t    return naturalSort;\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n/* 91 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* WEBPACK VAR INJECTION */(function(jQuery, _) {'use strict';\n\t\n\t/*\n\t    galaxy upload plugins - requires FormData and XMLHttpRequest\n\t*/\n\t;(function ($) {\n\t    // add event properties\n\t    jQuery.event.props.push(\"dataTransfer\");\n\t\n\t    /**\n\t        Posts file data to the API\n\t    */\n\t    $.uploadpost = function (config) {\n\t        // parse options\n\t        var cnf = $.extend({}, {\n\t            data: {},\n\t            success: function success() {},\n\t            error: function error() {},\n\t            progress: function progress() {},\n\t            url: null,\n\t            maxfilesize: 2048,\n\t            error_filesize: 'File exceeds 2GB. Please use a FTP client.',\n\t            error_default: 'Please make sure the file is available.',\n\t            error_server: 'Upload request failed.',\n\t            error_login: 'Uploads require you to log in.'\n\t        }, config);\n\t\n\t        // link data\n\t        var data = cnf.data;\n\t\n\t        // check errors\n\t        if (data.error_message) {\n\t            cnf.error(data.error_message);\n\t            return;\n\t        }\n\t\n\t        // construct form data\n\t        var form = new FormData();\n\t        for (var key in data.payload) {\n\t            form.append(key, data.payload[key]);\n\t        }\n\t\n\t        // add files to submission\n\t        var sizes = 0;\n\t        for (var key in data.files) {\n\t            var d = data.files[key];\n\t            form.append(d.name, d.file, d.file.name);\n\t            sizes += d.file.size;\n\t        }\n\t\n\t        // check file size, unless it's an ftp file\n\t        if (sizes > 1048576 * cnf.maxfilesize) {\n\t            cnf.error(cnf.error_filesize);\n\t            return;\n\t        }\n\t\n\t        // prepare request\n\t        xhr = new XMLHttpRequest();\n\t        xhr.open('POST', cnf.url, true);\n\t        xhr.setRequestHeader('Accept', 'application/json');\n\t        xhr.setRequestHeader('Cache-Control', 'no-cache');\n\t        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n\t\n\t        // captures state changes\n\t        xhr.onreadystatechange = function () {\n\t            // check for request completed, server connection closed\n\t            if (xhr.readyState == xhr.DONE) {\n\t                // parse response\n\t                var response = null;\n\t                if (xhr.responseText) {\n\t                    try {\n\t                        response = jQuery.parseJSON(xhr.responseText);\n\t                    } catch (e) {\n\t                        response = xhr.responseText;\n\t                    }\n\t                }\n\t                // pass any error to the error option\n\t                if (xhr.status < 200 || xhr.status > 299) {\n\t                    var text = xhr.statusText;\n\t                    if (xhr.status == 403) {\n\t                        text = cnf.error_login;\n\t                    } else if (xhr.status == 0) {\n\t                        text = cnf.error_server;\n\t                    } else if (!text) {\n\t                        text = cnf.error_default;\n\t                    }\n\t                    cnf.error(text + ' (' + xhr.status + ')');\n\t                } else {\n\t                    cnf.success(response);\n\t                }\n\t            }\n\t        };\n\t\n\t        // prepare upload progress\n\t        xhr.upload.addEventListener('progress', function (e) {\n\t            if (e.lengthComputable) {\n\t                cnf.progress(Math.round(e.loaded * 100 / e.total));\n\t            }\n\t        }, false);\n\t\n\t        // send request\n\t        Galaxy.emit.debug('uploadbox::uploadpost()', 'Posting following data.', cnf);\n\t        xhr.send(form);\n\t    };\n\t\n\t    /**\n\t        Handles the upload events drag/drop etc.\n\t    */\n\t    $.fn.uploadinput = function (options) {\n\t        // initialize\n\t        var el = this;\n\t        var opts = $.extend({}, {\n\t            ondragover: function ondragover() {},\n\t            ondragleave: function ondragleave() {},\n\t            onchange: function onchange() {},\n\t            multiple: false\n\t        }, options);\n\t\n\t        // append hidden upload field\n\t        var $input = $('<input type=\"file\" style=\"display: none\" ' + (opts.multiple && 'multiple' || '') + '/>');\n\t        el.append($input.change(function (e) {\n\t            opts.onchange(e.target.files);\n\t            $(this).val('');\n\t        }));\n\t\n\t        // drag/drop events\n\t        el.on('drop', function (e) {\n\t            opts.ondragleave(e);\n\t            if (e.dataTransfer) {\n\t                opts.onchange(e.dataTransfer.files);\n\t                e.preventDefault();\n\t            }\n\t        });\n\t        el.on('dragover', function (e) {\n\t            e.preventDefault();\n\t            opts.ondragover(e);\n\t        });\n\t        el.on('dragleave', function (e) {\n\t            e.stopPropagation();\n\t            opts.ondragleave(e);\n\t        });\n\t\n\t        // exports\n\t        return {\n\t            dialog: function dialog() {\n\t                $input.trigger('click');\n\t            }\n\t        };\n\t    };\n\t\n\t    /**\n\t        Handles the upload queue and events such as drag/drop etc.\n\t    */\n\t    $.fn.uploadbox = function (options) {\n\t        // parse options\n\t        var opts = $.extend({}, {\n\t            dragover: function dragover() {},\n\t            dragleave: function dragleave() {},\n\t            announce: function announce(d) {},\n\t            initialize: function initialize(d) {},\n\t            progress: function progress(d, m) {},\n\t            success: function success(d, m) {},\n\t            error: function error(d, m) {\n\t                alert(m);\n\t            },\n\t            complete: function complete() {}\n\t        }, options);\n\t\n\t        // file queue\n\t        var queue = {};\n\t\n\t        // queue index/length counter\n\t        var queue_index = 0;\n\t        var queue_length = 0;\n\t\n\t        // indicates if queue is currently running\n\t        var queue_running = false;\n\t        var queue_stop = false;\n\t\n\t        // element\n\t        var uploadinput = $(this).uploadinput({\n\t            multiple: true,\n\t            onchange: function onchange(files) {\n\t                add(files);\n\t            },\n\t            ondragover: options.ondragover,\n\t            ondragleave: options.ondragleave\n\t        });\n\t\n\t        // add new files to upload queue\n\t        function add(files) {\n\t            if (files && files.length && !queue_running) {\n\t                var current_index = queue_index;\n\t                _.each(files, function (file, key) {\n\t                    if (file.mode !== 'new' && _.filter(queue, function (f) {\n\t                        return f.name === file.name && f.size === file.size;\n\t                    }).length) {\n\t                        file.duplicate = true;\n\t                    }\n\t                });\n\t                _.each(files, function (file) {\n\t                    if (!file.duplicate) {\n\t                        var index = String(queue_index++);\n\t                        queue[index] = file;\n\t                        opts.announce(index, queue[index]);\n\t                        queue_length++;\n\t                    }\n\t                });\n\t                return current_index;\n\t            }\n\t        }\n\t\n\t        // remove file from queue\n\t        function remove(index) {\n\t            if (queue[index]) {\n\t                delete queue[index];\n\t                queue_length--;\n\t            }\n\t        }\n\t\n\t        // process an upload, recursive\n\t        function process() {\n\t            // validate\n\t            if (queue_length == 0 || queue_stop) {\n\t                queue_stop = false;\n\t                queue_running = false;\n\t                opts.complete();\n\t                return;\n\t            } else {\n\t                queue_running = true;\n\t            }\n\t\n\t            // get an identifier from the queue\n\t            var index = -1;\n\t            for (var key in queue) {\n\t                index = key;\n\t                break;\n\t            }\n\t\n\t            // get current file from queue\n\t            var file = queue[index];\n\t\n\t            // remove from queue\n\t            remove(index);\n\t\n\t            // create and submit data\n\t            $.uploadpost({\n\t                url: opts.url,\n\t                data: opts.initialize(index),\n\t                success: function success(message) {\n\t                    opts.success(index, message);process();\n\t                },\n\t                error: function error(message) {\n\t                    opts.error(index, message);process();\n\t                },\n\t                progress: function progress(percentage) {\n\t                    opts.progress(index, percentage);\n\t                }\n\t            });\n\t        }\n\t\n\t        /*\n\t            public interface\n\t        */\n\t\n\t        // open file browser for selection\n\t        function select() {\n\t            uploadinput.dialog();\n\t        }\n\t\n\t        // remove all entries from queue\n\t        function reset(index) {\n\t            for (index in queue) {\n\t                remove(index);\n\t            }\n\t        }\n\t\n\t        // initiate upload process\n\t        function start() {\n\t            if (!queue_running) {\n\t                queue_running = true;\n\t                process();\n\t            }\n\t        }\n\t\n\t        // stop upload process\n\t        function stop() {\n\t            queue_stop = true;\n\t        }\n\t\n\t        // set options\n\t        function configure(options) {\n\t            opts = $.extend({}, opts, options);\n\t            return opts;\n\t        }\n\t\n\t        // verify browser compatibility\n\t        function compatible() {\n\t            return window.File && window.FormData && window.XMLHttpRequest && window.FileList;\n\t        }\n\t\n\t        // export functions\n\t        return {\n\t            'select': select,\n\t            'add': add,\n\t            'remove': remove,\n\t            'start': start,\n\t            'stop': stop,\n\t            'reset': reset,\n\t            'configure': configure,\n\t            'compatible': compatible\n\t        };\n\t    };\n\t})(jQuery);\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n/* 92 */,\n/* 93 */,\n/* 94 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar RightPanel = __webpack_require__(10).RightPanel,\n\t    Ui = __webpack_require__(7),\n\t    historyOptionsMenu = __webpack_require__(114),\n\t    CurrentHistoryView = __webpack_require__(111).CurrentHistoryView,\n\t    _l = __webpack_require__(5);\n\t\n\t/** the right hand panel in the analysis page that shows the current history */\n\tvar HistoryPanel = RightPanel.extend({\n\t\n\t    title: _l('History'),\n\t\n\t    initialize: function initialize(options) {\n\t        RightPanel.prototype.initialize.call(this, options);\n\t        var self = this;\n\t\n\t        // this button re-fetches the history and contents and re-renders the history panel\n\t        this.refreshButton = new Ui.ButtonLink({\n\t            id: 'history-refresh-button',\n\t            title: _l('Refresh history'),\n\t            cls: 'panel-header-button',\n\t            icon: 'fa fa-refresh',\n\t            onclick: function onclick() {\n\t                self.historyView.loadCurrentHistory();\n\t            }\n\t        });\n\t        // opens a drop down menu with history related functions (like view all, delete, share, etc.)\n\t        this.optionsButton = new Ui.ButtonLink({\n\t            id: 'history-options-button',\n\t            title: _l('History options'),\n\t            cls: 'panel-header-button',\n\t            icon: 'fa fa-cog'\n\t        });\n\t        // goes to a page showing all the users histories in panel form (for logged in users)\n\t        this.viewMultiButton = null;\n\t        if (!options.userIsAnonymous) {\n\t            this.viewMultiButton = new Ui.ButtonLink({\n\t                id: 'history-view-multi-button',\n\t                title: _l('View all histories'),\n\t                cls: 'panel-header-button',\n\t                icon: 'fa fa-columns',\n\t                href: options.galaxyRoot + 'history/view_multiple'\n\t            });\n\t        }\n\t\n\t        // build history options menu\n\t        this.optionsMenu = historyOptionsMenu(this.optionsButton.$el, {\n\t            anonymous: options.userIsAnonymous,\n\t            purgeAllowed: options.allow_user_dataset_purge,\n\t            root: options.galaxyRoot\n\t        });\n\t\n\t        // view of the current history\n\t        this.historyView = new CurrentHistoryView({\n\t            purgeAllowed: options.allow_user_dataset_purge,\n\t            linkTarget: 'galaxy_main',\n\t            $scrollContainer: function $scrollContainer() {\n\t                return this.$el.parent();\n\t            }\n\t        });\n\t    },\n\t\n\t    render: function render() {\n\t        RightPanel.prototype.render.call(this);\n\t        this.$('.unified-panel-header').addClass('history-panel-header');\n\t        this.$('.panel-header-buttons').append([this.refreshButton.$el, this.optionsButton.$el, this.viewMultiButton ? this.viewMultiButton.$el : null]);\n\t        this.historyView.setElement(this.$('.history-panel'));\n\t        // causes blink/flash due to loadCurrentHistory rendering as well\n\t        // .render();\n\t    },\n\t\n\t    _templateBody: function _templateBody(data) {\n\t        return ['<div class=\"unified-panel-body unified-panel-body-background\">', '<div id=\"current-history-panel\" class=\"history-panel\"/>', '</div>'].join('');\n\t    },\n\t\n\t    toString: function toString() {\n\t        return 'HistoryPanel';\n\t    }\n\t});\n\t\n\tmodule.exports = HistoryPanel;\n\n/***/ },\n/* 95 */,\n/* 96 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* WEBPACK VAR INJECTION */(function($, _) {'use strict';\n\t\n\tvar LeftPanel = __webpack_require__(10).LeftPanel,\n\t    Tools = __webpack_require__(53),\n\t    Upload = __webpack_require__(121),\n\t    _l = __webpack_require__(5);\n\t\n\t/* Builds the tool menu panel on the left of the analysis page */\n\tvar ToolPanel = LeftPanel.extend({\n\t\n\t    title: _l('Tools'),\n\t\n\t    initialize: function initialize(options) {\n\t        LeftPanel.prototype.initialize.call(this, options);\n\t        this.log(this + '.initialize:', options);\n\t\n\t        /** @type {Object[]} descriptions of user's workflows to be shown in the tool menu */\n\t        this.stored_workflow_menu_entries = options.stored_workflow_menu_entries || [];\n\t\n\t        // create tool search, tool panel, and tool panel view.\n\t        var tool_search = new Tools.ToolSearch({\n\t            search_url: options.search_url,\n\t            hidden: false\n\t        });\n\t        var tools = new Tools.ToolCollection(options.toolbox);\n\t        this.tool_panel = new Tools.ToolPanel({\n\t            tool_search: tool_search,\n\t            tools: tools,\n\t            layout: options.toolbox_in_panel\n\t        });\n\t        this.tool_panel_view = new Tools.ToolPanelView({ model: this.tool_panel });\n\t\n\t        // add upload modal\n\t        this.uploadButton = new Upload({\n\t            nginx_upload_path: options.nginx_upload_path,\n\t            ftp_upload_site: options.ftp_upload_site,\n\t            default_genome: options.default_genome,\n\t            default_extension: options.default_extension\n\t        });\n\t    },\n\t\n\t    render: function render() {\n\t        var self = this;\n\t        LeftPanel.prototype.render.call(self);\n\t        self.$('.panel-header-buttons').append(self.uploadButton.$el);\n\t\n\t        // if there are tools, render panel and display everything\n\t        if (self.tool_panel.get('layout').size() > 0) {\n\t            self.tool_panel_view.render();\n\t            //TODO: why the hide/show?\n\t            self.$('.toolMenu').show();\n\t        }\n\t        self.$('.toolMenuContainer').prepend(self.tool_panel_view.$el);\n\t\n\t        self._renderWorkflowMenu();\n\t\n\t        // if a tool link has the minsizehint attribute, handle it here (gen. by hiding the tool panel)\n\t        self.$('a[minsizehint]').click(function () {\n\t            if (parent.handle_minwidth_hint) {\n\t                parent.handle_minwidth_hint($(self).attr('minsizehint'));\n\t            }\n\t        });\n\t    },\n\t\n\t    /** build the dom for the workflow portion of the tool menu */\n\t    _renderWorkflowMenu: function _renderWorkflowMenu() {\n\t        var self = this;\n\t        // add internal workflow list\n\t        self.$('#internal-workflows').append(self._templateTool({\n\t            title: _l('All workflows'),\n\t            href: 'workflow/list_for_run'\n\t        }));\n\t        _.each(self.stored_workflow_menu_entries, function (menu_entry) {\n\t            self.$('#internal-workflows').append(self._templateTool({\n\t                title: menu_entry.stored_workflow.name,\n\t                href: 'workflow/run?id=' + menu_entry.encoded_stored_workflow_id\n\t            }));\n\t        });\n\t    },\n\t\n\t    /** build a link to one tool */\n\t    _templateTool: function _templateTool(tool) {\n\t        return ['<div class=\"toolTitle\">',\n\t        // global\n\t        '<a href=\"', Galaxy.root, tool.href, '\" target=\"galaxy_main\">', tool.title, '</a>', '</div>'].join('');\n\t    },\n\t\n\t    /** override to include inital menu dom and workflow section */\n\t    _templateBody: function _templateBody() {\n\t        return ['<div class=\"unified-panel-body unified-panel-body-background\">', '<div class=\"toolMenuContainer\">', '<div class=\"toolMenu\" style=\"display: none\">', '<div id=\"search-no-results\" style=\"display: none; padding-top: 5px\">', '<em><strong>', _l('Search did not match any tools.'), '</strong></em>', '</div>', '</div>', '<div class=\"toolSectionPad\"/>', '<div class=\"toolSectionPad\"/>', '<div class=\"toolSectionTitle\" id=\"title_XXinternalXXworkflow\">', '<span>', _l('Workflows'), '</span>', '</div>', '<div id=\"internal-workflows\" class=\"toolSectionBody\">', '<div class=\"toolSectionBg\"/>', '</div>', '</div>', '</div>'].join('');\n\t    },\n\t\n\t    toString: function toString() {\n\t        return 'ToolPanel';\n\t    }\n\t});\n\t\n\tmodule.exports = ToolPanel;\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n/* 97 */,\n/* 98 */,\n/* 99 */,\n/* 100 */,\n/* 101 */,\n/* 102 */,\n/* 103 */,\n/* 104 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(jQuery, _) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(38), __webpack_require__(77), __webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (DC_LI, DATASET_LI_EDIT, BASE_MVC, _l) {\n\t\n\t    'use strict';\n\t    //==============================================================================\n\t\n\t    var DCListItemView = DC_LI.DCListItemView;\n\t    /** @class Edit view for DatasetCollection.\n\t     */\n\t    var DCListItemEdit = DCListItemView.extend(\n\t    /** @lends DCListItemEdit.prototype */{\n\t        //TODO: may not be needed\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        /** override to add linkTarget */\n\t        initialize: function initialize(attributes) {\n\t            DCListItemView.prototype.initialize.call(this, attributes);\n\t        },\n\t\n\t        // ......................................................................... misc\n\t        /** String representation */\n\t        toString: function toString() {\n\t            var modelString = this.model ? this.model + '' : '(no model)';\n\t            return 'DCListItemEdit(' + modelString + ')';\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    var DCEListItemView = DC_LI.DCEListItemView;\n\t    /** @class Read only view for DatasetCollectionElement.\n\t     */\n\t    var DCEListItemEdit = DCEListItemView.extend(\n\t    /** @lends DCEListItemEdit.prototype */{\n\t        //TODO: this might be expendable - compacted with HDAListItemView\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        /** set up */\n\t        initialize: function initialize(attributes) {\n\t            DCEListItemView.prototype.initialize.call(this, attributes);\n\t        },\n\t\n\t        // ......................................................................... misc\n\t        /** String representation */\n\t        toString: function toString() {\n\t            var modelString = this.model ? this.model + '' : '(no model)';\n\t            return 'DCEListItemEdit(' + modelString + ')';\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    // NOTE: this does not inherit from DatasetDCEListItemView as you would expect\n\t    //TODO: but should - if we can find something simpler than using diamond\n\t    /** @class Editable view for a DatasetCollectionElement that is also an DatasetAssociation\n\t     *      (a dataset contained in a dataset collection).\n\t     */\n\t    var DatasetDCEListItemEdit = DATASET_LI_EDIT.DatasetListItemEdit.extend(\n\t    /** @lends DatasetDCEListItemEdit.prototype */{\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        /** set up */\n\t        initialize: function initialize(attributes) {\n\t            DATASET_LI_EDIT.DatasetListItemEdit.prototype.initialize.call(this, attributes);\n\t        },\n\t\n\t        // NOTE: this does not inherit from DatasetDCEListItemView - so we duplicate this here\n\t        //TODO: fix\n\t        /** In this override, only get details if in the ready state.\n\t         *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n\t         */\n\t        _fetchModelDetails: function _fetchModelDetails() {\n\t            var view = this;\n\t            if (view.model.inReadyState() && !view.model.hasDetails()) {\n\t                return view.model.fetch({ silent: true });\n\t            }\n\t            return jQuery.when();\n\t        },\n\t\n\t        /** Override to remove delete button */\n\t        _renderDeleteButton: function _renderDeleteButton() {\n\t            return null;\n\t        },\n\t\n\t        // ......................................................................... misc\n\t        /** String representation */\n\t        toString: function toString() {\n\t            var modelString = this.model ? this.model + '' : '(no model)';\n\t            return 'DatasetDCEListItemEdit(' + modelString + ')';\n\t        }\n\t    });\n\t\n\t    // ............................................................................ TEMPLATES\n\t    /** underscore templates */\n\t    DatasetDCEListItemEdit.prototype.templates = function () {\n\t\n\t        return _.extend({}, DATASET_LI_EDIT.DatasetListItemEdit.prototype.templates, {\n\t            titleBar: DC_LI.DatasetDCEListItemView.prototype.templates.titleBar\n\t        });\n\t    }();\n\t\n\t    //==============================================================================\n\t    /** @class Read only view for a DatasetCollectionElement that is also a DatasetCollection\n\t     *      (a nested DC).\n\t     */\n\t    var NestedDCDCEListItemEdit = DC_LI.NestedDCDCEListItemView.extend(\n\t    /** @lends NestedDCDCEListItemEdit.prototype */{\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        // comment this out to suppress log output\n\t        //logger              : console,\n\t\n\t        // ......................................................................... misc\n\t        /** String representation */\n\t        toString: function toString() {\n\t            var modelString = this.model ? this.model + '' : '(no model)';\n\t            return 'NestedDCDCEListItemEdit(' + modelString + ')';\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    return {\n\t        DCListItemEdit: DCListItemEdit,\n\t        DCEListItemEdit: DCEListItemEdit,\n\t        DatasetDCEListItemEdit: DatasetDCEListItemEdit,\n\t        NestedDCDCEListItemEdit: NestedDCDCEListItemEdit\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n/* 105 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(76), __webpack_require__(39), __webpack_require__(104), __webpack_require__(6), __webpack_require__(5), __webpack_require__(17)], __WEBPACK_AMD_DEFINE_RESULT__ = function (DC_VIEW, DC_MODEL, DC_EDIT, BASE_MVC, _l) {\n\t\n\t    'use strict';\n\t    /* =============================================================================\n\t    TODO:\n\t    \n\t    ============================================================================= */\n\t    /** @class editable View/Controller for a dataset collection.\n\t     */\n\t\n\t    var _super = DC_VIEW.CollectionView;\n\t    var CollectionViewEdit = _super.extend(\n\t    /** @lends CollectionView.prototype */{\n\t        //MODEL is either a DatasetCollection (or subclass) or a DatasetCollectionElement (list of pairs)\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        /** sub view class used for datasets */\n\t        DatasetDCEViewClass: DC_EDIT.DatasetDCEListItemEdit,\n\t        /** sub view class used for nested collections */\n\t        NestedDCDCEViewClass: DC_EDIT.NestedDCDCEListItemEdit,\n\t\n\t        // ......................................................................... SET UP\n\t        /** Set up the view, set up storage, bind listeners to HistoryContents events\n\t         *  @param {Object} attributes optional settings for the panel\n\t         */\n\t        initialize: function initialize(attributes) {\n\t            _super.prototype.initialize.call(this, attributes);\n\t        },\n\t\n\t        /** In this override, make the collection name editable\n\t         */\n\t        _setUpBehaviors: function _setUpBehaviors($where) {\n\t            $where = $where || this.$el;\n\t            _super.prototype._setUpBehaviors.call(this, $where);\n\t            if (!this.model) {\n\t                return;\n\t            }\n\t\n\t            // anon users shouldn't have access to any of the following\n\t            if (!Galaxy.user || Galaxy.user.isAnonymous()) {\n\t                return;\n\t            }\n\t\n\t            //TODO: extract\n\t            var panel = this,\n\t                nameSelector = '> .controls .name';\n\t            $where.find(nameSelector).attr('title', _l('Click to rename collection')).tooltip({ placement: 'bottom' }).make_text_editable({\n\t                on_finish: function on_finish(newName) {\n\t                    var previousName = panel.model.get('name');\n\t                    if (newName && newName !== previousName) {\n\t                        panel.$el.find(nameSelector).text(newName);\n\t                        panel.model.save({ name: newName }).fail(function () {\n\t                            panel.$el.find(nameSelector).text(panel.model.previous('name'));\n\t                        });\n\t                    } else {\n\t                        panel.$el.find(nameSelector).text(previousName);\n\t                    }\n\t                }\n\t            });\n\t        },\n\t\n\t        // ........................................................................ misc\n\t        /** string rep */\n\t        toString: function toString() {\n\t            return 'CollectionViewEdit(' + (this.model ? this.model.get('name') : '') + ')';\n\t        }\n\t    });\n\t\n\t    // =============================================================================\n\t    /** @class non-editable, read-only View/Controller for a dataset collection. */\n\t    var ListCollectionViewEdit = CollectionViewEdit.extend(\n\t    /** @lends ListCollectionView.prototype */{\n\t\n\t        //TODO: not strictly needed - due to switch in CollectionView._getContentClass\n\t        /** sub view class used for datasets */\n\t        DatasetDCEViewClass: DC_EDIT.DatasetDCEListItemEdit,\n\t\n\t        // ........................................................................ misc\n\t        /** string rep */\n\t        toString: function toString() {\n\t            return 'ListCollectionViewEdit(' + (this.model ? this.model.get('name') : '') + ')';\n\t        }\n\t    });\n\t\n\t    // =============================================================================\n\t    /** @class Editable, read-only View/Controller for a dataset collection. */\n\t    var PairCollectionViewEdit = ListCollectionViewEdit.extend(\n\t    /** @lends PairCollectionViewEdit.prototype */{\n\t\n\t        // ........................................................................ misc\n\t        /** string rep */\n\t        toString: function toString() {\n\t            return 'PairCollectionViewEdit(' + (this.model ? this.model.get('name') : '') + ')';\n\t        }\n\t    });\n\t\n\t    // =============================================================================\n\t    /** @class Editable (roughly since these collections are immutable),\n\t     *  View/Controller for a dataset collection.\n\t     */\n\t    var NestedPairCollectionViewEdit = PairCollectionViewEdit.extend(\n\t    /** @lends NestedPairCollectionViewEdit.prototype */{\n\t\n\t        /** Override to remove the editable text from the name/identifier - these collections are considered immutable */\n\t        _setUpBehaviors: function _setUpBehaviors($where) {\n\t            _super.prototype._setUpBehaviors.call(this, $where);\n\t        },\n\t\n\t        // ........................................................................ misc\n\t        /** string rep */\n\t        toString: function toString() {\n\t            return 'NestedPairCollectionViewEdit(' + (this.model ? this.model.get('name') : '') + ')';\n\t        }\n\t    });\n\t\n\t    // =============================================================================\n\t    /** @class non-editable, read-only View/Controller for a dataset collection. */\n\t    var ListOfPairsCollectionViewEdit = CollectionViewEdit.extend(\n\t    /** @lends ListOfPairsCollectionView.prototype */{\n\t\n\t        //TODO: not strictly needed - due to switch in CollectionView._getContentClass\n\t        /** sub view class used for nested collections */\n\t        NestedDCDCEViewClass: DC_EDIT.NestedDCDCEListItemEdit.extend({\n\t            foldoutPanelClass: NestedPairCollectionViewEdit\n\t        }),\n\t\n\t        // ........................................................................ misc\n\t        /** string rep */\n\t        toString: function toString() {\n\t            return 'ListOfPairsCollectionViewEdit(' + (this.model ? this.model.get('name') : '') + ')';\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    return {\n\t        CollectionViewEdit: CollectionViewEdit,\n\t        ListCollectionViewEdit: ListCollectionViewEdit,\n\t        PairCollectionViewEdit: PairCollectionViewEdit,\n\t        ListOfPairsCollectionViewEdit: ListOfPairsCollectionViewEdit\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n/* 106 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, jQuery, $) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(127), __webpack_require__(90), __webpack_require__(40), __webpack_require__(6), __webpack_require__(5), __webpack_require__(88)], __WEBPACK_AMD_DEFINE_RESULT__ = function (levenshteinDistance, naturalSort, LIST_COLLECTION_CREATOR, baseMVC, _l) {\n\t\n\t    'use strict';\n\t\n\t    var logNamespace = 'collections';\n\t    /* ============================================================================\n\t    TODO:\n\t    \n\t    \n\t    PROGRAMMATICALLY:\n\t    currPanel.once( 'rendered', function(){\n\t        currPanel.showSelectors();\n\t        currPanel.selectAll();\n\t        _.last( currPanel.actionsPopup.options ).func();\n\t    });\n\t    \n\t    ============================================================================ */\n\t    /** A view for paired datasets in the collections creator.\n\t     */\n\t    var PairView = Backbone.View.extend(baseMVC.LoggableMixin).extend({\n\t        _logNamespace: logNamespace,\n\t\n\t        tagName: 'li',\n\t        className: 'dataset paired',\n\t\n\t        initialize: function initialize(attributes) {\n\t            this.pair = attributes.pair || {};\n\t        },\n\t\n\t        template: _.template(['<span class=\"forward-dataset-name flex-column\"><%- pair.forward.name %></span>', '<span class=\"pair-name-column flex-column\">', '<span class=\"pair-name\"><%- pair.name %></span>', '</span>', '<span class=\"reverse-dataset-name flex-column\"><%- pair.reverse.name %></span>'].join('')),\n\t\n\t        render: function render() {\n\t            this.$el.attr('draggable', true).data('pair', this.pair).html(this.template({ pair: this.pair })).addClass('flex-column-container');\n\t            return this;\n\t        },\n\t\n\t        events: {\n\t            'dragstart': '_dragstart',\n\t            'dragend': '_dragend',\n\t            'dragover': '_sendToParent',\n\t            'drop': '_sendToParent'\n\t        },\n\t\n\t        /** dragging pairs for re-ordering */\n\t        _dragstart: function _dragstart(ev) {\n\t            ev.currentTarget.style.opacity = '0.4';\n\t            if (ev.originalEvent) {\n\t                ev = ev.originalEvent;\n\t            }\n\t\n\t            ev.dataTransfer.effectAllowed = 'move';\n\t            ev.dataTransfer.setData('text/plain', JSON.stringify(this.pair));\n\t\n\t            this.$el.parent().trigger('pair.dragstart', [this]);\n\t        },\n\t\n\t        /** dragging pairs for re-ordering */\n\t        _dragend: function _dragend(ev) {\n\t            ev.currentTarget.style.opacity = '1.0';\n\t            this.$el.parent().trigger('pair.dragend', [this]);\n\t        },\n\t\n\t        /** manually bubble up an event to the parent/container */\n\t        _sendToParent: function _sendToParent(ev) {\n\t            this.$el.parent().trigger(ev);\n\t        },\n\t\n\t        /** string rep */\n\t        toString: function toString() {\n\t            return 'PairView(' + this.pair.name + ')';\n\t        }\n\t    });\n\t\n\t    // ============================================================================\n\t    /** returns an autopair function that uses the provided options.match function */\n\t    function autoPairFnBuilder(options) {\n\t        options = options || {};\n\t        options.createPair = options.createPair || function _defaultCreatePair(params) {\n\t            params = params || {};\n\t            var a = params.listA.splice(params.indexA, 1)[0],\n\t                b = params.listB.splice(params.indexB, 1)[0],\n\t                aInBIndex = params.listB.indexOf(a),\n\t                bInAIndex = params.listA.indexOf(b);\n\t            if (aInBIndex !== -1) {\n\t                params.listB.splice(aInBIndex, 1);\n\t            }\n\t            if (bInAIndex !== -1) {\n\t                params.listA.splice(bInAIndex, 1);\n\t            }\n\t            return this._pair(a, b, { silent: true });\n\t        };\n\t        // compile these here outside of the loop\n\t        var _regexps = [];\n\t        function getRegExps() {\n\t            if (!_regexps.length) {\n\t                _regexps = [new RegExp(this.filters[0]), new RegExp(this.filters[1])];\n\t            }\n\t            return _regexps;\n\t        }\n\t        // mangle params as needed\n\t        options.preprocessMatch = options.preprocessMatch || function _defaultPreprocessMatch(params) {\n\t            var regexps = getRegExps.call(this);\n\t            return _.extend(params, {\n\t                matchTo: params.matchTo.name.replace(regexps[0], ''),\n\t                possible: params.possible.name.replace(regexps[1], '')\n\t            });\n\t        };\n\t\n\t        return function _strategy(params) {\n\t            this.debug('autopair _strategy ---------------------------');\n\t            params = params || {};\n\t            var listA = params.listA,\n\t                listB = params.listB,\n\t                indexA = 0,\n\t                indexB,\n\t                bestMatch = {\n\t                score: 0.0,\n\t                index: null\n\t            },\n\t                paired = [];\n\t            //console.debug( 'params:', JSON.stringify( params, null, '  ' ) );\n\t            this.debug('starting list lens:', listA.length, listB.length);\n\t            this.debug('bestMatch (starting):', JSON.stringify(bestMatch, null, '  '));\n\t\n\t            while (indexA < listA.length) {\n\t                var matchTo = listA[indexA];\n\t                bestMatch.score = 0.0;\n\t\n\t                for (indexB = 0; indexB < listB.length; indexB++) {\n\t                    var possible = listB[indexB];\n\t                    this.debug(indexA + ':' + matchTo.name);\n\t                    this.debug(indexB + ':' + possible.name);\n\t\n\t                    // no matching with self\n\t                    if (listA[indexA] !== listB[indexB]) {\n\t                        bestMatch = options.match.call(this, options.preprocessMatch.call(this, {\n\t                            matchTo: matchTo,\n\t                            possible: possible,\n\t                            index: indexB,\n\t                            bestMatch: bestMatch\n\t                        }));\n\t                        this.debug('bestMatch:', JSON.stringify(bestMatch, null, '  '));\n\t                        if (bestMatch.score === 1.0) {\n\t                            this.debug('breaking early due to perfect match');\n\t                            break;\n\t                        }\n\t                    }\n\t                }\n\t                var scoreThreshold = options.scoreThreshold.call(this);\n\t                this.debug('scoreThreshold:', scoreThreshold);\n\t                this.debug('bestMatch.score:', bestMatch.score);\n\t\n\t                if (bestMatch.score >= scoreThreshold) {\n\t                    //console.debug( 'autoPairFnBuilder.strategy', listA[ indexA ].name, listB[ bestMatch.index ].name );\n\t                    paired.push(options.createPair.call(this, {\n\t                        listA: listA,\n\t                        indexA: indexA,\n\t                        listB: listB,\n\t                        indexB: bestMatch.index\n\t                    }));\n\t                    //console.debug( 'list lens now:', listA.length, listB.length );\n\t                } else {\n\t                    indexA += 1;\n\t                }\n\t                if (!listA.length || !listB.length) {\n\t                    return paired;\n\t                }\n\t            }\n\t            this.debug('paired:', JSON.stringify(paired, null, '  '));\n\t            this.debug('autopair _strategy ---------------------------');\n\t            return paired;\n\t        };\n\t    }\n\t\n\t    // ============================================================================\n\t    /** An interface for building collections of paired datasets.\n\t     */\n\t    var PairedCollectionCreator = Backbone.View.extend(baseMVC.LoggableMixin).extend({\n\t        _logNamespace: logNamespace,\n\t\n\t        className: 'list-of-pairs-collection-creator collection-creator flex-row-container',\n\t\n\t        /** set up initial options, instance vars, behaviors, and autopair (if set to do so) */\n\t        initialize: function initialize(attributes) {\n\t            this.metric('PairedCollectionCreator.initialize', attributes);\n\t            //this.debug( '-- PairedCollectionCreator:', attributes );\n\t\n\t            attributes = _.defaults(attributes, {\n\t                datasets: [],\n\t                filters: this.DEFAULT_FILTERS,\n\t                automaticallyPair: true,\n\t                strategy: 'lcs',\n\t                matchPercentage: 0.9,\n\t                twoPassAutopairing: true\n\t            });\n\t\n\t            /** unordered, original list */\n\t            this.initialList = attributes.datasets;\n\t\n\t            /** is this from a history? if so, what's its id? */\n\t            this.historyId = attributes.historyId;\n\t\n\t            /** which filters should be used initially? (String[2] or name in commonFilters) */\n\t            this.filters = this.commonFilters[attributes.filters] || this.commonFilters[this.DEFAULT_FILTERS];\n\t            if (_.isArray(attributes.filters)) {\n\t                this.filters = attributes.filters;\n\t            }\n\t\n\t            /** try to auto pair the unpaired datasets on load? */\n\t            this.automaticallyPair = attributes.automaticallyPair;\n\t\n\t            /** what method to use for auto pairing (will be passed aggression level) */\n\t            this.strategy = this.strategies[attributes.strategy] || this.strategies[this.DEFAULT_STRATEGY];\n\t            if (_.isFunction(attributes.strategy)) {\n\t                this.strategy = attributes.strategy;\n\t            }\n\t\n\t            /** distance/mismatch level allowed for autopairing */\n\t            this.matchPercentage = attributes.matchPercentage;\n\t\n\t            /** try to autopair using simple first, then this.strategy on the remainder */\n\t            this.twoPassAutopairing = attributes.twoPassAutopairing;\n\t\n\t            /** remove file extensions (\\.*) from created pair names? */\n\t            this.removeExtensions = true;\n\t            //this.removeExtensions = false;\n\t\n\t            /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n\t            this.oncancel = attributes.oncancel;\n\t            /** fn to call when the collection is created (scoped to this) */\n\t            this.oncreate = attributes.oncreate;\n\t\n\t            /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n\t            this.autoscrollDist = attributes.autoscrollDist || 24;\n\t\n\t            /** is the unpaired panel shown? */\n\t            this.unpairedPanelHidden = false;\n\t            /** is the paired panel shown? */\n\t            this.pairedPanelHidden = false;\n\t\n\t            /** DOM elements currently being dragged */\n\t            this.$dragging = null;\n\t\n\t            /** Used for blocking UI events during ajax/operations (don't post twice) */\n\t            this.blocking = false;\n\t\n\t            this._setUpBehaviors();\n\t            this._dataSetUp();\n\t        },\n\t\n\t        /** map of common filter pairs by name */\n\t        commonFilters: {\n\t            illumina: ['_1', '_2'],\n\t            Rs: ['_R1', '_R2']\n\t        },\n\t        /** which commonFilter to use by default */\n\t        DEFAULT_FILTERS: 'illumina',\n\t\n\t        /** map of name->fn for autopairing */\n\t        strategies: {\n\t            'simple': 'autopairSimple',\n\t            'lcs': 'autopairLCS',\n\t            'levenshtein': 'autopairLevenshtein'\n\t        },\n\t        /** default autopair strategy name */\n\t        DEFAULT_STRATEGY: 'lcs',\n\t\n\t        // ------------------------------------------------------------------------ process raw list\n\t        /** set up main data: cache initialList, sort, and autopair */\n\t        _dataSetUp: function _dataSetUp() {\n\t            //this.debug( '-- _dataSetUp' );\n\t\n\t            this.paired = [];\n\t            this.unpaired = [];\n\t\n\t            this.selectedIds = [];\n\t\n\t            // sort initial list, add ids if needed, and save new working copy to unpaired\n\t            this._sortInitialList();\n\t            this._ensureIds();\n\t            this.unpaired = this.initialList.slice(0);\n\t\n\t            if (this.automaticallyPair) {\n\t                this.autoPair();\n\t                this.once('rendered:initial', function () {\n\t                    this.trigger('autopair');\n\t                });\n\t            }\n\t        },\n\t\n\t        /** sort initial list */\n\t        _sortInitialList: function _sortInitialList() {\n\t            //this.debug( '-- _sortInitialList' );\n\t            this._sortDatasetList(this.initialList);\n\t        },\n\t\n\t        /** sort a list of datasets */\n\t        _sortDatasetList: function _sortDatasetList(list) {\n\t            // currently only natural sort by name\n\t            list.sort(function (a, b) {\n\t                return naturalSort(a.name, b.name);\n\t            });\n\t            return list;\n\t        },\n\t\n\t        /** add ids to dataset objs in initial list if none */\n\t        _ensureIds: function _ensureIds() {\n\t            this.initialList.forEach(function (dataset) {\n\t                if (!dataset.hasOwnProperty('id')) {\n\t                    dataset.id = _.uniqueId();\n\t                }\n\t            });\n\t            return this.initialList;\n\t        },\n\t\n\t        /** split initial list into two lists, those that pass forward filters & those passing reverse */\n\t        _splitByFilters: function _splitByFilters() {\n\t            var regexFilters = this.filters.map(function (stringFilter) {\n\t                return new RegExp(stringFilter);\n\t            }),\n\t                split = [[], []];\n\t\n\t            function _filter(unpaired, filter) {\n\t                return filter.test(unpaired.name);\n\t                //return dataset.name.indexOf( filter ) >= 0;\n\t            }\n\t            this.unpaired.forEach(function _filterEach(unpaired) {\n\t                // 90% of the time this seems to work, but:\n\t                //TODO: this treats *all* strings as regex which may confuse people - possibly check for // surrounding?\n\t                //  would need explanation in help as well\n\t                regexFilters.forEach(function (filter, i) {\n\t                    if (_filter(unpaired, filter)) {\n\t                        split[i].push(unpaired);\n\t                    }\n\t                });\n\t            });\n\t            return split;\n\t        },\n\t\n\t        /** add a dataset to the unpaired list in it's proper order */\n\t        _addToUnpaired: function _addToUnpaired(dataset) {\n\t            // currently, unpaired is natural sorted by name, use binary search to find insertion point\n\t            var binSearchSortedIndex = function (low, hi) {\n\t                if (low === hi) {\n\t                    return low;\n\t                }\n\t\n\t                var mid = Math.floor((hi - low) / 2) + low,\n\t                    compared = naturalSort(dataset.name, this.unpaired[mid].name);\n\t\n\t                if (compared < 0) {\n\t                    return binSearchSortedIndex(low, mid);\n\t                } else if (compared > 0) {\n\t                    return binSearchSortedIndex(mid + 1, hi);\n\t                }\n\t                // walk the equal to find the last\n\t                while (this.unpaired[mid] && this.unpaired[mid].name === dataset.name) {\n\t                    mid++;\n\t                }\n\t                return mid;\n\t            }.bind(this);\n\t\n\t            this.unpaired.splice(binSearchSortedIndex(0, this.unpaired.length), 0, dataset);\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ auto pairing\n\t        /** two passes to automatically create pairs:\n\t         *  use both simpleAutoPair, then the fn mentioned in strategy\n\t         */\n\t        autoPair: function autoPair(strategy) {\n\t            // split first using exact matching\n\t            var split = this._splitByFilters(),\n\t                paired = [];\n\t            if (this.twoPassAutopairing) {\n\t                paired = this.autopairSimple({\n\t                    listA: split[0],\n\t                    listB: split[1]\n\t                });\n\t                split = this._splitByFilters();\n\t            }\n\t\n\t            // uncomment to see printlns while running tests\n\t            //this.debug = function(){ console.log.apply( console, arguments ); };\n\t\n\t            // then try the remainder with something less strict\n\t            strategy = strategy || this.strategy;\n\t            split = this._splitByFilters();\n\t            paired = paired.concat(this[strategy].call(this, {\n\t                listA: split[0],\n\t                listB: split[1]\n\t            }));\n\t            return paired;\n\t        },\n\t\n\t        /** autopair by exact match */\n\t        autopairSimple: autoPairFnBuilder({\n\t            scoreThreshold: function scoreThreshold() {\n\t                return 1.0;\n\t            },\n\t            match: function _match(params) {\n\t                params = params || {};\n\t                if (params.matchTo === params.possible) {\n\t                    return {\n\t                        index: params.index,\n\t                        score: 1.0\n\t                    };\n\t                }\n\t                return params.bestMatch;\n\t            }\n\t        }),\n\t\n\t        /** autopair by levenshtein edit distance scoring */\n\t        autopairLevenshtein: autoPairFnBuilder({\n\t            scoreThreshold: function scoreThreshold() {\n\t                return this.matchPercentage;\n\t            },\n\t            match: function _matches(params) {\n\t                params = params || {};\n\t                var distance = levenshteinDistance(params.matchTo, params.possible),\n\t                    score = 1.0 - distance / Math.max(params.matchTo.length, params.possible.length);\n\t                if (score > params.bestMatch.score) {\n\t                    return {\n\t                        index: params.index,\n\t                        score: score\n\t                    };\n\t                }\n\t                return params.bestMatch;\n\t            }\n\t        }),\n\t\n\t        /** autopair by longest common substrings scoring */\n\t        autopairLCS: autoPairFnBuilder({\n\t            scoreThreshold: function scoreThreshold() {\n\t                return this.matchPercentage;\n\t            },\n\t            match: function _matches(params) {\n\t                params = params || {};\n\t                var match = this._naiveStartingAndEndingLCS(params.matchTo, params.possible).length,\n\t                    score = match / Math.max(params.matchTo.length, params.possible.length);\n\t                if (score > params.bestMatch.score) {\n\t                    return {\n\t                        index: params.index,\n\t                        score: score\n\t                    };\n\t                }\n\t                return params.bestMatch;\n\t            }\n\t        }),\n\t\n\t        /** return the concat'd longest common prefix and suffix from two strings */\n\t        _naiveStartingAndEndingLCS: function _naiveStartingAndEndingLCS(s1, s2) {\n\t            var fwdLCS = '',\n\t                revLCS = '',\n\t                i = 0,\n\t                j = 0;\n\t            while (i < s1.length && i < s2.length) {\n\t                if (s1[i] !== s2[i]) {\n\t                    break;\n\t                }\n\t                fwdLCS += s1[i];\n\t                i += 1;\n\t            }\n\t            if (i === s1.length) {\n\t                return s1;\n\t            }\n\t            if (i === s2.length) {\n\t                return s2;\n\t            }\n\t\n\t            i = s1.length - 1;\n\t            j = s2.length - 1;\n\t            while (i >= 0 && j >= 0) {\n\t                if (s1[i] !== s2[j]) {\n\t                    break;\n\t                }\n\t                revLCS = [s1[i], revLCS].join('');\n\t                i -= 1;\n\t                j -= 1;\n\t            }\n\t            return fwdLCS + revLCS;\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ pairing / unpairing\n\t        /** create a pair from fwd and rev, removing them from unpaired, and placing the new pair in paired */\n\t        _pair: function _pair(fwd, rev, options) {\n\t            options = options || {};\n\t            this.debug('_pair:', fwd, rev);\n\t            var pair = this._createPair(fwd, rev, options.name);\n\t            this.paired.push(pair);\n\t            this.unpaired = _.without(this.unpaired, fwd, rev);\n\t            if (!options.silent) {\n\t                this.trigger('pair:new', pair);\n\t            }\n\t            return pair;\n\t        },\n\t\n\t        /** create a pair Object from fwd and rev, adding the name attribute (will guess if not given) */\n\t        _createPair: function _createPair(fwd, rev, name) {\n\t            // ensure existance and don't pair something with itself\n\t            if (!(fwd && rev) || fwd === rev) {\n\t                throw new Error('Bad pairing: ' + [JSON.stringify(fwd), JSON.stringify(rev)]);\n\t            }\n\t            name = name || this._guessNameForPair(fwd, rev);\n\t            return { forward: fwd, name: name, reverse: rev };\n\t        },\n\t\n\t        /** try to find a good pair name for the given fwd and rev datasets */\n\t        _guessNameForPair: function _guessNameForPair(fwd, rev, removeExtensions) {\n\t            removeExtensions = removeExtensions !== undefined ? removeExtensions : this.removeExtensions;\n\t            var fwdName = fwd.name,\n\t                revName = rev.name,\n\t                lcs = this._naiveStartingAndEndingLCS(fwdName.replace(new RegExp(this.filters[0]), ''), revName.replace(new RegExp(this.filters[1]), ''));\n\t            if (removeExtensions) {\n\t                var lastDotIndex = lcs.lastIndexOf('.');\n\t                if (lastDotIndex > 0) {\n\t                    var extension = lcs.slice(lastDotIndex, lcs.length);\n\t                    lcs = lcs.replace(extension, '');\n\t                    fwdName = fwdName.replace(extension, '');\n\t                    revName = revName.replace(extension, '');\n\t                }\n\t            }\n\t            return lcs || fwdName + ' & ' + revName;\n\t        },\n\t\n\t        /** unpair a pair, removing it from paired, and adding the fwd,rev datasets back into unpaired */\n\t        _unpair: function _unpair(pair, options) {\n\t            options = options || {};\n\t            if (!pair) {\n\t                throw new Error('Bad pair: ' + JSON.stringify(pair));\n\t            }\n\t            this.paired = _.without(this.paired, pair);\n\t            this._addToUnpaired(pair.forward);\n\t            this._addToUnpaired(pair.reverse);\n\t\n\t            if (!options.silent) {\n\t                this.trigger('pair:unpair', [pair]);\n\t            }\n\t            return pair;\n\t        },\n\t\n\t        /** unpair all paired datasets */\n\t        unpairAll: function unpairAll() {\n\t            var pairs = [];\n\t            while (this.paired.length) {\n\t                pairs.push(this._unpair(this.paired[0], { silent: true }));\n\t            }\n\t            this.trigger('pair:unpair', pairs);\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ API\n\t        /** convert a pair into JSON compatible with the collections API */\n\t        _pairToJSON: function _pairToJSON(pair, src) {\n\t            src = src || 'hda';\n\t            //TODO: consider making this the pair structure when created instead\n\t            return {\n\t                collection_type: 'paired',\n\t                src: 'new_collection',\n\t                name: pair.name,\n\t                element_identifiers: [{\n\t                    name: 'forward',\n\t                    id: pair.forward.id,\n\t                    src: src\n\t                }, {\n\t                    name: 'reverse',\n\t                    id: pair.reverse.id,\n\t                    src: src\n\t                }]\n\t            };\n\t        },\n\t\n\t        /** create the collection via the API\n\t         *  @returns {jQuery.xhr Object}    the jquery ajax request\n\t         */\n\t        createList: function createList(name) {\n\t            var creator = this,\n\t                url = Galaxy.root + 'api/histories/' + this.historyId + '/contents/dataset_collections';\n\t\n\t            //TODO: use ListPairedCollection.create()\n\t            var ajaxData = {\n\t                type: 'dataset_collection',\n\t                collection_type: 'list:paired',\n\t                name: _.escape(name || creator.$('.collection-name').val()),\n\t                element_identifiers: creator.paired.map(function (pair) {\n\t                    return creator._pairToJSON(pair);\n\t                })\n\t\n\t            };\n\t            //this.debug( JSON.stringify( ajaxData ) );\n\t            creator.blocking = true;\n\t            return jQuery.ajax(url, {\n\t                type: 'POST',\n\t                contentType: 'application/json',\n\t                dataType: 'json',\n\t                data: JSON.stringify(ajaxData)\n\t            }).always(function () {\n\t                creator.blocking = false;\n\t            }).fail(function (xhr, status, message) {\n\t                creator._ajaxErrHandler(xhr, status, message);\n\t            }).done(function (response, message, xhr) {\n\t                //this.info( 'ok', response, message, xhr );\n\t                creator.trigger('collection:created', response, message, xhr);\n\t                creator.metric('collection:created', response);\n\t                if (typeof creator.oncreate === 'function') {\n\t                    creator.oncreate.call(this, response, message, xhr);\n\t                }\n\t            });\n\t        },\n\t\n\t        /** handle ajax errors with feedback and details to the user (if available) */\n\t        _ajaxErrHandler: function _ajaxErrHandler(xhr, status, message) {\n\t            this.error(xhr, status, message);\n\t            var content = _l('An error occurred while creating this collection');\n\t            if (xhr) {\n\t                if (xhr.readyState === 0 && xhr.status === 0) {\n\t                    content += ': ' + _l('Galaxy could not be reached and may be updating.') + _l(' Try again in a few minutes.');\n\t                } else if (xhr.responseJSON) {\n\t                    content += '<br /><pre>' + JSON.stringify(xhr.responseJSON) + '</pre>';\n\t                } else {\n\t                    content += ': ' + message;\n\t                }\n\t            }\n\t            creator._showAlert(content, 'alert-danger');\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ rendering\n\t        /** render the entire interface */\n\t        render: function render(speed, callback) {\n\t            //this.debug( '-- _render' );\n\t            //this.$el.empty().html( PairedCollectionCreator.templates.main() );\n\t            this.$el.empty().html(PairedCollectionCreator.templates.main());\n\t            this._renderHeader(speed);\n\t            this._renderMiddle(speed);\n\t            this._renderFooter(speed);\n\t            this._addPluginComponents();\n\t            this.trigger('rendered', this);\n\t            return this;\n\t        },\n\t\n\t        /** render the header section */\n\t        _renderHeader: function _renderHeader(speed, callback) {\n\t            //this.debug( '-- _renderHeader' );\n\t            var $header = this.$('.header').empty().html(PairedCollectionCreator.templates.header()).find('.help-content').prepend($(PairedCollectionCreator.templates.helpContent()));\n\t\n\t            this._renderFilters();\n\t            return $header;\n\t        },\n\t        /** fill the filter inputs with the filter values */\n\t        _renderFilters: function _renderFilters() {\n\t            return this.$('.forward-column .column-header input').val(this.filters[0]).add(this.$('.reverse-column .column-header input').val(this.filters[1]));\n\t        },\n\t\n\t        /** render the middle including unpaired and paired sections (which may be hidden) */\n\t        _renderMiddle: function _renderMiddle(speed, callback) {\n\t            var $middle = this.$('.middle').empty().html(PairedCollectionCreator.templates.middle());\n\t\n\t            // (re-) hide the un/paired panels based on instance vars\n\t            if (this.unpairedPanelHidden) {\n\t                this.$('.unpaired-columns').hide();\n\t            } else if (this.pairedPanelHidden) {\n\t                this.$('.paired-columns').hide();\n\t            }\n\t\n\t            this._renderUnpaired();\n\t            this._renderPaired();\n\t            return $middle;\n\t        },\n\t        /** render the unpaired section, showing datasets accrd. to filters, update the unpaired counts */\n\t        _renderUnpaired: function _renderUnpaired(speed, callback) {\n\t            //this.debug( '-- _renderUnpaired' );\n\t            var creator = this,\n\t                $fwd,\n\t                $rev,\n\t                $prd = [],\n\t                split = this._splitByFilters();\n\t            // update unpaired counts\n\t            this.$('.forward-column .title').text([split[0].length, _l('unpaired forward')].join(' '));\n\t            this.$('.forward-column .unpaired-info').text(this._renderUnpairedDisplayStr(this.unpaired.length - split[0].length));\n\t            this.$('.reverse-column .title').text([split[1].length, _l('unpaired reverse')].join(' '));\n\t            this.$('.reverse-column .unpaired-info').text(this._renderUnpairedDisplayStr(this.unpaired.length - split[1].length));\n\t\n\t            this.$('.unpaired-columns .column-datasets').empty();\n\t\n\t            // show/hide the auto pair button if any unpaired are left\n\t            this.$('.autopair-link').toggle(this.unpaired.length !== 0);\n\t            if (this.unpaired.length === 0) {\n\t                this._renderUnpairedEmpty();\n\t                return;\n\t            }\n\t\n\t            // create the dataset dom arrays\n\t            $rev = split[1].map(function (dataset, i) {\n\t                // if there'll be a fwd dataset across the way, add a button to pair the row\n\t                if (split[0][i] !== undefined && split[0][i] !== dataset) {\n\t                    $prd.push(creator._renderPairButton());\n\t                }\n\t                return creator._renderUnpairedDataset(dataset);\n\t            });\n\t            $fwd = split[0].map(function (dataset) {\n\t                return creator._renderUnpairedDataset(dataset);\n\t            });\n\t\n\t            if (!$fwd.length && !$rev.length) {\n\t                this._renderUnpairedNotShown();\n\t                return;\n\t            }\n\t            // add to appropo cols\n\t            //TODO: not the best way to render - consider rendering the entire unpaired-columns section in a fragment\n\t            //  and swapping out that\n\t            this.$('.unpaired-columns .forward-column .column-datasets').append($fwd).add(this.$('.unpaired-columns .paired-column .column-datasets').append($prd)).add(this.$('.unpaired-columns .reverse-column .column-datasets').append($rev));\n\t            this._adjUnpairedOnScrollbar();\n\t        },\n\t        /** return a string to display the count of filtered out datasets */\n\t        _renderUnpairedDisplayStr: function _renderUnpairedDisplayStr(numFiltered) {\n\t            return ['(', numFiltered, ' ', _l('filtered out'), ')'].join('');\n\t        },\n\t        /** return an unattached jQuery DOM element to represent an unpaired dataset */\n\t        _renderUnpairedDataset: function _renderUnpairedDataset(dataset) {\n\t            //TODO: to underscore template\n\t            return $('<li/>').attr('id', 'dataset-' + dataset.id).addClass('dataset unpaired').attr('draggable', true).addClass(dataset.selected ? 'selected' : '').append($('<span/>').addClass('dataset-name').text(dataset.name))\n\t            //??\n\t            .data('dataset', dataset);\n\t        },\n\t        /** render the button that may go between unpaired datasets, allowing the user to pair a row */\n\t        _renderPairButton: function _renderPairButton() {\n\t            //TODO: *not* a dataset - don't pretend like it is\n\t            return $('<li/>').addClass('dataset unpaired').append($('<span/>').addClass('dataset-name').text(_l('Pair these datasets')));\n\t        },\n\t        /** a message to display when no unpaired left */\n\t        _renderUnpairedEmpty: function _renderUnpairedEmpty() {\n\t            //this.debug( '-- renderUnpairedEmpty' );\n\t            var $msg = $('<div class=\"empty-message\"></div>').text('(' + _l('no remaining unpaired datasets') + ')');\n\t            this.$('.unpaired-columns .paired-column .column-datasets').empty().prepend($msg);\n\t            return $msg;\n\t        },\n\t        /** a message to display when no unpaired can be shown with the current filters */\n\t        _renderUnpairedNotShown: function _renderUnpairedNotShown() {\n\t            //this.debug( '-- renderUnpairedEmpty' );\n\t            var $msg = $('<div class=\"empty-message\"></div>').text('(' + _l('no datasets were found matching the current filters') + ')');\n\t            this.$('.unpaired-columns .paired-column .column-datasets').empty().prepend($msg);\n\t            return $msg;\n\t        },\n\t        /** try to detect if the unpaired section has a scrollbar and adjust left column for better centering of all */\n\t        _adjUnpairedOnScrollbar: function _adjUnpairedOnScrollbar() {\n\t            var $unpairedColumns = this.$('.unpaired-columns').last(),\n\t                $firstDataset = this.$('.unpaired-columns .reverse-column .dataset').first();\n\t            if (!$firstDataset.length) {\n\t                return;\n\t            }\n\t            var ucRight = $unpairedColumns.offset().left + $unpairedColumns.outerWidth(),\n\t                dsRight = $firstDataset.offset().left + $firstDataset.outerWidth(),\n\t                rightDiff = Math.floor(ucRight) - Math.floor(dsRight);\n\t            //this.debug( 'rightDiff:', ucRight, '-', dsRight, '=', rightDiff );\n\t            this.$('.unpaired-columns .forward-column').css('margin-left', rightDiff > 0 ? rightDiff : 0);\n\t        },\n\t\n\t        /** render the paired section and update counts of paired datasets */\n\t        _renderPaired: function _renderPaired(speed, callback) {\n\t            //this.debug( '-- _renderPaired' );\n\t            this.$('.paired-column-title .title').text([this.paired.length, _l('paired')].join(' '));\n\t            // show/hide the unpair all link\n\t            this.$('.unpair-all-link').toggle(this.paired.length !== 0);\n\t            if (this.paired.length === 0) {\n\t                this._renderPairedEmpty();\n\t                return;\n\t                //TODO: would be best to return here (the $columns)\n\t            } else {\n\t                // show/hide 'remove extensions link' when any paired and they seem to have extensions\n\t                this.$('.remove-extensions-link').show();\n\t            }\n\t\n\t            this.$('.paired-columns .column-datasets').empty();\n\t            var creator = this;\n\t            this.paired.forEach(function (pair, i) {\n\t                //TODO: cache these?\n\t                var pairView = new PairView({ pair: pair });\n\t                creator.$('.paired-columns .column-datasets').append(pairView.render().$el).append(['<button class=\"unpair-btn\">', '<span class=\"fa fa-unlink\" title=\"', _l('Unpair'), '\"></span>', '</button>'].join(''));\n\t            });\n\t        },\n\t        /** a message to display when none paired */\n\t        _renderPairedEmpty: function _renderPairedEmpty() {\n\t            var $msg = $('<div class=\"empty-message\"></div>').text('(' + _l('no paired datasets yet') + ')');\n\t            this.$('.paired-columns .column-datasets').empty().prepend($msg);\n\t            return $msg;\n\t        },\n\t\n\t        /** render the footer, completion controls, and cancel controls */\n\t        _renderFooter: function _renderFooter(speed, callback) {\n\t            var $footer = this.$('.footer').empty().html(PairedCollectionCreator.templates.footer());\n\t            this.$('.remove-extensions').prop('checked', this.removeExtensions);\n\t            if (typeof this.oncancel === 'function') {\n\t                this.$('.cancel-create.btn').show();\n\t            }\n\t            return $footer;\n\t        },\n\t\n\t        /** add any jQuery/bootstrap/custom plugins to elements rendered */\n\t        _addPluginComponents: function _addPluginComponents() {\n\t            this._chooseFiltersPopover('.choose-filters-link');\n\t            this.$('.help-content i').hoverhighlight('.collection-creator', 'rgba( 64, 255, 255, 1.0 )');\n\t        },\n\t\n\t        /** build a filter selection popover allowing selection of common filter pairs */\n\t        _chooseFiltersPopover: function _chooseFiltersPopover(selector) {\n\t            function filterChoice(val1, val2) {\n\t                return ['<button class=\"filter-choice btn\" ', 'data-forward=\"', val1, '\" data-reverse=\"', val2, '\">', _l('Forward'), ': ', val1, ', ', _l('Reverse'), ': ', val2, '</button>'].join('');\n\t            }\n\t            var $popoverContent = $(_.template(['<div class=\"choose-filters\">', '<div class=\"help\">', _l('Choose from the following filters to change which unpaired reads are shown in the display'), ':</div>', _.values(this.commonFilters).map(function (filterSet) {\n\t                return filterChoice(filterSet[0], filterSet[1]);\n\t            }).join(''), '</div>'].join(''))({}));\n\t\n\t            return this.$(selector).popover({\n\t                container: '.collection-creator',\n\t                placement: 'bottom',\n\t                html: true,\n\t                //animation   : false,\n\t                content: $popoverContent\n\t            });\n\t        },\n\t\n\t        /** add (or clear if clear is truthy) a validation warning to what */\n\t        _validationWarning: function _validationWarning(what, clear) {\n\t            var VALIDATION_CLASS = 'validation-warning';\n\t            if (what === 'name') {\n\t                what = this.$('.collection-name').add(this.$('.collection-name-prompt'));\n\t                this.$('.collection-name').focus().select();\n\t            }\n\t            if (clear) {\n\t                what = what || this.$('.' + VALIDATION_CLASS);\n\t                what.removeClass(VALIDATION_CLASS);\n\t            } else {\n\t                what.addClass(VALIDATION_CLASS);\n\t            }\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ events\n\t        /** set up event handlers on self */\n\t        _setUpBehaviors: function _setUpBehaviors() {\n\t            this.once('rendered', function () {\n\t                this.trigger('rendered:initial', this);\n\t            });\n\t\n\t            this.on('pair:new', function () {\n\t                //TODO: ideally only re-render the columns (or even elements) involved\n\t                this._renderUnpaired();\n\t                this._renderPaired();\n\t\n\t                // scroll to bottom where new pairs are added\n\t                //TODO: this doesn't seem to work - innerHeight sticks at 133...\n\t                //  may have to do with improper flex columns\n\t                //var $pairedView = this.$( '.paired-columns' );\n\t                //$pairedView.scrollTop( $pairedView.innerHeight() );\n\t                //this.debug( $pairedView.height() )\n\t                this.$('.paired-columns').scrollTop(8000000);\n\t            });\n\t            this.on('pair:unpair', function (pairs) {\n\t                //TODO: ideally only re-render the columns (or even elements) involved\n\t                this._renderUnpaired();\n\t                this._renderPaired();\n\t                this.splitView();\n\t            });\n\t\n\t            this.on('filter-change', function () {\n\t                this.filters = [this.$('.forward-unpaired-filter input').val(), this.$('.reverse-unpaired-filter input').val()];\n\t                this.metric('filter-change', this.filters);\n\t                this._renderFilters();\n\t                this._renderUnpaired();\n\t            });\n\t\n\t            this.on('autopair', function () {\n\t                this._renderUnpaired();\n\t                this._renderPaired();\n\t\n\t                var message,\n\t                    msgClass = null;\n\t                if (this.paired.length) {\n\t                    msgClass = 'alert-success';\n\t                    message = this.paired.length + ' ' + _l('pairs created');\n\t                    if (!this.unpaired.length) {\n\t                        message += ': ' + _l('all datasets have been successfully paired');\n\t                        this.hideUnpaired();\n\t                        this.$('.collection-name').focus();\n\t                    }\n\t                } else {\n\t                    message = _l(['Could not automatically create any pairs from the given dataset names.', 'You may want to choose or enter different filters and try auto-pairing again.', 'Close this message using the X on the right to view more help.'].join(' '));\n\t                }\n\t                this._showAlert(message, msgClass);\n\t            });\n\t\n\t            //this.on( 'all', function(){\n\t            //    this.info( arguments );\n\t            //});\n\t            return this;\n\t        },\n\t\n\t        events: {\n\t            // header\n\t            'click .more-help': '_clickMoreHelp',\n\t            'click .less-help': '_clickLessHelp',\n\t            'click .header .alert button': '_hideAlert',\n\t            'click .forward-column .column-title': '_clickShowOnlyUnpaired',\n\t            'click .reverse-column .column-title': '_clickShowOnlyUnpaired',\n\t            'click .unpair-all-link': '_clickUnpairAll',\n\t            //TODO: this seems kinda backasswards - re-sending jq event as a backbone event, can we listen directly?\n\t            'change .forward-unpaired-filter input': function changeForwardUnpairedFilterInput(ev) {\n\t                this.trigger('filter-change');\n\t            },\n\t            'focus .forward-unpaired-filter input': function focusForwardUnpairedFilterInput(ev) {\n\t                $(ev.currentTarget).select();\n\t            },\n\t            'click .autopair-link': '_clickAutopair',\n\t            'click .choose-filters .filter-choice': '_clickFilterChoice',\n\t            'click .clear-filters-link': '_clearFilters',\n\t            'change .reverse-unpaired-filter input': function changeReverseUnpairedFilterInput(ev) {\n\t                this.trigger('filter-change');\n\t            },\n\t            'focus .reverse-unpaired-filter input': function focusReverseUnpairedFilterInput(ev) {\n\t                $(ev.currentTarget).select();\n\t            },\n\t            // unpaired\n\t            'click .forward-column .dataset.unpaired': '_clickUnpairedDataset',\n\t            'click .reverse-column .dataset.unpaired': '_clickUnpairedDataset',\n\t            'click .paired-column .dataset.unpaired': '_clickPairRow',\n\t            'click .unpaired-columns': 'clearSelectedUnpaired',\n\t            'mousedown .unpaired-columns .dataset': '_mousedownUnpaired',\n\t            // divider\n\t            'click .paired-column-title': '_clickShowOnlyPaired',\n\t            'mousedown .flexible-partition-drag': '_startPartitionDrag',\n\t            // paired\n\t            'click .paired-columns .dataset.paired': 'selectPair',\n\t            'click .paired-columns': 'clearSelectedPaired',\n\t            'click .paired-columns .pair-name': '_clickPairName',\n\t            'click .unpair-btn': '_clickUnpair',\n\t            // paired - drop target\n\t            //'dragenter .paired-columns'                 : '_dragenterPairedColumns',\n\t            //'dragleave .paired-columns .column-datasets': '_dragleavePairedColumns',\n\t            'dragover .paired-columns .column-datasets': '_dragoverPairedColumns',\n\t            'drop .paired-columns .column-datasets': '_dropPairedColumns',\n\t\n\t            'pair.dragstart .paired-columns .column-datasets': '_pairDragstart',\n\t            'pair.dragend   .paired-columns .column-datasets': '_pairDragend',\n\t\n\t            // footer\n\t            'change .remove-extensions': function changeRemoveExtensions(ev) {\n\t                this.toggleExtensions();\n\t            },\n\t            'change .collection-name': '_changeName',\n\t            'keydown .collection-name': '_nameCheckForEnter',\n\t            'click .cancel-create': function clickCancelCreate(ev) {\n\t                if (typeof this.oncancel === 'function') {\n\t                    this.oncancel.call(this);\n\t                }\n\t            },\n\t            'click .create-collection': '_clickCreate' //,\n\t        },\n\t\n\t        // ........................................................................ header\n\t        /** expand help */\n\t        _clickMoreHelp: function _clickMoreHelp(ev) {\n\t            this.$('.main-help').addClass('expanded');\n\t            this.$('.more-help').hide();\n\t        },\n\t        /** collapse help */\n\t        _clickLessHelp: function _clickLessHelp(ev) {\n\t            this.$('.main-help').removeClass('expanded');\n\t            this.$('.more-help').show();\n\t        },\n\t\n\t        /** show an alert on the top of the interface containing message (alertClass is bootstrap's alert-*)*/\n\t        _showAlert: function _showAlert(message, alertClass) {\n\t            alertClass = alertClass || 'alert-danger';\n\t            this.$('.main-help').hide();\n\t            this.$('.header .alert').attr('class', 'alert alert-dismissable').addClass(alertClass).show().find('.alert-message').html(message);\n\t        },\n\t        /** hide the alerts at the top */\n\t        _hideAlert: function _hideAlert(message) {\n\t            this.$('.main-help').show();\n\t            this.$('.header .alert').hide();\n\t        },\n\t\n\t        /** toggle between showing only unpaired and split view */\n\t        _clickShowOnlyUnpaired: function _clickShowOnlyUnpaired(ev) {\n\t            //this.debug( 'click unpaired', ev.currentTarget );\n\t            if (this.$('.paired-columns').is(':visible')) {\n\t                this.hidePaired();\n\t            } else {\n\t                this.splitView();\n\t            }\n\t        },\n\t        /** toggle between showing only paired and split view */\n\t        _clickShowOnlyPaired: function _clickShowOnlyPaired(ev) {\n\t            //this.debug( 'click paired' );\n\t            if (this.$('.unpaired-columns').is(':visible')) {\n\t                this.hideUnpaired();\n\t            } else {\n\t                this.splitView();\n\t            }\n\t        },\n\t\n\t        /** hide unpaired, show paired */\n\t        hideUnpaired: function hideUnpaired(speed, callback) {\n\t            this.unpairedPanelHidden = true;\n\t            this.pairedPanelHidden = false;\n\t            this._renderMiddle(speed, callback);\n\t        },\n\t        /** hide paired, show unpaired */\n\t        hidePaired: function hidePaired(speed, callback) {\n\t            this.unpairedPanelHidden = false;\n\t            this.pairedPanelHidden = true;\n\t            this._renderMiddle(speed, callback);\n\t        },\n\t        /** show both paired and unpaired (splitting evenly) */\n\t        splitView: function splitView(speed, callback) {\n\t            this.unpairedPanelHidden = this.pairedPanelHidden = false;\n\t            this._renderMiddle(speed, callback);\n\t            return this;\n\t        },\n\t\n\t        /** unpair all paired and do other super neat stuff which I'm not really sure about yet... */\n\t        _clickUnpairAll: function _clickUnpairAll(ev) {\n\t            this.metric('unpairAll');\n\t            this.unpairAll();\n\t        },\n\t\n\t        /** attempt to autopair */\n\t        _clickAutopair: function _clickAutopair(ev) {\n\t            var paired = this.autoPair();\n\t            this.metric('autopair', paired.length, this.unpaired.length);\n\t            this.trigger('autopair');\n\t        },\n\t\n\t        /** set the filters based on the data attributes of the button click target */\n\t        _clickFilterChoice: function _clickFilterChoice(ev) {\n\t            var $selected = $(ev.currentTarget);\n\t            this.$('.forward-unpaired-filter input').val($selected.data('forward'));\n\t            this.$('.reverse-unpaired-filter input').val($selected.data('reverse'));\n\t            this._hideChooseFilters();\n\t            this.trigger('filter-change');\n\t        },\n\t\n\t        /** hide the choose filters popover */\n\t        _hideChooseFilters: function _hideChooseFilters() {\n\t            //TODO: update bootstrap and remove the following hack\n\t            //  see also: https://github.com/twbs/bootstrap/issues/10260\n\t            this.$('.choose-filters-link').popover('hide');\n\t            this.$('.popover').css('display', 'none');\n\t        },\n\t\n\t        /** clear both filters */\n\t        _clearFilters: function _clearFilters(ev) {\n\t            this.$('.forward-unpaired-filter input').val('');\n\t            this.$('.reverse-unpaired-filter input').val('');\n\t            this.trigger('filter-change');\n\t        },\n\t\n\t        // ........................................................................ unpaired\n\t        /** select an unpaired dataset */\n\t        _clickUnpairedDataset: function _clickUnpairedDataset(ev) {\n\t            ev.stopPropagation();\n\t            return this.toggleSelectUnpaired($(ev.currentTarget));\n\t        },\n\t\n\t        /** Toggle the selection of an unpaired dataset representation.\n\t         *  @param [jQuery] $dataset        the unpaired dataset dom rep to select\n\t         *  @param [Boolean] options.force  if defined, force selection based on T/F; otherwise, toggle\n\t         */\n\t        toggleSelectUnpaired: function toggleSelectUnpaired($dataset, options) {\n\t            options = options || {};\n\t            var dataset = $dataset.data('dataset'),\n\t                select = options.force !== undefined ? options.force : !$dataset.hasClass('selected');\n\t            //this.debug( id, options.force, $dataset, dataset );\n\t            if (!$dataset.length || dataset === undefined) {\n\t                return $dataset;\n\t            }\n\t\n\t            if (select) {\n\t                $dataset.addClass('selected');\n\t                if (!options.waitToPair) {\n\t                    this.pairAllSelected();\n\t                }\n\t            } else {\n\t                $dataset.removeClass('selected');\n\t                //delete dataset.selected;\n\t            }\n\t            return $dataset;\n\t        },\n\t\n\t        /** pair all the currently selected unpaired datasets */\n\t        pairAllSelected: function pairAllSelected(options) {\n\t            options = options || {};\n\t            var creator = this,\n\t                fwds = [],\n\t                revs = [],\n\t                pairs = [];\n\t            creator.$('.unpaired-columns .forward-column .dataset.selected').each(function () {\n\t                fwds.push($(this).data('dataset'));\n\t            });\n\t            creator.$('.unpaired-columns .reverse-column .dataset.selected').each(function () {\n\t                revs.push($(this).data('dataset'));\n\t            });\n\t            fwds.length = revs.length = Math.min(fwds.length, revs.length);\n\t            //this.debug( fwds );\n\t            //this.debug( revs );\n\t            fwds.forEach(function (fwd, i) {\n\t                try {\n\t                    pairs.push(creator._pair(fwd, revs[i], { silent: true }));\n\t                } catch (err) {\n\t                    //TODO: preserve selected state of those that couldn't be paired\n\t                    //TODO: warn that some could not be paired\n\t                    creator.error(err);\n\t                }\n\t            });\n\t            if (pairs.length && !options.silent) {\n\t                this.trigger('pair:new', pairs);\n\t            }\n\t            return pairs;\n\t        },\n\t\n\t        /** clear the selection on all unpaired datasets */\n\t        clearSelectedUnpaired: function clearSelectedUnpaired() {\n\t            this.$('.unpaired-columns .dataset.selected').removeClass('selected');\n\t        },\n\t\n\t        /** when holding down the shift key on a click, 'paint' the moused over datasets as selected */\n\t        _mousedownUnpaired: function _mousedownUnpaired(ev) {\n\t            if (ev.shiftKey) {\n\t                var creator = this,\n\t                    $startTarget = $(ev.target).addClass('selected'),\n\t                    moveListener = function moveListener(ev) {\n\t                    creator.$(ev.target).filter('.dataset').addClass('selected');\n\t                };\n\t                $startTarget.parent().on('mousemove', moveListener);\n\t\n\t                // on any mouseup, stop listening to the move and try to pair any selected\n\t                $(document).one('mouseup', function (ev) {\n\t                    $startTarget.parent().off('mousemove', moveListener);\n\t                    creator.pairAllSelected();\n\t                });\n\t            }\n\t        },\n\t\n\t        /** attempt to pair two datasets directly across from one another */\n\t        _clickPairRow: function _clickPairRow(ev) {\n\t            //if( !ev.currentTarget ){ return true; }\n\t            var rowIndex = $(ev.currentTarget).index(),\n\t                fwd = $('.unpaired-columns .forward-column .dataset').eq(rowIndex).data('dataset'),\n\t                rev = $('.unpaired-columns .reverse-column .dataset').eq(rowIndex).data('dataset');\n\t            //this.debug( 'row:', rowIndex, fwd, rev );\n\t            this._pair(fwd, rev);\n\t        },\n\t\n\t        // ........................................................................ divider/partition\n\t        /** start dragging the visible divider/partition between unpaired and paired panes */\n\t        _startPartitionDrag: function _startPartitionDrag(ev) {\n\t            var creator = this,\n\t                startingY = ev.pageY;\n\t            //this.debug( 'partition drag START:', ev );\n\t            $('body').css('cursor', 'ns-resize');\n\t            creator.$('.flexible-partition-drag').css('color', 'black');\n\t\n\t            function endDrag(ev) {\n\t                //creator.debug( 'partition drag STOP:', ev );\n\t                // doing this by an added class didn't really work well - kept flashing still\n\t                creator.$('.flexible-partition-drag').css('color', '');\n\t                $('body').css('cursor', '').unbind('mousemove', trackMouse);\n\t            }\n\t            function trackMouse(ev) {\n\t                var offset = ev.pageY - startingY;\n\t                //creator.debug( 'partition:', startingY, offset );\n\t                if (!creator.adjPartition(offset)) {\n\t                    //creator.debug( 'mouseup triggered' );\n\t                    $('body').trigger('mouseup');\n\t                }\n\t                creator._adjUnpairedOnScrollbar();\n\t                startingY += offset;\n\t            }\n\t            $('body').mousemove(trackMouse);\n\t            $('body').one('mouseup', endDrag);\n\t        },\n\t\n\t        /** adjust the parition up/down +/-adj pixels */\n\t        adjPartition: function adjPartition(adj) {\n\t            var $unpaired = this.$('.unpaired-columns'),\n\t                $paired = this.$('.paired-columns'),\n\t                unpairedHi = parseInt($unpaired.css('height'), 10),\n\t                pairedHi = parseInt($paired.css('height'), 10);\n\t            //this.debug( adj, 'hi\\'s:', unpairedHi, pairedHi, unpairedHi + adj, pairedHi - adj );\n\t\n\t            unpairedHi = Math.max(10, unpairedHi + adj);\n\t            pairedHi = pairedHi - adj;\n\t\n\t            var movingUpwards = adj < 0;\n\t            // when the divider gets close to the top - lock into hiding the unpaired section\n\t            if (movingUpwards) {\n\t                if (this.unpairedPanelHidden) {\n\t                    return false;\n\t                } else if (unpairedHi <= 10) {\n\t                    this.hideUnpaired();\n\t                    return false;\n\t                }\n\t            } else {\n\t                if (this.unpairedPanelHidden) {\n\t                    $unpaired.show();\n\t                    this.unpairedPanelHidden = false;\n\t                }\n\t            }\n\t\n\t            // when the divider gets close to the bottom - lock into hiding the paired section\n\t            if (!movingUpwards) {\n\t                if (this.pairedPanelHidden) {\n\t                    return false;\n\t                } else if (pairedHi <= 15) {\n\t                    this.hidePaired();\n\t                    return false;\n\t                }\n\t            } else {\n\t                if (this.pairedPanelHidden) {\n\t                    $paired.show();\n\t                    this.pairedPanelHidden = false;\n\t                }\n\t            }\n\t\n\t            $unpaired.css({\n\t                height: unpairedHi + 'px',\n\t                flex: '0 0 auto'\n\t            });\n\t            return true;\n\t        },\n\t\n\t        // ........................................................................ paired\n\t        /** select a pair when clicked */\n\t        selectPair: function selectPair(ev) {\n\t            ev.stopPropagation();\n\t            $(ev.currentTarget).toggleClass('selected');\n\t        },\n\t\n\t        /** deselect all pairs */\n\t        clearSelectedPaired: function clearSelectedPaired(ev) {\n\t            this.$('.paired-columns .dataset.selected').removeClass('selected');\n\t        },\n\t\n\t        /** rename a pair when the pair name is clicked */\n\t        _clickPairName: function _clickPairName(ev) {\n\t            ev.stopPropagation();\n\t            var $name = $(ev.currentTarget),\n\t                $pair = $name.parent().parent(),\n\t                index = $pair.index('.dataset.paired'),\n\t                pair = this.paired[index],\n\t                response = prompt('Enter a new name for the pair:', pair.name);\n\t            if (response) {\n\t                pair.name = response;\n\t                // set a flag (which won't be passed in json creation) for manual naming so we don't overwrite these\n\t                //  when adding/removing extensions\n\t                //hackish\n\t                pair.customizedName = true;\n\t                $name.text(pair.name);\n\t            }\n\t        },\n\t\n\t        /** unpair this pair */\n\t        _clickUnpair: function _clickUnpair(ev) {\n\t            //if( !ev.currentTarget ){ return true; }\n\t            var pairIndex = Math.floor($(ev.currentTarget).index('.unpair-btn'));\n\t            //this.debug( 'pair:', pairIndex );\n\t            this._unpair(this.paired[pairIndex]);\n\t        },\n\t\n\t        // ........................................................................ paired - drag and drop re-ordering\n\t        //_dragenterPairedColumns : function( ev ){\n\t        //    this.debug( '_dragenterPairedColumns:', ev );\n\t        //},\n\t        //_dragleavePairedColumns : function( ev ){\n\t        //    //this.debug( '_dragleavePairedColumns:', ev );\n\t        //},\n\t        /** track the mouse drag over the paired list adding a placeholder to show where the drop would occur */\n\t        _dragoverPairedColumns: function _dragoverPairedColumns(ev) {\n\t            //this.debug( '_dragoverPairedColumns:', ev );\n\t            ev.preventDefault();\n\t\n\t            var $list = this.$('.paired-columns .column-datasets');\n\t            this._checkForAutoscroll($list, ev.originalEvent.clientY);\n\t            //this.debug( ev.originalEvent.clientX, ev.originalEvent.clientY );\n\t            var $nearest = this._getNearestPairedDatasetLi(ev.originalEvent.clientY);\n\t\n\t            $('.element-drop-placeholder').remove();\n\t            var $placeholder = $('<div class=\"element-drop-placeholder\"></div>');\n\t            if (!$nearest.length) {\n\t                $list.append($placeholder);\n\t            } else {\n\t                $nearest.before($placeholder);\n\t            }\n\t        },\n\t\n\t        /** If the mouse is near enough to the list's top or bottom, scroll the list */\n\t        _checkForAutoscroll: function _checkForAutoscroll($element, y) {\n\t            var AUTOSCROLL_SPEED = 2;\n\t            var offset = $element.offset(),\n\t                scrollTop = $element.scrollTop(),\n\t                upperDist = y - offset.top,\n\t                lowerDist = offset.top + $element.outerHeight() - y;\n\t            //this.debug( '_checkForAutoscroll:', scrollTop, upperDist, lowerDist );\n\t            if (upperDist >= 0 && upperDist < this.autoscrollDist) {\n\t                $element.scrollTop(scrollTop - AUTOSCROLL_SPEED);\n\t            } else if (lowerDist >= 0 && lowerDist < this.autoscrollDist) {\n\t                $element.scrollTop(scrollTop + AUTOSCROLL_SPEED);\n\t            }\n\t        },\n\t\n\t        /** get the nearest *previous* paired dataset PairView based on the mouse's Y coordinate.\n\t         *      If the y is at the end of the list, return an empty jQuery object.\n\t         */\n\t        _getNearestPairedDatasetLi: function _getNearestPairedDatasetLi(y) {\n\t            var WIGGLE = 4,\n\t                lis = this.$('.paired-columns .column-datasets li').toArray();\n\t            for (var i = 0; i < lis.length; i++) {\n\t                var $li = $(lis[i]),\n\t                    top = $li.offset().top,\n\t                    halfHeight = Math.floor($li.outerHeight() / 2) + WIGGLE;\n\t                if (top + halfHeight > y && top - halfHeight < y) {\n\t                    //this.debug( y, top + halfHeight, top - halfHeight )\n\t                    return $li;\n\t                }\n\t            }\n\t            return $();\n\t        },\n\t        /** drop (dragged/selected PairViews) onto the list, re-ordering both the DOM and the internal array of pairs */\n\t        _dropPairedColumns: function _dropPairedColumns(ev) {\n\t            // both required for firefox\n\t            ev.preventDefault();\n\t            ev.dataTransfer.dropEffect = 'move';\n\t\n\t            var $nearest = this._getNearestPairedDatasetLi(ev.originalEvent.clientY);\n\t            if ($nearest.length) {\n\t                this.$dragging.insertBefore($nearest);\n\t            } else {\n\t                // no nearest before - insert after last element (unpair button)\n\t                this.$dragging.insertAfter(this.$('.paired-columns .unpair-btn').last());\n\t            }\n\t            // resync the creator's list of paired based on the new DOM order\n\t            this._syncPairsToDom();\n\t            return false;\n\t        },\n\t        /** resync the creator's list of paired based on the DOM order of pairs */\n\t        _syncPairsToDom: function _syncPairsToDom() {\n\t            var newPaired = [];\n\t            //TODO: doesn't seem wise to use the dom to store these - can't we sync another way?\n\t            this.$('.paired-columns .dataset.paired').each(function () {\n\t                newPaired.push($(this).data('pair'));\n\t            });\n\t            //this.debug( newPaired );\n\t            this.paired = newPaired;\n\t            this._renderPaired();\n\t        },\n\t        /** drag communication with pair sub-views: dragstart */\n\t        _pairDragstart: function _pairDragstart(ev, pair) {\n\t            //this.debug( '_pairDragstart', ev, pair )\n\t            // auto select the pair causing the event and move all selected\n\t            pair.$el.addClass('selected');\n\t            var $selected = this.$('.paired-columns .dataset.selected');\n\t            this.$dragging = $selected;\n\t        },\n\t        /** drag communication with pair sub-views: dragend - remove the placeholder */\n\t        _pairDragend: function _pairDragend(ev, pair) {\n\t            //this.debug( '_pairDragend', ev, pair )\n\t            $('.element-drop-placeholder').remove();\n\t            this.$dragging = null;\n\t        },\n\t\n\t        // ........................................................................ footer\n\t        toggleExtensions: function toggleExtensions(force) {\n\t            var creator = this;\n\t            creator.removeExtensions = force !== undefined ? force : !creator.removeExtensions;\n\t\n\t            _.each(creator.paired, function (pair) {\n\t                // don't overwrite custom names\n\t                if (pair.customizedName) {\n\t                    return;\n\t                }\n\t                pair.name = creator._guessNameForPair(pair.forward, pair.reverse);\n\t            });\n\t\n\t            creator._renderPaired();\n\t            creator._renderFooter();\n\t        },\n\t\n\t        /** handle a collection name change */\n\t        _changeName: function _changeName(ev) {\n\t            this._validationWarning('name', !!this._getName());\n\t        },\n\t\n\t        /** check for enter key press when in the collection name and submit */\n\t        _nameCheckForEnter: function _nameCheckForEnter(ev) {\n\t            if (ev.keyCode === 13 && !this.blocking) {\n\t                this._clickCreate();\n\t            }\n\t        },\n\t\n\t        /** get the current collection name */\n\t        _getName: function _getName() {\n\t            return _.escape(this.$('.collection-name').val());\n\t        },\n\t\n\t        /** attempt to create the current collection */\n\t        _clickCreate: function _clickCreate(ev) {\n\t            var name = this._getName();\n\t            if (!name) {\n\t                this._validationWarning('name');\n\t            } else if (!this.blocking) {\n\t                this.createList();\n\t            }\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ misc\n\t        /** debug a dataset list */\n\t        _printList: function _printList(list) {\n\t            var creator = this;\n\t            _.each(list, function (e) {\n\t                if (list === creator.paired) {\n\t                    creator._printPair(e);\n\t                } else {\n\t                    //creator.debug( e );\n\t                }\n\t            });\n\t        },\n\t\n\t        /** print a pair Object */\n\t        _printPair: function _printPair(pair) {\n\t            this.debug(pair.forward.name, pair.reverse.name, ': ->', pair.name);\n\t        },\n\t\n\t        /** string rep */\n\t        toString: function toString() {\n\t            return 'PairedCollectionCreator';\n\t        }\n\t    });\n\t\n\t    //TODO: move to require text plugin and load these as text\n\t    //TODO: underscore currently unnecc. bc no vars are used\n\t    //TODO: better way of localizing text-nodes in long strings\n\t    /** underscore template fns attached to class */\n\t    PairedCollectionCreator.templates = PairedCollectionCreator.templates || {\n\t\n\t        /** the skeleton */\n\t        main: _.template(['<div class=\"header flex-row no-flex\"></div>', '<div class=\"middle flex-row flex-row-container\"></div>', '<div class=\"footer flex-row no-flex\">'].join('')),\n\t\n\t        /** the header (not including help text) */\n\t        header: _.template(['<div class=\"main-help well clear\">', '<a class=\"more-help\" href=\"javascript:void(0);\">', _l('More help'), '</a>', '<div class=\"help-content\">', '<a class=\"less-help\" href=\"javascript:void(0);\">', _l('Less'), '</a>', '</div>', '</div>', '<div class=\"alert alert-dismissable\">', '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-hidden=\"true\">&times;</button>', '<span class=\"alert-message\"></span>', '</div>', '<div class=\"column-headers vertically-spaced flex-column-container\">', '<div class=\"forward-column flex-column column\">', '<div class=\"column-header\">', '<div class=\"column-title\">', '<span class=\"title\">', _l('Unpaired forward'), '</span>', '<span class=\"title-info unpaired-info\"></span>', '</div>', '<div class=\"unpaired-filter forward-unpaired-filter pull-left\">', '<input class=\"search-query\" placeholder=\"', _l('Filter this list'), '\" />', '</div>', '</div>', '</div>', '<div class=\"paired-column flex-column no-flex column\">', '<div class=\"column-header\">', '<a class=\"choose-filters-link\" href=\"javascript:void(0)\">', _l('Choose filters'), '</a>', '<a class=\"clear-filters-link\" href=\"javascript:void(0);\">', _l('Clear filters'), '</a><br />', '<a class=\"autopair-link\" href=\"javascript:void(0);\">', _l('Auto-pair'), '</a>', '</div>', '</div>', '<div class=\"reverse-column flex-column column\">', '<div class=\"column-header\">', '<div class=\"column-title\">', '<span class=\"title\">', _l('Unpaired reverse'), '</span>', '<span class=\"title-info unpaired-info\"></span>', '</div>', '<div class=\"unpaired-filter reverse-unpaired-filter pull-left\">', '<input class=\"search-query\" placeholder=\"', _l('Filter this list'), '\" />', '</div>', '</div>', '</div>', '</div>'].join('')),\n\t\n\t        /** the middle: unpaired, divider, and paired */\n\t        middle: _.template([\n\t        // contains two flex rows (rows that fill available space) and a divider btwn\n\t        '<div class=\"unpaired-columns flex-column-container scroll-container flex-row\">', '<div class=\"forward-column flex-column column\">', '<ol class=\"column-datasets\"></ol>', '</div>', '<div class=\"paired-column flex-column no-flex column\">', '<ol class=\"column-datasets\"></ol>', '</div>', '<div class=\"reverse-column flex-column column\">', '<ol class=\"column-datasets\"></ol>', '</div>', '</div>', '<div class=\"flexible-partition\">', '<div class=\"flexible-partition-drag\" title=\"', _l('Drag to change'), '\"></div>', '<div class=\"column-header\">', '<div class=\"column-title paired-column-title\">', '<span class=\"title\"></span>', '</div>', '<a class=\"unpair-all-link\" href=\"javascript:void(0);\">', _l('Unpair all'), '</a>', '</div>', '</div>', '<div class=\"paired-columns flex-column-container scroll-container flex-row\">', '<ol class=\"column-datasets\"></ol>', '</div>'].join('')),\n\t\n\t        /** creation and cancel controls */\n\t        footer: _.template(['<div class=\"attributes clear\">', '<div class=\"clear\">', '<label class=\"remove-extensions-prompt pull-right\">', _l('Remove file extensions from pair names'), '?', '<input class=\"remove-extensions pull-right\" type=\"checkbox\" />', '</label>', '</div>', '<div class=\"clear\">', '<input class=\"collection-name form-control pull-right\" ', 'placeholder=\"', _l('Enter a name for your new list'), '\" />', '<div class=\"collection-name-prompt pull-right\">', _l('Name'), ':</div>', '</div>', '</div>', '<div class=\"actions clear vertically-spaced\">', '<div class=\"other-options pull-left\">', '<button class=\"cancel-create btn\" tabindex=\"-1\">', _l('Cancel'), '</button>', '<div class=\"create-other btn-group dropup\">', '<button class=\"btn btn-default dropdown-toggle\" data-toggle=\"dropdown\">', _l('Create a different kind of collection'), ' <span class=\"caret\"></span>', '</button>', '<ul class=\"dropdown-menu\" role=\"menu\">', '<li><a href=\"#\">', _l('Create a <i>single</i> pair'), '</a></li>', '<li><a href=\"#\">', _l('Create a list of <i>unpaired</i> datasets'), '</a></li>', '</ul>', '</div>', '</div>', '<div class=\"main-options pull-right\">', '<button class=\"create-collection btn btn-primary\">', _l('Create list'), '</button>', '</div>', '</div>'].join('')),\n\t\n\t        /** help content */\n\t        helpContent: _.template(['<p>', _l(['Collections of paired datasets are ordered lists of dataset pairs (often forward and reverse reads). ', 'These collections can be passed to tools and workflows in order to have analyses done on each member of ', 'the entire group. This interface allows you to create a collection, choose which datasets are paired, ', 'and re-order the final collection.'].join('')), '</p>', '<p>', _l(['Unpaired datasets are shown in the <i data-target=\".unpaired-columns\">unpaired section</i> ', '(hover over the underlined words to highlight below). ', 'Paired datasets are shown in the <i data-target=\".paired-columns\">paired section</i>.', '<ul>To pair datasets, you can:', '<li>Click a dataset in the ', '<i data-target=\".unpaired-columns .forward-column .column-datasets,', '.unpaired-columns .forward-column\">forward column</i> ', 'to select it then click a dataset in the ', '<i data-target=\".unpaired-columns .reverse-column .column-datasets,', '.unpaired-columns .reverse-column\">reverse column</i>.', '</li>', '<li>Click one of the \"Pair these datasets\" buttons in the ', '<i data-target=\".unpaired-columns .paired-column .column-datasets,', '.unpaired-columns .paired-column\">middle column</i> ', 'to pair the datasets in a particular row.', '</li>', '<li>Click <i data-target=\".autopair-link\">\"Auto-pair\"</i> ', 'to have your datasets automatically paired based on name.', '</li>', '</ul>'].join('')), '</p>', '<p>', _l(['<ul>You can filter what is shown in the unpaired sections by:', '<li>Entering partial dataset names in either the ', '<i data-target=\".forward-unpaired-filter input\">forward filter</i> or ', '<i data-target=\".reverse-unpaired-filter input\">reverse filter</i>.', '</li>', '<li>Choosing from a list of preset filters by clicking the ', '<i data-target=\".choose-filters-link\">\"Choose filters\" link</i>.', '</li>', '<li>Entering regular expressions to match dataset names. See: ', '<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions\"', ' target=\"_blank\">MDN\\'s JavaScript Regular Expression Tutorial</a>. ', 'Note: forward slashes (\\\\) are not needed.', '</li>', '<li>Clearing the filters by clicking the ', '<i data-target=\".clear-filters-link\">\"Clear filters\" link</i>.', '</li>', '</ul>'].join('')), '</p>', '<p>', _l(['To unpair individual dataset pairs, click the ', '<i data-target=\".unpair-btn\">unpair buttons ( <span class=\"fa fa-unlink\"></span> )</i>. ', 'Click the <i data-target=\".unpair-all-link\">\"Unpair all\" link</i> to unpair all pairs.'].join('')), '</p>', '<p>', _l(['You can include or remove the file extensions (e.g. \".fastq\") from your pair names by toggling the ', '<i data-target=\".remove-extensions-prompt\">\"Remove file extensions from pair names?\"</i> control.'].join('')), '</p>', '<p>', _l(['Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ', 'click <i data-target=\".create-collection\">\"Create list\"</i>. ', '(Note: you do not have to pair all unpaired datasets to finish.)'].join('')), '</p>'].join(''))\n\t    };\n\t\n\t    //=============================================================================\n\t    /** a modal version of the paired collection creator */\n\t    var pairedCollectionCreatorModal = function _pairedCollectionCreatorModal(datasets, options) {\n\t\n\t        var deferred = jQuery.Deferred(),\n\t            creator;\n\t\n\t        options = _.defaults(options || {}, {\n\t            datasets: datasets,\n\t            oncancel: function oncancel() {\n\t                Galaxy.modal.hide();\n\t                deferred.reject('cancelled');\n\t            },\n\t            oncreate: function oncreate(creator, response) {\n\t                Galaxy.modal.hide();\n\t                deferred.resolve(response);\n\t            }\n\t        });\n\t\n\t        if (!window.Galaxy || !Galaxy.modal) {\n\t            throw new Error('Galaxy or Galaxy.modal not found');\n\t        }\n\t\n\t        creator = new PairedCollectionCreator(options);\n\t        Galaxy.modal.show({\n\t            title: 'Create a collection of paired datasets',\n\t            body: creator.$el,\n\t            width: '80%',\n\t            height: '800px',\n\t            closing_events: true\n\t        });\n\t        creator.render();\n\t        window.creator = creator;\n\t\n\t        //TODO: remove modal header\n\t        return deferred;\n\t    };\n\t\n\t    //=============================================================================\n\t    function createListOfPairsCollection(collection) {\n\t        var elements = collection.toJSON();\n\t        //TODO: validate elements\n\t        return pairedCollectionCreatorModal(elements, {\n\t            historyId: collection.historyId\n\t        });\n\t    }\n\t\n\t    //=============================================================================\n\t    return {\n\t        PairedCollectionCreator: PairedCollectionCreator,\n\t        pairedCollectionCreatorModal: pairedCollectionCreatorModal,\n\t        createListOfPairsCollection: createListOfPairsCollection\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1), __webpack_require__(1)))\n\n/***/ },\n/* 107 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, jQuery) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(40), __webpack_require__(48), __webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (LIST_CREATOR, HDCA, BASE_MVC, _l) {\n\t\n\t    'use strict';\n\t\n\t    var logNamespace = 'collections';\n\t    /*==============================================================================\n\t    TODO:\n\t        the paired creator doesn't really mesh with the list creator as parent\n\t            it may be better to make an abstract super class for both\n\t        composites may inherit from this (or vis-versa)\n\t        PairedDatasetCollectionElementView doesn't make a lot of sense\n\t    \n\t    ==============================================================================*/\n\t    /**  */\n\t    var PairedDatasetCollectionElementView = Backbone.View.extend(BASE_MVC.LoggableMixin).extend({\n\t        _logNamespace: logNamespace,\n\t\n\t        //TODO: use proper class (DatasetDCE or NestedDCDCE (or the union of both))\n\t        tagName: 'li',\n\t        className: 'collection-element',\n\t\n\t        initialize: function initialize(attributes) {\n\t            this.element = attributes.element || {};\n\t            this.identifier = attributes.identifier;\n\t        },\n\t\n\t        render: function render() {\n\t            this.$el.attr('data-element-id', this.element.id).html(this.template({ identifier: this.identifier, element: this.element }));\n\t            return this;\n\t        },\n\t\n\t        //TODO: lots of unused space in the element - possibly load details and display them horiz.\n\t        template: _.template(['<span class=\"identifier\"><%- identifier %></span>', '<span class=\"name\"><%- element.name %></span>'].join('')),\n\t\n\t        /** remove the DOM and any listeners */\n\t        destroy: function destroy() {\n\t            this.off();\n\t            this.$el.remove();\n\t        },\n\t\n\t        /** string rep */\n\t        toString: function toString() {\n\t            return 'DatasetCollectionElementView()';\n\t        }\n\t    });\n\t\n\t    // ============================================================================\n\t    var _super = LIST_CREATOR.ListCollectionCreator;\n\t\n\t    /** An interface for building collections.\n\t     */\n\t    var PairCollectionCreator = _super.extend({\n\t\n\t        /** the class used to display individual elements */\n\t        elementViewClass: PairedDatasetCollectionElementView,\n\t        /** the class this creator will create and save */\n\t        collectionClass: HDCA.HistoryPairDatasetCollection,\n\t        className: 'pair-collection-creator collection-creator flex-row-container',\n\t\n\t        /** override to no-op */\n\t        _mangleDuplicateNames: function _mangleDuplicateNames() {},\n\t\n\t        // TODO: this whole pattern sucks. There needs to be two classes of problem area:\n\t        //      bad inital choices and\n\t        //      when the user has painted his/her self into a corner during creation/use-of-the-creator\n\t        /** render the entire interface */\n\t        render: function render(speed, callback) {\n\t            if (this.workingElements.length === 2) {\n\t                return _super.prototype.render.call(this, speed, callback);\n\t            }\n\t            return this._renderInvalid(speed, callback);\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ rendering elements\n\t        /** render forward/reverse */\n\t        _renderList: function _renderList(speed, callback) {\n\t            //this.debug( '-- _renderList' );\n\t            //precondition: there are two valid elements in workingElements\n\t            var creator = this,\n\t                $tmp = jQuery('<div/>'),\n\t                $list = creator.$list();\n\t\n\t            // lose the original views, create the new, append all at once, then call their renders\n\t            _.each(this.elementViews, function (view) {\n\t                view.destroy();\n\t                creator.removeElementView(view);\n\t            });\n\t            $tmp.append(creator._createForwardElementView().$el);\n\t            $tmp.append(creator._createReverseElementView().$el);\n\t            $list.empty().append($tmp.children());\n\t            _.invoke(creator.elementViews, 'render');\n\t        },\n\t\n\t        /** create the forward element view */\n\t        _createForwardElementView: function _createForwardElementView() {\n\t            return this._createElementView(this.workingElements[0], { identifier: 'forward' });\n\t        },\n\t\n\t        /** create the forward element view */\n\t        _createReverseElementView: function _createReverseElementView() {\n\t            return this._createElementView(this.workingElements[1], { identifier: 'reverse' });\n\t        },\n\t\n\t        /** create an element view, cache in elementViews, and return */\n\t        _createElementView: function _createElementView(element, options) {\n\t            var elementView = new this.elementViewClass(_.extend(options, {\n\t                element: element\n\t            }));\n\t            this.elementViews.push(elementView);\n\t            return elementView;\n\t        },\n\t\n\t        /** swap the forward, reverse elements and re-render */\n\t        swap: function swap() {\n\t            this.workingElements = [this.workingElements[1], this.workingElements[0]];\n\t            this._renderList();\n\t        },\n\t\n\t        events: _.extend(_.clone(_super.prototype.events), {\n\t            'click .swap': 'swap'\n\t        }),\n\t\n\t        // ------------------------------------------------------------------------ templates\n\t        //TODO: move to require text plugin and load these as text\n\t        //TODO: underscore currently unnecc. bc no vars are used\n\t        //TODO: better way of localizing text-nodes in long strings\n\t        /** underscore template fns attached to class */\n\t        templates: _.extend(_.clone(_super.prototype.templates), {\n\t            /** the middle: element list */\n\t            middle: _.template(['<div class=\"collection-elements-controls\">', '<a class=\"swap\" href=\"javascript:void(0);\" title=\"', _l('Swap forward and reverse datasets'), '\">', _l('Swap'), '</a>', '</div>', '<div class=\"collection-elements scroll-container flex-row\">', '</div>'].join('')),\n\t\n\t            /** help content */\n\t            helpContent: _.template(['<p>', _l(['Pair collections are permanent collections containing two datasets: one forward and one reverse. ', 'Often these are forward and reverse reads. The pair collections can be passed to tools and ', 'workflows in order to have analyses done on both datasets. This interface allows ', 'you to create a pair, name it, and swap which is forward and which reverse.'].join('')), '</p>', '<ul>', '<li>', _l(['Click the <i data-target=\".swap\">\"Swap\"</i> link to make your forward dataset the reverse ', 'and the reverse dataset forward.'].join('')), '</li>', '<li>', _l(['Click the <i data-target=\".cancel-create\">\"Cancel\"</i> button to exit the interface.'].join('')), '</li>', '</ul><br />', '<p>', _l(['Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ', 'click <i data-target=\".create-collection\">\"Create list\"</i>.'].join('')), '</p>'].join('')),\n\t\n\t            /** a simplified page communicating what went wrong and why the user needs to reselect something else */\n\t            invalidInitial: _.template(['<div class=\"header flex-row no-flex\">', '<div class=\"alert alert-warning\" style=\"display: block\">', '<span class=\"alert-message\">', '<% if( _.size( problems ) ){ %>', _l('The following selections could not be included due to problems'), '<ul><% _.each( problems, function( problem ){ %>', '<li><b><%- problem.element.name %></b>: <%- problem.text %></li>', '<% }); %></ul>', '<% } else if( _.size( elements ) === 0 ){ %>', _l('No datasets were selected'), '.', '<% } else if( _.size( elements ) === 1 ){ %>', _l('Only one dataset was selected'), ': <%- elements[0].name %>', '<% } else if( _.size( elements ) > 2 ){ %>', _l('Too many datasets were selected'), ': <%- _.pluck( elements, \"name\" ).join( \", \") %>', '<% } %>', '<br />', _l('Two (and only two) elements are needed for the pair'), '. ', _l('You may need to '), '<a class=\"cancel-create\" href=\"javascript:void(0)\">', _l('cancel'), '</a> ', _l('and reselect new elements'), '.', '</span>', '</div>', '</div>', '<div class=\"footer flex-row no-flex\">', '<div class=\"actions clear vertically-spaced\">', '<div class=\"other-options pull-left\">', '<button class=\"cancel-create btn\" tabindex=\"-1\">', _l('Cancel'), '</button>',\n\t            // _l( 'Create a different kind of collection' ),\n\t            '</div>', '</div>', '</div>'].join(''))\n\t        }),\n\t\n\t        // ------------------------------------------------------------------------ misc\n\t        /** string rep */\n\t        toString: function toString() {\n\t            return 'PairCollectionCreator';\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    /** List collection flavor of collectionCreatorModal. */\n\t    var pairCollectionCreatorModal = function _pairCollectionCreatorModal(elements, options) {\n\t        options = options || {};\n\t        options.title = _l('Create a collection from a pair of datasets');\n\t        return LIST_CREATOR.collectionCreatorModal(elements, options, PairCollectionCreator);\n\t    };\n\t\n\t    //==============================================================================\n\t    /** Use a modal to create a pair collection, then add it to the given history contents.\n\t     *  @returns {Deferred} resolved when the collection is added to the history.\n\t     */\n\t    function createPairCollection(contents) {\n\t        var elements = contents.toJSON(),\n\t            promise = pairCollectionCreatorModal(elements, {\n\t            creationFn: function creationFn(elements, name) {\n\t                elements = [{ name: \"forward\", src: \"hda\", id: elements[0].id }, { name: \"reverse\", src: \"hda\", id: elements[1].id }];\n\t                return contents.createHDCA(elements, 'paired', name);\n\t            }\n\t        });\n\t        return promise;\n\t    }\n\t\n\t    //==============================================================================\n\t    return {\n\t        PairCollectionCreator: PairCollectionCreator,\n\t        pairCollectionCreatorModal: pairCollectionCreatorModal,\n\t        createPairCollection: createPairCollection\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 108 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(_, jQuery, $) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(8), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (MODAL, _l) {\n\t\n\t    'use strict';\n\t\n\t    //==============================================================================\n\t    /**\n\t     * A dialog/modal that allows copying a user history or 'importing' from user\n\t     * another. Generally called via historyCopyDialog below.\n\t     * @type {Object}\n\t     */\n\t\n\t    var CopyDialog = {\n\t\n\t        // language related strings/fns\n\t        defaultName: _.template(\"Copy of '<%- name %>'\"),\n\t        title: _.template(_l('Copying history') + ' \"<%- name %>\"'),\n\t        submitLabel: _l('Copy'),\n\t        errorMessage: _l('History could not be copied'),\n\t        progressive: _l('Copying history'),\n\t        activeLabel: _l('Copy only the active, non-deleted datasets'),\n\t        allLabel: _l('Copy all datasets including deleted ones'),\n\t        anonWarning: _l('As an anonymous user, unless you login or register, you will lose your current history ') + _l('after copying this history. '),\n\t\n\t        // template for modal body\n\t        _template: _.template([\n\t        //TODO: remove inline styles\n\t        // show a warning message for losing current to anon users\n\t        '<% if( isAnon ){ %>', '<div class=\"warningmessage\">', '<%- anonWarning %>', _l('You can'), ' <a href=\"/user/login\">', _l('login here'), '</a> ', _l('or'), ' ', ' <a href=\"/user/create\">', _l('register here'), '</a>.', '</div>', '<% } %>', '<form>', '<label for=\"copy-modal-title\">', _l('Enter a title for the new history'), ':', '</label><br />',\n\t        // TODO: could use required here and the form validators\n\t        // NOTE: use unescaped here if escaped in the modal function below\n\t        '<input id=\"copy-modal-title\" class=\"form-control\" style=\"width: 100%\" value=\"<%= name %>\" />', '<p class=\"invalid-title bg-danger\" style=\"color: red; margin: 8px 0px 8px 0px; display: none\">', _l('Please enter a valid history title'), '</p>',\n\t        // if allowAll, add the option to copy deleted datasets, too\n\t        '<% if( allowAll ){ %>', '<br />', '<p>', _l('Choose which datasets from the original history to include:'), '</p>',\n\t        // copy non-deleted is the default\n\t        '<input name=\"copy-what\" type=\"radio\" id=\"copy-non-deleted\" value=\"copy-non-deleted\" ', '<% if( copyWhat === \"copy-non-deleted\" ){ print( \"checked\" ); } %>/>', '<label for=\"copy-non-deleted\"> <%- activeLabel %></label>', '<br />', '<input name=\"copy-what\" type=\"radio\" id=\"copy-all\" value=\"copy-all\" ', '<% if( copyWhat === \"copy-all\" ){ print( \"checked\" ); } %>/>', '<label for=\"copy-all\"> <%- allLabel %></label>', '<% } %>', '</form>'].join('')),\n\t\n\t        // empty modal body and let the user know the copy is happening\n\t        _showAjaxIndicator: function _showAjaxIndicator() {\n\t            var indicator = '<p><span class=\"fa fa-spinner fa-spin\"></span> ' + this.progressive + '...</p>';\n\t            this.modal.$('.modal-body').empty().append(indicator).css({ 'margin-top': '8px' });\n\t        },\n\t\n\t        // (sorta) public interface - display the modal, render the form, and potentially copy the history\n\t        // returns a jQuery.Deferred done->history copied, fail->user cancelled\n\t        dialog: function _dialog(modal, history, options) {\n\t            options = options || {};\n\t\n\t            var dialog = this,\n\t                deferred = jQuery.Deferred(),\n\t\n\t            // TODO: getting a little byzantine here\n\t            defaultCopyNameFn = options.nameFn || this.defaultName,\n\t                defaultCopyName = defaultCopyNameFn({ name: history.get('name') }),\n\t\n\t            // TODO: these two might be simpler as one 3 state option (all,active,no-choice)\n\t            defaultCopyWhat = options.allDatasets ? 'copy-all' : 'copy-non-deleted',\n\t                allowAll = !_.isUndefined(options.allowAll) ? options.allowAll : true,\n\t                autoClose = !_.isUndefined(options.autoClose) ? options.autoClose : true;\n\t\n\t            this.modal = modal;\n\t\n\t            // validate the name and copy if good\n\t            function checkNameAndCopy() {\n\t                var name = modal.$('#copy-modal-title').val();\n\t                if (!name) {\n\t                    modal.$('.invalid-title').show();\n\t                    return;\n\t                }\n\t                // get further settings, shut down and indicate the ajax call, then hide and resolve/reject\n\t                var copyAllDatasets = modal.$('input[name=\"copy-what\"]:checked').val() === 'copy-all';\n\t                modal.$('button').prop('disabled', true);\n\t                dialog._showAjaxIndicator();\n\t                history.copy(true, name, copyAllDatasets).done(function (response) {\n\t                    deferred.resolve(response);\n\t                })\n\t                //TODO: make this unneccessary with pub-sub error or handling via Galaxy\n\t                .fail(function () {\n\t                    alert([dialog.errorMessage, _l('Please contact a Galaxy administrator')].join('. '));\n\t                    deferred.rejectWith(deferred, arguments);\n\t                }).always(function () {\n\t                    if (autoClose) {\n\t                        modal.hide();\n\t                    }\n\t                });\n\t            }\n\t\n\t            var originalClosingCallback = options.closing_callback;\n\t            modal.show(_.extend(options, {\n\t                title: this.title({ name: history.get('name') }),\n\t                body: $(dialog._template({\n\t                    name: defaultCopyName,\n\t                    isAnon: Galaxy.user.isAnonymous(),\n\t                    allowAll: allowAll,\n\t                    copyWhat: defaultCopyWhat,\n\t                    activeLabel: this.activeLabel,\n\t                    allLabel: this.allLabel,\n\t                    anonWarning: this.anonWarning\n\t                })),\n\t                buttons: _.object([[_l('Cancel'), function () {\n\t                    modal.hide();\n\t                }], [this.submitLabel, checkNameAndCopy]]),\n\t                height: 'auto',\n\t                closing_events: true,\n\t                closing_callback: function _historyCopyClose(cancelled) {\n\t                    if (cancelled) {\n\t                        deferred.reject({ cancelled: true });\n\t                    }\n\t                    if (originalClosingCallback) {\n\t                        originalClosingCallback(cancelled);\n\t                    }\n\t                }\n\t            }));\n\t\n\t            // set the default dataset copy, autofocus the title, and set up for a simple return\n\t            modal.$('#copy-modal-title').focus().select();\n\t            modal.$('#copy-modal-title').on('keydown', function (ev) {\n\t                if (ev.keyCode === 13) {\n\t                    ev.preventDefault();\n\t                    checkNameAndCopy();\n\t                }\n\t            });\n\t\n\t            return deferred;\n\t        }\n\t    };\n\t\n\t    //==============================================================================\n\t    // maintain the (slight) distinction between copy and import\n\t    /**\n\t     * Subclass CopyDialog to use the import language.\n\t     */\n\t    var ImportDialog = _.extend({}, CopyDialog, {\n\t        defaultName: _.template(\"imported: <%- name %>\"),\n\t        title: _.template(_l('Importing history') + ' \"<%- name %>\"'),\n\t        submitLabel: _l('Import'),\n\t        errorMessage: _l('History could not be imported'),\n\t        progressive: _l('Importing history'),\n\t        activeLabel: _l('Import only the active, non-deleted datasets'),\n\t        allLabel: _l('Import all datasets including deleted ones'),\n\t        anonWarning: _l('As an anonymous user, unless you login or register, you will lose your current history ') + _l('after importing this history. ')\n\t\n\t    });\n\t\n\t    //==============================================================================\n\t    /**\n\t     * Main interface for both history import and history copy dialogs.\n\t     * @param  {Backbone.Model} history     the history to copy\n\t     * @param  {Object}         options     a hash\n\t     * @return {jQuery.Deferred}            promise that fails on close and succeeds on copy\n\t     *\n\t     * options:\n\t     *     (this object is also passed to the modal used to display the dialog and accepts modal options)\n\t     *     {Function} nameFn    if defined, use this to build the default name shown to the user\n\t     *                          (the fn is passed: {name: <original history's name>})\n\t     *     {bool} useImport     if true, use the 'import' language (instead of Copy)\n\t     *     {bool} allowAll      if true, allow the user to choose between copying all datasets and\n\t     *                          only non-deleted datasets\n\t     *     {String} allDatasets default initial checked radio button: 'copy-all' or 'copy-non-deleted',\n\t     */\n\t    var historyCopyDialog = function historyCopyDialog(history, options) {\n\t        options = options || {};\n\t        // create our own modal if Galaxy doesn't have one (mako tab without use_panels)\n\t        var modal = window.parent.Galaxy.modal || new MODAL.View({});\n\t        return options.useImport ? ImportDialog.dialog(modal, history, options) : CopyDialog.dialog(modal, history, options);\n\t    };\n\t\n\t    //==============================================================================\n\t    return historyCopyDialog;\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(1)))\n\n/***/ },\n/* 109 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(jQuery, _) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(77), __webpack_require__(79), __webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (DATASET_LI_EDIT, HDA_LI, BASE_MVC, _l) {\n\t\n\t    'use strict';\n\t\n\t    //==============================================================================\n\t\n\t    var _super = DATASET_LI_EDIT.DatasetListItemEdit;\n\t    /** @class Editing view for HistoryDatasetAssociation.\n\t     */\n\t    var HDAListItemEdit = _super.extend(\n\t    /** @lends HDAListItemEdit.prototype */{\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        className: _super.prototype.className + \" history-content\",\n\t\n\t        /** In this override, only get details if in the ready state, get rerunnable if in other states.\n\t         *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n\t         */\n\t        _fetchModelDetails: function _fetchModelDetails() {\n\t            var view = this;\n\t            if (view.model.inReadyState() && !view.model.hasDetails()) {\n\t                return view.model.fetch({ silent: true });\n\t\n\t                // special case the need for the rerunnable and creating_job attributes\n\t                // needed for rendering re-run button on queued, running datasets\n\t            } else if (!view.model.has('rerunnable')) {\n\t                return view.model.fetch({ silent: true, data: {\n\t                        // only fetch rerunnable and creating_job to keep overhead down\n\t                        keys: ['rerunnable', 'creating_job'].join(',')\n\t                    } });\n\t            }\n\t            return jQuery.when();\n\t        },\n\t\n\t        /** event map */\n\t        events: _.extend(_.clone(_super.prototype.events), {\n\t            'click .unhide-link': function clickUnhideLink(ev) {\n\t                this.model.unhide();return false;\n\t            }\n\t        }),\n\t\n\t        /** string rep */\n\t        toString: function toString() {\n\t            var modelString = this.model ? this.model + '' : '(no model)';\n\t            return 'HDAListItemEdit(' + modelString + ')';\n\t        }\n\t    });\n\t\n\t    // ............................................................................ TEMPLATES\n\t    /** underscore templates */\n\t    HDAListItemEdit.prototype.templates = function () {\n\t        //TODO: move to require text! plugin\n\t\n\t        var warnings = _.extend({}, _super.prototype.templates.warnings, {\n\t            hidden: BASE_MVC.wrapTemplate(['<% if( !dataset.visible ){ %>',\n\t            // add a link to unhide a dataset\n\t            '<div class=\"hidden-msg warningmessagesmall\">', _l('This dataset has been hidden'), '<br /><a class=\"unhide-link\" a href=\"javascript:void(0);\">', _l('Unhide it'), '</a>', '</div>', '<% } %>'], 'dataset')\n\t        });\n\t\n\t        return _.extend({}, _super.prototype.templates, {\n\t            //NOTE: *steal* the HDAListItemView titleBar\n\t            titleBar: HDA_LI.HDAListItemView.prototype.templates.titleBar,\n\t            warnings: warnings\n\t        });\n\t    }();\n\t\n\t    //==============================================================================\n\t    return {\n\t        HDAListItemEdit: HDAListItemEdit\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n/* 110 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(81), __webpack_require__(105), __webpack_require__(24), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (HDCA_LI, DC_VIEW_EDIT, faIconButton, _l) {\n\t\n\t    'use strict';\n\t\n\t    //==============================================================================\n\t\n\t    var _super = HDCA_LI.HDCAListItemView;\n\t    /** @class Editing view for HistoryDatasetCollectionAssociation.\n\t     */\n\t    var HDCAListItemEdit = _super.extend(\n\t    /** @lends HDCAListItemEdit.prototype */{\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        /** Override to return editable versions of the collection panels */\n\t        _getFoldoutPanelClass: function _getFoldoutPanelClass() {\n\t            switch (this.model.get('collection_type')) {\n\t                case 'list':\n\t                    return DC_VIEW_EDIT.ListCollectionViewEdit;\n\t                case 'paired':\n\t                    return DC_VIEW_EDIT.PairCollectionViewEdit;\n\t                case 'list:paired':\n\t                    return DC_VIEW_EDIT.ListOfPairsCollectionViewEdit;\n\t            }\n\t            throw new TypeError('Uknown collection_type: ' + this.model.get('collection_type'));\n\t        },\n\t\n\t        // ......................................................................... delete\n\t        /** In this override, add the delete button. */\n\t        _renderPrimaryActions: function _renderPrimaryActions() {\n\t            this.log(this + '._renderPrimaryActions');\n\t            // render the display, edit attr and delete icon-buttons\n\t            return _super.prototype._renderPrimaryActions.call(this).concat([this._renderDeleteButton()]);\n\t        },\n\t\n\t        /** Render icon-button to delete this collection. */\n\t        _renderDeleteButton: function _renderDeleteButton() {\n\t            var self = this,\n\t                deleted = this.model.get('deleted');\n\t            return faIconButton({\n\t                title: deleted ? _l('Dataset collection is already deleted') : _l('Delete'),\n\t                classes: 'delete-btn',\n\t                faIcon: 'fa-times',\n\t                disabled: deleted,\n\t                onclick: function onclick() {\n\t                    // ...bler... tooltips being left behind in DOM (hover out never called on deletion)\n\t                    self.$el.find('.icon-btn.delete-btn').trigger('mouseout');\n\t                    self.model['delete']();\n\t                }\n\t            });\n\t        },\n\t\n\t        // ......................................................................... misc\n\t        /** string rep */\n\t        toString: function toString() {\n\t            var modelString = this.model ? this.model + '' : '(no model)';\n\t            return 'HDCAListItemEdit(' + modelString + ')';\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    return {\n\t        HDCAListItemEdit: HDCAListItemEdit\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n/* 111 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(_, jQuery, $) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(82), __webpack_require__(112), __webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (HISTORY_MODEL, HISTORY_VIEW_EDIT, BASE_MVC, _l) {\n\t\n\t    'use strict';\n\t\n\t    // ============================================================================\n\t    /** session storage for history panel preferences (and to maintain state)\n\t     */\n\t\n\t    var HistoryViewPrefs = BASE_MVC.SessionStorageModel.extend(\n\t    /** @lends HistoryViewPrefs.prototype */{\n\t        defaults: {\n\t            /** should the tags editor be shown or hidden initially? */\n\t            tagsEditorShown: false,\n\t            /** should the annotation editor be shown or hidden initially? */\n\t            annotationEditorShown: false,\n\t            ///** what is the currently focused content (dataset or collection) in the current history?\n\t            // *      (the history panel will highlight and scroll to the focused content view)\n\t            // */\n\t            //focusedContentId : null\n\t            /** Current scroll position */\n\t            scrollPosition: 0\n\t        },\n\t        toString: function toString() {\n\t            return 'HistoryViewPrefs(' + JSON.stringify(this.toJSON()) + ')';\n\t        }\n\t    });\n\t\n\t    /** key string to store panel prefs (made accessible on class so you can access sessionStorage directly) */\n\t    HistoryViewPrefs.storageKey = function storageKey() {\n\t        return 'history-panel';\n\t    };\n\t\n\t    /* =============================================================================\n\t    TODO:\n\t    \n\t    ============================================================================= */\n\t    var _super = HISTORY_VIEW_EDIT.HistoryViewEdit;\n\t    // used in root/index.mako\n\t    /** @class View/Controller for the user's current history model as used in the history\n\t     *      panel (current right hand panel) of the analysis page.\n\t     *\n\t     *  The only history panel that:\n\t     *      will poll for updates.\n\t     *      displays datasets in reverse hid order.\n\t     */\n\t    var CurrentHistoryView = _super.extend(\n\t    /** @lends CurrentHistoryView.prototype */{\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        className: _super.prototype.className + ' current-history-panel',\n\t\n\t        emptyMsg: _l(\"This history is empty. Click 'Get Data' on the left tool menu to start\"),\n\t        noneFoundMsg: _l(\"No matching datasets found\"),\n\t\n\t        /**  */\n\t        HDCAViewClass: _super.prototype.HDCAViewClass.extend({\n\t            foldoutStyle: 'drilldown'\n\t        }),\n\t\n\t        // ......................................................................... SET UP\n\t        /** Set up the view, set up storage, bind listeners to HistoryContents events */\n\t        initialize: function initialize(attributes) {\n\t            attributes = attributes || {};\n\t\n\t            // ---- persistent preferences\n\t            /** maintain state / preferences over page loads */\n\t            this.preferences = new HistoryViewPrefs(_.extend({\n\t                id: HistoryViewPrefs.storageKey()\n\t            }, _.pick(attributes, _.keys(HistoryViewPrefs.prototype.defaults))));\n\t\n\t            _super.prototype.initialize.call(this, attributes);\n\t\n\t            /** sub-views that will overlay this panel (collections) */\n\t            this.panelStack = [];\n\t\n\t            /** id of currently focused content */\n\t            this.currentContentId = attributes.currentContentId || null;\n\t            //NOTE: purposely not sent to localstorage since panel recreation roughly lines up with a reset of this value\n\t        },\n\t\n\t        /** Override to cache the current scroll position with a listener */\n\t        _setUpListeners: function _setUpListeners() {\n\t            _super.prototype._setUpListeners.call(this);\n\t\n\t            var panel = this;\n\t            // reset scroll position when there's a new history\n\t            this.on('new-model', function () {\n\t                panel.preferences.set('scrollPosition', 0);\n\t            });\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ loading history/item models\n\t        /** (re-)loads the user's current history & contents w/ details */\n\t        loadCurrentHistory: function loadCurrentHistory(attributes) {\n\t            this.debug(this + '.loadCurrentHistory');\n\t            // implemented as a 'fresh start' or for when there is no model (intial panel render)\n\t            var panel = this;\n\t            return this.loadHistoryWithDetails('current', attributes).then(function (historyData, contentsData) {\n\t                panel.trigger('current-history', panel);\n\t            });\n\t        },\n\t\n\t        /** loads a history & contents w/ details and makes them the current history */\n\t        switchToHistory: function switchToHistory(historyId, attributes) {\n\t            //this.info( 'switchToHistory:', historyId, attributes );\n\t            var panel = this,\n\t                historyFn = function historyFn() {\n\t                // make this current and get history data with one call\n\t                return jQuery.getJSON(Galaxy.root + 'history/set_as_current?id=' + historyId);\n\t                //    method  : 'PUT'\n\t                //});\n\t            };\n\t            return this.loadHistoryWithDetails(historyId, attributes, historyFn).then(function (historyData, contentsData) {\n\t                panel.trigger('switched-history', panel);\n\t            });\n\t        },\n\t\n\t        /** creates a new history on the server and sets it as the user's current history */\n\t        createNewHistory: function createNewHistory(attributes) {\n\t            if (!Galaxy || !Galaxy.user || Galaxy.user.isAnonymous()) {\n\t                this.displayMessage('error', _l('You must be logged in to create histories'));\n\t                return $.when();\n\t            }\n\t            var panel = this,\n\t                historyFn = function historyFn() {\n\t                // create a new history and save: the server will return the proper JSON\n\t                return jQuery.getJSON(Galaxy.root + 'history/create_new_current');\n\t            };\n\t\n\t            // id undefined bc there is no historyId yet - the server will provide\n\t            //  (no need for details - nothing expanded in new history)\n\t            return this.loadHistory(undefined, attributes, historyFn).then(function (historyData, contentsData) {\n\t                panel.trigger('new-history', panel);\n\t            });\n\t        },\n\t\n\t        /** release/free/shutdown old models and set up panel for new models */\n\t        setModel: function setModel(model, attributes, render) {\n\t            _super.prototype.setModel.call(this, model, attributes, render);\n\t            if (this.model) {\n\t                this.log('checking for updates');\n\t                this.model.checkForUpdates();\n\t            }\n\t            return this;\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ history/content event listening\n\t        /** listening for collection events */\n\t        _setUpCollectionListeners: function _setUpCollectionListeners() {\n\t            _super.prototype._setUpCollectionListeners.call(this);\n\t\n\t            //TODO:?? may not be needed? see history-view-edit, 369\n\t            // if a hidden item is created (gen. by a workflow), moves thru the updater to the ready state,\n\t            //  then: remove it from the collection if the panel is set to NOT show hidden datasets\n\t            this.listenTo(this.collection, 'state:ready', function (model, newState, oldState) {\n\t                if (!model.get('visible') && !this.storage.get('show_hidden')) {\n\t                    this.removeItemView(model);\n\t                }\n\t            });\n\t        },\n\t\n\t        /** listening for history events */\n\t        _setUpModelListeners: function _setUpModelListeners() {\n\t            _super.prototype._setUpModelListeners.call(this);\n\t            // ---- history\n\t            // re-broadcast any model change events so that listeners don't have to re-bind to each history\n\t            this.listenTo(this.model, 'change:nice_size change:size', function () {\n\t                this.trigger('history-size-change', this, this.model, arguments);\n\t            }, this);\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ panel rendering\n\t        /** override to add a handler to capture the scroll position when the parent scrolls */\n\t        _setUpBehaviors: function _setUpBehaviors($where) {\n\t            $where = $where || this.$el;\n\t            // we need to call this in _setUpBehaviors which is called after render since the $el\n\t            // may not be attached to $el.parent and $scrollContainer() may not work\n\t            var panel = this;\n\t            _super.prototype._setUpBehaviors.call(panel, $where);\n\t\n\t            // cache the handler to remove and re-add so we don't pile up the handlers\n\t            if (!this._debouncedScrollCaptureHandler) {\n\t                this._debouncedScrollCaptureHandler = _.debounce(function scrollCapture() {\n\t                    // cache the scroll position (only if visible)\n\t                    if (panel.$el.is(':visible')) {\n\t                        panel.preferences.set('scrollPosition', $(this).scrollTop());\n\t                    }\n\t                }, 40);\n\t            }\n\t\n\t            panel.$scrollContainer().off('scroll', this._debouncedScrollCaptureHandler).on('scroll', this._debouncedScrollCaptureHandler);\n\t            return panel;\n\t        },\n\t\n\t        /** In this override, handle null models and move the search input to the top */\n\t        _buildNewRender: function _buildNewRender() {\n\t            if (!this.model) {\n\t                return $();\n\t            }\n\t            var $newRender = _super.prototype._buildNewRender.call(this);\n\t            //TODO: hacky\n\t            $newRender.find('.search').prependTo($newRender.find('.controls'));\n\t            this._renderQuotaMessage($newRender);\n\t            return $newRender;\n\t        },\n\t\n\t        /** render the message displayed when a user is over quota and can't run jobs */\n\t        _renderQuotaMessage: function _renderQuotaMessage($whereTo) {\n\t            $whereTo = $whereTo || this.$el;\n\t            return $(this.templates.quotaMsg({}, this)).prependTo($whereTo.find('.messages'));\n\t        },\n\t\n\t        /** In this override, add links to open data uploader or get data in the tools section */\n\t        _renderEmptyMessage: function _renderEmptyMessage($whereTo) {\n\t            var panel = this,\n\t                $emptyMsg = panel.$emptyMessage($whereTo),\n\t                $toolMenu = $('.toolMenuContainer');\n\t\n\t            if (_.isEmpty(panel.views) && !panel.searchFor && Galaxy && Galaxy.upload && $toolMenu.length) {\n\t                $emptyMsg.empty();\n\t\n\t                $emptyMsg.html([_l('This history is empty'), '. ', _l('You can '), '<a class=\"uploader-link\" href=\"javascript:void(0)\">', _l('load your own data'), '</a>', _l(' or '), '<a class=\"get-data-link\" href=\"javascript:void(0)\">', _l('get data from an external source'), '</a>'].join(''));\n\t                $emptyMsg.find('.uploader-link').click(function (ev) {\n\t                    Galaxy.upload.show(ev);\n\t                });\n\t                $emptyMsg.find('.get-data-link').click(function (ev) {\n\t                    $toolMenu.parent().scrollTop(0);\n\t                    $toolMenu.find('span:contains(\"Get Data\")').click();\n\t                    //.fadeTo( 200, 0.1, function(){\n\t                    //    this.debug( this )\n\t                    //    $( this ).fadeTo( 200, 1.0 );\n\t                    //});\n\t                });\n\t                return $emptyMsg.show();\n\t            }\n\t            return _super.prototype._renderEmptyMessage.call(this, $whereTo);\n\t        },\n\t\n\t        /** In this override, get and set current panel preferences when editor is used */\n\t        _renderTags: function _renderTags($where) {\n\t            var panel = this;\n\t            // render tags and show/hide based on preferences\n\t            _super.prototype._renderTags.call(panel, $where);\n\t            if (panel.preferences.get('tagsEditorShown')) {\n\t                panel.tagsEditor.toggle(true);\n\t            }\n\t            // store preference when shown or hidden\n\t            panel.listenTo(panel.tagsEditor, 'hiddenUntilActivated:shown hiddenUntilActivated:hidden', function (tagsEditor) {\n\t                panel.preferences.set('tagsEditorShown', tagsEditor.hidden);\n\t            });\n\t        },\n\t\n\t        /** In this override, get and set current panel preferences when editor is used */\n\t        _renderAnnotation: function _renderAnnotation($where) {\n\t            var panel = this;\n\t            // render annotation and show/hide based on preferences\n\t            _super.prototype._renderAnnotation.call(panel, $where);\n\t            if (panel.preferences.get('annotationEditorShown')) {\n\t                panel.annotationEditor.toggle(true);\n\t            }\n\t            // store preference when shown or hidden\n\t            panel.listenTo(panel.annotationEditor, 'hiddenUntilActivated:shown hiddenUntilActivated:hidden', function (annotationEditor) {\n\t                panel.preferences.set('annotationEditorShown', annotationEditor.hidden);\n\t            });\n\t        },\n\t\n\t        /** Override to scroll to cached position (in prefs) after swapping */\n\t        _swapNewRender: function _swapNewRender($newRender) {\n\t            _super.prototype._swapNewRender.call(this, $newRender);\n\t            var panel = this;\n\t            _.delay(function () {\n\t                var pos = panel.preferences.get('scrollPosition');\n\t                if (pos) {\n\t                    panel.scrollTo(pos, 0);\n\t                }\n\t            }, 10);\n\t            //TODO: is this enough of a delay on larger histories?\n\t\n\t            return this;\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ sub-views\n\t        /** Override to add the current-content highlight class to currentContentId's view */\n\t        _attachItems: function _attachItems($whereTo) {\n\t            _super.prototype._attachItems.call(this, $whereTo);\n\t            var panel = this;\n\t            if (panel.currentContentId) {\n\t                panel._setCurrentContentById(panel.currentContentId);\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /** Override to remove any drill down panels */\n\t        addItemView: function addItemView(model, collection, options) {\n\t            var view = _super.prototype.addItemView.call(this, model, collection, options);\n\t            if (!view) {\n\t                return view;\n\t            }\n\t            if (this.panelStack.length) {\n\t                return this._collapseDrilldownPanel();\n\t            }\n\t            return view;\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ collection sub-views\n\t        /** In this override, add/remove expanded/collapsed model ids to/from web storage */\n\t        _setUpItemViewListeners: function _setUpItemViewListeners(view) {\n\t            var panel = this;\n\t            _super.prototype._setUpItemViewListeners.call(panel, view);\n\t\n\t            // use pub-sub to: handle drilldown expansion and collapse\n\t            panel.listenTo(view, 'expanded:drilldown', function (v, drilldown) {\n\t                this._expandDrilldownPanel(drilldown);\n\t            });\n\t            panel.listenTo(view, 'collapsed:drilldown', function (v, drilldown) {\n\t                this._collapseDrilldownPanel(drilldown);\n\t            });\n\t\n\t            // when content is manipulated, make it the current-content\n\t            // view.on( 'visualize', function( v, ev ){\n\t            //     this.setCurrentContent( v );\n\t            // }, this );\n\t\n\t            return this;\n\t        },\n\t\n\t        /** display 'current content': add a visible highlight and store the id of a content item */\n\t        setCurrentContent: function setCurrentContent(view) {\n\t            this.$('.history-content.current-content').removeClass('current-content');\n\t            if (view) {\n\t                view.$el.addClass('current-content');\n\t                this.currentContentId = view.model.id;\n\t            } else {\n\t                this.currentContentId = null;\n\t            }\n\t        },\n\t\n\t        /** find the view with the id and then call setCurrentContent on it */\n\t        _setCurrentContentById: function _setCurrentContentById(id) {\n\t            var view = this.viewFromModelId(id) || null;\n\t            this.setCurrentContent(view);\n\t        },\n\t\n\t        /** Handle drill down by hiding this panels list and controls and showing the sub-panel */\n\t        _expandDrilldownPanel: function _expandDrilldownPanel(drilldown) {\n\t            this.panelStack.push(drilldown);\n\t            // hide this panel's controls and list, set the name for back navigation, and attach to the $el\n\t            this.$('> .controls').add(this.$list()).hide();\n\t            drilldown.parentName = this.model.get('name');\n\t            this.$el.append(drilldown.render().$el);\n\t        },\n\t\n\t        /** Handle drilldown close by freeing the panel and re-rendering this panel */\n\t        _collapseDrilldownPanel: function _collapseDrilldownPanel(drilldown) {\n\t            this.panelStack.pop();\n\t            //TODO: MEM: free the panel\n\t            this.render();\n\t        },\n\t\n\t        // ........................................................................ external objects/MVC\n\t        listenToGalaxy: function listenToGalaxy(galaxy) {\n\t            // TODO: MEM: questionable reference island / closure practice\n\t            this.listenTo(galaxy, 'galaxy_main:load', function (data) {\n\t                var pathToMatch = data.fullpath,\n\t                    useToURLRegexMap = {\n\t                    'display': /datasets\\/([a-f0-9]+)\\/display/,\n\t                    'edit': /datasets\\/([a-f0-9]+)\\/edit/,\n\t                    'report_error': /dataset\\/errors\\?id=([a-f0-9]+)/,\n\t                    'rerun': /tool_runner\\/rerun\\?id=([a-f0-9]+)/,\n\t                    'show_params': /datasets\\/([a-f0-9]+)\\/show_params/\n\t                },\n\t                    hdaId = null,\n\t                    hdaUse = null;\n\t                _.find(useToURLRegexMap, function (regex, use) {\n\t                    var match = pathToMatch.match(regex);\n\t                    if (match && match.length == 2) {\n\t                        hdaId = match[1];\n\t                        hdaUse = use;\n\t                        return true;\n\t                    }\n\t                    return false;\n\t                });\n\t                // need to type mangle to go from web route to history contents\n\t                hdaId = 'dataset-' + hdaId;\n\t                this._setCurrentContentById(hdaId);\n\t            });\n\t        },\n\t\n\t        //TODO: remove quota meter from panel and remove this\n\t        /** add listeners to an external quota meter (mvc/user/user-quotameter.js) */\n\t        connectToQuotaMeter: function connectToQuotaMeter(quotaMeter) {\n\t            if (!quotaMeter) {\n\t                return this;\n\t            }\n\t            // show/hide the 'over quota message' in the history when the meter tells it to\n\t            this.listenTo(quotaMeter, 'quota:over', this.showQuotaMessage);\n\t            this.listenTo(quotaMeter, 'quota:under', this.hideQuotaMessage);\n\t\n\t            // having to add this to handle re-render of hview while overquota (the above do not fire)\n\t            this.on('rendered rendered:initial', function () {\n\t                if (quotaMeter && quotaMeter.isOverQuota()) {\n\t                    this.showQuotaMessage();\n\t                }\n\t            });\n\t            return this;\n\t        },\n\t\n\t        //TODO: this seems more like a per user message than a history message; IOW, this doesn't belong here\n\t        /** Override to preserve the quota message */\n\t        clearMessages: function clearMessages(ev) {\n\t            var $target = !_.isUndefined(ev) ? $(ev.currentTarget) : this.$messages().children('[class$=\"message\"]');\n\t            $target = $target.not('.quota-message');\n\t            $target.fadeOut(this.fxSpeed, function () {\n\t                $(this).remove();\n\t            });\n\t            return this;\n\t        },\n\t\n\t        /** Show the over quota message (which happens to be in the history panel).\n\t         */\n\t        showQuotaMessage: function showQuotaMessage() {\n\t            var $msg = this.$('.quota-message');\n\t            if ($msg.is(':hidden')) {\n\t                $msg.slideDown(this.fxSpeed);\n\t            }\n\t        },\n\t\n\t        //TODO: this seems more like a per user message than a history message\n\t        /** Hide the over quota message (which happens to be in the history panel).\n\t         */\n\t        hideQuotaMessage: function hideQuotaMessage() {\n\t            var $msg = this.$('.quota-message');\n\t            if (!$msg.is(':hidden')) {\n\t                $msg.slideUp(this.fxSpeed);\n\t            }\n\t        },\n\t\n\t        /** Return a string rep of the history\n\t         */\n\t        toString: function toString() {\n\t            return 'CurrentHistoryView(' + (this.model ? this.model.get('name') : '') + ')';\n\t        }\n\t    });\n\t\n\t    //------------------------------------------------------------------------------ TEMPLATES\n\t    CurrentHistoryView.prototype.templates = function () {\n\t\n\t        var quotaMsgTemplate = BASE_MVC.wrapTemplate(['<div class=\"quota-message errormessage\">', _l('You are over your disk quota'), '. ', _l('Tool execution is on hold until your disk usage drops below your allocated quota'), '.', '</div>'], 'history');\n\t        return _.extend(_.clone(_super.prototype.templates), {\n\t            quotaMsg: quotaMsgTemplate\n\t        });\n\t    }();\n\t\n\t    //==============================================================================\n\t    return {\n\t        CurrentHistoryView: CurrentHistoryView\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(1)))\n\n/***/ },\n/* 112 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(_, $, jQuery) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(113), __webpack_require__(50), __webpack_require__(12), __webpack_require__(80), __webpack_require__(109), __webpack_require__(110), __webpack_require__(84), __webpack_require__(75), __webpack_require__(40), __webpack_require__(107), __webpack_require__(106), __webpack_require__(24), __webpack_require__(54), __webpack_require__(5), __webpack_require__(17)], __WEBPACK_AMD_DEFINE_RESULT__ = function (HISTORY_VIEW, HISTORY_CONTENTS, STATES, HDA_MODEL, HDA_LI_EDIT, HDCA_LI_EDIT, TAGS, ANNOTATIONS, LIST_COLLECTION_CREATOR, PAIR_COLLECTION_CREATOR, LIST_OF_PAIRS_COLLECTION_CREATOR, faIconButton, PopupMenu, _l) {\n\t\n\t    'use strict';\n\t\n\t    /* =============================================================================\n\t    TODO:\n\t    \n\t    ============================================================================= */\n\t\n\t    var _super = HISTORY_VIEW.HistoryView;\n\t    // base class for history-view-edit-current and used as-is in history/view.mako\n\t    /** @class Editable View/Controller for the history model.\n\t     *\n\t     *  Allows:\n\t     *      (everything HistoryView allows)\n\t     *      changing the name\n\t     *      displaying and editing tags and annotations\n\t     *      multi-selection and operations on mulitple content items\n\t     */\n\t    var HistoryViewEdit = _super.extend(\n\t    /** @lends HistoryViewEdit.prototype */{\n\t\n\t        /** logger used to record this.log messages, commonly set to console */\n\t        //logger              : console,\n\t\n\t        /** class to use for constructing the HistoryDatasetAssociation views */\n\t        HDAViewClass: HDA_LI_EDIT.HDAListItemEdit,\n\t        /** class to use for constructing the HistoryDatasetCollectionAssociation views */\n\t        HDCAViewClass: HDCA_LI_EDIT.HDCAListItemEdit,\n\t\n\t        // ......................................................................... SET UP\n\t        /** Set up the view, set up storage, bind listeners to HistoryContents events\n\t         *  @param {Object} attributes\n\t         */\n\t        initialize: function initialize(attributes) {\n\t            attributes = attributes || {};\n\t            _super.prototype.initialize.call(this, attributes);\n\t\n\t            // ---- set up instance vars\n\t            /** editor for tags - sub-view */\n\t            this.tagsEditor = null;\n\t            /** editor for annotations - sub-view */\n\t            this.annotationEditor = null;\n\t\n\t            /** allow user purge of dataset files? */\n\t            this.purgeAllowed = attributes.purgeAllowed || false;\n\t\n\t            // states/modes the panel can be in\n\t            /** is the panel currently showing the dataset selection controls? */\n\t            this.annotationEditorShown = attributes.annotationEditorShown || false;\n\t            this.tagsEditorShown = attributes.tagsEditorShown || false;\n\t        },\n\t\n\t        /** Override to handle history as drag-drop target */\n\t        _setUpListeners: function _setUpListeners() {\n\t            var panel = this;\n\t            _super.prototype._setUpListeners.call(panel);\n\t\n\t            panel.on('drop', function (ev, data) {\n\t                panel.dataDropped(data);\n\t                // remove the drop target\n\t                panel.dropTargetOff();\n\t            });\n\t            panel.on('view:attached view:removed', function () {\n\t                panel._renderCounts();\n\t            });\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ listeners\n\t        /** listening for collection events */\n\t        _setUpCollectionListeners: function _setUpCollectionListeners() {\n\t            _super.prototype._setUpCollectionListeners.call(this);\n\t\n\t            this.listenTo(this.collection, {\n\t                'change:deleted': this._handleHdaDeletionChange,\n\t                'change:visible': this._handleHdaVisibleChange,\n\t                'change:purged': function changePurged(model) {\n\t                    // hafta get the new nice-size w/o the purged model\n\t                    this.model.fetch();\n\t                }\n\t            });\n\t            return this;\n\t        },\n\t\n\t        /** listening for history and HDA events */\n\t        _setUpModelListeners: function _setUpModelListeners() {\n\t            _super.prototype._setUpModelListeners.call(this);\n\t            this.listenTo(this.model, 'change:size', this.updateHistoryDiskSize);\n\t            return this;\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ panel rendering\n\t        /** In this override, add tag and annotation editors and a btn to toggle the selectors */\n\t        _buildNewRender: function _buildNewRender() {\n\t            // create a new render using a skeleton template, render title buttons, render body, and set up events, etc.\n\t            var $newRender = _super.prototype._buildNewRender.call(this);\n\t            if (!this.model) {\n\t                return $newRender;\n\t            }\n\t\n\t            if (Galaxy && Galaxy.user && Galaxy.user.id && Galaxy.user.id === this.model.get('user_id')) {\n\t                this._renderTags($newRender);\n\t                this._renderAnnotation($newRender);\n\t            }\n\t            return $newRender;\n\t        },\n\t\n\t        /** override to render counts when the items are rendered */\n\t        renderItems: function renderItems($whereTo) {\n\t            var views = _super.prototype.renderItems.call(this, $whereTo);\n\t            this._renderCounts($whereTo);\n\t            return views;\n\t        },\n\t\n\t        /** override to show counts, what's deleted/hidden, and links to toggle those */\n\t        _renderCounts: function _renderCounts($whereTo) {\n\t            //TODO: too complicated\n\t            function toggleLink(_class, text) {\n\t                return ['<a class=\"', _class, '\" href=\"javascript:void(0);\">', text, '</a>'].join('');\n\t            }\n\t            $whereTo = $whereTo || this.$el;\n\t            var deleted = this.collection.where({ deleted: true }),\n\t                hidden = this.collection.where({ visible: false }),\n\t                msgs = [];\n\t\n\t            if (this.views.length) {\n\t                msgs.push([this.views.length, _l('shown')].join(' '));\n\t            }\n\t            if (deleted.length) {\n\t                msgs.push(!this.showDeleted ? [deleted.length, toggleLink('toggle-deleted-link', _l('deleted'))].join(' ') : toggleLink('toggle-deleted-link', _l('hide deleted')));\n\t            }\n\t            if (hidden.length) {\n\t                msgs.push(!this.showHidden ? [hidden.length, toggleLink('toggle-hidden-link', _l('hidden'))].join(' ') : toggleLink('toggle-hidden-link', _l('hide hidden')));\n\t            }\n\t            return $whereTo.find('> .controls .subtitle').html(msgs.join(', '));\n\t        },\n\t\n\t        /** render the tags sub-view controller */\n\t        _renderTags: function _renderTags($where) {\n\t            var panel = this;\n\t            this.tagsEditor = new TAGS.TagsEditor({\n\t                model: this.model,\n\t                el: $where.find('.controls .tags-display'),\n\t                onshowFirstTime: function onshowFirstTime() {\n\t                    this.render();\n\t                },\n\t                // show hide sub-view tag editors when this is shown/hidden\n\t                onshow: function onshow() {\n\t                    panel.toggleHDATagEditors(true, panel.fxSpeed);\n\t                },\n\t                onhide: function onhide() {\n\t                    panel.toggleHDATagEditors(false, panel.fxSpeed);\n\t                },\n\t                $activator: faIconButton({\n\t                    title: _l('Edit history tags'),\n\t                    classes: 'history-tag-btn',\n\t                    faIcon: 'fa-tags'\n\t                }).appendTo($where.find('.controls .actions'))\n\t            });\n\t        },\n\t        /** render the annotation sub-view controller */\n\t        _renderAnnotation: function _renderAnnotation($where) {\n\t            var panel = this;\n\t            this.annotationEditor = new ANNOTATIONS.AnnotationEditor({\n\t                model: this.model,\n\t                el: $where.find('.controls .annotation-display'),\n\t                onshowFirstTime: function onshowFirstTime() {\n\t                    this.render();\n\t                },\n\t                // show hide sub-view view annotation editors when this is shown/hidden\n\t                onshow: function onshow() {\n\t                    panel.toggleHDAAnnotationEditors(true, panel.fxSpeed);\n\t                },\n\t                onhide: function onhide() {\n\t                    panel.toggleHDAAnnotationEditors(false, panel.fxSpeed);\n\t                },\n\t                $activator: faIconButton({\n\t                    title: _l('Edit history annotation'),\n\t                    classes: 'history-annotate-btn',\n\t                    faIcon: 'fa-comment'\n\t                }).appendTo($where.find('.controls .actions'))\n\t            });\n\t        },\n\t\n\t        /** Set up HistoryViewEdit js/widget behaviours\n\t         *  In this override, make the name editable\n\t         */\n\t        _setUpBehaviors: function _setUpBehaviors($where) {\n\t            $where = $where || this.$el;\n\t            _super.prototype._setUpBehaviors.call(this, $where);\n\t            if (!this.model) {\n\t                return;\n\t            }\n\t\n\t            // anon users shouldn't have access to any of the following\n\t            if (!Galaxy.user || Galaxy.user.isAnonymous() || Galaxy.user.id !== this.model.get('user_id')) {\n\t                return;\n\t            }\n\t\n\t            var panel = this,\n\t                nameSelector = '> .controls .name';\n\t            $where.find(nameSelector).attr('title', _l('Click to rename history')).tooltip({ placement: 'bottom' }).make_text_editable({\n\t                on_finish: function on_finish(newName) {\n\t                    var previousName = panel.model.get('name');\n\t                    if (newName && newName !== previousName) {\n\t                        panel.$el.find(nameSelector).text(newName);\n\t                        panel.model.save({ name: newName }).fail(function () {\n\t                            panel.$el.find(nameSelector).text(panel.model.previous('name'));\n\t                        });\n\t                    } else {\n\t                        panel.$el.find(nameSelector).text(previousName);\n\t                    }\n\t                }\n\t            });\n\t        },\n\t\n\t        /** return a new popup menu for choosing a multi selection action\n\t         *  ajax calls made for multiple datasets are queued\n\t         */\n\t        multiselectActions: function multiselectActions() {\n\t            var panel = this,\n\t                actions = [{ html: _l('Hide datasets'), func: function func() {\n\t                    var action = HDA_MODEL.HistoryDatasetAssociation.prototype.hide;\n\t                    panel.getSelectedModels().ajaxQueue(action);\n\t                }\n\t            }, { html: _l('Unhide datasets'), func: function func() {\n\t                    var action = HDA_MODEL.HistoryDatasetAssociation.prototype.unhide;\n\t                    panel.getSelectedModels().ajaxQueue(action);\n\t                }\n\t            }, { html: _l('Delete datasets'), func: function func() {\n\t                    var action = HDA_MODEL.HistoryDatasetAssociation.prototype['delete'];\n\t                    panel.getSelectedModels().ajaxQueue(action);\n\t                }\n\t            }, { html: _l('Undelete datasets'), func: function func() {\n\t                    var action = HDA_MODEL.HistoryDatasetAssociation.prototype.undelete;\n\t                    panel.getSelectedModels().ajaxQueue(action);\n\t                }\n\t            }];\n\t            if (panel.purgeAllowed) {\n\t                actions.push({\n\t                    html: _l('Permanently delete datasets'), func: function func() {\n\t                        if (confirm(_l('This will permanently remove the data in your datasets. Are you sure?'))) {\n\t                            var action = HDA_MODEL.HistoryDatasetAssociation.prototype.purge;\n\t                            panel.getSelectedModels().ajaxQueue(action);\n\t                        }\n\t                    }\n\t                });\n\t            }\n\t            actions = actions.concat(panel._collectionActions());\n\t            return actions;\n\t        },\n\t\n\t        /**   */\n\t        _collectionActions: function _collectionActions() {\n\t            var panel = this;\n\t            return [{ html: _l('Build Dataset List'), func: function func() {\n\t                    LIST_COLLECTION_CREATOR.createListCollection(panel.getSelectedModels()).done(function () {\n\t                        panel.model.refresh();\n\t                    });\n\t                }\n\t            },\n\t            // TODO: Only show quick pair if two things selected.\n\t            { html: _l('Build Dataset Pair'), func: function func() {\n\t                    PAIR_COLLECTION_CREATOR.createPairCollection(panel.getSelectedModels()).done(function () {\n\t                        panel.model.refresh();\n\t                    });\n\t                }\n\t            }, { html: _l('Build List of Dataset Pairs'), func: function func() {\n\t                    LIST_OF_PAIRS_COLLECTION_CREATOR.createListOfPairsCollection(panel.getSelectedModels()).done(function () {\n\t                        panel.model.refresh();\n\t                    });\n\t                }\n\t            }];\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ sub-views\n\t        // reverse HID order\n\t        /** Override to reverse order of views - newest contents on top */\n\t        _attachItems: function _attachItems($whereTo) {\n\t            this.$list($whereTo).append(this.views.reverse().map(function (view) {\n\t                return view.$el;\n\t            }));\n\t            return this;\n\t        },\n\t\n\t        /** Override to add new contents at the top */\n\t        _attachView: function _attachView(view) {\n\t            var panel = this;\n\t            // override to control where the view is added, how/whether it's rendered\n\t            panel.views.unshift(view);\n\t            panel.$list().prepend(view.render(0).$el.hide());\n\t            panel.trigger('view:attached', view);\n\t            view.$el.slideDown(panel.fxSpeed, function () {\n\t                panel.trigger('view:attached:rendered');\n\t            });\n\t        },\n\t\n\t        /** In this override, add purgeAllowed and whether tags/annotation editors should be shown */\n\t        _getItemViewOptions: function _getItemViewOptions(model) {\n\t            var options = _super.prototype._getItemViewOptions.call(this, model);\n\t            _.extend(options, {\n\t                purgeAllowed: this.purgeAllowed,\n\t                //TODO: not working\n\t                tagsEditorShown: this.tagsEditor && !this.tagsEditor.hidden,\n\t                annotationEditorShown: this.annotationEditor && !this.annotationEditor.hidden\n\t            });\n\t            return options;\n\t        },\n\t\n\t        ///** Override to alter data in drag based on multiselection */\n\t        //_setUpItemViewListeners : function( view ){\n\t        //    var panel = this;\n\t        //    _super.prototype._setUpItemViewListeners.call( panel, view );\n\t        //\n\t        //},\n\t\n\t        /** If this item is deleted and we're not showing deleted items, remove the view\n\t         *  @param {Model} the item model to check\n\t         */\n\t        _handleHdaDeletionChange: function _handleHdaDeletionChange(itemModel) {\n\t            if (itemModel.get('deleted') && !this.showDeleted) {\n\t                this.removeItemView(itemModel);\n\t            }\n\t            this._renderCounts();\n\t        },\n\t\n\t        /** If this item is hidden and we're not showing hidden items, remove the view\n\t         *  @param {Model} the item model to check\n\t         */\n\t        _handleHdaVisibleChange: function _handleHdaVisibleChange(itemModel) {\n\t            if (itemModel.hidden() && !this.showHidden) {\n\t                this.removeItemView(itemModel);\n\t            }\n\t            this._renderCounts();\n\t        },\n\t\n\t        /** toggle the visibility of each content's tagsEditor applying all the args sent to this function */\n\t        toggleHDATagEditors: function toggleHDATagEditors(showOrHide) {\n\t            var args = Array.prototype.slice.call(arguments, 1);\n\t            _.each(this.views, function (view) {\n\t                if (view.tagsEditor) {\n\t                    view.tagsEditor.toggle.apply(view.tagsEditor, args);\n\t                }\n\t            });\n\t        },\n\t\n\t        /** toggle the visibility of each content's annotationEditor applying all the args sent to this function */\n\t        toggleHDAAnnotationEditors: function toggleHDAAnnotationEditors(showOrHide) {\n\t            var args = Array.prototype.slice.call(arguments, 1);\n\t            _.each(this.views, function (view) {\n\t                if (view.annotationEditor) {\n\t                    view.annotationEditor.toggle.apply(view.annotationEditor, args);\n\t                }\n\t            });\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ panel events\n\t        /** event map */\n\t        events: _.extend(_.clone(_super.prototype.events), {\n\t            'click .show-selectors-btn': 'toggleSelectors',\n\t            'click .toggle-deleted-link': function clickToggleDeletedLink(ev) {\n\t                this.toggleShowDeleted();\n\t            },\n\t            'click .toggle-hidden-link': function clickToggleHiddenLink(ev) {\n\t                this.toggleShowHidden();\n\t            }\n\t        }),\n\t\n\t        /** Update the history size display (curr. upper right of panel).\n\t         */\n\t        updateHistoryDiskSize: function updateHistoryDiskSize() {\n\t            this.$el.find('.history-size').text(this.model.get('nice_size'));\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ as drop target\n\t        /**  */\n\t        dropTargetOn: function dropTargetOn() {\n\t            if (this.dropTarget) {\n\t                return this;\n\t            }\n\t            this.dropTarget = true;\n\t\n\t            //TODO: to init\n\t            var dropHandlers = {\n\t                'dragenter': _.bind(this.dragenter, this),\n\t                'dragover': _.bind(this.dragover, this),\n\t                'dragleave': _.bind(this.dragleave, this),\n\t                'drop': _.bind(this.drop, this)\n\t            };\n\t            //TODO: scroll to top\n\t            var $dropTarget = this._renderDropTarget();\n\t            this.$list().before([this._renderDropTargetHelp(), $dropTarget]);\n\t            for (var evName in dropHandlers) {\n\t                if (dropHandlers.hasOwnProperty(evName)) {\n\t                    //console.debug( evName, dropHandlers[ evName ] );\n\t                    $dropTarget.on(evName, dropHandlers[evName]);\n\t                }\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /**  */\n\t        _renderDropTarget: function _renderDropTarget() {\n\t            this.$('.history-drop-target').remove();\n\t            return $('<div/>').addClass('history-drop-target').css({\n\t                'height': '64px',\n\t                'margin': '0px 10px 10px 10px',\n\t                'border': '1px dashed black',\n\t                'border-radius': '3px'\n\t            });\n\t        },\n\t\n\t        /**  */\n\t        _renderDropTargetHelp: function _renderDropTargetHelp() {\n\t            this.$('.history-drop-target-help').remove();\n\t            return $('<div/>').addClass('history-drop-target-help').css({\n\t                'margin': '10px 10px 4px 10px',\n\t                'color': 'grey',\n\t                'font-size': '80%',\n\t                'font-style': 'italic'\n\t            }).text(_l('Drag datasets here to copy them to the current history'));\n\t        },\n\t\n\t        /**  */\n\t        dropTargetOff: function dropTargetOff() {\n\t            if (!this.dropTarget) {\n\t                return this;\n\t            }\n\t            //this.log( 'dropTargetOff' );\n\t            this.dropTarget = false;\n\t            var dropTarget = this.$('.history-drop-target').get(0);\n\t            for (var evName in this._dropHandlers) {\n\t                if (this._dropHandlers.hasOwnProperty(evName)) {\n\t                    dropTarget.off(evName, this._dropHandlers[evName]);\n\t                }\n\t            }\n\t            this.$('.history-drop-target').remove();\n\t            this.$('.history-drop-target-help').remove();\n\t            return this;\n\t        },\n\t        /**  */\n\t        dropTargetToggle: function dropTargetToggle() {\n\t            if (this.dropTarget) {\n\t                this.dropTargetOff();\n\t            } else {\n\t                this.dropTargetOn();\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /**  */\n\t        dragenter: function dragenter(ev) {\n\t            //console.debug( 'dragenter:', this, ev );\n\t            ev.preventDefault();\n\t            ev.stopPropagation();\n\t            this.$('.history-drop-target').css('border', '2px solid black');\n\t        },\n\t        /**  */\n\t        dragover: function dragover(ev) {\n\t            ev.preventDefault();\n\t            ev.stopPropagation();\n\t        },\n\t        /**  */\n\t        dragleave: function dragleave(ev) {\n\t            //console.debug( 'dragleave:', this, ev );\n\t            ev.preventDefault();\n\t            ev.stopPropagation();\n\t            this.$('.history-drop-target').css('border', '1px dashed black');\n\t        },\n\t        /**  */\n\t        drop: function drop(ev) {\n\t            ev.preventDefault();\n\t            //ev.stopPropagation();\n\t\n\t            var dataTransfer = ev.originalEvent.dataTransfer;\n\t            dataTransfer.dropEffect = 'move';\n\t\n\t            var panel = this,\n\t                data = dataTransfer.getData(\"text\");\n\t            try {\n\t                data = JSON.parse(data);\n\t            } catch (err) {\n\t                this.warn('error parsing JSON from drop:', data);\n\t            }\n\t            this.trigger('droptarget:drop', ev, data, panel);\n\t            return false;\n\t        },\n\t\n\t        /**  */\n\t        dataDropped: function dataDropped(data) {\n\t            var panel = this;\n\t            // HDA: dropping will copy it to the history\n\t            if (_.isObject(data) && data.model_class === 'HistoryDatasetAssociation' && data.id) {\n\t                return panel.model.contents.copy(data.id);\n\t            }\n\t            return jQuery.when();\n\t        },\n\t\n\t        // ........................................................................ misc\n\t        /** Return a string rep of the history */\n\t        toString: function toString() {\n\t            return 'HistoryViewEdit(' + (this.model ? this.model.get('name') : '') + ')';\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    return {\n\t        HistoryViewEdit: HistoryViewEdit\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(1)))\n\n/***/ },\n/* 113 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(_, $) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(83), __webpack_require__(82), __webpack_require__(50), __webpack_require__(79), __webpack_require__(81), __webpack_require__(29), __webpack_require__(24), __webpack_require__(54), __webpack_require__(6), __webpack_require__(5), __webpack_require__(89)], __WEBPACK_AMD_DEFINE_RESULT__ = function (LIST_VIEW, HISTORY_MODEL, HISTORY_CONTENTS, HDA_LI, HDCA_LI, USER, faIconButton, PopupMenu, BASE_MVC, _l) {\n\t\n\t    'use strict';\n\t\n\t    var logNamespace = 'history';\n\t\n\t    // ============================================================================\n\t    /** session storage for individual history preferences */\n\t    var HistoryPrefs = BASE_MVC.SessionStorageModel.extend(\n\t    /** @lends HistoryPrefs.prototype */{\n\t        //TODO:?? possibly mark as current T/F - have History.currId() (a class method) return that value\n\t        defaults: {\n\t            //TODO:?? expandedIds to array?\n\t            expandedIds: {},\n\t            //TODO:?? move to user?\n\t            show_deleted: false,\n\t            show_hidden: false\n\t            //TODO: add scroll position?\n\t        },\n\t        /** add an hda id to the hash of expanded hdas */\n\t        addExpanded: function addExpanded(model) {\n\t            var key = 'expandedIds';\n\t            //TODO:?? is this right anymore?\n\t            this.save(key, _.extend(this.get(key), _.object([model.id], [model.get('id')])));\n\t        },\n\t        /** remove an hda id from the hash of expanded hdas */\n\t        removeExpanded: function removeExpanded(model) {\n\t            var key = 'expandedIds';\n\t            this.save(key, _.omit(this.get(key), model.id));\n\t        },\n\t        toString: function toString() {\n\t            return 'HistoryPrefs(' + this.id + ')';\n\t        }\n\t    });\n\t    // class lvl for access w/o instantiation\n\t    HistoryPrefs.storageKeyPrefix = 'history:';\n\t\n\t    /** key string to store each histories settings under */\n\t    HistoryPrefs.historyStorageKey = function historyStorageKey(historyId) {\n\t        if (!historyId) {\n\t            throw new Error('HistoryPrefs.historyStorageKey needs valid id: ' + historyId);\n\t        }\n\t        // single point of change\n\t        return HistoryPrefs.storageKeyPrefix + historyId;\n\t    };\n\t    /** return the existing storage for the history with the given id (or create one if it doesn't exist) */\n\t    HistoryPrefs.get = function get(historyId) {\n\t        return new HistoryPrefs({ id: HistoryPrefs.historyStorageKey(historyId) });\n\t    };\n\t    /** clear all history related items in sessionStorage */\n\t    HistoryPrefs.clearAll = function clearAll(historyId) {\n\t        for (var key in sessionStorage) {\n\t            if (key.indexOf(HistoryPrefs.storageKeyPrefix) === 0) {\n\t                sessionStorage.removeItem(key);\n\t            }\n\t        }\n\t    };\n\t\n\t    /* =============================================================================\n\t    TODO:\n\t    \n\t    ============================================================================= */\n\t    /** @class  non-editable, read-only View/Controller for a history model.\n\t     *  Allows:\n\t     *      changing the loaded history\n\t     *      displaying data, info, and download\n\t     *      tracking history attrs: size, tags, annotations, name, etc.\n\t     *  Does not allow:\n\t     *      changing the name\n\t     */\n\t    var _super = LIST_VIEW.ModelListPanel;\n\t    var HistoryView = _super.extend(\n\t    /** @lends HistoryView.prototype */{\n\t        _logNamespace: logNamespace,\n\t\n\t        /** class to use for constructing the HDA views */\n\t        HDAViewClass: HDA_LI.HDAListItemView,\n\t        /** class to use for constructing the HDCA views */\n\t        HDCAViewClass: HDCA_LI.HDCAListItemView,\n\t        /** class to used for constructing collection of sub-view models */\n\t        collectionClass: HISTORY_CONTENTS.HistoryContents,\n\t        /** key of attribute in model to assign to this.collection */\n\t        modelCollectionKey: 'contents',\n\t\n\t        tagName: 'div',\n\t        className: _super.prototype.className + ' history-panel',\n\t\n\t        /** string to display when the collection is empty */\n\t        emptyMsg: _l('This history is empty'),\n\t        /** displayed when no items match the search terms */\n\t        noneFoundMsg: _l('No matching datasets found'),\n\t        /** string used for search placeholder */\n\t        searchPlaceholder: _l('search datasets'),\n\t\n\t        // ......................................................................... SET UP\n\t        /** Set up the view, bind listeners.\n\t         *  @param {Object} attributes optional settings for the panel\n\t         */\n\t        initialize: function initialize(attributes) {\n\t            _super.prototype.initialize.call(this, attributes);\n\t            // ---- instance vars\n\t            // control contents/behavior based on where (and in what context) the panel is being used\n\t            /** where should pages from links be displayed? (default to new tab/window) */\n\t            this.linkTarget = attributes.linkTarget || '_blank';\n\t        },\n\t\n\t        /** In this override, clear the update timer on the model */\n\t        freeModel: function freeModel() {\n\t            _super.prototype.freeModel.call(this);\n\t            if (this.model) {\n\t                //TODO: move to History.free()\n\t                this.model.clearUpdateTimeout();\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /** create any event listeners for the panel\n\t         *  @fires: rendered:initial    on the first render\n\t         *  @fires: empty-history       when switching to a history with no contents or creating a new history\n\t         */\n\t        _setUpListeners: function _setUpListeners() {\n\t            _super.prototype._setUpListeners.call(this);\n\t            this.on({\n\t                error: function error(model, xhr, options, msg, details) {\n\t                    this.errorHandler(model, xhr, options, msg, details);\n\t                },\n\t                'loading-done': function loadingDone() {\n\t                    //TODO:?? if( this.collection.length ){\n\t                    if (!this.views.length) {\n\t                        this.trigger('empty-history', this);\n\t                    }\n\t                },\n\t                'views:ready view:attached view:removed': function viewsReadyViewAttachedViewRemoved(view) {\n\t                    this._renderSelectButton();\n\t                }\n\t            });\n\t            // this.on( 'all', function(){ console.debug( arguments ); });\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ loading history/hda models\n\t        //NOTE: all the following fns replace the existing history model with a new model\n\t        // (in the following 'details' refers to the full set of contents api data (urls, display_apps, misc_info, etc.)\n\t        //  - contents w/o details will have summary data only (name, hid, deleted, visible, state, etc.))\n\t        //TODO: too tangled...\n\t\n\t        /** loads a history & contents, getting details of any contents whose ids are stored in sessionStorage\n\t         *      (but does not make them the current history)\n\t         */\n\t        loadHistoryWithDetails: function loadHistoryWithDetails(historyId, attributes, historyFn, contentsFn) {\n\t            this.info('loadHistoryWithDetails:', historyId, attributes, historyFn, contentsFn);\n\t            var detailIdsFn = function detailIdsFn(historyData) {\n\t                // will be called to get content ids that need details from the api\n\t                //TODO:! non-visible contents are getting details loaded... either stop loading them at all or filter ids thru isVisible\n\t                return _.values(HistoryPrefs.get(historyData.id).get('expandedIds'));\n\t            };\n\t            return this.loadHistory(historyId, attributes, historyFn, contentsFn, detailIdsFn);\n\t        },\n\t\n\t        /** @type {Number} ms to wait after history load to fetch/decorate hdcas with element_count */\n\t        FETCH_COLLECTION_COUNTS_DELAY: 2000,\n\t\n\t        /** loads a history & contents (but does not make them the current history) */\n\t        loadHistory: function loadHistory(historyId, attributes, historyFn, contentsFn, detailIdsFn) {\n\t            this.info('loadHistory:', historyId, attributes, historyFn, contentsFn, detailIdsFn);\n\t            var panel = this;\n\t            attributes = attributes || {};\n\t\n\t            panel.trigger('loading', panel);\n\t            //this.info( 'loadHistory:', historyId, attributes, historyFn, contentsFn, detailIdsFn );\n\t            var xhr = HISTORY_MODEL.History.getHistoryData(historyId, {\n\t                historyFn: historyFn,\n\t                contentsFn: contentsFn,\n\t                detailIdsFn: attributes.initiallyExpanded || detailIdsFn\n\t            });\n\t\n\t            return panel._loadHistoryFromXHR(xhr, attributes).fail(function (xhr, where, history) {\n\t                // throw an error up for the error handler\n\t                panel.trigger('error', panel, xhr, attributes, _l('An error was encountered while ' + where), { historyId: historyId, history: history || {} });\n\t            }).done(function () {\n\t                // after the initial load, decorate with more time consuming fields (like HDCA element_counts)\n\t                _.delay(function () {\n\t                    panel.model.contents.fetchCollectionCounts();\n\t                }, panel.FETCH_COLLECTION_COUNTS_DELAY);\n\t            }).always(function () {\n\t                // bc _hideLoadingIndicator relies on this firing\n\t                panel.trigger('loading-done', panel);\n\t            });\n\t        },\n\t\n\t        /** given an xhr that will provide both history and contents data, pass data to set model or handle xhr errors */\n\t        _loadHistoryFromXHR: function _loadHistoryFromXHR(xhr, attributes) {\n\t            var panel = this;\n\t            xhr.then(function (historyJSON, contentsJSON) {\n\t                panel.JSONToModel(historyJSON, contentsJSON, attributes);\n\t                panel.render();\n\t            }).fail(function (xhr, where) {\n\t                // render anyways - whether we get a model or not\n\t                panel.render();\n\t            });\n\t            return xhr;\n\t        },\n\t\n\t        /** convenience alias to the model. Updates the item list only (not the history) */\n\t        refreshContents: function refreshContents(options) {\n\t            if (this.model) {\n\t                return this.model.refresh(options);\n\t            }\n\t            // may have callbacks - so return an empty promise\n\t            return $.when();\n\t        },\n\t\n\t        //TODO:?? seems unneccesary\n\t        //TODO: Maybe better in History?\n\t        /** create a new history model from JSON and call setModel on it */\n\t        JSONToModel: function JSONToModel(newHistoryJSON, newHdaJSON, attributes) {\n\t            this.log('JSONToModel:', newHistoryJSON, newHdaJSON, attributes);\n\t            attributes = attributes || {};\n\t            //this.log( 'JSONToModel:', newHistoryJSON, newHdaJSON.length, attributes );\n\t\n\t            var model = new HISTORY_MODEL.History(newHistoryJSON, newHdaJSON, attributes);\n\t            //TODO:?? here?\n\t            this.setModel(model);\n\t            return model;\n\t        },\n\t\n\t        /** release/free/shutdown old models and set up panel for new models\n\t         *  @fires new-model with the panel as parameter\n\t         */\n\t        setModel: function setModel(model, attributes) {\n\t            attributes = attributes || {};\n\t            _super.prototype.setModel.call(this, model, attributes);\n\t            if (this.model) {\n\t                this._setUpWebStorage(attributes.initiallyExpanded, attributes.show_deleted, attributes.show_hidden);\n\t            }\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ browser stored prefs\n\t        /** Set up client side storage. Currently PersistanStorage keyed under 'history:<id>'\n\t         *  @param {Object} initiallyExpanded\n\t         *  @param {Boolean} show_deleted whether to show deleted contents (overrides stored)\n\t         *  @param {Boolean} show_hidden\n\t         *  @see PersistentStorage\n\t         */\n\t        _setUpWebStorage: function _setUpWebStorage(initiallyExpanded, show_deleted, show_hidden) {\n\t            //if( !this.model ){ return this; }\n\t            //this.log( '_setUpWebStorage', initiallyExpanded, show_deleted, show_hidden );\n\t            if (this.storage) {\n\t                this.stopListening(this.storage);\n\t            }\n\t\n\t            this.storage = new HistoryPrefs({\n\t                id: HistoryPrefs.historyStorageKey(this.model.get('id'))\n\t            });\n\t\n\t            // expandedIds is a map of content.ids -> a boolean repr'ing whether that item's body is already expanded\n\t            // store any pre-expanded ids passed in\n\t            if (_.isObject(initiallyExpanded)) {\n\t                this.storage.set('expandedIds', initiallyExpanded);\n\t            }\n\t\n\t            // get the show_deleted/hidden settings giving priority to values passed in, using web storage otherwise\n\t            // if the page has specifically requested show_deleted/hidden, these will be either true or false\n\t            //  (as opposed to undefined, null) - and we give priority to that setting\n\t            if (_.isBoolean(show_deleted)) {\n\t                this.storage.set('show_deleted', show_deleted);\n\t            }\n\t            if (_.isBoolean(show_hidden)) {\n\t                this.storage.set('show_hidden', show_hidden);\n\t            }\n\t\n\t            this.trigger('new-storage', this.storage, this);\n\t            this.log(this + ' (init\\'d) storage:', this.storage.get());\n\t\n\t            this.listenTo(this.storage, {\n\t                'change:show_deleted': function changeShow_deleted(view, newVal) {\n\t                    this.showDeleted = newVal;\n\t                },\n\t                'change:show_hidden': function changeShow_hidden(view, newVal) {\n\t                    this.showHidden = newVal;\n\t                }\n\t            }, this);\n\t            this.showDeleted = show_deleted !== undefined ? show_deleted : this.storage.get('show_deleted');\n\t            this.showHidden = show_hidden !== undefined ? show_hidden : this.storage.get('show_hidden');\n\t\n\t            return this;\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ panel rendering\n\t        /** In this override, add a btn to toggle the selectors */\n\t        _buildNewRender: function _buildNewRender() {\n\t            var $newRender = _super.prototype._buildNewRender.call(this);\n\t            this._renderSelectButton($newRender);\n\t            return $newRender;\n\t        },\n\t\n\t        /** button for starting select mode */\n\t        _renderSelectButton: function _renderSelectButton($where) {\n\t            $where = $where || this.$el;\n\t            // do not render selector option if no actions\n\t            if (!this.multiselectActions().length) {\n\t                return null;\n\t            }\n\t            // do not render (and remove even) if nothing to select\n\t            if (!this.views.length) {\n\t                this.hideSelectors();\n\t                $where.find('.controls .actions .show-selectors-btn').remove();\n\t                return null;\n\t            }\n\t            // don't bother rendering if there's one already\n\t            var $existing = $where.find('.controls .actions .show-selectors-btn');\n\t            if ($existing.length) {\n\t                return $existing;\n\t            }\n\t\n\t            return faIconButton({\n\t                title: _l('Operations on multiple datasets'),\n\t                classes: 'show-selectors-btn',\n\t                faIcon: 'fa-check-square-o'\n\t            }).prependTo($where.find('.controls .actions'));\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ sub-views\n\t        /** In this override, since history contents are mixed,\n\t         *      get the appropo view class based on history_content_type\n\t         */\n\t        _getItemViewClass: function _getItemViewClass(model) {\n\t            var contentType = model.get(\"history_content_type\");\n\t            switch (contentType) {\n\t                case 'dataset':\n\t                    return this.HDAViewClass;\n\t                case 'dataset_collection':\n\t                    return this.HDCAViewClass;\n\t            }\n\t            throw new TypeError('Unknown history_content_type: ' + contentType);\n\t        },\n\t\n\t        /** in this override, check if the contents would also display based on show_deleted/hidden */\n\t        _filterItem: function _filterItem(model) {\n\t            var panel = this;\n\t            return _super.prototype._filterItem.call(panel, model) && (!model.hidden() || panel.showHidden) && (!model.isDeletedOrPurged() || panel.showDeleted);\n\t        },\n\t\n\t        /** in this override, add a linktarget, and expand if id is in web storage */\n\t        _getItemViewOptions: function _getItemViewOptions(model) {\n\t            var options = _super.prototype._getItemViewOptions.call(this, model);\n\t            return _.extend(options, {\n\t                linkTarget: this.linkTarget,\n\t                expanded: !!this.storage.get('expandedIds')[model.id],\n\t                hasUser: this.model.ownedByCurrUser()\n\t            });\n\t        },\n\t\n\t        /** In this override, add/remove expanded/collapsed model ids to/from web storage */\n\t        _setUpItemViewListeners: function _setUpItemViewListeners(view) {\n\t            var panel = this;\n\t            _super.prototype._setUpItemViewListeners.call(panel, view);\n\t\n\t            //TODO:?? could use 'view:expanded' here?\n\t            // maintain a list of items whose bodies are expanded\n\t            panel.listenTo(view, {\n\t                'expanded': function expanded(v) {\n\t                    panel.storage.addExpanded(v.model);\n\t                },\n\t                'collapsed': function collapsed(v) {\n\t                    panel.storage.removeExpanded(v.model);\n\t                }\n\t            });\n\t            return this;\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ selection\n\t        /** Override to correctly set the historyId of the new collection */\n\t        getSelectedModels: function getSelectedModels() {\n\t            var collection = _super.prototype.getSelectedModels.call(this);\n\t            collection.historyId = this.collection.historyId;\n\t            return collection;\n\t        },\n\t\n\t        // ------------------------------------------------------------------------ panel events\n\t        /** event map */\n\t        events: _.extend(_.clone(_super.prototype.events), {\n\t            // toggle list item selectors\n\t            'click .show-selectors-btn': 'toggleSelectors',\n\t            // allow (error) messages to be clicked away\n\t            'click .messages [class$=message]': 'clearMessages'\n\t        }),\n\t\n\t        /** Handle the user toggling the deleted visibility by:\n\t         *      (1) storing the new value in the persistent storage\n\t         *      (2) re-rendering the history\n\t         * @returns {Boolean} new show_deleted setting\n\t         */\n\t        toggleShowDeleted: function toggleShowDeleted(show, store) {\n\t            show = show !== undefined ? show : !this.showDeleted;\n\t            store = store !== undefined ? store : true;\n\t            this.showDeleted = show;\n\t            if (store) {\n\t                this.storage.set('show_deleted', show);\n\t            }\n\t            //TODO:?? to events on storage('change:show_deleted')\n\t            this.renderItems();\n\t            this.trigger('show-deleted', show);\n\t            return this.showDeleted;\n\t        },\n\t\n\t        /** Handle the user toggling the hidden visibility by:\n\t         *      (1) storing the new value in the persistent storage\n\t         *      (2) re-rendering the history\n\t         * @returns {Boolean} new show_hidden setting\n\t         */\n\t        toggleShowHidden: function toggleShowHidden(show, store) {\n\t            show = show !== undefined ? show : !this.showHidden;\n\t            store = store !== undefined ? store : true;\n\t            this.showHidden = show;\n\t            if (store) {\n\t                this.storage.set('show_hidden', show);\n\t            }\n\t            //TODO:?? to events on storage('change:show_deleted')\n\t            this.renderItems();\n\t            this.trigger('show-hidden', show);\n\t            return this.showHidden;\n\t        },\n\t\n\t        /** On the first search, if there are no details - load them, then search */\n\t        _firstSearch: function _firstSearch(searchFor) {\n\t            var panel = this,\n\t                inputSelector = '.history-search-input';\n\t            this.log('onFirstSearch', searchFor);\n\t\n\t            if (panel.model.contents.haveDetails()) {\n\t                panel.searchItems(searchFor);\n\t                return;\n\t            }\n\t\n\t            panel.$el.find(inputSelector).searchInput('toggle-loading');\n\t            panel.model.contents.fetchAllDetails({ silent: true }).always(function () {\n\t                panel.$el.find(inputSelector).searchInput('toggle-loading');\n\t            }).done(function () {\n\t                panel.searchItems(panel.searchFor);\n\t            });\n\t        },\n\t\n\t        //TODO: break this out\n\t        // ........................................................................ error handling\n\t        /** Event handler for errors (from the panel, the history, or the history's contents)\n\t         *  @param {Model or View} model    the (Backbone) source of the error\n\t         *  @param {XMLHTTPRequest} xhr     any ajax obj. assoc. with the error\n\t         *  @param {Object} options         the options map commonly used with bbone ajax\n\t         *  @param {String} msg             optional message passed to ease error location\n\t         *  @param {Object} msg             optional object containing error details\n\t         */\n\t        errorHandler: function errorHandler(model, xhr, options, msg, details) {\n\t            this.error(model, xhr, options, msg, details);\n\t\n\t            // interrupted ajax\n\t            if (xhr && xhr.status === 0 && xhr.readyState === 0) {\n\t                //TODO: gmail style 'retrying in Ns'\n\t\n\t                // bad gateway\n\t            } else if (xhr && xhr.status === 502) {\n\t                //TODO: gmail style 'retrying in Ns'\n\t\n\t                // otherwise, show an error message inside the panel\n\t            } else {\n\t                // if sentry is available, attempt to get the event id\n\t                var parsed = this._parseErrorMessage(model, xhr, options, msg, details);\n\t                // it's possible to have a triggered error before the message container is rendered - wait for it to show\n\t                if (!this.$messages().is(':visible')) {\n\t                    this.once('rendered', function () {\n\t                        this.displayMessage('error', parsed.message, parsed.details);\n\t                    });\n\t                } else {\n\t                    this.displayMessage('error', parsed.message, parsed.details);\n\t                }\n\t            }\n\t        },\n\t\n\t        /** Parse an error event into an Object usable by displayMessage based on the parameters\n\t         *      note: see errorHandler for more info on params\n\t         */\n\t        _parseErrorMessage: function _parseErrorMessage(model, xhr, options, msg, details, sentryId) {\n\t            //if( xhr.responseText ){\n\t            //    xhr.responseText = _.escape( xhr.responseText );\n\t            //}\n\t            var user = Galaxy.user,\n\t\n\t            // add the args (w/ some extra info) into an obj\n\t            parsed = {\n\t                message: this._bePolite(msg),\n\t                details: {\n\t                    message: msg,\n\t                    raven: window.Raven && _.isFunction(Raven.lastEventId) ? Raven.lastEventId() : undefined,\n\t                    agent: navigator.userAgent,\n\t                    // add ajax data from Galaxy object cache\n\t                    url: window.Galaxy ? Galaxy.lastAjax.url : undefined,\n\t                    data: window.Galaxy ? Galaxy.lastAjax.data : undefined,\n\t                    options: xhr ? _.omit(options, 'xhr') : options,\n\t                    xhr: xhr,\n\t                    source: _.isFunction(model.toJSON) ? model.toJSON() : model + '',\n\t                    user: user instanceof USER.User ? user.toJSON() : user + ''\n\t                }\n\t            };\n\t\n\t            // add any extra details passed in\n\t            _.extend(parsed.details, details || {});\n\t            // fancy xhr.header parsing (--> obj)\n\t            if (xhr && _.isFunction(xhr.getAllResponseHeaders)) {\n\t                var responseHeaders = xhr.getAllResponseHeaders();\n\t                responseHeaders = _.compact(responseHeaders.split('\\n'));\n\t                responseHeaders = _.map(responseHeaders, function (header) {\n\t                    return header.split(': ');\n\t                });\n\t                parsed.details.xhr.responseHeaders = _.object(responseHeaders);\n\t            }\n\t            return parsed;\n\t        },\n\t\n\t        /** Modify an error message to be fancy and wear a monocle. */\n\t        _bePolite: function _bePolite(msg) {\n\t            msg = msg || _l('An error occurred while getting updates from the server');\n\t            return msg + '. ' + _l('Please contact a Galaxy administrator if the problem persists') + '.';\n\t        },\n\t\n\t        // ........................................................................ (error) messages\n\t        /** Display a message in the top of the panel.\n\t         *  @param {String} type    type of message ('done', 'error', 'warning')\n\t         *  @param {String} msg     the message to display\n\t         *  @param {Object or HTML} modal contents displayed when the user clicks 'details' in the message\n\t         */\n\t        displayMessage: function displayMessage(type, msg, details) {\n\t            //precondition: msgContainer must have been rendered even if there's no model\n\t            var panel = this;\n\t            //this.log( 'displayMessage', type, msg, details );\n\t\n\t            this.scrollToTop();\n\t            var $msgContainer = this.$messages(),\n\t                $msg = $('<div/>').addClass(type + 'message').html(msg);\n\t            //this.log( '  ', $msgContainer );\n\t\n\t            if (!_.isEmpty(details)) {\n\t                var $detailsLink = $('<a href=\"javascript:void(0)\">Details</a>').click(function () {\n\t                    Galaxy.modal.show(panel._messageToModalOptions(type, msg, details));\n\t                    return false;\n\t                });\n\t                $msg.append(' ', $detailsLink);\n\t            }\n\t            return $msgContainer.append($msg);\n\t        },\n\t\n\t        /** convert msg and details into modal options usable by Galaxy.modal */\n\t        _messageToModalOptions: function _messageToModalOptions(type, msg, details) {\n\t            // only error is fleshed out here\n\t            var panel = this,\n\t                options = { title: 'Details' };\n\t            if (_.isObject(details)) {\n\t\n\t                details = _.omit(details, _.functions(details));\n\t                var text = JSON.stringify(details, null, '  '),\n\t                    pre = $('<pre/>').text(text);\n\t                options.body = $('<div/>').append(pre);\n\t            } else {\n\t                options.body = $('<div/>').html(details);\n\t            }\n\t\n\t            options.buttons = {\n\t                'Ok': function Ok() {\n\t                    Galaxy.modal.hide();\n\t                    panel.clearMessages();\n\t                }\n\t                //TODO: if( type === 'error' ){ options.buttons[ 'Report this error' ] = function(){} }\n\t            };\n\t            return options;\n\t        },\n\t\n\t        /** Remove all messages from the panel. */\n\t        clearMessages: function clearMessages(ev) {\n\t            var $target = !_.isUndefined(ev) ? $(ev.currentTarget) : this.$messages().children('[class$=\"message\"]');\n\t            $target.fadeOut(this.fxSpeed, function () {\n\t                $(this).remove();\n\t            });\n\t            return this;\n\t        },\n\t\n\t        // ........................................................................ scrolling\n\t        /** Scrolls the panel to show the content sub-view with the given hid.\n\t         *  @param {Integer} hid    the hid of item to scroll into view\n\t         *  @returns {HistoryView} the panel\n\t         */\n\t        scrollToHid: function scrollToHid(hid) {\n\t            return this.scrollToItem(_.first(this.viewsWhereModel({ hid: hid })));\n\t        },\n\t\n\t        // ........................................................................ misc\n\t        /** Return a string rep of the history */\n\t        toString: function toString() {\n\t            return 'HistoryView(' + (this.model ? this.model.get('name') : '') + ')';\n\t        }\n\t    });\n\t\n\t    //------------------------------------------------------------------------------ TEMPLATES\n\t    HistoryView.prototype.templates = function () {\n\t\n\t        var controlsTemplate = BASE_MVC.wrapTemplate(['<div class=\"controls\">', '<div class=\"title\">', '<div class=\"name\"><%- history.name %></div>', '</div>', '<div class=\"subtitle\"></div>', '<div class=\"history-size\"><%- history.nice_size %></div>', '<div class=\"actions\"></div>', '<div class=\"messages\">', '<% if( history.deleted && history.purged ){ %>', '<div class=\"deleted-msg warningmessagesmall\">', _l('This history has been purged and deleted'), '</div>', '<% } else if( history.deleted ){ %>', '<div class=\"deleted-msg warningmessagesmall\">', _l('This history has been deleted'), '</div>', '<% } else if( history.purged ){ %>', '<div class=\"deleted-msg warningmessagesmall\">', _l('This history has been purged'), '</div>', '<% } %>', '<% if( history.message ){ %>',\n\t        // should already be localized\n\t        '<div class=\"<%= history.message.level || \"info\" %>messagesmall\">', '<%= history.message.text %>', '</div>', '<% } %>', '</div>',\n\t\n\t        // add tags and annotations\n\t        '<div class=\"tags-display\"></div>', '<div class=\"annotation-display\"></div>', '<div class=\"search\">', '<div class=\"search-input\"></div>', '</div>', '<div class=\"list-actions\">', '<div class=\"btn-group\">', '<button class=\"select-all btn btn-default\"', 'data-mode=\"select\">', _l('All'), '</button>', '<button class=\"deselect-all btn btn-default\"', 'data-mode=\"select\">', _l('None'), '</button>', '</div>', '<div class=\"list-action-menu btn-group\">', '</div>', '</div>', '</div>'], 'history');\n\t\n\t        return _.extend(_.clone(_super.prototype.templates), {\n\t            controls: controlsTemplate\n\t        });\n\t    }();\n\t\n\t    //==============================================================================\n\t    return {\n\t        HistoryView: HistoryView\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 114 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(54), __webpack_require__(108), __webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (PopupMenu, historyCopyDialog, BASE_MVC, _l) {\n\t\n\t    'use strict';\n\t\n\t    // ============================================================================\n\t\n\t    var menu = [{\n\t        html: _l('History Lists'),\n\t        header: true\n\t    }, {\n\t        html: _l('Saved Histories'),\n\t        href: 'history/list'\n\t    }, {\n\t        html: _l('Histories Shared with Me'),\n\t        href: 'history/list_shared'\n\t    }, {\n\t        html: _l('History Actions'),\n\t        header: true,\n\t        anon: true\n\t    }, {\n\t        html: _l('Create New'),\n\t        func: function func() {\n\t            if (Galaxy && Galaxy.currHistoryPanel) {\n\t                Galaxy.currHistoryPanel.createNewHistory();\n\t            }\n\t        }\n\t    }, {\n\t        html: _l('Copy History'),\n\t        func: function func() {\n\t            historyCopyDialog(Galaxy.currHistoryPanel.model).done(function () {\n\t                Galaxy.currHistoryPanel.loadCurrentHistory();\n\t            });\n\t        }\n\t    }, {\n\t        html: _l('Share or Publish'),\n\t        href: 'history/sharing'\n\t    }, {\n\t        html: _l('Show Structure'),\n\t        href: 'history/display_structured',\n\t        anon: true\n\t    }, {\n\t        html: _l('Extract Workflow'),\n\t        href: 'workflow/build_from_current_history'\n\t    }, {\n\t        html: _l('Delete'),\n\t        confirm: _l('Really delete the current history?'),\n\t        href: 'history/delete_current'\n\t    }, {\n\t        html: _l('Delete Permanently'),\n\t        confirm: _l('Really delete the current history permanently? This cannot be undone.'),\n\t        href: 'history/delete_current?purge=True',\n\t        purge: true,\n\t        anon: true\n\t    }, {\n\t        html: _l('Dataset Actions'),\n\t        header: true,\n\t        anon: true\n\t    }, {\n\t        html: _l('Copy Datasets'),\n\t        href: 'dataset/copy_datasets'\n\t    }, {\n\t        html: _l('Dataset Security'),\n\t        href: 'root/history_set_default_permissions'\n\t    }, {\n\t        html: _l('Resume Paused Jobs'),\n\t        href: 'history/resume_paused_jobs?current=True',\n\t        anon: true\n\t    }, {\n\t        html: _l('Collapse Expanded Datasets'),\n\t        func: function func() {\n\t            if (Galaxy && Galaxy.currHistoryPanel) {\n\t                Galaxy.currHistoryPanel.collapseAll();\n\t            }\n\t        }\n\t    }, {\n\t        html: _l('Unhide Hidden Datasets'),\n\t        anon: true,\n\t        func: function func() {\n\t            if (Galaxy && Galaxy.currHistoryPanel && confirm(_l('Really unhide all hidden datasets?'))) {\n\t                var filtered = Galaxy.currHistoryPanel.model.contents.hidden();\n\t                //TODO: batch\n\t                filtered.ajaxQueue(Backbone.Model.prototype.save, { visible: true }).done(function () {\n\t                    Galaxy.currHistoryPanel.renderItems();\n\t                }).fail(function () {\n\t                    alert('There was an error unhiding the datasets');\n\t                    console.error(arguments);\n\t                });\n\t            }\n\t        }\n\t    }, {\n\t        html: _l('Delete Hidden Datasets'),\n\t        anon: true,\n\t        func: function func() {\n\t            if (Galaxy && Galaxy.currHistoryPanel && confirm(_l('Really delete all hidden datasets?'))) {\n\t                var filtered = Galaxy.currHistoryPanel.model.contents.hidden();\n\t                //TODO: batch\n\t                // both delete *and* unhide them\n\t                filtered.ajaxQueue(Backbone.Model.prototype.save, { deleted: true, visible: true }).done(function () {\n\t                    Galaxy.currHistoryPanel.renderItems();\n\t                }).fail(function () {\n\t                    alert('There was an error deleting the datasets');\n\t                    console.error(arguments);\n\t                });\n\t            }\n\t        }\n\t    }, {\n\t        html: _l('Purge Deleted Datasets'),\n\t        confirm: _l('Really delete all deleted datasets permanently? This cannot be undone.'),\n\t        href: 'history/purge_deleted_datasets',\n\t        purge: true,\n\t        anon: true\n\t    }, {\n\t        html: _l('Downloads'),\n\t        header: true\n\t    }, {\n\t        html: _l('Export Tool Citations'),\n\t        href: 'history/citations',\n\t        anon: true\n\t    }, {\n\t        html: _l('Export History to File'),\n\t        href: 'history/export_archive?preview=True',\n\t        anon: true\n\t    }, {\n\t        html: _l('Other Actions'),\n\t        header: true\n\t    }, {\n\t        html: _l('Import from File'),\n\t        href: 'history/import_archive'\n\t    }];\n\t\n\t    function buildMenu(isAnon, purgeAllowed, urlRoot) {\n\t        return _.clone(menu).filter(function (menuOption) {\n\t            if (isAnon && !menuOption.anon) {\n\t                return false;\n\t            }\n\t            if (!purgeAllowed && menuOption.purge) {\n\t                return false;\n\t            }\n\t\n\t            //TODO:?? hard-coded galaxy_main\n\t            if (menuOption.href) {\n\t                menuOption.href = urlRoot + menuOption.href;\n\t                menuOption.target = 'galaxy_main';\n\t            }\n\t\n\t            if (menuOption.confirm) {\n\t                menuOption.func = function () {\n\t                    if (confirm(menuOption.confirm)) {\n\t                        galaxy_main.location = menuOption.href;\n\t                    }\n\t                };\n\t            }\n\t            return true;\n\t        });\n\t    }\n\t\n\t    var create = function create($button, options) {\n\t        options = options || {};\n\t        var isAnon = options.anonymous === undefined ? true : options.anonymous,\n\t            purgeAllowed = options.purgeAllowed || false,\n\t            menu = buildMenu(isAnon, purgeAllowed, Galaxy.root);\n\t        //console.debug( 'menu:', menu );\n\t        return new PopupMenu($button, menu);\n\t    };\n\t\n\t    // ============================================================================\n\t    return create;\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2)))\n\n/***/ },\n/* 115 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {'use strict';\n\t\n\t// dependencies\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils) {\n\t\n\t    // return\n\t    var View = Backbone.View.extend({\n\t        // defaults options\n\t        optionsDefault: {\n\t            title_new: '',\n\t            operations: null,\n\t            onnew: null,\n\t            max: null,\n\t            onchange: null\n\t        },\n\t\n\t        // initialize\n\t        initialize: function initialize(options) {\n\t            // configure\n\t            this.visible = false;\n\t            this.$nav = null;\n\t            this.$content = null;\n\t            this.first_tab = null;\n\t            this.current_id = null;\n\t\n\t            // configure options\n\t            this.options = Utils.merge(options, this.optionsDefault);\n\t\n\t            // create tabs\n\t            var $tabs = $(this._template(this.options));\n\t\n\t            // link elements\n\t            this.$nav = $tabs.find('.tab-navigation');\n\t            this.$content = $tabs.find('.tab-content');\n\t\n\t            // create new element\n\t            this.setElement($tabs);\n\t\n\t            // clear list\n\t            this.list = {};\n\t\n\t            // link this\n\t            var self = this;\n\t\n\t            // append operations\n\t            if (this.options.operations) {\n\t                $.each(this.options.operations, function (name, item) {\n\t                    item.$el.prop('id', name);\n\t                    self.$nav.find('.operations').append(item.$el);\n\t                });\n\t            }\n\t\n\t            // add built-in add-new-tab tab\n\t            if (this.options.onnew) {\n\t                // create tab object\n\t                var $tab_new = $(this._template_tab_new(this.options));\n\t\n\t                // append to navbar\n\t                this.$nav.append($tab_new);\n\t\n\t                // add tooltip\n\t                $tab_new.tooltip({ title: 'Add a new tab', placement: 'bottom', container: self.$el });\n\t\n\t                // link click event\n\t                $tab_new.on('click', function (e) {\n\t                    $tab_new.tooltip('hide');\n\t                    self.options.onnew();\n\t                });\n\t            }\n\t        },\n\t\n\t        // size\n\t        size: function size() {\n\t            return _.size(this.list);\n\t        },\n\t\n\t        // front\n\t        current: function current() {\n\t            return this.$el.find('.tab-pane.active').attr('id');\n\t        },\n\t\n\t        // append\n\t        add: function add(options) {\n\t            // self\n\t            var self = this;\n\t\n\t            // get tab id\n\t            var id = options.id;\n\t\n\t            // create tab object\n\t            var $tab_title = $(this._template_tab(options));\n\t            var $tab_content = $(this._template_tab_content(options));\n\t\n\t            // add to list\n\t            this.list[id] = options.ondel ? true : false;\n\t\n\t            // add a new tab either before the add-new-tab tab or behind the last tab\n\t            if (this.options.onnew) {\n\t                this.$nav.find('#new-tab').before($tab_title);\n\t            } else {\n\t                this.$nav.append($tab_title);\n\t            }\n\t\n\t            // add content\n\t            $tab_content.append(options.$el);\n\t            this.$content.append($tab_content);\n\t\n\t            // activate this tab if this is the first tab\n\t            if (this.size() == 1) {\n\t                $tab_title.addClass('active');\n\t                $tab_content.addClass('active');\n\t                this.first_tab = id;\n\t            }\n\t\n\t            // hide add tab\n\t            if (this.options.max && this.size() >= this.options.max) {\n\t                this.$el.find('#new-tab').hide();\n\t            }\n\t\n\t            // add click event to remove tab\n\t            if (options.ondel) {\n\t                var $del_icon = $tab_title.find('#delete');\n\t                $del_icon.tooltip({ title: 'Delete this tab', placement: 'bottom', container: self.$el });\n\t                $del_icon.on('click', function () {\n\t                    $del_icon.tooltip('destroy');\n\t                    self.$el.find('.tooltip').remove();\n\t                    options.ondel();\n\t                    return false;\n\t                });\n\t            }\n\t\n\t            // add custom click event handler\n\t            $tab_title.on('click', function (e) {\n\t                // prevent default\n\t                e.preventDefault();\n\t\n\t                // click\n\t                if (options.onclick) {\n\t                    options.onclick();\n\t                } else {\n\t                    self.show(id);\n\t                }\n\t            });\n\t\n\t            // initialize current id\n\t            if (!this.current_id) {\n\t                this.current_id = id;\n\t            }\n\t        },\n\t\n\t        // delete tab\n\t        del: function del(id) {\n\t            // delete tab from dom\n\t            this.$el.find('#tab-' + id).remove();\n\t            this.$el.find('#' + id).remove();\n\t\n\t            // check if first tab has been deleted\n\t            if (this.first_tab == id) {\n\t                this.first_tab = null;\n\t            }\n\t\n\t            // show first tab\n\t            if (this.first_tab != null) {\n\t                this.show(this.first_tab);\n\t            }\n\t\n\t            // delete from list\n\t            if (this.list[id]) {\n\t                delete this.list[id];\n\t            }\n\t\n\t            // show add tab\n\t            if (this.size() < this.options.max) {\n\t                this.$el.find('#new-tab').show();\n\t            }\n\t        },\n\t\n\t        // delete tab\n\t        delRemovable: function delRemovable() {\n\t            for (var id in this.list) {\n\t                this.del(id);\n\t            }\n\t        },\n\t\n\t        // show\n\t        show: function show(id) {\n\t            // show tab view\n\t            this.$el.fadeIn('fast');\n\t            this.visible = true;\n\t\n\t            // show selected tab\n\t            if (id) {\n\t                // reassign active class\n\t                this.$el.find('#tab-' + this.current_id).removeClass('active');\n\t                this.$el.find('#' + this.current_id).removeClass('active');\n\t                this.$el.find('#tab-' + id).addClass('active');\n\t                this.$el.find('#' + id).addClass('active');\n\t\n\t                // update current id\n\t                this.current_id = id;\n\t            }\n\t\n\t            // change\n\t            if (this.options.onchange) {\n\t                this.options.onchange(id);\n\t            }\n\t        },\n\t\n\t        // hide\n\t        hide: function hide() {\n\t            this.$el.fadeOut('fast');\n\t            this.visible = false;\n\t        },\n\t\n\t        // hide operation\n\t        hideOperation: function hideOperation(id) {\n\t            this.$nav.find('#' + id).hide();\n\t        },\n\t\n\t        // show operation\n\t        showOperation: function showOperation(id) {\n\t            this.$nav.find('#' + id).show();\n\t        },\n\t\n\t        // set operation\n\t        setOperation: function setOperation(id, callback) {\n\t            var $el = this.$nav.find('#' + id);\n\t            $el.off('click');\n\t            $el.on('click', callback);\n\t        },\n\t\n\t        // title\n\t        title: function title(id, new_title) {\n\t            var $el = this.$el.find('#tab-title-text-' + id);\n\t            if (new_title) {\n\t                $el.html(new_title);\n\t            }\n\t            return $el.html();\n\t        },\n\t\n\t        // retitle\n\t        retitle: function retitle(new_title) {\n\t            var index = 0;\n\t            for (var id in this.list) {\n\t                this.title(id, ++index + ': ' + new_title);\n\t            }\n\t        },\n\t\n\t        // fill template\n\t        _template: function _template(options) {\n\t            return '<div class=\"ui-tabs tabbable tabs-left\">' + '<ul id=\"tab-navigation\" class=\"tab-navigation nav nav-tabs\">' + '<div class=\"operations\" style=\"float: right; margin-bottom: 4px;\"></div>' + '</ul>' + '<div id=\"tab-content\" class=\"tab-content\"/>' + '</div>';\n\t        },\n\t\n\t        // fill template tab\n\t        _template_tab_new: function _template_tab_new(options) {\n\t            return '<li id=\"new-tab\">' + '<a href=\"javascript:void(0);\">' + '<i class=\"ui-tabs-add fa fa-plus-circle\"/>' + options.title_new + '</a>' + '</li>';\n\t        },\n\t\n\t        // fill template tab\n\t        _template_tab: function _template_tab(options) {\n\t            var tmpl = '<li id=\"tab-' + options.id + '\" class=\"tab-element\">' + '<a id=\"tab-title-link-' + options.id + '\" title=\"\" href=\"#' + options.id + '\" data-original-title=\"\">' + '<span id=\"tab-title-text-' + options.id + '\" class=\"tab-title-text\">' + options.title + '</span>';\n\t\n\t            if (options.ondel) {\n\t                tmpl += '<i id=\"delete\" class=\"ui-tabs-delete fa fa-minus-circle\"/>';\n\t            }\n\t\n\t            tmpl += '</a>' + '</li>';\n\t\n\t            return tmpl;\n\t        },\n\t\n\t        // fill template tab content\n\t        _template_tab_content: function _template_tab_content(options) {\n\t            return '<div id=\"' + options.id + '\" class=\"tab-pane\"/>';\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n/* 116 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $) {'use strict';\n\t\n\t// dependencies\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(86), __webpack_require__(85), __webpack_require__(27), __webpack_require__(7), __webpack_require__(28), __webpack_require__(91)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, UploadSettings, UploadFtp, Popover, Ui, Select) {\n\t\n\t    // renders the composite upload row view\n\t    return Backbone.View.extend({\n\t        // states\n\t        status_classes: {\n\t            init: 'upload-mode fa fa-exclamation text-primary',\n\t            ready: 'upload-mode fa fa-check text-success',\n\t            running: 'upload-mode fa fa-spinner fa-spin',\n\t            success: 'upload-mode fa fa-check',\n\t            error: 'upload-mode fa fa-exclamation-triangle'\n\t        },\n\t\n\t        // initialize\n\t        initialize: function initialize(app, options) {\n\t            // link app\n\t            this.app = app;\n\t\n\t            // link this\n\t            var self = this;\n\t\n\t            // create model\n\t            this.model = options.model;\n\t\n\t            // add upload row\n\t            this.setElement(this._template(options.model));\n\t\n\t            // build upload functions\n\t            this.uploadinput = this.$el.uploadinput({\n\t                ondragover: function ondragover() {\n\t                    if (self.model.get('enabled')) {\n\t                        self.$el.addClass('warning');\n\t                    }\n\t                },\n\t                ondragleave: function ondragleave() {\n\t                    self.$el.removeClass('warning');\n\t                },\n\t                onchange: function onchange(files) {\n\t                    if (self.model.get('status') != 'running' && files && files.length > 0) {\n\t                        self.model.reset({\n\t                            'file_data': files[0],\n\t                            'file_name': files[0].name,\n\t                            'file_size': files[0].size,\n\t                            'file_mode': files[0].mode || 'local'\n\t                        });\n\t                        self._refreshReady();\n\t                    }\n\t                }\n\t            });\n\t\n\t            // source selection popup\n\t            this.button_menu = new Ui.ButtonMenu({\n\t                icon: 'fa-caret-down',\n\t                title: 'Select',\n\t                pull: 'left'\n\t            });\n\t            this.$('#source').append(this.button_menu.$el);\n\t            this.button_menu.addMenu({\n\t                icon: 'fa-laptop',\n\t                title: 'Choose local file',\n\t                onclick: function onclick() {\n\t                    self.uploadinput.dialog();\n\t                }\n\t            });\n\t            if (this.app.ftp_upload_site) {\n\t                this.button_menu.addMenu({\n\t                    icon: 'fa-folder-open-o',\n\t                    title: 'Choose FTP file',\n\t                    onclick: function onclick() {\n\t                        self._showFtp();\n\t                    }\n\t                });\n\t            }\n\t            this.button_menu.addMenu({\n\t                icon: 'fa-edit',\n\t                title: 'Paste/Fetch data',\n\t                onclick: function onclick() {\n\t                    self.model.reset({\n\t                        'file_mode': 'new',\n\t                        'file_name': 'New File'\n\t                    });\n\t                }\n\t            });\n\t\n\t            // add ftp file viewer\n\t            this.ftp = new Popover.View({\n\t                title: 'Choose FTP file:',\n\t                container: this.$('#source').find('.ui-button-menu'),\n\t                placement: 'right'\n\t            });\n\t\n\t            // append popup to settings icon\n\t            this.settings = new Popover.View({\n\t                title: 'Upload configuration',\n\t                container: this.$('#settings'),\n\t                placement: 'bottom'\n\t            });\n\t\n\t            //\n\t            // ui events\n\t            //\n\t\n\t            // handle text editing event\n\t            this.$('#text-content').on('change input', function (e) {\n\t                self.model.set('url_paste', $(e.target).val());\n\t                self.model.set('file_size', $(e.target).val().length);\n\t                self._refreshReady();\n\t            });\n\t\n\t            // handle settings popover\n\t            this.$('#settings').on('click', function (e) {\n\t                self._showSettings();\n\t            }).on('mousedown', function (e) {\n\t                e.preventDefault();\n\t            });\n\t\n\t            //\n\t            // model events\n\t            //\n\t            this.model.on('change:percentage', function () {\n\t                self._refreshPercentage();\n\t            });\n\t            this.model.on('change:status', function () {\n\t                self._refreshStatus();\n\t            });\n\t            this.model.on('change:info', function () {\n\t                self._refreshInfo();\n\t            });\n\t            this.model.on('change:file_name', function () {\n\t                self._refreshFileName();\n\t            });\n\t            this.model.on('change:file_mode', function () {\n\t                self._refreshMode();\n\t            });\n\t            this.model.on('change:file_size', function () {\n\t                self._refreshFileSize();\n\t            });\n\t            this.model.on('remove', function () {\n\t                self.remove();\n\t            });\n\t            this.app.collection.on('reset', function () {\n\t                self.remove();\n\t            });\n\t        },\n\t\n\t        // render\n\t        render: function render() {\n\t            this.$('#file_name').html(this.model.get('file_name') || '-');\n\t            this.$('#file_desc').html(this.model.get('file_desc') || 'Unavailable');\n\t            this.$('#file_size').html(Utils.bytesToString(this.model.get('file_size')));\n\t            this.$('#status').removeClass().addClass(this.status_classes.init);\n\t        },\n\t\n\t        // remove\n\t        remove: function remove() {\n\t            // call the base class remove method\n\t            Backbone.View.prototype.remove.apply(this);\n\t        },\n\t\n\t        //\n\t        // handle model events\n\t        //\n\t\n\t        // refresh ready or not states\n\t        _refreshReady: function _refreshReady() {\n\t            this.app.collection.each(function (model) {\n\t                model.set('status', model.get('file_size') > 0 && 'ready' || 'init');\n\t            });\n\t        },\n\t\n\t        // refresh mode and e.g. show/hide textarea field\n\t        _refreshMode: function _refreshMode() {\n\t            var file_mode = this.model.get('file_mode');\n\t            if (file_mode == 'new') {\n\t                this.height = this.$el.height();\n\t                this.$('#text').css({\n\t                    'width': this.$el.width() - 16 + 'px',\n\t                    'top': this.$el.height() - 8 + 'px'\n\t                }).show();\n\t                this.$el.height(this.$el.height() - 8 + this.$('#text').height() + 16);\n\t                this.$('#text-content').val('').trigger('keyup');\n\t            } else {\n\t                this.$el.height(this.height);\n\t                this.$('#text').hide();\n\t            }\n\t        },\n\t\n\t        // information\n\t        _refreshInfo: function _refreshInfo() {\n\t            var info = this.model.get('info');\n\t            if (info) {\n\t                this.$('#info-text').html('<strong>Failed: </strong>' + info).show();\n\t            } else {\n\t                this.$('#info-text').hide();\n\t            }\n\t        },\n\t\n\t        // percentage\n\t        _refreshPercentage: function _refreshPercentage() {\n\t            var percentage = parseInt(this.model.get('percentage'));\n\t            if (percentage != 0) {\n\t                this.$('.progress-bar').css({ width: percentage + '%' });\n\t            } else {\n\t                this.$('.progress-bar').addClass('no-transition');\n\t                this.$('.progress-bar').css({ width: '0%' });\n\t                this.$('.progress-bar')[0].offsetHeight;\n\t                this.$('.progress-bar').removeClass('no-transition');\n\t            }\n\t            if (percentage != 100) {\n\t                this.$('#percentage').html(percentage + '%');\n\t            } else {\n\t                this.$('#percentage').html('Adding to history...');\n\t            }\n\t        },\n\t\n\t        // status\n\t        _refreshStatus: function _refreshStatus() {\n\t            // identify new status\n\t            var status = this.model.get('status');\n\t\n\t            // identify symbol and reset classes\n\t            this.$('#status').removeClass().addClass(this.status_classes[status]);\n\t\n\t            // enable/disable model flag\n\t            this.model.set('enabled', status != 'running');\n\t\n\t            // enable/disable row fields\n\t            this.$('#text-content').attr('disabled', !this.model.get('enabled'));\n\t\n\t            // remove status classes\n\t            this.$el.removeClass('success danger warning');\n\t\n\t            // set status classes\n\t            if (status == 'running' || status == 'ready') {\n\t                this.model.set('percentage', 0);\n\t            }\n\t            if (status == 'running') {\n\t                this.$('#source').find('.button').addClass('disabled');\n\t            } else {\n\t                this.$('#source').find('.button').removeClass('disabled');\n\t            }\n\t            if (status == 'success') {\n\t                this.$el.addClass('success');\n\t                this.model.set('percentage', 100);\n\t                this.$('#percentage').html('100%');\n\t            }\n\t            if (status == 'error') {\n\t                this.$el.addClass('danger');\n\t                this.model.set('percentage', 0);\n\t                this.$('#info-progress').hide();\n\t                this.$('#info-text').show();\n\t            } else {\n\t                this.$('#info-progress').show();\n\t                this.$('#info-text').hide();\n\t            }\n\t        },\n\t\n\t        // file name\n\t        _refreshFileName: function _refreshFileName() {\n\t            this.$('#file_name').html(this.model.get('file_name') || '-');\n\t        },\n\t\n\t        // file size\n\t        _refreshFileSize: function _refreshFileSize() {\n\t            this.$('#file_size').html(Utils.bytesToString(this.model.get('file_size')));\n\t        },\n\t\n\t        // show/hide ftp popup\n\t        _showFtp: function _showFtp() {\n\t            if (!this.ftp.visible) {\n\t                this.ftp.empty();\n\t                var self = this;\n\t                this.ftp.append(new UploadFtp({\n\t                    ftp_upload_site: this.app.ftp_upload_site,\n\t                    onchange: function onchange(ftp_file) {\n\t                        self.ftp.hide();\n\t                        if (self.model.get('status') != 'running' && ftp_file) {\n\t                            self.model.reset({\n\t                                'file_mode': 'ftp',\n\t                                'file_name': ftp_file.path,\n\t                                'file_size': ftp_file.size,\n\t                                'file_path': ftp_file.path\n\t                            });\n\t                            self._refreshReady();\n\t                        }\n\t                    }\n\t                }).$el);\n\t                this.ftp.show();\n\t            } else {\n\t                this.ftp.hide();\n\t            }\n\t        },\n\t\n\t        // show/hide settings popup\n\t        _showSettings: function _showSettings() {\n\t            if (!this.settings.visible) {\n\t                this.settings.empty();\n\t                this.settings.append(new UploadSettings(this).$el);\n\t                this.settings.show();\n\t            } else {\n\t                this.settings.hide();\n\t            }\n\t        },\n\t\n\t        // template\n\t        _template: function _template(options) {\n\t            return '<tr id=\"upload-row-' + options.id + '\" class=\"upload-row\">' + '<td>' + '<div id=\"source\"/>' + '<div class=\"upload-text-column\">' + '<div id=\"text\" class=\"text\">' + '<div class=\"text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div>' + '<textarea id=\"text-content\" class=\"text-content form-control\"/>' + '</div>' + '</div>' + '</td>' + '<td>' + '<div id=\"status\"/>' + '</td>' + '<td>' + '<div id=\"file_desc\" class=\"upload-title\"/>' + '</td>' + '<td>' + '<div id=\"file_name\" class=\"upload-title\"/>' + '</td>' + '<td>' + '<div id=\"file_size\" class=\"upload-size\"/>' + '</td>' + '<td><div id=\"settings\" class=\"upload-icon-button fa fa-gear\"/></td>' + '<td>' + '<div id=\"info\" class=\"upload-info\">' + '<div id=\"info-text\"/>' + '<div id=\"info-progress\" class=\"progress\">' + '<div class=\"progress-bar progress-bar-success\"/>' + '<div id=\"percentage\" class=\"percentage\">0%</div>' + '</div>' + '</div>' + '</td>' + '</tr>';\n\t        }\n\t    });\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1)))\n\n/***/ },\n/* 117 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {'use strict';\n\t\n\t/** Renders contents of the composite uploader */\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(61), __webpack_require__(116), __webpack_require__(27), __webpack_require__(28), __webpack_require__(7)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, UploadModel, UploadRow, Popover, Select, Ui) {\n\t\n\t    return Backbone.View.extend({\n\t        // extension selector\n\t        select_extension: null,\n\t\n\t        // genome selector\n\t        select_genome: null,\n\t\n\t        // collection\n\t        collection: new UploadModel.Collection(),\n\t\n\t        // initialize\n\t        initialize: function initialize(app) {\n\t            // link app\n\t            this.app = app;\n\t            this.options = app.options;\n\t            this.list_extensions = app.list_extensions;\n\t            this.list_genomes = app.list_genomes;\n\t            this.ftp_upload_site = app.currentFtp();\n\t\n\t            // link this\n\t            var self = this;\n\t\n\t            // set element\n\t            this.setElement(this._template());\n\t\n\t            // create button section\n\t            this.btnStart = new Ui.Button({ title: 'Start', onclick: function onclick() {\n\t                    self._eventStart();\n\t                } });\n\t            this.btnClose = new Ui.Button({ title: 'Close', onclick: function onclick() {\n\t                    self.app.modal.hide();\n\t                } });\n\t\n\t            // append buttons to dom\n\t            var buttons = [this.btnStart, this.btnClose];\n\t            for (var i in buttons) {\n\t                this.$('#upload-buttons').prepend(buttons[i].$el);\n\t            }\n\t\n\t            // select extension\n\t            this.select_extension = new Select.View({\n\t                css: 'footer-selection',\n\t                container: this.$('#footer-extension'),\n\t                data: _.filter(this.list_extensions, function (ext) {\n\t                    return ext.composite_files;\n\t                }),\n\t                onchange: function onchange(extension) {\n\t                    self.collection.reset();\n\t                    var details = _.findWhere(self.list_extensions, { id: extension });\n\t                    if (details && details.composite_files) {\n\t                        for (var i in details.composite_files) {\n\t                            var item = details.composite_files[i];\n\t                            self.collection.add({\n\t                                id: self.collection.size(),\n\t                                file_desc: item['description'] || item['name']\n\t                            });\n\t                        }\n\t                    }\n\t                }\n\t            });\n\t\n\t            // handle extension info popover\n\t            this.$('#footer-extension-info').on('click', function (e) {\n\t                self._showExtensionInfo({\n\t                    $el: $(e.target),\n\t                    title: self.select_extension.text(),\n\t                    extension: self.select_extension.value(),\n\t                    placement: 'top'\n\t                });\n\t            }).on('mousedown', function (e) {\n\t                e.preventDefault();\n\t            });\n\t\n\t            // genome extension\n\t            this.select_genome = new Select.View({\n\t                css: 'footer-selection',\n\t                container: this.$('#footer-genome'),\n\t                data: this.list_genomes,\n\t                value: this.options.default_genome\n\t            });\n\t\n\t            // listener for collection triggers on change in composite datatype\n\t            this.collection.on('add', function (model) {\n\t                self._eventAnnounce(model);\n\t            });\n\t            this.collection.on('change add', function () {\n\t                self._updateScreen();\n\t            }).trigger('change');\n\t\n\t            // trigger initial onchange event\n\t            this.select_extension.options.onchange(this.select_extension.value());\n\t        },\n\t\n\t        //\n\t        // upload events / process pipeline\n\t        //\n\t\n\t        // builds the basic ui with placeholder rows for each composite data type file\n\t        _eventAnnounce: function _eventAnnounce(model) {\n\t            // create view/model\n\t            var upload_row = new UploadRow(this, { model: model });\n\t\n\t            // add upload row element to table\n\t            this.$('#upload-table > tbody:first').append(upload_row.$el);\n\t\n\t            // render\n\t            upload_row.render();\n\t\n\t            // table visibility\n\t            if (this.collection.length > 0) {\n\t                this.$('#upload-table').show();\n\t            } else {\n\t                this.$('#upload-table').hide();\n\t            }\n\t        },\n\t\n\t        // start upload process\n\t        _eventStart: function _eventStart() {\n\t            var self = this;\n\t            this.collection.each(function (model) {\n\t                model.set('genome', self.select_genome.value());\n\t                model.set('extension', self.select_extension.value());\n\t            });\n\t            $.uploadpost({\n\t                url: this.app.options.nginx_upload_path,\n\t                data: this.app.toData(this.collection.filter()),\n\t                success: function success(message) {\n\t                    self._eventSuccess(message);\n\t                },\n\t                error: function error(message) {\n\t                    self._eventError(message);\n\t                },\n\t                progress: function progress(percentage) {\n\t                    self._eventProgress(percentage);\n\t                }\n\t            });\n\t        },\n\t\n\t        // progress\n\t        _eventProgress: function _eventProgress(percentage) {\n\t            this.collection.each(function (it) {\n\t                it.set('percentage', percentage);\n\t            });\n\t        },\n\t\n\t        // success\n\t        _eventSuccess: function _eventSuccess(message) {\n\t            this.collection.each(function (it) {\n\t                it.set('status', 'success');\n\t            });\n\t            Galaxy.currHistoryPanel.refreshContents();\n\t        },\n\t\n\t        // error\n\t        _eventError: function _eventError(message) {\n\t            this.collection.each(function (it) {\n\t                it.set('status', 'error');\n\t                it.set('info', message);\n\t            });\n\t        },\n\t\n\t        // display extension info popup\n\t        _showExtensionInfo: function _showExtensionInfo(options) {\n\t            // initialize\n\t            var self = this;\n\t            var $el = options.$el;\n\t            var extension = options.extension;\n\t            var title = options.title;\n\t            var description = _.findWhere(this.list_extensions, { id: extension });\n\t\n\t            // create popup\n\t            this.extension_popup && this.extension_popup.remove();\n\t            this.extension_popup = new Popover.View({\n\t                placement: options.placement || 'bottom',\n\t                container: $el,\n\t                destroy: true\n\t            });\n\t\n\t            // add content and show popup\n\t            this.extension_popup.title(title);\n\t            this.extension_popup.empty();\n\t            this.extension_popup.append(this._templateDescription(description));\n\t            this.extension_popup.show();\n\t        },\n\t\n\t        // set screen\n\t        _updateScreen: function _updateScreen() {\n\t            // show start button if components have been selected\n\t            var model = this.collection.first();\n\t            if (model && model.get('status') == 'running') {\n\t                this.select_genome.disable();\n\t                this.select_extension.disable();\n\t            } else {\n\t                this.select_genome.enable();\n\t                this.select_extension.enable();\n\t            }\n\t            if (this.collection.where({ status: 'ready' }).length == this.collection.length && this.collection.length > 0) {\n\t                this.btnStart.enable();\n\t                this.btnStart.$el.addClass('btn-primary');\n\t            } else {\n\t                this.btnStart.disable();\n\t                this.btnStart.$el.removeClass('btn-primary');\n\t            }\n\t\n\t            // table visibility\n\t            if (this.collection.length > 0) {\n\t                this.$('#upload-table').show();\n\t            } else {\n\t                this.$('#upload-table').hide();\n\t            }\n\t        },\n\t\n\t        // template for extensions description\n\t        _templateDescription: function _templateDescription(options) {\n\t            if (options.description) {\n\t                var tmpl = options.description;\n\t                if (options.description_url) {\n\t                    tmpl += '&nbsp;(<a href=\"' + options.description_url + '\" target=\"_blank\">read more</a>)';\n\t                }\n\t                return tmpl;\n\t            } else {\n\t                return 'There is no description available for this file extension.';\n\t            }\n\t        },\n\t\n\t        // load html template\n\t        _template: function _template() {\n\t            return '<div class=\"upload-view-composite\">' + '<div id=\"upload-footer\" class=\"upload-footer\">' + '<span class=\"footer-title\">Composite Type:</span>' + '<span id=\"footer-extension\"/>' + '<span id=\"footer-extension-info\" class=\"upload-icon-button fa fa-search\"/> ' + '<span class=\"footer-title\">Genome/Build:</span>' + '<span id=\"footer-genome\"/>' + '</div>' + '<div id=\"upload-box\" class=\"upload-box\">' + '<table id=\"upload-table\" class=\"ui-table-striped\" style=\"display: none;\">' + '<thead>' + '<tr>' + '<th/>' + '<th/>' + '<th>Description</th>' + '<th>Name</th>' + '<th>Size</th>' + '<th>Settings</th>' + '<th>Status</th>' + '</tr>' + '</thead>' + '<tbody></tbody>' + '</table>' + '</div>' + '<div id=\"upload-buttons\" class=\"upload-buttons\"/>' + '</div>';\n\t        }\n\t    });\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 118 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $) {'use strict';\n\t\n\t// dependencies\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(61), __webpack_require__(86), __webpack_require__(27), __webpack_require__(28)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, UploadModel, UploadSettings, Popover, Select) {\n\t\n\t    // row view\n\t    return Backbone.View.extend({\n\t        // states\n\t        status_classes: {\n\t            init: 'upload-icon-button fa fa-trash-o',\n\t            queued: 'upload-icon fa fa-spinner fa-spin',\n\t            running: 'upload-icon fa fa-spinner fa-spin',\n\t            success: 'upload-icon-button fa fa-check',\n\t            error: 'upload-icon-button fa fa-exclamation-triangle'\n\t        },\n\t\n\t        // handle for settings popover\n\t        settings: null,\n\t\n\t        // genome selector\n\t        select_genome: null,\n\t\n\t        // extension selector\n\t        select_extension: null,\n\t\n\t        // render\n\t        initialize: function initialize(app, options) {\n\t            // link app\n\t            this.app = app;\n\t\n\t            // link this\n\t            var self = this;\n\t\n\t            // create model\n\t            this.model = options.model;\n\t\n\t            // add upload row\n\t            this.setElement(this._template(options.model));\n\t\n\t            // append popup to settings icon\n\t            this.settings = new Popover.View({\n\t                title: 'Upload configuration',\n\t                container: this.$('#settings'),\n\t                placement: 'bottom'\n\t            });\n\t\n\t            // initialize default genome through default select field\n\t            var default_genome = this.app.select_genome.value();\n\t\n\t            // select genomes\n\t            this.select_genome = new Select.View({\n\t                css: 'upload-genome',\n\t                onchange: function onchange(genome) {\n\t                    self.model.set('genome', genome);\n\t                },\n\t                data: self.app.list_genomes,\n\t                container: this.$('#genome'),\n\t                value: default_genome\n\t            });\n\t\n\t            // initialize genome\n\t            this.model.set('genome', default_genome);\n\t\n\t            // initialize default extension through default select field\n\t            var default_extension = this.app.select_extension.value();\n\t\n\t            // select extension\n\t            this.select_extension = new Select.View({\n\t                css: 'upload-extension',\n\t                onchange: function onchange(extension) {\n\t                    self.model.set('extension', extension);\n\t                },\n\t                data: self.app.list_extensions,\n\t                container: this.$('#extension'),\n\t                value: default_extension\n\t            });\n\t\n\t            // initialize extension\n\t            this.model.set('extension', default_extension);\n\t\n\t            //\n\t            // ui events\n\t            //\n\t\n\t            // handle click event\n\t            this.$('#symbol').on('click', function () {\n\t                self._removeRow();\n\t            });\n\t\n\t            // handle extension info popover\n\t            this.$('#extension-info').on('click', function (e) {\n\t                self.app.showExtensionInfo({\n\t                    $el: $(e.target),\n\t                    title: self.select_extension.text(),\n\t                    extension: self.select_extension.value()\n\t                });\n\t            }).on('mousedown', function (e) {\n\t                e.preventDefault();\n\t            });\n\t\n\t            // handle settings popover\n\t            this.$('#settings').on('click', function (e) {\n\t                self._showSettings();\n\t            }).on('mousedown', function (e) {\n\t                e.preventDefault();\n\t            });\n\t\n\t            // handle text editing event\n\t            this.$('#text-content').on('change input', function (e) {\n\t                self.model.set('url_paste', $(e.target).val());\n\t                self.model.set('file_size', $(e.target).val().length);\n\t            });\n\t\n\t            //\n\t            // model events\n\t            //\n\t            this.model.on('change:percentage', function () {\n\t                self._refreshPercentage();\n\t            });\n\t            this.model.on('change:status', function () {\n\t                self._refreshStatus();\n\t            });\n\t            this.model.on('change:info', function () {\n\t                self._refreshInfo();\n\t            });\n\t            this.model.on('change:genome', function () {\n\t                self._refreshGenome();\n\t            });\n\t            this.model.on('change:extension', function () {\n\t                self._refreshExtension();\n\t            });\n\t            this.model.on('change:file_size', function () {\n\t                self._refreshFileSize();\n\t            });\n\t            this.model.on('remove', function () {\n\t                self.remove();\n\t            });\n\t            this.app.collection.on('reset', function () {\n\t                self.remove();\n\t            });\n\t        },\n\t\n\t        // render\n\t        render: function render() {\n\t            // read model\n\t            var file_name = this.model.get('file_name');\n\t            var file_size = this.model.get('file_size');\n\t            var file_mode = this.model.get('file_mode');\n\t\n\t            // update title\n\t            this.$('#title').html(file_name);\n\t\n\t            // update info\n\t            this.$('#size').html(Utils.bytesToString(file_size));\n\t\n\t            // remove mode class\n\t            this.$('#mode').removeClass().addClass('upload-mode').addClass('text-primary');\n\t\n\t            // activate text field if file is new\n\t            if (file_mode == 'new') {\n\t                this.$('#text').css({\n\t                    'width': this.$el.width() - 16 + 'px',\n\t                    'top': this.$el.height() - 8 + 'px'\n\t                }).show();\n\t                this.$el.height(this.$el.height() - 8 + this.$('#text').height() + 16);\n\t                this.$('#mode').addClass('fa fa-edit');\n\t            }\n\t\n\t            // file from local disk\n\t            if (file_mode == 'local') {\n\t                this.$('#mode').addClass('fa fa-laptop');\n\t            }\n\t\n\t            // file from ftp\n\t            if (file_mode == 'ftp') {\n\t                this.$('#mode').addClass('fa fa-folder-open-o');\n\t            }\n\t        },\n\t\n\t        // remove\n\t        remove: function remove() {\n\t            // trigger remove event\n\t            this.select_genome.remove();\n\t            this.select_extension.remove();\n\t\n\t            // call the base class remove method\n\t            Backbone.View.prototype.remove.apply(this);\n\t        },\n\t\n\t        //\n\t        // handle model events\n\t        //\n\t\n\t        // update extension\n\t        _refreshExtension: function _refreshExtension() {\n\t            this.select_extension.value(this.model.get('extension'));\n\t        },\n\t\n\t        // update genome\n\t        _refreshGenome: function _refreshGenome() {\n\t            this.select_genome.value(this.model.get('genome'));\n\t        },\n\t\n\t        // progress\n\t        _refreshInfo: function _refreshInfo() {\n\t            // write error message\n\t            var info = this.model.get('info');\n\t            if (info) {\n\t                this.$('#info').html('<strong>Failed: </strong>' + info).show();\n\t            } else {\n\t                this.$('#info').hide();\n\t            }\n\t        },\n\t\n\t        // progress\n\t        _refreshPercentage: function _refreshPercentage() {\n\t            var percentage = parseInt(this.model.get('percentage'));\n\t            this.$('.progress-bar').css({ width: percentage + '%' });\n\t            if (percentage != 100) this.$('#percentage').html(percentage + '%');else this.$('#percentage').html('Adding to history...');\n\t        },\n\t\n\t        // status\n\t        _refreshStatus: function _refreshStatus() {\n\t            // identify new status\n\t            var status = this.model.get('status');\n\t\n\t            // identify symbol and reset classes\n\t            this.$('#symbol').removeClass().addClass(this.status_classes[status]);\n\t\n\t            // enable/disable model flag\n\t            this.model.set('enabled', status == 'init');\n\t\n\t            // enable/disable row fields\n\t            var enabled = this.model.get('enabled');\n\t            this.$('#text-content').attr('disabled', !enabled);\n\t            if (enabled) {\n\t                this.select_genome.enable();\n\t                this.select_extension.enable();\n\t            } else {\n\t                this.select_genome.disable();\n\t                this.select_extension.disable();\n\t            }\n\t\n\t            // success\n\t            if (status == 'success') {\n\t                this.$el.addClass('success');\n\t                this.$('#percentage').html('100%');\n\t            }\n\t\n\t            // error\n\t            if (status == 'error') {\n\t                this.$el.addClass('danger');\n\t                this.$('.progress').remove();\n\t            }\n\t        },\n\t\n\t        // refresh size\n\t        _refreshFileSize: function _refreshFileSize() {\n\t            var count = this.model.get('file_size');\n\t            this.$('#size').html(Utils.bytesToString(count));\n\t        },\n\t\n\t        //\n\t        // handle ui events\n\t        //\n\t\n\t        // remove row\n\t        _removeRow: function _removeRow() {\n\t            // get current status\n\t            var status = this.model.get('status');\n\t\n\t            // only remove from queue if not in processing line\n\t            if (status == 'init' || status == 'success' || status == 'error') {\n\t                this.app.collection.remove(this.model);\n\t            }\n\t        },\n\t\n\t        // attach file info popup\n\t        _showSettings: function _showSettings() {\n\t            // check if popover is visible\n\t            if (!this.settings.visible) {\n\t                // show popover\n\t                this.settings.empty();\n\t                this.settings.append(new UploadSettings(this).$el);\n\t                this.settings.show();\n\t            } else {\n\t                // hide popover\n\t                this.settings.hide();\n\t            }\n\t        },\n\t\n\t        // template\n\t        _template: function _template(options) {\n\t            return '<tr id=\"upload-row-' + options.id + '\" class=\"upload-row\">' + '<td>' + '<div class=\"upload-text-column\">' + '<div id=\"mode\"/>' + '<div id=\"title\" class=\"upload-title\"/>' + '<div id=\"text\" class=\"text\">' + '<div class=\"text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div>' + '<textarea id=\"text-content\" class=\"text-content form-control\"/>' + '</div>' + '</div>' + '</td>' + '<td>' + '<div id=\"size\" class=\"upload-size\"/>' + '</td>' + '<td>' + '<div id=\"extension\" class=\"upload-extension\" style=\"float: left;\"/>&nbsp;&nbsp' + '<div id=\"extension-info\" class=\"upload-icon-button fa fa-search\"/>' + '</td>' + '<td>' + '<div id=\"genome\" class=\"upload-genome\"/>' + '</td>' + '<td><div id=\"settings\" class=\"upload-settings upload-icon-button fa fa-gear\"/></td>' + '<td>' + '<div id=\"info\" class=\"upload-info\">' + '<div class=\"progress\">' + '<div class=\"progress-bar progress-bar-success\"/>' + '<div id=\"percentage\" class=\"percentage\">0%</div>' + '</div>' + '</div>' + '</td>' + '<td>' + '<div id=\"symbol\" class=\"' + this.status_classes.init + '\"/>' + '</td>' + '</tr>';\n\t        }\n\t\n\t    });\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1)))\n\n/***/ },\n/* 119 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {'use strict';\n\t\n\t/** Renders contents of the default uploader */\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(61), __webpack_require__(118), __webpack_require__(85), __webpack_require__(27), __webpack_require__(28), __webpack_require__(7), __webpack_require__(91)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, UploadModel, UploadRow, UploadFtp, Popover, Select, Ui) {\n\t\n\t    return Backbone.View.extend({\n\t        // extension selector\n\t        select_extension: null,\n\t\n\t        // genome selector\n\t        select_genome: null,\n\t\n\t        // jquery uploadbox plugin\n\t        uploadbox: null,\n\t\n\t        // current upload size in bytes\n\t        upload_size: 0,\n\t\n\t        // contains upload row models\n\t        collection: new UploadModel.Collection(),\n\t\n\t        // ftp file viewer\n\t        ftp: null,\n\t\n\t        // keeps track of the current uploader state\n\t        counter: {\n\t            announce: 0,\n\t            success: 0,\n\t            error: 0,\n\t            running: 0,\n\t            reset: function reset() {\n\t                this.announce = this.success = this.error = this.running = 0;\n\t            }\n\t        },\n\t\n\t        // initialize\n\t        initialize: function initialize(app) {\n\t            // link app\n\t            this.app = app;\n\t            this.options = app.options;\n\t            this.list_extensions = app.list_extensions;\n\t            this.list_genomes = app.list_genomes;\n\t            this.ui_button = app.ui_button;\n\t            this.ftp_upload_site = app.currentFtp();\n\t\n\t            // link this\n\t            var self = this;\n\t\n\t            // set element\n\t            this.setElement(this._template());\n\t\n\t            // create button section\n\t            this.btnLocal = new Ui.Button({ id: 'btn-local', title: 'Choose local file', onclick: function onclick() {\n\t                    self.uploadbox.select();\n\t                }, icon: 'fa fa-laptop' });\n\t            this.btnFtp = new Ui.Button({ id: 'btn-ftp', title: 'Choose FTP file', onclick: function onclick() {\n\t                    self._eventFtp();\n\t                }, icon: 'fa fa-folder-open-o' });\n\t            this.btnCreate = new Ui.Button({ id: 'btn-new', title: 'Paste/Fetch data', onclick: function onclick() {\n\t                    self._eventCreate();\n\t                }, icon: 'fa fa-edit' });\n\t            this.btnStart = new Ui.Button({ id: 'btn-start', title: 'Start', onclick: function onclick() {\n\t                    self._eventStart();\n\t                } });\n\t            this.btnStop = new Ui.Button({ id: 'btn-stop', title: 'Pause', onclick: function onclick() {\n\t                    self._eventStop();\n\t                } });\n\t            this.btnReset = new Ui.Button({ id: 'btn-reset', title: 'Reset', onclick: function onclick() {\n\t                    self._eventReset();\n\t                } });\n\t            this.btnClose = new Ui.Button({ id: 'btn-close', title: 'Close', onclick: function onclick() {\n\t                    self.app.modal.hide();\n\t                } });\n\t\n\t            // append buttons to dom\n\t            var buttons = [this.btnLocal, this.btnFtp, this.btnCreate, this.btnStop, this.btnReset, this.btnStart, this.btnClose];\n\t            for (var i in buttons) {\n\t                this.$('#upload-buttons').prepend(buttons[i].$el);\n\t            }\n\t\n\t            // file upload\n\t            var self = this;\n\t            this.uploadbox = this.$('#upload-box').uploadbox({\n\t                url: this.app.options.nginx_upload_path,\n\t                announce: function announce(index, file) {\n\t                    self._eventAnnounce(index, file);\n\t                },\n\t                initialize: function initialize(index) {\n\t                    return self.app.toData([self.collection.get(index)], self.history_id);\n\t                },\n\t                progress: function progress(index, percentage) {\n\t                    self._eventProgress(index, percentage);\n\t                },\n\t                success: function success(index, message) {\n\t                    self._eventSuccess(index, message);\n\t                },\n\t                error: function error(index, message) {\n\t                    self._eventError(index, message);\n\t                },\n\t                complete: function complete() {\n\t                    self._eventComplete();\n\t                },\n\t                ondragover: function ondragover() {\n\t                    self.$('.upload-box').addClass('highlight');\n\t                },\n\t                ondragleave: function ondragleave() {\n\t                    self.$('.upload-box').removeClass('highlight');\n\t                }\n\t            });\n\t\n\t            // add ftp file viewer\n\t            this.ftp = new Popover.View({\n\t                title: 'FTP files',\n\t                container: this.btnFtp.$el\n\t            });\n\t\n\t            // select extension\n\t            this.select_extension = new Select.View({\n\t                css: 'footer-selection',\n\t                container: this.$('#footer-extension'),\n\t                data: _.filter(this.list_extensions, function (ext) {\n\t                    return !ext.composite_files;\n\t                }),\n\t                value: this.options.default_extension,\n\t                onchange: function onchange(extension) {\n\t                    self.updateExtension(extension);\n\t                }\n\t            });\n\t\n\t            // handle extension info popover\n\t            self.$('#footer-extension-info').on('click', function (e) {\n\t                self.showExtensionInfo({\n\t                    $el: $(e.target),\n\t                    title: self.select_extension.text(),\n\t                    extension: self.select_extension.value(),\n\t                    placement: 'top'\n\t                });\n\t            }).on('mousedown', function (e) {\n\t                e.preventDefault();\n\t            });\n\t\n\t            // genome extension\n\t            this.select_genome = new Select.View({\n\t                css: 'footer-selection',\n\t                container: this.$('#footer-genome'),\n\t                data: this.list_genomes,\n\t                value: this.options.default_genome,\n\t                onchange: function onchange(genome) {\n\t                    self.updateGenome(genome);\n\t                }\n\t            });\n\t\n\t            // events\n\t            this.collection.on('remove', function (model) {\n\t                self._eventRemove(model);\n\t            });\n\t\n\t            // setup info\n\t            this._updateScreen();\n\t        },\n\t\n\t        //\n\t        // events triggered by the upload box plugin\n\t        //\n\t\n\t        // a new file has been dropped/selected through the uploadbox plugin\n\t        _eventAnnounce: function _eventAnnounce(index, file) {\n\t            // update counter\n\t            this.counter.announce++;\n\t\n\t            // create if model has not been created yet\n\t            var new_model = new UploadModel.Model({\n\t                id: index,\n\t                file_name: file.name,\n\t                file_size: file.size,\n\t                file_mode: file.mode || 'local',\n\t                file_path: file.path,\n\t                file_data: file\n\t            });\n\t\n\t            // add model to collection\n\t            this.collection.add(new_model);\n\t\n\t            // create view/model\n\t            var upload_row = new UploadRow(this, { model: new_model });\n\t\n\t            // add upload row element to table\n\t            this.$('#upload-table > tbody:first').append(upload_row.$el);\n\t\n\t            // show on screen info\n\t            this._updateScreen();\n\t\n\t            // render\n\t            upload_row.render();\n\t        },\n\t\n\t        // progress\n\t        _eventProgress: function _eventProgress(index, percentage) {\n\t            // set progress for row\n\t            var it = this.collection.get(index);\n\t            it.set('percentage', percentage);\n\t\n\t            // update ui button\n\t            this.ui_button.set('percentage', this._uploadPercentage(percentage, it.get('file_size')));\n\t        },\n\t\n\t        // success\n\t        _eventSuccess: function _eventSuccess(index, message) {\n\t            // update status\n\t            var it = this.collection.get(index);\n\t            it.set('percentage', 100);\n\t            it.set('status', 'success');\n\t\n\t            // update ui button\n\t            this.ui_button.set('percentage', this._uploadPercentage(100, it.get('file_size')));\n\t\n\t            // update completed\n\t            this.upload_completed += it.get('file_size') * 100;\n\t\n\t            // update counter\n\t            this.counter.announce--;\n\t            this.counter.success++;\n\t\n\t            // update on screen info\n\t            this._updateScreen();\n\t\n\t            // update galaxy history\n\t            Galaxy.currHistoryPanel.refreshContents();\n\t        },\n\t\n\t        // error\n\t        _eventError: function _eventError(index, message) {\n\t            // get element\n\t            var it = this.collection.get(index);\n\t\n\t            // update status\n\t            it.set('percentage', 100);\n\t            it.set('status', 'error');\n\t            it.set('info', message);\n\t\n\t            // update ui button\n\t            this.ui_button.set('percentage', this._uploadPercentage(100, it.get('file_size')));\n\t            this.ui_button.set('status', 'danger');\n\t\n\t            // update completed\n\t            this.upload_completed += it.get('file_size') * 100;\n\t\n\t            // update counter\n\t            this.counter.announce--;\n\t            this.counter.error++;\n\t\n\t            // update on screen info\n\t            this._updateScreen();\n\t        },\n\t\n\t        // queue is done\n\t        _eventComplete: function _eventComplete() {\n\t            // reset queued upload to initial status\n\t            this.collection.each(function (model) {\n\t                if (model.get('status') == 'queued') {\n\t                    model.set('status', 'init');\n\t                }\n\t            });\n\t\n\t            // update running\n\t            this.counter.running = 0;\n\t\n\t            // update on screen info\n\t            this._updateScreen();\n\t        },\n\t\n\t        //\n\t        // events triggered by collection\n\t        //\n\t\n\t        // remove model from upload list\n\t        _eventRemove: function _eventRemove(model) {\n\t            // update status\n\t            var status = model.get('status');\n\t\n\t            // reduce counter\n\t            if (status == 'success') {\n\t                this.counter.success--;\n\t            } else if (status == 'error') {\n\t                this.counter.error--;\n\t            } else {\n\t                this.counter.announce--;\n\t            }\n\t\n\t            // remove from queue\n\t            this.uploadbox.remove(model.id);\n\t\n\t            // show on screen info\n\t            this._updateScreen();\n\t        },\n\t\n\t        //\n\t        // events triggered by this view\n\t        //\n\t\n\t        // [public] display extension info popup\n\t        showExtensionInfo: function showExtensionInfo(options) {\n\t            // initialize\n\t            var self = this;\n\t            var $el = options.$el;\n\t            var extension = options.extension;\n\t            var title = options.title;\n\t            var description = _.findWhere(self.list_extensions, { 'id': extension });\n\t\n\t            // create popup\n\t            this.extension_popup && this.extension_popup.remove();\n\t            this.extension_popup = new Popover.View({\n\t                placement: options.placement || 'bottom',\n\t                container: $el\n\t            });\n\t\n\t            // add content and show popup\n\t            this.extension_popup.title(title);\n\t            this.extension_popup.empty();\n\t            this.extension_popup.append(this._templateDescription(description));\n\t            this.extension_popup.show();\n\t        },\n\t\n\t        // show/hide ftp popup\n\t        _eventFtp: function _eventFtp() {\n\t            if (!this.ftp.visible) {\n\t                this.ftp.empty();\n\t                var self = this;\n\t                this.ftp.append(new UploadFtp({\n\t                    collection: this.collection,\n\t                    ftp_upload_site: this.ftp_upload_site,\n\t                    onadd: function onadd(ftp_file) {\n\t                        self.uploadbox.add([{\n\t                            mode: 'ftp',\n\t                            name: ftp_file.path,\n\t                            size: ftp_file.size,\n\t                            path: ftp_file.path\n\t                        }]);\n\t                    },\n\t                    onremove: function onremove(model_index) {\n\t                        self.collection.remove(model_index);\n\t                    }\n\t                }).$el);\n\t                this.ftp.show();\n\t            } else {\n\t                this.ftp.hide();\n\t            }\n\t        },\n\t\n\t        // create a new file\n\t        _eventCreate: function _eventCreate() {\n\t            this.uploadbox.add([{\n\t                name: 'New File',\n\t                size: 0,\n\t                mode: 'new'\n\t            }]);\n\t        },\n\t\n\t        // start upload process\n\t        _eventStart: function _eventStart() {\n\t            // check\n\t            if (this.counter.announce == 0 || this.counter.running > 0) {\n\t                return;\n\t            }\n\t\n\t            // reset current size\n\t            var self = this;\n\t            this.upload_size = 0;\n\t            this.upload_completed = 0;\n\t            // switch icons for new uploads\n\t            this.collection.each(function (model) {\n\t                if (model.get('status') == 'init') {\n\t                    model.set('status', 'queued');\n\t                    self.upload_size += model.get('file_size');\n\t                }\n\t            });\n\t\n\t            // reset progress\n\t            this.ui_button.set('percentage', 0);\n\t            this.ui_button.set('status', 'success');\n\t\n\t            // update running\n\t            this.counter.running = this.counter.announce;\n\t\n\t            // set current history id\n\t            this.history_id = this.app.currentHistory();\n\t\n\t            // initiate upload procedure in plugin\n\t            this.uploadbox.start();\n\t\n\t            // update on screen info\n\t            this._updateScreen();\n\t        },\n\t\n\t        // pause upload process\n\t        _eventStop: function _eventStop() {\n\t            // check\n\t            if (this.counter.running > 0) {\n\t                // show upload has paused\n\t                this.ui_button.set('status', 'info');\n\t\n\t                // set html content\n\t                $('#upload-info').html('Queue will pause after completing the current file...');\n\t\n\t                // request pause\n\t                this.uploadbox.stop();\n\t            }\n\t        },\n\t\n\t        // remove all\n\t        _eventReset: function _eventReset() {\n\t            // make sure queue is not running\n\t            if (this.counter.running == 0) {\n\t                // reset collection\n\t                this.collection.reset();\n\t\n\t                // reset counter\n\t                this.counter.reset();\n\t\n\t                // remove from queue\n\t                this.uploadbox.reset();\n\t\n\t                // reset value for universal type drop-down\n\t                this.select_extension.value(this.options.default_extension);\n\t                this.select_genome.value(this.options.default_genome);\n\t\n\t                // reset button\n\t                this.ui_button.set('percentage', 0);\n\t\n\t                // show on screen info\n\t                this._updateScreen();\n\t            }\n\t        },\n\t\n\t        // update extension for all models\n\t        updateExtension: function updateExtension(extension, defaults_only) {\n\t            var self = this;\n\t            this.collection.each(function (model) {\n\t                if (model.get('status') == 'init' && (model.get('extension') == self.options.default_extension || !defaults_only)) {\n\t                    model.set('extension', extension);\n\t                }\n\t            });\n\t        },\n\t\n\t        // update genome for all models\n\t        updateGenome: function updateGenome(genome, defaults_only) {\n\t            var self = this;\n\t            this.collection.each(function (model) {\n\t                if (model.get('status') == 'init' && (model.get('genome') == self.options.default_genome || !defaults_only)) {\n\t                    model.set('genome', genome);\n\t                }\n\t            });\n\t        },\n\t\n\t        // set screen\n\t        _updateScreen: function _updateScreen() {\n\t            /*\n\t                update on screen info\n\t            */\n\t\n\t            // check default message\n\t            if (this.counter.announce == 0) {\n\t                if (this.uploadbox.compatible()) {\n\t                    message = '&nbsp;';\n\t                } else {\n\t                    message = 'Browser does not support Drag & Drop. Try Firefox 4+, Chrome 7+, IE 10+, Opera 12+ or Safari 6+.';\n\t                }\n\t            } else {\n\t                if (this.counter.running == 0) {\n\t                    message = 'You added ' + this.counter.announce + ' file(s) to the queue. Add more files or click \\'Start\\' to proceed.';\n\t                } else {\n\t                    message = 'Please wait...' + this.counter.announce + ' out of ' + this.counter.running + ' remaining.';\n\t                }\n\t            }\n\t\n\t            // set html content\n\t            this.$('#upload-info').html(message);\n\t\n\t            /*\n\t                update button status\n\t            */\n\t\n\t            // update reset button\n\t            if (this.counter.running == 0 && this.counter.announce + this.counter.success + this.counter.error > 0) {\n\t                this.btnReset.enable();\n\t            } else {\n\t                this.btnReset.disable();\n\t            }\n\t\n\t            // update upload button\n\t            if (this.counter.running == 0 && this.counter.announce > 0) {\n\t                this.btnStart.enable();\n\t                this.btnStart.$el.addClass('btn-primary');\n\t            } else {\n\t                this.btnStart.disable();\n\t                this.btnStart.$el.removeClass('btn-primary');\n\t            }\n\t\n\t            // pause upload button\n\t            if (this.counter.running > 0) {\n\t                this.btnStop.enable();\n\t            } else {\n\t                this.btnStop.disable();\n\t            }\n\t\n\t            // select upload button\n\t            if (this.counter.running == 0) {\n\t                this.btnLocal.enable();\n\t                this.btnFtp.enable();\n\t                this.btnCreate.enable();\n\t            } else {\n\t                this.btnLocal.disable();\n\t                this.btnFtp.disable();\n\t                this.btnCreate.disable();\n\t            }\n\t\n\t            // ftp button\n\t            if (this.ftp_upload_site) {\n\t                this.btnFtp.$el.show();\n\t            } else {\n\t                this.btnFtp.$el.hide();\n\t            }\n\t\n\t            // table visibility\n\t            if (this.counter.announce + this.counter.success + this.counter.error > 0) {\n\t                this.$('#upload-table').show();\n\t                this.$('.upload-helper').hide();\n\t            } else {\n\t                this.$('#upload-table').hide();\n\t                this.$('.upload-helper').show();\n\t            }\n\t        },\n\t\n\t        // calculate percentage of all queued uploads\n\t        _uploadPercentage: function _uploadPercentage(percentage, size) {\n\t            return (this.upload_completed + percentage * size) / this.upload_size;\n\t        },\n\t\n\t        // template for extensions description\n\t        _templateDescription: function _templateDescription(options) {\n\t            if (options.description) {\n\t                var tmpl = options.description;\n\t                if (options.description_url) {\n\t                    tmpl += '&nbsp;(<a href=\"' + options.description_url + '\" target=\"_blank\">read more</a>)';\n\t                }\n\t                return tmpl;\n\t            } else {\n\t                return 'There is no description available for this file extension.';\n\t            }\n\t        },\n\t\n\t        // load html template\n\t        _template: function _template() {\n\t            return '<div class=\"upload-view-default\">' + '<div class=\"upload-top\">' + '<h6 id=\"upload-info\" class=\"upload-info\"/>' + '</div>' + '<div id=\"upload-box\" class=\"upload-box\">' + '<div class=\"upload-helper\"><i class=\"fa fa-files-o\"/>Drop files here</div>' + '<table id=\"upload-table\" class=\"ui-table-striped\" style=\"display: none;\">' + '<thead>' + '<tr>' + '<th>Name</th>' + '<th>Size</th>' + '<th>Type</th>' + '<th>Genome</th>' + '<th>Settings</th>' + '<th>Status</th>' + '<th/>' + '</tr>' + '</thead>' + '<tbody/>' + '</table>' + '</div>' + '<div id=\"upload-footer\" class=\"upload-footer\">' + '<span class=\"footer-title\">Type (set all):</span>' + '<span id=\"footer-extension\"/>' + '<span id=\"footer-extension-info\" class=\"upload-icon-button fa fa-search\"/> ' + '<span class=\"footer-title\">Genome (set all):</span>' + '<span id=\"footer-genome\"/>' + '</div>' + '<div id=\"upload-buttons\" class=\"upload-buttons\"/>' + '</div>';\n\t        }\n\t    });\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n/* 120 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $) {'use strict';\n\t\n\t// dependencies\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t\n\t    // model for upload/progress bar button\n\t    var Model = Backbone.Model.extend({\n\t        defaults: {\n\t            icon: 'fa-upload',\n\t            tooltip: 'Download from URL or upload files from disk',\n\t            label: 'Load Data',\n\t            percentage: 0,\n\t            status: ''\n\t        }\n\t    });\n\t\n\t    // view for upload/progress bar button\n\t    var View = Backbone.View.extend({\n\t        // model\n\t        model: null,\n\t\n\t        // initialize\n\t        initialize: function initialize(options) {\n\t            // link this\n\t            var self = this;\n\t\n\t            // create model\n\t            var model = options.model;\n\t\n\t            // create new element\n\t            this.setElement(this._template());\n\t\n\t            // add event\n\t            this.$el.on('click', function (e) {\n\t                options.onclick(e);\n\t            });\n\t\n\t            // add tooltip\n\t            this.$el.tooltip({ title: model.get('tooltip'), placement: 'bottom' });\n\t\n\t            // events\n\t            model.on('change:percentage', function () {\n\t                self._percentage(model.get('percentage'));\n\t            });\n\t            model.on('change:status', function () {\n\t                self._status(model.get('status'));\n\t            });\n\t\n\t            // unload event\n\t            var self = this;\n\t            $(window).on('beforeunload', function () {\n\t                var text = \"\";\n\t                if (options.onunload) {\n\t                    text = options.onunload();\n\t                }\n\t                if (text != \"\") {\n\t                    return text;\n\t                }\n\t            });\n\t        },\n\t\n\t        // set status\n\t        _status: function _status(value) {\n\t            var $el = this.$el.find('.progress-bar');\n\t            $el.removeClass();\n\t            $el.addClass('progress-bar');\n\t            $el.addClass('progress-bar-notransition');\n\t            if (value != '') {\n\t                $el.addClass('progress-bar-' + value);\n\t            }\n\t        },\n\t\n\t        // set percentage\n\t        _percentage: function _percentage(value) {\n\t            var $el = this.$el.find('.progress-bar');\n\t            $el.css({ width: value + '%' });\n\t        },\n\t\n\t        // template\n\t        _template: function _template() {\n\t            return '<div class=\"upload-button\">' + '<div class=\"progress\">' + '<div class=\"progress-bar\"/>' + '<a class=\"panel-header-button\" href=\"javascript:void(0)\" id=\"tool-panel-upload-button\">' + '<span class=\"fa fa-upload\"/>' + '</a>' + '</div>' + '</div>';\n\t        }\n\t    });\n\t\n\t    return {\n\t        Model: Model,\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1)))\n\n/***/ },\n/* 121 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone) {'use strict';\n\t\n\t/** Upload app contains the upload progress button and upload modal, compiles model data for API request **/\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(8), __webpack_require__(115), __webpack_require__(120), __webpack_require__(119), __webpack_require__(117)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, Modal, Tabs, UploadButton, UploadViewDefault, UploadViewComposite) {\n\t    return Backbone.View.extend({\n\t        // default options\n\t        options: {\n\t            nginx_upload_path: '',\n\t            ftp_upload_site: 'n/a',\n\t            default_genome: '?',\n\t            default_extension: 'auto',\n\t            height: 500,\n\t            width: 900,\n\t            auto: {\n\t                id: 'auto',\n\t                text: 'Auto-detect',\n\t                description: 'This system will try to detect the file type automatically. If your file is not detected properly as one of the known formats, it most likely means that it has some format problems (e.g., different number of columns on different rows). You can still coerce the system to set your data to the format you think it should be.  You can also upload compressed files, which will automatically be decompressed.'\n\t            }\n\t        },\n\t\n\t        // upload modal container\n\t        modal: null,\n\t\n\t        // progress button in panel\n\t        ui_button: null,\n\t\n\t        // current history identifier\n\t        current_history: null,\n\t\n\t        // contains all available dataset extensions/types\n\t        list_extensions: [],\n\t\n\t        // contains all available genomes\n\t        list_genomes: [],\n\t\n\t        // initialize\n\t        initialize: function initialize(options) {\n\t            // link this\n\t            var self = this;\n\t\n\t            // merge parsed options\n\t            this.options = Utils.merge(options, this.options);\n\t\n\t            // create model for upload/progress button\n\t            this.ui_button = new UploadButton.Model();\n\t\n\t            // create view for upload/progress button\n\t            this.ui_button_view = new UploadButton.View({\n\t                model: this.ui_button,\n\t                onclick: function onclick(e) {\n\t                    e.preventDefault();\n\t                    self.show();\n\t                },\n\t                onunload: function onunload() {\n\t                    var percentage = self.ui_button.get('percentage', 0);\n\t                    if (percentage > 0 && percentage < 100) {\n\t                        return 'Several uploads are queued.';\n\t                    }\n\t                }\n\t            });\n\t\n\t            // set element to button view\n\t            this.setElement(this.ui_button_view.$el);\n\t\n\t            // load extensions\n\t            var self = this;\n\t            Utils.get({\n\t                url: Galaxy.root + 'api/datatypes?extension_only=False',\n\t                success: function success(datatypes) {\n\t                    for (var key in datatypes) {\n\t                        self.list_extensions.push({\n\t                            id: datatypes[key].extension,\n\t                            text: datatypes[key].extension,\n\t                            description: datatypes[key].description,\n\t                            description_url: datatypes[key].description_url,\n\t                            composite_files: datatypes[key].composite_files\n\t                        });\n\t                    }\n\t                    self.list_extensions.sort(function (a, b) {\n\t                        var a_text = a.text && a.text.toLowerCase();\n\t                        var b_text = b.text && b.text.toLowerCase();\n\t                        return a_text > b_text ? 1 : a_text < b_text ? -1 : 0;\n\t                    });\n\t                    if (!self.options.datatypes_disable_auto) {\n\t                        self.list_extensions.unshift(self.options.auto);\n\t                    }\n\t                }\n\t            });\n\t\n\t            // load genomes\n\t            Utils.get({\n\t                url: Galaxy.root + 'api/genomes',\n\t                success: function success(genomes) {\n\t                    for (var key in genomes) {\n\t                        self.list_genomes.push({\n\t                            id: genomes[key][1],\n\t                            text: genomes[key][0]\n\t                        });\n\t                    }\n\t                    self.list_genomes.sort(function (a, b) {\n\t                        if (a.id == self.options.default_genome) {\n\t                            return -1;\n\t                        }\n\t                        if (b.id == self.options.default_genome) {\n\t                            return 1;\n\t                        }\n\t                        return a.text > b.text ? 1 : a.text < b.text ? -1 : 0;\n\t                    });\n\t                }\n\t            });\n\t        },\n\t\n\t        //\n\t        // event triggered by upload button\n\t        //\n\t\n\t        // show/hide upload frame\n\t        show: function show() {\n\t            // wait for galaxy history panel\n\t            var self = this;\n\t            if (!Galaxy.currHistoryPanel || !Galaxy.currHistoryPanel.model) {\n\t                window.setTimeout(function () {\n\t                    self.show();\n\t                }, 500);\n\t                return;\n\t            }\n\t\n\t            // set current user\n\t            this.current_user = Galaxy.user.id;\n\t\n\t            // create modal\n\t            if (!this.modal) {\n\t                // build tabs\n\t                this.tabs = new Tabs.View();\n\t\n\t                // add tabs\n\t                this.default_view = new UploadViewDefault(this);\n\t                this.tabs.add({\n\t                    id: 'regular',\n\t                    title: 'Regular',\n\t                    $el: this.default_view.$el\n\t                });\n\t                this.composite_view = new UploadViewComposite(this);\n\t                this.tabs.add({\n\t                    id: 'composite',\n\t                    title: 'Composite',\n\t                    $el: this.composite_view.$el\n\t                });\n\t\n\t                // make modal\n\t                this.modal = new Modal.View({\n\t                    title: 'Download from web or upload from disk',\n\t                    body: this.tabs.$el,\n\t                    height: this.options.height,\n\t                    width: this.options.width,\n\t                    closing_events: true,\n\t                    title_separator: false\n\t                });\n\t            }\n\t\n\t            // show modal\n\t            this.modal.show();\n\t        },\n\t\n\t        // refresh user and current history\n\t        currentHistory: function currentHistory() {\n\t            return this.current_user && Galaxy.currHistoryPanel.model.get('id');\n\t        },\n\t\n\t        // get ftp configuration\n\t        currentFtp: function currentFtp() {\n\t            return this.current_user && this.options.ftp_upload_site;\n\t        },\n\t\n\t        /**\n\t          * Package API data from array of models\n\t          * @param{Array} items - Upload items/rows filtered from a collection\n\t        */\n\t        toData: function toData(items, history_id) {\n\t            // create dictionary for data submission\n\t            var data = {\n\t                payload: {\n\t                    'tool_id': 'upload1',\n\t                    'history_id': history_id || this.currentHistory(),\n\t                    'inputs': {}\n\t                },\n\t                files: [],\n\t                error_message: null\n\t            };\n\t            // add upload tools input data\n\t            if (items && items.length > 0) {\n\t                var inputs = {};\n\t                inputs['dbkey'] = items[0].get('genome', null);\n\t                inputs['file_type'] = items[0].get('extension', null);\n\t                for (var index in items) {\n\t                    var it = items[index];\n\t                    it.set('status', 'running');\n\t                    if (it.get('file_size') > 0) {\n\t                        var prefix = 'files_' + index + '|';\n\t                        inputs[prefix + 'type'] = 'upload_dataset';\n\t                        inputs[prefix + 'space_to_tab'] = it.get('space_to_tab') && 'Yes' || null;\n\t                        inputs[prefix + 'to_posix_lines'] = it.get('to_posix_lines') && 'Yes' || null;\n\t                        switch (it.get('file_mode')) {\n\t                            case 'new':\n\t                                inputs[prefix + 'url_paste'] = it.get('url_paste');\n\t                                break;\n\t                            case 'ftp':\n\t                                inputs[prefix + 'ftp_files'] = it.get('file_path');\n\t                                break;\n\t                            case 'local':\n\t                                data.files.push({ name: prefix + 'file_data', file: it.get('file_data') });\n\t                        }\n\t                    } else {\n\t                        data.error_message = 'Upload content incomplete.';\n\t                        it.set('status', 'error');\n\t                        it.set('info', data.error_message);\n\t                        break;\n\t                    }\n\t                }\n\t                data.payload.inputs = JSON.stringify(inputs);\n\t            }\n\t            return data;\n\t        }\n\t    });\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3)))\n\n/***/ },\n/* 122 */,\n/* 123 */,\n/* 124 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(jQuery, $) {'use strict';\n\t\n\t(function (root, factory) {\n\t    if (true) {\n\t        // AMD. Register as an anonymous module.\n\t        !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory), __WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ? (__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t    } else {\n\t        // Browser globals\n\t        root.LoadingIndicator = factory();\n\t    }\n\t\n\t    //============================================================================\n\t})(undefined, function () {\n\t    //TODO: too specific to history panel\n\t    function LoadingIndicator($where, options) {\n\t\n\t        var self = this;\n\t        // defaults\n\t        options = jQuery.extend({\n\t            cover: false\n\t        }, options || {});\n\t\n\t        function render() {\n\t            var html = ['<div class=\"loading-indicator\">', '<div class=\"loading-indicator-text\">', '<span class=\"fa fa-spinner fa-spin fa-lg\"></span>', '<span class=\"loading-indicator-message\">loading...</span>', '</div>', '</div>'].join('\\n');\n\t\n\t            var $indicator = $(html).hide().css(options.css || {\n\t                position: 'fixed'\n\t            }),\n\t                $text = $indicator.children('.loading-indicator-text');\n\t\n\t            if (options.cover) {\n\t                $indicator.css({\n\t                    'z-index': 2,\n\t                    top: $where.css('top'),\n\t                    bottom: $where.css('bottom'),\n\t                    left: $where.css('left'),\n\t                    right: $where.css('right'),\n\t                    opacity: 0.5,\n\t                    'background-color': 'white',\n\t                    'text-align': 'center'\n\t                });\n\t                $text = $indicator.children('.loading-indicator-text').css({\n\t                    'margin-top': '20px'\n\t                });\n\t            } else {\n\t                $text = $indicator.children('.loading-indicator-text').css({\n\t                    margin: '12px 0px 0px 10px',\n\t                    opacity: '0.85',\n\t                    color: 'grey'\n\t                });\n\t                $text.children('.loading-indicator-message').css({\n\t                    margin: '0px 8px 0px 0px',\n\t                    'font-style': 'italic'\n\t                });\n\t            }\n\t            return $indicator;\n\t        }\n\t\n\t        self.show = function (msg, speed, callback) {\n\t            msg = msg || 'loading...';\n\t            speed = speed || 'fast';\n\t            // remove previous\n\t            $where.parent().find('.loading-indicator').remove();\n\t            // since position is fixed - we insert as sibling\n\t            self.$indicator = render().insertBefore($where);\n\t            self.message(msg);\n\t            self.$indicator.fadeIn(speed, callback);\n\t            return self;\n\t        };\n\t\n\t        self.message = function (msg) {\n\t            self.$indicator.find('i').text(msg);\n\t        };\n\t\n\t        self.hide = function (speed, callback) {\n\t            speed = speed || 'fast';\n\t            if (self.$indicator && self.$indicator.length) {\n\t                self.$indicator.fadeOut(speed, function () {\n\t                    self.$indicator.remove();\n\t                    if (callback) {\n\t                        callback();\n\t                    }\n\t                });\n\t            } else {\n\t                if (callback) {\n\t                    callback();\n\t                }\n\t            }\n\t            return self;\n\t        };\n\t        return self;\n\t    }\n\t\n\t    //============================================================================\n\t    return LoadingIndicator;\n\t});\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1), __webpack_require__(1)))\n\n/***/ },\n/* 125 */,\n/* 126 */,\n/* 127 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t  //=============================================================================\n\t  /**\n\t  (Imported for edit distance algorith. From: https://gist.github.com/andrei-m/982927)\n\t  Copyright (c) 2011 Andrei Mackenzie\n\t  \n\t  Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\n\t  documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the\n\t  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit\n\t  persons to whom the Software is furnished to do so, subject to the following conditions:\n\t  \n\t  The above copyright notice and this permission notice shall be included in all copies or substantial portions of the\n\t  Software.\n\t  \n\t  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE\n\t  WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n\t  COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n\t  OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\t  */\n\t  // Compute the edit distance between the two given strings\n\t  //exports.getEditDistance = function(a, b){\n\t  function levenshteinDistance(a, b) {\n\t    if (a.length === 0) {\n\t      return b.length;\n\t    }\n\t    if (b.length === 0) {\n\t      return a.length;\n\t    }\n\t\n\t    var matrix = [];\n\t\n\t    // increment along the first column of each row\n\t    var i;\n\t    for (i = 0; i <= b.length; i++) {\n\t      matrix[i] = [i];\n\t    }\n\t\n\t    // increment each column in the first row\n\t    var j;\n\t    for (j = 0; j <= a.length; j++) {\n\t      matrix[0][j] = j;\n\t    }\n\t\n\t    // Fill in the rest of the matrix\n\t    for (i = 1; i <= b.length; i++) {\n\t      for (j = 1; j <= a.length; j++) {\n\t        if (b.charAt(i - 1) === a.charAt(j - 1)) {\n\t          matrix[i][j] = matrix[i - 1][j - 1];\n\t        } else {\n\t          matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, // substitution\n\t          Math.min(matrix[i][j - 1] + 1, // insertion\n\t          matrix[i - 1][j] + 1)); // deletion\n\t        }\n\t      }\n\t    }\n\t\n\t    //console.debug( '\\t\\t levenshteinDistance', a, b, matrix[b.length][a.length] );\n\t    return matrix[b.length][a.length];\n\t  }\n\t\n\t  //=============================================================================\n\t  return levenshteinDistance;\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ }\n]);\n\n\n/** WEBPACK FOOTER **\n ** analysis.bundled.js\n **/","\nvar jQuery = require( 'jquery' ),\n    $ = jQuery,\n    GalaxyApp = require( 'galaxy' ).GalaxyApp,\n    QUERY_STRING = require( 'utils/query-string-parsing' ),\n    PANEL = require( 'layout/panel' ),\n    ToolPanel = require( './tool-panel' ),\n    HistoryPanel = require( './history-panel' ),\n    PAGE = require( 'layout/page' ),\n    ToolForm = require( 'mvc/tool/tool-form' ),\n    Tours = require( 'mvc/tours' );\n\n/** define the 'Analyze Data'/analysis/main/home page for Galaxy\n *  * has a masthead\n *  * a left tool menu to allow the user to load tools in the center panel\n *  * a right history menu that shows the user's current data\n *  * a center panel\n *  Both panels (generally) persist while the center panel shows any\n *  UI needed for the current step of an analysis, like:\n *      * tool forms to set tool parameters,\n *      * tables showing the contents of datasets\n *      * etc.\n */\nwindow.app = function app( options, bootstrapped ){\n    window.Galaxy = new GalaxyApp( options, bootstrapped );\n    Galaxy.debug( 'analysis app' );\n    // TODO: use router as App base (combining with Galaxy)\n\n    // .................................................... panels and page\n    var config = options.config,\n        toolPanel = new ToolPanel({\n            el                  : '#left',\n            userIsAnonymous     : Galaxy.user.isAnonymous(),\n            search_url          : config.search_url,\n            toolbox             : config.toolbox,\n            toolbox_in_panel    : config.toolbox_in_panel,\n            stored_workflow_menu_entries : config.stored_workflow_menu_entries,\n            nginx_upload_path   : config.nginx_upload_path,\n            ftp_upload_site     : config.ftp_upload_site,\n            default_genome      : config.default_genome,\n            default_extension   : config.default_extension,\n        }),\n        centerPanel = new PANEL.CenterPanel({\n            el              : '#center'\n        }),\n        historyPanel = new HistoryPanel({\n            el              : '#right',\n            galaxyRoot      : Galaxy.root,\n            userIsAnonymous : Galaxy.user.isAnonymous(),\n            allow_user_dataset_purge: config.allow_user_dataset_purge,\n        }),\n        analysisPage = new PAGE.PageLayoutView( _.extend( options, {\n            el              : 'body',\n            left            : toolPanel,\n            center          : centerPanel,\n            right           : historyPanel,\n        }));\n\n    // .................................................... decorate the galaxy object\n    // TODO: most of this is becoming unnecessary as we move to apps\n    Galaxy.page = analysisPage;\n    Galaxy.params = Galaxy.config.params;\n\n    // add tool panel to Galaxy object\n    Galaxy.toolPanel = toolPanel.tool_panel;\n    Galaxy.upload = toolPanel.uploadButton;\n\n    Galaxy.currHistoryPanel = historyPanel.historyView;\n    Galaxy.currHistoryPanel.listenToGalaxy( Galaxy );\n\n    //HACK: move there\n    Galaxy.app = {\n        display : function( view, target ){\n            // TODO: Remove this line after select2 update\n            $( '.select2-hidden-accessible' ).remove();\n            centerPanel.display( view );\n        },\n    };\n\n    // .................................................... routes\n    /**  */\n    var router = new ( Backbone.Router.extend({\n        // TODO: not many client routes at this point - fill and remove from server.\n        // since we're at root here, this may be the last to be routed entirely on the client.\n        initialize : function( options ){\n            this.options = options;\n        },\n\n        /** override to parse query string into obj and send to each route */\n        execute: function( callback, args, name ){\n            Galaxy.debug( 'router execute:', callback, args, name );\n            var queryObj = QUERY_STRING.parse( args.pop() );\n            args.push( queryObj );\n            if( callback ){\n                callback.apply( this, args );\n            }\n        },\n\n        routes : {\n            '(/)' : 'home',\n            // TODO: remove annoying 'root' from root urls\n            '(/)root*' : 'home',\n            '(/)tours(/)(:tour_id)' : 'show_tours',\n        },\n\n        show_tours : function( tour_id ){\n            if (tour_id){\n                Tours.giveTour(tour_id);\n            }\n            else{\n                centerPanel.display( new Tours.ToursView() );\n            }\n        },\n\n        /**  */\n        home : function( params ){\n            // TODO: to router, remove Globals\n            // load a tool by id (tool_id) or rerun a previous tool execution (job_id)\n            if( params.tool_id || params.job_id ) {\n                if ( params.tool_id === 'upload1' ) {\n                    Galaxy.upload.show();\n                    this._loadCenterIframe( 'welcome' );\n                } else {\n                    this._loadToolForm( params );\n                }\n            } else {\n                // show the workflow run form\n                if( params.workflow_id ){\n                    this._loadCenterIframe( 'workflow/run?id=' + params.workflow_id );\n                // load the center iframe with controller.action: galaxy.org/?m_c=history&m_a=list -> history/list\n                } else if( params.m_c ){\n                    this._loadCenterIframe( params.m_c + '/' + params.m_a );\n                // show the workflow run form\n                } else {\n                    this._loadCenterIframe( 'welcome' );\n                }\n            }\n        },\n\n        /** load the center panel with a tool form described by the given params obj */\n        _loadToolForm : function( params ){\n            //TODO: load tool form code async\n            params.id = params.tool_id;\n            centerPanel.display( new ToolForm.View( params ) );\n        },\n\n        /** load the center panel iframe using the given url */\n        _loadCenterIframe : function( url, root ){\n            root = root || Galaxy.root;\n            url = root + url;\n            centerPanel.$( '#galaxy_main' ).prop( 'src', url );\n        },\n\n    }))( options );\n\n    // .................................................... when the page is ready\n    // render and start the router\n    $(function(){\n        analysisPage\n            .render()\n            .right.historyView.loadCurrentHistory();\n\n        // use galaxy to listen to history size changes and then re-fetch the user's total size (to update the quota meter)\n        // TODO: we have to do this here (and after every page.render()) because the masthead is re-created on each\n        // page render. It's re-created each time because there is no render function and can't be re-rendered without\n        // re-creating it.\n        Galaxy.listenTo( analysisPage.right.historyView, 'history-size-change', function(){\n            // fetch to update the quota meter adding 'current' for any anon-user's id\n            Galaxy.user.fetch({ url: Galaxy.user.urlRoot() + '/' + ( Galaxy.user.id || 'current' ) });\n        });\n        analysisPage.right.historyView.connectToQuotaMeter( analysisPage.masthead.quotaMeter );\n\n        // start the router - which will call any of the routes above\n        Backbone.history.start({\n            root        : Galaxy.root,\n            pushState   : true,\n        });\n    });\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/apps/analysis.js\n **/","/**\n * Galaxy utilities comprises small functions, which at this point\n * do not require their own classes/files\n*/\n\n// dependencies\ndefine([], function() {\n\n/** Builds a basic iframe\n*/\nfunction iframe( src ) {\n    return '<iframe src=\"' + src + '\" frameborder=\"0\" style=\"width: 100%; height: 100%;\"/>';\n}\n\n/** Traverse through json\n*/\nfunction deepeach( dict, callback ) {\n    for( var i in dict ) {\n        var d = dict[ i ];\n        if( _.isObject( d ) ) {\n            var new_dict = callback( d );\n            new_dict && ( dict[ i ] = new_dict );\n            deepeach( d, callback );\n        }\n    }\n}\n\n/**\n * Check if a string is a json string\n * @param{String}   text - Content to be validated\n */\nfunction isJSON(text) {\n    return /^[\\],:{}\\s]*$/.test(text.replace(/\\\\[\"\\\\\\/bfnrtu]/g, '@').\n        replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, ']').\n        replace(/(?:^|:|,)(?:\\s*\\[)+/g, ''));\n};\n\n/**\n * Sanitize/escape a string\n * @param{String}   content - Content to be sanitized\n */\nfunction sanitize(content) {\n    return $('<div/>').text(content).html();\n};\n\n/**\n * Checks if a value or list of values is `empty`\n * usually used for selectable options\n * @param{String}   value - Value or list to be validated\n */\nfunction isEmpty ( value ) {\n    if ( !( value instanceof Array ) ) {\n        value = [ value ];\n    }\n    if ( value.length === 0 ) {\n        return true;\n    }\n    for( var i in value ) {\n        if ( [ '__null__', '__undefined__', null, undefined ].indexOf( value[ i ] ) > -1 ) {\n            return true;\n        }\n    }\n    return false;\n};\n\n/**\n * Convert list to pretty string\n * @param{String}   lst - List of strings to be converted in human readable list sentence\n */\nfunction textify( lst ) {\n    if ( $.isArray( lst ) ) {\n        var lst = lst.toString().replace( /,/g, ', ' );\n        var pos = lst.lastIndexOf( ', ' );\n        if ( pos != -1 ) {\n            lst = lst.substr( 0, pos ) + ' or ' + lst.substr( pos + 2 );\n        }\n        return lst;\n    }\n    return '';\n};\n\n/**\n * Request handler for GET\n * @param{String}   url     - Url request is made to\n * @param{Function} success - Callback on success\n * @param{Function} error   - Callback on error\n * @param{Boolean}  cache   - Use cached data if available\n */\nfunction get (options) {\n    top.__utils__get__ = top.__utils__get__ || {};\n    var cache_key = JSON.stringify( options );\n    if (options.cache && top.__utils__get__[cache_key]) {\n        options.success && options.success(top.__utils__get__[cache_key]);\n        window.console.debug('utils.js::get() - Fetching from cache [' + options.url + '].');\n    } else {\n        request({\n            url     : options.url,\n            data    : options.data,\n            success : function(response) {\n                top.__utils__get__[cache_key] = response;\n                options.success && options.success(response);\n            },\n            error : function(response) {\n                options.error && options.error(response);\n            }\n        });\n    }\n};\n\n/**\n * Request handler\n * @param{String}   method  - Request method ['GET', 'POST', 'DELETE', 'PUT']\n * @param{String}   url     - Url request is made to\n * @param{Object}   data    - Data send to url\n * @param{Function} success - Callback on success\n * @param{Function} error   - Callback on error\n */\nfunction request (options) {\n    // prepare ajax\n    var ajaxConfig = {\n        contentType : 'application/json',\n        type        : options.type || 'GET',\n        data        : options.data || {},\n        url         : options.url\n    }\n    // encode data into url\n    if ( ajaxConfig.type == 'GET' || ajaxConfig.type == 'DELETE' ) {\n        if ( !$.isEmptyObject(ajaxConfig.data) ) {\n            ajaxConfig.url += ajaxConfig.url.indexOf('?') == -1 ? '?' : '&';\n            ajaxConfig.url += $.param(ajaxConfig.data, true);\n        }\n        ajaxConfig.data = null;\n    } else {\n        ajaxConfig.dataType = 'json';\n        ajaxConfig.url      = ajaxConfig.url;\n        ajaxConfig.data     = JSON.stringify(ajaxConfig.data);\n    }\n\n    // make request\n    $.ajax(ajaxConfig).done(function(response) {\n        if (typeof response === 'string') {\n            try {\n                response = response.replace('Infinity,', '\"Infinity\",');\n                response = jQuery.parseJSON(response);\n            } catch (e) {\n                console.debug(e);\n            }\n        }\n        options.success && options.success(response);\n    }).fail(function(response) {\n        var response_text = null;\n        try {\n            response_text = jQuery.parseJSON(response.responseText);\n        } catch (e) {\n            response_text = response.responseText;\n        }\n        options.error && options.error(response_text, response);\n    }).always(function() {\n        options.complete && options.complete();\n    });\n};\n\n/**\n * Read a property value from CSS\n * @param{String}   classname   - CSS class\n * @param{String}   name        - CSS property\n */\nfunction cssGetAttribute (classname, name) {\n    var el = $('<div class=\"' + classname + '\"></div>');\n    el.appendTo(':eq(0)');\n    var value = el.css(name);\n    el.remove();\n    return value;\n};\n\n/**\n * Load a CSS file\n * @param{String}   url - Url of CSS file\n */\nfunction cssLoadFile (url) {\n    if (!$('link[href^=\"' + url + '\"]').length) {\n        $('<link href=\"' + Galaxy.root + url + '\" rel=\"stylesheet\">').appendTo('head');\n    }\n};\n\n/**\n * Safely merge to dictionaries\n * @param{Object}   options         - Target dictionary\n * @param{Object}   optionsDefault  - Source dictionary\n */\nfunction merge (options, optionsDefault) {\n    if (options) {\n        return _.defaults(options, optionsDefault);\n    } else {\n        return optionsDefault;\n    }\n};\n\n\n/**\n * Round floaing point 'number' to 'numPlaces' number of decimal places.\n * @param{Object}   number      a floaing point number\n * @param{Object}   numPlaces   number of decimal places\n */\nfunction roundToDecimalPlaces( number, numPlaces ){\n    var placesMultiplier = 1;\n    for( var i=0; i<numPlaces; i++ ){\n        placesMultiplier *= 10;\n    }\n    return Math.round( number * placesMultiplier ) / placesMultiplier;\n}\n\n// calculate on import\nvar kb = 1024,\n    mb = kb * kb,\n    gb = mb * kb,\n    tb = gb * kb;\n/**\n * Format byte size to string with units\n * @param{Integer}   size           - Size in bytes\n * @param{Boolean}   normal_font    - Switches font between normal and bold\n */\nfunction bytesToString (size, normal_font, numberPlaces) {\n    numberPlaces = numberPlaces !== undefined? numberPlaces: 1;\n    // identify unit\n    var unit = \"\";\n    if (size >= tb){ size = size / tb; unit = 'TB'; } else\n    if (size >= gb){ size = size / gb; unit = 'GB'; } else\n    if (size >= mb){ size = size / mb; unit = 'MB'; } else\n    if (size >= kb){ size = size / kb; unit = 'KB'; } else\n    if (size >  0){ unit = 'b'; }\n    else { return normal_font? '0 b': '<strong>-</strong>'; }\n    // return formatted string\n    var rounded = unit == 'b'? size: roundToDecimalPlaces( size, numberPlaces );\n    if (normal_font) {\n       return  rounded + ' ' + unit;\n    } else {\n        return '<strong>' + rounded + '</strong> ' + unit;\n    }\n};\n\n/**\n * Create a unique id\n */\nfunction uid(){\n    top.__utils__uid__ = top.__utils__uid__ || 0;\n    return 'uid-' + top.__utils__uid__++;\n};\n\n/**\n * Create a time stamp\n */\nfunction time() {\n    var d = new Date();\n    var hours = (d.getHours() < 10 ? \"0\" : \"\") + d.getHours();\n    var minutes = (d.getMinutes() < 10 ? \"0\" : \"\") + d.getMinutes()\n    return datetime = d.getDate() + \"/\"\n                + (d.getMonth() + 1)  + \"/\"\n                + d.getFullYear() + \", \"\n                + hours + \":\"\n                + minutes;\n};\n\nreturn {\n    cssLoadFile: cssLoadFile,\n    cssGetAttribute: cssGetAttribute,\n    get: get,\n    merge: merge,\n    iframe: iframe,\n    bytesToString: bytesToString,\n    uid: uid,\n    time: time,\n    request: request,\n    sanitize: sanitize,\n    textify: textify,\n    isEmpty: isEmpty,\n    deepeach: deepeach,\n    isJSON: isJSON\n};\n\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/utils/utils.js\n **/","/**\n *  This class contains backbone wrappers for basic ui elements such as Images, Labels, Buttons, Input fields etc.\n */\ndefine(['utils/utils',\n    'mvc/ui/ui-select-default',\n    'mvc/ui/ui-slider',\n    'mvc/ui/ui-options',\n    'mvc/ui/ui-drilldown',\n    'mvc/ui/ui-buttons',\n    'mvc/ui/ui-modal'],\n    function( Utils, Select, Slider, Options, Drilldown, Buttons, Modal ) {\n\n    /** Label wrapper */\n    var Label = Backbone.View.extend({\n        tagName: 'label',\n        initialize: function( options ) {\n            this.model = options && options.model || new Backbone.Model( options );\n            this.tagName = options.tagName || this.tagName;\n            this.setElement( $( '<' + this.tagName + '/>' ) );\n            this.listenTo( this.model, 'change', this.render, this );\n            this.render();\n        },\n        title: function( new_title ) {\n            this.model.set( 'title', new_title );\n        },\n        value: function() {\n            return this.model.get( 'title' );\n        },\n        render: function() {\n            this.$el.removeClass()\n                    .addClass( 'ui-label' )\n                    .addClass( this.model.get( 'cls' ) )\n                    .html( this.model.get( 'title' ) );\n            return this;\n        }\n    });\n\n    /** Displays messages used e.g. in the tool form */\n    var Message = Backbone.View.extend({\n        initialize: function( options ) {\n            this.model = options && options.model || new Backbone.Model({\n                message     : null,\n                status      : 'info',\n                cls         : '',\n                persistent  : false\n            }).set( options );\n            this.listenTo( this.model, 'change', this.render, this );\n            this.render();\n        },\n        update: function( options ) {\n            this.model.set( options );\n        },\n        render: function() {\n            this.$el.removeClass().addClass( 'ui-message' ).addClass( this.model.get( 'cls' ) );\n            var status = this.model.get( 'status' );\n            if ( this.model.get( 'large' ) ) {\n                this.$el.addClass((( status == 'success' && 'done' ) ||\n                                   ( status == 'danger' && 'error' ) ||\n                                     status ) + 'messagelarge' );\n            } else {\n                this.$el.addClass( 'alert' ).addClass( 'alert-' + status );\n            }\n            if ( this.model.get( 'message' ) ) {\n                this.$el.html( this.model.get( 'message' ) );\n                this.$el.fadeIn();\n                this.timeout && window.clearTimeout( this.timeout );\n                if ( !this.model.get( 'persistent' ) ) {\n                    var self = this;\n                    this.timeout = window.setTimeout( function() {\n                        self.$el.fadeOut();\n                    }, 3000 );\n                }\n            } else {\n                this.$el.fadeOut();\n            }\n            return this;\n        }\n    });\n\n    /** Renders an input element used e.g. in the tool form */\n    var Input = Backbone.View.extend({\n        initialize: function( options ) {\n            this.model = options && options.model || new Backbone.Model({\n                type            : 'text',\n                placeholder     : '',\n                disabled        : false,\n                visible         : true,\n                cls             : '',\n                area            : false,\n                color           : null,\n                style           : null\n            }).set( options );\n            this.tagName = this.model.get( 'area' ) ? 'textarea' : 'input';\n            this.setElement( $( '<' + this.tagName + '/>' ) );\n            this.listenTo( this.model, 'change', this.render, this );\n            this.render();\n        },\n        events: {\n            'input': '_onchange'\n        },\n        value: function( new_val ) {\n            new_val !== undefined && this.model.set( 'value', typeof new_val === 'string' ? new_val : '' );\n            return this.model.get( 'value' );\n        },\n        render: function() {\n            this.$el.removeClass()\n                    .addClass( 'ui-' + this.tagName )\n                    .addClass( this.model.get( 'cls' ) )\n                    .addClass( this.model.get( 'style' ) )\n                    .attr( 'id', this.model.id )\n                    .attr( 'type', this.model.get( 'type' ) )\n                    .attr( 'placeholder', this.model.get( 'placeholder' ) )\n                    .css( 'color', this.model.get( 'color' ) || '' )\n                    .css( 'border-color', this.model.get( 'color' ) || '' );\n            if ( this.model.get( 'value' ) !== this.$el.val() ) {\n                this.$el.val( this.model.get( 'value' ) );\n            }\n            this.model.get( 'disabled' ) ? this.$el.attr( 'disabled', true ) : this.$el.removeAttr( 'disabled' );\n            this.$el[ this.model.get( 'visible' ) ? 'show' : 'hide' ]();\n            return this;\n        },\n        _onchange: function() {\n            this.value( this.$el.val() );\n            this.model.get( 'onchange' ) && this.model.get( 'onchange' )( this.model.get( 'value' ) );\n        }\n    });\n\n    /** Creates a hidden element input field used e.g. in the tool form */\n    var Hidden = Backbone.View.extend({\n        initialize: function( options ) {\n            this.model = options && options.model || new Backbone.Model( options );\n            this.setElement( $ ( '<div/>' ).append( this.$info = $( '<div/>' ) )\n                                           .append( this.$hidden = $( '<div/>' ) ) );\n            this.listenTo( this.model, 'change', this.render, this );\n            this.render();\n        },\n        value: function( new_val ) {\n            new_val !== undefined && this.model.set( 'value', new_val );\n            return this.model.get( 'value' );\n        },\n        render: function() {\n            this.$el.attr( 'id', this.model.id );\n            this.$hidden.val( this.model.get( 'value' ) );\n            this.model.get( 'info' ) ? this.$info.show().html( this.model.get( 'info' ) ) : this.$info.hide();\n            return this;\n        }\n    });\n\n    return {\n        Button      : Buttons.ButtonDefault,\n        ButtonIcon  : Buttons.ButtonIcon,\n        ButtonCheck : Buttons.ButtonCheck,\n        ButtonMenu  : Buttons.ButtonMenu,\n        ButtonLink  : Buttons.ButtonLink,\n        Input       : Input,\n        Label       : Label,\n        Message     : Message,\n        Modal       : Modal,\n        RadioButton : Options.RadioButton,\n        Checkbox    : Options.Checkbox,\n        Radio       : Options.Radio,\n        Select      : Select,\n        Hidden      : Hidden,\n        Slider      : Slider,\n        Drilldown   : Drilldown\n    }\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/ui-misc.js\n **/","define([], function() {\nvar View = Backbone.View.extend({\n    // defaults\n    optionsDefault  : {\n        container        : 'body',\n        title            : 'ui-modal',\n        cls              : 'ui-modal',\n        body             : '',\n        backdrop         : true,\n        height           : null,\n        width            : null,\n        closing_events   : false,\n        closing_callback : null,\n        title_separator  : true\n    },\n\n    // button list\n    buttonList: {},\n\n    // initialize\n    initialize: function( options ) {\n        this.setElement( this._template() );\n        this.options = _.defaults( options || {}, this.optionsDefault );\n        $( this.options.container ).prepend( this.el );\n\n        // link elements\n        this.$header    = this.$( '.modal-header' );\n        this.$dialog    = this.$( '.modal-dialog' );\n        this.$body      = this.$( '.modal-body' );\n        this.$footer    = this.$( '.modal-footer' );\n        this.$backdrop  = this.$( '.modal-backdrop' );\n        this.$buttons   = this.$( '.buttons' );\n\n        // optional render\n        options && this.render();\n    },\n\n    /**\n     * Displays modal\n    */\n    show: function( options ) {\n        if ( options ) {\n            this.options = _.defaults( options, this.optionsDefault );\n            this.render();\n        }\n        if ( !this.visible ) {\n            this.visible = true;\n            this.$el.fadeIn( 'fast' );\n            if ( this.options.closing_events ) {\n                var self = this;\n                $( document ).on( 'keyup.ui-modal', function( e ) { e.keyCode == 27 && self.hide( true ) });\n                this.$backdrop.on( 'click', function() { self.hide( true ) } );\n            }\n        }\n    },\n\n    /**\n     * Hide modal\n    */\n    hide: function( canceled ) {\n        this.visible = false;\n        this.$el.fadeOut( 'fast' );\n        this.options.closing_callback && this.options.closing_callback( canceled );\n        $( document ).off( 'keyup.ui-modal' );\n        this.$backdrop.off( 'click' );\n    },\n\n    /**\n     * Render modal\n    */\n    render: function() {\n        var self = this;\n        if (this.options.body == 'progress') {\n            this.options.body = $(  '<div class=\"progress progress-striped active\">' +\n                                        '<div class=\"progress-bar progress-bar-info\" style=\"width:100%\"/>' +\n                                    '</div>' );\n        }\n\n        // fix main content\n        this.$el.removeClass().addClass( 'modal' ).addClass( this.options.cls );\n        this.$header.find( '.title' ).html( this.options.title );\n        this.$body.html( this.options.body );\n\n        // append buttons\n        this.$buttons.empty();\n        this.buttonList = {};\n        if ( this.options.buttons ) {\n            var counter = 0;\n            $.each( this.options.buttons, function( name, callback ) {\n                var $button = $( '<button/>' ).attr( 'id', 'button-' + counter++ ).text( name ).click( callback );\n                self.$buttons.append( $button ).append( '&nbsp;' );\n                self.buttonList[ name ] = $button;\n            });\n        } else {\n            this.$footer.hide();\n        }\n\n        // configure background, separator line\n        this.$backdrop[ this.options.backdrop && 'addClass' || 'removeClass' ]( 'in' );\n        this.$header[ !this.options.title_separator && 'addClass' || 'removeClass' ]( 'no-separator' );\n\n        // fix dimensions\n        if ( this.options.height ) {\n            this.$body.css( 'height', this.options.height );\n            this.$body.css( 'overflow', 'hidden' );\n        } else {\n            this.$body.css( 'max-height', $( window ).height() / 2 );\n        }\n        if ( this.options.width ) {\n            this.$dialog.css( 'width', this.options.width );\n        }\n    },\n\n    /**\n     * Returns the button dom\n     * @param{String}   name    - Button name/title\n    */\n    getButton: function( name ) {\n        return this.buttonList[ name ];\n    },\n\n    /**\n     * Enables a button\n     * @param{String}   name    - Button name/title\n    */\n    enableButton: function( name ) {\n        this.getButton( name ).prop( 'disabled', false );\n    },\n\n    /**\n     * Disables a button\n     * @param{String}   name    - Button name/title\n    */\n    disableButton: function( name ) {\n        this.getButton( name ).prop( 'disabled', true );\n    },\n\n    /**\n     * Show a button\n     * @param{String}   name    - Button name/title\n    */\n    showButton: function( name ) {\n        this.getButton( name ).show();\n    },\n\n    /**\n     * Hide a button\n     * @param{String}   name    - Button name/title\n    */\n    hideButton: function( name ) {\n        this.getButton( name ).hide();\n    },\n\n    /**\n     * Returns scroll top for body element\n    */\n    scrollTop: function() {\n        return this.$body.scrollTop();\n    },\n\n    /**\n     * Returns the modal template\n    */\n    _template: function() {\n        return  '<div class=\"ui-modal\">' +\n                    '<div class=\"modal-backdrop fade\"/>' +\n                    '<div class=\"modal-dialog\">' +\n                        '<div class=\"modal-content\">' +\n                            '<div class=\"modal-header\">' +\n                                '<h4 class=\"title\"/>' +\n                            '</div>' +\n                            '<div class=\"modal-body\"/>' +\n                            '<div class=\"modal-footer\">' +\n                                '<div class=\"buttons\"/>' +\n                            '</div>' +\n                        '</div>' +\n                    '</div>' +\n                '</div>';\n    }\n});\n\nreturn {\n    View : View\n}\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/ui-modal.js\n **/","define([ 'utils/utils', 'mvc/ui/ui-misc' ], function( Utils, Ui ) {\nvar View = Backbone.View.extend({\n    visible     : false,\n    initialize  : function( options ) {\n        var self = this;\n        this.model = options && options.model || new Backbone.Model( {\n            id                  : Utils.uid(),\n            cls                 : 'ui-portlet',\n            title               : '',\n            icon                : '',\n            buttons             : null,\n            body                : null,\n            scrollable          : true,\n            nopadding           : false,\n            operations          : null,\n            collapsible         : false,\n            collapsible_button  : false,\n            collapsed           : false\n        } ).set( options );\n        this.setElement( this._template() );\n\n        // link all dom elements\n        this.$body          = this.$( '.portlet-body' );\n        this.$title_text    = this.$( '.portlet-title-text' );\n        this.$title_icon    = this.$( '.portlet-title-icon' );\n        this.$header        = this.$( '.portlet-header' );\n        this.$content       = this.$( '.portlet-content' );\n        this.$footer        = this.$( '.portlet-footer' );\n        this.$backdrop      = this.$( '.portlet-backdrop' );\n        this.$buttons       = this.$( '.portlet-buttons' );\n        this.$operations    = this.$( '.portlet-operations' );\n\n        // add body to component list\n        this.model.get( 'body' ) && this.append( this.model.get( 'body' ) );\n\n        // add icon for collapsible option\n        this.collapsible_button = new Ui.ButtonIcon({\n            icon    : 'fa-eye',\n            tooltip : 'Collapse/Expand',\n            cls     : 'ui-button-icon-plain',\n            onclick : function() { self[ self.collapsed ? 'expand' : 'collapse' ]() }\n        });\n        this.render();\n    },\n\n    render: function() {\n        var self = this;\n        var options = this.model.attributes;\n        this.$el.removeClass().addClass( options.cls ).attr( 'id', options.id );\n        this.$header[ options.title ? 'show' : 'hide' ]();\n        this.$title_text.html( options.title );\n        _.each( [ this.$content, this.$body ], function( $el ) {\n            $el[ options.nopadding ? 'addClass' : 'removeClass' ]( 'no-padding' );\n        });\n\n        // render title icon\n        if ( options.icon ) {\n            this.$title_icon.removeClass().addClass( 'portlet-title-icon fa' ).addClass( options.icon ).show();\n        } else {\n            this.$title_icon.hide();\n        }\n\n        // make portlet collapsible\n        this.$title_text[ options.collapsible ? 'addClass' : 'removeClass' ]( 'no-highlight collapsible' ).off();\n        if ( options.collapsible ) {\n            this.$title_text.on( 'click', function() { self[ self.collapsed ? 'expand' : 'collapse' ]() } );\n            options.collapsed ? this.collapse() : this.expand();\n        }\n\n        // render buttons\n        if ( options.buttons ) {\n            this.$buttons.empty().show();\n            $.each( this.model.get( 'buttons' ), function( name, item ) {\n                item.$el.prop( 'id', name );\n                self.$buttons.append( item.$el );\n            });\n        } else {\n            this.$buttons.hide();\n        }\n\n        // render operations\n        this.$operations.empty;\n        if ( options.collapsible_button ) {\n            this.$operations.append( this.collapsible_button.$el );\n        }\n        if ( options.operations ) {\n            $.each( options.operations, function( name, item ) {\n                item.$el.prop( 'id', name );\n                self.$operations.append( item.$el );\n            });\n        }\n        return this;\n    },\n\n    /** Append new doms to body */\n    append: function( $el ) {\n        this.$body.append( $el );\n    },\n\n    /** Remove all content */\n    empty: function() {\n        this.$body.empty();\n    },\n\n    /** Return header element */\n    header: function() {\n        return this.$header;\n    },\n\n    /** Return body element */\n    body: function() {\n        return this.$body;\n    },\n\n    /** Return footer element */\n    footer: function() {\n        return this.$footer;\n    },\n\n    /** Show portlet */\n    show: function(){\n        this.visible = true;\n        this.$el.fadeIn( 'fast' );\n    },\n\n    /** Hide portlet */\n    hide: function(){\n        this.visible = false;\n        this.$el.fadeOut( 'fast' );\n    },\n\n    /** Enable a particular button */\n    enableButton: function( id ) {\n        this.$buttons.find( '#' + id ).prop( 'disabled', false );\n    },\n\n    /** Disable a particular button */\n    disableButton: function( id ) {\n        this.$buttons.find( '#' + id ).prop( 'disabled', true );\n    },\n\n    /** Hide a particular operation */\n    hideOperation: function( id ) {\n        this.$operations.find( '#' + id ).hide();\n    },\n\n    /** Show a particular operation */\n    showOperation: function( id ) {\n        this.$operations.find( '#' + id ).show();\n    },\n\n    /** Replaces the event callback of an existing operation */\n    setOperation: function( id, callback ) {\n        this.$operations.find( '#' + id ).off( 'click' ).on( 'click', callback );\n    },\n\n    /** Change title */\n    title: function( new_title ) {\n        new_title && this.$title_text.html( new_title );\n        return this.$title_text.html();\n    },\n\n    /** Collapse portlet */\n    collapse: function() {\n        this.collapsed = true;\n        this.$content.height( '0%' );\n        this.$body.hide();\n        this.$footer.hide();\n        this.collapsible_button.setIcon( 'fa-eye-slash' );\n    },\n\n    /** Expand portlet */\n    expand: function() {\n        this.collapsed = false;\n        this.$content.height( '100%' );\n        this.$body.fadeIn( 'fast' );\n        this.$footer.fadeIn( 'fast' );\n        this.collapsible_button.setIcon( 'fa-eye' );\n    },\n\n    /** Disable content access */\n    disable: function() {\n        this.$backdrop.show();\n    },\n\n    /** Enable content access */\n    enable: function() {\n        this.$backdrop.hide();\n    },\n\n    _template: function() {\n        return $( '<div/>' ).append( $( '<div/>' ).addClass( 'portlet-header' )\n                                .append( $( '<div/>' ).addClass( 'portlet-operations' ) )\n                                .append( $( '<div/>' ).addClass( 'portlet-title' )\n                                    .append( $( '<i/>' ).addClass( 'portlet-title-icon' ) )\n                                    .append( $( '<span/>' ).addClass( 'portlet-title-text' ) ) ) )\n                            .append( $( '<div/>' ).addClass( 'portlet-content' )\n                                .append( $( '<div/>' ).addClass( 'portlet-body' ) )\n                                .append( $( '<div/>' ).addClass( 'portlet-buttons' ) ) )\n                            .append( $( '<div/>' ).addClass( 'portlet-footer' ) )\n                            .append( $( '<div/>' ).addClass( 'portlet-backdrop' ) );\n    }\n});\nreturn {\n    View : View\n}\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/ui-portlet.js\n **/","// Additional dependencies: jQuery, underscore.\ndefine(['mvc/ui/ui-modal', 'mvc/ui/ui-frames', 'mvc/ui/icon-button'], function(Modal, Frames, mod_icon_btn) {\n\n/**\n * Dataset metedata.\n */\nvar DatasetMetadata = Backbone.Model.extend({});\n\n/**\n * A dataset. In Galaxy, datasets are associated with a history, so\n * this object is also known as a HistoryDatasetAssociation.\n */\nvar Dataset = Backbone.Model.extend({\n    defaults: {\n        id: '',\n        type: '',\n        name: '',\n        hda_ldda: 'hda',\n        metadata: null\n    },\n\n    initialize: function() {\n        // Metadata can be passed in as a model or a set of attributes; if it's\n        // already a model, there's no need to set metadata.\n        if (!this.get('metadata')) {\n            this._set_metadata();\n        }\n\n        // Update metadata on change.\n        this.on('change', this._set_metadata, this);\n    },\n\n    _set_metadata: function() {\n        var metadata = new DatasetMetadata();\n\n        // Move metadata from dataset attributes to metadata object.\n        _.each(_.keys(this.attributes), function(k) {\n            if (k.indexOf('metadata_') === 0) {\n                // Found metadata.\n                var new_key = k.split('metadata_')[1];\n                metadata.set(new_key, this.attributes[k]);\n                delete this.attributes[k];\n            }\n        }, this);\n\n        // Because this is an internal change, silence it.\n        this.set('metadata', metadata, { 'silent': true });\n    },\n\n    /**\n     * Returns dataset metadata for a given attribute.\n     */\n    get_metadata: function(attribute) {\n        return this.attributes.metadata.get(attribute);\n    },\n\n    urlRoot: Galaxy.root + \"api/datasets\"\n});\n\n/**\n * A tabular dataset. This object extends dataset to provide incremental chunked data.\n */\nvar TabularDataset = Dataset.extend({\n    defaults: _.extend({}, Dataset.prototype.defaults, {\n        chunk_url: null,\n        first_data_chunk: null,\n        offset: 0,\n        at_eof: false\n    }),\n\n    initialize: function(options) {\n        Dataset.prototype.initialize.call(this);\n\n        // If first data chunk is available, next chunk is 1.\n        if (this.attributes.first_data_chunk){\n            this.attributes.offset = this.attributes.first_data_chunk.offset;\n        }\n        this.attributes.chunk_url = Galaxy.root + 'dataset/display?dataset_id=' + this.id;\n        this.attributes.url_viz = Galaxy.root + 'visualization';\n    },\n\n    /**\n     * Returns a jQuery Deferred object that resolves to the next data chunk or null if at EOF.\n     */\n    get_next_chunk: function() {\n        // If already at end of file, do nothing.\n        if (this.attributes.at_eof) {\n            return null;\n        }\n\n        // Get next chunk.\n        var self = this,\n            next_chunk = $.Deferred();\n        $.getJSON(this.attributes.chunk_url, {\n            offset: self.attributes.offset\n        }).success(function(chunk) {\n            var rval;\n            if (chunk.ck_data !== '') {\n                // Found chunk.\n                rval = chunk;\n                self.attributes.offset = chunk.offset;\n            }\n            else {\n                // At EOF.\n                self.attributes.at_eof = true;\n                rval = null;\n            }\n            next_chunk.resolve(rval);\n        });\n\n        return next_chunk;\n    }\n});\n\nvar DatasetCollection = Backbone.Collection.extend({\n    model: Dataset\n});\n\n/**\n * Provides a base for table-based, dynamic view of a tabular dataset.\n * Do not instantiate directly; use either TopLevelTabularDatasetChunkedView\n * or EmbeddedTabularDatasetChunkedView.\n */\nvar TabularDatasetChunkedView = Backbone.View.extend({\n\n    /**\n     * Initialize view and, importantly, set a scroll element.\n     */\n    initialize: function(options) {\n        // Row count for rendering.\n        this.row_count = 0;\n        this.loading_chunk = false;\n\n        // load trackster button\n        new TabularButtonTracksterView({\n            model   : options.model,\n            $el     : this.$el\n        });\n    },\n\n    expand_to_container: function(){\n        if (this.$el.height() < this.scroll_elt.height()){\n            this.attempt_to_fetch();\n        }\n    },\n\n    attempt_to_fetch: function( func ){\n        var self = this;\n        if ( !this.loading_chunk && this.scrolled_to_bottom() ) {\n            this.loading_chunk = true;\n            this.loading_indicator.show();\n            $.when(self.model.get_next_chunk()).then(function(result) {\n                if (result) {\n                    self._renderChunk(result);\n                    self.loading_chunk = false;\n                }\n                self.loading_indicator.hide();\n                self.expand_to_container();\n            });\n        }\n    },\n\n    render: function() {\n        // Add loading indicator.\n        this.loading_indicator = $('<div/>').attr('id', 'loading_indicator');\n        this.$el.append(this.loading_indicator);\n\n        // Add data table and header.\n        var data_table = $('<table/>').attr({\n            id: 'content_table',\n            cellpadding: 0\n        });\n        this.$el.append(data_table);\n        var column_names = this.model.get_metadata('column_names'),\n            header_container = $('<thead/>').appendTo(data_table),\n            header_row = $('<tr/>').appendTo(header_container);\n        if (column_names) {\n            header_row.append('<th>' + column_names.join('</th><th>') + '</th>');\n        } else {\n            for (var j = 1; j <= this.model.get_metadata('columns'); j++) {\n                header_row.append('<th>' + j + '</th>');\n            }\n        }\n\n        // Render first chunk.\n        var self = this,\n            first_chunk = this.model.get('first_data_chunk');\n        if (first_chunk) {\n            // First chunk is bootstrapped, so render now.\n            this._renderChunk(first_chunk);\n        }\n        else {\n            // No bootstrapping, so get first chunk and then render.\n            $.when(self.model.get_next_chunk()).then(function(result) {\n                self._renderChunk(result);\n            });\n        }\n\n        // -- Show new chunks during scrolling. --\n\n        // Set up chunk loading when scrolling using the scrolling element.\n        this.scroll_elt.scroll(function(){\n            self.attempt_to_fetch();\n        });\n    },\n\n    /**\n     * Returns true if user has scrolled to the bottom of the view.\n     */\n    scrolled_to_bottom: function() {\n        return false;\n    },\n\n    // -- Helper functions. --\n\n    _renderCell: function(cell_contents, index, colspan) {\n        var $cell = $('<td>').text(cell_contents);\n        var column_types = this.model.get_metadata('column_types');\n        if (colspan !== undefined) {\n            $cell.attr('colspan', colspan).addClass('stringalign');\n        } else if (column_types) {\n            if (index < column_types.length) {\n                if (column_types[index] === 'str' || column_types[index] === 'list') {\n                    /* Left align all str columns, right align the rest */\n                    $cell.addClass('stringalign');\n                }\n            }\n        }\n        return $cell;\n    },\n\n    _renderRow: function(line) {\n        // Check length of cells to ensure this is a complete row.\n        var cells = line.split('\\t'),\n            row = $('<tr>'),\n            num_columns = this.model.get_metadata('columns');\n\n        if (this.row_count % 2 !== 0) {\n            row.addClass('dark_row');\n        }\n\n        if (cells.length === num_columns) {\n            _.each(cells, function(cell_contents, index) {\n                row.append(this._renderCell(cell_contents, index));\n            }, this);\n        }\n        else if (cells.length > num_columns) {\n            // SAM file or like format with optional metadata included.\n            _.each(cells.slice(0, num_columns - 1), function(cell_contents, index) {\n                row.append(this._renderCell(cell_contents, index));\n            }, this);\n            row.append(this._renderCell(cells.slice(num_columns - 1).join('\\t'), num_columns - 1));\n        }\n        else if (num_columns > 5 && cells.length === num_columns - 1 ) {\n            // SAM file or like format with optional metadata missing.\n            _.each(cells, function(cell_contents, index) {\n                row.append(this._renderCell(cell_contents, index));\n            }, this);\n            row.append($('<td>'));\n        }\n        else {\n            // Comment line, just return the one cell.\n            row.append(this._renderCell(line, 0, num_columns));\n        }\n\n        this.row_count++;\n        return row;\n    },\n\n    _renderChunk: function(chunk) {\n        var data_table = this.$el.find('table');\n        _.each(chunk.ck_data.split('\\n'), function(line, index) {\n            if (line !== ''){\n                data_table.append(this._renderRow(line));\n            }\n        }, this);\n    }\n});\n\n/**\n * Tabular view that is placed at the top level of page. Scrolling occurs\n * view top-level elements outside of view.\n */\nvar TopLevelTabularDatasetChunkedView = TabularDatasetChunkedView.extend({\n\n    initialize: function(options) {\n        TabularDatasetChunkedView.prototype.initialize.call(this, options);\n\n        // Scrolling happens in top-level elements.\n        scroll_elt = _.find(this.$el.parents(), function(p) {\n            return $(p).css('overflow') === 'auto';\n        });\n\n        // If no scrolling element found, use window.\n        if (!scroll_elt) { scroll_elt = window; }\n\n        // Wrap scrolling element for easy access.\n        this.scroll_elt = $(scroll_elt);\n    },\n\n    /**\n     * Returns true if user has scrolled to the bottom of the view.\n     */\n    scrolled_to_bottom: function() {\n        return (this.$el.height() - this.scroll_elt.scrollTop() - this.scroll_elt.height() <= 0);\n    }\n\n});\n\n/**\n * Tabular view tnat is embedded in a page. Scrolling occurs in view's el.\n */\nvar EmbeddedTabularDatasetChunkedView = TabularDatasetChunkedView.extend({\n\n    initialize: function(options) {\n        TabularDatasetChunkedView.prototype.initialize.call(this, options);\n\n        // Because view is embedded, set up div to do scrolling.\n        this.scroll_elt = this.$el.css({\n            position: 'relative',\n            overflow: 'scroll',\n            height: options.height || '500px'\n        });\n    },\n\n    /**\n     * Returns true if user has scrolled to the bottom of the view.\n     */\n    scrolled_to_bottom: function() {\n        return this.$el.scrollTop() + this.$el.innerHeight() >= this.el.scrollHeight;\n    }\n\n});\n\n// button for trackster visualization\nvar TabularButtonTracksterView = Backbone.View.extend({\n\n    // gene region columns\n    col: {\n        chrom   : null,\n        start   : null,\n        end     : null\n    },\n\n    // url for trackster\n    url_viz     : null,\n\n    // dataset id\n    dataset_id  : null,\n\n    // database key\n    genome_build: null,\n\n    // data type\n    file_ext   : null,\n\n    // backbone initialize\n    initialize: function (options) {\n        // check if environment is available\n        var Galaxy = parent.Galaxy;\n\n        // link galaxy modal or create one\n        if (Galaxy && Galaxy.modal) {\n            this.modal = Galaxy.modal;\n        }\n\n        // link galaxy frames\n        if (Galaxy && Galaxy.frame) {\n            this.frame = Galaxy.frame;\n        }\n\n        // check\n        if (!this.modal || !this.frame) {\n            return;\n        }\n\n        // model/metadata\n        var model       = options.model;\n        var metadata    = model.get('metadata');\n\n        // check for datatype\n        if (!model.get('file_ext')) {\n            return;\n        }\n\n        // get data type\n        this.file_ext = model.get('file_ext');\n\n        // check for bed-file format\n        if (this.file_ext == 'bed')\n        {\n            // verify that metadata exists\n            if (metadata.get('chromCol') && metadata.get('startCol') && metadata.get('endCol'))\n            {\n                // read in columns\n                this.col.chrom   = metadata.get('chromCol') - 1;\n                this.col.start   = metadata.get('startCol') - 1;\n                this.col.end     = metadata.get('endCol') - 1;\n            } else {\n                console.log('TabularButtonTrackster : Bed-file metadata incomplete.');\n                return;\n            }\n        }\n\n        // check for vcf-file format\n        if (this.file_ext == 'vcf')\n        {\n            // search array\n            function search (str, array) {\n                for (var j = 0; j < array.length; j++)\n                    if (array[j].match(str)) return j;\n                return -1;\n            };\n\n            // load\n            this.col.chrom = search('Chrom', metadata.get('column_names'));\n            this.col.start = search('Pos', metadata.get('column_names'));\n            this.col.end   = null;\n\n            // verify that metadata exists\n            if (this.col.chrom == -1 || this.col.start == -1) {\n                console.log('TabularButtonTrackster : VCF-file metadata incomplete.');\n                return;\n            }\n        }\n\n        // check\n        if(this.col.chrom === undefined) {\n            return;\n        }\n\n        // get dataset id\n        if (model.id) {\n            this.dataset_id = model.id;\n        } else {\n            console.log('TabularButtonTrackster : Dataset identification is missing.');\n            return;\n        }\n\n        // get url\n        if (model.get('url_viz')) {\n            this.url_viz = model.get('url_viz');\n        } else {\n            console.log('TabularButtonTrackster : Url for visualization controller is missing.');\n            return;\n        }\n\n        // get genome_build / database key\n        if (model.get('genome_build')) {\n            this.genome_build = model.get('genome_build');\n        }\n\n        // create the icon\n        var btn_viz = new mod_icon_btn.IconButtonView({\n            model : new mod_icon_btn.IconButton({\n                title       : 'Visualize',\n                icon_class  : 'chart_curve',\n                id          : 'btn_viz'\n            })\n        });\n\n        // set element\n        this.setElement(options.$el);\n\n        // add to element\n        this.$el.append(btn_viz.render().$el);\n\n        // hide the button\n        this.hide();\n    },\n\n    // backbone events\n    events:\n    {\n        'mouseover tr'  : 'show',\n        'mouseleave'    : 'hide'\n    },\n\n    // show button\n    show: function (e) {\n        // is numeric\n        function is_numeric(n) {\n            return !isNaN(parseFloat(n)) && isFinite(n);\n        };\n\n        // check\n        if(this.col.chrom === null)\n            return;\n\n        // get selected data line\n        var row = $(e.target).parent();\n\n        // verify that location has been found\n        var chrom = row.children().eq(this.col.chrom).html();\n        var start = row.children().eq(this.col.start).html();\n\n        // end is optional\n        var end = this.col.end ? row.children().eq(this.col.end).html() : start;\n\n        // double check location\n        if (!chrom.match(\"^#\") && chrom !== \"\" && is_numeric(start)) {\n\n            // get target gene region\n            var btn_viz_pars = {\n                dataset_id  : this.dataset_id,\n                gene_region : chrom + \":\" + start + \"-\" + end\n            };\n\n            // get button position\n            var offset  = row.offset();\n            var left    = offset.left - 10;\n            var top     = offset.top - $(window).scrollTop() + 3;\n\n            // update css\n            $('#btn_viz').css({'position': 'fixed', 'top': top + 'px', 'left': left + 'px'});\n            $('#btn_viz').off('click');\n            $('#btn_viz').click(this.create_trackster_action(this.url_viz, btn_viz_pars, this.genome_build));\n\n            // show the button\n            $('#btn_viz').show();\n        } else {\n            // hide the button\n            $('#btn_viz').hide();\n        }\n    },\n\n    // hide button\n    hide: function () {\n        this.$el.find('#btn_viz').hide();\n    },\n\n    // create action\n    create_trackster_action : function (vis_url, dataset_params, dbkey) {\n        // link this\n        var self = this;\n\n        // create function\n        return function() {\n            var listTracksParams = {};\n            if (dbkey) {\n                listTracksParams[ 'f-dbkey' ] = dbkey;\n            }\n            $.ajax({\n                url: vis_url + '/list_tracks?' + $.param( listTracksParams ),\n                dataType: 'html',\n                error: function() {\n                    // show error message\n                    self.modal.show({\n                        title   : 'Something went wrong!',\n                        body    : 'Unfortunately we could not add this dataset to the track browser. Please try again or contact us.',\n                        buttons : {\n                            'Cancel': function(){\n                                self.modal.hide();\n                            }\n                        }\n                    });\n                },\n                success: function(table_html) {\n                    self.modal.show({\n                        title   : 'View Data in a New or Saved Visualization',\n                        buttons :{\n                            'Cancel': function(){\n                                self.modal.hide();\n                            },\n                            'View in saved visualization': function(){\n                                // show modal with saved visualizations\n                                self.modal.show(\n                                {\n                                    title   : 'Add Data to Saved Visualization',\n                                    body    : table_html,\n                                    buttons : {\n                                        'Cancel': function(){\n                                            self.modal.hide();\n                                        },\n                                        'Add to visualization': function(){\n                                            // hide\n                                            self.modal.hide();\n\n                                            // search selected fields\n                                            self.modal.$el.find('input[name=id]:checked').each(function(){\n                                                // get visualization id\n                                                var vis_id = $(this).val();\n                                                dataset_params.id = vis_id;\n\n                                                // add widget\n                                                self.frame.add({\n                                                    title    : 'Trackster',\n                                                    type     : 'url',\n                                                    content  : vis_url + '/trackster?' + $.param(dataset_params)\n                                                });\n                                            });\n                                        }\n                                    }\n                                });\n                            },\n                            'View in new visualization': function(){\n                                // hide\n                                self.modal.hide();\n\n                                // add widget\n                                self.frame.add({\n                                    title    : 'Trackster',\n                                    type     : 'url',\n                                    content  : vis_url + '/trackster?' + $.param(dataset_params)\n                                });\n                            }\n                        }\n                    });\n                }\n            });\n            return false;\n        };\n    }\n});\n\n// -- Utility functions. --\n\n/**\n * Create a model, attach it to a view, render view, and attach it to a parent element.\n */\nvar createModelAndView = function(model, view, model_config, parent_elt) {\n    // Create model, view.\n    var a_view = new view({\n        model: new model(model_config)\n    });\n\n    // Render view and add to parent element.\n    a_view.render();\n    if (parent_elt) {\n        parent_elt.append(a_view.$el);\n    }\n\n    return a_view;\n};\n\n/**\n * Create a tabular dataset chunked view (and requisite tabular dataset model)\n * and appends to parent_elt.\n */\nvar createTabularDatasetChunkedView = function(options) {\n    // If no model, create and set model from dataset config.\n    if (!options.model) {\n        options.model = new TabularDataset(options.dataset_config);\n    }\n\n    var parent_elt = options.parent_elt;\n    var embedded = options.embedded;\n\n    // Clean up options so that only needed options are passed to view.\n    delete options.embedded;\n    delete options.parent_elt;\n    delete options.dataset_config;\n\n    // Create and set up view.\n    var view = (embedded ? new EmbeddedTabularDatasetChunkedView(options) :\n                           new TopLevelTabularDatasetChunkedView(options));\n    view.render();\n\n    if (parent_elt) {\n        parent_elt.append(view.$el);\n        // If we're sticking this in another element, once it's appended check\n        // to make sure we've filled enough space.\n        // Without this, the scroll elements don't work.\n        view.expand_to_container();\n    }\n\n    return view;\n};\n\nreturn {\n    Dataset: Dataset,\n    TabularDataset: TabularDataset,\n    DatasetCollection: DatasetCollection,\n    TabularDatasetChunkedView: TabularDatasetChunkedView,\n    createTabularDatasetChunkedView: createTabularDatasetChunkedView\n};\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/dataset/data.js\n **/","define([\n], function(){\n\n'use strict';\n//==============================================================================\n/** Map of possible HDA/collection/job states to their string equivalents.\n *      A port of galaxy.model.Dataset.states.\n */\nvar STATES = {\n    // NOT ready states\n    /** is uploading and not ready */\n    UPLOAD              : 'upload',\n    /** the job that will produce the dataset queued in the runner */\n    QUEUED              : 'queued',\n    /** the job that will produce the dataset is running */\n    RUNNING             : 'running',\n    /** metadata for the dataset is being discovered/set */\n    SETTING_METADATA    : 'setting_metadata',\n\n    // ready states\n    /** was created without a tool */\n    NEW                 : 'new',\n    /** has no data */\n    EMPTY               : 'empty',\n    /** has successfully completed running */\n    OK                  : 'ok',\n\n    /** the job that will produce the dataset paused */\n    PAUSED              : 'paused',\n    /** metadata discovery/setting failed or errored (but otherwise ok) */\n    FAILED_METADATA     : 'failed_metadata',\n//TODO: not in trans.app.model.Dataset.states - is in database\n    /** not accessible to the current user (i.e. due to permissions) */\n    NOT_VIEWABLE        : 'noPermission',\n    /** deleted while uploading */\n    DISCARDED           : 'discarded',\n    /** the tool producing this dataset failed */\n    ERROR               : 'error'\n};\n\nSTATES.READY_STATES = [\n    STATES.OK,\n    STATES.EMPTY,\n    STATES.PAUSED,\n    STATES.FAILED_METADATA,\n    STATES.NOT_VIEWABLE,\n    STATES.DISCARDED,\n    STATES.ERROR\n];\n\nSTATES.NOT_READY_STATES = [\n    STATES.UPLOAD,\n    STATES.QUEUED,\n    STATES.RUNNING,\n    STATES.SETTING_METADATA,\n    STATES.NEW\n];\n\n\n//==============================================================================\n    return STATES;\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/dataset/states.js\n **/","/** This class contains all button views.\n*/\ndefine(['utils/utils'], function( Utils ) {\n    /** This renders the default button which is used e.g. at the bottom of the upload modal.\n    */\n    var ButtonBase = Backbone.View.extend({\n        initialize: function( options ) {\n            this.options = Utils.merge( options, {\n                id          : Utils.uid(),\n                title       : '',\n                floating    : 'right',\n                icon        : '',\n                cls         : 'ui-button btn btn-default',\n                cls_wait    : 'btn btn-info'\n            } );\n            this.setElement( this._template( this.options ) );\n            var self = this;\n            $( this.el ).on( 'click' , function() {\n                $( '.tooltip' ).hide();\n                if ( options.onclick && !self.disabled ) {\n                    options.onclick();\n                }\n            } );\n            $( this.el ).tooltip( { title: options.tooltip, placement: 'bottom' } );\n        },\n\n        // disable\n        disable: function() {\n            this.$el.addClass( 'disabled' );\n            this.disabled = true;\n        },\n\n        // enable\n        enable: function() {\n            this.$el.removeClass( 'disabled' );\n            this.disabled = false;\n        },\n\n        // show spinner\n        wait: function() {\n            this.$el.removeClass( this.options.cls ).addClass( this.options.cls_wait ).prop( 'disabled', true );\n            this.$( '.icon' ).removeClass( this.options.icon ).addClass( 'fa-spinner fa-spin' );\n            this.$( '.title' ).html( 'Sending...' );\n        },\n\n        // hide spinner\n        unwait: function() {\n            this.$el.removeClass( this.options.cls_wait ).addClass( this.options.cls ).prop( 'disabled', false );\n            this.$( '.icon' ).removeClass( 'fa-spinner fa-spin' ).addClass( this.options.icon );\n            this.$( '.title' ).html( this.options.title );\n        },\n\n        // template\n        _template: function( options ) {\n            var str =   '<button id=\"' + options.id + '\" type=\"submit\" style=\"float: ' + options.floating + ';\" type=\"button\" class=\"' + options.cls + '\">';\n            if (options.icon) {\n                str +=      '<i class=\"icon fa ' + options.icon + '\"/>&nbsp;';\n            }\n            str +=          '<span class=\"title\">' + options.title + '</span>' +\n                        '</button>';\n            return str;\n        }\n    });\n\n    /** This button allows the right-click/open-in-new-tab feature, its used e.g. for panel buttons.\n    */\n    var ButtonLink = ButtonBase.extend({\n        initialize: function( options ) {\n            ButtonBase.prototype.initialize.call( this, options );\n        },\n        _template: function( options ) {\n            return  '<a id=\"' + options.id + '\" class=\"' + options.cls + '\" href=\"' + ( options.href || 'javascript:void(0)' ) + '\"' +\n                        ' title=\"' + options.title + '\" target=\"' + ( options.target || '_top' ) + '\">' + '<span class=\"' + options.icon + '\"/>' +\n                    '</a>';\n        }\n    });\n\n    /** The check button is used in the tool form and allows to distinguish between multiple states e.g. all, partially and nothing selected.\n    */\n    var ButtonCheck = Backbone.View.extend({\n        initialize: function( options ) {\n            // configure options\n            this.options = Utils.merge(options, {\n                title : 'Select/Unselect all',\n                icons : ['fa fa-square-o', 'fa fa-minus-square-o', 'fa fa-check-square-o'],\n                value : 0\n            });\n\n            // create new element\n            this.setElement( this._template() );\n            this.$title = this.$( '.title' );\n            this.$icon  = this.$( '.icon' );\n\n            // set initial value\n            this.value( this.options.value );\n\n            // set title\n            this.$title.html( this.options.title );\n\n            // add event handler\n            var self = this;\n            this.$el.on('click', function() {\n                self.current = ( self.current === 0 && 2 ) || 0;\n                self.value( self.current );\n                self.options.onclick && self.options.onclick();\n            });\n        },\n\n        /* Sets a new value and/or returns the current value.\n        * @param{Integer}   new_val - Set a new value 0=unchecked, 1=partial and 2=checked.\n        * OR:\n        * @param{Integer}   new_val - Number of selected options.\n        * @param{Integer}   total   - Total number of available options.\n        */\n        value: function ( new_val, total ) {\n            if ( new_val !== undefined ) {\n                if ( total ) {\n                    if ( new_val !== 0 ) {\n                        new_val = ( new_val !== total ) && 1 || 2;\n                    }\n                }\n                this.current = new_val;\n                this.$icon.removeClass()\n                          .addClass( 'icon' )\n                          .addClass( this.options.icons[ new_val ] );\n                this.options.onchange && this.options.onchange( new_val );\n            }\n            return this.current;\n        },\n\n        /** Template containing the check button and the title\n        */\n        _template: function() {\n            return  '<div class=\"ui-button-check\" >' +\n                        '<span class=\"icon\"/>' +\n                        '<span class=\"title\"/>' +\n                    '</div>';\n        }\n    });\n\n    /** This renders a differently styled, more compact button version.\n        TODO: Consolidate with icon-button.js and/or button-default.js.\n    */\n    var ButtonIcon = Backbone.View.extend({\n        initialize : function( options ) {\n            // get options\n            this.options = Utils.merge( options, {\n                id          : Utils.uid(),\n                title       : '',\n                floating    : 'right',\n                cls         : 'ui-button-icon',\n                icon        : '',\n                tooltip     : '',\n                onclick     : null\n            });\n\n            // create new element\n            this.setElement( this._template( this.options ) );\n\n            // link button element\n            this.$button = this.$el.find( '.button' );\n\n            // add event\n            var self = this;\n            $(this.el).on('click', function() {\n                // hide all tooltips\n                $( '.tooltip' ).hide();\n\n                // execute onclick callback\n                if ( options.onclick && !self.disabled ) {\n                    options.onclick();\n                }\n            });\n\n            // add tooltip\n            this.$button.tooltip( { title: options.tooltip, placement: 'bottom' } );\n        },\n\n        // disable\n        disable: function() {\n            this.$button.addClass( 'disabled' );\n            this.disabled = true;\n        },\n\n        // enable\n        enable: function() {\n            this.$button.removeClass( 'disabled' );\n            this.disabled = false;\n        },\n\n        // change icon\n        setIcon: function(icon_cls) {\n            this.$('i').removeClass( this.options.icon ).addClass( icon_cls );\n            this.options.icon = icon_cls;\n        },\n\n        // template\n        _template: function( options ) {\n            // width\n            var width = '';\n            if ( options.title ) {\n                width = 'width: auto;';\n            }\n\n            // string\n            var str =   '<div id=\"' + options.id + '\" style=\"float: ' + options.floating + '; ' + width + '\" class=\"' + options.cls + '\">' +\n                            '<div class=\"button\">';\n            if (options.title) {\n                str +=          '<i class=\"icon fa ' + options.icon + '\"/>&nbsp;' +\n                                '<span class=\"title\">' + options.title + '</span>';\n            } else {\n                str +=          '<i class=\"icon fa ' + options.icon + '\"/>';\n            }\n            str +=          '</div>' +\n                        '</div>';\n            return str;\n        }\n    });\n\n    /** This class creates a button with dropdown menu. It extends the functionality of the Ui.ButtonIcon class.\n        TODO: Consolidate class, use common base class\n    */\n    var ButtonMenu = Backbone.View.extend({\n        // optional sub menu\n        $menu: null,\n\n        // initialize\n        initialize: function ( options ) {\n            // get options\n            this.options = Utils.merge( options, {\n                // same as Ui.ButtonIcon\n                id              : '',\n                title           : '',\n                floating        : 'right',\n                pull            : 'right',\n                icon            : null,\n                onclick         : null,\n                cls             : 'ui-button-icon ui-button-menu',\n                tooltip         : '',\n                \n                // additional options\n                target          : '',\n                href            : '',\n                onunload        : null,\n                visible         : true,\n                tag             : ''\n            } );\n\n            // add template for tab\n            this.setElement( $( this._template( this.options ) ) );\n\n            // find root\n            var $root = $( this.el ).find( '.root' );\n\n            // link head\n            var self = this;\n            $root.on( 'click', function( e ) {\n                // hide all tooltips\n                $( '.tooltip' ).hide();\n\n                // prevent default\n                e.preventDefault();\n\n                // add click event\n                if( self.options.onclick ) {\n                    self.options.onclick();\n                }\n            });\n\n            // visiblity\n            if ( !this.options.visible )\n                this.hide();\n\n            // add tooltip\n            $root.tooltip( { title: options.tooltip, placement: 'bottom' } );\n        },\n\n        // show\n        show: function() {\n            $( this.el ).show();\n        },\n\n        // hide\n        hide: function() {\n            $( this.el ).hide();\n        },\n\n        // add menu item\n        addMenu: function ( options ) {\n            // menu option defaults\n            var menuOptions = {\n                title       : '',\n                target      : '',\n                href        : '',\n                onclick     : null,\n                divider     : false,\n                icon        : null,\n                cls         : 'button-menu btn-group'\n            }\n\n            // get options\n            menuOptions = Utils.merge( options, menuOptions );\n\n            // check if submenu element is available\n            if ( !this.$menu ) {\n                // insert submenu element into root\n                $( this.el ).append( this._templateMenu() );\n\n                // update element link\n                this.$menu = $( this.el ).find( '.menu' );\n            }\n\n            // create\n            var $item = $( this._templateMenuItem( menuOptions ) );\n\n            // add events\n            $item.on( 'click', function( e ) {\n                if( menuOptions.onclick ) {\n                    e.preventDefault();\n                    menuOptions.onclick();\n                }\n            });\n\n            // append menu\n            this.$menu.append( $item );\n\n            // append divider\n            if ( menuOptions.divider ) {\n                this.$menu.append( $( this._templateDivider() ) );\n            }\n        },\n\n        // fill template header\n        _templateMenuItem: function ( options ) {\n            var tmpl =  '<li>' +\n                            '<a class=\"dropdown-item\" href=\"' + options.href + '\" target=\"' + options.target + '\" ';\n            if ( options.download ) {\n                tmpl +=         'download=\"' + options.download + '\"';\n            }\n            tmpl +=         '>';\n            if ( options.icon ) {\n                tmpl +=         '<i class=\"fa ' + options.icon + '\"/>';\n            }\n            tmpl +=             ' ' + options.title +\n                            '</a>' +\n                        '</li>';\n            return tmpl;\n        },\n\n        // fill template header\n        _templateMenu: function () {\n            return '<ul class=\"menu dropdown-menu pull-' + this.options.pull + '\" role=\"menu\"/>';\n        },\n\n        _templateDivider: function() {\n            return '<li class=\"divider\"/>';\n        },\n\n        // element\n        _template: function(options) {\n            // TODO: width/margin should be set in css\n            var width = '';\n            var margin = '';\n            if ( options.title ) {\n                width = 'width: auto;';\n            } else {\n                margin = 'margin: 0px;';\n            }\n            var str =   '<div id=\"' + options.id + '\" style=\"float: ' + options.floating + '; ' + width + '\" class=\"dropdown ' + options.cls + '\">' +\n                            '<div class=\"root button dropdown-toggle\" data-toggle=\"dropdown\" style=\"' + margin + '\">' +\n                                '<i class=\"icon fa ' + options.icon + '\"/>';\n            if ( options.title ) {\n                str +=          '&nbsp;<span class=\"title\">' + options.title + '</span>';\n            }\n            str +=          '</div>' +\n                        '</div>';\n            return str;\n        }\n    });\n\n    return {\n        ButtonDefault   : ButtonBase,\n        ButtonLink      : ButtonLink,\n        ButtonIcon      : ButtonIcon,\n        ButtonCheck     : ButtonCheck,\n        ButtonMenu      : ButtonMenu\n    }\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/ui-buttons.js\n **/","// dependencies\ndefine(['utils/utils'], function(Utils) {\n\n/**\n *  This class creates a ui table element.\n */\nvar View = Backbone.View.extend({\n    // current row\n    row: null,\n    \n    // count rows\n    row_count: 0,\n    \n    // defaults options\n    optionsDefault: {\n        content     : 'No content available.',\n        onchange    : null,\n        ondblclick  : null,\n        onconfirm   : null,\n        cls         : 'ui-table',\n        cls_tr      : ''\n    },\n    \n    // events\n    events : {\n        'click'     : '_onclick',\n        'dblclick'  : '_ondblclick'\n    },\n    \n    // initialize\n    initialize : function(options) {\n        // configure options\n        this.options = Utils.merge(options, this.optionsDefault);\n        \n        // create new element\n        var $el = $(this._template(this.options));\n        \n        // link sub-elements\n        this.$thead = $el.find('thead');\n        this.$tbody = $el.find('tbody');\n        this.$tmessage = $el.find('tmessage');\n        \n        // set element\n        this.setElement($el);\n                \n        // initialize row\n        this.row = this._row();\n    },\n    \n    // add header cell\n    addHeader: function($el) {\n        var wrapper = $('<th></th>');\n        wrapper.append($el);\n        this.row.append(wrapper);\n    },\n    \n    // header\n    appendHeader: function() {\n        // append header row\n        this.$thead.append(this.row);\n\n        // row\n        this.row = $('<tr></tr>');\n    },\n    \n    // add row cell\n    add: function($el, width, align) {\n        var wrapper = $('<td></td>');\n        if (width) {\n            wrapper.css('width', width);\n        }\n        if (align) {\n            wrapper.css('text-align', align);\n        }\n        wrapper.append($el);\n        this.row.append(wrapper);\n    },\n    \n    // append\n    append: function(id, fade) {\n        this._commit(id, fade, false);\n    },\n    \n    // prepend\n    prepend: function(id, fade) {\n        this._commit(id, fade, true);\n    },\n    \n    // get element\n    get: function(id) {\n        return this.$el.find('#' + id);\n    },\n    \n    // delete\n    del: function(id) {\n        var item = this.$tbody.find('#' + id);\n        if (item.length > 0) {\n            item.remove();\n            this.row_count--;\n            this._refresh();\n        }\n    },\n\n    // delete all\n    delAll: function() {\n        this.$tbody.empty();\n        this.row_count = 0;\n        this._refresh();\n    },\n        \n    // value\n    value: function(new_value) {\n        // get current id/value\n        this.before = this.$tbody.find('.current').attr('id');\n        \n        // check if new_value is defined\n        if (new_value !== undefined) {\n            this.$tbody.find('tr').removeClass('current');\n            if (new_value) {\n                this.$tbody.find('#' + new_value).addClass('current');\n            }\n        }\n        \n        // get current id/value\n        var after = this.$tbody.find('.current').attr('id');\n        if(after === undefined) {\n            return null;\n        } else {\n            // fire onchange\n            if (after != this.before && this.options.onchange) {\n                this.options.onchange(new_value);\n            }\n            \n            // return current value\n            return after;\n        }\n    },\n    \n    // size\n    size: function() {\n        return this.$tbody.find('tr').length;\n    },\n    \n    // commit\n    _commit: function(id, fade, prepend) {\n        // remove previous item with same id\n        this.del(id);\n        \n        // add\n        this.row.attr('id', id);\n        \n        // add row\n        if (prepend) {\n            this.$tbody.prepend(this.row);\n        } else {\n            this.$tbody.append(this.row);\n        }\n        \n        // fade mode\n        if (fade) {\n            this.row.hide();\n            this.row.fadeIn();\n        }\n        \n        // row\n        this.row = this._row();\n        \n        // row count\n        this.row_count++;\n        this._refresh();\n    },\n    \n    // create new row\n    _row: function() {\n        return $('<tr class=\"' + this.options.cls_tr + '\"></tr>');\n    },\n    \n    // onclick\n    _onclick: function(e) {\n        // get values\n        var old_value = this.value();\n        var new_value = $(e.target).closest('tr').attr('id');\n        if (new_value != ''){\n            // check equality\n            if (new_value && old_value != new_value) {\n                if (this.options.onconfirm) {\n                    this.options.onconfirm(new_value);\n                } else {\n                    this.value(new_value);\n                }\n            }\n        }\n    },\n\n    // ondblclick\n    _ondblclick: function(e) {\n        var value = this.value();\n        if (value && this.options.ondblclick) {\n            this.options.ondblclick(value);\n        }\n    },\n        \n    // refresh\n    _refresh: function() {\n        if (this.row_count == 0) {\n            this.$tmessage.show();\n        } else {\n            this.$tmessage.hide();\n        }\n    },\n        \n    // load html template\n    _template: function(options) {\n        return  '<div>' +\n                    '<table class=\"' + options.cls + '\">' +\n                        '<thead></thead>' +\n                        '<tbody></tbody>' +\n                    '</table>' +\n                    '<tmessage>' + options.content + '</tmessage>' +\n                '<div>';\n    }\n});\n\nreturn {\n    View: View\n}\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/ui-table.js\n **/","define([\n    //jquery\n    //backbone\n], function(){\n//=============================================================================\n/**\n * backbone model for icon buttons\n */\nvar IconButton = Backbone.Model.extend({\n    defaults: {\n        title           : \"\",\n        icon_class      : \"\",\n        on_click        : null,\n        menu_options    : null,\n        is_menu_button  : true,\n        id              : null,\n        href            : null,\n        target          : null,\n        enabled         : true,\n        visible         : true,\n        tooltip_config  : {}\n    }\n});\n\n/**\n *  backbone view for icon buttons\n */\nvar IconButtonView = Backbone.View.extend({\n\n    initialize : function(){\n        // better rendering this way\n        this.model.attributes.tooltip_config = { placement : 'bottom' };\n        this.model.bind( 'change', this.render, this );\n    },\n\n    render : function( ){\n        // hide tooltip\n        this.$el.tooltip( 'hide' );\n\n        var new_elem = this.template( this.model.toJSON() );\n        // configure tooltip\n        new_elem.tooltip( this.model.get( 'tooltip_config' ));\n        this.$el.replaceWith( new_elem );\n        this.setElement( new_elem );\n        return this;\n    },\n\n    events : {\n        'click' : 'click'\n    },\n\n    click : function( event ){\n        // if on_click pass to that function\n        if( _.isFunction( this.model.get( 'on_click' ) ) ){\n            this.model.get( 'on_click' )( event );\n            return false;\n        }\n        // otherwise, bubble up ( to href or whatever )\n        return true;\n    },\n\n    // generate html element\n    template: function( options ){\n        var buffer = 'title=\"' + options.title + '\" class=\"icon-button';\n\n        if( options.is_menu_button ){\n            buffer += ' menu-button';\n        }\n\n        buffer += ' ' + options.icon_class;\n\n        if( !options.enabled ){\n            buffer += '_disabled';\n        }\n\n        // close class tag\n        buffer += '\"';\n\n        if( options.id ){\n            buffer += ' id=\"' + options.id + '\"';\n        }\n\n        buffer += ' href=\"' + options.href + '\"';\n        // add target for href\n        if( options.target ){\n            buffer += ' target=\"' + options.target + '\"';\n        }\n        // set visibility\n        if( !options.visible ){\n            buffer += ' style=\"display: none;\"';\n        }\n\n        // enabled/disabled\n        if ( options.enabled ){\n            buffer = '<a ' + buffer + '/>';\n        } else {\n            buffer = '<span ' + buffer + '/>';\n        }\n\n        // return element\n        return $( buffer );\n    }\n} );\n\n// define collection\nvar IconButtonCollection = Backbone.Collection.extend({\n    model: IconButton\n});\n\n/**\n * menu with multiple icon buttons\n * views are not needed nor used for individual buttons\n */\nvar IconButtonMenuView = Backbone.View.extend({\n\n    tagName: 'div',\n\n    initialize: function(){\n        this.render();\n    },\n\n    render: function(){\n        // initialize icon buttons\n        var self = this;\n        this.collection.each(function(button){\n            // create and add icon button to menu\n            var elt = $('<a/>')\n                .attr('href', 'javascript:void(0)')\n                .attr('title', button.attributes.title)\n                .addClass('icon-button menu-button')\n                .addClass(button.attributes.icon_class)\n                .appendTo(self.$el)\n                .click(button.attributes.on_click);\n\n            // configure tooltip\n            if (button.attributes.tooltip_config){\n                elt.tooltip(button.attributes.tooltip_config);\n            }\n\n            // add popup menu to icon\n            var menu_options = button.get('options');\n            if (menu_options){\n                make_popupmenu(elt, menu_options);\n            }\n        });\n\n        // return\n        return this;\n    }\n});\n\n/**\n * Returns an IconButtonMenuView for the provided configuration.\n * Configuration is a list of dictionaries where each dictionary\n * defines an icon button. Each dictionary must have the following\n * elements: icon_class, title, and on_click.\n */\nvar create_icon_buttons_menu = function(config, global_config)\n{\n    // initialize global configuration\n    if (!global_config) global_config = {};\n\n    // create and initialize menu\n    var buttons = new IconButtonCollection(\n        _.map(config, function(button_config){\n            return new IconButton(_.extend(button_config, global_config));\n        })\n    );\n\n    // return menu\n    return new IconButtonMenuView( {collection: buttons} );\n};\n\n\n//=============================================================================\n    return {\n        IconButton              : IconButton,\n        IconButtonView          : IconButtonView,\n        IconButtonCollection    : IconButtonCollection,\n        IconButtonMenuView      : IconButtonMenuView,\n        create_icon_buttons_menu: create_icon_buttons_menu\n    };\n})\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/icon-button.js\n **/","define([], function() {\n\n/** Frame view */\nvar FrameView = Backbone.View.extend({\n    initialize: function( options ) {\n        var self = this;\n        this.model = options && options.model || new Backbone.Model( options );\n        this.setElement( $( '<div/>' ).addClass( 'corner frame' ) );\n        this.$el.append( $( '<div/>' ).addClass( 'f-header corner' )\n                                      .append( $( '<div/>' ).addClass( 'f-title' ) )\n                                      .append( $( '<div/>' ).addClass( 'f-icon f-close fa fa-close' )\n                                                            .tooltip( { title: 'Close', placement: 'bottom' } ) ) )\n                .append( $( '<div/>' ).addClass( 'f-content' ) )\n                .append( $( '<div/>' ).addClass( 'f-resize f-icon corner fa fa-expand' ).tooltip( { title: 'Resize' } ) )\n                .append( $( '<div/>' ).addClass( 'f-cover' ) );\n        this.$header  = this.$( '.f-header' );\n        this.$title   = this.$( '.f-title' );\n        this.$content = this.$( '.f-content' );\n        this.render();\n        this.listenTo( this.model, 'change', this.render, this );\n    },\n\n    render: function() {\n        var self = this;\n        var options = this.model.attributes;\n        this.$title.html( options.title || '' );\n        this.$header.find( '.f-icon-left' ).remove();\n        _.each( options.menu, function( option ) {\n            var $option = $( '<div/>' ).addClass( 'f-icon-left' ).addClass( option.icon );\n            if ( _.isFunction( option.disabled ) && option.disabled() ) {\n                $option.attr( 'disabled', true );\n            } else {\n                $option.on( 'click', function() { option.onclick( self ) } )\n                       .tooltip( { title: option.tooltip, placement: 'bottom' } );\n            }\n            self.$header.append( $option );\n        } );\n        if ( options.url ) {\n            this.$content.html( $ ( '<iframe/>' ).addClass( 'f-iframe' )\n                                                 .attr( 'scrolling', 'auto' )\n                                                 .attr( 'src', options.url + ( options.url.indexOf( '?' ) === -1 ? '?' : '&' ) + 'widget=True' ) );\n        } else if ( options.content ) {\n            _.isFunction( options.content ) ? options.content( self.$content ) : self.$content.html( options.content );\n        }\n    }\n});\n\n/** Scratchbook viewer */\nvar View = Backbone.View.extend({\n    defaultOptions: {\n        frame: {             // default frame size in cells\n            cols : 6,\n            rows : 3\n        },\n        rows        : 1000,  // maximum number of rows\n        cell        : 130,   // cell size in px\n        margin      : 5,     // margin between frames\n        scroll      : 5,     // scroll speed\n        top_min     : 40,    // top margin\n        frame_max   : 9,     // maximum number of frames\n        visible     : true,  // initial visibility\n    },\n\n    cols            : 0,     // number of columns\n    top             : 0,     // scroll/element top\n    top_max         : 0,     // viewport scrolling state\n    frame_z         : 0,     // frame z-index\n    frame_counter   : 0,     // frame counter\n    frame_uid       : 0,     // unique frame id counter\n    frame_list      : {},    // list of all frames\n    frame_shadow    : null,  // frame shown as placeholder when moving active frames\n    visible         : false, // flag indicating if scratchbook viewer is visible or not\n    event           : {},    // dictionary keeping track of current event\n\n    initialize : function( options ) {\n        var self = this;\n        this.options = _.defaults( options || {}, this.defaultOptions );\n        this.visible = this.options.visible;\n        this.top = this.top_max = this.options.top_min;\n        this.setElement( $( '<div/>' ).addClass( 'galaxy-frame' )\n                            .append( $( '<div/>' ).addClass( 'frame-background' ) )\n                            .append( $( '<div/>' ).addClass( 'frame-menu frame-scroll-up fa fa-chevron-up fa-2x' ) )\n                            .append( $( '<div/>' ).addClass( 'frame-menu frame-scroll-down fa fa-chevron-down fa-2x' ) ) );\n\n        // initialize shadow to guiding drag/resize events\n        this.frame_shadow = new Backbone.View({ el: $( '<div/>' ).addClass( 'corner frame-shadow' ) } );\n        this.$el.append( this.frame_shadow.$el );\n        this._frameInit( this.frame_shadow, '#frame-shadow' );\n        this._frameResize( this.frame_shadow, { width: 0, height: 0 } );\n        this.frame_list[ '#frame-shadow' ] = this.frame_shadow;\n\n        // initialize panel\n        this.visible ? this.show() : this.hide();\n        this._panelRefresh();\n        $( window ).resize( function() { self.visible && self._panelRefresh() } );\n    },\n\n    /** Render */\n    render: function() {\n        this.$( '.frame-scroll-up' ) [ this.top != this.options.top_min && 'show' || 'hide' ]();\n        this.$( '.frame-scroll-down')[ this.top != this.top_max && 'show' || 'hide' ]();\n    },\n\n    /**\n     * Adds and displays a new frame.\n     *\n     * options:\n     *  url     : loaded into an iframe\n     *  content : content is treated as a function or raw HTML, function is passed a single\n     *              argument that is the frame's content DOM element\n     */\n    add: function( options ) {\n        if ( this.frame_counter >= this.options.frame_max ) {\n            Galaxy.modal.show( {\n                title   : 'Warning',\n                body    : 'You have reached the maximum number of allowed frames (' + this.options.frame_max + ').',\n                buttons : { 'Close' : function() { Galaxy.modal.hide() } }\n            });\n\n        } else {\n            var frame_id = '#frame-' + ( this.frame_uid++ );\n            if ( $ ( frame_id ).length !== 0 ) {\n                Galaxy.modal.show( {\n                    title   : 'Error',\n                    body    : 'This frame already exists. This page might contain multiple frame managers.',\n                    buttons : { 'Close' : function() { Galaxy.modal.hide() } }\n                });\n            } else {\n                // initialize new frame elements\n                this.top = this.options.top_min;\n                var frame = new FrameView( options );\n                this.$el.append( frame.$el );\n\n                // set dimensions\n                options.width   = this._toPixelCoord( 'width', this.options.frame.cols );\n                options.height  = this._toPixelCoord( 'height', this.options.frame.rows );\n\n                // set default z-index and add to ui and frame list\n                this.frame_z = parseInt( frame.$el.css( 'z-index' ) );\n                this.frame_list[ frame_id ] = frame;\n                this.frame_counter++;\n                this._frameInit( frame, frame_id );\n                this._frameResize( frame, { width: options.width, height: options.height } );\n                this._frameInsert( frame, { top: 0, left: 0 }, true );\n                !this.visible && this.show();\n                this.trigger( 'add' );\n            }\n        }\n    },\n\n    /** Remove a frame */\n    del: function( frame ) {\n        var self = this;\n        var $frame = frame.$el;\n        $frame.fadeOut( 'fast', function() {\n            $frame.remove();\n            delete self.frame_list[ frame.id ];\n            self.frame_counter--;\n            self._panelRefresh( true );\n            self._panelAnimationComplete();\n            self.trigger( 'remove' );\n        });\n    },\n\n    /** Show panel */\n    show: function() {\n        this.visible = true;\n        this.$el.fadeIn( 'fast' );\n        this.trigger( 'show' );\n    },\n\n    /** Hide panel */\n    hide: function() {\n        if ( !this.event.type ) {\n            this.visible = false;\n            this.$el.fadeOut('fast', function() { $( this ).hide() });\n            this.trigger( 'hide' );\n        }\n    },\n\n    /** Returns the number of frames */\n    length: function() {\n        return this.frame_counter;\n    },\n\n    /*\n        EVENT HANDLING\n    */\n    events: {\n        // global frame events\n        'mousemove'                         : '_eventFrameMouseMove',\n        'mouseup'                           : '_eventFrameMouseUp',\n        'mouseleave'                        : '_eventFrameMouseUp',\n        'mousewheel'                        : '_eventPanelScroll',\n        'DOMMouseScroll'                    : '_eventPanelScroll',\n\n        // events fixed to elements\n        'mousedown .frame'                  : '_eventFrameMouseDown',\n        'mousedown .frame-background'       : '_eventHide',\n        'mousedown .frame-scroll-up'        : '_eventPanelScroll_up',\n        'mousedown .frame-scroll-down'      : '_eventPanelScroll_down',\n        'mousedown .f-close'                : '_eventFrameClose'\n    },\n\n    /** Start drag/resize event */\n    _eventFrameMouseDown: function ( e ) {\n        $( '.tooltip' ).hide();\n        if ( !this.event.type ) {\n            if ( $( e.target ).hasClass( 'f-header' ) || $( e.target ).hasClass( 'f-title' ) ) {\n                this.event.type = 'drag';\n            }\n            if ( $( e.target ).hasClass( 'f-resize' ) ) {\n                this.event.type = 'resize';\n            }\n            if ( this.event.type ) {\n                e.preventDefault();\n                this.event.target = this._frameIdentify( e.target );\n                this.event.xy = {\n                    x: e.originalEvent.pageX,\n                    y: e.originalEvent.pageY\n                };\n                this._frameDragStart( this.event.target );\n            }\n        }\n    },\n\n    /** Processes drag/resize events */\n    _eventFrameMouseMove: function ( e ) {\n        if ( this.event.type ) {\n            // get mouse motion and delta\n            var event_xy_new = {\n                x : e.originalEvent.pageX,\n                y : e.originalEvent.pageY\n            };\n            var event_xy_delta = {\n                x : event_xy_new.x - this.event.xy.x,\n                y : event_xy_new.y - this.event.xy.y\n            };\n            this.event.xy = event_xy_new;\n\n            // get current screen position and size of frame\n            var p = this._frameScreen ( this.event.target );\n\n            // drag/resize event\n            if ( this.event.type == 'resize' ) {\n                p.width  += event_xy_delta.x;\n                p.height += event_xy_delta.y;\n                var min_dim = this.options.cell - this.options.margin - 1;\n                p.width = Math.max( p.width, min_dim );\n                p.height = Math.max( p.height, min_dim );\n                this._frameResize( this.event.target, p );\n                p.width = this._toGridCoord( 'width', p.width ) + 1;\n                p.height = this._toGridCoord( 'height', p.height ) + 1;\n                p.width = this._toPixelCoord( 'width', p.width );\n                p.height = this._toPixelCoord( 'height', p.height );\n                this._frameResize( this.frame_shadow, p );\n                this._frameInsert( this.frame_shadow, {\n                    top     : this._toGridCoord( 'top', p.top ),\n                    left    : this._toGridCoord( 'left', p.left )\n                });\n            } else if ( this.event.type == 'drag' ) {\n                p.left  += event_xy_delta.x;\n                p.top   += event_xy_delta.y;\n                this._frameOffset( this.event.target, p );\n                var l = {\n                    top     : this._toGridCoord( 'top', p.top ),\n                    left    : this._toGridCoord( 'left', p.left )\n                };\n                l.left !== 0 && l.left++;\n                this._frameInsert( this.frame_shadow, l );\n            }\n        }\n    },\n\n    /** Stop drag/resize events */\n    _eventFrameMouseUp: function ( e ) {\n        if ( this.event.type ) {\n            this._frameDragStop( this.event.target );\n            this.event.type = null;\n        }\n    },\n\n    /** Destroy a frame */\n    _eventFrameClose: function ( e ) {\n        if ( !this.event.type ) {\n            e.preventDefault();\n            this.del( this._frameIdentify( e.target ) );\n        }\n    },\n\n    /** Hide all frames */\n    _eventHide: function ( e ) {\n        !this.event.type && this.hide();\n    },\n\n    /** Fired when scrolling occurs on panel */\n    _eventPanelScroll: function( e ) {\n        if ( !this.event.type && this.visible ) {\n            // Stop propagation if scrolling is happening inside a frame.\n            // TODO: could propagate scrolling if at top/bottom of frame.\n            var frames = $( e.srcElement ).parents( '.frame' );\n            if ( frames.length !== 0 ) {\n                e.stopPropagation();\n            } else {\n                e.preventDefault();\n                this._panelScroll( e.originalEvent.detail ? e.originalEvent.detail : e.originalEvent.wheelDelta / -3 );\n            }\n        }\n    },\n\n    /** Handle scroll up event */\n    _eventPanelScroll_up: function( e ) {\n        if ( !this.event.type ) {\n            e.preventDefault();\n            this._panelScroll( -this.options.scroll );\n        }\n    },\n\n    /** Handle scroll down */\n    _eventPanelScroll_down: function(e) {\n        if ( !this.event.type ) {\n            e.preventDefault();\n            this._panelScroll( this.options.scroll );\n        }\n    },\n\n    /*\n        FRAME EVENTS SUPPORT\n    */\n\n    /** Identify the target frame */\n    _frameIdentify: function( target ) {\n        return this.frame_list[ '#' + $( target ).closest( '.frame' ).attr( 'id' ) ];\n    },\n\n    /** Provides drag support */\n    _frameDragStart : function ( frame ) {\n        this._frameFocus( frame, true );\n        var p = this._frameScreen( frame );\n        this._frameResize( this.frame_shadow, p );\n        this._frameGrid( this.frame_shadow, frame.grid_location );\n        frame.grid_location = null;\n        this.frame_shadow.$el.show();\n        $( '.f-cover' ).show();\n    },\n\n    /** Removes drag support */\n    _frameDragStop : function ( frame ) {\n        this._frameFocus( frame, false );\n        var p = this._frameScreen( this.frame_shadow );\n        this._frameResize( frame, p );\n        this._frameGrid( frame, this.frame_shadow.grid_location, true );\n        this.frame_shadow.grid_location = null;\n        this.frame_shadow.$el.hide();\n        $( '.f-cover' ).hide();\n        this._panelAnimationComplete();\n    },\n\n    /*\n        GRID/PIXEL CONVERTER\n    */\n\n    /** Converts a pixel to a grid dimension */\n    _toGridCoord: function ( type, px ) {\n        var sign = ( type == 'width' || type == 'height' ) ? 1 : -1;\n        type == 'top' && ( px -= this.top );\n        return parseInt( ( px + sign * this.options.margin ) / this.options.cell, 10 );\n    },\n    \n    /** Converts a grid to a pixels dimension */\n    _toPixelCoord: function ( type, g ) {\n        var sign = ( type == 'width' || type == 'height' ) ? 1 : -1;\n        var px = ( g * this.options.cell ) - sign * this.options.margin;\n        type == 'top' && ( px += this.top );\n        return px;\n    },\n\n    /** Converts a pixel to a grid coordinate set */\n    _toGrid: function ( px ) {\n        return {\n            top     : this._toGridCoord( 'top', px.top ),\n            left    : this._toGridCoord( 'left', px.left ),\n            width   : this._toGridCoord( 'width', px.width ),\n            height  : this._toGridCoord( 'height', px.height )\n        };\n    },\n\n    /** Converts a pixel to a grid coordinate set */\n    _toPixel: function( g ) {\n        return {\n            top     : this._toPixelCoord( 'top', g.top ),\n            left    : this._toPixelCoord( 'left', g.left ),\n            width   : this._toPixelCoord( 'width', g.width ),\n            height  : this._toPixelCoord( 'height', g.height )\n        };\n    },\n\n    /* \n        COLLISION DETECTION\n    */\n\n    /** Check collisions for a grid coordinate set */\n    _isCollision: function( g ) {\n        function is_collision_pair ( a, b ) {\n            return !( a.left > b.left + b.width - 1 || a.left + a.width - 1 < b.left ||\n                      a.top > b.top + b.height  - 1 || a.top + a.height - 1 < b.top );\n        }\n        for ( var i in this.frame_list ) {\n            var frame = this.frame_list[ i ];\n            if ( frame.grid_location !== null && is_collision_pair ( g, frame.grid_location ) ) {\n                return true;\n            }\n        }\n        return false;\n    },\n\n    /** Return location/grid rank */\n    _locationRank: function( loc ) {\n        return ( loc.top * this.cols ) + loc.left;\n    },\n\n    /*\n        PANEL/WINDOW FUNCTIONS\n    */\n\n    /** Refresh panel */\n    _panelRefresh: function( animate ) {\n        this.cols = parseInt( $( window ).width() / this.options.cell, 10 ) + 1;\n        this._frameInsert( null, null, animate );\n    },\n\n    /** Complete panel animation / frames not moving */\n    _panelAnimationComplete: function() {\n        var self = this;\n        $( '.frame' ).promise().done( function() { self._panelScroll( 0, true ) } );\n    },\n\n    /** Scroll panel */\n    _panelScroll: function( delta, animate ) {\n        var top_new = this.top - this.options.scroll * delta;\n        top_new = Math.max( top_new, this.top_max );\n        top_new = Math.min( top_new, this.options.top_min );\n        if ( this.top != top_new ) {\n            for ( var i in this.frame_list ) {\n                var frame = this.frame_list[ i ];\n                if ( frame.grid_location !== null ) {\n                    var screen_location = {\n                        top  : frame.screen_location.top - ( this.top - top_new ),\n                        left : frame.screen_location.left\n                    }\n                    this._frameOffset( frame, screen_location, animate );\n                }\n            }\n            this.top = top_new;\n        }\n        this.render();\n    },\n\n    /*\n        FRAME FUNCTIONS\n    */\n\n    /** Initialize a new frame */\n    _frameInit: function( frame, id ) {\n        frame.id              = id\n        frame.screen_location = {};\n        frame.grid_location   = {};\n        frame.grid_rank       = null;\n        frame.$el.attr( 'id', id.substring( 1 ) );\n    },\n\n    /** Insert frame at given location */\n    _frameInsert: function( frame, new_loc, animate ) {\n        var self = this;\n        var place_list = [];\n        if ( frame ) {\n            frame.grid_location = null;\n            place_list.push( [ frame, this._locationRank( new_loc ) ] );\n        }\n        _.each( this.frame_list, function( f ) {\n            if ( f.grid_location !== null ) {\n                f.grid_location = null;\n                place_list.push( [ f, f.grid_rank ] );\n            }\n        });\n        place_list.sort( function( a, b ) {\n            return a[ 1 ] < b[ 1 ] ? -1 : ( a[ 1 ] > b[ 1 ] ? 1 : 0 );\n        });\n        _.each( place_list, function( place ) {\n            self._framePlace( place[ 0 ], animate );\n        });\n        this.top_max = 0;\n        _.each( this.frame_list, function( f ) {\n            if ( f.grid_location !== null ) {\n                self.top_max = Math.max( self.top_max, f.grid_location.top + f.grid_location.height );\n            }\n        });\n        this.top_max = $( window ).height() - this.top_max * this.options.cell - 2 * this.options.margin;\n        this.top_max = Math.min( this.top_max, this.options.top_min );\n        this.render();\n    },\n\n    /** Naive frame placement */\n    _framePlace: function( frame, animate ) {\n        frame.grid_location = null;\n        var g = this._toGrid( this._frameScreen( frame ) );\n        var done = false;\n        for ( var i = 0; i < this.options.rows; i++ ) {\n            for ( var j = 0; j < Math.max(1, this.cols - g.width ); j++ ) {\n                g.top   = i;\n                g.left  = j;\n                if ( !this._isCollision( g ) ) {\n                    done = true;\n                    break;\n                }\n            }\n            if ( done ) {\n                break;\n            }\n        }\n        if ( done ) {\n            this._frameGrid( frame, g, animate );\n        } else {\n            console.log( 'Grid dimensions exceeded.' );\n        }\n    },\n\n    /** Handle frame focussing */\n    _frameFocus: function( frame, has_focus ) {\n        frame.$el.css( 'z-index', this.frame_z + ( has_focus ? 1 : 0 ) );\n    },\n\n    /** New left/top position frame */\n    _frameOffset: function( frame, p, animate ) {\n        frame.screen_location.left = p.left;\n        frame.screen_location.top = p.top;\n        if ( animate ) {\n            this._frameFocus( frame, true );\n            var self = this;\n            frame.$el.animate({ top: p.top, left: p.left }, 'fast', function() {\n                self._frameFocus( frame, false );\n            });\n        } else {\n            frame.$el.css( { top: p.top, left: p.left } );\n        }\n    },\n\n    /** Resize frame */\n    _frameResize: function( frame, p ) {\n        frame.$el.css( { width: p.width, height: p.height } );\n        frame.screen_location.width = p.width;\n        frame.screen_location.height = p.height;\n    },\n\n    /** Push frame to new grid location */\n    _frameGrid: function ( frame, l, animate ) {\n        frame.grid_location = l;\n        this._frameOffset( frame, this._toPixel( l ), animate );\n        frame.grid_rank = this._locationRank( l );\n    },\n\n    /** Get frame dimensions */\n    _frameScreen: function( frame ) {\n        var p = frame.screen_location;\n        return { top: p.top, left: p.left, width: p.width, height: p.height };\n    }\n});\n\nreturn {\n    View: View\n}\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/ui-frames.js\n **/","// from: https://raw.githubusercontent.com/umdjs/umd/master/jqueryPlugin.js\n// Uses AMD or browser globals to create a jQuery plugin.\n(function (factory) {\n    if (typeof define === 'function' && define.amd) {\n        //TODO: So...this turns out to be an all or nothing thing. If I load jQuery in the define below, it will\n        //  (of course) wipe the old jquery *and all the plugins loaded into it*. So the define below *is still\n        //  relying on jquery being loaded globally* in order to preserve plugins.\n        define([ 'jquery' ], factory);\n    } else {\n        // Browser globals\n        factory(jQuery);\n    }\n\n}(function ( jQuery ) {\n'use_strict';\n\nvar $ = jQuery;\n\n// ============================================================================\n/**\n * Make an element with text editable: (a) when user clicks on text, a textbox/area\n * is provided for editing; (b) when enter key pressed, element's text is set and on_finish\n * is called.\n */\n$.fn.make_text_editable = function(config_dict) {\n    // Get config options.\n    var num_cols = (\"num_cols\" in config_dict ? config_dict.num_cols : 30),\n        num_rows = (\"num_rows\" in config_dict ? config_dict.num_rows : 4),\n        use_textarea = (\"use_textarea\" in config_dict ? config_dict.use_textarea : false),\n        on_finish = (\"on_finish\" in config_dict ? config_dict.on_finish : null),\n        help_text = (\"help_text\" in config_dict ? config_dict.help_text : null);\n\n    // Add element behavior.\n    var container = $(this);\n    container.addClass(\"editable-text\").click(function(e) {\n        // If there's already an input element, editing is active, so do nothing.\n        if ($(this).children(\":input\").length > 0) {\n            return;\n        }\n\n        container.removeClass(\"editable-text\");\n\n        // Handler for setting element text.\n        var set_text = function(new_text) {\n            container.find(\":input\").remove();\n\n            if (new_text !== \"\") {\n                container.text(new_text);\n            } else {\n                // No text; need a line so that there is a click target.\n                container.html(\"<br>\");\n            }\n            container.addClass(\"editable-text\");\n\n            if (on_finish) {\n                on_finish(new_text);\n            }\n        };\n\n        // Create input element(s) for editing.\n        var cur_text = (\"cur_text\" in config_dict ? config_dict.cur_text : container.text() ),\n            input_elt, button_elt;\n\n        if (use_textarea) {\n            input_elt = $(\"<textarea/>\")\n                .attr({ rows: num_rows, cols: num_cols }).text($.trim(cur_text))\n                .keyup(function(e) {\n                    if (e.keyCode === 27) {\n                        // Escape key.\n                        set_text(cur_text);\n                    }\n                });\n            button_elt = $(\"<button/>\").text(\"Done\").click(function() {\n                set_text(input_elt.val());\n                // Return false so that click does not propogate to container.\n                return false;\n            });\n        }\n        else {\n            input_elt = $(\"<input type='text'/>\").attr({ value: $.trim(cur_text), size: num_cols })\n            .blur(function() {\n                set_text(cur_text);\n            }).keyup(function(e) {\n                if (e.keyCode === 27) {\n                    // Escape key.\n                    $(this).trigger(\"blur\");\n                } else if (e.keyCode === 13) {\n                    // Enter key.\n                    set_text($(this).val());\n                }\n\n                // Do not propogate event to avoid unwanted side effects.\n                e.stopPropagation();\n            });\n        }\n\n        // Replace text with input object(s) and focus & select.\n        container.text(\"\");\n        container.append(input_elt);\n        if (button_elt) {\n            container.append(button_elt);\n        }\n        input_elt.focus();\n        input_elt.select();\n\n        // Do not propogate to elements below b/c that blurs input and prevents it from being used.\n        e.stopPropagation();\n    });\n\n    // Add help text if there some.\n    if (help_text) {\n        container.attr(\"title\", help_text).tooltip();\n    }\n\n    return container;\n};\n\n// ============================================================================\n}));\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/ui/editable-text.js\n **/","define(function(){\n\n/**\n * Stringifies a number adding commas for digit grouping as per North America.\n */\nfunction commatize( number ) {\n    number += ''; // Convert to string\n    var rgx = /(\\d+)(\\d{3})/;\n    while (rgx.test(number)) {\n        number = number.replace(rgx, '$1' + ',' + '$2');\n    }\n    return number;\n}\n\n/**\n * Helper to determine if object is jQuery deferred.\n */\nvar is_deferred = function ( d ) {\n    return ('promise' in d);\n};\n\n/**\n * Implementation of a server-state based deferred. Server is repeatedly polled, and when\n * condition is met, deferred is resolved.\n */\nvar ServerStateDeferred = Backbone.Model.extend({\n    defaults: {\n        ajax_settings: {},\n        interval: 1000,\n        success_fn: function(result) { return true; }\n    },\n\n    /**\n     * Returns a deferred that resolves when success function returns true.\n     */\n    go: function() {\n        var deferred = $.Deferred(),\n            self = this,\n            ajax_settings = self.get('ajax_settings'),\n            success_fn = self.get('success_fn'),\n            interval = self.get('interval'),\n             _go = function() {\n                 $.ajax(ajax_settings).success(function(result) {\n                     if (success_fn(result)) {\n                         // Result is good, so resolve.\n                         deferred.resolve(result);\n                     }\n                     else {\n                         // Result not good, try again.\n                         setTimeout(_go, interval);\n                     }\n                 });\n             };\n         _go();\n         return deferred;\n    }\n});\n\n/**\n * Returns a random color in hexadecimal format that is sufficiently different from a single color\n * or set of colors.\n * @param colors a color or list of colors in the format '#RRGGBB'\n */\nvar get_random_color = function(colors) {\n    // Default for colors is white.\n    if (!colors) { colors = \"#ffffff\"; }\n\n    // If needed, create list of colors.\n    if ( typeof(colors) === \"string\" ) {\n        colors = [ colors ];\n    }\n\n    // Convert colors to numbers.\n    for (var i = 0; i < colors.length; i++) {\n        colors[i] = parseInt( colors[i].slice(1), 16 );\n    }\n\n    // -- Perceived brightness and difference formulas are from\n    // -- http://www.w3.org/WAI/ER/WD-AERT/#color-contrast\n\n    // Compute perceived color brightness (based on RGB-YIQ transformation):\n    var brightness = function(r, g, b) {\n        return ( (r * 299) + (g * 587) + (b * 114) ) / 1000;\n    };\n\n    // Compute color difference:\n    var difference = function(r1, g1, b1, r2, g2, b2) {\n        return ( Math.max(r1, r2) - Math.min(r1, r2) ) +\n               ( Math.max(g1, g2) - Math.min(g1, g2) ) +\n               ( Math.max(b1, b2) - Math.min(b1, b2) );\n    };\n\n    // Create new random color.\n    var new_color, nr, ng, nb,\n        other_color, or, og, ob,\n        n_brightness, o_brightness,\n        diff, ok = false,\n        num_tries = 0;\n    do {\n        // New color is never white b/c random in [0,1)\n        new_color = Math.round( Math.random() * 0xffffff );\n        nr = ( new_color & 0xff0000 ) >> 16;\n        ng = ( new_color & 0x00ff00 ) >> 8;\n        nb = new_color & 0x0000ff;\n        n_brightness = brightness(nr, ng, nb);\n        ok = true;\n        for (i = 0; i < colors.length; i++) {\n            other_color = colors[i];\n            or = ( other_color & 0xff0000 ) >> 16;\n            og = ( other_color & 0x00ff00 ) >> 8;\n            ob = other_color & 0x0000ff;\n            o_brightness = brightness(or, og, ob);\n            diff = difference(nr, ng, nb, or, og, ob);\n            // These thresholds may need to be adjusted. Brightness difference range is 125;\n            // color difference range is 500.\n            if ( ( Math.abs(n_brightness - o_brightness) < 40 ) ||\n                 ( diff < 200 ) ) {\n                ok = false;\n                break;\n            }\n        }\n\n        num_tries++\n;    } while (!ok && num_tries <= 10 );\n\n    // Add 0x1000000 to left pad number with 0s.\n    return '#' + ( 0x1000000 + new_color ).toString(16).substr(1,6);\n};\n\nreturn {\n    commatize: commatize,\n    is_deferred: is_deferred,\n    ServerStateDeferred : ServerStateDeferred,\n    get_random_color    : get_random_color\n};\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/viz/trackster/util.js\n **/","define([\n    \"libs/bibtex\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( parseBibtex, baseMVC, _l ){\n/* global Backbone */\n// we use amd here to require, but bibtex uses a global or commonjs pattern.\n// webpack will load via commonjs and plain requirejs will load as global. Check both\nparseBibtex = parseBibtex || window.BibtexParser;\n\nvar logNamespace = 'citation';\n//==============================================================================\n/** @class model for tool citations.\n *  @name Citation\n *  @augments Backbone.Model\n */\nvar Citation = Backbone.Model.extend( baseMVC.LoggableMixin ).extend({\n    _logNamespace : logNamespace,\n\n    defaults : {\n        content: ''\n    },\n\n    initialize: function() {\n        var parsed;\n        try {\n            // TODO: to model.parse/.validate\n            parsed = parseBibtex( this.attributes.content );\n        } catch( err ){\n            return;\n        }\n        // bibtex returns successfully parsed in .entries and any parsing errors in .errors\n        if( parsed.errors.length ){\n            // the gen. form of these errors seems to be [ line, col, char, error message ]\n            var errors = parsed.errors.reduce( function( all, current ){ return all + '; ' + current; });\n            // throw new Error( 'Error parsing bibtex: ' + errors );\n            this.log( 'Error parsing bibtex: ' + errors );\n        }\n\n        this._fields = {};\n        this.entry = _.first( parsed.entries );\n        if( this.entry ){\n            var rawFields = this.entry.Fields;\n            for( var key in rawFields ){\n                var value = rawFields[ key ];\n                var lowerKey = key.toLowerCase();\n                this._fields[ lowerKey ] = value;\n            }\n        }\n    },\n    entryType: function() {\n        return this.entry? this.entry.EntryType : undefined;\n    },\n    fields: function() {\n        return this._fields;\n    }\n});\n\n\n//==============================================================================\n/** @class Backbone collection of citations.\n */\nvar BaseCitationCollection = Backbone.Collection.extend( baseMVC.LoggableMixin ).extend( {\n    _logNamespace : logNamespace,\n\n    /** root api url */\n    urlRoot : Galaxy.root + 'api',\n    partial : true, // Assume some tools in history/workflow may not be properly annotated yet.\n    model : Citation,\n} );\n\nvar HistoryCitationCollection = BaseCitationCollection.extend( {\n    /** complete api url */\n    url : function() {\n        return this.urlRoot + '/histories/' + this.history_id + '/citations';\n    }\n} );\n\nvar ToolCitationCollection = BaseCitationCollection.extend( {\n    /** complete api url */\n    url : function() {\n        return this.urlRoot + '/tools/' + this.tool_id + '/citations';\n    },\n    partial : false, // If a tool has citations, assume they are complete.\n} );\n\n\n//==============================================================================\n\nreturn {\n    Citation : Citation,\n    HistoryCitationCollection  : HistoryCitationCollection,\n    ToolCitationCollection: ToolCitationCollection\n};\n\n\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/citation/citation-model.js\n **/","/**\n    This is the regular tool form.\n*/\ndefine([ 'utils/utils', 'mvc/ui/ui-misc', 'mvc/tool/tool-form-base' ],\n    function( Utils, Ui, ToolFormBase ) {\n    var View = ToolFormBase.extend({\n        initialize: function( options ) {\n            var self = this;\n            ToolFormBase.prototype.initialize.call( this, Utils.merge({\n                customize: function( options ) {\n                    // build execute button\n                    options.buttons = {\n                        execute: execute_btn = new Ui.Button({\n                            icon     : 'fa-check',\n                            tooltip  : 'Execute: ' + options.name + ' (' + options.version + ')',\n                            title    : 'Execute',\n                            cls      : 'ui-button btn btn-primary',\n                            floating : 'clear',\n                            onclick  : function() {\n                                execute_btn.wait();\n                                self.portlet.disable();\n                                self.submit( options, function() {\n                                    execute_btn.unwait();\n                                    self.portlet.enable();\n                                } );\n                            }\n                        })\n                    };\n                    // remap feature\n                    if ( options.job_id && options.job_remap ) {\n                        options.inputs[ 'rerun_remap_job_id' ] = {\n                            label       : 'Resume dependencies from this job',\n                            name        : 'rerun_remap_job_id',\n                            type        : 'select',\n                            display     : 'radio',\n                            ignore      : '__ignore__',\n                            value       : '__ignore__',\n                            options     : [ [ 'Yes', options.job_id ], [ 'No', '__ignore__' ] ],\n                            help        : 'The previous run of this tool failed and other tools were waiting for it to finish successfully. Use this option to resume those tools using the new output(s) of this tool run.'\n                        }\n                    }\n                }\n            }, options ) );\n        },\n\n        /** Submit a regular job.\n         * @param{dict}     options   - Specifies tool id and version\n         * @param{function} callback  - Called when request has completed\n         */\n        submit: function( options, callback ) {\n            var self = this;\n            var job_def = {\n                tool_id         : options.id,\n                tool_version    : options.version,\n                inputs          : this.data.create()\n            }\n            this.trigger( 'reset' );\n            if ( !self.validate( job_def ) ) {\n                Galaxy.emit.debug( 'tool-form::submit()', 'Submission canceled. Validation failed.' );\n                callback && callback();\n                return;\n            }\n            if ( options.action !== Galaxy.root + 'tool_runner/index' ) {\n                var $f = $( '<form/>' ).attr( { action: options.action, method: options.method, enctype: options.enctype } );\n                _.each( job_def.inputs, function( value, key ) { $f.append( $( '<input/>' ).attr( { 'name': key, 'value': value } ) ) } );\n                $f.hide().appendTo( 'body' ).submit().remove();\n                callback && callback();\n                return;\n            }\n            Galaxy.emit.debug( 'tool-form::submit()', 'Validation complete.', job_def );\n            Utils.request({\n                type    : 'POST',\n                url     : Galaxy.root + 'api/tools',\n                data    : job_def,\n                success : function( response ) {\n                    callback && callback();\n                    self.$el.empty().append( self._templateSuccess( response ) );\n                    parent.Galaxy && parent.Galaxy.currHistoryPanel && parent.Galaxy.currHistoryPanel.refreshContents();\n                },\n                error   : function( response ) {\n                    callback && callback();\n                    Galaxy.emit.debug( 'tool-form::submit', 'Submission failed.', response );\n                    if ( response && response.err_data ) {\n                        var error_messages = self.data.matchResponse( response.err_data );\n                        for (var input_id in error_messages) {\n                            self.highlight( input_id, error_messages[ input_id ]);\n                            break;\n                        }\n                    } else {\n                        var modal = parent.Galaxy.modal;\n                        modal && modal.show({\n                            title   : 'Job submission failed',\n                            body    : ( response && response.err_msg ) || self._templateError( job_def ),\n                            buttons : {\n                                'Close' : function() {\n                                    modal.hide();\n                                }\n                            }\n                        });\n                    }\n                }\n            });\n        },\n\n        /** Validate job dictionary.\n         * @param{dict}     job_def   - Job execution dictionary\n        */\n        validate: function( job_def ) {\n            var job_inputs  = job_def.inputs;\n            var batch_n     = -1;\n            var batch_src   = null;\n            for ( var job_input_id in job_inputs ) {\n                var input_value = job_inputs[ job_input_id ];\n                var input_id    = this.data.match( job_input_id );\n                var input_field = this.field_list[ input_id ];\n                var input_def   = this.input_list[ input_id ];\n                if ( !input_id || !input_def || !input_field ) {\n                    Galaxy.emit.debug('tool-form::validate()', 'Retrieving input objects failed.');\n                    continue;\n                }\n                if ( !input_def.optional && input_value == null ) {\n                    this.highlight( input_id );\n                    return false;\n                }\n                if ( input_value && input_value.batch ) {\n                    var n = input_value.values.length;\n                    var src = n > 0 && input_value.values[ 0 ] && input_value.values[ 0 ].src;\n                    if ( src ) {\n                        if ( batch_src === null ) {\n                            batch_src = src;\n                        } else if ( batch_src !== src ) {\n                            this.highlight( input_id, 'Please select either dataset or dataset list fields for all batch mode fields.' );\n                            return false;\n                        }\n                    }\n                    if ( batch_n === -1 ) {\n                        batch_n = n;\n                    } else if ( batch_n !== n ) {\n                        this.highlight( input_id, 'Please make sure that you select the same number of inputs for all batch mode fields. This field contains <b>' + n + '</b> selection(s) while a previous field contains <b>' + batch_n + '</b>.' );\n                        return false;\n                    }\n                }\n            }\n            return true;\n        },\n\n        _templateSuccess: function( response ) {\n            if ( response.jobs && response.jobs.length > 0 ) {\n                var njobs = response.jobs.length;\n                var njobs_text = njobs == 1 ? '1 job has' : njobs + ' jobs have';\n                var $message = $( '<div/>' ).addClass( 'donemessagelarge' )\n                                .append( $( '<p/>' ).text( njobs_text + ' been successfully added to the queue - resulting in the following datasets:' ) );\n                _.each( response.outputs, function( output ) {\n                    $message.append( $( '<p/>' ).addClass( 'messagerow' ).append( $( '<b/>' ).text( output.hid + ': ' + output.name ) ) );\n                });\n                $message.append( $( '<p/>' ).append( '<b/>' ).text( 'You can check the status of queued jobs and view the resulting data by refreshing the History pane. When the job has been run the status will change from \\'running\\' to \\'finished\\' if completed successfully or \\'error\\' if problems were encountered.' ) );\n                return $message;\n            } else {\n                return this._templateError( response );\n            }\n        },\n\n        _templateError: function( response ) {\n            return  $( '<div/>' ).addClass( 'errormessagelarge' )\n                .append( $( '<p/>' ).text( 'The server could not complete the request. Please contact the Galaxy Team if this error persists.' ) )\n                .append( $( '<pre/>' ).text( JSON.stringify( response, null, 4 ) ) );\n        }\n    });\n\n    return {\n        View: View\n    };\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/tool/tool-form.js\n **/","// dependencies\ndefine(['utils/utils', 'mvc/ui/ui-portlet', 'mvc/ui/ui-misc'], function(Utils, Portlet, Ui) {\n\n// ui list element\nvar View = Backbone.View.extend({\n    // create portlet to keep track of selected list elements\n    initialize : function(options) {\n        // link this\n        var self = this;\n\n        // initialize options\n        this.options = options;\n        this.name = options.name || 'element';\n        this.multiple = options.multiple || false;\n\n        // create message handler\n        this.message = new Ui.Message();\n\n        // create portlet\n        this.portlet = new Portlet.View({ cls: 'ui-portlet-section' });\n\n        // create select field containing the options which can be inserted into the list\n        this.select = new Ui.Select.View({ optional : options.optional });\n\n        // create insert new list element button\n        this.button = new Ui.ButtonIcon({\n            icon        : 'fa fa-sign-in',\n            floating    : 'left',\n            tooltip     : 'Insert new ' + this.name,\n            onclick     : function() {\n                self.add({\n                    id      : self.select.value(),\n                    name    : self.select.text()\n                });\n            }\n        });\n\n        // build main element\n        this.setElement(this._template(options));\n        this.$('.ui-list-message').append(this.message.$el);\n        this.$('.ui-list-portlet').append(this.portlet.$el);\n        this.$('.ui-list-button').append(this.button.$el);\n        this.$('.ui-list-select').append(this.select.$el);\n    },\n\n    /** Return/Set currently selected list elements */\n    value: function(val) {\n        // set new value\n        if (val !== undefined) {\n            this.portlet.empty();\n            if ($.isArray(val)) {\n                for (var i in val) {\n                    var v = val[i];\n                    var v_id = null;\n                    var v_name = null;\n                    if ($.type(v) != 'string') {\n                        v_id = v.id;\n                        v_name = v.name;\n                    } else {\n                        v_id = v_name = v;\n                    }\n                    if (v_id != null) {\n                        this.add({\n                            id      : v_id,\n                            name    : v_name\n                        });\n                    }\n                }\n            }\n            this._refresh();\n        }\n        // get current value\n        var lst = [];\n        this.$('.ui-list-id').each(function() {\n            lst.push({\n                id      : $(this).prop('id'),\n                name    : $(this).find('.ui-list-name').html()\n            });\n        });\n        if (lst.length == 0) {\n            return null;\n        }\n        return lst;\n    },\n\n    /** Add row */\n    add: function(options) {\n        var self = this;\n        if (this.$('[id=\"' + options.id + '\"]').length === 0) {\n            if (!Utils.isEmpty(options.id)) {\n                var $el = $(this._templateRow({\n                    id      : options.id,\n                    name    : options.name\n                }));\n                $el.on('click', function() {\n                    $el.remove();\n                    self._refresh();\n                });\n                $el.on('mouseover', function() {\n                    $el.addClass('portlet-highlight');\n                });\n                $el.on('mouseout', function() {\n                    $el.removeClass('portlet-highlight');\n                });\n                this.portlet.append($el);\n                this._refresh();\n            } else {\n                this.message.update({ message: 'Please select a valid ' + this.name + '.', status: 'danger' });\n            }\n        } else {\n            this.message.update({ message: 'This ' + this.name + ' is already in the list.' });\n        }\n    },\n\n    /** Update available options */\n    update: function(options) {\n        this.select.update(options);\n    },\n\n    /** Refresh view */\n    _refresh: function() {\n        if (this.$('.ui-list-id').length > 0) {\n            !this.multiple && this.button.disable();\n            this.$('.ui-list-portlet').show();\n        } else {\n            this.button.enable();\n            this.$('.ui-list-portlet').hide();\n        }\n        this.options.onchange && this.options.onchange();\n    },\n\n    /** Main Template */\n    _template: function(options) {\n        return  '<div class=\"ui-list\">' +\n                    '<div class=\"ui-margin-top\">' +\n                        '<span class=\"ui-list-button\"/>' +\n                        '<span class=\"ui-list-select\"/>' +\n                    '</div>' +\n                    '<div class=\"ui-list-message\"/>' +\n                    '<div class=\"ui-list-portlet\"/>' +\n                '</div>';\n    },\n\n    /** Row Template */\n    _templateRow: function(options) {\n        return  '<div id=\"' + options.id + '\" class=\"ui-list-id\">' +\n                    '<span class=\"ui-list-delete fa fa-trash\"/>' +\n                    '<span class=\"ui-list-name\">' + options.name + '</span>' +\n                '</div>';\n    }\n});\n\nreturn {\n    View: View\n}\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/ui-list.js\n **/","/** Base class for options based ui elements **/\ndefine([ 'utils/utils', 'mvc/ui/ui-buttons' ], function( Utils, Buttons ) {\nvar Base = Backbone.View.extend({\n    initialize: function( options ) {\n        var self = this;\n        this.model = options && options.model || new Backbone.Model({\n            visible     : true,\n            data        : [],\n            id          : Utils.uid(),\n            error_text  : 'No options available.',\n            wait_text   : 'Please wait...',\n            multiple    : false,\n            optional    : false,\n            onchange    : function(){}\n        }).set( options );\n        this.listenTo( this.model, 'change:value', this._changeValue, this );\n        this.listenTo( this.model, 'change:wait', this._changeWait, this );\n        this.listenTo( this.model, 'change:data', this._changeData, this );\n        this.listenTo( this.model, 'change:visible', this._changeVisible, this );\n        this.on( 'change', function() { self.model.get( 'onchange' )( self.value() ) } );\n        this.render();\n    },\n\n    render: function() {\n        var self = this;\n        this.$el.empty()\n                .removeClass()\n                .addClass( 'ui-options' )\n                .append( this.$message   = $( '<div/>' ) )\n                .append( this.$menu      = $( '<div/>' ).addClass( 'ui-options-menu' ) )\n                .append( this.$options   = $( this._template() ) );\n\n        // add select/unselect all button\n        this.all_button = null;\n        if ( this.model.get( 'multiple' ) ) {\n            this.all_button = new Buttons.ButtonCheck({\n                onclick: function() {\n                    self.$( 'input' ).prop( 'checked', self.all_button.value() !== 0 );\n                    self.value( self._getValue() );\n                    self.trigger( 'change' );\n                }\n            });\n            this.$menu.append( this.all_button.$el );\n        }\n\n        // finalize dom\n        this._changeData();\n        this._changeWait();\n        this._changeVisible();\n    },\n\n    _changeData: function() {\n        var self = this;\n        this.$options.empty();\n        if ( this._templateOptions ) {\n            this.$options.append( this._templateOptions( this.model.get( 'data' ) ) );\n        } else {\n            _.each( this.model.get( 'data' ), function( option ) {\n                self.$options.append( $( self._templateOption( option ) )\n                                        .addClass( 'ui-option' )\n                                        .tooltip( { title: option.tooltip, placement: 'bottom' } ) );\n            });\n        }\n        var self = this;\n        this.$( 'input' ).on( 'change', function() {\n            self.value( self._getValue() );\n            self.trigger( 'change' );\n        });\n        this._changeValue();\n        this._changeWait();\n    },\n\n    _changeVisible: function() {\n        this.$el[ this.model.get( 'visible' ) ? 'show' : 'hide' ]();\n    },\n\n    _changeWait: function() {\n        if ( this.model.get( 'wait' ) ) {\n            if ( this.length() === 0 ) {\n                this._messageShow( this.model.get( 'wait_text' ), 'info' );\n                this.$options.hide();\n                this.$menu.hide();\n            }\n        } else {\n            if ( this.length() === 0 ) {\n                this._messageShow( this.model.get( 'error_text' ), 'danger' );\n                this.$options.hide();\n                this.$menu.hide();\n            } else {\n                this.$message.hide();\n                this.$options.css( 'display', 'inline-block' );\n                this.$menu.show();\n            }\n        }\n    },\n\n    _changeValue: function() {\n        this._setValue( this.model.get( 'value' ) );\n        if ( this._getValue() === null && !this.model.get( 'multiple' ) && !this.model.get( 'optional' ) ) {\n            this._setValue( this.first() );\n        }\n        this.all_button && this.all_button.value( $.isArray( this._getValue() ) ? this._getValue().length : 0, this.length() );\n    },\n\n    /** Return/Set current selection */\n    value: function ( new_value ) {\n        new_value !== undefined && this.model.set( 'value', new_value );\n        return this._getValue();\n    },\n\n    /** Return first available option */\n    first: function() {\n        var options = this.$( 'input' ).first();\n        return options.length > 0 ? options.val() : null;\n    },\n\n    /** Show a spinner indicating that the select options are currently loaded */\n    wait: function() {\n        this.model.set( 'wait', true );\n    },\n\n    /** Hide spinner indicating that the request has been completed */\n    unwait: function() {\n        this.model.set( 'wait', false );\n    },\n\n    /** Returns the number of options */\n    length: function() {\n        return this.$( '.ui-option' ).length;\n    },\n\n    /** Set value to dom */\n    _setValue: function( new_value ) {\n        var self = this;\n        if ( new_value !== undefined ) {\n            this.$( 'input' ).prop( 'checked', false );\n            if ( new_value !== null ) {\n                var values = $.isArray( new_value ) ? new_value : [ new_value ];\n                _.each( values, function( v ) {\n                    self.$( 'input[value=\"' + v + '\"]' ).first().prop( 'checked', true );\n                });\n            }\n        }\n    },\n\n    /** Return current selection */\n    _getValue: function() {\n        var selected = [];\n        this.$( ':checked' ).each( function() {\n            selected.push( $( this ).val() );\n        });\n        if ( Utils.isEmpty( selected ) ) {\n            return null;\n        }\n        return this.model.get( 'multiple' ) ? selected : selected[ 0 ];\n    },\n\n    /** Show message instead if options */\n    _messageShow: function( text, status ) {\n        this.$message.show()\n                     .removeClass()\n                     .addClass( 'ui-message alert alert-' + status )\n                     .html( text );\n    },\n\n    /** Main template function */\n    _template: function() {\n        return $( '<div/>' ).addClass( 'ui-options-list' );\n    }\n});\n\n/** Iconized **/\nvar BaseIcons = Base.extend({\n    _templateOption: function( pair ) {\n        var id = Utils.uid();\n        return  $( '<div/>' ).addClass( 'ui-option' )\n                    .append( $( '<input/>' ).attr( {\n                        id      : id,\n                        type    : this.model.get( 'type' ),\n                        name    : this.model.id,\n                        value   : pair.value } ) )\n                    .append( $( '<label/>' ).addClass( 'ui-options-label' )\n                                            .attr( 'for', id )\n                                            .html( pair.label ) );\n    }\n});\n\n/** Radio button field **/\nvar Radio = {};\nRadio.View = BaseIcons.extend({\n    initialize: function( options ) {\n        options.type = 'radio';\n        BaseIcons.prototype.initialize.call( this, options );\n    }\n});\n\n/** Checkbox options field **/\nvar Checkbox = {};\nCheckbox.View = BaseIcons.extend({\n    initialize: function( options ) {\n        options.type = 'checkbox';\n        options.multiple = true;\n        BaseIcons.prototype.initialize.call( this, options );\n    }\n});\n\n/** Radio button options field styled as classic buttons **/\nvar RadioButton = {};\nRadioButton.View = Base.extend({\n    initialize: function( options ) {\n        Base.prototype.initialize.call( this, options );\n    },\n\n    /** Set current value */\n    _setValue: function ( new_value ) {\n        if ( new_value !== undefined ) {\n            this.$( 'input' ).prop( 'checked', false );\n            this.$( 'label' ).removeClass( 'active' );\n            this.$( '[value=\"' + new_value + '\"]' ).prop( 'checked', true ).closest( 'label' ).addClass( 'active' );\n        }\n    },\n\n    /** Template for a single option */\n    _templateOption: function( pair ) {\n        var $el =  $( '<label/>' ).addClass( 'btn btn-default' );\n        pair.icon && $el.append( $( '<i/>' ).addClass( 'fa' ).addClass( pair.icon ).addClass( !pair.label && 'no-padding' ) );\n        $el.append( $( '<input/>' ).attr( { type: 'radio', name: this.model.id, value: pair.value } ) );\n        pair.label && $el.append( pair.label );\n        return $el;\n    },\n\n    /** Main template function */\n    _template: function() {\n        return $( '<div/>' ).addClass( 'btn-group ui-radiobutton' ).attr( 'data-toggle', 'buttons' );\n    }\n});\n\nreturn {\n    Base        : Base,\n    BaseIcons   : BaseIcons,\n    Radio       : Radio,\n    RadioButton : RadioButton,\n    Checkbox    : Checkbox\n};\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/ui-options.js\n **/","/**\n *  This class creates/wraps a default html select field as backbone class.\n */\ndefine([ 'utils/utils', 'mvc/ui/ui-buttons' ], function( Utils, Buttons ) {\nvar View = Backbone.View.extend({\n    initialize: function( options ) {\n        var self = this;\n        this.model = options && options.model || new Backbone.Model({\n            id          : Utils.uid(),\n            cls         : 'ui-select',\n            error_text  : 'No options available',\n            empty_text  : 'Nothing selected',\n            visible     : true,\n            wait        : false,\n            multiple    : false,\n            searchable  : true,\n            optional    : false,\n            disabled    : false,\n            onchange    : function(){}\n        }).set( options );\n        this.on( 'change', function() { self.model.get( 'onchange' )( self.value() ) } );\n        this.listenTo( this.model, 'change:data', this._changeData, this );\n        this.listenTo( this.model, 'change:disabled', this._changeDisabled, this );\n        this.listenTo( this.model, 'change:wait', this._changeWait, this );\n        this.listenTo( this.model, 'change:visible', this._changeVisible, this );\n        this.listenTo( this.model, 'change:value', this._changeValue, this );\n        this.listenTo( this.model, 'change:multiple change:searchable change:cls change:id', this.render, this );\n        this.render();\n    },\n\n    render: function() {\n        var self = this;\n        this.$el.empty().append( this.$select      = $( '<select/>' ) )\n                        .append( this.$dropdown    = $( '<div/>' ) )\n                        .append( this.$resize      = $( '<div/>' )\n                        .append( this.$resize_icon = $( '<i/>' ) ) );\n\n        // set element properties\n        this.$el.addClass( this.model.get( 'cls' ) )\n                .attr( 'id', this.model.get( 'id' ) );\n\n        // set select properties\n        this.$select.addClass( 'select' )\n                    .attr( 'id', this.model.get( 'id' ) + '_select' )\n                    .prop( 'multiple', this.model.get( 'multiple' ) )\n                    .on( 'change', function() {\n                        self.value( self._getValue() );\n                        self.trigger( 'change' );\n                    });\n\n        // render drop down\n        this.$dropdown.hide();\n        if ( !this.model.get( 'multiple' ) ) {\n            this.$dropdown.show().on( 'click', function() {\n                self.$select.select2 && self.$select.select2( 'open' );\n            });\n        }\n\n        // render resize options for classic multi-select field\n        this.$resize.hide();\n        if ( this.model.get( 'multiple' ) && !this.model.get( 'searchable' ) ) {\n            this.$resize_icon.addClass( 'fa fa-angle-double-right fa-rotate-45' );\n            this.$resize.show()\n                        .removeClass()\n                        .addClass( 'icon-resize' )\n                        .off( 'mousedown' ).on( 'mousedown', function( event ) {\n                            var currentY = event.pageY;\n                            var currentHeight = self.$select.height();\n                            self.minHeight = self.minHeight || currentHeight;\n                            $( '#dd-helper' ).show().on( 'mousemove', function( event ) {\n                                self.$select.height( Math.max( currentHeight + ( event.pageY - currentY ), self.minHeight ) );\n                            }).on( 'mouseup mouseleave', function() {\n                                $( '#dd-helper' ).hide().off();\n                            });\n                        });\n        }\n\n        // build select all button\n        this.all_button = null;\n        if ( this.model.get( 'multiple' ) ) {\n            if ( this.model.get( 'searchable' ) ) {\n                this.all_button = new Buttons.ButtonCheck({\n                    onclick: function() {\n                        var new_value = [];\n                        self.all_button.value() !== 0 && _.each( self.model.get( 'data' ), function( option ) {\n                            new_value.push( option.value );\n                        });\n                        self.value( new_value );\n                        self.trigger( 'change' );\n                    }\n                });\n                this.$el.prepend( this.all_button.$el );\n            } else {\n                this.$el.addClass( 'ui-select-multiple' );\n            }\n        }\n\n        // finalize dom\n        this._changeData();\n        this._changeWait();\n        this._changeVisible();\n    },\n\n    _changeData: function() {\n        var self = this;\n        this.$select.find( 'option' ).remove();\n        if ( !this.model.get( 'multiple' ) && this.model.get( 'optional' ) ) {\n            this.$select.append( this._templateOption( { value: '__null__', label: self.model.get( 'empty_text' ) } ) );\n        }\n        _.each( this.model.get( 'data' ), function( option ) {\n            self.$select.append( self._templateOption( option ) );\n        });\n        if ( this.length() == 0 ) {\n            this.$select.prop( 'disabled', true )\n                        .append( this._templateOption( { value: '__null__', label: this.model.get( 'error_text' ) } ) );\n        } else {\n            this.$select.prop( 'disabled', false );\n        }\n        this.$select.select2( 'destroy' );\n        if ( this.model.get( 'searchable' ) ) {\n            this.$select.select2( { closeOnSelect: !this.model.get( 'multiple' ) } );\n            this.$( '.select2-container .select2-search input' ).off( 'blur' );\n        }\n        this._changeValue();\n    },\n\n    _changeDisabled: function() {\n        this.$select.prop( 'disabled', this.model.get( 'disabled' ) );\n    },\n\n    _changeWait: function() {\n        this.$dropdown.removeClass()\n                      .addClass( 'icon-dropdown fa' )\n                      .addClass( this.model.get( 'wait' ) ? 'fa-spinner fa-spin' : 'fa-caret-down' );\n    },\n\n    _changeVisible: function() {\n        this.$el[ this.model.get( 'visible' ) ? 'show' : 'hide' ]();\n        this.$select[ this.model.get( 'visible' ) ? 'show' : 'hide' ]();\n    },\n\n    _changeValue: function() {\n        this._setValue( this.model.get( 'value' ) );\n        if ( this._getValue() === null && !this.model.get( 'multiple' ) && !this.model.get( 'optional' ) ) {\n            this._setValue( this.first() );\n        }\n        var value = this._getValue();\n        this.all_button && this.all_button.value( $.isArray( value ) ? value.length : 0, this.length() );\n    },\n\n    /** Return/Set current selection */\n    value: function ( new_value ) {\n        new_value !== undefined && this.model.set( 'value', new_value );\n        return this._getValue();\n    },\n\n    /** Return the first select option */\n    first: function() {\n        var options = this.$select.find( 'option' ).first();\n        return options.length > 0 ? options.val() : null;\n    },\n\n    /** Check if a value is an existing option */\n    exists: function( value ) {\n        return this.$select.find( 'option[value=\"' + value + '\"]' ).length > 0;\n    },\n\n    /** Return the label/text of the current selection */\n    text: function () {\n        return this.$select.find( 'option:selected' ).first().text();\n    },\n\n    /** Show the select field */\n    show: function() {\n        this.model.set( 'visible', true );\n    },\n\n    /** Hide the select field */\n    hide: function() {\n        this.model.set( 'visible', false );\n    },\n\n    /** Show a spinner indicating that the select options are currently loaded */\n    wait: function() {\n        this.model.set( 'wait', true );\n    },\n\n    /** Hide spinner indicating that the request has been completed */\n    unwait: function() {\n        this.model.set( 'wait', false );\n    },\n\n    /** Returns true if the field is disabled */\n    disabled: function() {\n        return this.model.get( 'disabled' );\n    },\n\n    /** Enable the select field */\n    enable: function() {\n        this.model.set( 'disabled', false );\n    },\n\n    /** Disable the select field */\n    disable: function() {\n        this.model.set( 'disabled', true );\n    },\n\n    /** Update all available options at once */\n    add: function( options, sorter ) {\n        _.each( this.model.get( 'data' ), function( v ) {\n            !_.findWhere( options, v ) && options.push( v );\n        });\n        sorter && options && options.sort( sorter );\n        this.model.set( 'data', options );\n    },\n\n    /** Update available options */\n    update: function( options ) {\n        this.model.set( 'data', options );\n    },\n\n    /** Set the custom onchange callback function */\n    setOnChange: function( callback ) {\n        this.model.set( 'onchange', callback );\n    },\n\n    /** Number of available options */\n    length: function() {\n        return $.isArray( this.model.get( 'data' ) ) ? this.model.get( 'data' ).length : 0;\n    },\n\n    /** Set value to dom */\n    _setValue: function( new_value ) {\n        if ( new_value !== undefined ) {\n            new_value = new_value !== null ? new_value : '__null__';\n            this.$select.val( new_value );\n            this.$select.select2 && this.$select.select2( 'val', new_value );\n        }\n    },\n\n    /** Get value from dom */\n    _getValue: function() {\n        var val = this.$select.val();\n        return Utils.isEmpty( val ) ? null : val;\n    },\n\n    /** Template for select options */\n    _templateOption: function( options ) {\n        return $( '<option/>' ).attr( 'value', options.value ).html( _.escape( options.label ) );\n    }\n});\n\nreturn {\n    View: View\n}\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/ui-select-default.js\n **/","(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        define([], factory);\n    } else {\n        root.faIconButton = factory();\n    }\n\n}(this, function () {\n//============================================================================\n    /** Returns a jQuery object containing a clickable font-awesome button.\n     *      options:\n     *          tooltipConfig   : option map for bootstrap tool tip\n     *          classes         : array of class names (will always be classed as icon-btn)\n     *          disabled        : T/F - add the 'disabled' class?\n     *          title           : tooltip/title string\n     *          target          : optional href target\n     *          href            : optional href\n     *          faIcon          : which font awesome icon to use\n     *          onclick         : function to call when the button is clicked\n     */\n    var faIconButton = function( options ){\n        options = options || {};\n        options.tooltipConfig = options.tooltipConfig || { placement: 'bottom' };\n\n        options.classes = [ 'icon-btn' ].concat( options.classes || [] );\n        if( options.disabled ){\n            options.classes.push( 'disabled' );\n        }\n\n        var html = [\n            '<a class=\"', options.classes.join( ' ' ), '\"',\n                    (( options.title )?( ' title=\"' + options.title + '\"' ):( '' )),\n                    (( !options.disabled && options.target )?  ( ' target=\"' + options.target + '\"' ):( '' )),\n                    ' href=\"', (( !options.disabled && options.href )?( options.href ):( 'javascript:void(0);' )), '\">',\n                // could go with something less specific here - like 'html'\n                '<span class=\"fa ', options.faIcon, '\"></span>',\n            '</a>'\n        ].join( '' );\n        var $button = $( html ).tooltip( options.tooltipConfig );\n        if( _.isFunction( options.onclick ) ){\n            $button.click( options.onclick );\n        }\n        return $button;\n    };\n\n//============================================================================\n    return faIconButton;\n}));\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/ui/fa-icon-button.js\n **/","/**\n * Popover wrapper\n*/\ndefine([ 'utils/utils' ], function( Utils ) {\nvar View = Backbone.View.extend({\n    optionsDefault: {\n        with_close  : true,\n        title       : null,\n        placement   : 'top',\n        container   : 'body',\n        body        : null\n    },\n\n    initialize: function ( options ) {\n        this.setElement( this._template() );\n        this.uid = Utils.uid();\n        this.options = _.defaults( options || {}, this.optionsDefault );\n        this.options.container.parent().append( this.el );\n        this.$title = this.$( '.popover-title-label' );\n        this.$close = this.$( '.popover-close' );\n        this.$body  = this.$( '.popover-content' );\n\n        // add initial content\n        this.options.body && this.append( this.options.body );\n\n        // add event to hide if click is outside of popup and not on container\n        var self = this;\n        $( 'body' ).on( 'mousedown.' + this.uid,  function( e ) {\n            // the 'is' for buttons that trigger popups\n            // the 'has' for icons within a button that triggers a popup\n            self.visible && !$( self.options.container ).is( e.target ) && !$( self.el ).is( e.target ) &&\n                $( self.el ).has( e.target ).length === 0 && self.hide();\n        });\n    },\n\n    /**\n     * Render popover\n    */\n    render: function() {\n        this.$title.html( this.options.title );\n        this.$el.removeClass().addClass( 'ui-popover popover fade in' ).addClass( this.options.placement );\n        this.$el.css( this._get_placement( this.options.placement ) );\n\n        // configure close option\n        var self = this;\n        if ( this.options.with_close ) {\n            this.$close.on( 'click', function() { self.hide() } ).show();\n        } else {\n            this.$close.off().hide();\n        }\n    },\n\n    /**\n     * Set the popover title\n     * @params{ String }    newTitle    - New popover title\n    */\n    title: function( newTitle ) {\n        if ( newTitle !== undefined ) {\n            this.options.title = newTitle;\n            this.$title.html( newTitle );\n        }\n    },\n\n    /**\n     * Show popover\n    */\n    show: function() {\n        this.render();\n        this.$el.show();\n        this.visible = true;\n    },\n\n    /**\n     * Hide popover\n    */\n    hide: function() {\n        this.$el.hide();\n        this.visible = false;\n    },\n\n    /**\n     * Append new content to the popover\n     * @params{ Object }  $el - Dom element\n    */\n    append: function( $el ) {\n        this.$body.append( $el );\n    },\n\n    /**\n     * Remove all content\n    */\n    empty: function() {\n        this.$body.empty();\n    },\n\n    /**\n     * Remove popover\n    */\n    remove: function() {\n        $( 'body' ).off( 'mousedown.' + this.uid );\n        this.$el.remove();\n    },\n\n    /**\n     * Improve popover location/placement\n    */\n    _get_placement: function( placement ) {\n        // get popover dimensions\n        var width               = this._get_width( this.$el );\n        var height              = this.$el.height();\n\n        // get container details\n        var $container = this.options.container;\n        var container_width     = this._get_width( $container );\n        var container_height    = this._get_height( $container );\n        var container_position  = $container.position();\n\n        // get position\n        var top  = left = 0;\n        if ([ 'top', 'bottom' ].indexOf( placement ) != -1) {\n            left = container_position.left - width + ( container_width + width ) / 2;\n            switch ( placement ) {\n                case 'top':\n                    top = container_position.top - height - 5;\n                    break;\n                case 'bottom':\n                    top = container_position.top + container_height + 5;\n                    break;\n            }\n        } else {\n            top = container_position.top - height + ( container_height + height ) / 2;\n            switch ( placement ) {\n                case 'right':\n                    left = container_position.left + container_width;\n                    break;\n            }\n        }\n        return { top: top, left: left };\n    },\n\n    /**\n     * Returns padding/margin corrected width\n    */\n    _get_width: function( $el ) {\n        return $el.width() + parseInt( $el.css( 'padding-left' ) ) + parseInt( $el.css( 'margin-left' ) ) +\n                             parseInt( $el.css( 'padding-right' ) ) + parseInt( $el.css( 'margin-right' ) );\n    },\n\n    /**\n     * Returns padding corrected height\n    */\n    _get_height: function( $el ) {\n        return $el.height() + parseInt( $el.css( 'padding-top' ) ) + parseInt( $el.css( 'padding-bottom' ) );\n    },\n\n    /**\n     * Return the popover template\n    */\n    _template: function( options ) {\n        return  '<div class=\"ui-popover popover fade in\">' +\n                    '<div class=\"arrow\"/>' +\n                    '<div class=\"popover-title\">' +\n                        '<div class=\"popover-title-label\"/>' +\n                        '<div class=\"popover-close fa fa-times-circle\"/>' +\n                    '</div>' +\n                    '<div class=\"popover-content\"/>' +\n                '</div>';\n    }\n});\n\nreturn {\n    View: View\n}\n\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/ui-popover.js\n **/","// dependencies\ndefine(['utils/utils'], function(Utils) {\n\n/**\n * A plugin for initializing select2 input items.\n * Make sure the select2 library itself is loaded beforehand.\n * Also the element to which select2 will be appended has to \n * be created before select2 initialization (and passed as option).\n */\nvar View = Backbone.View.extend(\n{\n    // options\n    optionsDefault: {\n        css                 : '',\n        placeholder         : 'No data available',\n        data                : [],\n        value               : null,\n        multiple            : false,\n        minimumInputLength  : 0,\n        // example format of initial data: \"id:name,55:anotherrole@role.com,27:role@role.com\"\n        initialData         : ''\n    },\n    \n    // initialize\n    initialize : function(options) {\n        // configure options\n        this.options = Utils.merge(options, this.optionsDefault);\n        \n        // create new element\n        this.setElement(this._template(this.options));\n        \n        // check if container exists\n        if (!this.options.container) {\n            console.log('ui-select::initialize() : container not specified.');\n            return;\n        }\n        \n        // add to dom\n        this.options.container.append(this.$el);\n        \n        // link selection dictionary\n        this.select_data = this.options.data;\n        \n        // refresh\n        this._refresh();\n        \n        if (!this.options.multiple){\n            // initial value\n            if (this.options.value) {\n                this._setValue(this.options.value);\n            }\n            \n            // add change event\n            var self = this;\n            if (this.options.onchange) {\n                this.$el.on('change', function() {\n                    self.options.onchange(self.value());\n                });\n            }\n        }\n    },\n    \n    // value\n    value : function (new_value) {\n        // get current id/value\n        var before = this._getValue();\n        \n        // check if new_value is defined\n        if (new_value !== undefined) {\n            this._setValue(new_value);\n        }\n        \n        // get current id/value\n        var after = this._getValue();\n        \n        // fire onchange\n        if ((after != before && this.options.onchange)) {\n            this.options.onchange(after);\n        }\n            \n        // return current value\n        return after;\n    },\n    \n    // label\n    text : function () {\n        return this.$el.select2('data').text;\n    },\n    \n    // disabled\n    disabled: function() {\n        return !this.$el.select2('enable');\n    },\n\n    // enable\n    enable: function() {\n        this.$el.select2('enable', true);\n    },\n        \n    // disable\n    disable: function() {\n        this.$el.select2('enable', false);\n    },\n    \n    // add\n    add: function(options) {\n        // add options\n        this.select_data.push({\n            id      : options.id,\n            text    : options.text\n        });\n        \n        // refresh\n        this._refresh();\n    },\n    \n    // remove\n    del: function(id) {\n        // search option\n        var index = this._getIndex(id);\n        \n        // check if found\n        if (index != -1) {\n            // remove options\n            this.select_data.splice(index, 1);\n        \n            // refresh\n            this._refresh();\n        }\n    },\n    \n    // remove\n    remove: function() {\n        this.$el.select2('destroy');\n    },\n    \n    // update\n    update: function(options) {\n        // copy options\n        this.select_data = [];\n        for (var key in options.data) {\n            this.select_data.push(options.data[key]);\n        }\n        \n        // refresh\n        this._refresh();\n    },\n    \n    // refresh\n    _refresh: function() {\n        // add select2 data based on type of input\n        if (!this.options.multiple){\n            var selected = this._getValue();\n            var select_opt = {\n                data                : this.select_data,\n                containerCssClass   : this.options.css,\n                placeholder         : this.options.placeholder,\n                dropdownAutoWidth   : true\n            };\n            this.$el.select2(select_opt);\n            // select previous value (if exists)\n            this._setValue(selected);\n        } else {\n            var select_opt = {\n                multiple            : this.options.multiple,\n                containerCssClass   : this.options.css,\n                placeholder         : this.options.placeholder,\n                minimumInputLength  : this.options.minimumInputLength,\n                ajax                : this.options.ajax,\n                dropdownCssClass    : this.options.dropdownCssClass,\n                escapeMarkup        : this.options.escapeMarkup,\n                formatResult        : this.options.formatResult,\n                formatSelection     : this.options.formatSelection,\n                initSelection       : this.options.initSelection,\n                initialData         : this.options.initialData\n            };\n            this.$el.select2(select_opt);\n        }\n    },\n    \n    // get index\n    _getIndex: function(value) {\n        // returns the index of the searched value\n        _.findIndex(this.select_data, {id: value});\n    },\n    \n    // get value\n    _getValue: function() {\n        return this.$el.select2('val');\n    },\n    \n    // set value\n    _setValue: function(new_value) {\n        var index = this._getIndex(new_value);\n        if (index == -1) {\n            if (this.select_data.length > 0) {\n                new_value = this.select_data[0].id;\n            }\n        }\n        this.$el.select2('val', new_value);\n    },\n    \n    // element\n    _template: function(options) {\n            return '<input type=\"hidden\" value=\"' + this.options.initialData + '\"/>';\n    }\n});\n\nreturn {\n    View : View\n};\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/ui-select.js\n **/","define([\n    'libs/underscore',\n    'libs/backbone',\n    'mvc/base-mvc',\n    'utils/localization'\n], function( _, Backbone, baseMVC, _l ){\n'use strict';\n\nvar logNamespace = 'user';\n//==============================================================================\n/** @class Model for a Galaxy user (including anonymous users).\n *  @name User\n */\nvar User = Backbone.Model.extend( baseMVC.LoggableMixin ).extend(\n/** @lends User.prototype */{\n    _logNamespace : logNamespace,\n\n    /** API location for this resource */\n    urlRoot : function(){ return Galaxy.root + 'api/users'; },\n\n    /** Model defaults\n     *  Note: don't check for anon-users with the username as the default is '(anonymous user)'\n     *      a safer method is if( !user.get( 'email' ) ) -> anon user\n     */\n    defaults : /** @lends User.prototype */{\n        id                      : null,\n        username                : '(' + _l( \"anonymous user\" ) + ')',\n        email                   : \"\",\n        total_disk_usage        : 0,\n        nice_total_disk_usage   : \"\",\n        quota_percent           : null,\n        is_admin                : false\n    },\n\n    /** Set up and bind events\n     *  @param {Object} data Initial model data.\n     */\n    initialize : function( data ){\n        this.log( 'User.initialize:', data );\n\n        this.on( 'loaded', function( model, resp ){ this.log( this + ' has loaded:', model, resp ); });\n        this.on( 'change', function( model, data ){ this.log( this + ' has changed:', model, data.changes ); });\n    },\n\n    isAnonymous : function(){\n        return ( !this.get( 'email' ) );\n    },\n\n    isAdmin : function(){\n        return ( this.get( 'is_admin' ) );\n    },\n\n    /** Load a user with the API using an id.\n     *      If getting an anonymous user or no access to a user id, pass the User.CURRENT_ID_STR\n     *      (e.g. 'current') and the API will return the current transaction's user data.\n     *  @param {String} idOrCurrent encoded user id or the User.CURRENT_ID_STR\n     *  @param {Object} options hash to pass to Backbone.Model.fetch. Can contain success, error fns.\n     *  @fires loaded when the model has been loaded from the API, passing the newModel and AJAX response.\n     */\n    loadFromApi : function( idOrCurrent, options ){\n        idOrCurrent = idOrCurrent || User.CURRENT_ID_STR;\n\n        options = options || {};\n        var model = this,\n            userFn = options.success;\n\n        /** @ignore */\n        options.success = function( newModel, response ){\n            model.trigger( 'loaded', newModel, response );\n            if( userFn ){ userFn( newModel, response ); }\n        };\n\n        // requests for the current user must have a sep. constructed url (fetch don't work, ma)\n        if( idOrCurrent === User.CURRENT_ID_STR ){\n            options.url = this.urlRoot + '/' + User.CURRENT_ID_STR;\n        }\n        return Backbone.Model.prototype.fetch.call( this, options );\n    },\n\n    /** Clears all data from the sessionStorage.\n     */\n    clearSessionStorage : function(){\n        for( var key in sessionStorage ){\n            //TODO: store these under the user key so we don't have to do this\n            // currently only history\n            if( key.indexOf( 'history:' ) === 0 ){\n                sessionStorage.removeItem( key );\n\n            } else if( key === 'history-panel' ){\n                sessionStorage.removeItem( key );\n            }\n        }\n    },\n\n    /** string representation */\n    toString : function(){\n        var userInfo = [ this.get( 'username' ) ];\n        if( this.get( 'id' ) ){\n            userInfo.unshift( this.get( 'id' ) );\n            userInfo.push( this.get( 'email' ) );\n        }\n        return 'User(' + userInfo.join( ':' ) + ')';\n    }\n});\n\n// string to send to tell server to return this transaction's user (see api/users.py)\nUser.CURRENT_ID_STR = 'current';\n\n// class method to load the current user via the api and return that model\nUser.getCurrentUserFromApi = function( options ){\n    var currentUser = new User();\n    currentUser.loadFromApi( User.CURRENT_ID_STR, options );\n    return currentUser;\n};\n\n// (stub) collection for users (shouldn't be common unless admin UI)\nvar UserCollection = Backbone.Collection.extend( baseMVC.LoggableMixin ).extend({\n    model   : User,\n    urlRoot : function(){ return Galaxy.root + 'api/users'; },\n    //logger  : console,\n});\n\n\n//==============================================================================\nreturn {\n    User : User\n};});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/user/user-model.js\n **/","define([\n    'libs/underscore',\n    'libs/backbone',\n    'mvc/base-mvc',\n    'mvc/user/user-model',\n    'utils/metrics-logger',\n    'utils/add-logging',\n    'utils/localization'\n], function( _, Backbone, BASE_MVC, userModel, metricsLogger, addLogging, localize ){\n\n// TODO: move into a singleton pattern and have dependents import Galaxy\n// ============================================================================\n/** Base galaxy client-side application.\n *      Iniitializes:\n *          logger      : the logger/metrics-logger\n *          localize    : the string localizer\n *          config      : the current configuration (any k/v in\n *              galaxy.ini available from the configuration API)\n *          user        : the current user (as a mvc/user/user-model)\n */\nfunction GalaxyApp( options, bootstrapped ){\n    var self = this;\n    return self._init( options || {}, bootstrapped || {} );\n}\n\n// add logging shortcuts for this object\naddLogging( GalaxyApp, 'GalaxyApp' );\n\n// a debug flag can be set via local storage and made available during script/page loading\nvar DEBUGGING_KEY = 'galaxy:debug',\n    NAMESPACE_KEY = DEBUGGING_KEY + ':namespaces',\n    localDebugging = false;\ntry {\n    localDebugging = localStorage.getItem( DEBUGGING_KEY ) == 'true';\n} catch( storageErr ){\n    console.log( localize( 'localStorage not available for debug flag retrieval' ) );\n}\n\n/** initalize options and sub-components */\nGalaxyApp.prototype._init = function __init( options, bootstrapped ){\n    var self = this;\n    _.extend( self, Backbone.Events );\n    if( localDebugging ){\n        self.logger = console;\n        console.debug( 'debugging galaxy:', 'options:', options, 'bootstrapped:', bootstrapped );\n    }\n\n    self._processOptions( options );\n    // special case for root\n    self.root = options.root || '/';\n\n    self._initConfig( options.config || {} );\n    self._patchGalaxy( window.Galaxy );\n\n    self._initLogger( self.options.loggerOptions || {} );\n    // at this point, either logging or not and namespaces are enabled - chat it up\n    self.debug( 'GalaxyApp.options: ', self.options );\n    self.debug( 'GalaxyApp.config: ', self.config );\n    self.debug( 'GalaxyApp.logger: ', self.logger );\n\n    self._initLocale();\n    self.debug( 'GalaxyApp.localize: ', self.localize );\n\n    self.config = options.config || {};\n    self.debug( 'GalaxyApp.config: ', self.config );\n\n    self._initUser( options.user || {} );\n    self.debug( 'GalaxyApp.user: ', self.user );\n\n    self._setUpListeners();\n    self.trigger( 'ready', self );\n\n    return self;\n};\n\n/** default options */\nGalaxyApp.prototype.defaultOptions = {\n    /** monkey patch attributes from existing window.Galaxy object? */\n    patchExisting   : true,\n    /** root url of this app */\n    root            : '/'\n};\n\n/** filter to options present in defaultOptions (and default to them) */\nGalaxyApp.prototype._processOptions = function _processOptions( options ){\n    var self = this,\n        defaults = self.defaultOptions;\n\n    self.options = {};\n    for( var k in defaults ){\n        if( defaults.hasOwnProperty( k ) ){\n            self.options[ k ] = ( options.hasOwnProperty( k ) )?( options[ k ] ):( defaults[ k ] );\n        }\n    }\n    return self;\n};\n\n/** parse the config and any extra info derived from it */\nGalaxyApp.prototype._initConfig = function _initConfig( config ){\n    var self = this;\n    self.config = config;\n\n    // give precendence to localdebugging for this setting\n    self.config.debug = localDebugging || self.config.debug;\n\n    return self;\n};\n\n/** add an option from options if the key matches an option in defaultOptions */\nGalaxyApp.prototype._patchGalaxy = function _patchGalaxy( patchWith ){\n    var self = this;\n    // in case req or plain script tag order has created a prev. version of the Galaxy obj...\n    if( self.options.patchExisting && patchWith ){\n        // self.debug( 'found existing Galaxy object:', patchWith );\n        // ...(for now) monkey patch any added attributes that the previous Galaxy may have had\n        //TODO: move those attributes to more formal assignment in GalaxyApp\n        for( var k in patchWith ){\n            if( patchWith.hasOwnProperty( k ) ){\n                // self.debug( '\\t patching in ' + k + ' to Galaxy:', self[ k ] );\n                self[ k ] = patchWith[ k ];\n            }\n        }\n    }\n};\n\n/** set up the metrics logger (utils/metrics-logger) and pass loggerOptions */\nGalaxyApp.prototype._initLogger = function _initLogger( loggerOptions ){\n    var self = this;\n\n    // default to console logging at the debug level if the debug flag is set\n    if( self.config.debug ){\n        loggerOptions.consoleLogger = loggerOptions.consoleLogger || console;\n        loggerOptions.consoleLevel = loggerOptions.consoleLevel || metricsLogger.MetricsLogger.ALL;\n        // load any logging namespaces from localStorage if we can\n        try {\n            loggerOptions.consoleNamespaceWhitelist = localStorage.getItem( NAMESPACE_KEY ).split( ',' );\n        } catch( storageErr ){}\n    }\n\n    self.logger = new metricsLogger.MetricsLogger( loggerOptions );\n    self.emit = {};\n    [ 'log', 'debug', 'info', 'warn', 'error', 'metric' ].map(function( i ) {\n        self.emit[ i ] = function( data ){\n            self.logger.emit( i, arguments[ 0 ], Array.prototype.slice.call( arguments, 1 ) );\n        };\n    });\n\n    if( self.config.debug ){\n        // add this logger to mvc's loggable mixin so that all models can use the logger\n        BASE_MVC.LoggableMixin.logger = self.logger;\n    }\n    return self;\n};\n\n/** add the localize fn to this object and the window namespace (as '_l') */\nGalaxyApp.prototype._initLocale = function _initLocale( options ){\n    var self = this;\n    self.debug( '_initLocale:', options );\n    self.localize = localize;\n    // add to window as global shortened alias\n    // TODO: temporary - remove when can require for plugins\n    window._l = self.localize;\n    return self;\n};\n\n/** set up the current user as a Backbone model (mvc/user/user-model) */\nGalaxyApp.prototype._initUser = function _initUser( userJSON ){\n    var self = this;\n    self.debug( '_initUser:', userJSON );\n    self.user = new userModel.User( userJSON );\n    self.user.logger = self.logger;\n    return self;\n};\n\n/** Set up DOM/jQuery/Backbone event listeners enabled for all pages */\nGalaxyApp.prototype._setUpListeners = function _setUpListeners(){\n    var self = this;\n\n    // hook to jq beforeSend to record the most recent ajax call and cache some data about it\n    /** cached info about the last ajax call made through jQuery */\n    self.lastAjax = {};\n    $( document ).bind( 'ajaxSend', function( ev, xhr, options ){\n        var data = options.data;\n        try {\n            data = JSON.parse( data );\n        } catch( err ){}\n\n        self.lastAjax = {\n            url     : location.href.slice( 0, -1 ) + options.url,\n            data    : data\n        };\n        //TODO:?? we might somehow manage to *retry* ajax using either this hook or Backbone.sync\n    });\n    return self;\n};\n\n/** Turn debugging/console-output on/off by passing boolean. Pass nothing to get current setting. */\nGalaxyApp.prototype.debugging = function _debugging( setting ){\n    var self = this;\n    try {\n        if( setting === undefined ){\n            return localStorage.getItem( DEBUGGING_KEY ) === 'true';\n        }\n        if( setting ){\n            localStorage.setItem( DEBUGGING_KEY, true );\n            return true;\n        }\n\n        localStorage.removeItem( DEBUGGING_KEY );\n        // also remove all namespaces\n        self.debuggingNamespaces( null );\n\n    } catch( storageErr ){\n        console.log( localize( 'localStorage not available for debug flag retrieval' ) );\n    }\n    return false;\n};\n\n/** Add, remove, or clear namespaces from the debugging filters\n *  Pass no arguments to retrieve the existing namespaces as an array.\n *  Pass in null to clear all namespaces (all logging messages will show now).\n *  Pass in an array of strings or single string of the namespaces to filter to.\n *  Returns the new/current namespaces as an array;\n */\nGalaxyApp.prototype.debuggingNamespaces = function _debuggingNamespaces( namespaces ){\n    var self = this;\n    try {\n        if( namespaces === undefined ){\n            var csv = localStorage.getItem( NAMESPACE_KEY );\n            return typeof( csv ) === 'string'? csv.split( ',' ) : [];\n        } else if( namespaces === null ) {\n            localStorage.removeItem( NAMESPACE_KEY );\n        } else {\n            localStorage.setItem( NAMESPACE_KEY, namespaces );\n        }\n        var newSettings = self.debuggingNamespaces();\n        if( self.logger ){\n            self.logger.options.consoleNamespaceWhitelist = newSettings;\n        }\n        return newSettings;\n    } catch( storageErr ){\n        console.log( localize( 'localStorage not available for debug namespace retrieval' ) );\n    }\n};\n\n/** string rep */\nGalaxyApp.prototype.toString = function toString(){\n    var userEmail = this.user? ( this.user.get( 'email' ) || '(anonymous)' ) : 'uninitialized';\n    return 'GalaxyApp(' + userEmail + ')';\n};\n\n// ============================================================================\n    return {\n        GalaxyApp : GalaxyApp\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/galaxy.js\n **/","define([\n    'utils/utils',\n    'layout/menu',\n    'layout/scratchbook',\n    'mvc/user/user-quotameter',\n], function( Utils, Menu, Scratchbook, QuotaMeter ) {\n\n/** Masthead **/\nvar View = Backbone.View.extend({\n    initialize : function( options ) {\n        var self = this;\n        this.options = options;\n        this.setElement( this._template() );\n        this.$navbarBrandLink   = this.$( '.navbar-brand-link' );\n        this.$navbarBrandImage  = this.$( '.navbar-brand-image' );\n        this.$navbarBrandTitle  = this.$( '.navbar-brand-title' );\n        this.$navbarTabs        = this.$( '.navbar-tabs' );\n        this.$quoteMeter        = this.$( '.quota-meter-container' );\n\n        // build tabs\n        this.collection = new Menu.Collection();\n        this.collection.on( 'add', function( model ) {\n            self.$navbarTabs.append( new Menu.Tab( { model : model } ).render().$el );\n        }).on( 'reset', function() {\n            self.$navbarTabs.empty();\n        }).on( 'dispatch', function( callback ) {\n            self.collection.each( function ( m ) { callback( m ) });\n        }).fetch( this.options );\n\n        // scratchbook\n        Galaxy.frame = this.frame = new Scratchbook( { collection: this.collection } );\n\n        // set up the quota meter (And fetch the current user data from trans)\n        // add quota meter to masthead\n        Galaxy.quotaMeter = this.quotaMeter = new QuotaMeter.UserQuotaMeter({\n            model   : Galaxy.user,\n            el      : this.$quoteMeter\n        });\n\n        // loop through beforeunload functions if the user attempts to unload the page\n        $( window ).on( 'click', function( e ) {\n            var $download_link = $( e.target ).closest( 'a[download]' );\n            if ( $download_link.length == 1 ) {\n                if( $( 'iframe[id=download]' ).length === 0 ) {\n                    $( 'body' ).append( $( '<iframe/>' ).attr( 'id', 'download' ).hide() );\n                }\n                $( 'iframe[id=download]' ).attr( 'src', $download_link.attr( 'href' ) );\n                e.preventDefault();\n            }\n        }).on( 'beforeunload', function() {\n            var text = '';\n            self.collection.each( function( model ) {\n                var q = model.get( 'onbeforeunload' ) && model.get( 'onbeforeunload' )();\n                q && ( text += q + ' ' );\n            });\n            if ( text !== '' ) {\n                return text;\n            }\n        });\n    },\n\n    render: function() {\n        this.$navbarBrandTitle.html( 'Galaxy ' + ( this.options.brand && '/ ' + this.options.brand || '' ) );\n        this.$navbarBrandLink.attr( 'href', this.options.logo_url );\n        this.$navbarBrandImage.attr( 'src', this.options.logo_src );\n        this.quotaMeter.render();\n        return this;\n    },\n\n    /** body template */\n    _template: function() {\n        return  '<div id=\"masthead\" class=\"navbar navbar-fixed-top navbar-inverse\">' +\n                    '<div class=\"navbar-header\">' +\n                        '<div class=\"navbar-tabs\"/>' +\n                    '</div>' +\n                    '<div class=\"navbar-brand\">' +\n                        '<a class=\"navbar-brand-link\">' +\n                            '<img class=\"navbar-brand-image\"/>' +\n                            '<span class=\"navbar-brand-title\"/>' +\n                        '</a>' +\n                    '</div>' +\n                    '<div class=\"quota-meter-container\"/>' +\n                    '<div class=\"navbar-icons\"/>' +\n                '</div>';\n    }\n});\n\nreturn {\n    View: View\n};\n\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/layout/masthead.js\n **/","/** Masthead Collection **/\ndefine(['mvc/tours'], function( Tours ) {\nvar Collection = Backbone.Collection.extend({\n    model: Backbone.Model.extend({\n        defaults: {\n            visible         : true,\n            target          : '_parent'\n        }\n    }),\n    fetch: function( options ){\n        options = options || {};\n        this.reset();\n\n        //\n        // Analyze data tab.\n        //\n        this.add({\n            id              : 'analysis',\n            title           : 'Analyze Data',\n            url             : '',\n            tooltip         : 'Analysis home view'\n        });\n\n        //\n        // Workflow tab.\n        //\n        this.add({\n            id              : 'workflow',\n            title           : 'Workflow',\n            url             : 'workflow',\n            tooltip         : 'Chain tools into workflows',\n            disabled        : !Galaxy.user.id\n        });\n\n        //\n        // 'Shared Items' or Libraries tab.\n        //\n        this.add({\n            id              : 'shared',\n            title           : 'Shared Data',\n            url             : 'library/index',\n            tooltip         : 'Access published resources',\n            menu            : [{\n                    title   : 'Data Libraries',\n                    url     : 'library/list'\n                },{\n                    title   : 'Histories',\n                    url     : 'history/list_published'\n                },{\n                    title   : 'Workflows',\n                    url     : 'workflow/list_published'\n                },{\n                    title   : 'Visualizations',\n                    url     : 'visualization/list_published'\n                },{\n                    title   : 'Pages',\n                    url     : 'page/list_published'\n            }]\n        });\n\n        //\n        // Lab menu.\n        //\n        options.user_requests && this.add({\n            id              : 'lab',\n            title           : 'Lab',\n            menu            : [{\n                    title   : 'Sequencing Requests',\n                    url     : 'requests/index'\n                },{\n                    title   : 'Find Samples',\n                    url     : 'requests/find_samples_index'\n                },{\n                    title   : 'Help',\n                    url     : options.lims_doc_url\n            }]\n        });\n\n        //\n        // Visualization tab.\n        //\n        this.add({\n            id              : 'visualization',\n            title           : 'Visualization',\n            url             : 'visualization/list',\n            tooltip         : 'Visualize datasets',\n            disabled        : !Galaxy.user.id,\n            menu            : [{\n                    title   : 'New Track Browser',\n                    url     : 'visualization/trackster',\n                    target  : '_frame'\n                },{\n                    title   : 'Saved Visualizations',\n                    url     : 'visualization/list',\n                    target  : '_frame'\n                },{\n                    title   : 'Interactive Environments',\n                    url     : 'visualization/gie_list',\n                    target  : 'galaxy_main'\n                }\n            ]\n        });\n\n        //\n        // Admin.\n        //\n        Galaxy.user.get( 'is_admin' ) && this.add({\n            id              : 'admin',\n            title           : 'Admin',\n            url             : 'admin',\n            tooltip         : 'Administer this Galaxy',\n            cls             : 'admin-only'\n        });\n\n        //\n        // Help tab.\n        //\n        var helpTab = {\n            id              : 'help',\n            title           : 'Help',\n            tooltip         : 'Support, contact, and community hubs',\n            menu            : [{\n                    title   : 'Support',\n                    url     : options.support_url,\n                    target  : '_blank'\n                },{\n                    title   : 'Search',\n                    url     : options.search_url,\n                    target  : '_blank'\n                },{\n                    title   : 'Mailing Lists',\n                    url     : options.mailing_lists,\n                    target  : '_blank'\n                },{\n                    title   : 'Videos',\n                    url     : options.screencasts_url,\n                    target  : '_blank'\n                },{\n                    title   : 'Wiki',\n                    url     : options.wiki_url,\n                    target  : '_blank'\n                },{\n                    title   : 'How to Cite Galaxy',\n                    url     : options.citation_url,\n                    target  : '_blank'\n                },{\n                    title   : 'Interactive Tours',\n                    url     : 'tours',\n                    onclick : function(){\n                        if (Galaxy.app){\n                            Galaxy.app.display(new Tours.ToursView());\n                        } else {\n                            // Redirect and use clientside routing to go to tour index\n                            window.location = Galaxy.root + \"tours\";\n                        }\n                    }\n            }]\n        };\n        options.terms_url && helpTab.menu.push({\n            title   : 'Terms and Conditions',\n            url     : options.terms_url,\n            target  : '_blank'\n        });\n        options.biostar_url && helpTab.menu.unshift({\n            title   : 'Ask a question',\n            url     : 'biostar/biostar_question_redirect',\n            target  : '_blank'\n        });\n        options.biostar_url && helpTab.menu.unshift({\n            title   : 'Galaxy Biostar',\n            url     : options.biostar_url_redirect,\n            target  : '_blank'\n        });\n        this.add( helpTab );\n\n        //\n        // User tab.\n        //\n        if ( !Galaxy.user.id ){\n            var userTab = {\n                id              : 'user',\n                title           : 'User',\n                cls             : 'loggedout-only',\n                tooltip         : 'Account registration or login',\n                menu            : [{\n                    title       : 'Login',\n                    url         : 'user/login',\n                    target      : 'galaxy_main'\n                }]\n            };\n            options.allow_user_creation && userTab.menu.push({\n                title   : 'Register',\n                url     : 'user/create',\n                target  : 'galaxy_main'\n            });\n            this.add( userTab );\n        } else {\n            var userTab = {\n                id              : 'user',\n                title           : 'User',\n                cls             : 'loggedin-only',\n                tooltip         : 'Account preferences and saved data',\n                menu            : [{\n                        title   : 'Logged in as ' + Galaxy.user.get( 'email' )\n                    },{\n                        title   : 'Preferences',\n                        url     : 'user?cntrller=user',\n                        target  : 'galaxy_main'\n                    },{\n                        title   : 'Custom Builds',\n                        url     : 'user/dbkeys',\n                        target  : 'galaxy_main'\n                    },{\n                        title   : 'Logout',\n                        url     : 'user/logout',\n                        target  : '_top',\n                        divider : true\n                    },{\n                        title   : 'Saved Histories',\n                        url     : 'history/list',\n                        target  : 'galaxy_main'\n                    },{\n                        title   : 'Saved Datasets',\n                        url     : 'dataset/list',\n                        target  : 'galaxy_main'\n                    },{\n                        title   : 'Saved Pages',\n                        url     : 'page/list',\n                        target  : '_top'\n                    },{\n                        title   : 'API Keys',\n                        url     : 'user/api_keys?cntrller=user',\n                        target  : 'galaxy_main'\n                }]\n            };\n            options.use_remote_user && userTab.menu.push({\n                title   : 'Public Name',\n                url     : 'user/edit_username?cntrller=user',\n                target  : 'galaxy_main'\n            });\n            this.add( userTab );\n        }\n        var activeView = this.get( options.active_view );\n        activeView && activeView.set( 'active', true );\n        return new jQuery.Deferred().resolve().promise();\n    }\n});\n\n/** Masthead tab **/\nvar Tab = Backbone.View.extend({\n    initialize: function ( options ) {\n        this.model = options.model;\n        this.setElement( this._template() );\n        this.$dropdown  = this.$( '.dropdown' );\n        this.$toggle    = this.$( '.dropdown-toggle' );\n        this.$menu      = this.$( '.dropdown-menu' );\n        this.$note      = this.$( '.dropdown-note' );\n        this.listenTo( this.model, 'change', this.render, this );\n    },\n\n    events: {\n        'click .dropdown-toggle' : '_toggleClick'\n    },\n\n    render: function() {\n        var self = this;\n        $( '.tooltip' ).remove();\n        this.$el.attr( 'id', this.model.id )\n                .css( { visibility : this.model.get( 'visible' ) && 'visible' || 'hidden' } );\n        this.model.set( 'url', this._formatUrl( this.model.get( 'url' ) ) );\n        this.$note.html( this.model.get( 'note' ) || '' )\n                  .removeClass().addClass( 'dropdown-note' )\n                  .addClass( this.model.get( 'note_cls' ) )\n                  .css( { 'display' : this.model.get( 'show_note' ) && 'block' || 'none' } )\n        this.$toggle.html( this.model.get( 'title' ) || '' )\n                    .removeClass().addClass( 'dropdown-toggle' )\n                    .addClass( this.model.get( 'cls' ) )\n                    .addClass( this.model.get( 'icon' ) && 'dropdown-icon fa ' + this.model.get( 'icon' ) )\n                    .addClass( this.model.get( 'toggle' ) && 'toggle' )\n                    .attr( 'target', this.model.get( 'target' ) )\n                    .attr( 'href', this.model.get( 'url' ) )\n                    .attr( 'title', this.model.get( 'tooltip' ) )\n                    .tooltip( 'destroy' );\n        this.model.get( 'tooltip' ) && this.$toggle.tooltip( { placement: 'bottom' } );\n        this.$dropdown.removeClass().addClass( 'dropdown' )\n                      .addClass( this.model.get( 'disabled' ) && 'disabled' )\n                      .addClass( this.model.get( 'active' ) && 'active' );\n        if ( this.model.get( 'menu' ) && this.model.get( 'show_menu' ) ) {\n            this.$menu.show();\n            $( '#dd-helper' ).show().off().on( 'click',  function() {\n                $( '#dd-helper' ).hide();\n                self.model.set( 'show_menu', false );\n            });\n        } else {\n            self.$menu.hide();\n            $( '#dd-helper' ).hide();\n        }\n        this.$menu.empty().removeClass( 'dropdown-menu' );\n        if ( this.model.get( 'menu' ) ) {\n            _.each( this.model.get( 'menu' ), function( menuItem ) {\n                self.$menu.append( self._buildMenuItem( menuItem ) );\n                menuItem.divider && self.$menu.append( $( '<li/>' ).addClass( 'divider' ) );\n            });\n            self.$menu.addClass( 'dropdown-menu' );\n            self.$toggle.append( $( '<b/>' ).addClass( 'caret' ) );\n        }\n        return this;\n    },\n\n    /** Add new menu item */\n    _buildMenuItem: function ( options ) {\n        var self = this;\n        options = _.defaults( options || {}, {\n            title       : '',\n            url         : '',\n            target      : '_parent'\n        });\n        options.url = self._formatUrl( options.url );\n        return $( '<li/>' ).append(\n            $( '<a/>' ).attr( 'href', options.url )\n                       .attr( 'target', options.target )\n                       .html( options.title )\n                       .on( 'click', function( e ) {\n                            e.preventDefault();\n                            self.model.set( 'show_menu', false );\n                            if (options.onclick){\n                                options.onclick();\n                            } else {\n                                Galaxy.frame.add( options );\n                            }\n                       })\n        );\n    },\n\n    /** Handle click event */\n    _toggleClick: function( e ) {\n        var self = this;\n        var model = this.model;\n        e.preventDefault();\n        $( '.tooltip' ).hide();\n        model.trigger( 'dispatch', function( m ) {\n            model.id !== m.id && m.get( 'menu' ) && m.set( 'show_menu', false );\n        });\n        if ( !model.get( 'disabled' ) ) {\n            if ( !model.get( 'menu' ) ) {\n                model.get( 'onclick' ) ? model.get( 'onclick' )() : Galaxy.frame.add( model.attributes );\n            } else {\n                model.set( 'show_menu', true );\n            }\n        } else {\n            function buildLink( label, url ) {\n                return $( '<div/>' ).append( $( '<a/>' ).attr( 'href', Galaxy.root + url ).html( label ) ).html()\n            }\n            this.$toggle.popover && this.$toggle.popover( 'destroy' );\n            this.$toggle.popover({\n                html        : true,\n                placement   : 'bottom',\n                content     : 'Please ' + buildLink( 'login', 'user/login?use_panels=True' ) + ' or ' +\n                                          buildLink( 'register', 'user/create?use_panels=True' ) + ' to use this feature.'\n            }).popover( 'show' );\n            setTimeout( function() { self.$toggle.popover( 'destroy' ) }, 5000 );\n        }\n    },\n\n    /** Url formatting */\n    _formatUrl: function( url ) {\n        return typeof url == 'string' && url.indexOf( '//' ) === -1 && url.charAt( 0 ) != '/' ? Galaxy.root + url : url;\n    },\n\n    /** body tempate */\n    _template: function () {\n        return  '<ul class=\"nav navbar-nav\">' +\n                    '<li class=\"dropdown\">' +\n                        '<a class=\"dropdown-toggle\"/>' +\n                        '<ul class=\"dropdown-menu\"/>' +\n                        '<div class=\"dropdown-note\"/>' +\n                    '</li>' +\n                '</ul>';\n    }\n});\n\nreturn {\n    Collection  : Collection,\n    Tab         : Tab\n};\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/layout/menu.js\n **/","define([\n    'layout/masthead',\n    'layout/panel',\n    'mvc/ui/ui-modal',\n    'mvc/base-mvc'\n], function( Masthead, Panel, Modal, BaseMVC ) {\n\n// ============================================================================\nvar PageLayoutView = Backbone.View.extend( BaseMVC.LoggableMixin ).extend({\n    _logNamespace : 'layout',\n\n    el : 'body',\n    className : 'full-content',\n\n    _panelIds : [\n        'left', 'center', 'right'\n    ],\n\n    defaultOptions : {\n        message_box_visible     : false,\n        message_box_content     : '',\n        message_box_class       : 'info',\n        show_inactivity_warning : false,\n        inactivity_box_content  : ''\n    },\n\n    initialize : function( options ) {\n        // TODO: remove globals\n        this.log( this + '.initialize:', options );\n        _.extend( this, _.pick( options, this._panelIds ) );\n        this.options = _.defaults( _.omit( options.config, this._panelIds ), this.defaultOptions );\n        Galaxy.modal = this.modal = new Modal.View();\n        this.masthead = new Masthead.View( this.options );\n        this.$el.attr( 'scroll', 'no' );\n        this.$el.html( this._template() );\n        this.$el.append( this.masthead.frame.$el );\n        this.$( '#masthead' ).replaceWith( this.masthead.$el );\n        this.$el.append( this.modal.$el );\n        this.$messagebox = this.$( '#messagebox' );\n        this.$inactivebox = this.$( '#inactivebox' );\n    },\n\n    render : function() {\n        // TODO: Remove this line after select2 update\n        $( '.select2-hidden-accessible' ).remove();\n        this.log( this + '.render:' );\n        this.masthead.render();\n        this.renderMessageBox();\n        this.renderInactivityBox();\n        this.renderPanels();\n        return this;\n    },\n\n    /** Render message box */\n    renderMessageBox : function() {\n        if ( this.options.message_box_visible ){\n            var content = this.options.message_box_content || '';\n            var level = this.options.message_box_class || 'info';\n            this.$el.addClass( 'has-message-box' );\n            this.$messagebox\n                .attr( 'class', 'panel-' + level + '-message' )\n                .html( content )\n                .toggle( !!content )\n                .show();\n        } else {\n            this.$el.removeClass( 'has-message-box' );\n            this.$messagebox.hide();\n        }\n        return this;\n    },\n\n    /** Render inactivity warning */\n    renderInactivityBox : function() {\n        if( this.options.show_inactivity_warning ){\n            var content = this.options.inactivity_box_content || '';\n            var verificationLink = $( '<a/>' ).attr( 'href', Galaxy.root + 'user/resend_verification' ).text( 'Resend verification' );\n            this.$el.addClass( 'has-inactivity-box' );\n            this.$inactivebox\n                .html( content + ' ' )\n                .append( verificationLink )\n                .toggle( !!content )\n                .show();\n        } else {\n            this.$el.removeClass( 'has-inactivity-box' );\n            this.$inactivebox.hide();\n        }\n        return this;\n    },\n\n    /** Render panels */\n    renderPanels : function() {\n        var page = this;\n        this._panelIds.forEach( function( panelId ){\n            if( _.has( page, panelId ) ){\n                page[ panelId ].setElement( '#' + panelId );\n                page[ panelId ].render();\n            }\n        });\n        if( !this.left ){\n            this.center.$el.css( 'left', 0 );\n        }\n        if( !this.right ){\n            this.center.$el.css( 'right', 0 );\n        }\n        return this;\n    },\n\n    /** body template */\n    _template: function() {\n        return [\n            '<div id=\"everything\">',\n                '<div id=\"background\"/>',\n                '<div id=\"masthead\"/>',\n                '<div id=\"messagebox\"/>',\n                '<div id=\"inactivebox\" class=\"panel-warning-message\" />',\n                this.left?   '<div id=\"left\" />' : '',\n                this.center? '<div id=\"center\" class=\"inbound\" />' : '',\n                this.right?  '<div id=\"right\" />' : '',\n            '</div>',\n            '<div id=\"dd-helper\" />',\n        ].join('');\n    },\n\n    /** hide both side panels if previously shown */\n    hideSidePanels : function(){\n        if( this.left ){\n            this.left.hide();\n        }\n        if( this.right ){\n            this.right.hide();\n        }\n    },\n\n    toString : function() { return 'PageLayoutView'; }\n});\n\n// ============================================================================\n    return {\n        PageLayoutView: PageLayoutView\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/layout/page.js\n **/","/** Frame manager uses the ui-frames to create the scratch book masthead icon and functionality **/\ndefine([ 'mvc/ui/ui-frames' ], function( Frames ) {\nreturn Backbone.View.extend({\n    initialize : function( options ) {\n        var self = this;\n        options = options || {};\n        this.frames = new Frames.View({ visible : false });\n        this.setElement( this.frames.$el );\n        this.buttonActive = options.collection.add({\n            id              : 'enable-scratchbook',\n            icon            : 'fa-th',\n            tooltip         : 'Enable/Disable Scratchbook',\n            onclick         : function() {\n                self.active = !self.active;\n                self.buttonActive.set({\n                    toggle    : self.active,\n                    show_note : self.active,\n                    note_cls  : self.active && 'fa fa-check'\n                });\n                !self.active && self.frames.hide();\n            },\n            onbeforeunload  : function() {\n                if ( self.frames.length() > 0 ) {\n                    return 'You opened ' + self.frames.length() + ' frame(s) which will be lost.';\n                }\n            }\n        });\n        this.buttonLoad = options.collection.add({\n            id              : 'show-scratchbook',\n            icon            : 'fa-eye',\n            tooltip         : 'Show/Hide Scratchbook',\n            show_note       : true,\n            visible         : false,\n            onclick         : function( e ) {\n                self.frames.visible ? self.frames.hide() : self.frames.show();\n            }\n        });\n        this.frames.on( 'add remove', function() {\n            this.visible && this.length() == 0 && this.hide();\n            self.buttonLoad.set( { 'note': this.length(), 'visible': this.length() > 0 } );\n        }).on( 'show hide ', function() {\n            self.buttonLoad.set( { 'toggle': this.visible, 'icon': this.visible && 'fa-eye' || 'fa-eye-slash' } );\n        });\n        this.history_cache = {};\n    },\n\n    /** Add a dataset to the frames */\n    addDataset: function( dataset_id ) {\n        var self = this;\n        var current_dataset = null;\n        if ( Galaxy && Galaxy.currHistoryPanel ) {\n            var history_id = Galaxy.currHistoryPanel.collection.historyId;\n            this.history_cache[ history_id ] = { name: Galaxy.currHistoryPanel.model.get( 'name' ), dataset_ids: [] };\n            Galaxy.currHistoryPanel.collection.each( function( model ) {\n                !model.get( 'deleted' ) && model.get( 'visible' ) && self.history_cache[ history_id ].dataset_ids.push( model.get( 'id' ) );\n            });\n        }\n        var _findDataset = function( dataset, offset ) {\n            if ( dataset ) {\n                var history_details = self.history_cache[ dataset.get( 'history_id' ) ];\n                if ( history_details && history_details.dataset_ids ) {\n                    var dataset_list = history_details.dataset_ids;\n                    var pos = dataset_list.indexOf( dataset.get( 'id' ) );\n                    if ( pos !== -1 && pos + offset >= 0 && pos + offset < dataset_list.length ) {\n                        return dataset_list[ pos + offset ];\n                    }\n                }\n            }\n        };\n        var _loadDatasetOffset = function( dataset, offset, frame ) {\n            var new_dataset_id = _findDataset( dataset, offset );\n            if ( new_dataset_id ) {\n                self._loadDataset( new_dataset_id, function( new_dataset, config ) {\n                    current_dataset = new_dataset;\n                    frame.model.set( config );\n                });\n            } else {\n                frame.model.trigger( 'change' );\n            }\n        }\n        this._loadDataset( dataset_id, function( dataset, config ) {\n            current_dataset = dataset;\n            self.add( _.extend( { menu: [ { icon     : 'fa fa-chevron-circle-left',\n                                            tooltip  : 'Previous in History',\n                                            onclick  : function( frame ) { _loadDatasetOffset( current_dataset, -1, frame ) },\n                                            disabled : function() { return !_findDataset( current_dataset, -1 ) } },\n                                          { icon     : 'fa fa-chevron-circle-right',\n                                            tooltip  : 'Next in History',\n                                            onclick  : function( frame ) { _loadDatasetOffset( current_dataset, 1, frame ) },\n                                            disabled : function() { return !_findDataset( current_dataset, 1 ) } } ] }, config ) )\n        });\n    },\n\n    _loadDataset: function( dataset_id, callback ) {\n        var self = this;\n        require([ 'mvc/dataset/data' ], function( DATA ) {\n            var dataset = new DATA.Dataset( { id : dataset_id } );\n            $.when( dataset.fetch() ).then( function() {\n                var is_tabular = _.find( [ 'tabular', 'interval' ] , function( data_type ) {\n                    return dataset.get( 'data_type' ).indexOf( data_type ) !== -1;\n                });\n                var title = dataset.get( 'name' );\n                var history_details = self.history_cache[ dataset.get( 'history_id' ) ];\n                if ( history_details ) {\n                    title = history_details.name + ': ' + title;\n                }\n                callback( dataset, is_tabular ? {\n                    title   : title,\n                    url     : null,\n                    content : DATA.createTabularDatasetChunkedView({\n                        model       : new DATA.TabularDataset( dataset.toJSON() ),\n                        embedded    : true,\n                        height      : '100%'\n                    }).$el\n                } : {\n                    title   : title,\n                    url     : Galaxy.root + 'datasets/' + dataset_id + '/display/?preview=True',\n                    content : null\n                } );\n            });\n        });\n    },\n\n    /** Add a trackster visualization to the frames. */\n    addTrackster: function(viz_id) {\n        var self = this;\n        require(['viz/visualization', 'viz/trackster'], function(visualization, trackster) {\n            var viz = new visualization.Visualization({id: viz_id});\n            $.when( viz.fetch() ).then( function() {\n                var ui = new trackster.TracksterUI(Galaxy.root);\n\n                // Construct frame config based on dataset's type.\n                var frame_config = {\n                        title: viz.get('name'),\n                        type: 'other',\n                        content: function(parent_elt) {\n                            // Create view config.\n                            var view_config = {\n                                container: parent_elt,\n                                name: viz.get('title'),\n                                id: viz.id,\n                                // FIXME: this will not work with custom builds b/c the dbkey needed to be encoded.\n                                dbkey: viz.get('dbkey'),\n                                stand_alone: false\n                            },\n                            latest_revision = viz.get('latest_revision'),\n                            drawables = latest_revision.config.view.drawables;\n\n                            // Set up datasets in drawables.\n                            _.each(drawables, function(d) {\n                                d.dataset = {\n                                    hda_ldda: d.hda_ldda,\n                                    id: d.dataset_id\n                                };\n                            });\n                            view = ui.create_visualization(view_config,\n                                                           latest_revision.config.viewport,\n                                                           latest_revision.config.view.drawables,\n                                                           latest_revision.config.bookmarks,\n                                                           false);\n                        }\n                    };\n                self.add(frame_config);\n            });\n        });\n    },\n\n    /** Add and display a new frame/window based on options. */\n    add: function( options ) {\n        if ( options.target == '_blank' ) {\n            window.open( options.url );\n        } else if ( options.target == '_top' || options.target == '_parent' || options.target == '_self' ) {\n            window.location = options.url;\n        } else if ( !this.active ) {\n            var $galaxy_main = $( window.parent.document ).find( '#galaxy_main' );\n            if ( options.target == 'galaxy_main' || options.target == 'center' ) {\n                if ( $galaxy_main.length === 0 ) {\n                    window.location = options.url + ( href.indexOf( '?' ) == -1 ? '?' : '&' ) + 'use_panels=True';\n                } else {\n                    $galaxy_main.attr( 'src', options.url );\n                }\n            } else\n                window.location = options.url;\n        } else {\n            this.frames.add( options );\n        }\n    }\n});\n\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/layout/scratchbook.js\n **/","/**\n * Parser.js\n * Copyright 2012-13 Mayank Lahiri\n * mlahiri@gmail.com\n * Released under the BSD License.\n *\n * A forgiving Bibtex parser that can:\n * \n * (1) operate in streaming or block mode, extracting entries as dictionaries. \n * (2) convert Latex special characters to UTF-8.\n * (3) best-effort parse malformed entries.\n * (4) run in a CommonJS environment or a browser, without any dependencies.\n * (5) be advanced-compiled by Google Closure Compiler.\n * \n * Handwritten as a labor of love, not auto-generated from a grammar. \n *\n * Modes of usage:\n *\n * (1) Synchronous, string\n *\n *   var entries = BibtexParser(text);\n *   console.log(entries);\n *\n * (2) Asynchronous, stream\n *\n *   var entryCallback = function(entry) { console.log(entry); }\n *   var parser = new BibtexParser(entryCallback);\n *   parser.parse(chunk1);\n *   parser.parse(chunk2);\n *   ...\n * \n * @param {text|function(Object)} arg Either a Bibtex string or callback \n *                                    function for processing parsed entries.\n * @constructor\n */\nfunction BibtexParser(arg0) {\n  // Determine how this function is to be used\n  if (typeof arg0 == 'string') {\n    // Passed a string, synchronous call without 'new'\n    var tempStorage = {};\n    var entries = [];\n    function accumulator(entry) {\n      entries.push(entry);\n    }\n    var parser = BibtexParser.call(tempStorage, accumulator);\n    parser.parse(arg0);\n    return {\n      'entries':    entries,\n      'errors':     parser.getErrors()\n    }\n  }\n  if (typeof arg0 != 'function') {\n    throw 'Invalid parser construction.';\n  }\n\n  /** @enum {number} */\n  this.STATES_ = {\n    ENTRY_OR_JUNK:    0,\n    OBJECT_TYPE:      1,\n    ENTRY_KEY:        2, \n    KV_KEY:           3, \n    EQUALS:           4,\n    KV_VALUE:         5 \n  }\n  /** @private */ this.DATA_          = {};\n  /** @private */ this.CALLBACK_      = arg0;\n  /** @private */ this.CHAR_          = 0;\n  /** @private */ this.LINE_          = 1;\n  /** @private */ this.CHAR_IN_LINE_  = 0;\n  /** @private */ this.SKIPWS_        = true;\n  /** @private */ this.SKIPCOMMENT_   = true;\n  /** @private */ this.PARSETMP_      = {};\n  /** @private */ this.SKIPTILLEOL_   = false;\n  /** @private */ this.VALBRACES_     = null;\n  /** @private */ this.BRACETYPE_     = null;\n  /** @private */ this.BRACECOUNT_    = 0;\n  /** @private */ this.STATE_         = this.STATES_.ENTRY_OR_JUNK;\n  /** @private */ this.ERRORS_        = [];\n  /** @private */ this.ENTRY_TYPES_   = {\n    'inproceedings'     : 1,\n    'proceedings'       : 2,\n    'article'           : 3,\n    'techreport'        : 4,\n    'misc'              : 5,\n    'mastersthesis'     : 6,\n    'book'              : 7,\n    'phdthesis'         : 8,\n    'incollection'      : 9,\n    'unpublished'       : 10,\n    'inbook'            : 11,\n    'manual'            : 12,\n    'periodical'        : 13,\n    'booklet'           : 14,\n    'masterthesis'      : 15,\n    'conference'        : 16\n    ,'online'           : 998 // Galaxy MOD: Handle @online entries for preprints.\n    ,'data'             : 999 // Galaxy MOD: Handle @data citations coming from figshare.\n  }\n  /** @private */ this.MACROS_        = {\n    'jan'               : 'January',\n    'feb'               : 'February',\n    'mar'               : 'March',\n    'apr'               : 'April',\n    'may'               : 'May',\n    'jun'               : 'June',\n    'jul'               : 'July',\n    'aug'               : 'August',\n    'sep'               : 'September',\n    'oct'               : 'October',\n    'nov'               : 'November',\n    'dec'               : 'December',\n    'Jan'               : 'January',\n    'Feb'               : 'February',\n    'Mar'               : 'March',\n    'Apr'               : 'April',\n    'May'               : 'May',\n    'Jun'               : 'June',\n    'Jul'               : 'July',\n    'Aug'               : 'August',\n    'Sep'               : 'September',\n    'Oct'               : 'October',\n    'Nov'               : 'November',\n    'Dec'               : 'December'\n  }\n\n  /**\n   * Gets an array of all errors encountered during parsing.\n   * Array entries are of the format:\n   *  [ line number, character in line, character in stream, error text ]\n   *\n   * @returns Array<Array>\n   * @public\n   */\n  this.getErrors = function() {\n    return this.ERRORS_;\n  }\n\n  /**\n   * Processes a chunk of data\n   * @public\n   */\n  this.parse = function(chunk) {\n    for (var i = 0; i < chunk.length; i++)\n      this.processCharacter_(chunk[i]);\n  }\n\n  /**\n   * Logs error at current stream position.\n   *\n   * @private\n   */\n  this.error_ = function(text) {\n    this.ERRORS_.push([ this.LINE_, \n                        this.CHAR_IN_LINE_,\n                        this.CHAR_,\n                        text ])\n  }\n\n  /**\n   * Called after an entire entry has been parsed from the stream.\n   * Performs post-processing and invokes the entry callback pointed to by\n   * this.CALLBACK_. Parsed (but unprocessed) entry data is in this.DATA_.\n   */\n  this.processEntry_ = function() {\n    var data = this.DATA_;\n    if (data.Fields) \n      for (var f in data.Fields) {\n        var raw = data.Fields[f];\n\n        // Convert Latex/Bibtex special characters to UTF-8 equivalents\n        for (var i = 0; i < this.CHARCONV_.length; i++) {\n          var re = this.CHARCONV_[i][0];\n          var rep = this.CHARCONV_[i][1];\n          raw = raw.replace(re, rep);\n        }\n\n        // Basic substitutions\n        raw = raw.replace(/[\\n\\r\\t]/g, ' ')\n                 .replace(/\\s\\s+/g, ' ')\n                 .replace(/^\\s+|\\s+$/g, '')\n\n        // Remove braces and backslashes\n        var len = raw.length;\n        var processed = '';\n        for (var i = 0; i < len; i++) {\n          var c = raw[i];\n          var skip = false;\n          if (c == '\\\\' && i < len-1) \n            c = raw[++i];\n          else {\n            if (c == '{' || c == '}')\n              skip = true;\n          }\n          if (!skip)\n            processed += c;\n        }\n        data.Fields[f] = processed\n      }\n\n    if (data.ObjectType == 'string') {\n      for (var f in data.Fields) {  \n        this.MACROS_[f] = data.Fields[f];\n      }\n    } else {\n      // Parsed a new Bibtex entry\n      this.CALLBACK_(data);\n    }\n  }\n\n\n  /**\n   * Processes next character in the stream, invoking the callback after \n   * each entry has been found and processed.\n   * \n   * @private\n   * @param {string} c Next character in input stream\n   */\n  this.processCharacter_ = function(c) {\n    // Housekeeping\n    this.CHAR_++;\n    this.CHAR_IN_LINE_++;\n    if (c == '\\n') {\n      this.LINE_++;\n      this.CHAR_IN_LINE_ = 1;\n    }\n\n    // Convenience states for skipping whitespace when needed\n    if (this.SKIPTILLEOL_) {\n      if (c == '\\n')\n        this.SKIPTILLEOL_ = false;\n      return;\n    }\n    if (this.SKIPCOMMENT_ && c == '%') {\n      this.SKIPTILLEOL_ = true;\n      return;\n    }\n    if (this.SKIPWS_ && /\\s/.test(c))\n      return;\n    this.SKIPWS_ = false;\n    this.SKIPCOMMENT_ = false;\n    this.SKIPTILLEOL_ = false;\n\n    // Main state machine\n    var AnotherIteration = true;\n    while (AnotherIteration) {\n      //console.log(this.LINE_, this.CHAR_IN_LINE_, this.STATE_, c)\n      AnotherIteration = false;\n      switch(this.STATE_) {\n        // -- Scan for an object marker ('@')\n        // -- Reset temporary data structure in case previous entry was garbled\n        case this.STATES_.ENTRY_OR_JUNK:\n          if (c == '@') {\n            // SUCCESS:     Parsed a valid start-of-object marker.\n            // NEXT_STATE:  OBJECT_TYPE\n            this.STATE_ = this.STATES_.OBJECT_TYPE;\n            this.DATA_ = {\n              ObjectType    : ''\n            };\n          }\n          this.BRACETYPE_   = null;\n          this.SKIPWS_      = true;\n          this.SKIPCOMMENT_ = true;\n          break;\n\n        // Start at first non-whitespace character after start-of-object '@'\n        // -- Accept [A-Za-z], break on non-matching character\n        // -- Populate this.DATA_.EntryType and this.DATA_.ObjectType\n        case this.STATES_.OBJECT_TYPE:\n          if (/[A-Za-z]/.test(c)) {\n            this.DATA_.ObjectType += c.toLowerCase();\n            this.SKIPWS_      = true;\n            this.SKIPCOMMENT_ = true;\n          } else {\n            // Break from state and validate object type\n            var ot = this.DATA_.ObjectType;\n            if (ot == 'comment') {\n              this.STATE_ = this.STATES_.ENTRY_OR_JUNK;\n            } else {\n              if (ot == 'string') {\n                this.DATA_.ObjectType = ot;\n                this.DATA_.Fields = {};\n                this.BRACETYPE_ = c;\n                this.BRACECOUNT_ = 1;\n                this.STATE_ = this.STATES_.KV_KEY;\n                this.SKIPWS_      = true;\n                this.SKIPCOMMENT_ = true;\n                this.PARSETMP_ = {\n                  Key:    ''\n                }\n              } else {\n                if (ot == 'preamble') {\n                  this.STATE_ = this.STATES_.ENTRY_OR_JUNK;\n                } else {\n                  if (ot in this.ENTRY_TYPES_) {\n                    // SUCCESS:     Parsed a valid object type.\n                    // NEXT_STATE:  ENTRY_KEY\n                    this.DATA_.ObjectType = 'entry';\n                    this.DATA_.EntryType  = ot;\n                    this.DATA_.EntryKey   = '';\n                    this.STATE_           = this.STATES_.ENTRY_KEY;\n                    AnotherIteration      = true;\n                  } else {\n                    // ERROR:       Unrecognized object type.\n                    // NEXT_STATE:  ENTRY_OR_JUNK\n                    this.error_('Unrecognized object type: \"' +\n                                this.DATA_.ObjectType + '\"')\n                    this.STATE_ = this.STATES_.ENTRY_OR_JUNK;\n                  }\n                }\n              }\n            }\n          }\n          break;\n\n          // Start at first non-alphabetic character after an entry type\n          // -- Populate this.DATA_.EntryKey\n          case this.STATES_.ENTRY_KEY:\n            if ((c === '{' || c === '(') && this.BRACETYPE_ == null) {\n              this.BRACETYPE_   = c;\n              this.BRACECOUNT_  = 1;\n              this.SKIPWS_      = true;\n              this.SKIPCOMMENT_ = true;\n              break;\n            }\n            if (/[,%\\s]/.test(c)) {\n              if (this.DATA_.EntryKey.length < 1) { \n                // Skip comments and whitespace before entry key\n                this.SKIPWS_      = true;\n                this.SKIPCOMMENT_ = true;\n              } else {\n                if (this.BRACETYPE_ == null) {\n                  // ERROR:       No opening brace for object\n                  // NEXT_STATE:  ENTRY_OR_JUNK\n                  this.error_('No opening brace for object.');\n                  this.STATE_ = this.STATES_.ENTRY_OR_JUNK;\n                } else {\n                  // SUCCESS:     Parsed an entry key\n                  // NEXT_STATE:  KV_KEY\n                  this.SKIPWS_      = true;\n                  this.SKIPCOMMENT_ = true;\n                  AnotherIteration  = true;\n                  this.STATE_       = this.STATES_.KV_KEY;\n                  this.PARSETMP_.Key= '';\n                  this.DATA_.Fields = {};\n                }\n              }\n            } else {\n              this.DATA_.EntryKey += c;\n              this.SKIPWS_        = false;\n              this.SKIPCOMMENT_   = false;\n            }\n            break;\n\n          // Start at first non-whitespace/comment character after entry key.\n          // -- Populate this.PARSETMP_.Key\n          case this.STATES_.KV_KEY:\n            // Test for end of entry\n            if ((c == '}' && this.BRACETYPE_ == '{') ||\n                (c == ')' && this.BRACETYPE_ == '(')) {\n              // SUCCESS:       Parsed an entry, possible incomplete\n              // NEXT_STATE:    ENTRY_OR_JUNK\n              this.processEntry_();\n              this.SKIPWS_      = true;\n              this.SKIPCOMMENT_ = true;\n              this.STATE_ = this.STATES_.ENTRY_OR_JUNK;\n              break;\n            }\n            if (/[\\-A-Za-z:]/.test(c)) {\n              // Add to key\n              this.PARSETMP_.Key  += c;\n              this.SKIPWS_        = false;\n              this.SKIPCOMMENT_   = false;\n            } else {\n              // Either end of key or we haven't encountered start of key\n              if (this.PARSETMP_.Key.length < 1) {\n                // Keep going till we see a key\n                this.SKIPWS_      = true;\n                this.SKIPCOMMENT_ = true;\n              } else {\n                // SUCCESS:       Found full key in K/V pair\n                // NEXT_STATE:    EQUALS\n                this.SKIPWS_      = true;\n                this.SKIPCOMMENT_ = true;\n                this.STATE_       = this.STATES_.EQUALS;\n                AnotherIteration  = true;\n              }\n            }\n            break;\n\n          // Start at first non-alphabetic character after K/V pair key.\n          case this.STATES_.EQUALS:\n            if ((c == '}' && this.BRACETYPE_ == '{') ||\n                (c == ')' && this.BRACETYPE_ == '(')) {\n              // ERROR:         K/V pair with key but no value\n              // NEXT_STATE:    ENTRY_OR_JUNK\n              this.error_('Key-value pair has key \"' +\n                          this.PARSETMP_.Key + '\", but no value.');\n              this.processEntry_();\n              this.SKIPWS_      = true;\n              this.SKIPCOMMENT_ = true;\n              this.STATE_ = this.STATES_.ENTRY_OR_JUNK;\n              break;\n            }\n            if (c == '=') {\n              // SUCCESS:       found an equal signs separating key and value\n              // NEXT_STATE:    KV_VALUE\n              this.SKIPWS_          = true;\n              this.SKIPCOMMENT_     = true;\n              this.STATE_           = this.STATES_.KV_VALUE;\n              this.PARSETMP_.Value  = '';\n              this.VALBRACES_       = { '\"' : [], '{' : [] };\n            }\n            break;\n\n          // Start at first non-whitespace/comment character after '=' \n          // -- Populate this.PARSETMP_.Value\n          case this.STATES_.KV_VALUE:\n            var delim             = this.VALBRACES_;\n            var val               = this.PARSETMP_.Value;\n            var doneParsingValue  = false;\n\n            // Test for special characters\n            if (c == '\"' || c == '{' || c == '}' || c == ',') {\n              if (c == ',') {\n                // This comma can mean:\n                // (1) just another comma literal\n                // (2) end of a macro reference\n                if (0 === delim['\"'].length + delim['{'].length) {\n                  // end of a macro reference\n                  var macro = this.PARSETMP_.Value.trim();\n                  if (macro in this.MACROS_) {\n                    // Successful macro reference\n                    this.PARSETMP_.Value = this.MACROS_[macro];\n                  } else {\n                    // Reference to an undefined macro\n                    this.error_('Reference to an undefined macro: '+macro);\n                  }\n                  doneParsingValue = true;\n                }\n              }\n              if (c == '\"') {\n                // This quote can mean:\n                // (1) opening delimiter\n                // (2) closing delimiter\n                // (3) literal, if we have a '{' on the stack\n                if (0 === delim['\"'].length + delim['{'].length) {\n                  // opening delimiter\n                  delim['\"'].push(this.CHAR_)\n                  this.SKIPWS_        = false;\n                  this.SKIPCOMMENT_   = false;\n                  break;\n                }\n                if (delim['\"'].length == 1 && delim['{'].length == 0 &&\n                    (val.length==0 || val[val.length-1] != '\\\\')) {\n                  // closing delimiter\n                  doneParsingValue = true;\n                } else {\n                  // literal, add to value\n                }\n              }\n              if (c == '{') {\n                // This brace can mean:\n                // (1) opening delimiter\n                // (2) stacked verbatim delimiter\n                if (val.length == 0 || val[val.length-1] != '\\\\') {\n                  delim['{'].push(this.CHAR_)\n                  this.SKIPWS_        = false;\n                  this.SKIPCOMMENT_   = false;\n                } else {\n                  // literal, add to value\n                }\n              }\n              if (c == '}') {\n                // This brace can mean:\n                // (1) closing delimiter\n                // (2) closing stacked verbatim delimiter\n                // (3) end of object definition if value was a macro\n                if (0 === delim['\"'].length + delim['{'].length) {\n                  // end of object definition, after macro\n                  var macro = this.PARSETMP_.Value.trim();\n                  if (macro in this.MACROS_) {\n                    // Successful macro reference\n                    this.PARSETMP_.Value = this.MACROS_[macro];\n                  } else {\n                    // Reference to an undefined macro\n                    this.error_('Reference to an undefined macro: '+macro);\n                  }\n                  AnotherIteration = true;\n                  doneParsingValue = true;\n                } else {\n                  if (val.length == 0 || val[val.length-1] != '\\\\') {\n                    if (delim['{'].length > 0) {\n                      // pop stack for stacked verbatim delimiter\n                      delim['{'].splice(delim['{'].length-1, 1)\n                      if (0 == delim['{'].length + delim['\"'].length) {\n                        // closing delimiter\n                        doneParsingValue = true;\n                      } else {\n                        // end verbatim block\n                      }\n                    }\n                  } else {\n                    // literal, add to value\n                  }\n                }\n              }\n            }\n\n            // If here, then we are either done parsing the value or \n            // have a literal that should be added to the value.\n            if (doneParsingValue) {\n              // SUCCESS:     value parsed\n              // NEXT_STATE:  KV_KEY\n              this.SKIPWS_        = true;\n              this.SKIPCOMMENT_   = true;\n              this.STATE_         = this.STATES_.KV_KEY;\n              this.DATA_.Fields[this.PARSETMP_.Key] = this.PARSETMP_.Value;\n              this.PARSETMP_      = { Key: '' };\n              this.VALBRACES_     = null;\n            } else {\n              this.PARSETMP_.Value += c;\n            }\n            break;\n      } // end switch (this.STATE_)\n    } // end while(AnotherIteration)\n  } // end function processCharacter \n\n  /** @private */ this.CHARCONV_ = [\n    [ /\\\\space /g, '\\u0020' ],\n    [ /\\\\textdollar /g, '\\u0024' ],\n    [ /\\\\textquotesingle /g, '\\u0027' ],\n    [ /\\\\ast /g, '\\u002A' ],\n    [ /\\\\textbackslash /g, '\\u005C' ],\n    [ /\\\\\\^\\{\\}/g, '\\u005E' ],\n    [ /\\\\textasciigrave /g, '\\u0060' ],\n    [ /\\\\lbrace /g, '\\u007B' ],\n    [ /\\\\vert /g, '\\u007C' ],\n    [ /\\\\rbrace /g, '\\u007D' ],\n    [ /\\\\textasciitilde /g, '\\u007E' ],\n    [ /\\\\textexclamdown /g, '\\u00A1' ],\n    [ /\\\\textcent /g, '\\u00A2' ],\n    [ /\\\\textsterling /g, '\\u00A3' ],\n    [ /\\\\textcurrency /g, '\\u00A4' ],\n    [ /\\\\textyen /g, '\\u00A5' ],\n    [ /\\\\textbrokenbar /g, '\\u00A6' ],\n    [ /\\\\textsection /g, '\\u00A7' ],\n    [ /\\\\textasciidieresis /g, '\\u00A8' ],\n    [ /\\\\textcopyright /g, '\\u00A9' ],\n    [ /\\\\textordfeminine /g, '\\u00AA' ],\n    [ /\\\\guillemotleft /g, '\\u00AB' ],\n    [ /\\\\lnot /g, '\\u00AC' ],\n    [ /\\\\textregistered /g, '\\u00AE' ],\n    [ /\\\\textasciimacron /g, '\\u00AF' ],\n    [ /\\\\textdegree /g, '\\u00B0' ],\n    [ /\\\\pm /g, '\\u00B1' ],\n    [ /\\\\textasciiacute /g, '\\u00B4' ],\n    [ /\\\\mathrm\\{\\\\mu\\}/g, '\\u00B5' ],\n    [ /\\\\textparagraph /g, '\\u00B6' ],\n    [ /\\\\cdot /g, '\\u00B7' ],\n    [ /\\\\c\\{\\}/g, '\\u00B8' ],\n    [ /\\\\textordmasculine /g, '\\u00BA' ],\n    [ /\\\\guillemotright /g, '\\u00BB' ],\n    [ /\\\\textonequarter /g, '\\u00BC' ],\n    [ /\\\\textonehalf /g, '\\u00BD' ],\n    [ /\\\\textthreequarters /g, '\\u00BE' ],\n    [ /\\\\textquestiondown /g, '\\u00BF' ],\n    [ /\\\\`\\{A\\}/g, '\\u00C0' ],\n    [ /\\\\'\\{A\\}/g, '\\u00C1' ],\n    [ /\\\\\\^\\{A\\}/g, '\\u00C2' ],\n    [ /\\\\~\\{A\\}/g, '\\u00C3' ],\n    [ /\\\\\"\\{A\\}/g, '\\u00C4' ],\n    [ /\\\\AA /g, '\\u00C5' ],\n    [ /\\\\AE /g, '\\u00C6' ],\n    [ /\\\\c\\{C\\}/g, '\\u00C7' ],\n    [ /\\\\`\\{E\\}/g, '\\u00C8' ],\n    [ /\\\\'\\{E\\}/g, '\\u00C9' ],\n    [ /\\\\\\^\\{E\\}/g, '\\u00CA' ],\n    [ /\\\\\"\\{E\\}/g, '\\u00CB' ],\n    [ /\\\\`\\{I\\}/g, '\\u00CC' ],\n    [ /\\\\'\\{I\\}/g, '\\u00CD' ],\n    [ /\\\\\\^\\{I\\}/g, '\\u00CE' ],\n    [ /\\\\\"\\{I\\}/g, '\\u00CF' ],\n    [ /\\\\DH /g, '\\u00D0' ],\n    [ /\\\\~\\{N\\}/g, '\\u00D1' ],\n    [ /\\\\`\\{O\\}/g, '\\u00D2' ],\n    [ /\\\\'\\{O\\}/g, '\\u00D3' ],\n    [ /\\\\\\^\\{O\\}/g, '\\u00D4' ],\n    [ /\\\\~\\{O\\}/g, '\\u00D5' ],\n    [ /\\\\\"\\{O\\}/g, '\\u00D6' ],\n    [ /\\\\texttimes /g, '\\u00D7' ],\n    [ /\\\\O /g, '\\u00D8' ],\n    [ /\\\\`\\{U\\}/g, '\\u00D9' ],\n    [ /\\\\'\\{U\\}/g, '\\u00DA' ],\n    [ /\\\\\\^\\{U\\}/g, '\\u00DB' ],\n    [ /\\\\\"\\{U\\}/g, '\\u00DC' ],\n    [ /\\\\'\\{Y\\}/g, '\\u00DD' ],\n    [ /\\\\TH /g, '\\u00DE' ],\n    [ /\\\\ss /g, '\\u00DF' ],\n    [ /\\\\`\\{a\\}/g, '\\u00E0' ],\n    [ /\\\\'\\{a\\}/g, '\\u00E1' ],\n    [ /\\\\\\^\\{a\\}/g, '\\u00E2' ],\n    [ /\\\\~\\{a\\}/g, '\\u00E3' ],\n    [ /\\\\\"\\{a\\}/g, '\\u00E4' ],\n    [ /\\\\aa /g, '\\u00E5' ],\n    [ /\\\\ae /g, '\\u00E6' ],\n    [ /\\\\c\\{c\\}/g, '\\u00E7' ],\n    [ /\\\\`\\{e\\}/g, '\\u00E8' ],\n    [ /\\\\'\\{e\\}/g, '\\u00E9' ],\n    [ /\\\\\\^\\{e\\}/g, '\\u00EA' ],\n    [ /\\\\\"\\{e\\}/g, '\\u00EB' ],\n    [ /\\\\`\\{\\\\i\\}/g, '\\u00EC' ],\n    [ /\\\\'\\{\\\\i\\}/g, '\\u00ED' ],\n    [ /\\\\\\^\\{\\\\i\\}/g, '\\u00EE' ],\n    [ /\\\\\"\\{\\\\i\\}/g, '\\u00EF' ],\n    [ /\\\\dh /g, '\\u00F0' ],\n    [ /\\\\~\\{n\\}/g, '\\u00F1' ],\n    [ /\\\\`\\{o\\}/g, '\\u00F2' ],\n    [ /\\\\'\\{o\\}/g, '\\u00F3' ],\n    [ /\\\\\\^\\{o\\}/g, '\\u00F4' ],\n    [ /\\\\~\\{o\\}/g, '\\u00F5' ],\n    [ /\\\\\"\\{o\\}/g, '\\u00F6' ],\n    [ /\\\\div /g, '\\u00F7' ],\n    [ /\\\\o /g, '\\u00F8' ],\n    [ /\\\\`\\{u\\}/g, '\\u00F9' ],\n    [ /\\\\'\\{u\\}/g, '\\u00FA' ],\n    [ /\\\\\\^\\{u\\}/g, '\\u00FB' ],\n    [ /\\\\\"\\{u\\}/g, '\\u00FC' ],\n    [ /\\\\'\\{y\\}/g, '\\u00FD' ],\n    [ /\\\\th /g, '\\u00FE' ],\n    [ /\\\\\"\\{y\\}/g, '\\u00FF' ],\n    [ /\\\\=\\{A\\}/g, '\\u0100' ],\n    [ /\\\\=\\{a\\}/g, '\\u0101' ],\n    [ /\\\\u\\{A\\}/g, '\\u0102' ],\n    [ /\\\\u\\{a\\}/g, '\\u0103' ],\n    [ /\\\\k\\{A\\}/g, '\\u0104' ],\n    [ /\\\\k\\{a\\}/g, '\\u0105' ],\n    [ /\\\\'\\{C\\}/g, '\\u0106' ],\n    [ /\\\\'\\{c\\}/g, '\\u0107' ],\n    [ /\\\\\\^\\{C\\}/g, '\\u0108' ],\n    [ /\\\\\\^\\{c\\}/g, '\\u0109' ],\n    [ /\\\\.\\{C\\}/g, '\\u010A' ],\n    [ /\\\\.\\{c\\}/g, '\\u010B' ],\n    [ /\\\\v\\{C\\}/g, '\\u010C' ],\n    [ /\\\\v\\{c\\}/g, '\\u010D' ],\n    [ /\\\\v\\{D\\}/g, '\\u010E' ],\n    [ /\\\\v\\{d\\}/g, '\\u010F' ],\n    [ /\\\\DJ /g, '\\u0110' ],\n    [ /\\\\dj /g, '\\u0111' ],\n    [ /\\\\=\\{E\\}/g, '\\u0112' ],\n    [ /\\\\=\\{e\\}/g, '\\u0113' ],\n    [ /\\\\u\\{E\\}/g, '\\u0114' ],\n    [ /\\\\u\\{e\\}/g, '\\u0115' ],\n    [ /\\\\.\\{E\\}/g, '\\u0116' ],\n    [ /\\\\.\\{e\\}/g, '\\u0117' ],\n    [ /\\\\k\\{E\\}/g, '\\u0118' ],\n    [ /\\\\k\\{e\\}/g, '\\u0119' ],\n    [ /\\\\v\\{E\\}/g, '\\u011A' ],\n    [ /\\\\v\\{e\\}/g, '\\u011B' ],\n    [ /\\\\\\^\\{G\\}/g, '\\u011C' ],\n    [ /\\\\\\^\\{g\\}/g, '\\u011D' ],\n    [ /\\\\u\\{G\\}/g, '\\u011E' ],\n    [ /\\\\u\\{g\\}/g, '\\u011F' ],\n    [ /\\\\.\\{G\\}/g, '\\u0120' ],\n    [ /\\\\.\\{g\\}/g, '\\u0121' ],\n    [ /\\\\c\\{G\\}/g, '\\u0122' ],\n    [ /\\\\c\\{g\\}/g, '\\u0123' ],\n    [ /\\\\\\^\\{H\\}/g, '\\u0124' ],\n    [ /\\\\\\^\\{h\\}/g, '\\u0125' ],\n    [ /\\\\Elzxh /g, '\\u0127' ],\n    [ /\\\\~\\{I\\}/g, '\\u0128' ],\n    [ /\\\\~\\{\\\\i\\}/g, '\\u0129' ],\n    [ /\\\\=\\{I\\}/g, '\\u012A' ],\n    [ /\\\\=\\{\\\\i\\}/g, '\\u012B' ],\n    [ /\\\\u\\{I\\}/g, '\\u012C' ],\n    [ /\\\\u\\{\\\\i\\}/g, '\\u012D' ],\n    [ /\\\\k\\{I\\}/g, '\\u012E' ],\n    [ /\\\\k\\{i\\}/g, '\\u012F' ],\n    [ /\\\\.\\{I\\}/g, '\\u0130' ],\n    [ /\\\\i /g, '\\u0131' ],\n    [ /\\\\\\^\\{J\\}/g, '\\u0134' ],\n    [ /\\\\\\^\\{\\\\j\\}/g, '\\u0135' ],\n    [ /\\\\c\\{K\\}/g, '\\u0136' ],\n    [ /\\\\c\\{k\\}/g, '\\u0137' ],\n    [ /\\\\'\\{L\\}/g, '\\u0139' ],\n    [ /\\\\'\\{l\\}/g, '\\u013A' ],\n    [ /\\\\c\\{L\\}/g, '\\u013B' ],\n    [ /\\\\c\\{l\\}/g, '\\u013C' ],\n    [ /\\\\v\\{L\\}/g, '\\u013D' ],\n    [ /\\\\v\\{l\\}/g, '\\u013E' ],\n    [ /\\\\L /g, '\\u0141' ],\n    [ /\\\\l /g, '\\u0142' ],\n    [ /\\\\'\\{N\\}/g, '\\u0143' ],\n    [ /\\\\'\\{n\\}/g, '\\u0144' ],\n    [ /\\\\c\\{N\\}/g, '\\u0145' ],\n    [ /\\\\c\\{n\\}/g, '\\u0146' ],\n    [ /\\\\v\\{N\\}/g, '\\u0147' ],\n    [ /\\\\v\\{n\\}/g, '\\u0148' ],\n    [ /\\\\NG /g, '\\u014A' ],\n    [ /\\\\ng /g, '\\u014B' ],\n    [ /\\\\=\\{O\\}/g, '\\u014C' ],\n    [ /\\\\=\\{o\\}/g, '\\u014D' ],\n    [ /\\\\u\\{O\\}/g, '\\u014E' ],\n    [ /\\\\u\\{o\\}/g, '\\u014F' ],\n    [ /\\\\H\\{O\\}/g, '\\u0150' ],\n    [ /\\\\H\\{o\\}/g, '\\u0151' ],\n    [ /\\\\OE /g, '\\u0152' ],\n    [ /\\\\oe /g, '\\u0153' ],\n    [ /\\\\'\\{R\\}/g, '\\u0154' ],\n    [ /\\\\'\\{r\\}/g, '\\u0155' ],\n    [ /\\\\c\\{R\\}/g, '\\u0156' ],\n    [ /\\\\c\\{r\\}/g, '\\u0157' ],\n    [ /\\\\v\\{R\\}/g, '\\u0158' ],\n    [ /\\\\v\\{r\\}/g, '\\u0159' ],\n    [ /\\\\'\\{S\\}/g, '\\u015A' ],\n    [ /\\\\'\\{s\\}/g, '\\u015B' ],\n    [ /\\\\\\^\\{S\\}/g, '\\u015C' ],\n    [ /\\\\\\^\\{s\\}/g, '\\u015D' ],\n    [ /\\\\c\\{S\\}/g, '\\u015E' ],\n    [ /\\\\c\\{s\\}/g, '\\u015F' ],\n    [ /\\\\v\\{S\\}/g, '\\u0160' ],\n    [ /\\\\v\\{s\\}/g, '\\u0161' ],\n    [ /\\\\c\\{T\\}/g, '\\u0162' ],\n    [ /\\\\c\\{t\\}/g, '\\u0163' ],\n    [ /\\\\v\\{T\\}/g, '\\u0164' ],\n    [ /\\\\v\\{t\\}/g, '\\u0165' ],\n    [ /\\\\~\\{U\\}/g, '\\u0168' ],\n    [ /\\\\~\\{u\\}/g, '\\u0169' ],\n    [ /\\\\=\\{U\\}/g, '\\u016A' ],\n    [ /\\\\=\\{u\\}/g, '\\u016B' ],\n    [ /\\\\u\\{U\\}/g, '\\u016C' ],\n    [ /\\\\u\\{u\\}/g, '\\u016D' ],\n    [ /\\\\r\\{U\\}/g, '\\u016E' ],\n    [ /\\\\r\\{u\\}/g, '\\u016F' ],\n    [ /\\\\H\\{U\\}/g, '\\u0170' ],\n    [ /\\\\H\\{u\\}/g, '\\u0171' ],\n    [ /\\\\k\\{U\\}/g, '\\u0172' ],\n    [ /\\\\k\\{u\\}/g, '\\u0173' ],\n    [ /\\\\\\^\\{W\\}/g, '\\u0174' ],\n    [ /\\\\\\^\\{w\\}/g, '\\u0175' ],\n    [ /\\\\\\^\\{Y\\}/g, '\\u0176' ],\n    [ /\\\\\\^\\{y\\}/g, '\\u0177' ],\n    [ /\\\\\"\\{Y\\}/g, '\\u0178' ],\n    [ /\\\\'\\{Z\\}/g, '\\u0179' ],\n    [ /\\\\'\\{z\\}/g, '\\u017A' ],\n    [ /\\\\.\\{Z\\}/g, '\\u017B' ],\n    [ /\\\\.\\{z\\}/g, '\\u017C' ],\n    [ /\\\\v\\{Z\\}/g, '\\u017D' ],\n    [ /\\\\v\\{z\\}/g, '\\u017E' ],\n    [ /\\\\texthvlig /g, '\\u0195' ],\n    [ /\\\\textnrleg /g, '\\u019E' ],\n    [ /\\\\eth /g, '\\u01AA' ],\n    [ /\\\\textdoublepipe /g, '\\u01C2' ],\n    [ /\\\\'\\{g\\}/g, '\\u01F5' ],\n    [ /\\\\Elztrna /g, '\\u0250' ],\n    [ /\\\\Elztrnsa /g, '\\u0252' ],\n    [ /\\\\Elzopeno /g, '\\u0254' ],\n    [ /\\\\Elzrtld /g, '\\u0256' ],\n    [ /\\\\Elzschwa /g, '\\u0259' ],\n    [ /\\\\varepsilon /g, '\\u025B' ],\n    [ /\\\\Elzpgamma /g, '\\u0263' ],\n    [ /\\\\Elzpbgam /g, '\\u0264' ],\n    [ /\\\\Elztrnh /g, '\\u0265' ],\n    [ /\\\\Elzbtdl /g, '\\u026C' ],\n    [ /\\\\Elzrtll /g, '\\u026D' ],\n    [ /\\\\Elztrnm /g, '\\u026F' ],\n    [ /\\\\Elztrnmlr /g, '\\u0270' ],\n    [ /\\\\Elzltlmr /g, '\\u0271' ],\n    [ /\\\\Elzltln /g, '\\u0272' ],\n    [ /\\\\Elzrtln /g, '\\u0273' ],\n    [ /\\\\Elzclomeg /g, '\\u0277' ],\n    [ /\\\\textphi /g, '\\u0278' ],\n    [ /\\\\Elztrnr /g, '\\u0279' ],\n    [ /\\\\Elztrnrl /g, '\\u027A' ],\n    [ /\\\\Elzrttrnr /g, '\\u027B' ],\n    [ /\\\\Elzrl /g, '\\u027C' ],\n    [ /\\\\Elzrtlr /g, '\\u027D' ],\n    [ /\\\\Elzfhr /g, '\\u027E' ],\n    [ /\\\\Elzrtls /g, '\\u0282' ],\n    [ /\\\\Elzesh /g, '\\u0283' ],\n    [ /\\\\Elztrnt /g, '\\u0287' ],\n    [ /\\\\Elzrtlt /g, '\\u0288' ],\n    [ /\\\\Elzpupsil /g, '\\u028A' ],\n    [ /\\\\Elzpscrv /g, '\\u028B' ],\n    [ /\\\\Elzinvv /g, '\\u028C' ],\n    [ /\\\\Elzinvw /g, '\\u028D' ],\n    [ /\\\\Elztrny /g, '\\u028E' ],\n    [ /\\\\Elzrtlz /g, '\\u0290' ],\n    [ /\\\\Elzyogh /g, '\\u0292' ],\n    [ /\\\\Elzglst /g, '\\u0294' ],\n    [ /\\\\Elzreglst /g, '\\u0295' ],\n    [ /\\\\Elzinglst /g, '\\u0296' ],\n    [ /\\\\textturnk /g, '\\u029E' ],\n    [ /\\\\Elzdyogh /g, '\\u02A4' ],\n    [ /\\\\Elztesh /g, '\\u02A7' ],\n    [ /\\\\textasciicaron /g, '\\u02C7' ],\n    [ /\\\\Elzverts /g, '\\u02C8' ],\n    [ /\\\\Elzverti /g, '\\u02CC' ],\n    [ /\\\\Elzlmrk /g, '\\u02D0' ],\n    [ /\\\\Elzhlmrk /g, '\\u02D1' ],\n    [ /\\\\Elzsbrhr /g, '\\u02D2' ],\n    [ /\\\\Elzsblhr /g, '\\u02D3' ],\n    [ /\\\\Elzrais /g, '\\u02D4' ],\n    [ /\\\\Elzlow /g, '\\u02D5' ],\n    [ /\\\\textasciibreve /g, '\\u02D8' ],\n    [ /\\\\textperiodcentered /g, '\\u02D9' ],\n    [ /\\\\r\\{\\}/g, '\\u02DA' ],\n    [ /\\\\k\\{\\}/g, '\\u02DB' ],\n    [ /\\\\texttildelow /g, '\\u02DC' ],\n    [ /\\\\H\\{\\}/g, '\\u02DD' ],\n    [ /\\\\tone\\{55\\}/g, '\\u02E5' ],\n    [ /\\\\tone\\{44\\}/g, '\\u02E6' ],\n    [ /\\\\tone\\{33\\}/g, '\\u02E7' ],\n    [ /\\\\tone\\{22\\}/g, '\\u02E8' ],\n    [ /\\\\tone\\{11\\}/g, '\\u02E9' ],\n    [ /\\\\cyrchar\\\\C/g, '\\u030F' ],\n    [ /\\\\Elzpalh /g, '\\u0321' ],\n    [ /\\\\Elzrh /g, '\\u0322' ],\n    [ /\\\\Elzsbbrg /g, '\\u032A' ],\n    [ /\\\\Elzxl /g, '\\u0335' ],\n    [ /\\\\Elzbar /g, '\\u0336' ],\n    [ /\\\\'\\{A\\}/g, '\\u0386' ],\n    [ /\\\\'\\{E\\}/g, '\\u0388' ],\n    [ /\\\\'\\{H\\}/g, '\\u0389' ],\n    [ /\\\\'\\{\\}\\{I\\}/g, '\\u038A' ],\n    [ /\\\\'\\{\\}O/g, '\\u038C' ],\n    [ /\\\\mathrm\\{'Y\\}/g, '\\u038E' ],\n    [ /\\\\mathrm\\{'\\\\Omega\\}/g, '\\u038F' ],\n    [ /\\\\acute\\{\\\\ddot\\{\\\\iota\\}\\}/g, '\\u0390' ],\n    [ /\\\\Alpha /g, '\\u0391' ],\n    [ /\\\\Beta /g, '\\u0392' ],\n    [ /\\\\Gamma /g, '\\u0393' ],\n    [ /\\\\Delta /g, '\\u0394' ],\n    [ /\\\\Epsilon /g, '\\u0395' ],\n    [ /\\\\Zeta /g, '\\u0396' ],\n    [ /\\\\Eta /g, '\\u0397' ],\n    [ /\\\\Theta /g, '\\u0398' ],\n    [ /\\\\Iota /g, '\\u0399' ],\n    [ /\\\\Kappa /g, '\\u039A' ],\n    [ /\\\\Lambda /g, '\\u039B' ],\n    [ /\\\\Xi /g, '\\u039E' ],\n    [ /\\\\Pi /g, '\\u03A0' ],\n    [ /\\\\Rho /g, '\\u03A1' ],\n    [ /\\\\Sigma /g, '\\u03A3' ],\n    [ /\\\\Tau /g, '\\u03A4' ],\n    [ /\\\\Upsilon /g, '\\u03A5' ],\n    [ /\\\\Phi /g, '\\u03A6' ],\n    [ /\\\\Chi /g, '\\u03A7' ],\n    [ /\\\\Psi /g, '\\u03A8' ],\n    [ /\\\\Omega /g, '\\u03A9' ],\n    [ /\\\\mathrm\\{\\\\ddot\\{I\\}\\}/g, '\\u03AA' ],\n    [ /\\\\mathrm\\{\\\\ddot\\{Y\\}\\}/g, '\\u03AB' ],\n    [ /\\\\'\\{\\$\\\\alpha\\$\\}/g, '\\u03AC' ],\n    [ /\\\\acute\\{\\\\epsilon\\}/g, '\\u03AD' ],\n    [ /\\\\acute\\{\\\\eta\\}/g, '\\u03AE' ],\n    [ /\\\\acute\\{\\\\iota\\}/g, '\\u03AF' ],\n    [ /\\\\acute\\{\\\\ddot\\{\\\\upsilon\\}\\}/g, '\\u03B0' ],\n    [ /\\\\alpha /g, '\\u03B1' ],\n    [ /\\\\beta /g, '\\u03B2' ],\n    [ /\\\\gamma /g, '\\u03B3' ],\n    [ /\\\\delta /g, '\\u03B4' ],\n    [ /\\\\epsilon /g, '\\u03B5' ],\n    [ /\\\\zeta /g, '\\u03B6' ],\n    [ /\\\\eta /g, '\\u03B7' ],\n    [ /\\\\texttheta /g, '\\u03B8' ],\n    [ /\\\\iota /g, '\\u03B9' ],\n    [ /\\\\kappa /g, '\\u03BA' ],\n    [ /\\\\lambda /g, '\\u03BB' ],\n    [ /\\\\mu /g, '\\u03BC' ],\n    [ /\\\\nu /g, '\\u03BD' ],\n    [ /\\\\xi /g, '\\u03BE' ],\n    [ /\\\\pi /g, '\\u03C0' ],\n    [ /\\\\rho /g, '\\u03C1' ],\n    [ /\\\\varsigma /g, '\\u03C2' ],\n    [ /\\\\sigma /g, '\\u03C3' ],\n    [ /\\\\tau /g, '\\u03C4' ],\n    [ /\\\\upsilon /g, '\\u03C5' ],\n    [ /\\\\varphi /g, '\\u03C6' ],\n    [ /\\\\chi /g, '\\u03C7' ],\n    [ /\\\\psi /g, '\\u03C8' ],\n    [ /\\\\omega /g, '\\u03C9' ],\n    [ /\\\\ddot\\{\\\\iota\\}/g, '\\u03CA' ],\n    [ /\\\\ddot\\{\\\\upsilon\\}/g, '\\u03CB' ],\n    [ /\\\\'\\{o\\}/g, '\\u03CC' ],\n    [ /\\\\acute\\{\\\\upsilon\\}/g, '\\u03CD' ],\n    [ /\\\\acute\\{\\\\omega\\}/g, '\\u03CE' ],\n    [ /\\\\Pisymbol\\{ppi022\\}\\{87\\}/g, '\\u03D0' ],\n    [ /\\\\textvartheta /g, '\\u03D1' ],\n    [ /\\\\Upsilon /g, '\\u03D2' ],\n    [ /\\\\phi /g, '\\u03D5' ],\n    [ /\\\\varpi /g, '\\u03D6' ],\n    [ /\\\\Stigma /g, '\\u03DA' ],\n    [ /\\\\Digamma /g, '\\u03DC' ],\n    [ /\\\\digamma /g, '\\u03DD' ],\n    [ /\\\\Koppa /g, '\\u03DE' ],\n    [ /\\\\Sampi /g, '\\u03E0' ],\n    [ /\\\\varkappa /g, '\\u03F0' ],\n    [ /\\\\varrho /g, '\\u03F1' ],\n    [ /\\\\textTheta /g, '\\u03F4' ],\n    [ /\\\\backepsilon /g, '\\u03F6' ],\n    [ /\\\\cyrchar\\\\CYRYO /g, '\\u0401' ],\n    [ /\\\\cyrchar\\\\CYRDJE /g, '\\u0402' ],\n    [ /\\\\cyrchar\\{\\\\'\\\\CYRG\\}/g, '\\u0403' ],\n    [ /\\\\cyrchar\\\\CYRIE /g, '\\u0404' ],\n    [ /\\\\cyrchar\\\\CYRDZE /g, '\\u0405' ],\n    [ /\\\\cyrchar\\\\CYRII /g, '\\u0406' ],\n    [ /\\\\cyrchar\\\\CYRYI /g, '\\u0407' ],\n    [ /\\\\cyrchar\\\\CYRJE /g, '\\u0408' ],\n    [ /\\\\cyrchar\\\\CYRLJE /g, '\\u0409' ],\n    [ /\\\\cyrchar\\\\CYRNJE /g, '\\u040A' ],\n    [ /\\\\cyrchar\\\\CYRTSHE /g, '\\u040B' ],\n    [ /\\\\cyrchar\\{\\\\'\\\\CYRK\\}/g, '\\u040C' ],\n    [ /\\\\cyrchar\\\\CYRUSHRT /g, '\\u040E' ],\n    [ /\\\\cyrchar\\\\CYRDZHE /g, '\\u040F' ],\n    [ /\\\\cyrchar\\\\CYRA /g, '\\u0410' ],\n    [ /\\\\cyrchar\\\\CYRB /g, '\\u0411' ],\n    [ /\\\\cyrchar\\\\CYRV /g, '\\u0412' ],\n    [ /\\\\cyrchar\\\\CYRG /g, '\\u0413' ],\n    [ /\\\\cyrchar\\\\CYRD /g, '\\u0414' ],\n    [ /\\\\cyrchar\\\\CYRE /g, '\\u0415' ],\n    [ /\\\\cyrchar\\\\CYRZH /g, '\\u0416' ],\n    [ /\\\\cyrchar\\\\CYRZ /g, '\\u0417' ],\n    [ /\\\\cyrchar\\\\CYRI /g, '\\u0418' ],\n    [ /\\\\cyrchar\\\\CYRISHRT /g, '\\u0419' ],\n    [ /\\\\cyrchar\\\\CYRK /g, '\\u041A' ],\n    [ /\\\\cyrchar\\\\CYRL /g, '\\u041B' ],\n    [ /\\\\cyrchar\\\\CYRM /g, '\\u041C' ],\n    [ /\\\\cyrchar\\\\CYRN /g, '\\u041D' ],\n    [ /\\\\cyrchar\\\\CYRO /g, '\\u041E' ],\n    [ /\\\\cyrchar\\\\CYRP /g, '\\u041F' ],\n    [ /\\\\cyrchar\\\\CYRR /g, '\\u0420' ],\n    [ /\\\\cyrchar\\\\CYRS /g, '\\u0421' ],\n    [ /\\\\cyrchar\\\\CYRT /g, '\\u0422' ],\n    [ /\\\\cyrchar\\\\CYRU /g, '\\u0423' ],\n    [ /\\\\cyrchar\\\\CYRF /g, '\\u0424' ],\n    [ /\\\\cyrchar\\\\CYRH /g, '\\u0425' ],\n    [ /\\\\cyrchar\\\\CYRC /g, '\\u0426' ],\n    [ /\\\\cyrchar\\\\CYRCH /g, '\\u0427' ],\n    [ /\\\\cyrchar\\\\CYRSH /g, '\\u0428' ],\n    [ /\\\\cyrchar\\\\CYRSHCH /g, '\\u0429' ],\n    [ /\\\\cyrchar\\\\CYRHRDSN /g, '\\u042A' ],\n    [ /\\\\cyrchar\\\\CYRERY /g, '\\u042B' ],\n    [ /\\\\cyrchar\\\\CYRSFTSN /g, '\\u042C' ],\n    [ /\\\\cyrchar\\\\CYREREV /g, '\\u042D' ],\n    [ /\\\\cyrchar\\\\CYRYU /g, '\\u042E' ],\n    [ /\\\\cyrchar\\\\CYRYA /g, '\\u042F' ],\n    [ /\\\\cyrchar\\\\cyra /g, '\\u0430' ],\n    [ /\\\\cyrchar\\\\cyrb /g, '\\u0431' ],\n    [ /\\\\cyrchar\\\\cyrv /g, '\\u0432' ],\n    [ /\\\\cyrchar\\\\cyrg /g, '\\u0433' ],\n    [ /\\\\cyrchar\\\\cyrd /g, '\\u0434' ],\n    [ /\\\\cyrchar\\\\cyre /g, '\\u0435' ],\n    [ /\\\\cyrchar\\\\cyrzh /g, '\\u0436' ],\n    [ /\\\\cyrchar\\\\cyrz /g, '\\u0437' ],\n    [ /\\\\cyrchar\\\\cyri /g, '\\u0438' ],\n    [ /\\\\cyrchar\\\\cyrishrt /g, '\\u0439' ],\n    [ /\\\\cyrchar\\\\cyrk /g, '\\u043A' ],\n    [ /\\\\cyrchar\\\\cyrl /g, '\\u043B' ],\n    [ /\\\\cyrchar\\\\cyrm /g, '\\u043C' ],\n    [ /\\\\cyrchar\\\\cyrn /g, '\\u043D' ],\n    [ /\\\\cyrchar\\\\cyro /g, '\\u043E' ],\n    [ /\\\\cyrchar\\\\cyrp /g, '\\u043F' ],\n    [ /\\\\cyrchar\\\\cyrr /g, '\\u0440' ],\n    [ /\\\\cyrchar\\\\cyrs /g, '\\u0441' ],\n    [ /\\\\cyrchar\\\\cyrt /g, '\\u0442' ],\n    [ /\\\\cyrchar\\\\cyru /g, '\\u0443' ],\n    [ /\\\\cyrchar\\\\cyrf /g, '\\u0444' ],\n    [ /\\\\cyrchar\\\\cyrh /g, '\\u0445' ],\n    [ /\\\\cyrchar\\\\cyrc /g, '\\u0446' ],\n    [ /\\\\cyrchar\\\\cyrch /g, '\\u0447' ],\n    [ /\\\\cyrchar\\\\cyrsh /g, '\\u0448' ],\n    [ /\\\\cyrchar\\\\cyrshch /g, '\\u0449' ],\n    [ /\\\\cyrchar\\\\cyrhrdsn /g, '\\u044A' ],\n    [ /\\\\cyrchar\\\\cyrery /g, '\\u044B' ],\n    [ /\\\\cyrchar\\\\cyrsftsn /g, '\\u044C' ],\n    [ /\\\\cyrchar\\\\cyrerev /g, '\\u044D' ],\n    [ /\\\\cyrchar\\\\cyryu /g, '\\u044E' ],\n    [ /\\\\cyrchar\\\\cyrya /g, '\\u044F' ],\n    [ /\\\\cyrchar\\\\cyryo /g, '\\u0451' ],\n    [ /\\\\cyrchar\\\\cyrdje /g, '\\u0452' ],\n    [ /\\\\cyrchar\\{\\\\'\\\\cyrg\\}/g, '\\u0453' ],\n    [ /\\\\cyrchar\\\\cyrie /g, '\\u0454' ],\n    [ /\\\\cyrchar\\\\cyrdze /g, '\\u0455' ],\n    [ /\\\\cyrchar\\\\cyrii /g, '\\u0456' ],\n    [ /\\\\cyrchar\\\\cyryi /g, '\\u0457' ],\n    [ /\\\\cyrchar\\\\cyrje /g, '\\u0458' ],\n    [ /\\\\cyrchar\\\\cyrlje /g, '\\u0459' ],\n    [ /\\\\cyrchar\\\\cyrnje /g, '\\u045A' ],\n    [ /\\\\cyrchar\\\\cyrtshe /g, '\\u045B' ],\n    [ /\\\\cyrchar\\{\\\\'\\\\cyrk\\}/g, '\\u045C' ],\n    [ /\\\\cyrchar\\\\cyrushrt /g, '\\u045E' ],\n    [ /\\\\cyrchar\\\\cyrdzhe /g, '\\u045F' ],\n    [ /\\\\cyrchar\\\\CYROMEGA /g, '\\u0460' ],\n    [ /\\\\cyrchar\\\\cyromega /g, '\\u0461' ],\n    [ /\\\\cyrchar\\\\CYRYAT /g, '\\u0462' ],\n    [ /\\\\cyrchar\\\\CYRIOTE /g, '\\u0464' ],\n    [ /\\\\cyrchar\\\\cyriote /g, '\\u0465' ],\n    [ /\\\\cyrchar\\\\CYRLYUS /g, '\\u0466' ],\n    [ /\\\\cyrchar\\\\cyrlyus /g, '\\u0467' ],\n    [ /\\\\cyrchar\\\\CYRIOTLYUS /g, '\\u0468' ],\n    [ /\\\\cyrchar\\\\cyriotlyus /g, '\\u0469' ],\n    [ /\\\\cyrchar\\\\CYRBYUS /g, '\\u046A' ],\n    [ /\\\\cyrchar\\\\CYRIOTBYUS /g, '\\u046C' ],\n    [ /\\\\cyrchar\\\\cyriotbyus /g, '\\u046D' ],\n    [ /\\\\cyrchar\\\\CYRKSI /g, '\\u046E' ],\n    [ /\\\\cyrchar\\\\cyrksi /g, '\\u046F' ],\n    [ /\\\\cyrchar\\\\CYRPSI /g, '\\u0470' ],\n    [ /\\\\cyrchar\\\\cyrpsi /g, '\\u0471' ],\n    [ /\\\\cyrchar\\\\CYRFITA /g, '\\u0472' ],\n    [ /\\\\cyrchar\\\\CYRIZH /g, '\\u0474' ],\n    [ /\\\\cyrchar\\\\CYRUK /g, '\\u0478' ],\n    [ /\\\\cyrchar\\\\cyruk /g, '\\u0479' ],\n    [ /\\\\cyrchar\\\\CYROMEGARND /g, '\\u047A' ],\n    [ /\\\\cyrchar\\\\cyromegarnd /g, '\\u047B' ],\n    [ /\\\\cyrchar\\\\CYROMEGATITLO /g, '\\u047C' ],\n    [ /\\\\cyrchar\\\\cyromegatitlo /g, '\\u047D' ],\n    [ /\\\\cyrchar\\\\CYROT /g, '\\u047E' ],\n    [ /\\\\cyrchar\\\\cyrot /g, '\\u047F' ],\n    [ /\\\\cyrchar\\\\CYRKOPPA /g, '\\u0480' ],\n    [ /\\\\cyrchar\\\\cyrkoppa /g, '\\u0481' ],\n    [ /\\\\cyrchar\\\\cyrthousands /g, '\\u0482' ],\n    [ /\\\\cyrchar\\\\cyrhundredthousands /g, '\\u0488' ],\n    [ /\\\\cyrchar\\\\cyrmillions /g, '\\u0489' ],\n    [ /\\\\cyrchar\\\\CYRSEMISFTSN /g, '\\u048C' ],\n    [ /\\\\cyrchar\\\\cyrsemisftsn /g, '\\u048D' ],\n    [ /\\\\cyrchar\\\\CYRRTICK /g, '\\u048E' ],\n    [ /\\\\cyrchar\\\\cyrrtick /g, '\\u048F' ],\n    [ /\\\\cyrchar\\\\CYRGUP /g, '\\u0490' ],\n    [ /\\\\cyrchar\\\\cyrgup /g, '\\u0491' ],\n    [ /\\\\cyrchar\\\\CYRGHCRS /g, '\\u0492' ],\n    [ /\\\\cyrchar\\\\cyrghcrs /g, '\\u0493' ],\n    [ /\\\\cyrchar\\\\CYRGHK /g, '\\u0494' ],\n    [ /\\\\cyrchar\\\\cyrghk /g, '\\u0495' ],\n    [ /\\\\cyrchar\\\\CYRZHDSC /g, '\\u0496' ],\n    [ /\\\\cyrchar\\\\cyrzhdsc /g, '\\u0497' ],\n    [ /\\\\cyrchar\\\\CYRZDSC /g, '\\u0498' ],\n    [ /\\\\cyrchar\\\\cyrzdsc /g, '\\u0499' ],\n    [ /\\\\cyrchar\\\\CYRKDSC /g, '\\u049A' ],\n    [ /\\\\cyrchar\\\\cyrkdsc /g, '\\u049B' ],\n    [ /\\\\cyrchar\\\\CYRKVCRS /g, '\\u049C' ],\n    [ /\\\\cyrchar\\\\cyrkvcrs /g, '\\u049D' ],\n    [ /\\\\cyrchar\\\\CYRKHCRS /g, '\\u049E' ],\n    [ /\\\\cyrchar\\\\cyrkhcrs /g, '\\u049F' ],\n    [ /\\\\cyrchar\\\\CYRKBEAK /g, '\\u04A0' ],\n    [ /\\\\cyrchar\\\\cyrkbeak /g, '\\u04A1' ],\n    [ /\\\\cyrchar\\\\CYRNDSC /g, '\\u04A2' ],\n    [ /\\\\cyrchar\\\\cyrndsc /g, '\\u04A3' ],\n    [ /\\\\cyrchar\\\\CYRNG /g, '\\u04A4' ],\n    [ /\\\\cyrchar\\\\cyrng /g, '\\u04A5' ],\n    [ /\\\\cyrchar\\\\CYRPHK /g, '\\u04A6' ],\n    [ /\\\\cyrchar\\\\cyrphk /g, '\\u04A7' ],\n    [ /\\\\cyrchar\\\\CYRABHHA /g, '\\u04A8' ],\n    [ /\\\\cyrchar\\\\cyrabhha /g, '\\u04A9' ],\n    [ /\\\\cyrchar\\\\CYRSDSC /g, '\\u04AA' ],\n    [ /\\\\cyrchar\\\\cyrsdsc /g, '\\u04AB' ],\n    [ /\\\\cyrchar\\\\CYRTDSC /g, '\\u04AC' ],\n    [ /\\\\cyrchar\\\\cyrtdsc /g, '\\u04AD' ],\n    [ /\\\\cyrchar\\\\CYRY /g, '\\u04AE' ],\n    [ /\\\\cyrchar\\\\cyry /g, '\\u04AF' ],\n    [ /\\\\cyrchar\\\\CYRYHCRS /g, '\\u04B0' ],\n    [ /\\\\cyrchar\\\\cyryhcrs /g, '\\u04B1' ],\n    [ /\\\\cyrchar\\\\CYRHDSC /g, '\\u04B2' ],\n    [ /\\\\cyrchar\\\\cyrhdsc /g, '\\u04B3' ],\n    [ /\\\\cyrchar\\\\CYRTETSE /g, '\\u04B4' ],\n    [ /\\\\cyrchar\\\\cyrtetse /g, '\\u04B5' ],\n    [ /\\\\cyrchar\\\\CYRCHRDSC /g, '\\u04B6' ],\n    [ /\\\\cyrchar\\\\cyrchrdsc /g, '\\u04B7' ],\n    [ /\\\\cyrchar\\\\CYRCHVCRS /g, '\\u04B8' ],\n    [ /\\\\cyrchar\\\\cyrchvcrs /g, '\\u04B9' ],\n    [ /\\\\cyrchar\\\\CYRSHHA /g, '\\u04BA' ],\n    [ /\\\\cyrchar\\\\cyrshha /g, '\\u04BB' ],\n    [ /\\\\cyrchar\\\\CYRABHCH /g, '\\u04BC' ],\n    [ /\\\\cyrchar\\\\cyrabhch /g, '\\u04BD' ],\n    [ /\\\\cyrchar\\\\CYRABHCHDSC /g, '\\u04BE' ],\n    [ /\\\\cyrchar\\\\cyrabhchdsc /g, '\\u04BF' ],\n    [ /\\\\cyrchar\\\\CYRpalochka /g, '\\u04C0' ],\n    [ /\\\\cyrchar\\\\CYRKHK /g, '\\u04C3' ],\n    [ /\\\\cyrchar\\\\cyrkhk /g, '\\u04C4' ],\n    [ /\\\\cyrchar\\\\CYRNHK /g, '\\u04C7' ],\n    [ /\\\\cyrchar\\\\cyrnhk /g, '\\u04C8' ],\n    [ /\\\\cyrchar\\\\CYRCHLDSC /g, '\\u04CB' ],\n    [ /\\\\cyrchar\\\\cyrchldsc /g, '\\u04CC' ],\n    [ /\\\\cyrchar\\\\CYRAE /g, '\\u04D4' ],\n    [ /\\\\cyrchar\\\\cyrae /g, '\\u04D5' ],\n    [ /\\\\cyrchar\\\\CYRSCHWA /g, '\\u04D8' ],\n    [ /\\\\cyrchar\\\\cyrschwa /g, '\\u04D9' ],\n    [ /\\\\cyrchar\\\\CYRABHDZE /g, '\\u04E0' ],\n    [ /\\\\cyrchar\\\\cyrabhdze /g, '\\u04E1' ],\n    [ /\\\\cyrchar\\\\CYROTLD /g, '\\u04E8' ],\n    [ /\\\\cyrchar\\\\cyrotld /g, '\\u04E9' ],\n    [ /\\\\hspace\\{0.6em\\}/g, '\\u2002' ],\n    [ /\\\\hspace\\{1em\\}/g, '\\u2003' ],\n    [ /\\\\hspace\\{0.33em\\}/g, '\\u2004' ],\n    [ /\\\\hspace\\{0.25em\\}/g, '\\u2005' ],\n    [ /\\\\hspace\\{0.166em\\}/g, '\\u2006' ],\n    [ /\\\\hphantom\\{0\\}/g, '\\u2007' ],\n    [ /\\\\hphantom\\{,\\}/g, '\\u2008' ],\n    [ /\\\\hspace\\{0.167em\\}/g, '\\u2009' ],\n    [ /\\\\mkern1mu /g, '\\u200A' ],\n    [ /\\\\textendash /g, '\\u2013' ],\n    [ /\\\\textemdash /g, '\\u2014' ],\n    [ /\\\\rule\\{1em\\}\\{1pt\\}/g, '\\u2015' ],\n    [ /\\\\Vert /g, '\\u2016' ],\n    [ /\\\\Elzreapos /g, '\\u201B' ],\n    [ /\\\\textquotedblleft /g, '\\u201C' ],\n    [ /\\\\textquotedblright /g, '\\u201D' ],\n    [ /\\\\textdagger /g, '\\u2020' ],\n    [ /\\\\textdaggerdbl /g, '\\u2021' ],\n    [ /\\\\textbullet /g, '\\u2022' ],\n    [ /\\\\ldots /g, '\\u2026' ],\n    [ /\\\\textperthousand /g, '\\u2030' ],\n    [ /\\\\textpertenthousand /g, '\\u2031' ],\n    [ /\\\\backprime /g, '\\u2035' ],\n    [ /\\\\guilsinglleft /g, '\\u2039' ],\n    [ /\\\\guilsinglright /g, '\\u203A' ],\n    [ /\\\\mkern4mu /g, '\\u205F' ],\n    [ /\\\\nolinebreak /g, '\\u2060' ],\n    [ /\\\\ensuremath\\{\\\\Elzpes\\}/g, '\\u20A7' ],\n    [ /\\\\mbox\\{\\\\texteuro\\} /g, '\\u20AC' ],\n    [ /\\\\dddot /g, '\\u20DB' ],\n    [ /\\\\ddddot /g, '\\u20DC' ],\n    [ /\\\\mathbb\\{C\\}/g, '\\u2102' ],\n    [ /\\\\mathscr\\{g\\}/g, '\\u210A' ],\n    [ /\\\\mathscr\\{H\\}/g, '\\u210B' ],\n    [ /\\\\mathfrak\\{H\\}/g, '\\u210C' ],\n    [ /\\\\mathbb\\{H\\}/g, '\\u210D' ],\n    [ /\\\\hslash /g, '\\u210F' ],\n    [ /\\\\mathscr\\{I\\}/g, '\\u2110' ],\n    [ /\\\\mathfrak\\{I\\}/g, '\\u2111' ],\n    [ /\\\\mathscr\\{L\\}/g, '\\u2112' ],\n    [ /\\\\mathscr\\{l\\}/g, '\\u2113' ],\n    [ /\\\\mathbb\\{N\\}/g, '\\u2115' ],\n    [ /\\\\cyrchar\\\\textnumero /g, '\\u2116' ],\n    [ /\\\\wp /g, '\\u2118' ],\n    [ /\\\\mathbb\\{P\\}/g, '\\u2119' ],\n    [ /\\\\mathbb\\{Q\\}/g, '\\u211A' ],\n    [ /\\\\mathscr\\{R\\}/g, '\\u211B' ],\n    [ /\\\\mathfrak\\{R\\}/g, '\\u211C' ],\n    [ /\\\\mathbb\\{R\\}/g, '\\u211D' ],\n    [ /\\\\Elzxrat /g, '\\u211E' ],\n    [ /\\\\texttrademark /g, '\\u2122' ],\n    [ /\\\\mathbb\\{Z\\}/g, '\\u2124' ],\n    [ /\\\\Omega /g, '\\u2126' ],\n    [ /\\\\mho /g, '\\u2127' ],\n    [ /\\\\mathfrak\\{Z\\}/g, '\\u2128' ],\n    [ /\\\\ElsevierGlyph\\{2129\\}/g, '\\u2129' ],\n    [ /\\\\AA /g, '\\u212B' ],\n    [ /\\\\mathscr\\{B\\}/g, '\\u212C' ],\n    [ /\\\\mathfrak\\{C\\}/g, '\\u212D' ],\n    [ /\\\\mathscr\\{e\\}/g, '\\u212F' ],\n    [ /\\\\mathscr\\{E\\}/g, '\\u2130' ],\n    [ /\\\\mathscr\\{F\\}/g, '\\u2131' ],\n    [ /\\\\mathscr\\{M\\}/g, '\\u2133' ],\n    [ /\\\\mathscr\\{o\\}/g, '\\u2134' ],\n    [ /\\\\aleph /g, '\\u2135' ],\n    [ /\\\\beth /g, '\\u2136' ],\n    [ /\\\\gimel /g, '\\u2137' ],\n    [ /\\\\daleth /g, '\\u2138' ],\n    [ /\\\\textfrac\\{1\\}\\{3\\}/g, '\\u2153' ],\n    [ /\\\\textfrac\\{2\\}\\{3\\}/g, '\\u2154' ],\n    [ /\\\\textfrac\\{1\\}\\{5\\}/g, '\\u2155' ],\n    [ /\\\\textfrac\\{2\\}\\{5\\}/g, '\\u2156' ],\n    [ /\\\\textfrac\\{3\\}\\{5\\}/g, '\\u2157' ],\n    [ /\\\\textfrac\\{4\\}\\{5\\}/g, '\\u2158' ],\n    [ /\\\\textfrac\\{1\\}\\{6\\}/g, '\\u2159' ],\n    [ /\\\\textfrac\\{5\\}\\{6\\}/g, '\\u215A' ],\n    [ /\\\\textfrac\\{1\\}\\{8\\}/g, '\\u215B' ],\n    [ /\\\\textfrac\\{3\\}\\{8\\}/g, '\\u215C' ],\n    [ /\\\\textfrac\\{5\\}\\{8\\}/g, '\\u215D' ],\n    [ /\\\\textfrac\\{7\\}\\{8\\}/g, '\\u215E' ],\n    [ /\\\\leftarrow /g, '\\u2190' ],\n    [ /\\\\uparrow /g, '\\u2191' ],\n    [ /\\\\rightarrow /g, '\\u2192' ],\n    [ /\\\\downarrow /g, '\\u2193' ],\n    [ /\\\\leftrightarrow /g, '\\u2194' ],\n    [ /\\\\updownarrow /g, '\\u2195' ],\n    [ /\\\\nwarrow /g, '\\u2196' ],\n    [ /\\\\nearrow /g, '\\u2197' ],\n    [ /\\\\searrow /g, '\\u2198' ],\n    [ /\\\\swarrow /g, '\\u2199' ],\n    [ /\\\\nleftarrow /g, '\\u219A' ],\n    [ /\\\\nrightarrow /g, '\\u219B' ],\n    [ /\\\\arrowwaveright /g, '\\u219C' ],\n    [ /\\\\arrowwaveright /g, '\\u219D' ],\n    [ /\\\\twoheadleftarrow /g, '\\u219E' ],\n    [ /\\\\twoheadrightarrow /g, '\\u21A0' ],\n    [ /\\\\leftarrowtail /g, '\\u21A2' ],\n    [ /\\\\rightarrowtail /g, '\\u21A3' ],\n    [ /\\\\mapsto /g, '\\u21A6' ],\n    [ /\\\\hookleftarrow /g, '\\u21A9' ],\n    [ /\\\\hookrightarrow /g, '\\u21AA' ],\n    [ /\\\\looparrowleft /g, '\\u21AB' ],\n    [ /\\\\looparrowright /g, '\\u21AC' ],\n    [ /\\\\leftrightsquigarrow /g, '\\u21AD' ],\n    [ /\\\\nleftrightarrow /g, '\\u21AE' ],\n    [ /\\\\Lsh /g, '\\u21B0' ],\n    [ /\\\\Rsh /g, '\\u21B1' ],\n    [ /\\\\ElsevierGlyph\\{21B3\\}/g, '\\u21B3' ],\n    [ /\\\\curvearrowleft /g, '\\u21B6' ],\n    [ /\\\\curvearrowright /g, '\\u21B7' ],\n    [ /\\\\circlearrowleft /g, '\\u21BA' ],\n    [ /\\\\circlearrowright /g, '\\u21BB' ],\n    [ /\\\\leftharpoonup /g, '\\u21BC' ],\n    [ /\\\\leftharpoondown /g, '\\u21BD' ],\n    [ /\\\\upharpoonright /g, '\\u21BE' ],\n    [ /\\\\upharpoonleft /g, '\\u21BF' ],\n    [ /\\\\rightharpoonup /g, '\\u21C0' ],\n    [ /\\\\rightharpoondown /g, '\\u21C1' ],\n    [ /\\\\downharpoonright /g, '\\u21C2' ],\n    [ /\\\\downharpoonleft /g, '\\u21C3' ],\n    [ /\\\\rightleftarrows /g, '\\u21C4' ],\n    [ /\\\\dblarrowupdown /g, '\\u21C5' ],\n    [ /\\\\leftrightarrows /g, '\\u21C6' ],\n    [ /\\\\leftleftarrows /g, '\\u21C7' ],\n    [ /\\\\upuparrows /g, '\\u21C8' ],\n    [ /\\\\rightrightarrows /g, '\\u21C9' ],\n    [ /\\\\downdownarrows /g, '\\u21CA' ],\n    [ /\\\\leftrightharpoons /g, '\\u21CB' ],\n    [ /\\\\rightleftharpoons /g, '\\u21CC' ],\n    [ /\\\\nLeftarrow /g, '\\u21CD' ],\n    [ /\\\\nLeftrightarrow /g, '\\u21CE' ],\n    [ /\\\\nRightarrow /g, '\\u21CF' ],\n    [ /\\\\Leftarrow /g, '\\u21D0' ],\n    [ /\\\\Uparrow /g, '\\u21D1' ],\n    [ /\\\\Rightarrow /g, '\\u21D2' ],\n    [ /\\\\Downarrow /g, '\\u21D3' ],\n    [ /\\\\Leftrightarrow /g, '\\u21D4' ],\n    [ /\\\\Updownarrow /g, '\\u21D5' ],\n    [ /\\\\Lleftarrow /g, '\\u21DA' ],\n    [ /\\\\Rrightarrow /g, '\\u21DB' ],\n    [ /\\\\rightsquigarrow /g, '\\u21DD' ],\n    [ /\\\\DownArrowUpArrow /g, '\\u21F5' ],\n    [ /\\\\forall /g, '\\u2200' ],\n    [ /\\\\complement /g, '\\u2201' ],\n    [ /\\\\partial /g, '\\u2202' ],\n    [ /\\\\exists /g, '\\u2203' ],\n    [ /\\\\nexists /g, '\\u2204' ],\n    [ /\\\\varnothing /g, '\\u2205' ],\n    [ /\\\\nabla /g, '\\u2207' ],\n    [ /\\\\in /g, '\\u2208' ],\n    [ /\\\\not\\\\in /g, '\\u2209' ],\n    [ /\\\\ni /g, '\\u220B' ],\n    [ /\\\\not\\\\ni /g, '\\u220C' ],\n    [ /\\\\prod /g, '\\u220F' ],\n    [ /\\\\coprod /g, '\\u2210' ],\n    [ /\\\\sum /g, '\\u2211' ],\n    [ /\\\\mp /g, '\\u2213' ],\n    [ /\\\\dotplus /g, '\\u2214' ],\n    [ /\\\\setminus /g, '\\u2216' ],\n    [ /\\\\circ /g, '\\u2218' ],\n    [ /\\\\bullet /g, '\\u2219' ],\n    [ /\\\\surd /g, '\\u221A' ],\n    [ /\\\\propto /g, '\\u221D' ],\n    [ /\\\\infty /g, '\\u221E' ],\n    [ /\\\\rightangle /g, '\\u221F' ],\n    [ /\\\\angle /g, '\\u2220' ],\n    [ /\\\\measuredangle /g, '\\u2221' ],\n    [ /\\\\sphericalangle /g, '\\u2222' ],\n    [ /\\\\mid /g, '\\u2223' ],\n    [ /\\\\nmid /g, '\\u2224' ],\n    [ /\\\\parallel /g, '\\u2225' ],\n    [ /\\\\nparallel /g, '\\u2226' ],\n    [ /\\\\wedge /g, '\\u2227' ],\n    [ /\\\\vee /g, '\\u2228' ],\n    [ /\\\\cap /g, '\\u2229' ],\n    [ /\\\\cup /g, '\\u222A' ],\n    [ /\\\\int /g, '\\u222B' ],\n    [ /\\\\int\\\\!\\\\int /g, '\\u222C' ],\n    [ /\\\\int\\\\!\\\\int\\\\!\\\\int /g, '\\u222D' ],\n    [ /\\\\oint /g, '\\u222E' ],\n    [ /\\\\surfintegral /g, '\\u222F' ],\n    [ /\\\\volintegral /g, '\\u2230' ],\n    [ /\\\\clwintegral /g, '\\u2231' ],\n    [ /\\\\ElsevierGlyph\\{2232\\}/g, '\\u2232' ],\n    [ /\\\\ElsevierGlyph\\{2233\\}/g, '\\u2233' ],\n    [ /\\\\therefore /g, '\\u2234' ],\n    [ /\\\\because /g, '\\u2235' ],\n    [ /\\\\Colon /g, '\\u2237' ],\n    [ /\\\\ElsevierGlyph\\{2238\\}/g, '\\u2238' ],\n    [ /\\\\mathbin\\{\\{:\\}\\\\!\\\\!\\{\\-\\}\\\\!\\\\!\\{:\\}\\}/g, '\\u223A' ],\n    [ /\\\\homothetic /g, '\\u223B' ],\n    [ /\\\\sim /g, '\\u223C' ],\n    [ /\\\\backsim /g, '\\u223D' ],\n    [ /\\\\lazysinv /g, '\\u223E' ],\n    [ /\\\\wr /g, '\\u2240' ],\n    [ /\\\\not\\\\sim /g, '\\u2241' ],\n    [ /\\\\ElsevierGlyph\\{2242\\}/g, '\\u2242' ],\n    [ /\\\\NotEqualTilde /g, '\\u2242-00338' ],\n    [ /\\\\simeq /g, '\\u2243' ],\n    [ /\\\\not\\\\simeq /g, '\\u2244' ],\n    [ /\\\\cong /g, '\\u2245' ],\n    [ /\\\\approxnotequal /g, '\\u2246' ],\n    [ /\\\\not\\\\cong /g, '\\u2247' ],\n    [ /\\\\approx /g, '\\u2248' ],\n    [ /\\\\not\\\\approx /g, '\\u2249' ],\n    [ /\\\\approxeq /g, '\\u224A' ],\n    [ /\\\\tildetrpl /g, '\\u224B' ],\n    [ /\\\\not\\\\apid /g, '\\u224B-00338' ],\n    [ /\\\\allequal /g, '\\u224C' ],\n    [ /\\\\asymp /g, '\\u224D' ],\n    [ /\\\\Bumpeq /g, '\\u224E' ],\n    [ /\\\\NotHumpDownHump /g, '\\u224E-00338' ],\n    [ /\\\\bumpeq /g, '\\u224F' ],\n    [ /\\\\NotHumpEqual /g, '\\u224F-00338' ],\n    [ /\\\\doteq /g, '\\u2250' ],\n    [ /\\\\not\\\\doteq/g, '\\u2250-00338' ],\n    [ /\\\\doteqdot /g, '\\u2251' ],\n    [ /\\\\fallingdotseq /g, '\\u2252' ],\n    [ /\\\\risingdotseq /g, '\\u2253' ],\n    [ /\\\\eqcirc /g, '\\u2256' ],\n    [ /\\\\circeq /g, '\\u2257' ],\n    [ /\\\\estimates /g, '\\u2259' ],\n    [ /\\\\ElsevierGlyph\\{225A\\}/g, '\\u225A' ],\n    [ /\\\\starequal /g, '\\u225B' ],\n    [ /\\\\triangleq /g, '\\u225C' ],\n    [ /\\\\ElsevierGlyph\\{225F\\}/g, '\\u225F' ],\n    [ /\\\\not =/g, '\\u2260' ],\n    [ /\\\\equiv /g, '\\u2261' ],\n    [ /\\\\not\\\\equiv /g, '\\u2262' ],\n    [ /\\\\leq /g, '\\u2264' ],\n    [ /\\\\geq /g, '\\u2265' ],\n    [ /\\\\leqq /g, '\\u2266' ],\n    [ /\\\\geqq /g, '\\u2267' ],\n    [ /\\\\lneqq /g, '\\u2268' ],\n    [ /\\\\lvertneqq /g, '\\u2268-0FE00' ],\n    [ /\\\\gneqq /g, '\\u2269' ],\n    [ /\\\\gvertneqq /g, '\\u2269-0FE00' ],\n    [ /\\\\ll /g, '\\u226A' ],\n    [ /\\\\NotLessLess /g, '\\u226A-00338' ],\n    [ /\\\\gg /g, '\\u226B' ],\n    [ /\\\\NotGreaterGreater /g, '\\u226B-00338' ],\n    [ /\\\\between /g, '\\u226C' ],\n    [ /\\\\not\\\\kern\\-0.3em\\\\times /g, '\\u226D' ],\n    [ /\\\\not</g, '\\u226E' ],\n    [ /\\\\not>/g, '\\u226F' ],\n    [ /\\\\not\\\\leq /g, '\\u2270' ],\n    [ /\\\\not\\\\geq /g, '\\u2271' ],\n    [ /\\\\lessequivlnt /g, '\\u2272' ],\n    [ /\\\\greaterequivlnt /g, '\\u2273' ],\n    [ /\\\\ElsevierGlyph\\{2274\\}/g, '\\u2274' ],\n    [ /\\\\ElsevierGlyph\\{2275\\}/g, '\\u2275' ],\n    [ /\\\\lessgtr /g, '\\u2276' ],\n    [ /\\\\gtrless /g, '\\u2277' ],\n    [ /\\\\notlessgreater /g, '\\u2278' ],\n    [ /\\\\notgreaterless /g, '\\u2279' ],\n    [ /\\\\prec /g, '\\u227A' ],\n    [ /\\\\succ /g, '\\u227B' ],\n    [ /\\\\preccurlyeq /g, '\\u227C' ],\n    [ /\\\\succcurlyeq /g, '\\u227D' ],\n    [ /\\\\precapprox /g, '\\u227E' ],\n    [ /\\\\NotPrecedesTilde /g, '\\u227E-00338' ],\n    [ /\\\\succapprox /g, '\\u227F' ],\n    [ /\\\\NotSucceedsTilde /g, '\\u227F-00338' ],\n    [ /\\\\not\\\\prec /g, '\\u2280' ],\n    [ /\\\\not\\\\succ /g, '\\u2281' ],\n    [ /\\\\subset /g, '\\u2282' ],\n    [ /\\\\supset /g, '\\u2283' ],\n    [ /\\\\not\\\\subset /g, '\\u2284' ],\n    [ /\\\\not\\\\supset /g, '\\u2285' ],\n    [ /\\\\subseteq /g, '\\u2286' ],\n    [ /\\\\supseteq /g, '\\u2287' ],\n    [ /\\\\not\\\\subseteq /g, '\\u2288' ],\n    [ /\\\\not\\\\supseteq /g, '\\u2289' ],\n    [ /\\\\subsetneq /g, '\\u228A' ],\n    [ /\\\\varsubsetneqq /g, '\\u228A-0FE00' ],\n    [ /\\\\supsetneq /g, '\\u228B' ],\n    [ /\\\\varsupsetneq /g, '\\u228B-0FE00' ],\n    [ /\\\\uplus /g, '\\u228E' ],\n    [ /\\\\sqsubset /g, '\\u228F' ],\n    [ /\\\\NotSquareSubset /g, '\\u228F-00338' ],\n    [ /\\\\sqsupset /g, '\\u2290' ],\n    [ /\\\\NotSquareSuperset /g, '\\u2290-00338' ],\n    [ /\\\\sqsubseteq /g, '\\u2291' ],\n    [ /\\\\sqsupseteq /g, '\\u2292' ],\n    [ /\\\\sqcap /g, '\\u2293' ],\n    [ /\\\\sqcup /g, '\\u2294' ],\n    [ /\\\\oplus /g, '\\u2295' ],\n    [ /\\\\ominus /g, '\\u2296' ],\n    [ /\\\\otimes /g, '\\u2297' ],\n    [ /\\\\oslash /g, '\\u2298' ],\n    [ /\\\\odot /g, '\\u2299' ],\n    [ /\\\\circledcirc /g, '\\u229A' ],\n    [ /\\\\circledast /g, '\\u229B' ],\n    [ /\\\\circleddash /g, '\\u229D' ],\n    [ /\\\\boxplus /g, '\\u229E' ],\n    [ /\\\\boxminus /g, '\\u229F' ],\n    [ /\\\\boxtimes /g, '\\u22A0' ],\n    [ /\\\\boxdot /g, '\\u22A1' ],\n    [ /\\\\vdash /g, '\\u22A2' ],\n    [ /\\\\dashv /g, '\\u22A3' ],\n    [ /\\\\top /g, '\\u22A4' ],\n    [ /\\\\perp /g, '\\u22A5' ],\n    [ /\\\\truestate /g, '\\u22A7' ],\n    [ /\\\\forcesextra /g, '\\u22A8' ],\n    [ /\\\\Vdash /g, '\\u22A9' ],\n    [ /\\\\Vvdash /g, '\\u22AA' ],\n    [ /\\\\VDash /g, '\\u22AB' ],\n    [ /\\\\nvdash /g, '\\u22AC' ],\n    [ /\\\\nvDash /g, '\\u22AD' ],\n    [ /\\\\nVdash /g, '\\u22AE' ],\n    [ /\\\\nVDash /g, '\\u22AF' ],\n    [ /\\\\vartriangleleft /g, '\\u22B2' ],\n    [ /\\\\vartriangleright /g, '\\u22B3' ],\n    [ /\\\\trianglelefteq /g, '\\u22B4' ],\n    [ /\\\\trianglerighteq /g, '\\u22B5' ],\n    [ /\\\\original /g, '\\u22B6' ],\n    [ /\\\\image /g, '\\u22B7' ],\n    [ /\\\\multimap /g, '\\u22B8' ],\n    [ /\\\\hermitconjmatrix /g, '\\u22B9' ],\n    [ /\\\\intercal /g, '\\u22BA' ],\n    [ /\\\\veebar /g, '\\u22BB' ],\n    [ /\\\\rightanglearc /g, '\\u22BE' ],\n    [ /\\\\ElsevierGlyph\\{22C0\\}/g, '\\u22C0' ],\n    [ /\\\\ElsevierGlyph\\{22C1\\}/g, '\\u22C1' ],\n    [ /\\\\bigcap /g, '\\u22C2' ],\n    [ /\\\\bigcup /g, '\\u22C3' ],\n    [ /\\\\diamond /g, '\\u22C4' ],\n    [ /\\\\cdot /g, '\\u22C5' ],\n    [ /\\\\star /g, '\\u22C6' ],\n    [ /\\\\divideontimes /g, '\\u22C7' ],\n    [ /\\\\bowtie /g, '\\u22C8' ],\n    [ /\\\\ltimes /g, '\\u22C9' ],\n    [ /\\\\rtimes /g, '\\u22CA' ],\n    [ /\\\\leftthreetimes /g, '\\u22CB' ],\n    [ /\\\\rightthreetimes /g, '\\u22CC' ],\n    [ /\\\\backsimeq /g, '\\u22CD' ],\n    [ /\\\\curlyvee /g, '\\u22CE' ],\n    [ /\\\\curlywedge /g, '\\u22CF' ],\n    [ /\\\\Subset /g, '\\u22D0' ],\n    [ /\\\\Supset /g, '\\u22D1' ],\n    [ /\\\\Cap /g, '\\u22D2' ],\n    [ /\\\\Cup /g, '\\u22D3' ],\n    [ /\\\\pitchfork /g, '\\u22D4' ],\n    [ /\\\\lessdot /g, '\\u22D6' ],\n    [ /\\\\gtrdot /g, '\\u22D7' ],\n    [ /\\\\verymuchless /g, '\\u22D8' ],\n    [ /\\\\verymuchgreater /g, '\\u22D9' ],\n    [ /\\\\lesseqgtr /g, '\\u22DA' ],\n    [ /\\\\gtreqless /g, '\\u22DB' ],\n    [ /\\\\curlyeqprec /g, '\\u22DE' ],\n    [ /\\\\curlyeqsucc /g, '\\u22DF' ],\n    [ /\\\\not\\\\sqsubseteq /g, '\\u22E2' ],\n    [ /\\\\not\\\\sqsupseteq /g, '\\u22E3' ],\n    [ /\\\\Elzsqspne /g, '\\u22E5' ],\n    [ /\\\\lnsim /g, '\\u22E6' ],\n    [ /\\\\gnsim /g, '\\u22E7' ],\n    [ /\\\\precedesnotsimilar /g, '\\u22E8' ],\n    [ /\\\\succnsim /g, '\\u22E9' ],\n    [ /\\\\ntriangleleft /g, '\\u22EA' ],\n    [ /\\\\ntriangleright /g, '\\u22EB' ],\n    [ /\\\\ntrianglelefteq /g, '\\u22EC' ],\n    [ /\\\\ntrianglerighteq /g, '\\u22ED' ],\n    [ /\\\\vdots /g, '\\u22EE' ],\n    [ /\\\\cdots /g, '\\u22EF' ],\n    [ /\\\\upslopeellipsis /g, '\\u22F0' ],\n    [ /\\\\downslopeellipsis /g, '\\u22F1' ],\n    [ /\\\\barwedge /g, '\\u2305' ],\n    [ /\\\\perspcorrespond /g, '\\u2306' ],\n    [ /\\\\lceil /g, '\\u2308' ],\n    [ /\\\\rceil /g, '\\u2309' ],\n    [ /\\\\lfloor /g, '\\u230A' ],\n    [ /\\\\rfloor /g, '\\u230B' ],\n    [ /\\\\recorder /g, '\\u2315' ],\n    [ /\\\\mathchar\"2208/g, '\\u2316' ],\n    [ /\\\\ulcorner /g, '\\u231C' ],\n    [ /\\\\urcorner /g, '\\u231D' ],\n    [ /\\\\llcorner /g, '\\u231E' ],\n    [ /\\\\lrcorner /g, '\\u231F' ],\n    [ /\\\\frown /g, '\\u2322' ],\n    [ /\\\\smile /g, '\\u2323' ],\n    [ /\\\\langle /g, '\\u2329' ],\n    [ /\\\\rangle /g, '\\u232A' ],\n    [ /\\\\ElsevierGlyph\\{E838\\}/g, '\\u233D' ],\n    [ /\\\\Elzdlcorn /g, '\\u23A3' ],\n    [ /\\\\lmoustache /g, '\\u23B0' ],\n    [ /\\\\rmoustache /g, '\\u23B1' ],\n    [ /\\\\textvisiblespace /g, '\\u2423' ],\n    [ /\\\\ding\\{172\\}/g, '\\u2460' ],\n    [ /\\\\ding\\{173\\}/g, '\\u2461' ],\n    [ /\\\\ding\\{174\\}/g, '\\u2462' ],\n    [ /\\\\ding\\{175\\}/g, '\\u2463' ],\n    [ /\\\\ding\\{176\\}/g, '\\u2464' ],\n    [ /\\\\ding\\{177\\}/g, '\\u2465' ],\n    [ /\\\\ding\\{178\\}/g, '\\u2466' ],\n    [ /\\\\ding\\{179\\}/g, '\\u2467' ],\n    [ /\\\\ding\\{180\\}/g, '\\u2468' ],\n    [ /\\\\ding\\{181\\}/g, '\\u2469' ],\n    [ /\\\\circledS /g, '\\u24C8' ],\n    [ /\\\\Elzdshfnc /g, '\\u2506' ],\n    [ /\\\\Elzsqfnw /g, '\\u2519' ],\n    [ /\\\\diagup /g, '\\u2571' ],\n    [ /\\\\ding\\{110\\}/g, '\\u25A0' ],\n    [ /\\\\square /g, '\\u25A1' ],\n    [ /\\\\blacksquare /g, '\\u25AA' ],\n    [ /\\\\fbox\\{~~\\}/g, '\\u25AD' ],\n    [ /\\\\Elzvrecto /g, '\\u25AF' ],\n    [ /\\\\ElsevierGlyph\\{E381\\}/g, '\\u25B1' ],\n    [ /\\\\ding\\{115\\}/g, '\\u25B2' ],\n    [ /\\\\bigtriangleup /g, '\\u25B3' ],\n    [ /\\\\blacktriangle /g, '\\u25B4' ],\n    [ /\\\\vartriangle /g, '\\u25B5' ],\n    [ /\\\\blacktriangleright /g, '\\u25B8' ],\n    [ /\\\\triangleright /g, '\\u25B9' ],\n    [ /\\\\ding\\{116\\}/g, '\\u25BC' ],\n    [ /\\\\bigtriangledown /g, '\\u25BD' ],\n    [ /\\\\blacktriangledown /g, '\\u25BE' ],\n    [ /\\\\triangledown /g, '\\u25BF' ],\n    [ /\\\\blacktriangleleft /g, '\\u25C2' ],\n    [ /\\\\triangleleft /g, '\\u25C3' ],\n    [ /\\\\ding\\{117\\}/g, '\\u25C6' ],\n    [ /\\\\lozenge /g, '\\u25CA' ],\n    [ /\\\\bigcirc /g, '\\u25CB' ],\n    [ /\\\\ding\\{108\\}/g, '\\u25CF' ],\n    [ /\\\\Elzcirfl /g, '\\u25D0' ],\n    [ /\\\\Elzcirfr /g, '\\u25D1' ],\n    [ /\\\\Elzcirfb /g, '\\u25D2' ],\n    [ /\\\\ding\\{119\\}/g, '\\u25D7' ],\n    [ /\\\\Elzrvbull /g, '\\u25D8' ],\n    [ /\\\\Elzsqfl /g, '\\u25E7' ],\n    [ /\\\\Elzsqfr /g, '\\u25E8' ],\n    [ /\\\\Elzsqfse /g, '\\u25EA' ],\n    [ /\\\\bigcirc /g, '\\u25EF' ],\n    [ /\\\\ding\\{72\\}/g, '\\u2605' ],\n    [ /\\\\ding\\{73\\}/g, '\\u2606' ],\n    [ /\\\\ding\\{37\\}/g, '\\u260E' ],\n    [ /\\\\ding\\{42\\}/g, '\\u261B' ],\n    [ /\\\\ding\\{43\\}/g, '\\u261E' ],\n    [ /\\\\rightmoon /g, '\\u263E' ],\n    [ /\\\\mercury /g, '\\u263F' ],\n    [ /\\\\venus /g, '\\u2640' ],\n    [ /\\\\male /g, '\\u2642' ],\n    [ /\\\\jupiter /g, '\\u2643' ],\n    [ /\\\\saturn /g, '\\u2644' ],\n    [ /\\\\uranus /g, '\\u2645' ],\n    [ /\\\\neptune /g, '\\u2646' ],\n    [ /\\\\pluto /g, '\\u2647' ],\n    [ /\\\\aries /g, '\\u2648' ],\n    [ /\\\\taurus /g, '\\u2649' ],\n    [ /\\\\gemini /g, '\\u264A' ],\n    [ /\\\\cancer /g, '\\u264B' ],\n    [ /\\\\leo /g, '\\u264C' ],\n    [ /\\\\virgo /g, '\\u264D' ],\n    [ /\\\\libra /g, '\\u264E' ],\n    [ /\\\\scorpio /g, '\\u264F' ],\n    [ /\\\\sagittarius /g, '\\u2650' ],\n    [ /\\\\capricornus /g, '\\u2651' ],\n    [ /\\\\aquarius /g, '\\u2652' ],\n    [ /\\\\pisces /g, '\\u2653' ],\n    [ /\\\\ding\\{171\\}/g, '\\u2660' ],\n    [ /\\\\diamond /g, '\\u2662' ],\n    [ /\\\\ding\\{168\\}/g, '\\u2663' ],\n    [ /\\\\ding\\{170\\}/g, '\\u2665' ],\n    [ /\\\\ding\\{169\\}/g, '\\u2666' ],\n    [ /\\\\quarternote /g, '\\u2669' ],\n    [ /\\\\eighthnote /g, '\\u266A' ],\n    [ /\\\\flat /g, '\\u266D' ],\n    [ /\\\\natural /g, '\\u266E' ],\n    [ /\\\\sharp /g, '\\u266F' ],\n    [ /\\\\ding\\{33\\}/g, '\\u2701' ],\n    [ /\\\\ding\\{34\\}/g, '\\u2702' ],\n    [ /\\\\ding\\{35\\}/g, '\\u2703' ],\n    [ /\\\\ding\\{36\\}/g, '\\u2704' ],\n    [ /\\\\ding\\{38\\}/g, '\\u2706' ],\n    [ /\\\\ding\\{39\\}/g, '\\u2707' ],\n    [ /\\\\ding\\{40\\}/g, '\\u2708' ],\n    [ /\\\\ding\\{41\\}/g, '\\u2709' ],\n    [ /\\\\ding\\{44\\}/g, '\\u270C' ],\n    [ /\\\\ding\\{45\\}/g, '\\u270D' ],\n    [ /\\\\ding\\{46\\}/g, '\\u270E' ],\n    [ /\\\\ding\\{47\\}/g, '\\u270F' ],\n    [ /\\\\ding\\{48\\}/g, '\\u2710' ],\n    [ /\\\\ding\\{49\\}/g, '\\u2711' ],\n    [ /\\\\ding\\{50\\}/g, '\\u2712' ],\n    [ /\\\\ding\\{51\\}/g, '\\u2713' ],\n    [ /\\\\ding\\{52\\}/g, '\\u2714' ],\n    [ /\\\\ding\\{53\\}/g, '\\u2715' ],\n    [ /\\\\ding\\{54\\}/g, '\\u2716' ],\n    [ /\\\\ding\\{55\\}/g, '\\u2717' ],\n    [ /\\\\ding\\{56\\}/g, '\\u2718' ],\n    [ /\\\\ding\\{57\\}/g, '\\u2719' ],\n    [ /\\\\ding\\{58\\}/g, '\\u271A' ],\n    [ /\\\\ding\\{59\\}/g, '\\u271B' ],\n    [ /\\\\ding\\{60\\}/g, '\\u271C' ],\n    [ /\\\\ding\\{61\\}/g, '\\u271D' ],\n    [ /\\\\ding\\{62\\}/g, '\\u271E' ],\n    [ /\\\\ding\\{63\\}/g, '\\u271F' ],\n    [ /\\\\ding\\{64\\}/g, '\\u2720' ],\n    [ /\\\\ding\\{65\\}/g, '\\u2721' ],\n    [ /\\\\ding\\{66\\}/g, '\\u2722' ],\n    [ /\\\\ding\\{67\\}/g, '\\u2723' ],\n    [ /\\\\ding\\{68\\}/g, '\\u2724' ],\n    [ /\\\\ding\\{69\\}/g, '\\u2725' ],\n    [ /\\\\ding\\{70\\}/g, '\\u2726' ],\n    [ /\\\\ding\\{71\\}/g, '\\u2727' ],\n    [ /\\\\ding\\{73\\}/g, '\\u2729' ],\n    [ /\\\\ding\\{74\\}/g, '\\u272A' ],\n    [ /\\\\ding\\{75\\}/g, '\\u272B' ],\n    [ /\\\\ding\\{76\\}/g, '\\u272C' ],\n    [ /\\\\ding\\{77\\}/g, '\\u272D' ],\n    [ /\\\\ding\\{78\\}/g, '\\u272E' ],\n    [ /\\\\ding\\{79\\}/g, '\\u272F' ],\n    [ /\\\\ding\\{80\\}/g, '\\u2730' ],\n    [ /\\\\ding\\{81\\}/g, '\\u2731' ],\n    [ /\\\\ding\\{82\\}/g, '\\u2732' ],\n    [ /\\\\ding\\{83\\}/g, '\\u2733' ],\n    [ /\\\\ding\\{84\\}/g, '\\u2734' ],\n    [ /\\\\ding\\{85\\}/g, '\\u2735' ],\n    [ /\\\\ding\\{86\\}/g, '\\u2736' ],\n    [ /\\\\ding\\{87\\}/g, '\\u2737' ],\n    [ /\\\\ding\\{88\\}/g, '\\u2738' ],\n    [ /\\\\ding\\{89\\}/g, '\\u2739' ],\n    [ /\\\\ding\\{90\\}/g, '\\u273A' ],\n    [ /\\\\ding\\{91\\}/g, '\\u273B' ],\n    [ /\\\\ding\\{92\\}/g, '\\u273C' ],\n    [ /\\\\ding\\{93\\}/g, '\\u273D' ],\n    [ /\\\\ding\\{94\\}/g, '\\u273E' ],\n    [ /\\\\ding\\{95\\}/g, '\\u273F' ],\n    [ /\\\\ding\\{96\\}/g, '\\u2740' ],\n    [ /\\\\ding\\{97\\}/g, '\\u2741' ],\n    [ /\\\\ding\\{98\\}/g, '\\u2742' ],\n    [ /\\\\ding\\{99\\}/g, '\\u2743' ],\n    [ /\\\\ding\\{100\\}/g, '\\u2744' ],\n    [ /\\\\ding\\{101\\}/g, '\\u2745' ],\n    [ /\\\\ding\\{102\\}/g, '\\u2746' ],\n    [ /\\\\ding\\{103\\}/g, '\\u2747' ],\n    [ /\\\\ding\\{104\\}/g, '\\u2748' ],\n    [ /\\\\ding\\{105\\}/g, '\\u2749' ],\n    [ /\\\\ding\\{106\\}/g, '\\u274A' ],\n    [ /\\\\ding\\{107\\}/g, '\\u274B' ],\n    [ /\\\\ding\\{109\\}/g, '\\u274D' ],\n    [ /\\\\ding\\{111\\}/g, '\\u274F' ],\n    [ /\\\\ding\\{112\\}/g, '\\u2750' ],\n    [ /\\\\ding\\{113\\}/g, '\\u2751' ],\n    [ /\\\\ding\\{114\\}/g, '\\u2752' ],\n    [ /\\\\ding\\{118\\}/g, '\\u2756' ],\n    [ /\\\\ding\\{120\\}/g, '\\u2758' ],\n    [ /\\\\ding\\{121\\}/g, '\\u2759' ],\n    [ /\\\\ding\\{122\\}/g, '\\u275A' ],\n    [ /\\\\ding\\{123\\}/g, '\\u275B' ],\n    [ /\\\\ding\\{124\\}/g, '\\u275C' ],\n    [ /\\\\ding\\{125\\}/g, '\\u275D' ],\n    [ /\\\\ding\\{126\\}/g, '\\u275E' ],\n    [ /\\\\ding\\{161\\}/g, '\\u2761' ],\n    [ /\\\\ding\\{162\\}/g, '\\u2762' ],\n    [ /\\\\ding\\{163\\}/g, '\\u2763' ],\n    [ /\\\\ding\\{164\\}/g, '\\u2764' ],\n    [ /\\\\ding\\{165\\}/g, '\\u2765' ],\n    [ /\\\\ding\\{166\\}/g, '\\u2766' ],\n    [ /\\\\ding\\{167\\}/g, '\\u2767' ],\n    [ /\\\\ding\\{182\\}/g, '\\u2776' ],\n    [ /\\\\ding\\{183\\}/g, '\\u2777' ],\n    [ /\\\\ding\\{184\\}/g, '\\u2778' ],\n    [ /\\\\ding\\{185\\}/g, '\\u2779' ],\n    [ /\\\\ding\\{186\\}/g, '\\u277A' ],\n    [ /\\\\ding\\{187\\}/g, '\\u277B' ],\n    [ /\\\\ding\\{188\\}/g, '\\u277C' ],\n    [ /\\\\ding\\{189\\}/g, '\\u277D' ],\n    [ /\\\\ding\\{190\\}/g, '\\u277E' ],\n    [ /\\\\ding\\{191\\}/g, '\\u277F' ],\n    [ /\\\\ding\\{192\\}/g, '\\u2780' ],\n    [ /\\\\ding\\{193\\}/g, '\\u2781' ],\n    [ /\\\\ding\\{194\\}/g, '\\u2782' ],\n    [ /\\\\ding\\{195\\}/g, '\\u2783' ],\n    [ /\\\\ding\\{196\\}/g, '\\u2784' ],\n    [ /\\\\ding\\{197\\}/g, '\\u2785' ],\n    [ /\\\\ding\\{198\\}/g, '\\u2786' ],\n    [ /\\\\ding\\{199\\}/g, '\\u2787' ],\n    [ /\\\\ding\\{200\\}/g, '\\u2788' ],\n    [ /\\\\ding\\{201\\}/g, '\\u2789' ],\n    [ /\\\\ding\\{202\\}/g, '\\u278A' ],\n    [ /\\\\ding\\{203\\}/g, '\\u278B' ],\n    [ /\\\\ding\\{204\\}/g, '\\u278C' ],\n    [ /\\\\ding\\{205\\}/g, '\\u278D' ],\n    [ /\\\\ding\\{206\\}/g, '\\u278E' ],\n    [ /\\\\ding\\{207\\}/g, '\\u278F' ],\n    [ /\\\\ding\\{208\\}/g, '\\u2790' ],\n    [ /\\\\ding\\{209\\}/g, '\\u2791' ],\n    [ /\\\\ding\\{210\\}/g, '\\u2792' ],\n    [ /\\\\ding\\{211\\}/g, '\\u2793' ],\n    [ /\\\\ding\\{212\\}/g, '\\u2794' ],\n    [ /\\\\ding\\{216\\}/g, '\\u2798' ],\n    [ /\\\\ding\\{217\\}/g, '\\u2799' ],\n    [ /\\\\ding\\{218\\}/g, '\\u279A' ],\n    [ /\\\\ding\\{219\\}/g, '\\u279B' ],\n    [ /\\\\ding\\{220\\}/g, '\\u279C' ],\n    [ /\\\\ding\\{221\\}/g, '\\u279D' ],\n    [ /\\\\ding\\{222\\}/g, '\\u279E' ],\n    [ /\\\\ding\\{223\\}/g, '\\u279F' ],\n    [ /\\\\ding\\{224\\}/g, '\\u27A0' ],\n    [ /\\\\ding\\{225\\}/g, '\\u27A1' ],\n    [ /\\\\ding\\{226\\}/g, '\\u27A2' ],\n    [ /\\\\ding\\{227\\}/g, '\\u27A3' ],\n    [ /\\\\ding\\{228\\}/g, '\\u27A4' ],\n    [ /\\\\ding\\{229\\}/g, '\\u27A5' ],\n    [ /\\\\ding\\{230\\}/g, '\\u27A6' ],\n    [ /\\\\ding\\{231\\}/g, '\\u27A7' ],\n    [ /\\\\ding\\{232\\}/g, '\\u27A8' ],\n    [ /\\\\ding\\{233\\}/g, '\\u27A9' ],\n    [ /\\\\ding\\{234\\}/g, '\\u27AA' ],\n    [ /\\\\ding\\{235\\}/g, '\\u27AB' ],\n    [ /\\\\ding\\{236\\}/g, '\\u27AC' ],\n    [ /\\\\ding\\{237\\}/g, '\\u27AD' ],\n    [ /\\\\ding\\{238\\}/g, '\\u27AE' ],\n    [ /\\\\ding\\{239\\}/g, '\\u27AF' ],\n    [ /\\\\ding\\{241\\}/g, '\\u27B1' ],\n    [ /\\\\ding\\{242\\}/g, '\\u27B2' ],\n    [ /\\\\ding\\{243\\}/g, '\\u27B3' ],\n    [ /\\\\ding\\{244\\}/g, '\\u27B4' ],\n    [ /\\\\ding\\{245\\}/g, '\\u27B5' ],\n    [ /\\\\ding\\{246\\}/g, '\\u27B6' ],\n    [ /\\\\ding\\{247\\}/g, '\\u27B7' ],\n    [ /\\\\ding\\{248\\}/g, '\\u27B8' ],\n    [ /\\\\ding\\{249\\}/g, '\\u27B9' ],\n    [ /\\\\ding\\{250\\}/g, '\\u27BA' ],\n    [ /\\\\ding\\{251\\}/g, '\\u27BB' ],\n    [ /\\\\ding\\{252\\}/g, '\\u27BC' ],\n    [ /\\\\ding\\{253\\}/g, '\\u27BD' ],\n    [ /\\\\ding\\{254\\}/g, '\\u27BE' ],\n    [ /\\\\longleftarrow /g, '\\u27F5' ],\n    [ /\\\\longrightarrow /g, '\\u27F6' ],\n    [ /\\\\longleftrightarrow /g, '\\u27F7' ],\n    [ /\\\\Longleftarrow /g, '\\u27F8' ],\n    [ /\\\\Longrightarrow /g, '\\u27F9' ],\n    [ /\\\\Longleftrightarrow /g, '\\u27FA' ],\n    [ /\\\\longmapsto /g, '\\u27FC' ],\n    [ /\\\\sim\\\\joinrel\\\\leadsto/g, '\\u27FF' ],\n    [ /\\\\ElsevierGlyph\\{E212\\}/g, '\\u2905' ],\n    [ /\\\\UpArrowBar /g, '\\u2912' ],\n    [ /\\\\DownArrowBar /g, '\\u2913' ],\n    [ /\\\\ElsevierGlyph\\{E20C\\}/g, '\\u2923' ],\n    [ /\\\\ElsevierGlyph\\{E20D\\}/g, '\\u2924' ],\n    [ /\\\\ElsevierGlyph\\{E20B\\}/g, '\\u2925' ],\n    [ /\\\\ElsevierGlyph\\{E20A\\}/g, '\\u2926' ],\n    [ /\\\\ElsevierGlyph\\{E211\\}/g, '\\u2927' ],\n    [ /\\\\ElsevierGlyph\\{E20E\\}/g, '\\u2928' ],\n    [ /\\\\ElsevierGlyph\\{E20F\\}/g, '\\u2929' ],\n    [ /\\\\ElsevierGlyph\\{E210\\}/g, '\\u292A' ],\n    [ /\\\\ElsevierGlyph\\{E21C\\}/g, '\\u2933' ],\n    [ /\\\\ElsevierGlyph\\{E21D\\}/g, '\\u2933-00338' ],\n    [ /\\\\ElsevierGlyph\\{E21A\\}/g, '\\u2936' ],\n    [ /\\\\ElsevierGlyph\\{E219\\}/g, '\\u2937' ],\n    [ /\\\\Elolarr /g, '\\u2940' ],\n    [ /\\\\Elorarr /g, '\\u2941' ],\n    [ /\\\\ElzRlarr /g, '\\u2942' ],\n    [ /\\\\ElzrLarr /g, '\\u2944' ],\n    [ /\\\\Elzrarrx /g, '\\u2947' ],\n    [ /\\\\LeftRightVector /g, '\\u294E' ],\n    [ /\\\\RightUpDownVector /g, '\\u294F' ],\n    [ /\\\\DownLeftRightVector /g, '\\u2950' ],\n    [ /\\\\LeftUpDownVector /g, '\\u2951' ],\n    [ /\\\\LeftVectorBar /g, '\\u2952' ],\n    [ /\\\\RightVectorBar /g, '\\u2953' ],\n    [ /\\\\RightUpVectorBar /g, '\\u2954' ],\n    [ /\\\\RightDownVectorBar /g, '\\u2955' ],\n    [ /\\\\DownLeftVectorBar /g, '\\u2956' ],\n    [ /\\\\DownRightVectorBar /g, '\\u2957' ],\n    [ /\\\\LeftUpVectorBar /g, '\\u2958' ],\n    [ /\\\\LeftDownVectorBar /g, '\\u2959' ],\n    [ /\\\\LeftTeeVector /g, '\\u295A' ],\n    [ /\\\\RightTeeVector /g, '\\u295B' ],\n    [ /\\\\RightUpTeeVector /g, '\\u295C' ],\n    [ /\\\\RightDownTeeVector /g, '\\u295D' ],\n    [ /\\\\DownLeftTeeVector /g, '\\u295E' ],\n    [ /\\\\DownRightTeeVector /g, '\\u295F' ],\n    [ /\\\\LeftUpTeeVector /g, '\\u2960' ],\n    [ /\\\\LeftDownTeeVector /g, '\\u2961' ],\n    [ /\\\\UpEquilibrium /g, '\\u296E' ],\n    [ /\\\\ReverseUpEquilibrium /g, '\\u296F' ],\n    [ /\\\\RoundImplies /g, '\\u2970' ],\n    [ /\\\\ElsevierGlyph\\{E214\\}/g, '\\u297C' ],\n    [ /\\\\ElsevierGlyph\\{E215\\}/g, '\\u297D' ],\n    [ /\\\\Elztfnc /g, '\\u2980' ],\n    [ /\\\\ElsevierGlyph\\{3018\\}/g, '\\u2985' ],\n    [ /\\\\Elroang /g, '\\u2986' ],\n    [ /\\\\ElsevierGlyph\\{E291\\}/g, '\\u2994' ],\n    [ /\\\\Elzddfnc /g, '\\u2999' ],\n    [ /\\\\Angle /g, '\\u299C' ],\n    [ /\\\\Elzlpargt /g, '\\u29A0' ],\n    [ /\\\\ElsevierGlyph\\{E260\\}/g, '\\u29B5' ],\n    [ /\\\\ElsevierGlyph\\{E61B\\}/g, '\\u29B6' ],\n    [ /\\\\ElzLap /g, '\\u29CA' ],\n    [ /\\\\Elzdefas /g, '\\u29CB' ],\n    [ /\\\\LeftTriangleBar /g, '\\u29CF' ],\n    [ /\\\\NotLeftTriangleBar /g, '\\u29CF-00338' ],\n    [ /\\\\RightTriangleBar /g, '\\u29D0' ],\n    [ /\\\\NotRightTriangleBar /g, '\\u29D0-00338' ],\n    [ /\\\\ElsevierGlyph\\{E372\\}/g, '\\u29DC' ],\n    [ /\\\\blacklozenge /g, '\\u29EB' ],\n    [ /\\\\RuleDelayed /g, '\\u29F4' ],\n    [ /\\\\Elxuplus /g, '\\u2A04' ],\n    [ /\\\\ElzThr /g, '\\u2A05' ],\n    [ /\\\\Elxsqcup /g, '\\u2A06' ],\n    [ /\\\\ElzInf /g, '\\u2A07' ],\n    [ /\\\\ElzSup /g, '\\u2A08' ],\n    [ /\\\\ElzCint /g, '\\u2A0D' ],\n    [ /\\\\clockoint /g, '\\u2A0F' ],\n    [ /\\\\ElsevierGlyph\\{E395\\}/g, '\\u2A10' ],\n    [ /\\\\sqrint /g, '\\u2A16' ],\n    [ /\\\\ElsevierGlyph\\{E25A\\}/g, '\\u2A25' ],\n    [ /\\\\ElsevierGlyph\\{E25B\\}/g, '\\u2A2A' ],\n    [ /\\\\ElsevierGlyph\\{E25C\\}/g, '\\u2A2D' ],\n    [ /\\\\ElsevierGlyph\\{E25D\\}/g, '\\u2A2E' ],\n    [ /\\\\ElzTimes /g, '\\u2A2F' ],\n    [ /\\\\ElsevierGlyph\\{E25E\\}/g, '\\u2A34' ],\n    [ /\\\\ElsevierGlyph\\{E25E\\}/g, '\\u2A35' ],\n    [ /\\\\ElsevierGlyph\\{E259\\}/g, '\\u2A3C' ],\n    [ /\\\\amalg /g, '\\u2A3F' ],\n    [ /\\\\ElzAnd /g, '\\u2A53' ],\n    [ /\\\\ElzOr /g, '\\u2A54' ],\n    [ /\\\\ElsevierGlyph\\{E36E\\}/g, '\\u2A55' ],\n    [ /\\\\ElOr /g, '\\u2A56' ],\n    [ /\\\\perspcorrespond /g, '\\u2A5E' ],\n    [ /\\\\Elzminhat /g, '\\u2A5F' ],\n    [ /\\\\ElsevierGlyph\\{225A\\}/g, '\\u2A63' ],\n    [ /\\\\stackrel\\{*\\}\\{=\\}/g, '\\u2A6E' ],\n    [ /\\\\Equal /g, '\\u2A75' ],\n    [ /\\\\leqslant /g, '\\u2A7D' ],\n    [ /\\\\nleqslant /g, '\\u2A7D-00338' ],\n    [ /\\\\geqslant /g, '\\u2A7E' ],\n    [ /\\\\ngeqslant /g, '\\u2A7E-00338' ],\n    [ /\\\\lessapprox /g, '\\u2A85' ],\n    [ /\\\\gtrapprox /g, '\\u2A86' ],\n    [ /\\\\lneq /g, '\\u2A87' ],\n    [ /\\\\gneq /g, '\\u2A88' ],\n    [ /\\\\lnapprox /g, '\\u2A89' ],\n    [ /\\\\gnapprox /g, '\\u2A8A' ],\n    [ /\\\\lesseqqgtr /g, '\\u2A8B' ],\n    [ /\\\\gtreqqless /g, '\\u2A8C' ],\n    [ /\\\\eqslantless /g, '\\u2A95' ],\n    [ /\\\\eqslantgtr /g, '\\u2A96' ],\n    [ /\\\\Pisymbol\\{ppi020\\}\\{117\\}/g, '\\u2A9D' ],\n    [ /\\\\Pisymbol\\{ppi020\\}\\{105\\}/g, '\\u2A9E' ],\n    [ /\\\\NestedLessLess /g, '\\u2AA1' ],\n    [ /\\\\NotNestedLessLess /g, '\\u2AA1-00338' ],\n    [ /\\\\NestedGreaterGreater /g, '\\u2AA2' ],\n    [ /\\\\NotNestedGreaterGreater /g, '\\u2AA2-00338' ],\n    [ /\\\\preceq /g, '\\u2AAF' ],\n    [ /\\\\not\\\\preceq /g, '\\u2AAF-00338' ],\n    [ /\\\\succeq /g, '\\u2AB0' ],\n    [ /\\\\not\\\\succeq /g, '\\u2AB0-00338' ],\n    [ /\\\\precneqq /g, '\\u2AB5' ],\n    [ /\\\\succneqq /g, '\\u2AB6' ],\n    [ /\\\\precapprox /g, '\\u2AB7' ],\n    [ /\\\\succapprox /g, '\\u2AB8' ],\n    [ /\\\\precnapprox /g, '\\u2AB9' ],\n    [ /\\\\succnapprox /g, '\\u2ABA' ],\n    [ /\\\\subseteqq /g, '\\u2AC5' ],\n    [ /\\\\nsubseteqq /g, '\\u2AC5-00338' ],\n    [ /\\\\supseteqq /g, '\\u2AC6' ],\n    [ /\\\\nsupseteqq/g, '\\u2AC6-00338' ],\n    [ /\\\\subsetneqq /g, '\\u2ACB' ],\n    [ /\\\\supsetneqq /g, '\\u2ACC' ],\n    [ /\\\\ElsevierGlyph\\{E30D\\}/g, '\\u2AEB' ],\n    [ /\\\\Elztdcol /g, '\\u2AF6' ],\n    [ /\\\\ElsevierGlyph\\{300A\\}/g, '\\u300A' ],\n    [ /\\\\ElsevierGlyph\\{300B\\}/g, '\\u300B' ],\n    [ /\\\\ElsevierGlyph\\{3018\\}/g, '\\u3018' ],\n    [ /\\\\ElsevierGlyph\\{3019\\}/g, '\\u3019' ],\n    [ /\\\\openbracketleft /g, '\\u301A' ],\n    [ /\\\\openbracketright /g, '\\u301B' ]\n  ]\n\n  return this;\n} // end function BibtexParser\n\nif (typeof module !== 'undefined' && module.exports) {\n  module.exports = BibtexParser;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/libs/bibtex.js\n **/","define([\n    \"mvc/base-mvc\",\n    \"mvc/citation/citation-model\",\n    \"utils/localization\"\n], function( baseMVC, citationModel, _l ){\n\nvar CitationView = Backbone.View.extend({\n    tagName: 'div',\n    className: 'citations',\n    render: function() {\n        this.$el.append( \"<p>\" + this.formattedReference() + \"</p>\" );\n        return this;\n    },\n    formattedReference: function() {\n        var model = this.model;\n        var entryType = model.entryType();\n        var fields = model.fields();\n\n        var ref = \"\";\n        // Code inspired by...\n        // https://github.com/vkaravir/bib-publication-list/blob/master/src/bib-publication-list.js\n        var authorsAndYear = this._asSentence( (fields.author ? fields.author : \"\") + (fields.year ? (\" (\" + fields.year + \")\") : \"\") ) + \" \";\n        var title = fields.title || \"\";\n        var pages = fields.pages ? (\"pp. \" + fields.pages) : \"\";\n        var address = fields.address;\n        if( entryType == \"article\" ) {\n            var volume = (fields.volume ? fields.volume : \"\") +\n                         (fields.number ? ( \" (\" + fields.number + \")\" ) : \"\") +\n                         (pages ? \", \" + pages : \"\");\n            ref = authorsAndYear + this._asSentence(title) +\n                    (fields.journal ? (\"In <em>\" + fields.journal + \", \") : \"\") +\n                    this._asSentence(volume) + \n                    this._asSentence(fields.address) +\n                    \"<\\/em>\";\n        } else if( entryType == \"inproceedings\" || entryType == \"proceedings\" ) {\n            ref = authorsAndYear + \n                    this._asSentence(title) + \n                    (fields.booktitle ? (\"In <em>\" + fields.booktitle + \", \") : \"\") +\n                    (pages ? pages : \"\") +\n                    (address ? \", \" + address : \"\") + \n                    \".<\\/em>\";\n        } else if( entryType == \"mastersthesis\" || entryType == \"phdthesis\" ) {\n            ref = authorsAndYear + this._asSentence(title) +\n                    (fields.howpublished ? fields.howpublished + \". \" : \"\") +\n                    (fields.note ? fields.note + \".\" : \"\");\n        } else if( entryType == \"techreport\" ) {\n            ref = authorsAndYear + this._asSentence(title) +\n                    this._asSentence(fields.institution) +\n                    this._asSentence(fields.number) +\n                    this._asSentence(fields.type);\n        } else if( entryType == \"book\" || entryType == \"inbook\" || entryType == \"incollection\" ) {\n            ref = authorsAndYear + \" \" + this._formatBookInfo(fields);\n        } else {\n            ref = authorsAndYear + \" \" + this._asSentence(title) +\n                    this._asSentence(fields.howpublished) +\n                    this._asSentence(fields.note);\n        }\n        var doiUrl = \"\";\n        if( fields.doi ) {\n            doiUrl = 'http://dx.doi.org/' + fields.doi;\n            ref += '[<a href=\"' + doiUrl + '\" target=\"_blank\">doi:' + fields.doi + \"</a>]\";\n        }\n        var url = fields.url || doiUrl;\n        if( url ) {\n            ref += '[<a href=\"' + url + '\" target=\"_blank\">Link</a>]';\n        }\n        return ref;\n    },\n    _formatBookInfo: function(fields) {\n        var info = \"\";\n        if( fields.chapter ) {\n            info += fields.chapter + \" in \";\n        }\n        if( fields.title ) {\n            info += \"<em>\" + fields.title + \"<\\/em>\";\n        }\n        if( fields.editor ) {\n            info += \", Edited by \" + fields.editor + \", \";\n        }\n        if( fields.publisher) {\n            info += \", \" + fields.publisher;\n        }\n        if( fields.pages ) {\n            info += \", pp. \" + fields.pages + \"\";\n        }\n        if( fields.series ) {\n            info += \", <em>\" + fields.series + \"<\\/em>\";\n        }\n        if( fields.volume ) {\n            info += \", Vol.\" + fields.volume;\n        }\n        if( fields.issn ) {\n            info += \", ISBN: \" + fields.issn;\n        }\n        return info + \".\";\n    },\n    _asSentence: function(str) {\n        return (str && str.trim()) ? str + \". \" : \"\";\n    }\n});\n\nvar CitationListView = Backbone.View.extend({\n    el: '#citations',\n    /**\n     * Set up view.\n     */\n    initialize: function() {\n        this.listenTo( this.collection, 'add', this.renderCitation );\n    },\n\n    events: {\n        'click .citations-to-bibtex': 'showBibtex',\n        'click .citations-to-formatted': 'showFormatted'\n    },\n\n    renderCitation: function( citation ) {\n        var citationView = new CitationView( { model: citation } );\n        this.$(\".citations-formatted\").append( citationView.render().el );\n        var rawTextarea = this.$(\".citations-bibtex-text\");\n        rawTextarea.val( rawTextarea.val() + \"\\n\\r\" + citation.attributes.content );\n    },\n\n    render: function() {\n        this.$el.html(this.citationsElement());\n        this.collection.each(function( item ){\n            this.renderCitation( item );\n        }, this);\n        this.showFormatted();\n    },\n\n    showBibtex: function() {\n        this.$(\".citations-to-formatted\").show();\n        this.$(\".citations-to-bibtex\").hide();\n        this.$(\".citations-bibtex\").show();\n        this.$(\".citations-formatted\").hide();\n        this.$(\".citations-bibtex-text\").select();\n    },\n\n    showFormatted: function() {\n        this.$(\".citations-to-formatted\").hide();\n        this.$(\".citations-to-bibtex\").show();\n        this.$(\".citations-bibtex\").hide();\n        this.$(\".citations-formatted\").show();\n    },\n\n    partialWarningElement: function() {\n        if( this.collection.partial ) {\n            return [\n                '<div style=\"padding:5px 10px\">',\n                '<b>Warning: This is a experimental feature.</b> Most Galaxy tools will not annotate',\n                ' citations explicitly at this time. When writing up your analysis, please manually',\n                ' review your histories and find all references',\n                ' that should be cited in order to completely describe your work. Also, please remember to',\n                ' <a href=\"https://wiki.galaxyproject.org/CitingGalaxy\">cite Galaxy</a>.',\n                '</div>',\n            ].join('');\n        } else {\n            return '';\n        }\n    },\n\n    citationsElement: function() {\n        return [\n            '<div class=\"toolForm\">',\n                '<div class=\"toolFormTitle\">',\n                    _l(\"Citations\"),\n                    ' <button type=\"button\" class=\"btn btn-xs citations-to-bibtex\" title=\"Show all in BibTeX format.\"><i class=\"fa fa-pencil-square-o\"></i> Show BibTeX</button>',\n                    ' <button type=\"button\" class=\"btn btn-xs citations-to-formatted\" title=\"Return to formatted citation list.\"><i class=\"fa fa-times\"></i> Hide BibTeX</button>',\n                '</div>',\n                '<div class=\"toolFormBody\" style=\"padding:5px 10px\">',\n                this.partialWarningElement(),\n                '<span class=\"citations-formatted\" style=\"word-wrap: break-word;\"></span>',\n                '</div>',\n                '<div class=\"citations-bibtex toolFormBody\" style=\"padding:5px 10px\">',\n                '<textarea style=\"width: 100%; height: 500px;\" class=\"citations-bibtex-text\"></textarea>',\n                '</div>',\n            '</div>'\n        ].join( '' );\n    }\n});\n\n//==============================================================================\nreturn {\n    CitationView : CitationView,\n    CitationListView  : CitationListView\n};\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/citation/citation-view.js\n **/","define([\n    \"mvc/list/list-item\",\n    \"mvc/dataset/dataset-li\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( LIST_ITEM, DATASET_LI, BASE_MVC, _l ){\n\n'use strict';\n//==============================================================================\nvar FoldoutListItemView = LIST_ITEM.FoldoutListItemView,\n    ListItemView = LIST_ITEM.ListItemView;\n/** @class Read only view for DatasetCollection.\n */\nvar DCListItemView = FoldoutListItemView.extend(\n/** @lends DCListItemView.prototype */{\n//TODO: may not be needed\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    className   : FoldoutListItemView.prototype.className + \" dataset-collection\",\n    id          : function(){\n        return [ 'dataset_collection', this.model.get( 'id' ) ].join( '-' );\n    },\n\n    /** override to add linkTarget */\n    initialize : function( attributes ){\n        this.linkTarget = attributes.linkTarget || '_blank';\n        this.hasUser = attributes.hasUser;\n        FoldoutListItemView.prototype.initialize.call( this, attributes );\n    },\n\n    /** event listeners */\n    _setUpListeners : function(){\n        FoldoutListItemView.prototype._setUpListeners.call( this );\n        this.listenTo( this.model, 'change', function( model, options ){\n            // if the model has changed deletion status render it entirely\n            if( _.has( model.changed, 'deleted' ) ){\n                this.render();\n\n            // if the model has been decorated after the fact with the element count,\n            // render the subtitle where the count is displayed\n            } else if( _.has( model.changed, 'element_count' ) ){\n                this.$( '> .title-bar .subtitle' ).replaceWith( this._renderSubtitle() );\n            }\n        });\n    },\n\n    // ......................................................................... rendering\n    /** render a subtitle to show the user what sort of collection this is */\n    _renderSubtitle : function(){\n        return $( this.templates.subtitle( this.model.toJSON(), this ) );\n    },\n\n    // ......................................................................... foldout\n    /** override to add linktarget to sub-panel */\n    _getFoldoutPanelOptions : function(){\n        var options = FoldoutListItemView.prototype._getFoldoutPanelOptions.call( this );\n        return _.extend( options, {\n            linkTarget  : this.linkTarget,\n            hasUser     : this.hasUser\n        });\n    },\n\n    /** override to not catch sub-panel selectors */\n    $selector : function(){\n        return this.$( '> .selector' );\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'DCListItemView(' + modelString + ')';\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDCListItemView.prototype.templates = (function(){\n\n    var warnings = _.extend( {}, FoldoutListItemView.prototype.templates.warnings, {\n        error : BASE_MVC.wrapTemplate([\n            // error during index fetch - show error on dataset\n            '<% if( model.error ){ %>',\n                '<div class=\"errormessagesmall\">',\n                    _l( 'There was an error getting the data for this collection' ), ': <%- model.error %>',\n                '</div>',\n            '<% } %>'\n        ]),\n        purged : BASE_MVC.wrapTemplate([\n            '<% if( model.purged ){ %>',\n                '<div class=\"purged-msg warningmessagesmall\">',\n                    _l( 'This collection has been deleted and removed from disk' ),\n                '</div>',\n            '<% } %>'\n        ]),\n        deleted : BASE_MVC.wrapTemplate([\n            // deleted not purged\n            '<% if( model.deleted && !model.purged ){ %>',\n                '<div class=\"deleted-msg warningmessagesmall\">',\n                    _l( 'This collection has been deleted' ),\n                '</div>',\n            '<% } %>'\n        ])\n    });\n\n    // use element identifier\n    var titleBarTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"title-bar clear\" tabindex=\"0\">',\n            '<div class=\"title\">',\n                '<span class=\"name\"><%- collection.element_identifier || collection.name %></span>',\n            '</div>',\n            '<div class=\"subtitle\"></div>',\n        '</div>'\n    ], 'collection' );\n\n    // use element identifier\n    var subtitleTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"subtitle\">',\n            '<% var countText = collection.element_count? ( collection.element_count + \" \" ) : \"\"; %>',\n            '<%        if( collection.collection_type === \"list\" ){ %>',\n                _l( 'a list of <%- countText %>datasets' ),\n            '<% } else if( collection.collection_type === \"paired\" ){ %>',\n                _l( 'a pair of datasets' ),\n            '<% } else if( collection.collection_type === \"list:paired\" ){ %>',\n                _l( 'a list of <%- countText %>dataset pairs' ),\n            '<% } %>',\n        '</div>'\n    ], 'collection' );\n\n    return _.extend( {}, FoldoutListItemView.prototype.templates, {\n        warnings    : warnings,\n        titleBar    : titleBarTemplate,\n        subtitle    : subtitleTemplate\n    });\n}());\n\n\n//==============================================================================\n/** @class Read only view for DatasetCollectionElement.\n */\nvar DCEListItemView = ListItemView.extend(\n/** @lends DCEListItemView.prototype */{\n//TODO: this might be expendable - compacted with HDAListItemView\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** add the DCE class to the list item */\n    className   : ListItemView.prototype.className + \" dataset-collection-element\",\n\n    /** set up */\n    initialize  : function( attributes ){\n        if( attributes.logger ){ this.logger = this.model.logger = attributes.logger; }\n        this.log( 'DCEListItemView.initialize:', attributes );\n        ListItemView.prototype.initialize.call( this, attributes );\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'DCEListItemView(' + modelString + ')';\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDCEListItemView.prototype.templates = (function(){\n\n    // use the element identifier here - since that will persist and the user will need it\n    var titleBarTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"title-bar clear\" tabindex=\"0\">',\n            '<div class=\"title\">',\n                '<span class=\"name\"><%- element.element_identifier %></span>',\n            '</div>',\n            '<div class=\"subtitle\"></div>',\n        '</div>'\n    ], 'element' );\n\n    return _.extend( {}, ListItemView.prototype.templates, {\n        titleBar : titleBarTemplate\n    });\n}());\n\n\n//==============================================================================\n/** @class Read only view for a DatasetCollectionElement that is also an DatasetAssociation\n *      (a dataset contained in a dataset collection).\n */\nvar DatasetDCEListItemView = DATASET_LI.DatasetListItemView.extend(\n/** @lends DatasetDCEListItemView.prototype */{\n\n    className   : DATASET_LI.DatasetListItemView.prototype.className + \" dataset-collection-element\",\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** set up */\n    initialize  : function( attributes ){\n        if( attributes.logger ){ this.logger = this.model.logger = attributes.logger; }\n        this.log( 'DatasetDCEListItemView.initialize:', attributes );\n        DATASET_LI.DatasetListItemView.prototype.initialize.call( this, attributes );\n    },\n\n    /** In this override, only get details if in the ready state.\n     *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n     */\n    _fetchModelDetails : function(){\n        var view = this;\n        if( view.model.inReadyState() && !view.model.hasDetails() ){\n            return view.model.fetch({ silent: true });\n        }\n        return jQuery.when();\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'DatasetDCEListItemView(' + modelString + ')';\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDatasetDCEListItemView.prototype.templates = (function(){\n\n    // use the element identifier here and not the dataset name\n    //TODO:?? can we steal the DCE titlebar?\n    var titleBarTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"title-bar clear\" tabindex=\"0\">',\n            '<span class=\"state-icon\"></span>',\n            '<div class=\"title\">',\n                '<span class=\"name\"><%- element.element_identifier %></span>',\n            '</div>',\n        '</div>'\n    ], 'element' );\n\n    return _.extend( {}, DATASET_LI.DatasetListItemView.prototype.templates, {\n        titleBar : titleBarTemplate\n    });\n}());\n\n\n//==============================================================================\n/** @class Read only view for a DatasetCollectionElement that is also a DatasetCollection\n *      (a nested DC).\n */\nvar NestedDCDCEListItemView = DCListItemView.extend(\n/** @lends NestedDCDCEListItemView.prototype */{\n\n    className   : DCListItemView.prototype.className + \" dataset-collection-element\",\n\n    /** logger used to record this.log messages, commonly set to console */\n    // comment this out to suppress log output\n    //logger              : console,\n\n    /** In this override, add the state as a class for use with state-based CSS */\n    _swapNewRender : function( $newRender ){\n        DCListItemView.prototype._swapNewRender.call( this, $newRender );\n//TODO: model currently has no state\n        var state = this.model.get( 'state' ) || 'ok';\n        //if( this.model.has( 'state' ) ){\n        this.$el.addClass( 'state-' + state );\n        //}\n        return this.$el;\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'NestedDCDCEListItemView(' + modelString + ')';\n    }\n});\n\n\n//==============================================================================\n    return {\n        DCListItemView          : DCListItemView,\n        DCEListItemView         : DCEListItemView,\n        DatasetDCEListItemView  : DatasetDCEListItemView,\n        NestedDCDCEListItemView : NestedDCDCEListItemView\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/collection/collection-li.js\n **/","define([\n    \"mvc/dataset/dataset-model\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( DATASET_MODEL, BASE_MVC, _l ){\n\n'use strict';\n\nvar logNamespace = 'collections';\n//==============================================================================\n/*\nNotes:\n\nTerminology:\n    DatasetCollection/DC : a container of datasets or nested DatasetCollections\n    Element/DatasetCollectionElement/DCE : an item contained in a DatasetCollection\n    HistoryDatasetCollectionAssociation/HDCA: a DatasetCollection contained in a history\n\n\nThis all seems too complex unfortunately:\n\n- Terminology collision between DatasetCollections (DCs) and Backbone Collections.\n- In the DatasetCollections API JSON, DC Elements use a 'Has A' stucture to *contain*\n    either a dataset or a nested DC. This would make the hierarchy much taller. I've\n    decided to merge the contained JSON with the DC element json - making the 'has a'\n    relation into an 'is a' relation. This seems simpler to me and allowed a lot of\n    DRY in both models and views, but may make tracking or tracing within these models\n    more difficult (since DatasetCollectionElements are now *also* DatasetAssociations\n    or DatasetCollections (nested)). This also violates the rule of thumb about\n    favoring aggregation over inheritance.\n- Currently, there are three DatasetCollection subclasses: List, Pair, and ListPaired.\n    These each should a) be usable on their own, b) be usable in the context of\n    nesting within a collection model (at least in the case of ListPaired), and\n    c) be usable within the context of other container models (like History or\n    LibraryFolder, etc.). I've tried to separate/extract classes in order to\n    handle those three situations, but it's proven difficult to do in a simple,\n    readable manner.\n- Ideally, histories and libraries would inherit from the same server models as\n    dataset collections do since they are (in essence) dataset collections themselves -\n    making the whole nested structure simpler. This would be a large, error-prone\n    refactoring and migration.\n\nMany of the classes and heirarchy are meant as extension points so, while the\nrelations and flow may be difficult to understand initially, they'll allow us to\nhandle the growth or flux dataset collection in the future (w/o actually implementing\nany YAGNI).\n\n*/\n//_________________________________________________________________________________________________ ELEMENTS\n/** @class mixin for Dataset collection elements.\n *      When collection elements are passed from the API, the underlying element is\n *          in a sub-object 'object' (IOW, a DCE representing an HDA will have HDA json in element.object).\n *      This mixin uses the constructor and parse methods to merge that JSON with the DCE attribtues\n *          effectively changing a DCE from a container to a subclass (has a --> is a).\n */\nvar DatasetCollectionElementMixin = {\n\n    /** default attributes used by elements in a dataset collection */\n    defaults : {\n        model_class         : 'DatasetCollectionElement',\n        element_identifier  : null,\n        element_index       : null,\n        element_type        : null\n    },\n\n    /** merge the attributes of the sub-object 'object' into this model */\n    _mergeObject : function( attributes ){\n        // if we don't preserve and correct ids here, the element id becomes the object id\n        // and collision in backbone's _byId will occur and only\n        _.extend( attributes, attributes.object, { element_id: attributes.id });\n        delete attributes.object;\n        return attributes;\n    },\n\n    /** override to merge this.object into this */\n    constructor : function( attributes, options ){\n        // console.debug( '\\t DatasetCollectionElement.constructor:', attributes, options );\n        attributes = this._mergeObject( attributes );\n        this.idAttribute = 'element_id';\n        Backbone.Model.apply( this, arguments );\n    },\n\n    /** when the model is fetched, merge this.object into this */\n    parse : function( response, options ){\n        var attributes = response;\n        attributes = this._mergeObject( attributes );\n        return attributes;\n    }\n};\n\n//TODO: unused?\n/** @class Concrete class of Generic DatasetCollectionElement */\nvar DatasetCollectionElement = Backbone.Model\n    .extend( BASE_MVC.LoggableMixin )\n    .extend( DatasetCollectionElementMixin )\n    .extend({ _logNamespace : logNamespace });\n\n\n//==============================================================================\n/** @class Base/Abstract Backbone collection for Generic DCEs. */\nvar DCECollection = Backbone.Collection.extend( BASE_MVC.LoggableMixin ).extend(\n/** @lends DCECollection.prototype */{\n    _logNamespace : logNamespace,\n\n    model: DatasetCollectionElement,\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n//TODO: unused?\n    /** Set up.\n     *  @see Backbone.Collection#initialize\n     */\n    initialize : function( attributes, options ){\n        this.debug( this + '(DCECollection).initialize:', attributes, options );\n        options = options || {};\n        //this._setUpListeners();\n    },\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'DatasetCollectionElementCollection(', this.length, ')' ].join( '' ));\n    }\n});\n\n\n//==============================================================================\n/** @class Backbone model for a dataset collection element that is a dataset (HDA).\n */\nvar DatasetDCE = DATASET_MODEL.DatasetAssociation.extend( BASE_MVC.mixin( DatasetCollectionElementMixin,\n/** @lends DatasetDCE.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** url fn */\n    url : function(){\n        // won't always be an hda\n        if( !this.has( 'history_id' ) ){\n            console.warn( 'no endpoint for non-hdas within a collection yet' );\n            // (a little silly since this api endpoint *also* points at hdas)\n            return Galaxy.root + 'api/datasets';\n        }\n        return Galaxy.root + 'api/histories/' + this.get( 'history_id' ) + '/contents/' + this.get( 'id' );\n    },\n\n    defaults : _.extend( {},\n        DATASET_MODEL.DatasetAssociation.prototype.defaults,\n        DatasetCollectionElementMixin.defaults\n    ),\n\n    // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n    //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n    //  - re-apply manually for now\n    /** call the mixin constructor */\n    constructor : function( attributes, options ){\n        this.debug( '\\t DatasetDCE.constructor:', attributes, options );\n        //DATASET_MODEL.DatasetAssociation.prototype.constructor.call( this, attributes, options );\n        DatasetCollectionElementMixin.constructor.call( this, attributes, options );\n    },\n\n//TODO: unused?\n    /** set up */\n    initialize : function( attributes, options ){\n        this.debug( this + '(DatasetDCE).initialize:', attributes, options );\n        DATASET_MODEL.DatasetAssociation.prototype.initialize.call( this, attributes, options );\n    },\n\n    /** Does this model already contain detailed data (as opposed to just summary level data)? */\n    hasDetails : function(){\n        // dataset collection api does return genome_build but doesn't return annotation\n        return _.has( this.attributes, 'annotation' );\n    },\n\n    /** String representation. */\n    toString : function(){\n        var objStr = this.get( 'element_identifier' );\n        return ([ 'DatasetDCE(', objStr, ')' ].join( '' ));\n    }\n}));\n\n\n//==============================================================================\n/** @class DCECollection of DatasetDCE's (a list of datasets, a pair of datasets).\n */\nvar DatasetDCECollection = DCECollection.extend(\n/** @lends DatasetDCECollection.prototype */{\n    model: DatasetDCE,\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n//TODO: unused?\n    /** set up */\n    initialize : function( attributes, options ){\n        this.debug( this + '(DatasetDCECollection).initialize:', attributes, options );\n        DCECollection.prototype.initialize.call( this, attributes, options );\n    },\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'DatasetDCECollection(', this.length, ')' ].join( '' ));\n    }\n});\n\n\n//_________________________________________________________________________________________________ COLLECTIONS\n/** @class Backbone model for Dataset Collections.\n *      The DC API returns an array of JSON objects under the attribute elements.\n *      This model:\n *          - removes that array/attribute ('elements') from the model,\n *          - creates a bbone collection (of the class defined in the 'collectionClass' attribute),\n *          - passes that json onto the bbone collection\n *          - caches the bbone collection in this.elements\n */\nvar DatasetCollection = Backbone.Model\n        .extend( BASE_MVC.LoggableMixin )\n        .extend( BASE_MVC.SearchableModelMixin )\n        .extend(/** @lends DatasetCollection.prototype */{\n    _logNamespace : logNamespace,\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** default attributes for a model */\n    defaults : {\n        /* 'list', 'paired', or 'list:paired' */\n        collection_type     : null,\n        //??\n        deleted             : false\n    },\n\n    /** Which class to use for elements */\n    collectionClass : DCECollection,\n\n    /** set up: create elements instance var and (on changes to elements) update them  */\n    initialize : function( model, options ){\n        this.debug( this + '(DatasetCollection).initialize:', model, options, this );\n        //historyContent.HistoryContent.prototype.initialize.call( this, attrs, options );\n        this.elements = this._createElementsModel();\n        this.on( 'change:elements', function(){\n            this.log( 'change:elements' );\n//TODO: prob. better to update the collection instead of re-creating it\n            this.elements = this._createElementsModel();\n        });\n    },\n\n    /** move elements model attribute to full collection */\n    _createElementsModel : function(){\n        this.debug( this + '._createElementsModel', this.collectionClass, this.get( 'elements' ), this.elements );\n//TODO: same patterns as DatasetCollectionElement _createObjectModel - refactor to BASE_MVC.hasSubModel?\n        var elements = this.get( 'elements' ) || [];\n        this.unset( 'elements', { silent: true });\n        this.elements = new this.collectionClass( elements );\n        //this.debug( 'collectionClass:', this.collectionClass + '', this.elements );\n        return this.elements;\n    },\n\n    // ........................................................................ common queries\n    /** pass the elements back within the model json when this is serialized */\n    toJSON : function(){\n        var json = Backbone.Model.prototype.toJSON.call( this );\n        if( this.elements ){\n            json.elements = this.elements.toJSON();\n        }\n        return json;\n    },\n\n    /** Is this collection in a 'ready' state no processing (for the collection) is left\n     *  to do on the server.\n     */\n    inReadyState : function(){\n        var populated = this.get( 'populated' );\n        return ( this.isDeletedOrPurged() || populated );\n    },\n\n    //TODO:?? the following are the same interface as DatasetAssociation - can we combine?\n    /** Does the DC contain any elements yet? Is a fetch() required? */\n    hasDetails : function(){\n//TODO: this is incorrect for (accidentally) empty collections\n        this.debug( 'hasDetails:', this.elements.length );\n        return this.elements.length !== 0;\n    },\n\n    /** Given the filters, what models in this.elements would be returned? */\n    getVisibleContents : function( filters ){\n        // filters unused for now\n        return this.elements;\n    },\n\n    // ........................................................................ ajax\n    /** save this dataset, _Mark_ing it as deleted (just a flag) */\n    'delete' : function( options ){\n        if( this.get( 'deleted' ) ){ return jQuery.when(); }\n        return this.save( { deleted: true }, options );\n    },\n    /** save this dataset, _Mark_ing it as undeleted */\n    undelete : function( options ){\n        if( !this.get( 'deleted' ) || this.get( 'purged' ) ){ return jQuery.when(); }\n        return this.save( { deleted: false }, options );\n    },\n\n    /** Is this collection deleted or purged? */\n    isDeletedOrPurged : function(){\n        return ( this.get( 'deleted' ) || this.get( 'purged' ) );\n    },\n\n    // ........................................................................ searchable\n    /** searchable attributes for collections */\n    searchAttributes : [\n        'name'\n    ],\n\n    // ........................................................................ misc\n    /** String representation */\n    toString : function(){\n        var idAndName = [ this.get( 'id' ), this.get( 'name' ) || this.get( 'element_identifier' ) ];\n        return 'DatasetCollection(' + ( idAndName.join(',') ) + ')';\n    }\n});\n\n\n//==============================================================================\n/** Model for a DatasetCollection containing datasets (non-nested).\n */\nvar ListDatasetCollection = DatasetCollection.extend(\n/** @lends ListDatasetCollection.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** override since we know the collection will only contain datasets */\n    collectionClass : DatasetDCECollection,\n\n//TODO: unused?\n    initialize : function( attrs, options ){\n        this.debug( this + '(ListDatasetCollection).initialize:', attrs, options );\n        DatasetCollection.prototype.initialize.call( this, attrs, options );\n    },\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'ListDatasetCollection(', this.get( 'name' ), ')' ].join( '' ));\n    }\n});\n\n\n//==============================================================================\n/** Model for a DatasetCollection containing fwd/rev datasets (a list of 2).\n */\nvar PairDatasetCollection = ListDatasetCollection.extend(\n/** @lends PairDatasetCollection.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n//TODO: unused?\n    /**  */\n    initialize : function( attrs, options ){\n        this.debug( this + '(PairDatasetCollection).initialize:', attrs, options );\n        ListDatasetCollection.prototype.initialize.call( this, attrs, options );\n    },\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'PairDatasetCollection(', this.get( 'name' ), ')' ].join( '' ));\n    }\n});\n\n\n//_________________________________________________________________________________________________ NESTED COLLECTIONS\n// this is where things get weird, man. Weird.\n//TODO: it might be possible to compact all the following...I think.\n//==============================================================================\n/** @class Backbone model for a Generic DatasetCollectionElement that is also a DatasetCollection\n *      (a nested collection). Currently only list:paired.\n */\nvar NestedDCDCE = DatasetCollection.extend( BASE_MVC.mixin( DatasetCollectionElementMixin,\n/** @lends NestedDCDCE.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n    //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n    //  - re-apply manually it now\n    /** call the mixin constructor */\n    constructor : function( attributes, options ){\n        this.debug( '\\t NestedDCDCE.constructor:', attributes, options );\n        DatasetCollectionElementMixin.constructor.call( this, attributes, options );\n    },\n\n    /** String representation. */\n    toString : function(){\n        var objStr = ( this.object )?( '' + this.object ):( this.get( 'element_identifier' ) );\n        return ([ 'NestedDCDCE(', objStr, ')' ].join( '' ));\n    }\n}));\n\n\n//==============================================================================\n/** @class Backbone collection containing Generic NestedDCDCE's (nested dataset collections).\n */\nvar NestedDCDCECollection = DCECollection.extend(\n/** @lends NestedDCDCECollection.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** This is a collection of nested collections */\n    model: NestedDCDCE,\n\n//TODO: unused?\n    /** set up */\n    initialize : function( attrs, options ){\n        this.debug( this + '(NestedDCDCECollection).initialize:', attrs, options );\n        DCECollection.prototype.initialize.call( this, attrs, options );\n    },\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'NestedDCDCECollection(', this.length, ')' ].join( '' ));\n    }\n});\n\n\n//==============================================================================\n/** @class Backbone model for a paired dataset collection within a list:paired dataset collection.\n */\nvar NestedPairDCDCE = PairDatasetCollection.extend( BASE_MVC.mixin( DatasetCollectionElementMixin,\n/** @lends NestedPairDCDCE.prototype */{\n//TODO:?? possibly rename to NestedDatasetCollection?\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n    //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n    //  - re-apply manually it now\n    /** This is both a collection and a collection element - call the constructor */\n    constructor : function( attributes, options ){\n        this.debug( '\\t NestedPairDCDCE.constructor:', attributes, options );\n        //DatasetCollection.constructor.call( this, attributes, options );\n        DatasetCollectionElementMixin.constructor.call( this, attributes, options );\n    },\n\n    /** String representation. */\n    toString : function(){\n        var objStr = ( this.object )?( '' + this.object ):( this.get( 'element_identifier' ) );\n        return ([ 'NestedPairDCDCE(', objStr, ')' ].join( '' ));\n    }\n}));\n\n\n//==============================================================================\n/** @class Backbone collection for a backbone collection containing paired dataset collections.\n */\nvar NestedPairDCDCECollection = NestedDCDCECollection.extend(\n/** @lends PairDCDCECollection.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** We know this collection is composed of only nested pair collections */\n    model: NestedPairDCDCE,\n\n//TODO: unused?\n    /** set up */\n    initialize : function( attrs, options ){\n        this.debug( this + '(NestedPairDCDCECollection).initialize:', attrs, options );\n        NestedDCDCECollection.prototype.initialize.call( this, attrs, options );\n    },\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'NestedPairDCDCECollection(', this.length, ')' ].join( '' ));\n    }\n});\n\n\n//==============================================================================\n/** @class Backbone Model for a DatasetCollection (list) that contains DatasetCollections (pairs).\n */\nvar ListPairedDatasetCollection = DatasetCollection.extend(\n/** @lends ListPairedDatasetCollection.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** list:paired is the only collection that itself contains collections */\n    collectionClass : NestedPairDCDCECollection,\n\n//TODO: unused?\n    /** set up */\n    initialize : function( attributes, options ){\n        this.debug( this + '(ListPairedDatasetCollection).initialize:', attributes, options );\n        DatasetCollection.prototype.initialize.call( this, attributes, options );\n    },\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'ListPairedDatasetCollection(', this.get( 'name' ), ')' ].join( '' ));\n    }\n});\n\n\n//==============================================================================\n    return {\n        ListDatasetCollection               : ListDatasetCollection,\n        PairDatasetCollection               : PairDatasetCollection,\n        ListPairedDatasetCollection         : ListPairedDatasetCollection\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/collection/collection-model.js\n **/","\ndefine([\n    \"mvc/history/hdca-model\",\n    \"mvc/dataset/states\",\n    \"mvc/base-mvc\",\n    \"mvc/ui/ui-modal\",\n    \"utils/natural-sort\",\n    \"utils/localization\",\n    \"ui/hoverhighlight\"\n], function( HDCA, STATES, BASE_MVC, UI_MODAL, naturalSort, _l ){\n\n'use strict';\n\nvar logNamespace = 'collections';\n/*==============================================================================\nTODO:\n    use proper Element model and not just json\n    straighten out createFn, collection.createHDCA\n    possibly stop using modals for this\n    It would be neat to do a drag and drop\n\n==============================================================================*/\n/** A view for both DatasetDCEs and NestedDCDCEs\n *  (things that implement collection-model:DatasetCollectionElementMixin)\n */\nvar DatasetCollectionElementView = Backbone.View.extend( BASE_MVC.LoggableMixin ).extend({\n    _logNamespace : logNamespace,\n\n//TODO: use proper class (DatasetDCE or NestedDCDCE (or the union of both))\n    tagName     : 'li',\n    className   : 'collection-element',\n\n    initialize : function( attributes ){\n        this.element = attributes.element || {};\n        this.selected = attributes.selected || false;\n    },\n\n    render : function(){\n        this.$el\n            .attr( 'data-element-id', this.element.id )\n            .attr( 'draggable', true )\n            .html( this.template({ element: this.element }) );\n        if( this.selected ){\n            this.$el.addClass( 'selected' );\n        }\n        return this;\n    },\n\n    //TODO: lots of unused space in the element - possibly load details and display them horiz.\n    template : _.template([\n        '<a class=\"name\" title=\"', _l( 'Click to rename' ), '\" href=\"javascript:void(0)\">',\n            '<%- element.name %>',\n        '</a>',\n        '<button class=\"discard btn btn-sm\" title=\"', _l( 'Remove this dataset from the list' ), '\">',\n            _l( 'Discard' ),\n        '</button>',\n    ].join('')),\n\n    /** select this element and pub */\n    select : function( toggle ){\n        this.$el.toggleClass( 'selected', toggle );\n        this.trigger( 'select', {\n            source   : this,\n            selected : this.$el.hasClass( 'selected' )\n        });\n    },\n\n    /** animate the removal of this element and pub */\n    discard : function(){\n        var view = this,\n            parentWidth = this.$el.parent().width();\n        this.$el.animate({ 'margin-right' : parentWidth }, 'fast', function(){\n            view.trigger( 'discard', {\n                source : view\n            });\n            view.destroy();\n        });\n    },\n\n    /** remove the DOM and any listeners */\n    destroy : function(){\n        this.off();\n        this.$el.remove();\n    },\n\n    events : {\n        'click'         : '_click',\n        'click .name'   : '_clickName',\n        'click .discard': '_clickDiscard',\n\n        'dragstart'     : '_dragstart',\n        'dragend'       : '_dragend',\n        'dragover'      : '_sendToParent',\n        'drop'          : '_sendToParent'\n    },\n\n    /** select when the li is clicked */\n    _click : function( ev ){\n        ev.stopPropagation();\n        this.select( ev );\n    },\n\n    /** rename a pair when the name is clicked */\n    _clickName : function( ev ){\n        ev.stopPropagation();\n        ev.preventDefault();\n        var promptString = [ _l( 'Enter a new name for the element' ), ':\\n(',\n                             _l( 'Note that changing the name here will not rename the dataset' ), ')' ].join( '' ),\n            response = prompt( _l( 'Enter a new name for the element' ) + ':', this.element.name );\n        if( response ){\n            this.element.name = response;\n            this.render();\n        }\n        //TODO: cancelling with ESC leads to closure of the creator...\n    },\n\n    /** discard when the discard button is clicked */\n    _clickDiscard : function( ev ){\n        ev.stopPropagation();\n        this.discard();\n    },\n\n    /** dragging pairs for re-ordering */\n    _dragstart : function( ev ){\n        if( ev.originalEvent ){ ev = ev.originalEvent; }\n        ev.dataTransfer.effectAllowed = 'move';\n        ev.dataTransfer.setData( 'text/plain', JSON.stringify( this.element ) );\n\n        this.$el.addClass( 'dragging' );\n        this.$el.parent().trigger( 'collection-element.dragstart', [ this ] );\n    },\n\n    /** dragging for re-ordering */\n    _dragend : function( ev ){\n        this.$el.removeClass( 'dragging' );\n        this.$el.parent().trigger( 'collection-element.dragend', [ this ] );\n    },\n\n    /** manually bubble up an event to the parent/container */\n    _sendToParent : function( ev ){\n        this.$el.parent().trigger( ev );\n    },\n\n    /** string rep */\n    toString : function(){\n        return 'DatasetCollectionElementView()';\n    }\n});\n\n\n// ============================================================================\n/** An interface for building collections.\n */\nvar ListCollectionCreator = Backbone.View.extend( BASE_MVC.LoggableMixin ).extend({\n    _logNamespace : logNamespace,\n\n    /** the class used to display individual elements */\n    elementViewClass : DatasetCollectionElementView,\n    /** the class this creator will create and save */\n    collectionClass  : HDCA.HistoryListDatasetCollection,\n    className        : 'list-collection-creator collection-creator flex-row-container',\n\n    /** minimum number of valid elements to start with in order to build a collection of this type */\n    minElements      : 1,\n\n    defaultAttributes : {\n//TODO: remove - use new collectionClass().save()\n        /** takes elements and creates the proper collection - returns a promise */\n        creationFn : function(){ throw new TypeError( 'no creation fn for creator' ); },\n        /** fn to call when the collection is created (scoped to this) */\n        oncreate   : function(){},\n        /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n        oncancel   : function(){},\n        /** distance from list edge to begin autoscrolling list */\n        autoscrollDist  : 24,\n        /** Color passed to hoverhighlight */\n        highlightClr    : 'rgba( 64, 255, 255, 1.0 )'\n    },\n\n    /** set up initial options, instance vars, behaviors */\n    initialize : function( attributes ){\n        this.metric( 'ListCollectionCreator.initialize', attributes );\n        var creator = this;\n        _.each( this.defaultAttributes, function( value, key ){\n            value = attributes[ key ] || value;\n            creator[ key ] = value;\n        });\n\n        /** unordered, original list - cache to allow reversal */\n        creator.initialElements = attributes.elements || [];\n\n        this._instanceSetUp();\n        this._elementsSetUp();\n        this._setUpBehaviors();\n    },\n\n    /** set up instance vars */\n    _instanceSetUp : function(){\n        /** Ids of elements that have been selected by the user - to preserve over renders */\n        this.selectedIds = {};\n        /** DOM elements currently being dragged */\n        this.$dragging = null;\n        /** Used for blocking UI events during ajax/operations (don't post twice) */\n        this.blocking = false;\n    },\n\n    // ------------------------------------------------------------------------ process raw list\n    /** set up main data */\n    _elementsSetUp : function(){\n        //this.debug( '-- _dataSetUp' );\n        /** a list of invalid elements and the reasons they aren't valid */\n        this.invalidElements = [];\n//TODO: handle fundamental problem of syncing DOM, views, and list here\n        /** data for list in progress */\n        this.workingElements = [];\n        /** views for workingElements */\n        this.elementViews = [];\n\n        // copy initial list, sort, add ids if needed\n        this.workingElements = this.initialElements.slice( 0 );\n        this._ensureElementIds();\n        this._validateElements();\n        this._mangleDuplicateNames();\n        this._sortElements();\n    },\n\n    /** add ids to dataset objs in initial list if none */\n    _ensureElementIds : function(){\n        this.workingElements.forEach( function( element ){\n            if( !element.hasOwnProperty( 'id' ) ){\n                element.id = _.uniqueId();\n            }\n        });\n        return this.workingElements;\n    },\n\n    /** separate working list into valid and invalid elements for this collection */\n    _validateElements : function(){\n        var creator = this,\n            existingNames = {};\n        creator.invalidElements = [];\n\n        this.workingElements = this.workingElements.filter( function( element ){\n            var problem = creator._isElementInvalid( element );\n            if( problem ){\n                creator.invalidElements.push({\n                    element : element,\n                    text    : problem\n                });\n            }\n            return !problem;\n        });\n        return this.workingElements;\n    },\n\n    /** describe what is wrong with a particular element if anything */\n    _isElementInvalid : function( element ){\n        if( element.history_content_type !== 'dataset' ){\n            return _l( \"is not a dataset\" );\n        }\n        if( element.state !== STATES.OK ){\n            if( _.contains( STATES.NOT_READY_STATES, element.state ) ){\n                return _l( \"hasn't finished running yet\" );\n            }\n            return _l( \"has errored, is paused, or is not accessible\" );\n        }\n        if( element.deleted || element.purged ){\n            return _l( \"has been deleted or purged\" );\n        }\n        return null;\n    },\n\n    /** mangle duplicate names using a mac-like '(counter)' addition to any duplicates */\n    _mangleDuplicateNames : function(){\n        var SAFETY = 900,\n            counter = 1,\n            existingNames = {};\n        this.workingElements.forEach( function( element ){\n            var currName = element.name;\n            while( existingNames.hasOwnProperty( currName ) ){\n                currName = element.name + ' (' + counter + ')';\n                counter += 1;\n                if( counter >= SAFETY ){\n                    throw new Error( 'Safety hit in while loop - thats impressive' );\n                }\n            }\n            element.name = currName;\n            existingNames[ element.name ] = true;\n        });\n    },\n\n    /** sort a list of elements */\n    _sortElements : function( list ){\n        // // currently only natural sort by name\n        // this.workingElements.sort( function( a, b ){ return naturalSort( a.name, b.name ); });\n        // return this.workingElements;\n    },\n\n    // ------------------------------------------------------------------------ rendering\n    // templates : ListCollectionCreator.templates,\n    /** render the entire interface */\n    render : function( speed, callback ){\n        //this.debug( '-- _render' );\n        if( this.workingElements.length < this.minElements ){\n            return this._renderInvalid( speed, callback );\n        }\n\n        this.$el.empty().html( this.templates.main() );\n        this._renderHeader( speed );\n        this._renderMiddle( speed );\n        this._renderFooter( speed );\n        this._addPluginComponents();\n        this.$( '.collection-name' ).focus();\n        this.trigger( 'rendered', this );\n        return this;\n    },\n\n\n    /** render a simplified interface aimed at telling the user why they can't move forward */\n    _renderInvalid : function( speed, callback ){\n        //this.debug( '-- _render' );\n        this.$el.empty().html( this.templates.invalidInitial({\n            problems: this.invalidElements,\n            elements: this.workingElements,\n        }));\n        if( typeof this.oncancel === 'function' ){\n            this.$( '.cancel-create.btn' ).show();\n        }\n        this.trigger( 'rendered', this );\n        return this;\n    },\n\n    /** render the header section */\n    _renderHeader : function( speed, callback ){\n        var $header = this.$( '.header' ).empty().html( this.templates.header() )\n            .find( '.help-content' ).prepend( $( this.templates.helpContent() ) );\n        //TODO: should only show once despite calling _renderHeader again\n        if( this.invalidElements.length ){\n            this._invalidElementsAlert();\n        }\n        return $header;\n    },\n\n    /** render the middle including the elements */\n    _renderMiddle : function( speed, callback ){\n        var $middle = this.$( '.middle' ).empty().html( this.templates.middle() );\n        this._renderList( speed );\n        return $middle;\n    },\n\n    /** render the footer, completion controls, and cancel controls */\n    _renderFooter : function( speed, callback ){\n        var $footer = this.$( '.footer' ).empty().html( this.templates.footer() );\n        if( typeof this.oncancel === 'function' ){\n            this.$( '.cancel-create.btn' ).show();\n        }\n        return $footer;\n    },\n\n    /** add any jQuery/bootstrap/custom plugins to elements rendered */\n    _addPluginComponents : function(){\n        this.$( '.help-content i' ).hoverhighlight( '.collection-creator', this.highlightClr );\n    },\n\n    /** build and show an alert describing any elements that could not be included due to problems */\n    _invalidElementsAlert : function(){\n        this._showAlert( this.templates.invalidElements({ problems: this.invalidElements }), 'alert-warning' );\n    },\n\n    /** add (or clear if clear is truthy) a validation warning to the DOM element described in what */\n    _validationWarning : function( what, clear ){\n        var VALIDATION_CLASS = 'validation-warning';\n        if( what === 'name' ){\n            what = this.$( '.collection-name' ).add( this.$( '.collection-name-prompt' ) );\n            this.$( '.collection-name' ).focus().select();\n        }\n        if( clear ){\n            what = what || this.$( '.' + VALIDATION_CLASS );\n            what.removeClass( VALIDATION_CLASS );\n        } else {\n            what.addClass( VALIDATION_CLASS );\n        }\n    },\n\n    _disableNameAndCreate : function( disable ){\n        disable = !_.isUndefined( disable )? disable : true;\n        if( disable ){\n            this.$( '.collection-name' ).prop( 'disabled', true );\n            this.$( '.create-collection' ).toggleClass( 'disabled', true );\n        // } else {\n        //     this.$( '.collection-name' ).prop( 'disabled', false );\n        //     this.$( '.create-collection' ).removeClass( 'disable' );\n        }\n    },\n\n    // ------------------------------------------------------------------------ rendering elements\n    /** conv. to the main list display DOM */\n    $list : function(){\n        return this.$( '.collection-elements' );\n    },\n\n    /** show or hide the clear selected control based on the num of selected elements */\n    _renderClearSelected : function(){\n        if( _.size( this.selectedIds ) ){\n            this.$( '.collection-elements-controls > .clear-selected' ).show();\n        } else {\n            this.$( '.collection-elements-controls > .clear-selected' ).hide();\n        }\n    },\n\n    /** render the elements in order (or a warning if no elements found) */\n    _renderList : function( speed, callback ){\n        //this.debug( '-- _renderList' );\n        var creator = this,\n            $tmp = jQuery( '<div/>' ),\n            $list = creator.$list();\n\n        _.each( this.elementViews, function( view ){\n            view.destroy();\n            creator.removeElementView( view );\n        });\n\n        // if( !this.workingElements.length ){\n        //     this._renderNoValidElements();\n        //     return;\n        // }\n\n        creator.workingElements.forEach( function( element ){\n            var elementView = creator._createElementView( element );\n            $tmp.append( elementView.$el );\n        });\n\n        creator._renderClearSelected();\n        $list.empty().append( $tmp.children() );\n        _.invoke( creator.elementViews, 'render' );\n\n        if( $list.height() > $list.css( 'max-height' ) ){\n            $list.css( 'border-width', '1px 0px 1px 0px' );\n        } else {\n            $list.css( 'border-width', '0px' );\n        }\n    },\n\n    /** create an element view, cache in elementViews, set up listeners, and return */\n    _createElementView : function( element ){\n        var elementView = new this.elementViewClass({\n//TODO: use non-generic class or not all\n            // model : COLLECTION.DatasetDCE( element )\n            element : element,\n            selected: _.has( this.selectedIds, element.id )\n        });\n        this.elementViews.push( elementView );\n        this._listenToElementView( elementView );\n        return elementView;\n    },\n\n    /** listen to any element events */\n    _listenToElementView : function( view ){\n        var creator = this;\n        creator.listenTo( view, {\n            select : function( data ){\n                var element = data.source.element;\n                if( data.selected ){\n                    creator.selectedIds[ element.id ] = true;\n                } else {\n                    delete creator.selectedIds[ element.id ];\n                }\n                creator.trigger( 'elements:select', data );\n            },\n            discard : function( data ){\n                creator.trigger( 'elements:discard', data );\n            }\n        });\n    },\n\n    /** add a new element view based on the json in element */\n    addElementView : function( element ){\n//TODO: workingElements is sorted, add element in appropo index\n        // add element, sort elements, find element index\n        // var view = this._createElementView( element );\n        // return view;\n    },\n\n    /** stop listening to view and remove from caches */\n    removeElementView : function( view ){\n        delete this.selectedIds[ view.element.id ];\n        this._renderClearSelected();\n\n        this.elementViews = _.without( this.elementViews, view );\n        this.stopListening( view );\n    },\n\n    /** render a message in the list that no elements remain to create a collection */\n    _renderNoElementsLeft : function(){\n        this._disableNameAndCreate( true );\n        this.$( '.collection-elements' ).append( this.templates.noElementsLeft() );\n    },\n\n    // /** render a message in the list that no valid elements were found to create a collection */\n    // _renderNoValidElements : function(){\n    //     this._disableNameAndCreate( true );\n    //     this.$( '.collection-elements' ).append( this.templates.noValidElements() );\n    // },\n\n    // ------------------------------------------------------------------------ API\n    /** convert element into JSON compatible with the collections API */\n    _elementToJSON : function( element ){\n        // return element.toJSON();\n        return element;\n    },\n\n    /** create the collection via the API\n     *  @returns {jQuery.xhr Object} the jquery ajax request\n     */\n    createList : function( name ){\n        if( !this.workingElements.length ){\n            var message = _l( 'No valid elements for final list' ) + '. ';\n            message += '<a class=\"cancel-create\" href=\"javascript:void(0);\">' + _l( 'Cancel' ) + '</a> ';\n            message += _l( 'or' );\n            message += ' <a class=\"reset\" href=\"javascript:void(0);\">' + _l( 'start over' ) + '</a>.';\n            this._showAlert( message );\n            return;\n        }\n\n        var creator = this,\n            elements = this.workingElements.map( function( element ){\n                return creator._elementToJSON( element );\n            });\n\n        creator.blocking = true;\n        return creator.creationFn( elements, name )\n            .always( function(){\n                creator.blocking = false;\n            })\n            .fail( function( xhr, status, message ){\n                creator.trigger( 'error', {\n                    xhr     : xhr,\n                    status  : status,\n                    message : _l( 'An error occurred while creating this collection' )\n                });\n            })\n            .done( function( response, message, xhr ){\n                creator.trigger( 'collection:created', response, message, xhr );\n                creator.metric( 'collection:created', response );\n                if( typeof creator.oncreate === 'function' ){\n                    creator.oncreate.call( this, response, message, xhr );\n                }\n            });\n    },\n\n    // ------------------------------------------------------------------------ events\n    /** set up event handlers on self */\n    _setUpBehaviors : function(){\n        this.on( 'error', this._errorHandler );\n\n        this.once( 'rendered', function(){\n            this.trigger( 'rendered:initial', this );\n        });\n\n        this.on( 'elements:select', function( data ){\n            this._renderClearSelected();\n        });\n\n        this.on( 'elements:discard', function( data ){\n            var element = data.source.element;\n            this.removeElementView( data.source );\n\n            this.workingElements = _.without( this.workingElements, element );\n            if( !this.workingElements.length ){\n                this._renderNoElementsLeft();\n            }\n        });\n\n        //this.on( 'all', function(){\n        //    this.info( arguments );\n        //});\n        return this;\n    },\n\n    /** handle errors with feedback and details to the user (if available) */\n    _errorHandler : function( data ){\n        this.error( data );\n\n        var creator = this;\n            content = data.message || _l( 'An error occurred' );\n        if( data.xhr ){\n            var xhr = data.xhr,\n                message = data.message;\n            if( xhr.readyState === 0 && xhr.status === 0 ){\n                content += ': ' + _l( 'Galaxy could not be reached and may be updating.' ) +\n                    _l( ' Try again in a few minutes.' );\n            } else if( xhr.responseJSON ){\n                content += ':<br /><pre>' + JSON.stringify( xhr.responseJSON ) + '</pre>';\n            } else {\n                content += ': ' + message;\n            }\n        }\n        creator._showAlert( content, 'alert-danger' );\n    },\n\n    events : {\n        // header\n        'click .more-help'              : '_clickMoreHelp',\n        'click .less-help'              : '_clickLessHelp',\n        'click .main-help'              : '_toggleHelp',\n        'click .header .alert button'   : '_hideAlert',\n\n        'click .reset'                  : 'reset',\n        'click .clear-selected'         : 'clearSelectedElements',\n\n        // elements - selection\n        'click .collection-elements'    : 'clearSelectedElements',\n\n        // elements - drop target\n        // 'dragenter .collection-elements': '_dragenterElements',\n        // 'dragleave .collection-elements': '_dragleaveElements',\n        'dragover .collection-elements' : '_dragoverElements',\n        'drop .collection-elements'     : '_dropElements',\n\n        // these bubble up from the elements as custom events\n        'collection-element.dragstart .collection-elements' : '_elementDragstart',\n        'collection-element.dragend   .collection-elements' : '_elementDragend',\n\n        // footer\n        'change .collection-name'       : '_changeName',\n        'keydown .collection-name'      : '_nameCheckForEnter',\n        'click .cancel-create'          : function( ev ){\n            if( typeof this.oncancel === 'function' ){\n                this.oncancel.call( this );\n            }\n        },\n        'click .create-collection'      : '_clickCreate'//,\n    },\n\n    // ........................................................................ header\n    /** expand help */\n    _clickMoreHelp : function( ev ){\n        ev.stopPropagation();\n        this.$( '.main-help' ).addClass( 'expanded' );\n        this.$( '.more-help' ).hide();\n    },\n    /** collapse help */\n    _clickLessHelp : function( ev ){\n        ev.stopPropagation();\n        this.$( '.main-help' ).removeClass( 'expanded' );\n        this.$( '.more-help' ).show();\n    },\n    /** toggle help */\n    _toggleHelp : function( ev ){\n        ev.stopPropagation();\n        this.$( '.main-help' ).toggleClass( 'expanded' );\n        this.$( '.more-help' ).toggle();\n    },\n\n    /** show an alert on the top of the interface containing message (alertClass is bootstrap's alert-*) */\n    _showAlert : function( message, alertClass ){\n        alertClass = alertClass || 'alert-danger';\n        this.$( '.main-help' ).hide();\n        this.$( '.header .alert' )\n            .attr( 'class', 'alert alert-dismissable' ).addClass( alertClass ).show()\n            .find( '.alert-message' ).html( message );\n    },\n    /** hide the alerts at the top */\n    _hideAlert : function( message ){\n        this.$( '.main-help' ).show();\n        this.$( '.header .alert' ).hide();\n    },\n\n    // ........................................................................ elements\n    /** reset all data to the initial state */\n    reset : function(){\n        this._instanceSetUp();\n        this._elementsSetUp();\n        this.render();\n    },\n\n    /** deselect all elements */\n    clearSelectedElements : function( ev ){\n        this.$( '.collection-elements .collection-element' ).removeClass( 'selected' );\n        this.$( '.collection-elements-controls > .clear-selected' ).hide();\n    },\n\n    //_dragenterElements : function( ev ){\n    //    //this.debug( '_dragenterElements:', ev );\n    //},\n//TODO: if selected are dragged out of the list area - remove the placeholder - cuz it won't work anyway\n    // _dragleaveElements : function( ev ){\n    //    //this.debug( '_dragleaveElements:', ev );\n    // },\n\n    /** track the mouse drag over the list adding a placeholder to show where the drop would occur */\n    _dragoverElements : function( ev ){\n        //this.debug( '_dragoverElements:', ev );\n        ev.preventDefault();\n\n        var $list = this.$list();\n        this._checkForAutoscroll( $list, ev.originalEvent.clientY );\n        var $nearest = this._getNearestElement( ev.originalEvent.clientY );\n\n        //TODO: no need to re-create - move instead\n        this.$( '.element-drop-placeholder' ).remove();\n        var $placeholder = $( '<div class=\"element-drop-placeholder\"></div>' );\n        if( !$nearest.length ){\n            $list.append( $placeholder );\n        } else {\n            $nearest.before( $placeholder );\n        }\n    },\n\n    /** If the mouse is near enough to the list's top or bottom, scroll the list */\n    _checkForAutoscroll : function( $element, y ){\n        var AUTOSCROLL_SPEED = 2,\n            offset = $element.offset(),\n            scrollTop = $element.scrollTop(),\n            upperDist = y - offset.top,\n            lowerDist = ( offset.top + $element.outerHeight() ) - y;\n        if( upperDist >= 0 && upperDist < this.autoscrollDist ){\n            $element.scrollTop( scrollTop - AUTOSCROLL_SPEED );\n        } else if( lowerDist >= 0 && lowerDist < this.autoscrollDist ){\n            $element.scrollTop( scrollTop + AUTOSCROLL_SPEED );\n        }\n    },\n\n    /** get the nearest element based on the mouse's Y coordinate.\n     *  If the y is at the end of the list, return an empty jQuery object.\n     */\n    _getNearestElement : function( y ){\n        var WIGGLE = 4,\n            lis = this.$( '.collection-elements li.collection-element' ).toArray();\n        for( var i=0; i<lis.length; i++ ){\n            var $li = $( lis[i] ),\n                top = $li.offset().top,\n                halfHeight = Math.floor( $li.outerHeight() / 2 ) + WIGGLE;\n            if( top + halfHeight > y && top - halfHeight < y ){\n                return $li;\n            }\n        }\n        return $();\n    },\n\n    /** drop (dragged/selected elements) onto the list, re-ordering the internal list */\n    _dropElements : function( ev ){\n        if( ev.originalEvent ){ ev = ev.originalEvent; }\n        // both required for firefox\n        ev.preventDefault();\n        ev.dataTransfer.dropEffect = 'move';\n\n        // insert before the nearest element or after the last.\n        var $nearest = this._getNearestElement( ev.clientY );\n        if( $nearest.length ){\n            this.$dragging.insertBefore( $nearest );\n        } else {\n            // no nearest before - insert after last element\n            this.$dragging.insertAfter( this.$( '.collection-elements .collection-element' ).last() );\n        }\n        // resync the creator's list based on the new DOM order\n        this._syncOrderToDom();\n        return false;\n    },\n\n    /** resync the creator's list of elements based on the DOM order */\n    _syncOrderToDom : function(){\n        var creator = this,\n            newElements = [];\n        //TODO: doesn't seem wise to use the dom to store these - can't we sync another way?\n        this.$( '.collection-elements .collection-element' ).each( function(){\n            var id = $( this ).attr( 'data-element-id' ),\n                element = _.findWhere( creator.workingElements, { id: id });\n            if( element ){\n                newElements.push( element );\n            } else {\n                console.error( 'missing element: ', id );\n            }\n        });\n        this.workingElements = newElements;\n        this._renderList();\n    },\n\n    /** drag communication with element sub-views: dragstart */\n    _elementDragstart : function( ev, element ){\n        // auto select the element causing the event and move all selected\n        element.select( true );\n        this.$dragging = this.$( '.collection-elements .collection-element.selected' );\n    },\n\n    /** drag communication with element sub-views: dragend - remove the placeholder */\n    _elementDragend : function( ev, element ){\n        $( '.element-drop-placeholder' ).remove();\n        this.$dragging = null;\n    },\n\n    // ........................................................................ footer\n    /** handle a collection name change */\n    _changeName : function( ev ){\n        this._validationWarning( 'name', !!this._getName() );\n    },\n\n    /** check for enter key press when in the collection name and submit */\n    _nameCheckForEnter : function( ev ){\n        if( ev.keyCode === 13 && !this.blocking ){\n            this._clickCreate();\n        }\n    },\n\n    /** get the current collection name */\n    _getName : function(){\n        return _.escape( this.$( '.collection-name' ).val() );\n    },\n\n    /** attempt to create the current collection */\n    _clickCreate : function( ev ){\n        var name = this._getName();\n        if( !name ){\n            this._validationWarning( 'name' );\n        } else if( !this.blocking ){\n            this.createList( name );\n        }\n    },\n\n    // ------------------------------------------------------------------------ templates\n    //TODO: move to require text plugin and load these as text\n    //TODO: underscore currently unnecc. bc no vars are used\n    //TODO: better way of localizing text-nodes in long strings\n    /** underscore template fns attached to class */\n    templates : {\n        /** the skeleton */\n        main : _.template([\n            '<div class=\"header flex-row no-flex\"></div>',\n            '<div class=\"middle flex-row flex-row-container\"></div>',\n            '<div class=\"footer flex-row no-flex\"></div>'\n        ].join('')),\n\n        /** the header (not including help text) */\n        header : _.template([\n            '<div class=\"main-help well clear\">',\n                '<a class=\"more-help\" href=\"javascript:void(0);\">', _l( 'More help' ), '</a>',\n                '<div class=\"help-content\">',\n                    '<a class=\"less-help\" href=\"javascript:void(0);\">', _l( 'Less' ), '</a>',\n                '</div>',\n            '</div>',\n            '<div class=\"alert alert-dismissable\">',\n                '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" ',\n                    'title=\"', _l( 'Close and show more help' ), '\" aria-hidden=\"true\">&times;</button>',\n                '<span class=\"alert-message\"></span>',\n            '</div>',\n        ].join('')),\n\n        /** the middle: element list */\n        middle : _.template([\n            '<div class=\"collection-elements-controls\">',\n                '<a class=\"reset\" href=\"javascript:void(0);\" ',\n                    'title=\"', _l( 'Undo all reordering and discards' ), '\">',\n                    _l( 'Start over' ),\n                '</a>',\n                '<a class=\"clear-selected\" href=\"javascript:void(0);\" ',\n                    'title=\"', _l( 'De-select all selected datasets' ), '\">',\n                    _l( 'Clear selected' ),\n                '</a>',\n            '</div>',\n            '<div class=\"collection-elements scroll-container flex-row\">',\n            '</div>'\n        ].join('')),\n\n        /** creation and cancel controls */\n        footer : _.template([\n            '<div class=\"attributes clear\">',\n                '<div class=\"clear\">',\n                    '<input class=\"collection-name form-control pull-right\" ',\n                        'placeholder=\"', _l( 'Enter a name for your new collection' ), '\" />',\n                    '<div class=\"collection-name-prompt pull-right\">', _l( 'Name' ), ':</div>',\n                '</div>',\n            '</div>',\n\n            '<div class=\"actions clear vertically-spaced\">',\n                '<div class=\"other-options pull-left\">',\n                    '<button class=\"cancel-create btn\" tabindex=\"-1\">', _l( 'Cancel' ), '</button>',\n                    '<div class=\"create-other btn-group dropup\">',\n                        '<button class=\"btn btn-default dropdown-toggle\" data-toggle=\"dropdown\">',\n                              _l( 'Create a different kind of collection' ),\n                              ' <span class=\"caret\"></span>',\n                        '</button>',\n                        '<ul class=\"dropdown-menu\" role=\"menu\">',\n                              '<li><a href=\"#\">', _l( 'Create a <i>single</i> pair' ), '</a></li>',\n                              '<li><a href=\"#\">', _l( 'Create a list of <i>unpaired</i> datasets' ), '</a></li>',\n                        '</ul>',\n                    '</div>',\n                '</div>',\n\n                '<div class=\"main-options pull-right\">',\n                    '<button class=\"create-collection btn btn-primary\">', _l( 'Create list' ), '</button>',\n                '</div>',\n            '</div>'\n        ].join('')),\n\n        /** help content */\n        helpContent : _.template([\n            '<p>', _l([\n                'Collections of datasets are permanent, ordered lists of datasets that can be passed to tools and ',\n                'workflows in order to have analyses done on each member of the entire group. This interface allows ',\n                'you to create a collection and re-order the final collection.'\n            ].join( '' )), '</p>',\n            '<ul>',\n                '<li>', _l([\n                    'Rename elements in the list by clicking on ',\n                    '<i data-target=\".collection-element .name\">the existing name</i>.'\n                ].join( '' )), '</li>',\n                '<li>', _l([\n                    'Discard elements from the final created list by clicking on the ',\n                    '<i data-target=\".collection-element .discard\">\"Discard\"</i> button.'\n                ].join( '' )), '</li>',\n                '<li>', _l([\n                    'Reorder the list by clicking and dragging elements. Select multiple elements by clicking on ',\n                    '<i data-target=\".collection-element\">them</i> and you can then move those selected by dragging the ',\n                    'entire group. Deselect them by clicking them again or by clicking the ',\n                    'the <i data-target=\".clear-selected\">\"Clear selected\"</i> link.'\n                ].join( '' )), '</li>',\n                '<li>', _l([\n                    'Click the <i data-target=\".reset\">\"Start over\"</i> link to begin again as if you had just opened ',\n                    'the interface.'\n                ].join( '' )), '</li>',\n                '<li>', _l([\n                    'Click the <i data-target=\".cancel-create\">\"Cancel\"</i> button to exit the interface.'\n                ].join( '' )), '</li>',\n            '</ul><br />',\n            '<p>', _l([\n                'Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ',\n                'click <i data-target=\".create-collection\">\"Create list\"</i>.'\n            ].join( '' )), '</p>'\n        ].join('')),\n\n        /** shown in list when all elements are discarded */\n        invalidElements : _.template([\n            _l( 'The following selections could not be included due to problems:' ),\n            '<ul><% _.each( problems, function( problem ){ %>',\n                '<li><b><%- problem.element.name %></b>: <%- problem.text %></li>',\n            '<% }); %></ul>'\n        ].join('')),\n\n        /** shown in list when all elements are discarded */\n        noElementsLeft : _.template([\n            '<li class=\"no-elements-left-message\">',\n                _l( 'No elements left! ' ),\n                _l( 'Would you like to ' ), '<a class=\"reset\" href=\"javascript:void(0)\">', _l( 'start over' ), '</a>?',\n            '</li>'\n        ].join('')),\n\n        /** a simplified page communicating what went wrong and why the user needs to reselect something else */\n        invalidInitial : _.template([\n            '<div class=\"header flex-row no-flex\">',\n                '<div class=\"alert alert-warning\" style=\"display: block\">',\n                    '<span class=\"alert-message\">',\n                        '<% if( _.size( problems ) ){ %>',\n                            _l( 'The following selections could not be included due to problems' ), ':',\n                            '<ul><% _.each( problems, function( problem ){ %>',\n                                '<li><b><%- problem.element.name %></b>: <%- problem.text %></li>',\n                            '<% }); %></ul>',\n                        '<% } else if( _.size( elements ) < 1 ){ %>',\n                            _l( 'No datasets were selected' ), '.',\n                        '<% } %>',\n                        '<br />',\n                        _l( 'At least one element is needed for the collection' ), '. ',\n                        _l( 'You may need to ' ),\n                        '<a class=\"cancel-create\" href=\"javascript:void(0)\">', _l( 'cancel' ), '</a> ',\n                        _l( 'and reselect new elements' ), '.',\n                    '</span>',\n                '</div>',\n            '</div>',\n            '<div class=\"footer flex-row no-flex\">',\n                '<div class=\"actions clear vertically-spaced\">',\n                    '<div class=\"other-options pull-left\">',\n                        '<button class=\"cancel-create btn\" tabindex=\"-1\">', _l( 'Cancel' ), '</button>',\n                        // _l( 'Create a different kind of collection' ),\n                    '</div>',\n                '</div>',\n            '</div>'\n        ].join('')),\n    },\n\n    // ------------------------------------------------------------------------ misc\n    /** string rep */\n    toString : function(){ return 'ListCollectionCreator'; }\n});\n\n\n\n//=============================================================================\n/** Create a modal and load its body with the given CreatorClass creator type\n *  @returns {Deferred} resolved when creator has built a collection.\n */\nvar collectionCreatorModal = function _collectionCreatorModal( elements, options, CreatorClass ){\n\n    var deferred = jQuery.Deferred(),\n        modal = Galaxy.modal || ( new UI_MODAL.View() ),\n        creator;\n\n    options = _.defaults( options || {}, {\n        elements    : elements,\n        oncancel    : function(){\n            modal.hide();\n            deferred.reject( 'cancelled' );\n        },\n        oncreate    : function( creator, response ){\n            modal.hide();\n            deferred.resolve( response );\n        }\n    });\n\n    creator = new CreatorClass( options );\n    modal.show({\n        title   : options.title || _l( 'Create a collection' ),\n        body    : creator.$el,\n        width   : '80%',\n        height  : '100%',\n        closing_events: true\n    });\n    creator.render();\n    window._collectionCreator = creator;\n\n    //TODO: remove modal header\n    return deferred;\n};\n\n/** List collection flavor of collectionCreatorModal. */\nvar listCollectionCreatorModal = function _listCollectionCreatorModal( elements, options ){\n    options = options || {};\n    options.title = _l( 'Create a collection from a list of datasets' );\n    return collectionCreatorModal( elements, options, ListCollectionCreator );\n};\n\n\n//==============================================================================\n/** Use a modal to create a list collection, then add it to the given history contents.\n *  @returns {Deferred} resolved when the collection is added to the history.\n */\nfunction createListCollection( contents ){\n    var elements = contents.toJSON(),\n        promise = listCollectionCreatorModal( elements, {\n            creationFn : function( elements, name ){\n                elements = elements.map( function( element ){\n                    return {\n                        id      : element.id,\n                        name    : element.name,\n                        //TODO: this allows for list:list even if the filter above does not - reconcile\n                        src     : ( element.history_content_type === 'dataset'? 'hda' : 'hdca' )\n                    };\n                });\n                return contents.createHDCA( elements, 'list', name );\n            }\n        });\n    return promise;\n}\n\n//==============================================================================\n    return {\n        DatasetCollectionElementView: DatasetCollectionElementView,\n        ListCollectionCreator       : ListCollectionCreator,\n\n        collectionCreatorModal      : collectionCreatorModal,\n        listCollectionCreatorModal  : listCollectionCreatorModal,\n        createListCollection        : createListCollection\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/collection/list-collection-creator.js\n **/","define([\n    \"mvc/list/list-item\",\n    \"mvc/dataset/states\",\n    \"ui/fa-icon-button\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( LIST_ITEM, STATES, faIconButton, BASE_MVC, _l ){\n'use strict';\n\nvar logNamespace = 'dataset';\n/*==============================================================================\nTODO:\n    straighten out state rendering and templates used\n    inaccessible/STATES.NOT_VIEWABLE is a special case\n    simplify button rendering\n\n==============================================================================*/\nvar _super = LIST_ITEM.ListItemView;\n/** @class Read only list view for either LDDAs, HDAs, or HDADCEs.\n *      Roughly, any DatasetInstance (and not a raw Dataset).\n */\nvar DatasetListItemView = _super.extend(\n/** @lends DatasetListItemView.prototype */{\n    _logNamespace : logNamespace,\n\n    className   : _super.prototype.className + \" dataset\",\n    //TODO:?? doesn't exactly match an hda's type_id\n    id          : function(){\n        return [ 'dataset', this.model.get( 'id' ) ].join( '-' );\n    },\n\n    /** Set up: instance vars, options, and event handlers */\n    initialize : function( attributes ){\n        if( attributes.logger ){ this.logger = this.model.logger = attributes.logger; }\n        this.log( this + '.initialize:', attributes );\n        _super.prototype.initialize.call( this, attributes );\n\n        /** where should pages from links be displayed? (default to new tab/window) */\n        this.linkTarget = attributes.linkTarget || '_blank';\n    },\n\n    /** event listeners */\n    _setUpListeners : function(){\n        _super.prototype._setUpListeners.call( this );\n\n        // re-rendering on any model changes\n        this.listenTo( this.model, 'change', function( model, options ){\n            // if the model moved into the ready state and is expanded without details, fetch those details now\n            if( this.model.changedAttributes().state && this.model.inReadyState()\n            &&  this.expanded && !this.model.hasDetails() ){\n                // will render automatically (due to fetch -> change)\n                this.model.fetch();\n\n            } else {\n                this.render();\n            }\n        });\n    },\n\n    // ......................................................................... expandable\n    /** In this override, only get details if in the ready state, get rerunnable if in other states.\n     *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n     */\n    _fetchModelDetails : function(){\n        var view = this;\n        if( view.model.inReadyState() && !view.model.hasDetails() ){\n            return view.model.fetch({ silent: true });\n        }\n        return jQuery.when();\n    },\n\n    // ......................................................................... removal\n    /** Remove this view's html from the DOM and remove all event listeners.\n     *  @param {Number or String} speed jq effect speed\n     *  @param {Function} callback      an optional function called when removal is done (scoped to this view)\n     */\n    remove : function( speed, callback ){\n        var view = this;\n        speed = speed || this.fxSpeed;\n        this.$el.fadeOut( speed, function(){\n            Backbone.View.prototype.remove.call( view );\n            if( callback ){ callback.call( view ); }\n        });\n    },\n\n    // ......................................................................... rendering\n    /* TODO:\n        dataset states are the issue primarily making dataset rendering complex\n            each state should have it's own way of displaying/set of details\n            often with different actions that can be applied\n        throw in deleted/purged/visible and things get complicated easily\n        I've considered (a couple of times) - creating a view for each state\n            - but recreating the view during an update...seems wrong\n    */\n    /** Render this HDA, set up ui.\n     *  @param {Number or String} speed jq fx speed\n     *  @returns {Object} this\n     */\n    render : function( speed ){\n        //HACK: hover exit doesn't seem to be called on prev. tooltips when RE-rendering - so: no tooltip hide\n        // handle that here by removing previous view's tooltips\n        //this.$el.find(\"[title]\").tooltip( \"destroy\" );\n        return _super.prototype.render.call( this, speed );\n    },\n\n    /** In this override, add the dataset state as a class for use with state-based CSS */\n    _swapNewRender : function( $newRender ){\n        _super.prototype._swapNewRender.call( this, $newRender );\n        if( this.model.has( 'state' ) ){\n            this.$el.addClass( 'state-' + this.model.get( 'state' ) );\n        }\n        return this.$el;\n    },\n\n    // ................................................................................ titlebar\n    /** In this override, add the dataset display button. */\n    _renderPrimaryActions : function(){\n        // render just the display for read-only\n        return [ this._renderDisplayButton() ];\n    },\n\n    /** Render icon-button to display dataset data */\n    _renderDisplayButton : function(){\n//TODO:?? too complex - possibly move into template\n        // don't show display if not viewable or not accessible\n        var state = this.model.get( 'state' );\n        if( ( state === STATES.NOT_VIEWABLE )\n        ||  ( state === STATES.DISCARDED )\n        ||  ( !this.model.get( 'accessible' ) ) ){\n            return null;\n        }\n\n        var displayBtnData = {\n            target      : this.linkTarget,\n            classes     : 'display-btn'\n        };\n\n        // show a disabled display if the data's been purged\n        if( this.model.get( 'purged' ) ){\n            displayBtnData.disabled = true;\n            displayBtnData.title = _l( 'Cannot display datasets removed from disk' );\n\n        // disable if still uploading\n        } else if( state === STATES.UPLOAD ){\n            displayBtnData.disabled = true;\n            displayBtnData.title = _l( 'This dataset must finish uploading before it can be viewed' );\n\n        // disable if still new\n        } else if( state === STATES.NEW ){\n            displayBtnData.disabled = true;\n            displayBtnData.title = _l( 'This dataset is not yet viewable' );\n\n        } else {\n            displayBtnData.title = _l( 'View data' );\n\n            // default link for dataset\n            displayBtnData.href  = this.model.urls.display;\n\n            // add frame manager option onclick event\n            var self = this;\n            displayBtnData.onclick = function( ev ){\n                if (Galaxy.frame && Galaxy.frame.active) {\n                    // Add dataset to frames.\n                    Galaxy.frame.addDataset(self.model.get('id'));\n                    ev.preventDefault();\n                }\n            };\n        }\n        displayBtnData.faIcon = 'fa-eye';\n        return faIconButton( displayBtnData );\n    },\n\n    // ......................................................................... rendering details\n    /** Render the enclosing div of the hda body and, if expanded, the html in the body\n     *  @returns {jQuery} rendered DOM\n     */\n    _renderDetails : function(){\n        //TODO: generalize to be allow different details for each state\n\n        // no access - render nothing but a message\n        if( this.model.get( 'state' ) === STATES.NOT_VIEWABLE ){\n            return $( this.templates.noAccess( this.model.toJSON(), this ) );\n        }\n\n        var $details = _super.prototype._renderDetails.call( this );\n        $details.find( '.actions .left' ).empty().append( this._renderSecondaryActions() );\n        $details.find( '.summary' ).html( this._renderSummary() )\n            .prepend( this._renderDetailMessages() );\n        $details.find( '.display-applications' ).html( this._renderDisplayApplications() );\n\n//TODO: double tap\n        this._setUpBehaviors( $details );\n        return $details;\n    },\n\n    /** Defer to the appropo summary rendering fn based on state */\n    _renderSummary : function(){\n        var json = this.model.toJSON(),\n            summaryRenderFn = this.templates.summaries[ json.state ];\n        summaryRenderFn = summaryRenderFn || this.templates.summaries.unknown;\n        return summaryRenderFn( json, this );\n    },\n\n    /** Render messages to be displayed only when the details are shown */\n    _renderDetailMessages : function(){\n        var view = this,\n            $warnings = $( '<div class=\"detail-messages\"></div>' ),\n            json = view.model.toJSON();\n//TODO:! unordered (map)\n        _.each( view.templates.detailMessages, function( templateFn ){\n            $warnings.append( $( templateFn( json, view ) ) );\n        });\n        return $warnings;\n    },\n\n    /** Render the external display application links */\n    _renderDisplayApplications : function(){\n        if( this.model.isDeletedOrPurged() ){ return ''; }\n        // render both old and new display apps using the same template\n        return [\n            this.templates.displayApplications( this.model.get( 'display_apps' ), this ),\n            this.templates.displayApplications( this.model.get( 'display_types' ), this )\n        ].join( '' );\n    },\n\n    // ......................................................................... secondary/details actions\n    /** A series of links/buttons for less commonly used actions: re-run, info, etc. */\n    _renderSecondaryActions : function(){\n        this.debug( '_renderSecondaryActions' );\n        switch( this.model.get( 'state' ) ){\n            case STATES.NOT_VIEWABLE:\n                return [];\n            case STATES.OK:\n            case STATES.FAILED_METADATA:\n            case STATES.ERROR:\n                return [ this._renderDownloadButton(), this._renderShowParamsButton() ];\n        }\n        return [ this._renderShowParamsButton() ];\n    },\n\n    /** Render icon-button to show the input and output (stdout/err) for the job that created this.\n     *  @returns {jQuery} rendered DOM\n     */\n    _renderShowParamsButton : function(){\n        // gen. safe to show in all cases\n        return faIconButton({\n            title       : _l( 'View details' ),\n            classes     : 'params-btn',\n            href        : this.model.urls.show_params,\n            target      : this.linkTarget,\n            faIcon      : 'fa-info-circle'\n        });\n    },\n\n    /** Render icon-button/popupmenu to download the data (and/or the associated meta files (bai, etc.)) for this.\n     *  @returns {jQuery} rendered DOM\n     */\n    _renderDownloadButton : function(){\n//TODO: to (its own) template fn\n        // don't show anything if the data's been purged\n        if( this.model.get( 'purged' ) || !this.model.hasData() ){ return null; }\n\n        // return either: a popupmenu with links to download assoc. meta files (if there are meta files)\n        //  or a single download icon-button (if there are no meta files)\n        if( !_.isEmpty( this.model.get( 'meta_files' ) ) ){\n            return this._renderMetaFileDownloadButton();\n        }\n\n        return $([\n            '<a class=\"download-btn icon-btn\" href=\"', this.model.urls.download, '\" title=\"' + _l( 'Download' ) + '\" download>',\n                '<span class=\"fa fa-floppy-o\"></span>',\n            '</a>'\n        ].join( '' ));\n    },\n\n    /** Render the download button which opens a dropdown with links to download assoc. meta files (indeces, etc.) */\n    _renderMetaFileDownloadButton : function(){\n        var urls = this.model.urls;\n        return $([\n            '<div class=\"metafile-dropdown dropdown\">',\n                '<a class=\"download-btn icon-btn\" href=\"javascript:void(0)\" data-toggle=\"dropdown\"',\n                    ' title=\"' + _l( 'Download' ) + '\">',\n                    '<span class=\"fa fa-floppy-o\"></span>',\n                '</a>',\n                '<ul class=\"dropdown-menu\" role=\"menu\" aria-labelledby=\"dLabel\">',\n                    '<li><a href=\"' + urls.download + '\" download>', _l( 'Download dataset' ), '</a></li>',\n                    _.map( this.model.get( 'meta_files' ), function( meta_file ){\n                        return [\n                            '<li><a href=\"', urls.meta_download + meta_file.file_type, '\">',\n                                _l( 'Download' ), ' ', meta_file.file_type,\n                            '</a></li>'\n                        ].join( '' );\n                    }).join( '\\n' ),\n                '</ul>',\n            '</div>'\n        ].join( '\\n' ));\n    },\n\n    // ......................................................................... misc\n    events : _.extend( _.clone( _super.prototype.events ), {\n        'click .display-btn'    : function( ev ){ this.trigger( 'display', this, ev ); },\n        'click .params-btn'     : function( ev ){ this.trigger( 'params', this, ev ); },\n        'click .download-btn'   : function( ev ){ this.trigger( 'download', this, ev ); }\n    }),\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'DatasetListItemView(' + modelString + ')';\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDatasetListItemView.prototype.templates = (function(){\n//TODO: move to require text! plugin\n\n    var warnings = _.extend( {}, _super.prototype.templates.warnings, {\n        failed_metadata : BASE_MVC.wrapTemplate([\n            // failed metadata is rendered as a warning on an otherwise ok dataset view\n            '<% if( model.state === \"failed_metadata\" ){ %>',\n                '<div class=\"warningmessagesmall\">',\n                    _l( 'An error occurred setting the metadata for this dataset' ),\n                '</div>',\n            '<% } %>'\n        ]),\n        error : BASE_MVC.wrapTemplate([\n            // error during index fetch - show error on dataset\n            '<% if( model.error ){ %>',\n                '<div class=\"errormessagesmall\">',\n                    _l( 'There was an error getting the data for this dataset' ), ': <%- model.error %>',\n                '</div>',\n            '<% } %>'\n        ]),\n        purged : BASE_MVC.wrapTemplate([\n            '<% if( model.purged ){ %>',\n                '<div class=\"purged-msg warningmessagesmall\">',\n                    _l( 'This dataset has been deleted and removed from disk' ),\n                '</div>',\n            '<% } %>'\n        ]),\n        deleted : BASE_MVC.wrapTemplate([\n            // deleted not purged\n            '<% if( model.deleted && !model.purged ){ %>',\n                '<div class=\"deleted-msg warningmessagesmall\">',\n                    _l( 'This dataset has been deleted' ),\n                '</div>',\n            '<% } %>'\n        ])\n\n        //NOTE: hidden warning is only needed for HDAs\n    });\n\n    var detailsTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"details\">',\n            '<div class=\"summary\"></div>',\n\n            '<div class=\"actions clear\">',\n                '<div class=\"left\"></div>',\n                '<div class=\"right\"></div>',\n            '</div>',\n\n            // do not display tags, annotation, display apps, or peek when deleted\n            '<% if( !dataset.deleted && !dataset.purged ){ %>',\n                '<div class=\"tags-display\"></div>',\n                '<div class=\"annotation-display\"></div>',\n\n                '<div class=\"display-applications\"></div>',\n\n                '<% if( dataset.peek ){ %>',\n                    '<pre class=\"dataset-peek\"><%= dataset.peek %></pre>',\n                '<% } %>',\n            '<% } %>',\n        '</div>'\n    ], 'dataset' );\n\n    var noAccessTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"details\">',\n            '<div class=\"summary\">',\n                _l( 'You do not have permission to view this dataset' ),\n            '</div>',\n        '</div>'\n    ], 'dataset' );\n\n//TODO: still toooooooooooooo complex - rework\n    var summaryTemplates = {};\n    summaryTemplates[ STATES.OK ] = summaryTemplates[ STATES.FAILED_METADATA ] = BASE_MVC.wrapTemplate([\n        '<% if( dataset.misc_blurb ){ %>',\n            '<div class=\"blurb\">',\n                '<span class=\"value\"><%- dataset.misc_blurb %></span>',\n            '</div>',\n        '<% } %>',\n\n        '<% if( dataset.file_ext ){ %>',\n            '<div class=\"datatype\">',\n                '<label class=\"prompt\">', _l( 'format' ), '</label>',\n                '<span class=\"value\"><%- dataset.file_ext %></span>',\n            '</div>',\n        '<% } %>',\n\n        '<% if( dataset.metadata_dbkey ){ %>',\n            '<div class=\"dbkey\">',\n                '<label class=\"prompt\">', _l( 'database' ), '</label>',\n                '<span class=\"value\">',\n                    '<%- dataset.metadata_dbkey %>',\n                '</span>',\n            '</div>',\n        '<% } %>',\n\n        '<% if( dataset.misc_info ){ %>',\n            '<div class=\"info\">',\n                '<span class=\"value\"><%- dataset.misc_info %></span>',\n            '</div>',\n        '<% } %>'\n    ], 'dataset' );\n    summaryTemplates[ STATES.NEW ] = BASE_MVC.wrapTemplate([\n        '<div>', _l( 'This is a new dataset and not all of its data are available yet' ), '</div>'\n    ], 'dataset' );\n    summaryTemplates[ STATES.NOT_VIEWABLE ] = BASE_MVC.wrapTemplate([\n        '<div>', _l( 'You do not have permission to view this dataset' ), '</div>'\n    ], 'dataset' );\n    summaryTemplates[ STATES.DISCARDED ] = BASE_MVC.wrapTemplate([\n        '<div>', _l( 'The job creating this dataset was cancelled before completion' ), '</div>'\n    ], 'dataset' );\n    summaryTemplates[ STATES.QUEUED ] = BASE_MVC.wrapTemplate([\n        '<div>', _l( 'This job is waiting to run' ), '</div>'\n    ], 'dataset' );\n    summaryTemplates[ STATES.RUNNING ] = BASE_MVC.wrapTemplate([\n        '<div>', _l( 'This job is currently running' ), '</div>'\n    ], 'dataset' );\n    summaryTemplates[ STATES.UPLOAD ] = BASE_MVC.wrapTemplate([\n        '<div>', _l( 'This dataset is currently uploading' ), '</div>'\n    ], 'dataset' );\n    summaryTemplates[ STATES.SETTING_METADATA ] = BASE_MVC.wrapTemplate([\n        '<div>', _l( 'Metadata is being auto-detected' ), '</div>'\n    ], 'dataset' );\n    summaryTemplates[ STATES.PAUSED ] = BASE_MVC.wrapTemplate([\n        '<div>', _l( 'This job is paused. Use the \"Resume Paused Jobs\" in the history menu to resume' ), '</div>'\n    ], 'dataset' );\n    summaryTemplates[ STATES.ERROR ] = BASE_MVC.wrapTemplate([\n        '<% if( !dataset.purged ){ %>',\n            '<div><%- dataset.misc_blurb %></div>',\n        '<% } %>',\n        '<span class=\"help-text\">', _l( 'An error occurred with this dataset' ), ':</span>',\n        '<div class=\"job-error-text\"><%- dataset.misc_info %></div>'\n    ], 'dataset' );\n    summaryTemplates[ STATES.EMPTY ] = BASE_MVC.wrapTemplate([\n        '<div>', _l( 'No data' ), ': <i><%- dataset.misc_blurb %></i></div>'\n    ], 'dataset' );\n    summaryTemplates.unknown = BASE_MVC.wrapTemplate([\n        '<div>Error: unknown dataset state: \"<%- dataset.state %>\"</div>'\n    ], 'dataset' );\n\n    // messages to be displayed only within the details section ('below the fold')\n    var detailMessageTemplates = {\n        resubmitted : BASE_MVC.wrapTemplate([\n            // deleted not purged\n            '<% if( model.resubmitted ){ %>',\n                '<div class=\"resubmitted-msg infomessagesmall\">',\n                    _l( 'The job creating this dataset has been resubmitted' ),\n                '</div>',\n            '<% } %>'\n        ])\n    };\n\n    // this is applied to both old and new style display apps\n    var displayApplicationsTemplate = BASE_MVC.wrapTemplate([\n        '<% _.each( apps, function( app ){ %>',\n            '<div class=\"display-application\">',\n                '<span class=\"display-application-location\"><%- app.label %></span> ',\n                '<span class=\"display-application-links\">',\n                    '<% _.each( app.links, function( link ){ %>',\n                        '<a target=\"<%- link.target %>\" href=\"<%- link.href %>\">',\n                            '<% print( _l( link.text ) ); %>',\n                        '</a> ',\n                    '<% }); %>',\n                '</span>',\n            '</div>',\n        '<% }); %>'\n    ], 'apps' );\n\n    return _.extend( {}, _super.prototype.templates, {\n        warnings    : warnings,\n        details     : detailsTemplate,\n        noAccess    : noAccessTemplate,\n        summaries   : summaryTemplates,\n        detailMessages      : detailMessageTemplates,\n        displayApplications : displayApplicationsTemplate\n    });\n}());\n\n\n// ============================================================================\n    return {\n        DatasetListItemView : DatasetListItemView\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/dataset/dataset-li.js\n **/","/*\n    This class maps the form dom to an api compatible javascript dictionary.\n*/\ndefine([ 'utils/utils' ], function( Utils ) {\n    var Manager = Backbone.Model.extend({\n        initialize: function( app ) {\n            this.app = app;\n        },\n\n        /** Creates a checksum.\n        */\n        checksum: function() {\n            var sum = '';\n            var self = this;\n            this.app.section.$el.find( '.section-row' ).each( function() {\n                var id = $(this).attr( 'id' );\n                var field = self.app.field_list[ id ];\n                if ( field ) {\n                    sum += id + ':' + JSON.stringify( field.value && field.value() ) + ':' + field.collapsed + ';';\n                }\n            });\n            return sum;\n        },\n\n        /** Convert dom into a dictionary of flat id/value pairs used e.g. on job submission.\n        */\n        create: function() {\n            var self = this;\n\n            // get raw dictionary from dom\n            var dict = {};\n            this._iterate( this.app.section.$el, dict );\n\n            // add to result dictionary, label elements\n            var result_dict = {};\n            this.flat_dict = {};\n            function add( flat_id, input_id, input_value ) {\n                self.flat_dict[ flat_id ] = input_id;\n                result_dict[ flat_id ] = input_value;\n                self.app.element_list[ input_id ] && self.app.element_list[ input_id ].$el.attr( 'tour_id', flat_id );\n            }\n            // converter between raw dictionary and job dictionary\n            function convert( identifier, head ) {\n                for ( var index in head ) {\n                    var node = head[ index ];\n                    if ( node.input ) {\n                        var input = node.input;\n                        var flat_id = identifier;\n                        if ( identifier != '' ) {\n                            flat_id += '|';\n                        }\n                        flat_id += input.name;\n                        switch ( input.type ) {\n                            case 'repeat':\n                                var section_label = 'section-';\n                                var block_indices = [];\n                                var block_prefix = null;\n                                for ( var block_label in node ) {\n                                    var pos = block_label.indexOf( section_label );\n                                    if ( pos != -1 ) {\n                                        pos += section_label.length;\n                                        block_indices.push( parseInt( block_label.substr( pos ) ));\n                                        if ( !block_prefix ) {\n                                            block_prefix = block_label.substr( 0, pos );\n                                        }\n                                    }\n                                }\n                                block_indices.sort( function( a, b ) { return a - b; });\n                                var index = 0;\n                                for ( var i in block_indices ) {\n                                    convert( flat_id + '_' + index++, node[ block_prefix + block_indices[ i ] ]);\n                                }\n                                break;\n                            case 'conditional':\n                                var value = self.app.field_list[ input.id ].value();\n                                add( flat_id + '|' + input.test_param.name, input.id, value );\n                                var selectedCase = matchCase( input, value );\n                                if ( selectedCase != -1 ) {\n                                    convert( flat_id, head[ input.id + '-section-' + selectedCase ] );\n                                }\n                                break;\n                            case 'section':\n                                convert( !input.flat && flat_id || '', node );\n                                break;\n                            default:\n                                var field = self.app.field_list[ input.id ];\n                                if ( field && field.value ) {\n                                    var value = field.value();\n                                    if ( input.ignore === undefined || input.ignore != value ) {\n                                        if ( field.collapsed && input.collapsible_value ) {\n                                            value = input.collapsible_value;\n                                        }\n                                        add( flat_id, input.id, value );\n                                        if ( input.payload ) {\n                                            for ( var p_id in input.payload ) {\n                                                add( p_id, input.id, input.payload[ p_id ] );\n                                            }\n                                        }\n                                    }\n                                }\n                        }\n                    }\n                }\n            }\n            convert( '', dict );\n            return result_dict;\n        },\n\n        /** Matches flat ids to corresponding input element\n         * @param{string} flat_id - Flat input id to be looked up.\n         */\n        match: function ( flat_id ) {\n            return this.flat_dict && this.flat_dict[ flat_id ];\n        },\n\n        /** Match conditional values to selected cases\n        */\n        matchCase: function( input, value ) {\n            return matchCase( input, value );\n        },\n\n        /** Matches a new tool model to the current input elements e.g. used to update dynamic options\n        */\n        matchModel: function( model, callback ) {\n            var self = this;\n            visitInputs( model.inputs, function( input, name ) {\n                self.flat_dict[ name ] && callback ( input, self.flat_dict[ name ] );\n            });\n        },\n\n        /** Matches identifier from api response to input elements e.g. used to display validation errors\n        */\n        matchResponse: function( response ) {\n            var result = {};\n            var self = this;\n            function search ( id, head ) {\n                if ( typeof head === 'string' ) {\n                    var input_id = self.flat_dict[ id ];\n                    input_id && ( result[ input_id ] = head );\n                } else {\n                    for ( var i in head ) {\n                        var new_id = i;\n                        if ( id !== '' ) {\n                            var separator = '|';\n                            if ( head instanceof Array ) {\n                                separator = '_';\n                            }\n                            new_id = id + separator + new_id;\n                        }\n                        search ( new_id, head[ i ] );\n                    }\n                }\n            }\n            search( '', response );\n            return result;\n        },\n\n        /** Map dom tree to dictionary tree with input elements.\n        */\n        _iterate: function( parent, dict ) {\n            var self = this;\n            var children = $( parent ).children();\n            children.each( function() {\n                var child = this;\n                var id = $( child ).attr( 'id' );\n                if ( $( child ).hasClass( 'section-row' ) ) {\n                    var input = self.app.input_list[ id ];\n                    dict[ id ] = ( input && { input : input } ) || {};\n                    self._iterate( child, dict[ id ] );\n                } else {\n                    self._iterate( child, dict );\n                }\n            });\n        }\n    });\n\n    /** Match conditional values to selected cases\n     * @param{dict}   input     - Definition of conditional input parameter\n     * @param{dict}   value     - Current value\n     */\n    var matchCase = function( input, value ) {\n        if ( input.test_param.type == 'boolean' ) {\n            if ( value == 'true' ) {\n                value = input.test_param.truevalue || 'true';\n            } else {\n                value = input.test_param.falsevalue || 'false';\n            }\n        }\n        for ( var i in input.cases ) {\n            if ( input.cases[ i ].value == value ) {\n                return i;\n            }\n        }\n        return -1;\n    };\n\n    /** Visits tool inputs\n     * @param{dict}   inputs    - Nested dictionary of input elements\n     * @param{dict}   callback  - Called with the mapped dictionary object and corresponding model node\n     */\n    var visitInputs = function( inputs, callback, prefix, context ) {\n        context = $.extend( true, {}, context );\n        _.each( inputs, function ( input ) {\n            if ( input && input.type && input.name ) {\n                context[ input.name ] = input;\n            }\n        });\n        for ( var i in inputs ) {\n            var node = inputs[ i ];\n            var name = prefix ? prefix + '|' + node.name : node.name;\n            switch ( node.type ) {\n                case 'repeat':\n                    _.each( node.cache, function( cache, j ) {\n                        visitInputs( cache, callback, name + '_' + j, context );\n                    });\n                    break;\n                case 'conditional':\n                    if ( node.test_param ) {\n                        callback( node.test_param, name + '|' + node.test_param.name, context );\n                        var selectedCase = matchCase( node, node.test_param.value );\n                        if ( selectedCase != -1 ) {\n                            visitInputs( node.cases[ selectedCase ].inputs, callback, name, context );\n                        } else {\n                            Galaxy.emit.debug( 'form-data::visitInputs() - Invalid case for ' + name + '.' );\n                        }\n                    } else {\n                        Galaxy.emit.debug( 'form-data::visitInputs() - Conditional test parameter missing for ' + name  + '.' );\n                    }\n                    break;\n                case 'section':\n                    visitInputs( node.inputs, callback, name, context )\n                    break;\n                default:\n                    callback( node, name, context );\n            }\n        }\n    };\n\n    return {\n        Manager         : Manager,\n        visitInputs     : visitInputs\n    }\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/form/form-data.js\n **/","/**\n    This class creates a form input element wrapper\n*/\ndefine([], function() {\n    return Backbone.View.extend({\n        initialize: function( app, options ) {\n            this.app = app;\n            this.app_options = app.options || {};\n            this.field = options && options.field || new Backbone.View();\n            this.model = options && options.model || new Backbone.Model({\n                text_enable     : this.app_options.text_enable   || 'Enable',\n                text_disable    : this.app_options.text_disable  || 'Disable',\n                cls_enable      : this.app_options.cls_enable    || 'fa fa-caret-square-o-down',\n                cls_disable     : this.app_options.cls_disable   || 'fa fa-caret-square-o-up'\n            }).set( options );\n\n            // set element and link components\n            this.setElement( this._template() );\n            this.$field             = this.$( '.ui-form-field' );\n            this.$info              = this.$( '.ui-form-info' );\n            this.$preview           = this.$( '.ui-form-preview' );\n            this.$collapsible       = this.$( '.ui-form-collapsible' );\n            this.$collapsible_text  = this.$( '.ui-form-collapsible-text' );\n            this.$collapsible_icon  = this.$( '.ui-form-collapsible-icon' );\n            this.$title             = this.$( '.ui-form-title' );\n            this.$title_text        = this.$( '.ui-form-title-text' );\n            this.$error_text        = this.$( '.ui-form-error-text' );\n            this.$error             = this.$( '.ui-form-error' );\n            this.$backdrop          = this.$( '.ui-form-backdrop' );\n\n            // add field element\n            this.$field.prepend( this.field.$el );\n\n            // decide wether to expand or collapse fields\n            var collapsible_value = this.model.get( 'collapsible_value' );\n            this.field.collapsed = collapsible_value !== undefined && JSON.stringify( this.model.get( 'value' ) ) == JSON.stringify( collapsible_value );\n            this.listenTo( this.model, 'change', this.render, this );\n            this.render();\n\n            // add click handler\n            var self = this;\n            this.$collapsible.on( 'click', function() {\n                self.field.collapsed = !self.field.collapsed;\n                app.trigger && app.trigger( 'change' );\n                self.render();\n            });\n        },\n\n        /** Set backdrop for input element\n        */\n        backdrop: function() {\n            this.model.set( 'backdrop', true );\n        },\n\n        /** Set error text\n        */\n        error: function( text ) {\n            this.model.set( 'error_text', text );\n        },\n\n        /** Reset this view\n        */\n        reset: function() {\n            this.model.set( 'error_text', null );\n        },\n\n        render: function() {\n            // render help\n            $( '.tooltip' ).hide();\n            var help_text = this.model.get( 'help', '' );\n            var help_argument = this.model.get( 'argument' );\n            if ( help_argument && help_text.indexOf( '(' + help_argument + ')' ) == -1 ) {\n                help_text += ' (' + help_argument + ')';\n            }\n            this.$info.html( help_text );\n            // render preview view for collapsed fields\n            this.$preview[ ( this.field.collapsed && this.model.get( 'collapsible_preview' ) || this.model.get( 'disabled' ) ) ? 'show' : 'hide' ]()\n                         .html( _.escape( this.model.get( 'text_value' ) ) );\n            // render error messages\n            var error_text = this.model.get( 'error_text' );\n            this.$error[ error_text ? 'show' : 'hide' ]();\n            this.$el[ error_text ? 'addClass' : 'removeClass' ]( 'ui-error' );\n            this.$error_text.html( error_text );\n            // render backdrop\n            this.$backdrop[ this.model.get( 'backdrop' ) ? 'show' : 'hide' ]();\n            // render input field\n            this.field.collapsed || this.model.get( 'disabled' ) ? this.$field.hide() : this.$field.fadeIn( 'fast' );\n            // render input field color and style\n            this.field.model && this.field.model.set( { 'color': this.model.get( 'color' ), 'style': this.model.get( 'style' ) } );\n            // render collapsible options\n            if ( !this.model.get( 'disabled' ) && this.model.get( 'collapsible_value' ) !== undefined ) {\n                var collapsible_state = this.field.collapsed ? 'enable' : 'disable';\n                this.$title_text.hide();\n                this.$collapsible.show();\n                this.$collapsible_text.text( this.model.get( 'label' ) );\n                this.$collapsible_icon.removeClass().addClass( 'icon' )\n                                      .addClass( this.model.get( 'cls_' +  collapsible_state ) )\n                                      .attr( 'data-original-title', this.model.get( 'text_' + collapsible_state ) )\n                                      .tooltip( { placement: 'bottom' } );\n            } else {\n                this.$title_text.show().text( this.model.get( 'label' ) );\n                this.$collapsible.hide();\n            }\n        },\n\n        _template: function() {\n            return  $( '<div/>' ).addClass( 'ui-form-element' )\n                                 .append( $( '<div/>' ).addClass( 'ui-form-error ui-error' )\n                                    .append( $( '<span/>' ).addClass( 'fa fa-arrow-down' ) )\n                                    .append( $( '<span/>' ).addClass( 'ui-form-error-text' ) )\n                                 )\n                                 .append( $( '<div/>' ).addClass( 'ui-form-title' )\n                                    .append( $( '<div/>' ).addClass( 'ui-form-collapsible' )\n                                        .append( $( '<i/>' ).addClass( 'ui-form-collapsible-icon' ) )\n                                        .append( $( '<span/>' ).addClass( 'ui-form-collapsible-text' ) )\n                                    )\n                                    .append( $( '<span/>' ).addClass( 'ui-form-title-text' ) )\n                                 )\n                                 .append( $( '<div/>' ).addClass( 'ui-form-field' )\n                                    .append( $( '<span/>' ).addClass( 'ui-form-info' ) )\n                                    .append( $( '<div/>' ).addClass( 'ui-form-backdrop' ) )\n                                 )\n                                 .append( $( '<div/>' ).addClass( 'ui-form-preview' ) );\n        }\n    });\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/form/form-input.js\n **/","/**\n    This class creates input elements. New input parameter types should be added to the types dictionary.\n*/\ndefine(['utils/utils',\n        'mvc/ui/ui-misc',\n        'mvc/ui/ui-select-content',\n        'mvc/ui/ui-select-library',\n        'mvc/ui/ui-select-ftp',\n        'mvc/ui/ui-color-picker'],\n    function( Utils, Ui, SelectContent, SelectLibrary, SelectFtp, ColorPicker ) {\n\n    // create form view\n    return Backbone.Model.extend({\n        /** Available parameter types */\n        types: {\n            'text'              : '_fieldText',\n            'select'            : '_fieldSelect',\n            'data_column'       : '_fieldSelect',\n            'genomebuild'       : '_fieldSelect',\n            'data'              : '_fieldData',\n            'data_collection'   : '_fieldData',\n            'integer'           : '_fieldSlider',\n            'float'             : '_fieldSlider',\n            'boolean'           : '_fieldBoolean',\n            'drill_down'        : '_fieldDrilldown',\n            'color'             : '_fieldColor',\n            'hidden'            : '_fieldHidden',\n            'hidden_data'       : '_fieldHidden',\n            'baseurl'           : '_fieldHidden',\n            'library_data'      : '_fieldLibrary',\n            'ftpfile'           : '_fieldFtp'\n        },\n\n        initialize: function( app, options ) {\n            this.app = app;\n        },\n\n        /** Returns an input field for a given field type\n        */\n        create: function( input_def ) {\n            var fieldClass = this.types[ input_def.type ];\n            var field = typeof( this[ fieldClass ] ) === 'function' ? this[ fieldClass ].call( this, input_def ) : null;\n            if ( !field ) {\n                this.app.incompatible = true;\n                field = input_def.options ? this._fieldSelect( input_def ) : this._fieldText( input_def );\n                Galaxy.emit.debug('form-parameters::_addRow()', 'Auto matched field type (' + input_def.type + ').');\n            }\n            input_def.value === undefined && ( input_def.value = null );\n            field.value( input_def.value );\n            return field;\n        },\n\n        /** Data input field\n        */\n        _fieldData: function( input_def ) {\n            var self = this;\n            return new SelectContent.View({\n                id          : 'field-' + input_def.id,\n                extensions  : input_def.extensions,\n                optional    : input_def.optional,\n                multiple    : input_def.multiple,\n                type        : input_def.type,\n                flavor      : input_def.flavor,\n                data        : input_def.options,\n                onchange    : function() {\n                    self.app.trigger( 'change' );\n                }\n            });\n        },\n\n        /** Select/Checkbox/Radio options field\n        */\n        _fieldSelect: function ( input_def ) {\n            // show text field e.g. in workflow editor\n            if( input_def.is_workflow ) {\n                return this._fieldText( input_def );\n            }\n\n            // customize properties\n            if ( input_def.type == 'data_column' ) {\n                input_def.error_text = 'Missing columns in referenced dataset.'\n            }\n\n            // configure options fields\n            var options = [];\n            _.each( input_def.options, function( option ) {\n                options.push( { label: option[ 0 ], value: option[ 1 ] } );\n            });\n\n            // identify display type\n            var SelectClass = Ui.Select;\n            switch ( input_def.display ) {\n                case 'checkboxes':\n                    SelectClass = Ui.Checkbox;\n                    break;\n                case 'radio':\n                    SelectClass = Ui.Radio;\n                    break;\n            }\n\n            // create select field\n            var self = this;\n            return new SelectClass.View({\n                id          : 'field-' + input_def.id,\n                data        : options,\n                error_text  : input_def.error_text || 'No options available',\n                multiple    : input_def.multiple,\n                optional    : input_def.optional,\n                onchange    : function() {\n                    self.app.trigger( 'change' );\n                }\n            });\n        },\n\n        /** Drill down options field\n        */\n        _fieldDrilldown: function ( input_def ) {\n            // show text field e.g. in workflow editor\n            if( input_def.is_workflow ) {\n                return this._fieldText( input_def );\n            }\n\n            // create drill down field\n            var self = this;\n            return new Ui.Drilldown.View({\n                id          : 'field-' + input_def.id,\n                data        : input_def.options,\n                display     : input_def.display,\n                optional    : input_def.optional,\n                onchange    : function() {\n                    self.app.trigger( 'change' );\n                }\n            });\n        },\n\n        /** Text input field\n        */\n        _fieldText: function( input_def ) {\n            // field replaces e.g. a select field\n            if ( input_def.options ) {\n                input_def.area = input_def.multiple;\n                if ( Utils.isEmpty( input_def.value ) ) {\n                    input_def.value = null;\n                } else {\n                    if ( $.isArray( input_def.value ) ) {\n                        var str_value = '';\n                        for ( var i in input_def.value ) {\n                            str_value += String( input_def.value[ i ] );\n                            if ( !input_def.multiple ) {\n                                break;\n                            }\n                            str_value += '\\n';\n                        }\n                        input_def.value = str_value;\n                    }\n                }\n            }\n            // create input element\n            var self = this;\n            return new Ui.Input({\n                id          : 'field-' + input_def.id,\n                area        : input_def.area,\n                onchange    : function( new_value ) {\n                    input_def.onchange ? input_def.onchange( new_value ) : self.app.trigger( 'change' );\n                }\n            });\n        },\n\n        /** Slider field\n        */\n        _fieldSlider: function( input_def ) {\n            var self = this;\n            return new Ui.Slider.View({\n                id          : 'field-' + input_def.id,\n                precise     : input_def.type == 'float',\n                is_workflow : input_def.is_workflow,\n                min         : input_def.min,\n                max         : input_def.max,\n                onchange    : function() {\n                    self.app.trigger( 'change' );\n                }\n            });\n        },\n\n        /** Hidden field\n        */\n        _fieldHidden: function( input_def ) {\n            return new Ui.Hidden({\n                id          : 'field-' + input_def.id,\n                info        : input_def.info\n            });\n        },\n\n        /** Boolean field\n        */\n        _fieldBoolean: function( input_def ) {\n            var self = this;\n            return new Ui.RadioButton.View({\n                id          : 'field-' + input_def.id,\n                data        : [ { label : 'Yes', value : 'true'  },\n                                { label : 'No',  value : 'false' }],\n                onchange    : function() {\n                    self.app.trigger( 'change' );\n                }\n            });\n        },\n\n        /** Color picker field\n        */\n        _fieldColor: function( input_def ) {\n            var self = this;\n            return new ColorPicker({\n                id          : 'field-' + input_def.id,\n                onchange    : function() {\n                    self.app.trigger( 'change' );\n                }\n            });\n        },\n\n        /** Library dataset field\n        */\n        _fieldLibrary: function( input_def ) {\n            var self = this;\n            return new SelectLibrary.View({\n                id          : 'field-' + input_def.id,\n                optional    : input_def.optional,\n                multiple    : input_def.multiple,\n                onchange    : function() {\n                    self.app.trigger( 'change' );\n                }\n            });\n        },\n\n        /** FTP file field\n        */\n        _fieldFtp: function( input_def ) {\n            var self = this;\n            return new SelectFtp.View({\n                id          : 'field-' + input_def.id,\n                optional    : input_def.optional,\n                multiple    : input_def.multiple,\n                onchange    : function() {\n                    self.app.trigger( 'change' );\n                }\n            });\n        }\n    });\n\n    return {\n        View: View\n    };\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/form/form-parameters.js\n **/","// dependencies\ndefine(['utils/utils', 'mvc/ui/ui-table', 'mvc/ui/ui-portlet', 'mvc/ui/ui-misc'],\n        function(Utils, Table, Portlet, Ui) {\n\n/** This class creates a ui component which enables the dynamic creation of portlets\n*/\nvar View = Backbone.View.extend({\n    initialize : function(options) {\n        var self = this;\n        this.options = Utils.merge(options, {\n            title       : 'Section',\n            empty_text  : 'Not available.',\n            max         : null,\n            min         : null\n        });\n        this.setElement('<div/>');\n\n        // create button\n        this.button_new = new Ui.ButtonIcon({\n            icon    : 'fa-plus',\n            title   : 'Insert ' + this.options.title_new,\n            tooltip : 'Add new ' + this.options.title_new + ' block',\n            floating: 'clear',\n            onclick : function() {\n                if (options.onnew) {\n                    options.onnew();\n                }\n            }\n        });\n\n        // create table\n        this.table = new Table.View({\n            cls     : 'ui-table-plain',\n            content : ''\n        });\n        this.$el.append(this.table.$el);\n        this.$el.append($('<div/>').append(this.button_new.$el));\n\n        // reset list\n        this.list = {};\n        this.n = 0;\n    },\n\n    /** Number of repeat blocks\n    */\n    size: function() {\n        return this.n;\n    },\n\n    /** Add new repeat block\n    */\n    add: function(options) {\n        if (!options.id || this.list[options.id]) {\n            Galaxy.emit.debug('form-repeat::add()', 'Duplicate repeat block id.');\n            return;\n        }\n        this.n++;\n        var button_delete = new Ui.ButtonIcon({\n            icon    : 'fa-trash-o',\n            tooltip : 'Delete this repeat block',\n            cls     : 'ui-button-icon-plain',\n            onclick : function() {\n                if (options.ondel) {\n                    options.ondel();\n                }\n            }\n        });\n        var portlet = new Portlet.View({\n            id              : options.id,\n            title           : 'placeholder',\n            cls             : 'ui-portlet-repeat',\n            operations      : {\n                button_delete : button_delete\n            }\n        });\n        portlet.append(options.$el);\n        portlet.$el.addClass('section-row');\n        this.list[options.id] = portlet;\n        this.table.add(portlet.$el);\n        this.table.append('row_' + options.id, true);\n        if (this.options.max > 0 && this.n >= this.options.max) {\n            this.button_new.disable();\n        }\n        this._refresh();\n    },\n\n    /** Delete repeat block\n    */\n    del: function(id) {\n        if (!this.list[id]) {\n            Galaxy.emit.debug('form-repeat::del()', 'Invalid repeat block id.');\n            return;\n        }\n        this.n--;\n        var table_row = this.table.get('row_' + id);\n        table_row.remove();\n        delete this.list[id];\n        this.button_new.enable();\n        this._refresh();\n    },\n\n    /** Hides add/del options\n    */\n    hideOptions: function() {\n        this.button_new.$el.hide();\n        _.each( this.list, function( portlet ) {\n            portlet.hideOperation('button_delete');\n        });\n        if( _.isEmpty( this.list ) ) {\n            this.$el.append( $('<div/>').addClass( 'ui-form-info' ).html( this.options.empty_text ) );\n        }\n    },\n\n    /** Refresh view\n    */\n    _refresh: function() {\n        var index = 0;\n        for (var id in this.list) {\n            var portlet = this.list[id];\n            portlet.title(++index + ': ' + this.options.title);\n            if (this.n > this.options.min) {\n                portlet.showOperation('button_delete');\n            } else {\n                portlet.hideOperation('button_delete');\n            }\n        }\n    }\n});\n\nreturn {\n    View : View\n}\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/form/form-repeat.js\n **/","/**\n    This class creates a form section and populates it with input elements. It also handles repeat blocks and conditionals by recursively creating new sub sections.\n*/\ndefine(['utils/utils',\n        'mvc/ui/ui-table',\n        'mvc/ui/ui-misc',\n        'mvc/ui/ui-portlet',\n        'mvc/form/form-repeat',\n        'mvc/form/form-input',\n        'mvc/form/form-parameters'],\n    function(Utils, Table, Ui, Portlet, Repeat, InputElement, Parameters) {\n    var View = Backbone.View.extend({\n        initialize: function(app, options) {\n            this.app = app;\n            this.inputs = options.inputs;\n\n            // fix table style\n            options.cls = 'ui-table-plain';\n\n            // add table class for tr tag\n            // this assist in transforming the form into a json structure\n            options.cls_tr = 'section-row';\n\n            // create/render views\n            this.table = new Table.View(options);\n            this.parameters = new Parameters(app, options);\n            this.setElement(this.table.$el);\n            this.render();\n        },\n\n        /** Render section view\n        */\n        render: function() {\n            this.table.delAll();\n            for (var i in this.inputs) {\n                this.add(this.inputs[i]);\n            }\n        },\n\n        /** Add a new input element\n        */\n        add: function(input) {\n            var self = this;\n            var input_def = jQuery.extend(true, {}, input);\n            input_def.id = input.id = Utils.uid();\n\n            // add to sequential list of inputs\n            this.app.input_list[input_def.id] = input_def;\n\n            // identify field type\n            var type = input_def.type;\n            switch(type) {\n                case 'conditional':\n                    this._addConditional(input_def);\n                    break;\n                case 'repeat':\n                    this._addRepeat(input_def);\n                    break;\n                case 'section':\n                    this._addSection(input_def);\n                    break;\n                default:\n                    this._addRow(input_def);\n            }\n        },\n\n        /** Add a conditional block\n        */\n        _addConditional: function(input_def) {\n            var self = this;\n            input_def.test_param.id = input_def.id;\n            this.app.options.sustain_conditionals && ( input_def.test_param.disabled = true );\n            var field = this._addRow( input_def.test_param );\n\n            // set onchange event for test parameter\n            field.model && field.model.set( 'onchange', function( value ) {\n                var selectedCase = self.app.data.matchCase(input_def, value);\n                for (var i in input_def.cases) {\n                    var case_def = input_def.cases[i];\n                    var section_id = input_def.id + '-section-' + i;\n                    var section_row = self.table.get(section_id);\n                    var nonhidden = false;\n                    for (var j in case_def.inputs) {\n                        if (!case_def.inputs[j].hidden) {\n                            nonhidden = true;\n                            break;\n                        }\n                    }\n                    if (i == selectedCase && nonhidden) {\n                        section_row.fadeIn('fast');\n                    } else {\n                        section_row.hide();\n                    }\n                }\n                self.app.trigger('change');\n            });\n\n            // add conditional sub sections\n            for (var i in input_def.cases) {\n                var sub_section_id = input_def.id + '-section-' + i;\n                var sub_section = new View(this.app, {\n                    inputs  : input_def.cases[i].inputs\n                });\n                sub_section.$el.addClass('ui-table-section');\n                this.table.add(sub_section.$el);\n                this.table.append(sub_section_id);\n            }\n\n            // trigger refresh on conditional input field after all input elements have been created\n            field.trigger('change');\n        },\n\n        /** Add a repeat block\n        */\n        _addRepeat: function(input_def) {\n            var self = this;\n            var block_index = 0;\n\n            // create repeat block element\n            var repeat = new Repeat.View({\n                title           : input_def.title || 'Repeat',\n                title_new       : input_def.title || '',\n                min             : input_def.min,\n                max             : input_def.max,\n                onnew           : function() {\n                    create(input_def.inputs);\n                    self.app.trigger('change');\n                }\n            });\n\n            // helper function to create new repeat blocks\n            function create (inputs) {\n                var sub_section_id = input_def.id + '-section-' + (block_index++);\n                var sub_section = new View(self.app, {\n                    inputs  : inputs\n                });\n                repeat.add({\n                    id      : sub_section_id,\n                    $el     : sub_section.$el,\n                    ondel   : function() {\n                        repeat.del(sub_section_id);\n                        self.app.trigger('change');\n                    }\n                });\n            }\n\n            //\n            // add parsed/minimum number of repeat blocks\n            //\n            var n_cache = _.size( input_def.cache );\n            for ( var i = 0; i < Math.max( Math.max( n_cache, input_def.min ), input_def.default ); i++ ) {\n                create( i < n_cache ? input_def.cache[ i ] : input_def.inputs );\n            }\n\n            // hide options\n            this.app.options.sustain_repeats && repeat.hideOptions();\n\n            // create input field wrapper\n            var input_element = new InputElement(this.app, {\n                label   : input_def.title || input_def.name,\n                help    : input_def.help,\n                field   : repeat\n            });\n            this.table.add(input_element.$el);\n            this.table.append(input_def.id);\n        },\n\n        /** Add a customized section\n        */\n        _addSection: function(input_def) {\n            var portlet = new Portlet.View({\n                title               : input_def.title || input_def.name,\n                cls                 : 'ui-portlet-section',\n                collapsible         : true,\n                collapsible_button  : true,\n                collapsed           : !input_def.expanded\n            });\n            portlet.append( new View( this.app, { inputs: input_def.inputs } ).$el );\n            portlet.append( $( '<div/>' ).addClass( 'ui-form-info' ).html( input_def.help ) );\n            this.app.on( 'expand', function( input_id ) {\n                ( portlet.$( '#' + input_id ).length > 0 ) && portlet.expand();\n            });\n            this.table.add( portlet.$el );\n            this.table.append( input_def.id );\n        },\n\n        /** Add a single input field element\n        */\n        _addRow: function(input_def) {\n            var id = input_def.id;\n            var field = this.parameters.create(input_def);\n            this.app.field_list[id] = field;\n            var input_element = new InputElement(this.app, {\n                name                : input_def.name,\n                label               : input_def.label || input_def.name,\n                value               : input_def.value,\n                text_value          : input_def.text_value,\n                collapsible_value   : input_def.collapsible_value,\n                collapsible_preview : input_def.collapsible_preview,\n                help                : input_def.help,\n                argument            : input_def.argument,\n                disabled            : input_def.disabled,\n                color               : input_def.color,\n                style               : input_def.style,\n                backdrop            : input_def.backdrop,\n                field               : field\n            });\n            this.app.element_list[id] = input_element;\n            this.table.add(input_element.$el);\n            this.table.append(id);\n            input_def.hidden && this.table.get(id).hide();\n            return field;\n        }\n    });\n\n    return {\n        View: View\n    };\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/form/form-section.js\n **/","/**\n    This is the main class of the form plugin. It is referenced as 'app' in all lower level modules.\n*/\ndefine(['utils/utils', 'mvc/ui/ui-portlet', 'mvc/ui/ui-misc', 'mvc/form/form-section', 'mvc/form/form-data'],\n    function(Utils, Portlet, Ui, FormSection, FormData) {\n    return Backbone.View.extend({\n        initialize: function(options) {\n            this.options = Utils.merge(options, {\n                initial_errors  : false,\n                cls             : 'ui-portlet-limited',\n                icon            : null\n            });\n            this.setElement('<div/>');\n            this.render();\n        },\n\n        /** Update available options */\n        update: function(new_model){\n            var self = this;\n            this.data.matchModel(new_model, function(node, input_id) {\n                var input = self.input_list[input_id];\n                if (input && input.options) {\n                    if (!_.isEqual(input.options, node.options)) {\n                        // backup new options\n                        input.options = node.options;\n\n                        // get/update field\n                        var field = self.field_list[input_id];\n                        if (field.update) {\n                            var new_options = [];\n                            if ((['data', 'data_collection', 'drill_down']).indexOf(input.type) != -1) {\n                                new_options = input.options;\n                            } else {\n                                for (var i in node.options) {\n                                    var opt = node.options[i];\n                                    if (opt.length > 2) {\n                                        new_options.push({\n                                            'label': opt[0],\n                                            'value': opt[1]\n                                        });\n                                    }\n                                }\n                            }\n                            field.update(new_options);\n                            field.trigger('change');\n                            Galaxy.emit.debug('form-view::update()', 'Updating options for ' + input_id);\n                        }\n                    }\n                }\n            });\n        },\n\n        /** Set form into wait mode */\n        wait: function(active) {\n            for (var i in this.input_list) {\n                var field = this.field_list[i];\n                var input = this.input_list[i];\n                if (input.is_dynamic && field.wait && field.unwait) {\n                    if (active) {\n                        field.wait();\n                    } else {\n                        field.unwait();\n                    }\n                }\n            }\n        },\n\n        /** Highlight and scroll to input element (currently only used for error notifications)\n        */\n        highlight: function (input_id, message, silent) {\n            var input_element = this.element_list[input_id];\n            if (input_element) {\n                input_element.error(message || 'Please verify this parameter.');\n                this.portlet.expand();\n                this.trigger('expand', input_id);\n                if (!silent) {\n                    if (self==top) {\n                        var $panel = this.$el.parents().filter(function() {\n                            return $(this).css('overflow') == 'auto';\n                        }).first();\n                        $panel.animate({ scrollTop : $panel.scrollTop() + input_element.$el.offset().top - 50 }, 500);\n                    } else {\n                        $('html, body').animate({ scrollTop : input_element.$el.offset().top - 20 }, 500);\n                    }\n                }\n            }\n        },\n\n        /** Highlights errors\n        */\n        errors: function(options) {\n            this.trigger('reset');\n            if (options && options.errors) {\n                var error_messages = this.data.matchResponse(options.errors);\n                for (var input_id in this.element_list) {\n                    var input = this.element_list[input_id];\n                    if (error_messages[input_id]) {\n                        this.highlight(input_id, error_messages[input_id], true);\n                    }\n                }\n            }\n        },\n\n        /** Render tool form\n        */\n        render: function() {\n            // link this\n            var self = this;\n\n            // reset events\n            this.off('change');\n            this.off('reset');\n\n            // reset field list, which contains the input field elements\n            this.field_list = {};\n\n            // reset sequential input definition list, which contains the input definitions as provided from the api\n            this.input_list = {};\n\n            // reset input element list, which contains the dom elements of each input element (includes also the input field)\n            this.element_list = {};\n\n            // creates a json data structure from the input form\n            this.data = new FormData.Manager(this);\n\n            // create ui elements\n            this._renderForm();\n\n            // refresh data\n            this.data.create();\n\n            // show errors on startup\n            if (this.options.initial_errors) {\n                this.errors(this.options);\n            }\n\n            // add listener which triggers on checksum change\n            var current_check = this.data.checksum();\n            this.on('change', function( force ) {\n                var new_check = self.data.checksum();\n                if (new_check != current_check || force ) {\n                    current_check = new_check;\n                    self.options.onchange && self.options.onchange();\n                }\n            });\n\n            // add reset listener\n            this.on('reset', function() {\n                for (var i in this.element_list) {\n                    this.element_list[i].reset();\n                }\n            });\n            return this;\n        },\n\n        /** Renders the UI elements required for the form\n        */\n        _renderForm: function() {\n            // create message view\n            this.message = new Ui.Message();\n\n            // create tool form section\n            this.section = new FormSection.View(this, {\n                inputs : this.options.inputs\n            });\n\n            // remove tooltips\n            $( '.tooltip' ).remove();\n\n            // create portlet\n            this.portlet = new Portlet.View({\n                icon        : this.options.icon,\n                title       : this.options.title,\n                cls         : this.options.cls,\n                operations  : this.options.operations,\n                buttons     : this.options.buttons,\n                collapsible : this.options.collapsible,\n                collapsed   : this.options.collapsed\n            });\n\n            // append message\n            this.portlet.append(this.message.$el);\n\n            // append tool section\n            this.portlet.append(this.section.$el);\n\n            // start form\n            this.$el.empty();\n            this.$el.append(this.portlet.$el);\n\n            // show message if available in model\n            if (this.options.message) {\n                this.message.update({\n                    persistent  : true,\n                    status      : 'warning',\n                    message     : this.options.message\n                });\n            }\n\n            // log\n            Galaxy.emit.debug('form-view::initialize()', 'Completed');\n        }\n    });\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/form/form-view.js\n **/","define([\n    \"mvc/collection/collection-model\",\n    \"mvc/history/history-content-model\",\n    \"utils/localization\"\n], function( DC_MODEL, HISTORY_CONTENT, _l ){\n\n'use strict';\n\n/*==============================================================================\n\nModels for DatasetCollections contained within a history.\n\nTODO:\n    these might be compactable to one class if some duplication with\n    collection-model is used.\n\n==============================================================================*/\nvar hcontentMixin = HISTORY_CONTENT.HistoryContentMixin,\n    ListDC = DC_MODEL.ListDatasetCollection,\n    PairDC = DC_MODEL.PairDatasetCollection,\n    ListPairedDC = DC_MODEL.ListPairedDatasetCollection;\n\n//==============================================================================\n/** Override to post to contents route w/o id. */\nfunction buildHDCASave( _super ){\n    return function _save( attributes, options ){\n        if( this.isNew() ){\n            options = options || {};\n            options.url = this.urlRoot + this.get( 'history_id' ) + '/contents';\n            attributes = attributes || {};\n            attributes.type = 'dataset_collection';\n        }\n        return _super.call( this, attributes, options );\n    };\n}\n\n\n//==============================================================================\n/** @class Backbone model for List Dataset Collection within a History.\n */\nvar HistoryListDatasetCollection = ListDC.extend( hcontentMixin ).extend(\n/** @lends HistoryListDatasetCollection.prototype */{\n\n    defaults : _.extend( _.clone( ListDC.prototype.defaults ), {\n        history_content_type: 'dataset_collection',\n        collection_type     : 'list',\n        model_class         : 'HistoryDatasetCollectionAssociation'\n    }),\n\n    initialize : function( model, options ){\n        ListDC.prototype.initialize.call( this, model, options );\n        hcontentMixin.initialize.call( this, model, options );\n    },\n\n    /** Override to post to contents route w/o id. */\n    save : buildHDCASave( ListDC.prototype.save ),\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'HistoryListDatasetCollection(', this.get( 'name' ), ')' ].join( '' ));\n    }\n});\n\n\n//==============================================================================\n/** @class Backbone model for Pair Dataset Collection within a History.\n *  @constructs\n */\nvar HistoryPairDatasetCollection = PairDC.extend( hcontentMixin ).extend(\n/** @lends HistoryPairDatasetCollection.prototype */{\n\n    defaults : _.extend( _.clone( PairDC.prototype.defaults ), {\n        history_content_type: 'dataset_collection',\n        collection_type     : 'paired',\n        model_class         : 'HistoryDatasetCollectionAssociation'\n    }),\n\n    initialize : function( model, options ){\n        PairDC.prototype.initialize.call( this, model, options );\n        hcontentMixin.initialize.call( this, model, options );\n    },\n\n    /** Override to post to contents route w/o id. */\n    save : buildHDCASave( PairDC.prototype.save ),\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'HistoryPairDatasetCollection(', this.get( 'name' ), ')' ].join( '' ));\n    }\n});\n\n\n//==============================================================================\n/** @class Backbone model for List of Pairs Dataset Collection within a History.\n *  @constructs\n */\nvar HistoryListPairedDatasetCollection = ListPairedDC.extend( hcontentMixin ).extend(\n/** @lends HistoryListPairedDatasetCollection.prototype */{\n\n    defaults : _.extend( _.clone( ListPairedDC.prototype.defaults ), {\n        history_content_type: 'dataset_collection',\n        collection_type     : 'list:paired',\n        model_class         : 'HistoryDatasetCollectionAssociation'\n    }),\n\n    initialize : function( model, options ){\n        ListPairedDC.prototype.initialize.call( this, model, options );\n        hcontentMixin.initialize.call( this, model, options );\n    },\n\n    /** Override to post to contents route w/o id. */\n    save : buildHDCASave( ListPairedDC.prototype.save ),\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'HistoryListPairedDatasetCollection(', this.get( 'name' ), ')' ].join( '' ));\n    }\n});\n\n\n//==============================================================================\n    return {\n        HistoryListDatasetCollection        : HistoryListDatasetCollection,\n        HistoryPairDatasetCollection        : HistoryPairDatasetCollection,\n        HistoryListPairedDatasetCollection  : HistoryListPairedDatasetCollection\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/history/hdca-model.js\n **/","define([\n    \"mvc/dataset/states\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( STATES, BASE_MVC, _l ){\n\n'use strict';\n\nvar logNamespace = 'history';\n//==============================================================================\n/** How the type_id attribute is built for the history's mixed contents collection */\nvar typeIdStr = function _typeIdStr( type, id ){\n    return [ type, id ].join( '-' );\n};\n\n//==============================================================================\n/** @class Mixin for HistoryContents content (HDAs, HDCAs).\n */\nvar HistoryContentMixin = {\n//TODO:?? into true Backbone.Model?\n\n    /** default attributes for a model */\n    defaults : {\n        /** parent (containing) history */\n        history_id          : null,\n        /** some content_type (HistoryContents can contain mixed model classes) */\n        history_content_type: null,\n        /** indicating when/what order the content was generated in the context of the history */\n        hid                 : null,\n        /** whether the user wants the content shown (visible) */\n        visible             : true\n    },\n\n    // ........................................................................ mixed content element\n//TODO: there's got to be a way to move this into HistoryContents - if we can do that, this class might not be needed\n    // In order to be part of a MIXED bbone collection, we can't rely on the id\n    //  (which may collide btwn models of different classes)\n    // Build a new id (type_id) that prefixes the history_content_type so the bbone collection can differentiate\n    idAttribute : 'type_id',\n\n    /** override constructor to build type_id and insert into original attributes */\n    constructor : function( attrs, options ){\n        attrs.type_id = typeIdStr( attrs.history_content_type, attrs.id );\n        this.debug( 'HistoryContentMixin.constructor:', attrs.type_id );\n        Backbone.Model.apply( this, arguments );\n    },\n\n    /** object level fn for building the type_id string */\n    _typeIdStr : function(){\n        return typeIdStr( this.get( 'history_content_type' ), this.get( 'id' ) );\n    },\n\n    /** add listener to re-create type_id when the id changes */\n    initialize : function( attrs, options ){\n        this.on( 'change:id', this._createTypeId );\n    },\n\n    /** set the type_id in the model attributes */\n    _createTypeId : function(){\n        this.set( 'type_id', this._typeIdStr() );\n    },\n\n    /** override because backbone tests boolean( idAttribute ), but it's not an empty string even for new models\n     *  due to our use of type_id.\n     */\n    isNew : function(){\n        return !this.get( 'id' );\n    },\n\n    // ........................................................................ common queries\n    /** the more common alias of visible */\n    hidden : function(){\n        return !this.get( 'visible' );\n    },\n\n    /** based on show_deleted, show_hidden (gen. from the container control),\n     *      would this ds show in the list of ds's?\n     *  @param {Boolean} show_deleted are we showing deleted hdas?\n     *  @param {Boolean} show_hidden are we showing hidden hdas?\n     */\n    isVisible : function( show_deleted, show_hidden ){\n//TODO:?? Another unfortunate name collision\n        var isVisible = true;\n        if( ( !show_deleted )\n        &&  ( this.get( 'deleted' ) || this.get( 'purged' ) ) ){\n            isVisible = false;\n        }\n        if( ( !show_hidden )\n        &&  ( !this.get( 'visible' ) ) ){\n            isVisible = false;\n        }\n        return isVisible;\n    },\n\n    // ........................................................................ ajax\n//TODO: global\n//TODO: these are probably better done on the leaf classes\n    /** history content goes through the 'api/histories' API */\n    urlRoot: Galaxy.root + 'api/histories/',\n\n    /** full url spec. for this content */\n    url : function(){\n        var url = this.urlRoot + this.get( 'history_id' ) + '/contents/'\n             + this.get('history_content_type') + 's/' + this.get( 'id' );\n        return url;\n    },\n\n    /** save this content as not visible */\n    hide : function( options ){\n        if( !this.get( 'visible' ) ){ return jQuery.when(); }\n        return this.save( { visible: false }, options );\n    },\n    /** save this content as visible */\n    unhide : function( options ){\n        if( this.get( 'visible' ) ){ return jQuery.when(); }\n        return this.save( { visible: true }, options );\n    },\n\n    // ........................................................................ misc\n    /** String representation */\n    toString : function(){\n        var nameAndId = this.get( 'id' ) || '';\n        if( this.get( 'name' ) ){\n            nameAndId = this.get( 'hid' ) + ' :\"' + this.get( 'name' ) + '\",' + nameAndId;\n        }\n        return 'HistoryContent(' + nameAndId + ')';\n    }\n};\n\n\n//==============================================================================\n//TODO: needed?\n/** @class (Concrete/non-mixin) base model for content items.\n */\nvar HistoryContent = Backbone.Model\n        .extend( BASE_MVC.LoggableMixin )\n        .extend( HistoryContentMixin )\n        .extend({ _logNamespace : logNamespace });\n\n\n//==============================================================================\n    return {\n        typeIdStr           : typeIdStr,\n        HistoryContentMixin : HistoryContentMixin,\n        HistoryContent      : HistoryContent\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/history/history-content-model.js\n **/","define([\n    \"mvc/history/history-content-model\",\n    \"mvc/history/hda-model\",\n    \"mvc/history/hdca-model\",\n    \"mvc/dataset/states\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( HISTORY_CONTENT, HDA_MODEL, HDCA_MODEL, STATES, BASE_MVC, _l ){\n\n'use strict';\n\nvar logNamespace = 'history';\n//==============================================================================\n/** @class Backbone collection for history content.\n *      NOTE: history content seems like a dataset collection, but differs in that it is mixed:\n *          each element can be either an HDA (dataset) or a DatasetCollection and co-exist on\n *          the same level.\n *      Dataset collections on the other hand are not mixed and (so far) can only contain either\n *          HDAs or child dataset collections on one level.\n *      This is why this does not inherit from any of the DatasetCollections (currently).\n */\nvar HistoryContents = Backbone.Collection\n        .extend( BASE_MVC.LoggableMixin )\n        .extend(/** @lends HistoryContents.prototype */{\n//TODO:?? may want to inherit from some MixedModelCollection\n//TODO:?? also consider inheriting from a 'DatasetList'\n//TODO: can we decorate the mixed models using the model fn below (instead of having them build their own type_id)?\n\n    _logNamespace : logNamespace,\n\n    /** since history content is a mix, override model fn into a factory, creating based on history_content_type */\n    model : function( attrs, options ) {\n//TODO: can we move the type_id stuff here?\n        //attrs.type_id = typeIdStr( attrs );\n\n        if( attrs.history_content_type === \"dataset\" ) {\n            return new HDA_MODEL.HistoryDatasetAssociation( attrs, options );\n\n        } else if( attrs.history_content_type === \"dataset_collection\" ) {\n            switch( attrs.collection_type ){\n                case 'list':\n                    return new HDCA_MODEL.HistoryListDatasetCollection( attrs, options );\n                case 'paired':\n                    return new HDCA_MODEL.HistoryPairDatasetCollection( attrs, options );\n                case 'list:paired':\n                    return new HDCA_MODEL.HistoryListPairedDatasetCollection( attrs, options );\n            }\n            // This is a hack inside a hack:\n            // Raise a plain object with validationError to fake a model.validationError\n            // (since we don't have a model to use validate with)\n            // (the outer hack being the mixed content/model function in this collection)\n            return { validationError : 'Unknown collection_type: ' + attrs.history_content_type };\n        }\n        return { validationError : 'Unknown history_content_type: ' + attrs.history_content_type };\n    },\n\n    /** Set up.\n     *  @see Backbone.Collection#initialize\n     */\n    initialize : function( models, options ){\n        options = options || {};\n//TODO: could probably use the contents.history_id instead\n        this.historyId = options.historyId;\n        //this._setUpListeners();\n\n        // backbonejs uses collection.model.prototype.idAttribute to determine if a model is *already* in a collection\n        //  and either merged or replaced. In this case, our 'model' is a function so we need to add idAttribute\n        //  manually here - if we don't, contents will not merge but be replaced/swapped.\n        this.model.prototype.idAttribute = 'type_id';\n\n        this.on( 'all', function(){\n            this.debug( this + '.event:', arguments );\n        });\n    },\n\n    /** root api url */\n    urlRoot : Galaxy.root + 'api/histories',\n    /** complete api url */\n    url : function(){\n        return this.urlRoot + '/' + this.historyId + '/contents';\n    },\n\n    // ........................................................................ common queries\n    /** Get the ids of every item in this collection\n     *  @returns array of encoded ids\n     */\n    ids : function(){\n//TODO: is this still useful since type_id\n        return this.map( function( item ){ return item.get('id'); });\n    },\n\n    /** Get contents that are not ready\n     *  @returns array of content models\n     */\n    notReady : function(){\n        return this.filter( function( content ){\n            return !content.inReadyState();\n        });\n    },\n\n    /** Get the id of every model in this collection not in a 'ready' state (running).\n     *  @returns an array of model ids\n     *  @see HistoryDatasetAssociation#inReadyState\n     */\n    running : function(){\n        function filterFn( c ){ return !c.inReadyState(); }\n        return new HistoryContents( this.filter( filterFn ) );\n    },\n\n    /** Get the model with the given hid\n     *  @param {Int} hid the hid to search for\n     *  @returns {HistoryDatasetAssociation} the model with the given hid or undefined if not found\n     */\n    getByHid : function( hid ){\n        return _.first( this.filter( function( content ){ return content.get( 'hid' ) === hid; }) );\n    },\n\n    //TODO:?? this may belong in the containing view\n    /** Get every 'shown' model in this collection based on show_deleted/hidden\n     *  @param {Boolean} show_deleted are we showing deleted content?\n     *  @param {Boolean} show_hidden are we showing hidden content?\n     *  @returns array of content models\n     *  @see HistoryDatasetAssociation#isVisible\n     */\n    getVisible : function( show_deleted, show_hidden, filters ){\n        filters = filters || [];\n        //this.debug( 'filters:', filters );\n        // always filter by show deleted/hidden first\n        this.debug( 'checking isVisible' );\n        var filteredHdas = new HistoryContents( this.filter( function( item ){\n            return item.isVisible( show_deleted, show_hidden );\n        }));\n\n        _.each( filters, function( filterFn ){\n            if( !_.isFunction( filterFn ) ){ return; }\n            filteredHdas = new HistoryContents( filteredHdas.filter( filterFn ) );\n        });\n        return filteredHdas;\n    },\n\n    /** return a new contents collection of only hidden items */\n    hidden : function(){\n        function filterFn( c ){ return c.hidden(); }\n        return new HistoryContents( this.filter( filterFn ) );\n    },\n\n    /** return a new contents collection of only hidden items */\n    deleted : function(){\n        function filterFn( c ){ return c.get( 'deleted' ); }\n        return new HistoryContents( this.filter( filterFn ) );\n    },\n\n    /** return a new contents collection of only hidden items */\n    visibleAndUndeleted : function(){\n        function filterFn( c ){ return c.get( 'visible' ) && !c.get( 'deleted' ); }\n        return new HistoryContents( this.filter( filterFn ) );\n    },\n\n    /** return true if any contents don't have details */\n    haveDetails : function(){\n        return this.all( function( content ){ return content.hasDetails(); });\n    },\n\n    // ........................................................................ ajax\n    /** override to use newest (versioned) api */\n    fetch : function( options ){\n        options = options || {};\n        options.data = _.defaults( options.data || {}, {\n            v : 'dev'\n        });\n        return Backbone.Collection.prototype.fetch.call( this, options );\n    },\n\n    /** override to use newest (versioned) api */\n    fetchUpdated : function( since, options ){\n        options = options || {};\n        options.traditional = true;\n        // TODO: this is painful - simplify here or move q/qv to named/mappable params\n        options.data = [{ name: 'v', value: 'dev' }];\n        if( since ){\n            options.data = options.data.concat( this._filtersFromMap({\n                'update_time-ge' : since.toISOString(),\n            }));\n        }\n        options.merge = true;\n        options.remove = false;\n        return this.fetch( options );\n    },\n\n    _filtersFromMap : function( filterMap ){\n        var filters = [];\n        // TODO: this seems unnecessary\n        _.each( filterMap, function( val, key ){\n            filters.push({ name: 'q',  value: key });\n            filters.push({ name: 'qv', value: val });\n        });\n        return filters;\n    },\n\n    /** fetch detailed model data for all contents in this collection */\n    fetchAllDetails : function( options ){\n        options = options || {};\n        var detailsFlag = { details: 'all' };\n        options.data = ( options.data )?( _.extend( options.data, detailsFlag ) ):( detailsFlag );\n        return this.fetch( options );\n    },\n\n    /** specialty fetch method for retrieving the element_counts of all hdcas in the history */\n    fetchCollectionCounts : function( options ){\n        options = options || {};\n        options.data = _.defaults({\n            keys : [ 'type_id', 'element_count' ].join( ',' ),\n            q    : 'history_content_type',\n            qv   : 'dataset_collection',\n        }, options.data || {} );\n        options.merge = true;\n        options.remove = false;\n        return this.fetch( options );\n    },\n\n    /** using a queue, perform ajaxFn on each of the models in this collection */\n    ajaxQueue : function( ajaxFn, options ){\n        var deferred = jQuery.Deferred(),\n            startingLength = this.length,\n            responses = [];\n\n        if( !startingLength ){\n            deferred.resolve([]);\n            return deferred;\n        }\n\n        // use reverse order (stylistic choice)\n        var ajaxFns = this.chain().reverse().map( function( content, i ){\n            return function(){\n                var xhr = ajaxFn.call( content, options );\n                // if successful, notify using the deferred to allow tracking progress\n                xhr.done( function( response ){\n                    deferred.notify({ curr: i, total: startingLength, response: response, model: content });\n                });\n                // (regardless of previous error or success) if not last ajax call, shift and call the next\n                //  if last fn, resolve deferred\n                xhr.always( function( response ){\n                    responses.push( response );\n                    if( ajaxFns.length ){\n                        ajaxFns.shift()();\n                    } else {\n                        deferred.resolve( responses );\n                    }\n                });\n            };\n        }).value();\n        // start the queue\n        ajaxFns.shift()();\n\n        return deferred;\n    },\n\n    isCopyable : function( contentsJSON ){\n        var copyableModelClasses = [\n            'HistoryDatasetAssociation',\n            'HistoryDatasetCollectionAssociation'\n        ];\n        return ( ( _.isObject( contentsJSON ) && contentsJSON.id )\n              && ( _.contains( copyableModelClasses, contentsJSON.model_class ) ) );\n    },\n\n    /** copy an existing, accessible hda into this collection */\n    copy : function( json ){\n        var id, type, contentType;\n        if( _.isString( json ) ){\n            id = json;\n            contentType = 'hda';\n            type = 'dataset';\n        } else {\n            id = json.id;\n            contentType = ({\n                'HistoryDatasetAssociation' : 'hda',\n                'LibraryDatasetDatasetAssociation' : 'ldda',\n                'HistoryDatasetCollectionAssociation' : 'hdca'\n            })[ json.model_class ] || 'hda';\n            type = ( contentType === 'hdca'? 'dataset_collection' : 'dataset' );\n        }\n        var collection = this,\n            xhr = jQuery.post( this.url(), {\n                content : id,\n                source  : contentType,\n                type    : type\n            })\n            .done( function( response ){\n                collection.add([ response ]);\n            })\n            .fail( function( error, status, message ){\n                collection.trigger( 'error', collection, xhr, {},\n                    'Error copying contents', { type: type, id: id, source: contentType });\n            });\n        return xhr;\n    },\n\n    // ........................................................................ sorting/filtering\n    /** return a new collection of contents whose attributes contain the substring matchesWhat */\n    matches : function( matchesWhat ){\n        return this.filter( function( content ){\n            return content.matches( matchesWhat );\n        });\n    },\n\n    // ........................................................................ misc\n    /** */\n    createHDCA : function( elementIdentifiers, collectionType, name, options ){\n        //precondition: elementIdentifiers is an array of plain js objects\n        //  in the proper form to create the collectionType\n        var contents = this,\n            typeToModel = {\n                list    : HDCA_MODEL.HistoryListDatasetCollection,\n                paired  : HDCA_MODEL.HistoryPairDatasetCollection\n            },\n            hdca = new (typeToModel[ collectionType ])({\n                history_id          : this.historyId,\n                name                : name,\n                // should probably be able to just send in a bunch of json here and restruct per class\n                element_identifiers : elementIdentifiers\n            });\n        // do I even need to use new above, can I just pass the attrs here\n        return hdca.save()\n            .done( function( response ){\n                contents.add( hdca );\n            })\n            .fail( function( xhr, status, message ){\n                contents.trigger( 'error', xhr, status, message );\n            });\n    },\n\n    /** In this override, copy the historyId to the clone */\n    clone : function(){\n        var clone = Backbone.Collection.prototype.clone.call( this );\n        clone.historyId = this.historyId;\n        return clone;\n    },\n\n    /** debugging */\n    print : function(){\n        var contents = this;\n        contents.each( function( c ){\n            contents.debug( c );\n            if( c.elements ){\n                contents.debug( '\\t elements:', c.elements );\n            }\n        });\n    },\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'HistoryContents(', [ this.historyId, this.length ].join(), ')' ].join( '' ));\n    }\n});\n\n\n//==============================================================================\n    return {\n        HistoryContents : HistoryContents\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/history/history-contents.js\n **/","define([\n    'mvc/base-mvc',\n    'utils/localization'\n], function( BASE_MVC, _l ){\n\n'use strict';\n\nvar logNamespace = 'list';\n//==============================================================================\n/** A view which, when first rendered, shows only summary data/attributes, but\n *      can be expanded to show further details (and optionally fetch those\n *      details from the server).\n */\nvar ExpandableView = Backbone.View.extend( BASE_MVC.LoggableMixin ).extend({\n    _logNamespace : logNamespace,\n\n//TODO: Although the reasoning behind them is different, this shares a lot with HiddenUntilActivated above: combine them\n    //PRECONDITION: model must have method hasDetails\n    //PRECONDITION: subclasses must have templates.el and templates.details\n\n    initialize : function( attributes ){\n        /** are the details of this view expanded/shown or not? */\n        this.expanded   = attributes.expanded || false;\n        this.log( '\\t expanded:', this.expanded );\n        this.fxSpeed = attributes.fxSpeed !== undefined? attributes.fxSpeed : this.fxSpeed;\n    },\n\n    // ........................................................................ render main\n    /** jq fx speed */\n    fxSpeed : 'fast',\n\n    /** Render this content, set up ui.\n     *  @param {Number or String} speed   the speed of the render\n     */\n    render : function( speed ){\n        var $newRender = this._buildNewRender();\n        this._setUpBehaviors( $newRender );\n        this._queueNewRender( $newRender, speed );\n        return this;\n    },\n\n    /** Build a temp div containing the new children for the view's $el.\n     *      If the view is already expanded, build the details as well.\n     */\n    _buildNewRender : function(){\n        // create a new render using a skeleton template, render title buttons, render body, and set up events, etc.\n        var $newRender = $( this.templates.el( this.model.toJSON(), this ) );\n        if( this.expanded ){\n            this.$details( $newRender ).replaceWith( this._renderDetails().show() );\n        }\n        return $newRender;\n    },\n\n    /** Fade out the old el, swap in the new contents, then fade in.\n     *  @param {Number or String} speed   jq speed to use for rendering effects\n     *  @fires rendered when rendered\n     */\n    _queueNewRender : function( $newRender, speed ) {\n        speed = ( speed === undefined )?( this.fxSpeed ):( speed );\n        var view = this;\n\n        $( view ).queue( 'fx', [\n            function( next ){ this.$el.fadeOut( speed, next ); },\n            function( next ){\n                view._swapNewRender( $newRender );\n                next();\n            },\n            function( next ){ this.$el.fadeIn( speed, next ); },\n            function( next ){\n                this.trigger( 'rendered', view );\n                next();\n            }\n        ]);\n    },\n\n    /** empty out the current el, move the $newRender's children in */\n    _swapNewRender : function( $newRender ){\n        return this.$el.empty()\n            .attr( 'class', _.isFunction( this.className )? this.className(): this.className )\n            .append( $newRender.children() );\n    },\n\n    /** set up js behaviors, event handlers for elements within the given container\n     *  @param {jQuery} $container jq object that contains the elements to process (defaults to this.$el)\n     */\n    _setUpBehaviors : function( $where ){\n        $where = $where || this.$el;\n        // set up canned behavior on children (bootstrap, popupmenus, editable_text, etc.)\n        //make_popup_menus( $where );\n        $where.find( '[title]' ).tooltip({ placement : 'bottom' });\n    },\n\n    // ......................................................................... details\n    /** shortcut to details DOM (as jQ) */\n    $details : function( $where ){\n        $where = $where || this.$el;\n        return $where.find( '> .details' );\n    },\n\n    /** build the DOM for the details and set up behaviors on it */\n    _renderDetails : function(){\n        var $newDetails = $( this.templates.details( this.model.toJSON(), this ) );\n        this._setUpBehaviors( $newDetails );\n        return $newDetails;\n    },\n\n    // ......................................................................... expansion/details\n    /** Show or hide the details\n     *  @param {Boolean} expand if true, expand; if false, collapse\n     */\n    toggleExpanded : function( expand ){\n        expand = ( expand === undefined )?( !this.expanded ):( expand );\n        if( expand ){\n            this.expand();\n        } else {\n            this.collapse();\n        }\n        return this;\n    },\n\n    /** Render and show the full, detailed body of this view including extra data and controls.\n     *      note: if the model does not have detailed data, fetch that data before showing the body\n     *  @fires expanded when a body has been expanded\n     */\n    expand : function(){\n        var view = this;\n        return view._fetchModelDetails().always( function(){\n                view._expand();\n            });\n    },\n\n    /** Check for model details and, if none, fetch them.\n     *  @returns {jQuery.promise} the model.fetch.xhr if details are being fetched, an empty promise if not\n     */\n    _fetchModelDetails : function(){\n        if( !this.model.hasDetails() ){\n            return this.model.fetch();\n        }\n        return jQuery.when();\n    },\n\n    /** Inner fn called when expand (public) has fetched the details */\n    _expand : function(){\n        var view = this,\n            $newDetails = view._renderDetails();\n        view.$details().replaceWith( $newDetails );\n        // needs to be set after the above or the slide will not show\n        view.expanded = true;\n        view.$details().slideDown({\n            duration : view.fxSpeed,\n            step: function(){\n                view.trigger( 'expanding', view );\n            },\n            complete: function(){\n                view.trigger( 'expanded', view );\n            }\n        });\n    },\n\n    /** Hide the body/details of an HDA.\n     *  @fires collapsed when a body has been collapsed\n     */\n    collapse : function(){\n        this.debug( this + '(ExpandableView).collapse' );\n        var view = this;\n        view.expanded = false;\n        this.$details().slideUp({\n            duration : view.fxSpeed,\n            step: function(){\n                view.trigger( 'collapsing', view );\n            },\n            complete: function(){\n                view.trigger( 'collapsed', view );\n            }\n        });\n    }\n\n});\n\n\n//==============================================================================\n/** A view that is displayed in some larger list/grid/collection.\n *      Inherits from Expandable, Selectable, Draggable.\n *  The DOM contains warnings, a title bar, and a series of primary action controls.\n *      Primary actions are meant to be easily accessible item functions (such as delete)\n *      that are rendered in the title bar.\n *\n *  Details are rendered when the user clicks the title bar or presses enter/space when\n *      the title bar is in focus.\n *\n *  Designed as a base class for history panel contents - but usable elsewhere (I hope).\n */\nvar ListItemView = ExpandableView.extend(\n        BASE_MVC.mixin( BASE_MVC.SelectableViewMixin, BASE_MVC.DraggableViewMixin, {\n\n//TODO: that's a little contradictory\n    tagName     : 'div',\n    className   : 'list-item',\n\n    /** Set up the base class and all mixins */\n    initialize : function( attributes ){\n        ExpandableView.prototype.initialize.call( this, attributes );\n        BASE_MVC.SelectableViewMixin.initialize.call( this, attributes );\n        BASE_MVC.DraggableViewMixin.initialize.call( this, attributes );\n        this._setUpListeners();\n    },\n\n    /** event listeners */\n    _setUpListeners : function(){\n        // hide the primary actions in the title bar when selectable and narrow\n        this.on( 'selectable', function( isSelectable ){\n            if( isSelectable ){\n                this.$( '.primary-actions' ).hide();\n            } else {\n                this.$( '.primary-actions' ).show();\n            }\n        }, this );\n        //this.on( 'all', function( event ){\n        //    this.log( event );\n        //}, this );\n        return this;\n    },\n\n    // ........................................................................ rendering\n    /** In this override, call methods to build warnings, titlebar and primary actions */\n    _buildNewRender : function(){\n        var $newRender = ExpandableView.prototype._buildNewRender.call( this );\n        $newRender.children( '.warnings' ).replaceWith( this._renderWarnings() );\n        $newRender.children( '.title-bar' ).replaceWith( this._renderTitleBar() );\n        $newRender.children( '.primary-actions' ).append( this._renderPrimaryActions() );\n        $newRender.find( '> .title-bar .subtitle' ).replaceWith( this._renderSubtitle() );\n        return $newRender;\n    },\n\n    /** In this override, render the selector controls and set up dragging before the swap */\n    _swapNewRender : function( $newRender ){\n        ExpandableView.prototype._swapNewRender.call( this, $newRender );\n        if( this.selectable ){ this.showSelector( 0 ); }\n        if( this.draggable ){ this.draggableOn(); }\n        return this.$el;\n    },\n\n    /** Render any warnings the item may need to show (e.g. \"I'm deleted\") */\n    _renderWarnings : function(){\n        var view = this,\n            $warnings = $( '<div class=\"warnings\"></div>' ),\n            json = view.model.toJSON();\n//TODO:! unordered (map)\n        _.each( view.templates.warnings, function( templateFn ){\n            $warnings.append( $( templateFn( json, view ) ) );\n        });\n        return $warnings;\n    },\n\n    /** Render the title bar (the main/exposed SUMMARY dom element) */\n    _renderTitleBar : function(){\n        return $( this.templates.titleBar( this.model.toJSON(), this ) );\n    },\n\n    /** Return an array of jQ objects containing common/easily-accessible item controls */\n    _renderPrimaryActions : function(){\n        // override this\n        return [];\n    },\n\n    /** Render the title bar (the main/exposed SUMMARY dom element) */\n    _renderSubtitle : function(){\n        return $( this.templates.subtitle( this.model.toJSON(), this ) );\n    },\n\n    // ......................................................................... events\n    /** event map */\n    events : {\n        // expand the body when the title is clicked or when in focus and space or enter is pressed\n        'click .title-bar'      : '_clickTitleBar',\n        'keydown .title-bar'    : '_keyDownTitleBar',\n\n        // dragging - don't work, originalEvent === null\n        //'dragstart .dataset-title-bar'  : 'dragStartHandler',\n        //'dragend .dataset-title-bar'    : 'dragEndHandler'\n\n        'click .selector'       : 'toggleSelect'\n    },\n\n    /** expand when the title bar is clicked */\n    _clickTitleBar : function( event ){\n        event.stopPropagation();\n        if( event.altKey ){\n            this.toggleSelect( event );\n            if( !this.selectable ){\n                this.showSelector();\n            }\n        } else {\n            this.toggleExpanded();\n        }\n    },\n\n    /** expand when the title bar is in focus and enter or space is pressed */\n    _keyDownTitleBar : function( event ){\n        // bail (with propagation) if keydown and not space or enter\n        var KEYCODE_SPACE = 32, KEYCODE_RETURN = 13;\n        if( event && ( event.type === 'keydown' )\n        &&( event.keyCode === KEYCODE_SPACE || event.keyCode === KEYCODE_RETURN ) ){\n            this.toggleExpanded();\n            event.stopPropagation();\n            return false;\n        }\n        return true;\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'ListItemView(' + modelString + ')';\n    }\n}));\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nListItemView.prototype.templates = (function(){\n//TODO: move to require text! plugin\n\n    var elTemplato = BASE_MVC.wrapTemplate([\n        '<div class=\"list-element\">',\n            // errors, messages, etc.\n            '<div class=\"warnings\"></div>',\n\n            // multi-select checkbox\n            '<div class=\"selector\">',\n                '<span class=\"fa fa-2x fa-square-o\"></span>',\n            '</div>',\n            // space for title bar buttons - gen. floated to the right\n            '<div class=\"primary-actions\"></div>',\n            '<div class=\"title-bar\"></div>',\n\n            // expandable area for more details\n            '<div class=\"details\"></div>',\n        '</div>'\n    ]);\n\n    var warnings = {};\n\n    var titleBarTemplate = BASE_MVC.wrapTemplate([\n        // adding a tabindex here allows focusing the title bar and the use of keydown to expand the dataset display\n        '<div class=\"title-bar clear\" tabindex=\"0\">',\n//TODO: prob. belongs in dataset-list-item\n            '<span class=\"state-icon\"></span>',\n            '<div class=\"title\">',\n                '<span class=\"name\"><%- element.name %></span>',\n            '</div>',\n            '<div class=\"subtitle\"></div>',\n        '</div>'\n    ], 'element' );\n\n    var subtitleTemplate = BASE_MVC.wrapTemplate([\n        // override this\n        '<div class=\"subtitle\"></div>'\n    ]);\n\n    var detailsTemplate = BASE_MVC.wrapTemplate([\n        // override this\n        '<div class=\"details\"></div>'\n    ]);\n\n    return {\n        el          : elTemplato,\n        warnings    : warnings,\n        titleBar    : titleBarTemplate,\n        subtitle    : subtitleTemplate,\n        details     : detailsTemplate\n    };\n}());\n\n\n//==============================================================================\n/** A view that is displayed in some larger list/grid/collection.\n *  *AND* can display some sub-list of it's own when expanded (e.g. dataset collections).\n *  This list will 'foldout' when the item is expanded depending on this.foldoutStyle:\n *      If 'foldout': will expand vertically to show the nested list\n *      If 'drilldown': will overlay the parent list\n *\n *  Inherits from ListItemView.\n *\n *  _renderDetails does the work of creating this.details: a sub-view that shows the nested list\n */\nvar FoldoutListItemView = ListItemView.extend({\n\n    /** If 'foldout': show the sub-panel inside the expanded item\n     *  If 'drilldown': only fire events and handle by pub-sub\n     *      (allow the panel containing this item to attach it, hide itself, etc.)\n     */\n    foldoutStyle        : 'foldout',\n    /** Panel view class to instantiate for the sub-panel */\n    foldoutPanelClass   : null,\n\n    /** override to:\n     *      add attributes foldoutStyle and foldoutPanelClass for config poly\n     *      disrespect attributes.expanded if drilldown\n     */\n    initialize : function( attributes ){\n//TODO: hackish\n        if( this.foldoutStyle === 'drilldown' ){ this.expanded = false; }\n        this.foldoutStyle = attributes.foldoutStyle || this.foldoutStyle;\n        this.foldoutPanelClass = attributes.foldoutPanelClass || this.foldoutPanelClass;\n\n        ListItemView.prototype.initialize.call( this, attributes );\n        this.foldout = this._createFoldoutPanel();\n    },\n\n//TODO:?? override to exclude foldout scope?\n    //$ : function( selector ){\n    //    var $found = ListItemView.prototype.$.call( this, selector );\n    //    return $found;\n    //},\n\n    /** in this override, attach the foldout panel when rendering details */\n    _renderDetails : function(){\n//TODO: hackish\n        if( this.foldoutStyle === 'drilldown' ){ return $(); }\n        var $newDetails = ListItemView.prototype._renderDetails.call( this );\n        return this._attachFoldout( this.foldout, $newDetails );\n    },\n\n    /** In this override, handle collection expansion. */\n    _createFoldoutPanel : function(){\n        var model = this.model;\n        var FoldoutClass = this._getFoldoutPanelClass( model ),\n            options = this._getFoldoutPanelOptions( model ),\n            foldout = new FoldoutClass( _.extend( options, {\n                model           : model\n            }));\n        return foldout;\n    },\n\n    /** Stub to return proper foldout panel class */\n    _getFoldoutPanelClass : function(){\n        // override\n        return this.foldoutPanelClass;\n    },\n\n    /** Stub to return proper foldout panel options */\n    _getFoldoutPanelOptions : function(){\n        return {\n            // propagate foldout style down\n            foldoutStyle : this.foldoutStyle,\n            fxSpeed      : this.fxSpeed\n        };\n    },\n\n    /** Render the foldout panel inside the view, hiding controls */\n    _attachFoldout : function( foldout, $whereTo ){\n        $whereTo = $whereTo || this.$( '> .details' );\n        this.foldout = foldout.render( 0 );\n//TODO: hack\n        foldout.$( '> .controls' ).hide();\n        return $whereTo.append( foldout.$el );\n    },\n\n    /** In this override, branch on foldoutStyle to show expanded */\n    expand : function(){\n        var view = this;\n        return view._fetchModelDetails()\n            .always(function(){\n                if( view.foldoutStyle === 'foldout' ){\n                    view._expand();\n                } else if( view.foldoutStyle === 'drilldown' ){\n                    view._expandByDrilldown();\n                }\n            });\n    },\n\n    /** For drilldown, set up close handler and fire expanded:drilldown\n     *      containing views can listen to this and handle other things\n     *      (like hiding themselves) by listening for expanded/collapsed:drilldown\n     */\n    _expandByDrilldown : function(){\n        var view = this;\n        // attachment and rendering done by listener\n        view.listenTo( view.foldout, 'close', function(){\n            view.trigger( 'collapsed:drilldown', view, view.foldout );\n        });\n        view.trigger( 'expanded:drilldown', view, view.foldout );\n    }\n\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nFoldoutListItemView.prototype.templates = (function(){\n\n//TODO:?? unnecessary?\n    // use element identifier\n    var detailsTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"details\">',\n            // override with more info (that goes above the panel)\n        '</div>'\n    ], 'collection' );\n\n    return _.extend( {}, ListItemView.prototype.templates, {\n        details : detailsTemplate\n    });\n}());\n\n\n//==============================================================================\n    return {\n        ExpandableView                  : ExpandableView,\n        ListItemView                    : ListItemView,\n        FoldoutListItemView             : FoldoutListItemView\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/list/list-item.js\n **/","/**\n    This is the base class of the tool form plugin. This class is e.g. inherited by the regular and the workflow tool form.\n*/\ndefine(['utils/utils', 'utils/deferred', 'mvc/ui/ui-misc', 'mvc/form/form-view',\n        'mvc/citation/citation-model', 'mvc/citation/citation-view'],\n    function(Utils, Deferred, Ui, FormBase, CitationModel, CitationView) {\n    return FormBase.extend({\n        initialize: function(options) {\n            var self = this;\n            FormBase.prototype.initialize.call(this, options);\n            this.deferred = new Deferred();\n            if (options.inputs) {\n                this._buildForm(options);\n            } else {\n                this.deferred.execute(function(process) {\n                    self._buildModel(process, options, true);\n                });\n            }\n        },\n\n        /** Wait for deferred build processes before removal */\n        remove: function() {\n            var self = this;\n            this.$el.hide();\n            this.deferred.execute(function(){\n                FormBase.prototype.remove.call(self);\n                Galaxy.emit.debug('tool-form-base::remove()', 'Destroy view.');\n            });\n        },\n\n        /** Build form */\n        _buildForm: function(options) {\n            var self = this;\n            this.options = Utils.merge(options, this.options);\n            this.options = Utils.merge({\n                icon            : options.icon,\n                title           : '<b>' + options.name + '</b> ' + options.description + ' (Galaxy Version ' + options.version + ')',\n                operations      : this._operations(),\n                onchange        : function() {\n                    self.deferred.reset();\n                    self.deferred.execute(function(process) {\n                        self._updateModel(process);\n                    });\n                }\n            }, this.options);\n            this.options.customize && this.options.customize( this.options );\n            this.render();\n            if ( !this.options.collapsible ) {\n                this.$el.append( $( '<div/>' ).addClass( 'ui-margin-top-large' ).append( this._footer() ) );\n            }\n        },\n\n        /** Builds a new model through api call and recreates the entire form\n        */\n        _buildModel: function(process, options, hide_message) {\n            var self = this;\n            this.options.id = options.id;\n            this.options.version = options.version;\n\n            // build request url\n            var build_url = '';\n            var build_data = {};\n            if ( options.job_id ) {\n                build_url = Galaxy.root + 'api/jobs/' + options.job_id + '/build_for_rerun';\n            } else {\n                build_url = Galaxy.root + 'api/tools/' + options.id + '/build';\n                if ( Galaxy.params && Galaxy.params.tool_id == options.id ) {\n                    build_data = $.extend( {}, Galaxy.params );\n                    options.version && ( build_data[ 'tool_version' ] = options.version );\n                }\n            }\n\n            // get initial model\n            Utils.get({\n                url     : build_url,\n                data    : build_data,\n                success : function(new_model) {\n                    new_model = new_model.tool_model || new_model;\n                    if( !new_model.display ) {\n                        window.location = Galaxy.root;\n                        return;\n                    }\n                    self._buildForm(new_model);\n                    !hide_message && self.message.update({\n                        status      : 'success',\n                        message     : 'Now you are using \\'' + self.options.name + '\\' version ' + self.options.version + ', id \\'' + self.options.id + '\\'.',\n                        persistent  : false\n                    });\n                    Galaxy.emit.debug('tool-form-base::initialize()', 'Initial tool model ready.', new_model);\n                    process.resolve();\n                },\n                error   : function(response, xhr) {\n                    var error_message = ( response && response.err_msg ) || 'Uncaught error.';\n                    if ( xhr.status == 401 ) {\n                        window.location = Galaxy.root + 'user/login?' + $.param({ redirect : Galaxy.root + '?tool_id=' + self.options.id });\n                    } else if ( self.$el.is(':empty') ) {\n                        self.$el.prepend((new Ui.Message({\n                            message     : error_message,\n                            status      : 'danger',\n                            persistent  : true,\n                            large       : true\n                        })).$el);\n                    } else {\n                        Galaxy.modal && Galaxy.modal.show({\n                            title   : 'Tool request failed',\n                            body    : error_message,\n                            buttons : {\n                                'Close' : function() {\n                                    Galaxy.modal.hide();\n                                }\n                            }\n                        });\n                    }\n                    Galaxy.emit.debug('tool-form::initialize()', 'Initial tool model request failed.', response);\n                    process.reject();\n                }\n            });\n        },\n\n        /** Request a new model for an already created tool form and updates the form inputs\n        */\n        _updateModel: function(process) {\n            // link this\n            var self = this;\n            var model_url = this.options.update_url || Galaxy.root + 'api/tools/' + this.options.id + '/build';\n            var current_state = {\n                tool_id         : this.options.id,\n                tool_version    : this.options.version,\n                inputs          : $.extend(true, {}, self.data.create())\n            }\n            this.wait(true);\n\n            // log tool state\n            Galaxy.emit.debug('tool-form-base::_updateModel()', 'Sending current state.', current_state);\n\n            // post job\n            Utils.request({\n                type    : 'POST',\n                url     : model_url,\n                data    : current_state,\n                success : function(new_model) {\n                    self.update(new_model['tool_model'] || new_model);\n                    self.options.update && self.options.update(new_model);\n                    self.wait(false);\n                    Galaxy.emit.debug('tool-form-base::_updateModel()', 'Received new model.', new_model);\n                    process.resolve();\n                },\n                error   : function(response) {\n                    Galaxy.emit.debug('tool-form-base::_updateModel()', 'Refresh request failed.', response);\n                    process.reject();\n                }\n            });\n        },\n\n        /** Create tool operation menu\n        */\n        _operations: function() {\n            var self = this;\n            var options = this.options;\n\n            // button for version selection\n            var versions_button = new Ui.ButtonMenu({\n                icon    : 'fa-cubes',\n                title   : (!options.narrow && 'Versions') || null,\n                tooltip : 'Select another tool version'\n            });\n            if (!options.sustain_version && options.versions && options.versions.length > 1) {\n                for (var i in options.versions) {\n                    var version = options.versions[i];\n                    if (version != options.version) {\n                        versions_button.addMenu({\n                            title   : 'Switch to ' + version,\n                            version : version,\n                            icon    : 'fa-cube',\n                            onclick : function() {\n                                // here we update the tool version (some tools encode the version also in the id)\n                                var id = options.id.replace(options.version, this.version);\n                                var version = this.version;\n                                // queue model request\n                                self.deferred.reset();\n                                self.deferred.execute(function(process) {\n                                    self._buildModel(process, {id: id, version: version})\n                                });\n                            }\n                        });\n                    }\n                }\n            } else {\n                versions_button.$el.hide();\n            }\n\n            // button for options e.g. search, help\n            var menu_button = new Ui.ButtonMenu({\n                icon    : 'fa-caret-down',\n                title   : (!options.narrow && 'Options') || null,\n                tooltip : 'View available options'\n            });\n            if(options.biostar_url) {\n                menu_button.addMenu({\n                    icon    : 'fa-question-circle',\n                    title   : 'Question?',\n                    tooltip : 'Ask a question about this tool (Biostar)',\n                    onclick : function() {\n                        window.open(options.biostar_url + '/p/new/post/');\n                    }\n                });\n                menu_button.addMenu({\n                    icon    : 'fa-search',\n                    title   : 'Search',\n                    tooltip : 'Search help for this tool (Biostar)',\n                    onclick : function() {\n                        window.open(options.biostar_url + '/local/search/page/?q=' + options.name);\n                    }\n                });\n            };\n            menu_button.addMenu({\n                icon    : 'fa-share',\n                title   : 'Share',\n                tooltip : 'Share this tool',\n                onclick : function() {\n                    prompt('Copy to clipboard: Ctrl+C, Enter', window.location.origin + Galaxy.root + 'root?tool_id=' + options.id);\n                }\n            });\n\n            // add admin operations\n            if (Galaxy.user && Galaxy.user.get('is_admin')) {\n                menu_button.addMenu({\n                    icon    : 'fa-download',\n                    title   : 'Download',\n                    tooltip : 'Download this tool',\n                    onclick : function() {\n                        window.location.href = Galaxy.root + 'api/tools/' + options.id + '/download';\n                    }\n                });\n            }\n\n            // button for version selection\n            if (options.requirements && options.requirements.length > 0) {\n                menu_button.addMenu({\n                    icon    : 'fa-info-circle',\n                    title   : 'Requirements',\n                    tooltip : 'Display tool requirements',\n                    onclick : function() {\n                        if (!this.visible || self.portlet.collapsed ) {\n                            this.visible = true;\n                            self.portlet.expand();\n                            self.message.update({\n                                persistent  : true,\n                                message     : self._templateRequirements(options),\n                                status      : 'info'\n                            });\n                        } else {\n                            this.visible = false;\n                            self.message.update({\n                                message     : ''\n                            });\n                        }\n                    }\n                });\n            }\n\n            // add toolshed url\n            if (options.sharable_url) {\n                menu_button.addMenu({\n                    icon    : 'fa-external-link',\n                    title   : 'See in Tool Shed',\n                    tooltip : 'Access the repository',\n                    onclick : function() {\n                        window.open(options.sharable_url);\n                    }\n                });\n            }\n\n            return {\n                menu        : menu_button,\n                versions    : versions_button\n            }\n        },\n\n        /** Create footer\n        */\n        _footer: function() {\n            var options = this.options;\n            var $el = $( '<div/>' ).append( this._templateHelp( options ) );\n            if ( options.citations ) {\n                var $citations = $( '<div/>' );\n                var citations = new CitationModel.ToolCitationCollection();\n                citations.tool_id = options.id;\n                var citation_list_view = new CitationView.CitationListView({ el: $citations, collection: citations });\n                citation_list_view.render();\n                citations.fetch();\n                $el.append( $citations );\n            }\n            return $el;\n        },\n\n        /** Templates\n        */\n        _templateHelp: function( options ) {\n            var $tmpl = $( '<div/>' ).addClass( 'ui-form-help' ).append( options.help );\n            $tmpl.find( 'a' ).attr( 'target', '_blank' );\n            return $tmpl;\n        },\n\n        _templateRequirements: function( options ) {\n            var nreq = options.requirements.length;\n            if ( nreq > 0 ) {\n                var requirements_message = 'This tool requires ';\n                _.each( options.requirements, function( req, i ) {\n                    requirements_message += req.name + ( req.version ? ' (Version ' + req.version + ')' : '' ) + ( i < nreq - 2 ? ', ' : ( i == nreq - 2 ? ' and ' : '' ) );\n                });\n                var requirements_link = $( '<a/>' ).attr( 'target', '_blank' ).attr( 'href', 'https://wiki.galaxyproject.org/Tools/Requirements' ).text( 'here' );\n                return $( '<span/>' ).append( requirements_message + '. Click ' ).append( requirements_link ).append( ' for more information.' );\n            }\n            return 'No requirements found.';\n        }\n    });\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/tool/tool-form-base.js\n **/","/**\n * Model, view, and controller objects for Galaxy tools and tool panel.\n */\n\n define([\n    \"libs/underscore\",\n    \"viz/trackster/util\",\n    \"mvc/dataset/data\",\n    \"mvc/tool/tool-form\"\n\n], function(_, util, data, ToolForm) {\n    'use strict';\n\n/**\n * Mixin for tracking model visibility.\n */\nvar VisibilityMixin = {\n    hidden: false,\n\n    show: function() {\n        this.set(\"hidden\", false);\n    },\n\n    hide: function() {\n        this.set(\"hidden\", true);\n    },\n\n    toggle: function() {\n        this.set(\"hidden\", !this.get(\"hidden\"));\n    },\n\n    is_visible: function() {\n        return !this.attributes.hidden;\n    }\n\n};\n\n/**\n * A tool parameter.\n */\nvar ToolParameter = Backbone.Model.extend({\n    defaults: {\n        name: null,\n        label: null,\n        type: null,\n        value: null,\n        html: null,\n        num_samples: 5\n    },\n\n    initialize: function(options) {\n        this.attributes.html = unescape(this.attributes.html);\n    },\n\n    copy: function() {\n        return new ToolParameter(this.toJSON());\n    },\n\n    set_value: function(value) {\n        this.set('value', value || '');\n    }\n});\n\nvar ToolParameterCollection = Backbone.Collection.extend({\n    model: ToolParameter\n});\n\n/**\n * A data tool parameter.\n */\nvar DataToolParameter = ToolParameter.extend({});\n\n/**\n * An integer tool parameter.\n */\nvar IntegerToolParameter = ToolParameter.extend({\n    set_value: function(value) {\n        this.set('value', parseInt(value, 10));\n    },\n\n    /**\n     * Returns samples from a tool input.\n     */\n    get_samples: function() {\n        return d3.scale.linear()\n                        .domain([this.get('min'), this.get('max')])\n                        .ticks(this.get('num_samples'));\n    }\n});\n\nvar FloatToolParameter = IntegerToolParameter.extend({\n    set_value: function(value) {\n        this.set('value', parseFloat(value));\n    }\n});\n\n/**\n * A select tool parameter.\n */\nvar SelectToolParameter = ToolParameter.extend({\n    /**\n     * Returns tool options.\n     */\n    get_samples: function() {\n        return _.map(this.get('options'), function(option) {\n            return option[0];\n        });\n    }\n});\n\n// Set up dictionary of parameter types.\nToolParameter.subModelTypes = {\n    'integer': IntegerToolParameter,\n    'float': FloatToolParameter,\n    'data': DataToolParameter,\n    'select': SelectToolParameter\n};\n\n/**\n * A Galaxy tool.\n */\nvar Tool = Backbone.Model.extend({\n    // Default attributes.\n    defaults: {\n        id: null,\n        name: null,\n        description: null,\n        target: null,\n        inputs: [],\n        outputs: []\n    },\n\n    urlRoot: Galaxy.root + 'api/tools',\n\n    initialize: function(options) {\n\n        // Set parameters.\n        this.set('inputs', new ToolParameterCollection(_.map(options.inputs, function(p) {\n            var p_class = ToolParameter.subModelTypes[p.type] || ToolParameter;\n            return new p_class(p);\n        })));\n    },\n\n    /**\n     *\n     */\n    toJSON: function() {\n        var rval = Backbone.Model.prototype.toJSON.call(this);\n\n        // Convert inputs to JSON manually.\n        rval.inputs = this.get('inputs').map(function(i) { return i.toJSON(); });\n        return rval;\n    },\n\n    /**\n     * Removes inputs of a particular type; this is useful because not all inputs can be handled by\n     * client and server yet.\n     */\n    remove_inputs: function(types) {\n        var tool = this,\n            incompatible_inputs = tool.get('inputs').filter( function(input) {\n                return ( types.indexOf( input.get('type') ) !== -1);\n            });\n        tool.get('inputs').remove(incompatible_inputs);\n    },\n\n    /**\n     * Returns object copy, optionally including only inputs that can be sampled.\n     */\n    copy: function(only_samplable_inputs) {\n        var copy = new Tool(this.toJSON());\n\n        // Return only samplable inputs if flag is set.\n        if (only_samplable_inputs) {\n            var valid_inputs = new Backbone.Collection();\n            copy.get('inputs').each(function(input) {\n                if (input.get_samples()) {\n                    valid_inputs.push(input);\n                }\n            });\n            copy.set('inputs', valid_inputs);\n        }\n\n        return copy;\n    },\n\n    apply_search_results: function(results) {\n        ( _.indexOf(results, this.attributes.id) !== -1 ? this.show() : this.hide() );\n        return this.is_visible();\n    },\n\n    /**\n     * Set a tool input's value.\n     */\n    set_input_value: function(name, value) {\n        this.get('inputs').find(function(input) {\n            return input.get('name') === name;\n        }).set('value', value);\n    },\n\n    /**\n     * Set many input values at once.\n     */\n    set_input_values: function(inputs_dict) {\n        var self = this;\n        _.each(_.keys(inputs_dict), function(input_name) {\n            self.set_input_value(input_name, inputs_dict[input_name]);\n        });\n    },\n\n    /**\n     * Run tool; returns a Deferred that resolves to the tool's output(s).\n     */\n    run: function() {\n        return this._run();\n    },\n\n    /**\n     * Rerun tool using regions and a target dataset.\n     */\n    rerun: function(target_dataset, regions) {\n        return this._run({\n            action: 'rerun',\n            target_dataset_id: target_dataset.id,\n            regions: regions\n        });\n    },\n\n    /**\n     * Returns input dict for tool's inputs.\n     */\n    get_inputs_dict: function() {\n        var input_dict = {};\n        this.get('inputs').each(function(input) {\n            input_dict[input.get('name')] = input.get('value');\n        });\n        return input_dict;\n    },\n\n    /**\n     * Run tool; returns a Deferred that resolves to the tool's output(s).\n     * NOTE: this method is a helper method and should not be called directly.\n     */\n    _run: function(additional_params) {\n        // Create payload.\n        var payload = _.extend({\n                tool_id: this.id,\n                inputs: this.get_inputs_dict()\n            }, additional_params);\n\n        // Because job may require indexing datasets, use server-side\n        // deferred to ensure that job is run. Also use deferred that\n        // resolves to outputs from tool.\n        var run_deferred = $.Deferred(),\n            ss_deferred = new util.ServerStateDeferred({\n            ajax_settings: {\n                url: this.urlRoot,\n                data: JSON.stringify(payload),\n                dataType: \"json\",\n                contentType: 'application/json',\n                type: \"POST\"\n            },\n            interval: 2000,\n            success_fn: function(response) {\n                return response !== \"pending\";\n            }\n        });\n\n        // Run job and resolve run_deferred to tool outputs.\n        $.when(ss_deferred.go()).then(function(result) {\n            run_deferred.resolve(new data.DatasetCollection(result));\n        });\n        return run_deferred;\n    }\n});\n_.extend(Tool.prototype, VisibilityMixin);\n\n/**\n * Tool view.\n */\nvar ToolView = Backbone.View.extend({\n\n});\n\n/**\n * Wrap collection of tools for fast access/manipulation.\n */\nvar ToolCollection = Backbone.Collection.extend({\n    model: Tool\n});\n\n/**\n * Label or section header in tool panel.\n */\nvar ToolSectionLabel = Backbone.Model.extend(VisibilityMixin);\n\n/**\n * Section of tool panel with elements (labels and tools).\n */\nvar ToolSection = Backbone.Model.extend({\n    defaults: {\n        elems: [],\n        open: false\n    },\n\n    clear_search_results: function() {\n        _.each(this.attributes.elems, function(elt) {\n            elt.show();\n        });\n\n        this.show();\n        this.set(\"open\", false);\n    },\n\n    apply_search_results: function(results) {\n        var all_hidden = true,\n            cur_label;\n        _.each(this.attributes.elems, function(elt) {\n            if (elt instanceof ToolSectionLabel) {\n                cur_label = elt;\n                cur_label.hide();\n            }\n            else if (elt instanceof Tool) {\n                if (elt.apply_search_results(results)) {\n                    all_hidden = false;\n                    if (cur_label) {\n                        cur_label.show();\n                    }\n                }\n            }\n        });\n\n        if (all_hidden) {\n            this.hide();\n        }\n        else {\n            this.show();\n            this.set(\"open\", true);\n        }\n    }\n});\n_.extend(ToolSection.prototype, VisibilityMixin);\n\n/**\n * Tool search that updates results when query is changed. Result value of null\n * indicates that query was not run; if not null, results are from search using\n * query.\n */\nvar ToolSearch = Backbone.Model.extend({\n    defaults: {\n        search_hint_string: \"search tools\",\n        min_chars_for_search: 3,\n        clear_btn_url: \"\",\n        search_url: \"\",\n        visible: true,\n        query: \"\",\n        results: null,\n        // ESC (27) will clear the input field and tool search filters\n        clear_key: 27\n    },\n\n    urlRoot: Galaxy.root + 'api/tools',\n\n    initialize: function() {\n        this.on(\"change:query\", this.do_search);\n    },\n\n    /**\n     * Do the search and update the results.\n     */\n    do_search: function() {\n        var query = this.attributes.query;\n\n        // If query is too short, do not search.\n        if (query.length < this.attributes.min_chars_for_search) {\n            this.set(\"results\", null);\n            return;\n        }\n\n        // Do search via AJAX.\n        var q = query;\n        // Stop previous ajax-request\n        if (this.timer) {\n            clearTimeout(this.timer);\n        }\n        // Start a new ajax-request in X ms\n        $(\"#search-clear-btn\").hide();\n        $(\"#search-spinner\").show();\n        var self = this;\n        this.timer = setTimeout(function () {\n            // log the search to analytics if present\n            if ( typeof ga !== 'undefined' ) {\n                ga( 'send', 'pageview', Galaxy.root + '?q=' + q );\n            }\n            $.get( self.urlRoot, { q: q }, function (data) {\n                self.set(\"results\", data);\n                $(\"#search-spinner\").hide();\n                $(\"#search-clear-btn\").show();\n            }, \"json\" );\n        }, 400 );\n    },\n\n    clear_search: function() {\n        this.set(\"query\", \"\");\n        this.set(\"results\", null);\n    }\n\n});\n_.extend(ToolSearch.prototype, VisibilityMixin);\n\n/**\n * Tool Panel.\n */\nvar ToolPanel = Backbone.Model.extend({\n\n    initialize: function(options) {\n        this.attributes.tool_search = options.tool_search;\n        this.attributes.tool_search.on(\"change:results\", this.apply_search_results, this);\n        this.attributes.tools = options.tools;\n        this.attributes.layout = new Backbone.Collection( this.parse(options.layout) );\n    },\n\n    /**\n     * Parse tool panel dictionary and return collection of tool panel elements.\n     */\n    parse: function(response) {\n        // Recursive function to parse tool panel elements.\n        var self = this,\n            // Helper to recursively parse tool panel.\n            parse_elt = function(elt_dict) {\n                var type = elt_dict.model_class;\n                // There are many types of tools; for now, anything that ends in 'Tool'\n                // is treated as a generic tool.\n                if ( type.indexOf('Tool') === type.length - 4 ) {\n                    return self.attributes.tools.get(elt_dict.id);\n                }\n                else if (type === 'ToolSection') {\n                    // Parse elements.\n                    var elems = _.map(elt_dict.elems, parse_elt);\n                    elt_dict.elems = elems;\n                    return new ToolSection(elt_dict);\n                }\n                else if (type === 'ToolSectionLabel') {\n                    return new ToolSectionLabel(elt_dict);\n                }\n            };\n\n        return _.map(response, parse_elt);\n    },\n\n    clear_search_results: function() {\n        this.get('layout').each(function(panel_elt) {\n            if (panel_elt instanceof ToolSection) {\n                panel_elt.clear_search_results();\n            }\n            else {\n                // Label or tool, so just show.\n                panel_elt.show();\n            }\n        });\n    },\n\n    apply_search_results: function() {\n        var results = this.get('tool_search').get('results');\n        if (results === null) {\n            this.clear_search_results();\n            return;\n        }\n\n        var cur_label = null;\n        this.get('layout').each(function(panel_elt) {\n            if (panel_elt instanceof ToolSectionLabel) {\n                cur_label = panel_elt;\n                cur_label.hide();\n            }\n            else if (panel_elt instanceof Tool) {\n                if (panel_elt.apply_search_results(results)) {\n                    if (cur_label) {\n                        cur_label.show();\n                    }\n                }\n            }\n            else {\n                // Starting new section, so clear current label.\n                cur_label = null;\n                panel_elt.apply_search_results(results);\n            }\n        });\n    }\n});\n\n/**\n * View classes for Galaxy tools and tool panel.\n *\n * Views use the templates defined below for rendering. Views update as needed\n * based on (a) model/collection events and (b) user interactions; in this sense,\n * they are controllers are well and the HTML is the real view in the MVC architecture.\n */\n\n/**\n * Base view that handles visibility based on model's hidden attribute.\n */\nvar BaseView = Backbone.View.extend({\n    initialize: function() {\n        this.model.on(\"change:hidden\", this.update_visible, this);\n        this.update_visible();\n    },\n    update_visible: function() {\n        ( this.model.attributes.hidden ? this.$el.hide() : this.$el.show() );\n    }\n});\n\n/**\n * Link to a tool.\n */\nvar ToolLinkView = BaseView.extend({\n    tagName: 'div',\n\n    render: function() {\n        // create element\n        var $link = $('<div/>');\n        $link.append(templates.tool_link(this.model.toJSON()));\n\n        var formStyle = this.model.get( 'form_style', null );\n        // open upload dialog for upload tool\n        if (this.model.id === 'upload1') {\n            $link.find('a').on('click', function(e) {\n                e.preventDefault();\n                Galaxy.upload.show();\n            });\n        }\n        else if ( formStyle === 'regular' ) { // regular tools\n            var self = this;\n            $link.find('a').on('click', function(e) {\n                e.preventDefault();\n                var form = new ToolForm.View( { id : self.model.id, version : self.model.get('version') } );\n                form.deferred.execute(function() {\n                    Galaxy.app.display( form );\n                });\n            });\n        }\n\n        // add element\n        this.$el.append($link);\n        return this;\n    }\n});\n\n/**\n * Panel label/section header.\n */\nvar ToolSectionLabelView = BaseView.extend({\n    tagName: 'div',\n    className: 'toolPanelLabel',\n\n    render: function() {\n        this.$el.append( $(\"<span/>\").text(this.model.attributes.text) );\n        return this;\n    }\n});\n\n/**\n * Panel section.\n */\nvar ToolSectionView = BaseView.extend({\n    tagName: 'div',\n    className: 'toolSectionWrapper',\n\n    initialize: function() {\n        BaseView.prototype.initialize.call(this);\n        this.model.on(\"change:open\", this.update_open, this);\n    },\n\n    render: function() {\n        // Build using template.\n        this.$el.append( templates.panel_section(this.model.toJSON()) );\n\n        // Add tools to section.\n        var section_body = this.$el.find(\".toolSectionBody\");\n        _.each(this.model.attributes.elems, function(elt) {\n            if (elt instanceof Tool) {\n                var tool_view = new ToolLinkView({model: elt, className: \"toolTitle\"});\n                tool_view.render();\n                section_body.append(tool_view.$el);\n            }\n            else if (elt instanceof ToolSectionLabel) {\n                var label_view = new ToolSectionLabelView({model: elt});\n                label_view.render();\n                section_body.append(label_view.$el);\n            }\n            else {\n                // TODO: handle nested section bodies?\n            }\n        });\n        return this;\n    },\n\n    events: {\n        'click .toolSectionTitle > a': 'toggle'\n    },\n\n    /**\n     * Toggle visibility of tool section.\n     */\n    toggle: function() {\n        this.model.set(\"open\", !this.model.attributes.open);\n    },\n\n    /**\n     * Update whether section is open or close.\n     */\n    update_open: function() {\n        (this.model.attributes.open ?\n            this.$el.children(\".toolSectionBody\").slideDown(\"fast\") :\n            this.$el.children(\".toolSectionBody\").slideUp(\"fast\")\n        );\n    }\n});\n\nvar ToolSearchView = Backbone.View.extend({\n    tagName: 'div',\n    id: 'tool-search',\n    className: 'bar',\n\n    events: {\n        'click': 'focus_and_select',\n        'keyup :input': 'query_changed',\n        'click #search-clear-btn': 'clear'\n    },\n\n    render: function() {\n        this.$el.append( templates.tool_search(this.model.toJSON()) );\n        if (!this.model.is_visible()) {\n            this.$el.hide();\n        }\n        this.$el.find('[title]').tooltip();\n        return this;\n    },\n\n    focus_and_select: function() {\n        this.$el.find(\":input\").focus().select();\n    },\n\n    clear: function() {\n        this.model.clear_search();\n        this.$el.find(\":input\").val('');\n        this.focus_and_select();\n        return false;\n    },\n\n    query_changed: function( evData ) {\n        // check for the 'clear key' (ESC) first\n        if( ( this.model.attributes.clear_key ) &&\n            ( this.model.attributes.clear_key === evData.which ) ){\n            this.clear();\n            return false;\n        }\n        this.model.set(\"query\", this.$el.find(\":input\").val());\n    }\n});\n\n/**\n * Tool panel view. Events triggered include:\n * tool_link_click(click event, tool_model)\n */\nvar ToolPanelView = Backbone.View.extend({\n    tagName: 'div',\n    className: 'toolMenu',\n\n    /**\n     * Set up view.\n     */\n    initialize: function() {\n        this.model.get('tool_search').on(\"change:results\", this.handle_search_results, this);\n    },\n\n    render: function() {\n        var self = this;\n\n        // Render search.\n        var search_view = new ToolSearchView( { model: this.model.get('tool_search') } );\n        search_view.render();\n        self.$el.append(search_view.$el);\n\n        // Render panel.\n        this.model.get('layout').each(function(panel_elt) {\n            if (panel_elt instanceof ToolSection) {\n                var section_title_view = new ToolSectionView({model: panel_elt});\n                section_title_view.render();\n                self.$el.append(section_title_view.$el);\n            }\n            else if (panel_elt instanceof Tool) {\n                var tool_view = new ToolLinkView({model: panel_elt, className: \"toolTitleNoSection\"});\n                tool_view.render();\n                self.$el.append(tool_view.$el);\n            }\n            else if (panel_elt instanceof ToolSectionLabel) {\n                var label_view = new ToolSectionLabelView({model: panel_elt});\n                label_view.render();\n                self.$el.append(label_view.$el);\n            }\n        });\n\n        // Setup tool link click eventing.\n        self.$el.find(\"a.tool-link\").click(function(e) {\n            // Tool id is always the first class.\n            var\n                tool_id = $(this).attr('class').split(/\\s+/)[0],\n                tool = self.model.get('tools').get(tool_id);\n\n            self.trigger(\"tool_link_click\", e, tool);\n        });\n\n        return this;\n    },\n\n    handle_search_results: function() {\n        var results = this.model.get('tool_search').get('results');\n        if (results && results.length === 0) {\n            $(\"#search-no-results\").show();\n        }\n        else {\n            $(\"#search-no-results\").hide();\n        }\n    }\n});\n\n/**\n * View for working with a tool: setting parameters and inputs and executing the tool.\n */\nvar ToolFormView = Backbone.View.extend({\n    className: 'toolForm',\n\n    render: function() {\n        this.$el.children().remove();\n        this.$el.append( templates.tool_form(this.model.toJSON()) );\n    }\n});\n\n/**\n * Integrated tool menu + tool execution.\n */\nvar IntegratedToolMenuAndView = Backbone.View.extend({\n    className: 'toolMenuAndView',\n\n    initialize: function() {\n        this.tool_panel_view = new ToolPanelView({collection: this.collection});\n        this.tool_form_view = new ToolFormView();\n    },\n\n    render: function() {\n        // Render and append tool panel.\n        this.tool_panel_view.render();\n        this.tool_panel_view.$el.css(\"float\", \"left\");\n        this.$el.append(this.tool_panel_view.$el);\n\n        // Append tool form view.\n        this.tool_form_view.$el.hide();\n        this.$el.append(this.tool_form_view.$el);\n\n        // On tool link click, show tool.\n        var self = this;\n        this.tool_panel_view.on(\"tool_link_click\", function(e, tool) {\n            // Prevents click from activating link:\n            e.preventDefault();\n            // Show tool that was clicked on:\n            self.show_tool(tool);\n        });\n    },\n\n    /**\n     * Fetch and display tool.\n     */\n    show_tool: function(tool) {\n        var self = this;\n        tool.fetch().done( function() {\n            self.tool_form_view.model = tool;\n            self.tool_form_view.render();\n            self.tool_form_view.$el.show();\n            $('#left').width(\"650px\");\n        });\n    }\n});\n\n// TODO: move into relevant views\nvar templates = {\n    // the search bar at the top of the tool panel\n    tool_search : _.template([\n        '<input id=\"tool-search-query\" class=\"search-query parent-width\" name=\"query\" ',\n                'placeholder=\"<%- search_hint_string %>\" autocomplete=\"off\" type=\"text\" />',\n        '<a id=\"search-clear-btn\" title=\"clear search (esc)\"> </a>',\n        //TODO: replace with icon\n        '<span id=\"search-spinner\" class=\"search-spinner fa fa-spinner fa-spin\"></span>',\n    ].join('')),\n\n    // the category level container in the tool panel (e.g. 'Get Data', 'Text Manipulation')\n    panel_section : _.template([\n        '<div class=\"toolSectionTitle\" id=\"title_<%- id %>\">',\n            '<a href=\"javascript:void(0)\"><span><%- name %></span></a>',\n        '</div>',\n        '<div id=\"<%- id %>\" class=\"toolSectionBody\" style=\"display: none;\">',\n            '<div class=\"toolSectionBg\"></div>',\n        '<div>'\n    ].join('')),\n\n    // a single tool's link in the tool panel; will load the tool form in the center panel\n    tool_link : _.template([\n        '<span class=\"labels\">',\n            '<% _.each( labels, function( label ){ %>',\n            '<span class=\"label label-default label-<%- label %>\">',\n                '<%- label %>',\n            '</span>',\n            '<% }); %>',\n        '</span>',\n        '<a class=\"<%- id %> tool-link\" href=\"<%= link %>\" target=\"<%- target %>\" minsizehint=\"<%- min_width %>\">',\n            '<%- name %>',\n        '</a>',\n        ' <%- description %>'\n    ].join('')),\n\n    // the tool form for entering tool parameters, viewing help and executing the tool\n    // loaded when a tool link is clicked in the tool panel\n    tool_form : _.template([\n        '<div class=\"toolFormTitle\"><%- tool.name %> (version <%- tool.version %>)</div>',\n        '<div class=\"toolFormBody\">',\n            '<% _.each( tool.inputs, function( input ){ %>',\n            '<div class=\"form-row\">',\n                '<label for=\"<%- input.name %>\"><%- input.label %>:</label>',\n                '<div class=\"form-row-input\">',\n                    '<%= input.html %>',\n                '</div>',\n                '<div class=\"toolParamHelp\" style=\"clear: both;\">',\n                    '<%- input.help %>',\n                '</div>',\n                '<div style=\"clear: both;\"></div>',\n            '</div>',\n            '<% }); %>',\n        '</div>',\n        '<div class=\"form-row form-actions\">',\n            '<input type=\"submit\" class=\"btn btn-primary\" name=\"runtool_btn\" value=\"Execute\" />',\n        '</div>',\n        '<div class=\"toolHelp\">',\n            '<div class=\"toolHelpBody\"><% tool.help %></div>',\n        '</div>',\n    // TODO: we need scoping here because 'help' is the dom for the help menu in the masthead\n    // which implies a leaky variable that I can't find\n    ].join(''), { variable: 'tool' }),\n};\n\n\n// Exports\nreturn {\n    ToolParameter: ToolParameter,\n    IntegerToolParameter: IntegerToolParameter,\n    SelectToolParameter: SelectToolParameter,\n    Tool: Tool,\n    ToolCollection: ToolCollection,\n    ToolSearch: ToolSearch,\n    ToolPanel: ToolPanel,\n    ToolPanelView: ToolPanelView,\n    ToolFormView: ToolFormView\n};\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/tool/tools.js\n **/","define([\n    //jquery\n    //backbone\n], function(){\n// =============================================================================\n/**\n * view for a popup menu\n */\nvar PopupMenu = Backbone.View.extend({\n//TODO: maybe better as singleton off the Galaxy obj\n    /** Cache the desired button element and options, set up the button click handler\n     *  NOTE: attaches this view as HTML/jQ data on the button for later use.\n     */\n    initialize: function( $button, options ){\n        // default settings\n        this.$button = $button;\n        if( !this.$button.length ){\n            this.$button = $( '<div/>' );\n        }\n        this.options = options || [];\n        this.$button.data( 'popupmenu', this );\n\n        // set up button click -> open menu behavior\n        var menu = this;\n        this.$button.click( function( event ){\n            // if there's already a menu open, remove it\n            $( '.popmenu-wrapper' ).remove();\n            menu._renderAndShow( event );\n            return false;\n        });\n    },\n\n    // render the menu, append to the page body at the click position, and set up the 'click-away' handlers, show\n    _renderAndShow: function( clickEvent ){\n        this.render();\n        this.$el.appendTo( 'body' ).css( this._getShownPosition( clickEvent )).show();\n        this._setUpCloseBehavior();\n    },\n\n    // render the menu\n    // this menu doesn't attach itself to the DOM ( see _renderAndShow )\n    render: function(){\n        // render the menu body absolute and hidden, fill with template\n        this.$el.addClass( 'popmenu-wrapper' ).hide()\n            .css({ position : 'absolute' })\n            .html( this.template( this.$button.attr( 'id' ), this.options ));\n\n        // set up behavior on each link/anchor elem\n        if( this.options.length ){\n            var menu = this;\n            //precondition: there should be one option per li\n            this.$el.find( 'li' ).each( function( i, li ){\n                var option = menu.options[i];\n\n                // if the option has 'func', call that function when the anchor is clicked\n                if( option.func ){\n                    $( this ).children( 'a.popupmenu-option' ).click( function( event ){\n                        option.func.call( menu, event, option );\n                        // We must preventDefault otherwise clicking \"cancel\"\n                        // on a purge or something still navigates and causes\n                        // the action.\n                        event.preventDefault();\n                        // bubble up so that an option click will call the close behavior\n                    });\n                }\n            });\n        }\n        return this;\n    },\n\n    template : function( id, options ){\n        return [\n            '<ul id=\"', id, '-menu\" class=\"dropdown-menu\">', this._templateOptions( options ), '</ul>'\n        ].join( '' );\n    },\n\n    _templateOptions : function( options ){\n        if( !options.length ){\n            return '<li>(no options)</li>';\n        }\n        return _.map( options, function( option ){\n            if( option.divider ){\n                return '<li class=\"divider\"></li>';\n            } else if( option.header ){\n                return [ '<li class=\"head\"><a href=\"javascript:void(0);\">', option.html, '</a></li>' ].join( '' );\n            }\n            var href   = option.href || 'javascript:void(0);',\n                target = ( option.target  )?( ' target=\"' + option.target + '\"' ):( '' ),\n                check  = ( option.checked )?( '<span class=\"fa fa-check\"></span>' ):( '' );\n            return [\n                '<li><a class=\"popupmenu-option\" href=\"', href, '\"', target, '>',\n                    check, option.html,\n                '</a></li>'\n            ].join( '' );\n        }).join( '' );\n    },\n\n    // get the absolute position/offset for the menu\n    _getShownPosition : function( clickEvent ){\n\n        // display menu horiz. centered on click...\n        var menuWidth = this.$el.width();\n        var x = clickEvent.pageX - menuWidth / 2 ;\n\n        // adjust to handle horiz. scroll and window dimensions ( draw entirely on visible screen area )\n        x = Math.min( x, $( document ).scrollLeft() + $( window ).width() - menuWidth - 5 );\n        x = Math.max( x, $( document ).scrollLeft() + 5 );\n        return {\n            top: clickEvent.pageY,\n            left: x\n        };\n    },\n\n    // bind an event handler to all available frames so that when anything is clicked\n    // the menu is removed from the DOM and the event handler unbinds itself\n    _setUpCloseBehavior: function(){\n        var menu = this;\n//TODO: alternately: focus hack, blocking overlay, jquery.blockui\n\n        // function to close popup and unbind itself\n        function closePopup( event ){\n            $( document ).off( 'click.close_popup' );\n            if( window && window.parent !== window ){\n                try {\n                    $( window.parent.document ).off( \"click.close_popup\" );\n                } catch( err ){}\n            } else {\n                try {\n                    $( 'iframe#galaxy_main' ).contents().off( \"click.close_popup\" );\n                } catch( err ){}\n            }\n            menu.remove();\n        }\n\n        $( 'html' ).one( \"click.close_popup\", closePopup );\n        if( window && window.parent !== window ){\n            try {\n                $( window.parent.document ).find( 'html' ).one( \"click.close_popup\", closePopup );\n            } catch( err ){}\n        } else {\n            try {\n                $( 'iframe#galaxy_main' ).contents().one( \"click.close_popup\", closePopup );\n            } catch( err ){}\n        }\n    },\n\n    // add a menu option/item at the given index\n    addItem: function( item, index ){\n        // append to end if no index\n        index = ( index >= 0 ) ? index : this.options.length;\n        this.options.splice( index, 0, item );\n        return this;\n    },\n\n    // remove a menu option/item at the given index\n    removeItem: function( index ){\n        if( index >=0 ){\n            this.options.splice( index, 1 );\n        }\n        return this;\n    },\n\n    // search for a menu option by its html\n    findIndexByHtml: function( html ){\n        for( var i = 0; i < this.options.length; i++ ){\n            if( _.has( this.options[i], 'html' ) && ( this.options[i].html === html )){\n                return i;\n            }\n        }\n        return null;\n    },\n\n    // search for a menu option by its html\n    findItemByHtml: function( html ){\n        return this.options[( this.findIndexByHtml( html ))];\n    },\n\n    // string representation\n    toString: function(){\n        return 'PopupMenu';\n    }\n});\n/** shortcut to new for when you don't need to preserve the ref */\nPopupMenu.create = function _create( $button, options ){\n    return new PopupMenu( $button, options );\n};\n\n// -----------------------------------------------------------------------------\n// the following class functions are bridges from the original make_popupmenu and make_popup_menus\n// to the newer backbone.js PopupMenu\n\n/** Create a PopupMenu from simple map initial_options activated by clicking button_element.\n *      Converts initial_options to object array used by PopupMenu.\n *  @param {jQuery|DOMElement} button_element element which, when clicked, activates menu\n *  @param {Object} initial_options map of key -> values, where\n *      key is option text, value is fn to call when option is clicked\n *  @returns {PopupMenu} the PopupMenu created\n */\nPopupMenu.make_popupmenu = function( button_element, initial_options ){\n    var convertedOptions = [];\n    _.each( initial_options, function( optionVal, optionKey ){\n        var newOption = { html: optionKey };\n\n        // keys with null values indicate: header\n        if( optionVal === null ){ // !optionVal? (null only?)\n            newOption.header = true;\n\n        // keys with function values indicate: a menu option\n        } else if( jQuery.type( optionVal ) === 'function' ){\n            newOption.func = optionVal;\n        }\n        //TODO:?? any other special optionVals?\n        // there was no divider option originally\n        convertedOptions.push( newOption );\n    });\n    return new PopupMenu( $( button_element ), convertedOptions );\n};\n\n/** Find all anchors in $parent (using selector) and covert anchors into a PopupMenu options map.\n *  @param {jQuery} $parent the element that contains the links to convert to options\n *  @param {String} selector jq selector string to find links\n *  @returns {Object[]} the options array to initialize a PopupMenu\n */\n//TODO: lose parent and selector, pass in array of links, use map to return options\nPopupMenu.convertLinksToOptions = function( $parent, selector ){\n    $parent = $( $parent );\n    selector = selector || 'a';\n    var options = [];\n    $parent.find( selector ).each( function( elem, i ){\n        var option = {}, $link = $( elem );\n\n        // convert link text to the option text (html) and the href into the option func\n        option.html = $link.text();\n        if( $link.attr( 'href' ) ){\n            var linkHref    = $link.attr( 'href' ),\n                linkTarget  = $link.attr( 'target' ),\n                confirmText = $link.attr( 'confirm' );\n\n            option.func = function(){\n                // if there's a \"confirm\" attribute, throw up a confirmation dialog, and\n                //  if the user cancels - do nothing\n                if( ( confirmText ) && ( !confirm( confirmText ) ) ){ return; }\n\n                // if there's no confirm attribute, or the user accepted the confirm dialog:\n                switch( linkTarget ){\n                    // relocate the center panel\n                    case '_parent':\n                        window.parent.location = linkHref;\n                        break;\n\n                    // relocate the entire window\n                    case '_top':\n                        window.top.location = linkHref;\n                        break;\n\n                    // relocate this panel\n                    default:\n                        window.location = linkHref;\n                }\n            };\n        }\n        options.push( option );\n    });\n    return options;\n};\n\n/** Create a single popupmenu from existing DOM button and anchor elements\n *  @param {jQuery} $buttonElement the element that when clicked will open the menu\n *  @param {jQuery} $menuElement the element that contains the anchors to convert into a menu\n *  @param {String} menuElementLinkSelector jq selector string used to find anchors to be made into menu options\n *  @returns {PopupMenu} the PopupMenu (Backbone View) that can render, control the menu\n */\nPopupMenu.fromExistingDom = function( $buttonElement, $menuElement, menuElementLinkSelector ){\n    $buttonElement = $( $buttonElement );\n    $menuElement = $( $menuElement );\n    var options = PopupMenu.convertLinksToOptions( $menuElement, menuElementLinkSelector );\n    // we're done with the menu (having converted it to an options map)\n    $menuElement.remove();\n    return new PopupMenu( $buttonElement, options );\n};\n\n/** Create all popupmenus within a document or a more specific element\n *  @param {DOMElement} parent the DOM element in which to search for popupmenus to build (defaults to document)\n *  @param {String} menuSelector jq selector string to find popupmenu menu elements (defaults to \"div[popupmenu]\")\n *  @param {Function} buttonSelectorBuildFn the function to build the jq button selector.\n *      Will be passed $menuElement, parent.\n *      (Defaults to return '#' + $menuElement.attr( 'popupmenu' ); )\n *  @returns {PopupMenu[]} array of popupmenus created\n */\nPopupMenu.make_popup_menus = function( parent, menuSelector, buttonSelectorBuildFn ){\n    parent = parent || document;\n    // orig. Glx popupmenu menus have a (non-std) attribute 'popupmenu'\n    //  which contains the id of the button that activates the menu\n    menuSelector = menuSelector || 'div[popupmenu]';\n    // default to (orig. Glx) matching button to menu by using the popupmenu attr of the menu as the id of the button\n    buttonSelectorBuildFn = buttonSelectorBuildFn || function( $menuElement, parent ){\n        return '#' + $menuElement.attr( 'popupmenu' );\n    };\n\n    // aggregate and return all PopupMenus\n    var popupMenusCreated = [];\n    $( parent ).find( menuSelector ).each( function(){\n        var $menuElement    = $( this ),\n            $buttonElement  = $( parent ).find( buttonSelectorBuildFn( $menuElement, parent ) );\n        popupMenusCreated.push( PopupMenu.fromDom( $buttonElement, $menuElement ) );\n        $buttonElement.addClass( 'popup' );\n    });\n    return popupMenusCreated;\n};\n\n\n// =============================================================================\n    return PopupMenu;\n});\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/popup-menu.js\n **/","/** Renders the color picker used e.g. in the tool form **/\ndefine(['utils/utils'], function( Utils ) {\n    return Backbone.View.extend({\n        colors: {\n            standard: ['c00000','ff0000','ffc000','ffff00','92d050','00b050','00b0f0','0070c0','002060','7030a0'],\n            base    : ['ffffff','000000','eeece1','1f497d','4f81bd','c0504d','9bbb59','8064a2','4bacc6','f79646'],\n            theme   :[['f2f2f2','7f7f7f','ddd9c3','c6d9f0','dbe5f1','f2dcdb','ebf1dd','e5e0ec','dbeef3','fdeada'],\n                      ['d8d8d8','595959','c4bd97','8db3e2','b8cce4','e5b9b7','d7e3bc','ccc1d9','b7dde8','fbd5b5'],\n                      ['bfbfbf','3f3f3f','938953','548dd4','95b3d7','d99694','c3d69b','b2a2c7','92cddc','fac08f'],\n                      ['a5a5a5','262626','494429','17365d','366092','953734','76923c','5f497a','31859b','e36c09'],\n                      ['7f7f7e','0c0c0c','1d1b10','0f243e','244061','632423','4f6128','3f3151','205867','974806']]\n        },\n        initialize : function( options ) {\n            this.options = Utils.merge( options, {} );\n            this.setElement( this._template() );\n\n            // link components\n            this.$panel = this.$( '.ui-color-picker-panel' );\n            this.$view = this.$( '.ui-color-picker-view' );\n            this.$value = this.$( '.ui-color-picker-value' );\n            this.$header = this.$( '.ui-color-picker-header' );\n\n            // build panel\n            this._build();\n\n            // hide panel on start up\n            this.visible = false;\n\n            // set initial value\n            this.value( this.options.value );\n\n            // link boxes\n            this.$boxes = this.$( '.ui-color-picker-box' );\n\n            // add event handler\n            var self = this;\n            this.$boxes.on( 'click', function() {\n                self.value( $( this ).css( 'background-color' ) );\n                self.$header.trigger( 'click' );\n            } );\n            this.$header.on( 'click', function() {\n                self.visible = !self.visible;\n                if ( self.visible ) {\n                    self.$view.fadeIn( 'fast' );\n                } else {\n                    self.$view.fadeOut( 'fast' );\n                }\n            } );\n        },\n\n        // value\n        value : function ( new_val ) {\n            if ( new_val !== undefined && new_val !== null ) {\n                // update color value\n                this.$value.css( 'background-color', new_val );\n            \n                // check selected color in panel\n                this.$( '.ui-color-picker-box' ).empty();\n                this.$( this._getValue() ).html( this._templateCheck() );\n\n                // trigger custom event\n                this.options.onchange && this.options.onchange( new_val );\n            }\n\n            // return current value\n            return this._getValue();\n        },\n\n        // get value from dom\n        _getValue: function() {\n            var rgb = this.$value.css( 'background-color' );\n            rgb = rgb.match(/^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$/);\n            if ( rgb ) {\n                function hex( x ) {\n                    return ( '0' + parseInt( x ).toString( 16 ) ).slice( -2 );\n                }\n                return '#' + hex( rgb[ 1] ) + hex( rgb[ 2 ] ) + hex( rgb[ 3 ] );\n            } else {\n                return null;\n            }\n        },\n\n        // build panel\n        _build: function() {\n            var $content = this._content({\n                label       : 'Theme Colors',\n                colors      : this.colors.base,\n                padding     : 10\n            });\n            for ( var i in this.colors.theme ) {\n                var line_def = {};\n                if ( i == 0 ) {\n                    line_def[ 'bottom' ] = true;\n                } else {\n                    if ( i != this.colors.theme.length - 1 ) {\n                        line_def[ 'top' ]     = true;\n                        line_def[ 'bottom' ]  = true;\n                    } else {\n                        line_def[ 'top' ]     = true;\n                        line_def[ 'padding' ] = 5;\n                    }\n                }\n                line_def[ 'colors' ] = this.colors.theme[ i ];\n                this._content( line_def );\n            }\n            this._content({\n                label       : 'Standard Colors',\n                colors      : this.colors.standard,\n                padding     : 5\n            });\n        },\n\n        // create content\n        _content: function( options ) {\n            // get parameters\n            var label       = options.label;\n            var colors      = options.colors;\n            var padding     = options.padding;\n            var top         = options.top;\n            var bottom      = options.bottom;\n\n            // create lines\n            var $content = $( this._templateContent() );\n\n            // set label\n            var $label = $content.find( '.label' );\n            if ( options.label ) {\n                $label.html( options.label );\n            } else {\n                $label.hide();\n            }\n\n            // build line\n            var $line = $content.find( '.line' );\n            this.$panel.append( $content );\n            for ( var i in colors ) {\n                var $box = $( this._templateBox( colors[ i ] ) );\n                if ( top ) {\n                    $box.css( 'border-top', 'none' );\n                    $box.css( 'border-top-left-radius', '0px' );\n                    $box.css( 'border-top-right-radius', '0px' );\n                }\n                if ( bottom ) {\n                    $box.css( 'border-bottom', 'none' );\n                    $box.css( 'border-bottom-left-radius', '0px' );\n                    $box.css( 'border-bottom-right-radius', '0px' );\n                }\n                $line.append( $box );\n            }\n            if (padding) {\n                $line.css( 'padding-bottom', padding );\n            }\n            return $content;\n        },\n\n        // check icon\n        _templateCheck: function() {\n            return  '<div class=\"ui-color-picker-check fa fa-check\"/>';\n        },\n\n        // content template\n        _templateContent: function() {\n            return  '<div class=\"ui-color-picker-content\">' +\n                        '<div class=\"label\"/>' +\n                        '<div class=\"line\"/>' +\n                    '</div>';\n        },\n\n        // box template\n        _templateBox: function( color ) {\n            return '<div id=\"' + color + '\" class=\"ui-color-picker-box\" style=\"background-color: #' + color + ';\"/>';\n        },\n\n        // template\n        _template: function() {\n            return  '<div class=\"ui-color-picker\">' +\n                        '<div class=\"ui-color-picker-header\">' +\n                            '<div class=\"ui-color-picker-value\"/>' +\n                            '<div class=\"ui-color-picker-label\">Select a color</div>' +\n                        '</div>' +\n                        '<div class=\"ui-color-picker-view ui-input\">' +\n                            '<div class=\"ui-color-picker-panel\"/>' +\n                        '</div>'\n                    '</div>';\n        }\n    });\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/ui-color-picker.js\n **/","/** This class creates/wraps a drill down element. */\ndefine([ 'utils/utils', 'mvc/ui/ui-options' ], function( Utils, Options ) {\n\nvar View = Options.BaseIcons.extend({\n    initialize: function( options ) {\n        options.type     = options.display || 'checkbox';\n        options.multiple = ( options.type == 'checkbox' );\n        Options.BaseIcons.prototype.initialize.call( this, options );\n    },\n\n    /** Set states for selected values */\n    _setValue: function ( new_value ) {\n        Options.BaseIcons.prototype._setValue.call( this, new_value );\n        if ( new_value !== undefined && new_value !== null && this.header_index ) {\n            var self = this;\n            var values = $.isArray( new_value ) ? new_value : [ new_value ];\n            _.each( values, function( v ) {\n                var list = self.header_index[ v ];\n                _.each( list, function( element ) {\n                    self._setState( element, true );\n                });\n            });\n        }\n    },\n\n    /** Expand/collapse a sub group */\n    _setState: function ( header_id, is_expanded ) {\n        var $button = this.$( '.button-' + header_id );\n        var $subgroup = this.$( '.subgroup-' + header_id );\n        $button.data( 'is_expanded', is_expanded );\n        if ( is_expanded ) {\n            $subgroup.show();\n            $button.removeClass( 'fa-plus-square' ).addClass( 'fa-minus-square' );\n        } else {\n            $subgroup.hide();\n            $button.removeClass( 'fa-minus-square' ).addClass( 'fa-plus-square' );\n        }\n    },\n\n    /** Template to create options tree */\n    _templateOptions: function() {\n        var self = this;\n        this.header_index = {};\n\n        // attach event handler\n        function attach( $el, header_id ) {\n            var $button = $el.find( '.button-' + header_id );\n            $button.on( 'click', function() {\n                self._setState( header_id, !$button.data( 'is_expanded' ) );\n            });\n        }\n\n        // recursive function which iterates through options\n        function iterate ( $tmpl, options, header ) {\n            header = header || [];\n            for ( i in options ) {\n                var level = options[ i ];\n                var has_options = level.options && level.options.length > 0;\n                var new_header = header.slice( 0 );\n                self.header_index[ level.value ] = new_header.slice( 0 );\n                var $group = $( '<div/>' );\n                if ( has_options ) {\n                    var header_id = Utils.uid();\n                    var $button = $( '<span/>' ).addClass( 'button-' + header_id ).addClass( 'ui-drilldown-button fa fa-plus-square' );\n                    var $subgroup = $( '<div/>' ).addClass( 'subgroup-' + header_id ).addClass( 'ui-drilldown-subgroup' );\n                    $group.append( $( '<div/>' )\n                                        .append( $button )\n                                        .append( self._templateOption( { label: level.name, value: level.value } ) ) );\n                    new_header.push( header_id );\n                    iterate ( $subgroup, level.options, new_header );\n                    $group.append( $subgroup );\n                    attach( $group, header_id );\n                } else {\n                    $group.append( self._templateOption( { label: level.name, value: level.value } ) );\n                }\n                $tmpl.append( $group );\n            }\n        }\n\n        // iterate through options and create dom\n        var $tmpl = $( '<div/>' );\n        iterate( $tmpl, this.model.get( 'data' ) );\n        return $tmpl;\n    },\n\n    /** Template for drill down view */\n    _template: function() {\n        return $( '<div/>' ).addClass( 'ui-options-list drilldown-container' ).attr( 'id', this.model.id );\n    }\n});\n\nreturn {\n    View: View\n}\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/ui-drilldown.js\n **/","define([ 'utils/utils', 'mvc/ui/ui-misc', 'mvc/ui/ui-select-default' ], function( Utils, Ui, Select ) {\n\n/** Batch mode variations */\nvar Batch = { DISABLED: 'disabled', ENABLED: 'enabled', LINKED: 'linked' };\n\n/** List of available content selectors options */\nvar Configurations = {\n    data: [\n        { src: 'hda',  icon: 'fa-file-o',   tooltip: 'Single dataset',       multiple: false,   batch: Batch.DISABLED   },\n        { src: 'hda',  icon: 'fa-files-o',  tooltip: 'Multiple datasets',    multiple: true,    batch: Batch.LINKED     },\n        { src: 'hdca', icon: 'fa-folder-o', tooltip: 'Dataset collection',   multiple: false,   batch: Batch.LINKED     } ],\n    data_multiple: [\n        { src: 'hda',  icon: 'fa-files-o',  tooltip: 'Multiple datasets',    multiple: true,    batch: Batch.DISABLED   },\n        { src: 'hdca', icon: 'fa-folder-o', tooltip: 'Dataset collection',   multiple: false,   batch: Batch.DISABLED   } ],\n    data_collection: [\n        { src: 'hdca', icon: 'fa-folder-o', tooltip: 'Dataset collection',   multiple: false,   batch: Batch.DISABLED   } ],\n    workflow_data: [\n        { src: 'hda',  icon: 'fa-file-o',   tooltip: 'Single dataset',       multiple: false,   batch: Batch.DISABLED   } ],\n    workflow_data_multiple: [\n        { src: 'hda',  icon: 'fa-files-o',  tooltip: 'Multiple datasets',    multiple: true,    batch: Batch.DISABLED   } ],\n    workflow_data_collection: [\n        { src: 'hdca', icon: 'fa-folder-o', tooltip: 'Dataset collection',   multiple: false,   batch: Batch.DISABLED   } ],\n    module_data: [\n        { src: 'hda',  icon: 'fa-file-o',   tooltip: 'Single dataset',       multiple: false,   batch: Batch.DISABLED   },\n        { src: 'hda',  icon: 'fa-files-o',  tooltip: 'Multiple datasets',    multiple: true,    batch: Batch.ENABLED    } ],\n    module_data_collection: [\n        { src: 'hdca', icon: 'fa-folder-o', tooltip: 'Dataset collection',   multiple: false,   batch: Batch.DISABLED   },\n        { src: 'hdca', icon: 'fa-folder',   tooltip: 'Multiple collections', multiple: true,    batch: Batch.ENABLED    } ]\n};\n\n/** View for hda and hdca content selector ui elements */\nvar View = Backbone.View.extend({\n    initialize : function( options ) {\n        var self = this;\n        this.model = options && options.model || new Backbone.Model({\n            src_labels: { 'hda' : 'dataset', 'hdca': 'dataset collection' }\n        }).set( options );\n        this.setElement( $( '<div/>' ).addClass( 'ui-select-content' ) );\n        this.button_product = new Ui.RadioButton.View( {\n            value       : 'false',\n            data        : [ { icon: 'fa fa-chain', value: 'false',\n                              tooltip: 'Linked inputs will be run in matched order with other datasets e.g. use this for matching forward and reverse reads.' },\n                            { icon: 'fa fa-chain-broken',  value: 'true',\n                              tooltip: 'Unlinked dataset inputs will be run against *all* other inputs.' } ] } );\n        var $batch_div = $( '<div/>' ).addClass( 'ui-form-info' )\n                            .append( $( '<i/>' ).addClass( 'fa fa-sitemap' ) )\n                            .append( $( '<span/>' ).html( 'This is a batch mode input field. Separate jobs will be triggered for each dataset selection.' ) );\n        this.$batch = {\n            linked  : $batch_div.clone(),\n            enabled : $batch_div.clone().append( $( '<div/>' )\n                                                    .append( $( '<div/>' ).addClass( 'ui-form-title' ).html( 'Batch options:' ) )\n                                                    .append( this.button_product.$el ) )\n                                                    .append( $( '<div/>' ).css( 'clear', 'both' ) )\n        };\n\n        // track current history elements\n        this.history = {};\n\n        // add listeners\n        this.listenTo( this.model, 'change:data', this._changeData, this );\n        this.listenTo( this.model, 'change:wait', this._changeWait, this );\n        this.listenTo( this.model, 'change:current', this._changeCurrent, this );\n        this.listenTo( this.model, 'change:value', this._changeValue, this );\n        this.listenTo( this.model, 'change:type change:optional change:multiple change:extensions', this._changeType, this );\n        this.render();\n\n        // add change event\n        this.on( 'change', function() { options.onchange && options.onchange( self.value() ) } );\n    },\n\n    render: function() {\n        this._changeType();\n        this._changeValue();\n        this._changeWait();\n    },\n\n    /** Indicate that select fields are being updated */\n    wait: function() {\n        this.model.set( 'wait', true );\n    },\n\n    /** Indicate that the options update has been completed */\n    unwait: function() {\n        this.model.set( 'wait', false );\n    },\n\n    /** Update data representing selectable options */\n    update: function( options ) {\n        this.model.set( 'data', options );\n    },\n\n    /** Return the currently selected dataset values */\n    value: function ( new_value ) {\n        new_value !== undefined && this.model.set( 'value', new_value );\n        var current = this.model.get( 'current' );\n        if ( this.config[ current ] ) {\n            var id_list = this.fields[ current ].value();\n            if (id_list !== null) {\n                id_list = $.isArray( id_list ) ? id_list : [ id_list ];\n                if ( id_list.length > 0 ) {\n                    var result = this._batch( { values: [] } );\n                    for ( var i in id_list ) {\n                        var details = this.history[ id_list[ i ] + '_' + this.config[ current ].src ];\n                        if ( details ) {\n                            result.values.push( details );\n                        } else {\n                            Galaxy.emit.debug( 'ui-select-content::value()', 'Requested details not found for \\'' + id_list[ i ] + '\\'.'  );\n                            return null;\n                        }\n                    }\n                    result.values.sort( function( a, b ) { return a.hid - b.hid } );\n                    return result;\n                }\n            }\n        } else {\n            Galaxy.emit.debug( 'ui-select-content::value()', 'Invalid value/source \\'' + new_value + '\\'.'  );\n        }\n        return null;\n    },\n\n    /** Change of current select field */\n    _changeCurrent: function() {\n        var self = this;\n        _.each( this.fields, function( field, i ) {\n            if ( self.model.get( 'current' ) == i ) {\n                field.$el.show();\n                _.each( self.$batch, function( $batchfield, batchmode ) {\n                    $batchfield[ self.config[ i ].batch == batchmode ? 'show' : 'hide' ]();\n                });\n                self.button_type.value( i );\n            } else {\n                field.$el.hide();\n            }\n        });\n    },\n\n    /** Change of type */\n    _changeType: function() {\n        var self = this;\n\n        // identify selector type identifier i.e. [ flavor ]_[ type ]_[ multiple ]\n        var config_id = ( this.model.get( 'flavor' ) ? this.model.get( 'flavor' ) + '_' : '' ) +\n                        String( this.model.get( 'type' ) ) + ( this.model.get( 'multiple' ) ? '_multiple' : '' );\n        if ( Configurations[ config_id ] ) {\n            this.config = Configurations[ config_id ];\n        } else {\n            this.config = Configurations[ 'data' ];\n            Galaxy.emit.debug( 'ui-select-content::_changeType()', 'Invalid configuration/type id \\'' + config_id + '\\'.'  );\n        }\n\n        // prepare extension component of error message\n        var extensions = Utils.textify( this.model.get( 'extensions' ) );\n        var src_labels = this.model.get( 'src_labels' );\n\n        // build views\n        this.fields = [];\n        this.button_data = [];\n        _.each( this.config, function( c, i ) {\n            self.button_data.push({\n                value   : i,\n                icon    : c.icon,\n                tooltip : c.tooltip\n            });\n            self.fields.push(\n                new Select.View({\n                    optional    : self.model.get( 'optional' ),\n                    multiple    : c.multiple,\n                    searchable  : !c.multiple,\n                    error_text  : 'No ' + ( extensions ? extensions + ' ' : '' ) + ( src_labels[ c.src ] || 'content' ) + ' available.',\n                    onchange    : function() {\n                        self.trigger( 'change' );\n                    }\n                })\n            );\n        });\n        this.button_type = new Ui.RadioButton.View({\n            value   : this.model.get( 'current' ),\n            data    : this.button_data,\n            onchange: function( value ) {\n                self.model.set( 'current', value );\n                self.trigger( 'change' );\n            }\n        });\n\n        // append views\n        this.$el.empty();\n        var button_width = 0;\n        if ( this.fields.length > 1 ) {\n            this.$el.append( this.button_type.$el );\n            button_width = Math.max( 0, this.fields.length * 35 ) + 'px';\n        }\n        _.each( this.fields, function( field ) {\n            self.$el.append( field.$el.css( { 'margin-left': button_width } ) );\n        });\n        _.each( this.$batch, function( $batchfield, batchmode ) {\n            self.$el.append( $batchfield.css( { 'margin-left': button_width } ) );\n        });\n        this.model.set( 'current', 0 );\n        this._changeCurrent();\n        this._changeData();\n    },\n\n    /** Change of wait flag */\n    _changeWait: function() {\n        var self = this;\n        _.each( this.fields, function( field ) { field[ self.model.get( 'wait' ) ? 'wait' : 'unwait' ]() } );\n    },\n\n    /** Change of available options */\n    _changeData: function() {\n        var options = this.model.get( 'data' );\n        var self = this;\n        var select_options = {};\n        _.each( options, function( items, src ) {\n            select_options[ src ] = [];\n            _.each( items, function( item ) {\n                select_options[ src ].push({\n                    hid  : item.hid,\n                    label: item.hid + ': ' + item.name,\n                    value: item.id\n                });\n                self.history[ item.id + '_' + src ] = item;\n            });\n        });\n        _.each( this.config, function( c, i ) {\n            select_options[ c.src ] && self.fields[ i ].add( select_options[ c.src ], function( a, b ) { return b.hid - a.hid } );\n        });\n    },\n\n    /** Change of incoming value */\n    _changeValue: function () {\n        var new_value = this.model.get( 'value' );\n        if ( new_value && new_value.values && new_value.values.length > 0 ) {\n            // create list with content ids\n            var list = [];\n            _.each( new_value.values, function( value ) {\n                list.push( value.id );\n            });\n            // sniff first suitable field type from config list\n            var src = new_value.values[ 0 ].src;\n            var multiple = new_value.values.length > 1;\n            for( var i = 0; i < this.config.length; i++ ) {\n                var field = this.fields[ i ];\n                var c = this.config[ i ];\n                if ( c.src == src && [ multiple, true ].indexOf( c.multiple ) !== -1 ) {\n                    this.model.set( 'current', i );\n                    field.value( list );\n                    break;\n                }\n            }\n        } else {\n            _.each( this.fields, function( field ) {\n                field.value( null );\n            });\n        }\n    },\n\n    /** Assists in identifying the batch mode */\n    _batch: function( result ) {\n        result[ 'batch' ] = false;\n        var current = this.model.get( 'current' );\n        var config = this.config[ current ];\n        if ( config.src == 'hdca' && !config.multiple ) {\n            var hdca = this.history[ this.fields[ current ].value() + '_hdca' ];\n            if ( hdca && hdca.map_over_type ) {\n                result[ 'batch' ] = true;\n            }\n        }\n        if ( config.batch == Batch.LINKED || config.batch == Batch.ENABLED ) {\n            result[ 'batch' ] = true;\n            if ( config.batch == Batch.ENABLED && this.button_product.value() === 'true' ) {\n                result[ 'product' ] = true;\n            }\n        }\n        return result;\n    }\n});\n\nreturn {\n    View: View\n}\n\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/ui-select-content.js\n **/","// dependencies\ndefine(['utils/utils', 'mvc/ui/ui-list'],\n        function(Utils, List) {\n\n/**\n * FTP file selector\n */\nvar View = Backbone.View.extend({\n    // initialize\n    initialize : function(options) {\n        // link this\n        var self = this;\n\n        // create ui-list view to keep track of selected ftp files\n        this.ftpfile_list = new List.View({\n            name        : 'file',\n            optional    : options.optional,\n            multiple    : options.multiple,\n            onchange    : function() {\n                options.onchange && options.onchange(self.value());\n            }\n        });\n\n        // create elements\n        this.setElement(this.ftpfile_list.$el);\n\n        // initial fetch of ftps\n        Utils.get({\n            url     : Galaxy.root + 'api/remote_files',\n            success : function(response) {\n                var data = [];\n                for (var i in response) {\n                    data.push({\n                        value   : response[i]['path'],\n                        label   : response[i]['path']\n                    });\n                }\n                self.ftpfile_list.update(data);\n            }\n        });\n    },\n\n    /** Return/Set currently selected ftp datasets */\n    value: function(val) {\n        return this.ftpfile_list.value(val);\n    }\n});\n\nreturn {\n    View: View\n}\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/ui-select-ftp.js\n **/","// dependencies\ndefine(['utils/utils', 'mvc/ui/ui-misc', 'mvc/ui/ui-table', 'mvc/ui/ui-list'],\n        function(Utils, Ui, Table, List) {\n\n// collection of libraries\nvar Libraries = Backbone.Collection.extend({\n    url: Galaxy.root + 'api/libraries?deleted=false'\n});\n\n// collection of dataset\nvar LibraryDatasets = Backbone.Collection.extend({\n    initialize: function() {\n        var self = this;\n        this.config = new Backbone.Model({ library_id: null });\n        this.config.on('change', function() {\n            self.fetch({ reset: true });\n        });\n    },\n    url: function() {\n        return Galaxy.root + 'api/libraries/' + this.config.get('library_id') + '/contents';\n    }\n});\n\n// hda/hdca content selector ui element\nvar View = Backbone.View.extend({\n    // initialize\n    initialize : function(options) {\n        // link this\n        var self = this;\n\n        // collections\n        this.libraries  = new Libraries();\n        this.datasets   = new LibraryDatasets();\n\n        // link app and options\n        this.options = options;\n\n        // select field for the library\n        // TODO: Remove this once the library API supports searching for library datasets\n        this.library_select = new Ui.Select.View({\n            onchange    : function(value) {\n                self.datasets.config.set('library_id', value);\n            }\n        });\n\n        // create ui-list view to keep track of selected data libraries\n        this.dataset_list = new List.View({\n            name        : 'dataset',\n            optional    : options.optional,\n            multiple    : options.multiple,\n            onchange    : function() {\n                self.trigger('change');\n            }\n        });\n\n        // add reset handler for fetched libraries\n        this.libraries.on('reset', function() {\n            var data = [];\n            self.libraries.each(function(model) {\n                data.push({\n                    value   : model.id,\n                    label   : model.get('name')\n                });\n            });\n            self.library_select.update(data);\n        });\n\n        // add reset handler for fetched library datasets\n        this.datasets.on('reset', function() {\n            var data = [];\n            var library_current = self.library_select.text();\n            if (library_current !== null) {\n                self.datasets.each(function(model) {\n                    if (model.get('type') === 'file') {\n                        data.push({\n                            value   : model.id,\n                            label   : model.get('name')\n                        });\n                    }\n                });\n            }\n            self.dataset_list.update(data);\n        });\n\n        // add change event. fires on trigger\n        this.on('change', function() {\n            options.onchange && options.onchange(self.value());\n        });\n\n        // create elements\n        this.setElement(this._template());\n        this.$('.library-select').append(this.library_select.$el);\n        this.$el.append(this.dataset_list.$el);\n\n        // initial fetch of libraries\n        this.libraries.fetch({\n            reset: true,\n            success: function() {\n                self.library_select.trigger('change');\n                if (self.options.value !== undefined) {\n                    self.value(self.options.value);\n                }\n            }\n        });\n    },\n\n    /** Return/Set currently selected library datasets */\n    value: function(val) {\n        return this.dataset_list.value(val);\n    },\n\n    /** Template */\n    _template: function() {\n        return  '<div class=\"ui-select-library\">' +\n                    '<div class=\"library ui-margin-bottom\">' +\n                        '<span class=\"library-title\">Select Library</span>' +\n                        '<span class=\"library-select\"/>' +\n                    '</div>' +\n                '</div>';\n    }\n});\n\nreturn {\n    View: View\n}\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/ui-select-library.js\n **/","define([ 'utils/utils' ], function( Utils ) {\nvar View = Backbone.View.extend({\n    initialize : function( options ) {\n        var self = this;\n        this.options = Utils.merge( options, {\n            id      : Utils.uid(),\n            min     : null,\n            max     : null,\n            step    : null,\n            precise : false,\n            split   : 10000\n        } );\n\n        // create new element\n        this.setElement( this._template( this.options ) );\n\n        // determine wether to use the slider\n        this.useslider = this.options.max !== null && this.options.min !== null && this.options.max > this.options.min;\n\n        // set default step size\n        if ( this.options.step === null ) {\n            this.options.step = 1.0;\n            if ( this.options.precise && this.useslider ) {\n                this.options.step = ( this.options.max - this.options.min ) / this.options.split;\n            }\n        }\n\n        // create slider if min and max are defined properly\n        if ( this.useslider ) {\n            this.$slider = this.$( '#slider' );\n            this.$slider.slider( this.options );\n            this.$slider.on( 'slide', function ( event, ui ) {\n                self.value( ui.value );\n            });\n        } else {\n            this.$( '.ui-form-slider-text' ).css( 'width', '100%' );\n        }\n\n        // link text input field\n        this.$text = this.$( '#text' );\n\n        // set initial value\n        this.options.value !== undefined && ( this.value( this.options.value ) );\n\n        // add text field event\n        var pressed = [];\n        this.$text.on( 'change', function () {\n            self.value( $( this ).val() );\n        });\n        this.$text.on( 'keyup', function( e ) {\n            pressed[e.which] = false;\n            self.options.onchange && self.options.onchange( $( this ).val() );\n        });\n        this.$text.on( 'keydown', function ( e ) {\n            var v = e.which;\n            pressed[ v ] = true;\n            if ( self.options.is_workflow && pressed[ 16 ] && v == 52 ) {\n                self.value( '$' )\n                event.preventDefault();\n            } else if (!( v == 8 || v == 9 || v == 13 || v == 37 || v == 39 || ( v >= 48 && v <= 57 && !pressed[ 16 ] ) || ( v >= 96 && v <= 105 )\n                || ( ( v == 190 || v == 110 ) && $( this ).val().indexOf( '.' ) == -1 && self.options.precise )\n                || ( ( v == 189 || v == 109 ) && $( this ).val().indexOf( '-' ) == -1 )\n                || self._isParameter( $( this ).val() )\n                || pressed[ 91 ] || pressed[ 17 ] ) ) {\n                event.preventDefault();\n            }\n        });\n    },\n\n    /** Set and Return the current value\n    */\n    value : function ( new_val ) {\n        if ( new_val !== undefined ) {\n            if ( new_val !== null && new_val !== '' && !this._isParameter( new_val ) ) {\n                isNaN( new_val ) && ( new_val = 0 );\n                this.options.max !== null && ( new_val = Math.min( new_val, this.options.max ) );\n                this.options.min !== null && ( new_val = Math.max( new_val, this.options.min ) );\n            }\n            this.$slider && this.$slider.slider( 'value', new_val );\n            this.$text.val( new_val );\n            this.options.onchange && this.options.onchange( new_val );\n        }\n        return this.$text.val();\n    },\n\n    /** Return true if the field contains a workflow parameter i.e. $('name')\n    */\n    _isParameter: function( value ) {\n        return this.options.is_workflow && String( value ).substring( 0, 1 ) === '$';\n    },\n\n    /** Slider template\n    */\n    _template: function( options ) {\n        return  '<div id=\"' + options.id + '\" class=\"ui-form-slider\">' +\n                    '<input id=\"text\" type=\"text\" class=\"ui-form-slider-text\"/>' +\n                    '<div id=\"slider\" class=\"ui-form-slider-element\"/>' +\n                '</div>';\n    }\n});\n\nreturn {\n    View : View\n};\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/ui-slider.js\n **/","// dependencies\ndefine([], function() {\n\n// model\nvar Model = Backbone.Model.extend({\n    defaults: {\n        extension       : 'auto',\n        genome          : '?',\n        url_paste       : '',\n        status          : 'init',\n        info            : null,\n        file_name       : '',\n        file_mode       : '',\n        file_size       : 0,\n        file_type       : null,\n        file_path       : '',\n        file_data       : null,\n        percentage      : 0,\n        space_to_tab    : false,\n        to_posix_lines  : true,\n        enabled         : true\n    },\n    reset: function(attr) {\n        this.clear().set(this.defaults).set(attr);\n    }\n});\n\n// collection\nvar Collection = Backbone.Collection.extend({\n    model: Model\n});\n\n// return\nreturn {\n    Model: Model,\n    Collection : Collection\n};\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/upload/upload-model.js\n **/","define([\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( baseMVC, _l ){\n'use strict';\n\nvar logNamespace = 'user';\n//==============================================================================\n/** @class View to display a user's disk/storage usage\n *      either as a progress bar representing the percentage of a quota used\n *      or a simple text element displaying the human readable size used.\n *  @name UserQuotaMeter\n *  @augments Backbone.View\n */\nvar UserQuotaMeter = Backbone.View.extend( baseMVC.LoggableMixin ).extend(\n/** @lends UserQuotaMeter.prototype */{\n    _logNamespace : logNamespace,\n\n    /** Defaults for optional settings passed to initialize */\n    options : {\n        warnAtPercent   : 85,\n        errorAtPercent  : 100\n    },\n\n    /** Set up, accept options, and bind events */\n    initialize : function( options ){\n        this.log( this + '.initialize:', options );\n        _.extend( this.options, options );\n\n        //this.bind( 'all', function( event, data ){ this.log( this + ' event:', event, data ); }, this );\n        this.listenTo( this.model, 'change:quota_percent change:total_disk_usage', this.render );\n    },\n\n    /** Re-load user model data from the api */\n    update : function( options ){\n        this.log( this + ' updating user data...', options );\n        this.model.loadFromApi( this.model.get( 'id' ), options );\n        return this;\n    },\n\n    /** Is the user over their quota (if there is one)?\n     * @returns {Boolean} true if over quota, false if no quota or under quota\n     */\n    isOverQuota : function(){\n        return ( this.model.get( 'quota_percent' ) !== null\n              && this.model.get( 'quota_percent' ) >= this.options.errorAtPercent );\n    },\n\n    /** Render the meter when they have an applicable quota. Will render as a progress bar\n     *      with their percentage of that quota in text over the bar.\n     *  @fires quota:over when user is over quota (>= this.errorAtPercent)\n     *  @fires quota:under when user is under quota\n     *  @fires quota:under:approaching when user is >= this.warnAtPercent of their quota\n     *  @fires quota:under:ok when user is below this.warnAtPercent\n     *  @returns {jQuery} the rendered meter\n     */\n    _render_quota : function(){\n        var modelJson = this.model.toJSON(),\n            //prevPercent = this.model.previous( 'quota_percent' ),\n            percent = modelJson.quota_percent,\n            //meter = $( UserQuotaMeter.templates.quota( modelJson ) );\n            $meter = $( this._templateQuotaMeter( modelJson ) ),\n            $bar = $meter.find( '.progress-bar' );\n        //this.log( this + '.rendering quota, percent:', percent, 'meter:', meter );\n\n        // OVER QUOTA: color the quota bar and show the quota error message\n        if( this.isOverQuota() ){\n            //this.log( '\\t over quota' );\n            $bar.attr( 'class', 'progress-bar progress-bar-danger' );\n            $meter.find( '.quota-meter-text' ).css( 'color', 'white' );\n            //TODO: only trigger event if state has changed\n            this.trigger( 'quota:over', modelJson );\n\n        // APPROACHING QUOTA: color the quota bar\n        } else if( percent >= this.options.warnAtPercent ){\n            //this.log( '\\t approaching quota' );\n            $bar.attr( 'class', 'progress-bar progress-bar-warning' );\n            //TODO: only trigger event if state has changed\n            this.trigger( 'quota:under quota:under:approaching', modelJson );\n\n        // otherwise, hide/don't use the msg box\n        } else {\n            $bar.attr( 'class', 'progress-bar progress-bar-success' );\n            //TODO: only trigger event if state has changed\n            this.trigger( 'quota:under quota:under:ok', modelJson );\n        }\n        return $meter;\n    },\n\n    /** Render the meter when the user has NO applicable quota. Will render as text\n     *      showing the human readable sum storage their data is using.\n     *  @returns {jQuery} the rendered text\n     */\n    _render_usage : function(){\n        //var usage = $( UserQuotaMeter.templates.usage( this.model.toJSON() ) );\n        var usage = $( this._templateUsage( this.model.toJSON() ) );\n        this.log( this + '.rendering usage:', usage );\n        return usage;\n    },\n\n    /** Render either the quota percentage meter or the human readable disk usage\n     *      depending on whether the user model has quota info (quota_percent === null -> no quota)\n     *  @returns {Object} this UserQuotaMeter\n     */\n    render : function(){\n        //this.log( this + '.rendering' );\n        var meterHtml = null;\n\n        // no quota on server ('quota_percent' === null (can be valid at 0)), show usage instead\n        this.log( this + '.model.quota_percent:', this.model.get( 'quota_percent' ) );\n        if( ( this.model.get( 'quota_percent' ) === null )\n        ||  ( this.model.get( 'quota_percent' ) === undefined ) ){\n            meterHtml = this._render_usage();\n\n        // otherwise, render percent of quota (and warning, error)\n        } else {\n            meterHtml = this._render_quota();\n            //TODO: add the original text for unregistered quotas\n            //tooltip = \"Your disk quota is %s.  You can increase your quota by registering a Galaxy account.\"\n        }\n\n        this.$el.html( meterHtml );\n        this.$el.find( '.quota-meter-text' ).tooltip();\n        return this;\n    },\n\n    _templateQuotaMeter : function( data ){\n        return [\n            '<div id=\"quota-meter\" class=\"quota-meter progress\">',\n                '<div class=\"progress-bar\" style=\"width: ', data.quota_percent, '%\"></div>',\n                '<div class=\"quota-meter-text\" style=\"top: 6px\"',\n                    (( data.nice_total_disk_usage )?( ' title=\"Using ' + data.nice_total_disk_usage + '\">' ):( '>' )),\n                    _l( 'Using' ), ' ', data.quota_percent, '%',\n                '</div>',\n            '</div>'\n        ].join( '' );\n    },\n\n    _templateUsage : function( data ){\n        return [\n            '<div id=\"quota-meter\" class=\"quota-meter\" style=\"background-color: transparent\">',\n                '<div class=\"quota-meter-text\" style=\"top: 6px; color: white\">',\n                    (( data.nice_total_disk_usage )?( _l( 'Using ' ) + data.nice_total_disk_usage ):( '' )),\n                '</div>',\n            '</div>'\n        ].join( '' );\n    },\n\n    toString : function(){\n        return 'UserQuotaMeter(' + this.model + ')';\n    }\n});\n\n\n//==============================================================================\nreturn {\n    UserQuotaMeter : UserQuotaMeter\n};});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/user/user-quotameter.js\n **/","/**\n *  This class defines a queue to ensure that multiple deferred callbacks are executed sequentially.\n */\ndefine(['utils/utils'], function( Utils ) {\nreturn Backbone.Model.extend({\n    initialize: function(){\n        this.active = {};\n        this.last = null;\n    },\n\n    /** Adds a callback to the queue. Upon execution a deferred object is parsed to the callback i.e. callback( deferred ).\n     *  If the callback does not take any arguments, the deferred is resolved instantly.\n    */\n    execute: function( callback ) {\n        var self = this;\n        var id = Utils.uid();\n        var has_deferred = callback.length > 0;\n\n        // register process\n        this.active[ id ] = true;\n\n        // deferred process\n        var process = $.Deferred();\n        process.promise().always(function() {\n            delete self.active[ id ];\n            has_deferred && Galaxy.emit.debug( 'deferred::execute()', this.state().charAt(0).toUpperCase() + this.state().slice(1) + ' ' + id );\n        });\n\n        // deferred queue\n        $.when( this.last ).always(function() {\n            if ( self.active[ id ] ) {\n                has_deferred && Galaxy.emit.debug( 'deferred::execute()', 'Running ' + id );\n                callback( process );\n                !has_deferred && process.resolve();\n            } else {\n                process.reject();\n            }\n        });\n        this.last = process.promise();\n    },\n\n    /** Resets the promise queue. All currently queued but unexecuted callbacks/promises will be rejected.\n    */\n    reset: function() {\n        Galaxy.emit.debug('deferred::execute()', 'Reset');\n        for ( var i in this.active ) {\n            this.active[ i ] = false;\n        }\n    },\n\n    /** Returns true if all processes are done.\n    */\n    ready: function() {\n        return $.isEmptyObject( this.active );\n    }\n});\n\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/utils/deferred.js\n **/","define([\n], function(){\n/*global window, jQuery, console */\n/*=============================================================================\nTODO:\n    while anon: logs saved to 'logs-null' - this will never post\n        unless we manually do so at/after login\n        OR prepend when userId and localStorage has 'logs-null'\n    wire up _delayPost and test\n\n=============================================================================*/\n/** @class MetricsLogger\n *\n *  Object to cache, output, and post log/metric messages to the server.\n *  Meant to be attached to the Galaxy object.\n *\n *  Log from objects by either attaching logger directly:\n *      panel.logger.metric( 'user dataset deletion', panel.user.id, hda.toJSON() )\n *  or using the LoggableMixin or addLogging function:\n *      MyBackboneModel.extend( LoggableMixin ).extend({ ... })\n *      addLogging( MyBackboneModel, 'my-backbone-model' )\n *\n *  Log from templates by calling directly from Galaxy object:\n *      Galaxy.logger.metric( 'template loaded', { ownedByUser : true });\n *\n *  If you attempt to log an un-serializable object (circular reference, window, etc.),\n *  that entry will not be cached (or sent). If you set consoleLevel and consoleLogger\n *  appropriately, a warning will be shown when this happens:\n *      > panel.metric( 'something weird with window', { window : window })\n *      !'Metrics logger could not stringify logArguments: ...'\n */\nfunction MetricsLogger( options ){\n    options = options || {};\n    var self = this;\n\n    ///** get the current user's id from bootstrapped data or options */\n    self.userId = ( window.bootstrapped && window.bootstrapped.user )? window.bootstrapped.user.id: null;\n    self.userId = self.userId || options.userId || null;\n\n    /** the (optional) console to emit logs to */\n    self.consoleLogger = options.consoleLogger || null;\n\n    self._init( options );\n    return self;\n}\n\n//----------------------------------------------------------------------------- defaults and constants\n// see: python std lib, logging\nMetricsLogger.ALL   =  0;\nMetricsLogger.LOG   =  0;\nMetricsLogger.DEBUG = 10;\nMetricsLogger.INFO  = 20;\nMetricsLogger.WARN  = 30;\nMetricsLogger.ERROR = 40;\n// metrics levels here?\n//MetricsLogger.MinorEvent  = 45;\n//MetricsLogger.MajorEvent  = 50;\nMetricsLogger.METRIC = 50;\nMetricsLogger.NONE = 100;\n\n/** default options - override these through the constructor */\nMetricsLogger.defaultOptions = {\n    /** if an incoming message has a level >= this, it will be cached - can also be a string (e.g. 'debug') */\n    logLevel            : MetricsLogger.NONE,\n    /** if an incoming message has a level >= this, it will be output to the console */\n    consoleLevel        : MetricsLogger.NONE,\n    /** the default 'namespace' or label associated with an incoming message (if none is passed) */\n    defaultNamespace    : 'Galaxy',\n    /** the namespaces output to the console (all namespaces will be output if this is falsy)\n     *  note: applies only to the console (not the event/metrics log/cache)\n     */\n    consoleNamespaceWhitelist : null,\n    /** the prefix attached to client-side logs to distinguish them in the metrics db */\n    clientPrefix        : 'client.',\n\n    /** the maximum number of messages the cache should hold; if exceeded older messages are removed first */\n    maxCacheSize        : 3000,\n    /** the number of messages accumulate before posting to the server; should be <= maxCacheSize */\n    postSize            : 1000,\n    /** T/F whether to add a timestamp to incoming cached messages */\n    addTime             : true,\n    /** string to prefix to userid for cache web storage */\n    cacheKeyPrefix      : 'logs-',\n\n    /** the relative url to post messages to */\n    postUrl             : '/api/metrics',\n    /** delay before trying post again after two failures */\n    delayPostInMs       : 1000 * 60 * 10,\n\n    /** an (optional) function that should return an object; used to send additional data with the metrics */\n    getPingData         : undefined,\n    /** an (optional) function that will handle the servers response after successfully posting messages */\n    onServerResponse    : undefined\n};\n\n//----------------------------------------------------------------------------- set up\n/** initialize the logger with options, set up instance vars and cache, and add onpageunload to window */\nMetricsLogger.prototype._init = function _init( options ){\n    var self = this;\n    self.options = {};\n    for( var k in MetricsLogger.defaultOptions ){\n        if( MetricsLogger.defaultOptions.hasOwnProperty( k ) ){\n            self.options[ k ] = ( options.hasOwnProperty( k ) )?( options[ k ] ):( MetricsLogger.defaultOptions[ k ] );\n        }\n    }\n    self.options.logLevel = self._parseLevel( self.options.logLevel );\n    self.options.consoleLevel = self._parseLevel( self.options.consoleLevel );\n    //self._emitToConsole( 'debug', 'MetricsLogger', 'MetricsLogger.options:', self.options );\n\n    /** is the logger currently sending? */\n    self._sending = false;\n    /** the setTimeout id if the logger POST has failed more than once */\n    self._waiting = null;\n    /** the current number of entries to send in a POST */\n    self._postSize = self.options.postSize;\n\n    self._initCache();\n\n    return self;\n};\n\n/** initialize the cache */\nMetricsLogger.prototype._initCache = function _initCache(){\n    try {\n        this.cache = new LoggingCache({\n            maxSize : this.options.maxCacheSize,\n            key     : this.options.cacheKeyPrefix + this.userId\n        });\n    } catch( err ){\n        this._emitToConsole( 'warn', 'MetricsLogger', [ 'Could not intitialize logging cache:', err ] );\n        this.options.logLevel = MetricsLogger.NONE;\n    }\n};\n\n/** return the numeric log level if level in 'none, debug, log, info, warn, error' */\nMetricsLogger.prototype._parseLevel = function _parseLevel( level ){\n    var type = typeof level;\n    if( type === 'number' ){ return level; }\n    if( type === 'string' ){\n        var upper = level.toUpperCase();\n        if( MetricsLogger.hasOwnProperty( upper ) ){\n            return MetricsLogger[ upper ];\n        }\n    }\n    throw new Error( 'Unknown log level: ' + level );\n};\n\n\n//----------------------------------------------------------------------------- main entry point\n/** record a log/message's arguments to the cache and/or the console based on level and namespace */\nMetricsLogger.prototype.emit = function emit( level, namespace, logArguments ){\n    //this._emitToConsole( 'debug', 'MetricsLogger', [ 'emit:', level, namespace, logArguments ]);\n    var self = this;\n    namespace = namespace || self.options.defaultNamespace;\n    if( !level || !logArguments ){\n        return self;\n    }\n    // add to cache if proper level\n    //TODO: respect do not track?\n    //if( !navigator.doNotTrack && level >= self.options.logLevel ){\n    level = self._parseLevel( level );\n    if( level >= self.options.logLevel ){\n        self._addToCache( level, namespace, logArguments );\n    }\n    // also emit to consoleLogger if proper level for that\n    if( self.consoleLogger && level >= self.options.consoleLevel ){\n        self._emitToConsole( level, namespace, logArguments );\n    }\n    return self;\n};\n\n//----------------------------------------------------------------------------- cache\n/** add a message to the cache and if messages.length is high enough post them to the server */\nMetricsLogger.prototype._addToCache = function _addToCache( level, namespace, logArguments ){\n    this._emitToConsole( 'debug', 'MetricsLogger',\n        [ '_addToCache:', arguments, this.options.addTime, this.cache.length() ]);\n    //this._emitToConsole( 'debug', 'MetricsLogger', [ '\\t logArguments:', logArguments ]);\n    var self = this;\n    // try add to the cache and if we've got _postSize number of entries, attempt to post them to the server\n    try {\n        var newLength = self.cache.add( self._buildEntry( level, namespace, logArguments ) );\n        if( newLength >= self._postSize ){\n            self._postCache();\n        }\n    // discard entry if an error occurs, but warn if level set to do so\n    } catch( err ){\n        self._emitToConsole( 'warn', 'MetricsLogger',\n            [ 'Metrics logger could not stringify logArguments:', namespace, logArguments ] );\n        self._emitToConsole( 'error', 'MetricsLogger', [ err ] );\n\n    }\n    return self;\n};\n\n/** build a log cache entry object from the given level, namespace, and arguments (optionally adding timestamp */\nMetricsLogger.prototype._buildEntry = function _buildEntry( level, namespace, logArguments ){\n    this._emitToConsole( 'debug', 'MetricsLogger', [ '_buildEntry:', arguments ]);\n    var entry = {\n            level       : level,\n            namespace   : this.options.clientPrefix + namespace,\n            args        : logArguments\n        };\n    if( this.options.addTime ){\n        entry.time = new Date().toISOString();\n    }\n    return entry;\n};\n\n/** post _postSize messages from the cache to the server, removing them if successful\n *      if the post fails, wait until maxCacheSize is accumulated instead and try again then\n *      in addition to the messages from the cache ('metrics'), any info from getPingData (if set) will be sent\n *      onServerResponse will be called (if set) with any response from the server\n */\nMetricsLogger.prototype._postCache = function _postCache( options ){\n    options = options || {};\n    this._emitToConsole( 'info', 'MetricsLogger', [ '_postCache', options, this._postSize ]);\n\n    // short circuit if we're already sending\n    if( !this.options.postUrl || this._sending ){\n        return jQuery.when({});\n    }\n\n    var self = this,\n        postSize = options.count || self._postSize,\n        // do not splice - remove after *successful* post\n        entries = self.cache.get( postSize ),\n        entriesLength = entries.length,\n        // use the optional getPingData to add any extra info we may want to send\n        postData = ( typeof self.options.getPingData === 'function' )?( self.options.getPingData() ):( {} );\n    //console.debug( postSize, entriesLength );\n\n    // add the metrics and send\n    postData.metrics = JSON.stringify( entries );\n    //console.debug( postData.metrics );\n    self._sending = true;\n    return jQuery.post( self.options.postUrl, postData )\n        .always( function(){\n            self._sending = false;\n        })\n        .fail( function( xhr, status, message ){\n            // if we failed the previous time, set the next post target to the max num of entries\n            self._postSize = self.options.maxCacheSize;\n//TODO:??\n            // log this failure to explain any gap in metrics\n            self.emit( 'error', 'MetricsLogger', [ '_postCache error:',\n                xhr.readyState, xhr.status, xhr.responseJSON || xhr.responseText ]);\n//TODO: still doesn't solve the problem that when cache == max, post will be tried on every emit\n//TODO: see _delayPost\n        })\n        .done( function( response ){\n            if( typeof self.options.onServerResponse === 'function' ){\n                self.options.onServerResponse( response );\n            }\n            // only remove if post successful\n            self.cache.remove( entriesLength );\n            //console.debug( 'removed entries:', entriesLength, 'size now:', self.cache.length() );\n            // if we succeeded, reset the post target to the normal num of entries\n            self._postSize = self.options.postSize;\n        });\n    // return the xhr promise\n};\n\n/** set _waiting to true and, after delayPostInMs, set it back to false */\nMetricsLogger.prototype._delayPost = function _delayPost(){\n//TODO: this won't work between pages\n    var self = this;\n    self._waiting = setTimeout( function(){\n        self._waiting = null;\n    }, self.options.delayPostInMs );\n};\n\n\n//----------------------------------------------------------------------------- console\n/** output message to console based on level and consoleLogger type */\nMetricsLogger.prototype._emitToConsole = function _emitToConsole( level, namespace, logArguments ){\n    //console.debug( '_emitToConsole:', level, namespace, logArguments );\n    var self = this,\n        whitelist = self.options.consoleNamespaceWhitelist;\n    if( !self.consoleLogger ){ return self; }\n    // if a whitelist for namespaces is set, bail if this namespace is not in the list\n    if( whitelist && whitelist.indexOf( namespace ) === -1 ){\n        return self;\n    }\n\n    var args = Array.prototype.slice.call( logArguments, 0 );\n    args.unshift( namespace );\n//TODO: script location and/or source maps?\n//TODO: branch on navigator.userAgent == AIIEEE - it only has log\n    if(        level >= MetricsLogger.METRIC && typeof( self.consoleLogger.info ) === 'function' ){\n        return self.consoleLogger.info.apply( self.consoleLogger, args );\n\n    } else if( level >= MetricsLogger.ERROR && typeof( self.consoleLogger.error ) === 'function' ){\n        return self.consoleLogger.error.apply( self.consoleLogger, args );\n    } else if( level >= MetricsLogger.WARN && typeof( self.consoleLogger.warn ) === 'function' ){\n        self.consoleLogger.warn.apply( self.consoleLogger, args );\n    } else if( level >= MetricsLogger.INFO && typeof( self.consoleLogger.info ) === 'function' ){\n        self.consoleLogger.info.apply( self.consoleLogger, args );\n    } else if( level >= MetricsLogger.DEBUG && typeof( self.consoleLogger.debug ) === 'function' ){\n        self.consoleLogger.debug.apply( self.consoleLogger, args );\n    } else if( typeof( self.consoleLogger.log ) === 'function' ){\n        self.consoleLogger.log.apply( self.consoleLogger, args );\n    }\n    return self;\n};\n\n//----------------------------------------------------------------------------- shortcuts\n// generic functions when logging from non-namespaced object (e.g. templates)\n/** log to default namespace */\nMetricsLogger.prototype.log = function log(){\n    this.emit( 1, this.options.defaultNamespace,\n        Array.prototype.slice.call( arguments, 0 ) );\n};\n\n/** debug to default namespace */\nMetricsLogger.prototype.debug = function debug(){\n    this.emit( MetricsLogger.DEBUG, this.options.defaultNamespace,\n        Array.prototype.slice.call( arguments, 0 ) );\n};\n\n/** info to default namespace */\nMetricsLogger.prototype.info = function info(){\n    this.emit( MetricsLogger.INFO, this.options.defaultNamespace,\n        Array.prototype.slice.call( arguments, 0 ) );\n};\n\n/** warn to default namespace */\nMetricsLogger.prototype.warn = function warn(){\n    this.emit( MetricsLogger.WARN, this.options.defaultNamespace,\n        Array.prototype.slice.call( arguments, 0 ) );\n};\n\n/** error to default namespace */\nMetricsLogger.prototype.error = function error(){\n    this.emit( MetricsLogger.ERROR, this.options.defaultNamespace,\n        Array.prototype.slice.call( arguments, 0 ) );\n};\n\n/** metric to default namespace */\nMetricsLogger.prototype.metric = function metric(){\n    this.emit( MetricsLogger.METRIC, this.options.defaultNamespace,\n        Array.prototype.slice.call( arguments, 0 ) );\n};\n\n\n/* ============================================================================\nTODO:\n    need a performance pass - the JSON un/parsing is a bit much\n\n============================================================================ */\n/** @class LoggingCache\n *  Simple implementation of cache wrapping an array.\n *\n *  Formats an entry before it's cached and only keeps options.maxSize number\n *  of entries. Older entries are deleted first.\n */\nfunction LoggingCache( options ){\n    var self = this;\n    return self._init( options || {} );\n}\n\n/** default options */\nLoggingCache.defaultOptions = {\n    /** maximum number of entries to keep before discarding oldest */\n    maxSize     : 5000\n};\n\n/** initialize with options */\nLoggingCache.prototype._init = function _init( options ){\n    if( !this._hasStorage() ){\n        //TODO: fall back to jstorage\n        throw new Error( 'LoggingCache needs localStorage' );\n    }\n    if( !options.key ){\n        throw new Error( 'LoggingCache needs key for localStorage' );\n    }\n    this.key = options.key;\n    this._initStorage();\n\n    this.maxSize = options.maxSize || LoggingCache.defaultOptions.maxSize;\n    return this;\n};\n\n/** tests for localStorage fns */\nLoggingCache.prototype._hasStorage = function _hasStorage(){\n//TODO: modernizr\n    var test = 'test';\n    try {\n        localStorage.setItem( test, test );\n        localStorage.removeItem( test );\n        return true;\n    } catch( e ){\n        return false;\n    }\n};\n\n/** if no localStorage set for key, initialize to empty array */\nLoggingCache.prototype._initStorage = function _initStorage(){\n    if( localStorage.getItem( this.key ) === null ){\n        return this.empty();\n    }\n    return this;\n};\n\n/** add an entry to the cache, removing the oldest beforehand if size >= maxSize */\nLoggingCache.prototype.add = function add( entry ){\n    var self = this,\n        _cache = self._fetchAndParse(),\n        overage = ( _cache.length + 1 ) - self.maxSize;\n    if( overage > 0 ){\n        _cache.splice( 0, overage );\n    }\n    _cache.push( entry );\n    self._unparseAndStore( _cache );\n    return _cache.length;\n};\n\n/** get the entries from localStorage and parse them */\nLoggingCache.prototype._fetchAndParse = function _fetchAndParse(){\n    var self = this;\n    return JSON.parse( localStorage.getItem( self.key ) );\n};\n\n/** stringify the entries and put them in localStorage */\nLoggingCache.prototype._unparseAndStore = function _unparseAndStore( entries ){\n    var self = this;\n    return localStorage.setItem( self.key, JSON.stringify( entries ) );\n};\n\n///** process the entry before caching */\n//LoggingCache.prototype._preprocessEntry = function _preprocessEntry( entry ){\n//    return JSON.stringify( entry );\n//};\n\n/** return the length --- oh, getters where are you? */\nLoggingCache.prototype.length = function length(){\n    return this._fetchAndParse().length;\n};\n\n/** get count number of entries starting with the oldest */\nLoggingCache.prototype.get = function get( count ){\n    return this._fetchAndParse().slice( 0, count );\n};\n\n/** remove count number of entries starting with the oldest */\nLoggingCache.prototype.remove = function remove( count ){\n    var _cache = this._fetchAndParse(),\n        removed = _cache.splice( 0, count );\n    this._unparseAndStore( _cache );\n    return removed;\n};\n\n/** empty/clear the entire cache */\nLoggingCache.prototype.empty = function empty(){\n    localStorage.setItem( this.key, '[]' );\n    return this;\n};\n\n/** stringify count number of entries (but do not remove) */\nLoggingCache.prototype.stringify = function stringify( count ){\n    return JSON.stringify( this.get( count ) );\n};\n\n/** outputs entire cache to console */\nLoggingCache.prototype.print = function print(){\n    // popup? (really, carl? a popup?) - easier to copy/paste\n    console.log( JSON.stringify( this._fetchAndParse(), null, '  ' ) );\n};\n\n\n//=============================================================================\n    return {\n        MetricsLogger  : MetricsLogger,\n        LoggingCache   : LoggingCache\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/utils/metrics-logger.js\n **/","define([\n    \"mvc/base-mvc\",\n    \"utils/localization\",\n    \"ui/editable-text\",\n], function( baseMVC, _l ){\n// =============================================================================\n/** A view on any model that has a 'annotation' attribute\n */\nvar AnnotationEditor = Backbone.View\n        .extend( baseMVC.LoggableMixin )\n        .extend( baseMVC.HiddenUntilActivatedViewMixin ).extend({\n\n    tagName     : 'div',\n    className   : 'annotation-display',\n\n    /** Set up listeners, parse options */\n    initialize : function( options ){\n        options = options || {};\n        this.tooltipConfig = options.tooltipConfig || { placement: 'bottom' };\n        //console.debug( this, options );\n        // only listen to the model only for changes to annotations\n        this.listenTo( this.model, 'change:annotation', function(){\n            this.render();\n        });\n        this.hiddenUntilActivated( options.$activator, options );\n    },\n\n    /** Build the DOM elements, call select to on the created input, and set up behaviors */\n    render : function(){\n        var view = this;\n        this.$el.html( this._template() );\n        this.$el.find( \"[title]\" ).tooltip( this.tooltipConfig );\n\n        //TODO: handle empties better\n        this.$annotation().make_text_editable({\n            use_textarea: true,\n            on_finish: function( newAnnotation ){\n                view.$annotation().text( newAnnotation );\n                view.model.save({ annotation: newAnnotation }, { silent: true })\n                    .fail( function(){\n                        view.$annotation().text( view.model.previous( 'annotation' ) );\n                    });\n            }\n        });\n        return this;\n    },\n\n    /** @returns {String} the html text used to build the view's DOM */\n    _template : function(){\n        var annotation = this.model.get( 'annotation' );\n        //if( !annotation ){\n        //    //annotation = [ '<em class=\"annotation-empty\">', _l( 'Click to add an annotation' ), '</em>' ].join( '' );\n        //    annotation = [ '<em class=\"annotation-empty\"></em>' ].join( '' );\n        //}\n        return [\n            //TODO: make prompt optional\n            '<label class=\"prompt\">', _l( 'Annotation' ), '</label>',\n            // set up initial tags by adding as CSV to input vals (necc. to init select2)\n            '<div class=\"annotation\" title=\"', _l( 'Edit annotation' ), '\">',\n                _.escape( annotation ),\n            '</div>'\n        ].join( '' );\n    },\n\n    /** @returns {jQuery} the main element for this view */\n    $annotation : function(){\n        return this.$el.find( '.annotation' );\n    },\n\n    /** shut down event listeners and remove this view's DOM */\n    remove : function(){\n        this.$annotation.off();\n        this.stopListening( this.model );\n        Backbone.View.prototype.remove.call( this );\n    },\n\n    /** string rep */\n    toString : function(){ return [ 'AnnotationEditor(', this.model + '', ')' ].join(''); }\n});\n// =============================================================================\nreturn {\n    AnnotationEditor : AnnotationEditor\n};\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/annotation.js\n **/","define([\n    \"mvc/list/list-view\",\n    \"mvc/collection/collection-model\",\n    \"mvc/collection/collection-li\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( LIST_VIEW, DC_MODEL, DC_LI, BASE_MVC, _l ){\n\n'use strict';\n\nvar logNamespace = 'collections';\n/* =============================================================================\nTODO:\n\n============================================================================= */\n/** @class non-editable, read-only View/Controller for a dataset collection.\n */\nvar _super = LIST_VIEW.ModelListPanel;\nvar CollectionView = _super.extend(\n/** @lends CollectionView.prototype */{\n    //MODEL is either a DatasetCollection (or subclass) or a DatasetCollectionElement (list of pairs)\n    _logNamespace : logNamespace,\n\n    className           : _super.prototype.className + ' dataset-collection-panel',\n\n    /** sub view class used for datasets */\n    DatasetDCEViewClass : DC_LI.DatasetDCEListItemView,\n    /** sub view class used for nested collections */\n    NestedDCDCEViewClass: DC_LI.NestedDCDCEListItemView,\n    /** key of attribute in model to assign to this.collection */\n    modelCollectionKey  : 'elements',\n\n    // ......................................................................... SET UP\n    /** Set up the view, set up storage, bind listeners to HistoryContents events\n     *  @param {Object} attributes optional settings for the panel\n     */\n    initialize : function( attributes ){\n        _super.prototype.initialize.call( this, attributes );\n        this.linkTarget = attributes.linkTarget || '_blank';\n\n        this.hasUser = attributes.hasUser;\n        /** A stack of panels that currently cover or hide this panel */\n        this.panelStack = [];\n        /** The text of the link to go back to the panel containing this one */\n        this.parentName = attributes.parentName;\n        /** foldout or drilldown */\n        this.foldoutStyle = attributes.foldoutStyle || 'foldout';\n    },\n\n    // ------------------------------------------------------------------------ sub-views\n    /** In this override, use model.getVisibleContents */\n    _filterCollection : function(){\n//TODO: should *not* be model.getVisibleContents - visibility is not model related\n        return this.model.getVisibleContents();\n    },\n\n    /** override to return proper view class based on element_type */\n    _getItemViewClass : function( model ){\n        //this.debug( this + '._getItemViewClass:', model );\n//TODO: subclasses use DCEViewClass - but are currently unused - decide\n        switch( model.get( 'element_type' ) ){\n            case 'hda':\n                return this.DatasetDCEViewClass;\n            case 'dataset_collection':\n                return this.NestedDCDCEViewClass;\n        }\n        throw new TypeError( 'Unknown element type:', model.get( 'element_type' ) );\n    },\n\n    /** override to add link target and anon */\n    _getItemViewOptions : function( model ){\n        var options = _super.prototype._getItemViewOptions.call( this, model );\n        return _.extend( options, {\n            linkTarget      : this.linkTarget,\n            hasUser         : this.hasUser,\n//TODO: could move to only nested: list:paired\n            foldoutStyle    : this.foldoutStyle\n        });\n    },\n\n    // ------------------------------------------------------------------------ collection sub-views\n    /** In this override, add/remove expanded/collapsed model ids to/from web storage */\n    _setUpItemViewListeners : function( view ){\n        var panel = this;\n        _super.prototype._setUpItemViewListeners.call( panel, view );\n\n        // use pub-sub to: handle drilldown expansion and collapse\n        panel.listenTo( view, {\n            'expanded:drilldown': function( v, drilldown ){\n                this._expandDrilldownPanel( drilldown );\n            },\n            'collapsed:drilldown': function( v, drilldown ){\n                this._collapseDrilldownPanel( drilldown );\n            }\n        });\n        return this;\n    },\n\n    /** Handle drill down by hiding this panels list and controls and showing the sub-panel */\n    _expandDrilldownPanel : function( drilldown ){\n        this.panelStack.push( drilldown );\n        // hide this panel's controls and list, set the name for back navigation, and attach to the $el\n        this.$( '> .controls' ).add( this.$list() ).hide();\n        drilldown.parentName = this.model.get( 'name' );\n        this.$el.append( drilldown.render().$el );\n    },\n\n    /** Handle drilldown close by freeing the panel and re-rendering this panel */\n    _collapseDrilldownPanel : function( drilldown ){\n        this.panelStack.pop();\n        this.render();\n    },\n\n    // ------------------------------------------------------------------------ panel events\n    /** event map */\n    events : {\n        'click .navigation .back'       : 'close'\n    },\n\n    /** close/remove this collection panel */\n    close : function( event ){\n        this.$el.remove();\n        this.trigger( 'close' );\n    },\n\n    // ........................................................................ misc\n    /** string rep */\n    toString    : function(){\n        return 'CollectionView(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n//------------------------------------------------------------------------------ TEMPLATES\nCollectionView.prototype.templates = (function(){\n\n    var controlsTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"controls\">',\n            '<div class=\"navigation\">',\n                '<a class=\"back\" href=\"javascript:void(0)\">',\n                    '<span class=\"fa fa-icon fa-angle-left\"></span>',\n                    _l( 'Back to ' ), '<%- view.parentName %>',\n                '</a>',\n            '</div>',\n\n            '<div class=\"title\">',\n                '<div class=\"name\"><%- collection.name || collection.element_identifier %></div>',\n                '<div class=\"subtitle\">',\n//TODO: remove logic from template\n                    '<% if( collection.collection_type === \"list\" ){ %>',\n                        _l( 'a list of datasets' ),\n                    '<% } else if( collection.collection_type === \"paired\" ){ %>',\n                        _l( 'a pair of datasets' ),\n                    '<% } else if( collection.collection_type === \"list:paired\" ){ %>',\n                        _l( 'a list of paired datasets' ),\n                    '<% } %>',\n                '</div>',\n            '</div>',\n        '</div>'\n    ], 'collection' );\n\n    return _.extend( _.clone( _super.prototype.templates ), {\n        controls : controlsTemplate\n    });\n}());\n\n\n\n// =============================================================================\n/** @class non-editable, read-only View/Controller for a dataset collection. */\nvar ListCollectionView = CollectionView.extend(\n/** @lends ListCollectionView.prototype */{\n\n    //TODO: not strictly needed - due to switch in CollectionView._getContentClass\n    /** sub view class used for datasets */\n    DatasetDCEViewClass : DC_LI.DatasetDCEListItemView,\n\n    // ........................................................................ misc\n    /** string rep */\n    toString    : function(){\n        return 'ListCollectionView(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n// =============================================================================\n/** @class non-editable, read-only View/Controller for a dataset collection. */\nvar PairCollectionView = ListCollectionView.extend(\n/** @lends PairCollectionView.prototype */{\n\n    // ........................................................................ misc\n    /** string rep */\n    toString    : function(){\n        return 'PairCollectionView(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n// =============================================================================\n/** @class non-editable, read-only View/Controller for a dataset collection. */\nvar ListOfPairsCollectionView = CollectionView.extend(\n/** @lends ListOfPairsCollectionView.prototype */{\n\n    //TODO: not strictly needed - due to switch in CollectionView._getContentClass\n    /** sub view class used for nested collections */\n    NestedDCDCEViewClass : DC_LI.NestedDCDCEListItemView.extend({\n        foldoutPanelClass : PairCollectionView\n    }),\n\n    // ........................................................................ misc\n    /** string rep */\n    toString    : function(){\n        return 'ListOfPairsCollectionView(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n//==============================================================================\n    return {\n        CollectionView              : CollectionView,\n        ListCollectionView          : ListCollectionView,\n        PairCollectionView          : PairCollectionView,\n        ListOfPairsCollectionView   : ListOfPairsCollectionView\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/collection/collection-view.js\n **/","define([\n    \"mvc/dataset/states\",\n    \"mvc/dataset/dataset-li\",\n    \"mvc/tag\",\n    \"mvc/annotation\",\n    \"ui/fa-icon-button\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( STATES, DATASET_LI, TAGS, ANNOTATIONS, faIconButton, BASE_MVC, _l ){\n\n'use strict';\n//==============================================================================\nvar _super = DATASET_LI.DatasetListItemView;\n/** @class Editing view for DatasetAssociation.\n */\nvar DatasetListItemEdit = _super.extend(\n/** @lends DatasetListItemEdit.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** set up: options */\n    initialize  : function( attributes ){\n        _super.prototype.initialize.call( this, attributes );\n//TODO: shouldn't this err if false?\n        this.hasUser = attributes.hasUser;\n\n        /** allow user purge of dataset files? */\n        this.purgeAllowed = attributes.purgeAllowed || false;\n\n        //TODO: move to HiddenUntilActivatedViewMixin\n        /** should the tags editor be shown or hidden initially? */\n        this.tagsEditorShown        = attributes.tagsEditorShown || false;\n        /** should the tags editor be shown or hidden initially? */\n        this.annotationEditorShown  = attributes.annotationEditorShown || false;\n    },\n\n    // ......................................................................... titlebar actions\n    /** In this override, add the other two primary actions: edit and delete */\n    _renderPrimaryActions : function(){\n        var actions = _super.prototype._renderPrimaryActions.call( this );\n        if( this.model.get( 'state' ) === STATES.NOT_VIEWABLE ){\n            return actions;\n        }\n        // render the display, edit attr and delete icon-buttons\n        return _super.prototype._renderPrimaryActions.call( this ).concat([\n            this._renderEditButton(),\n            this._renderDeleteButton()\n        ]);\n    },\n\n//TODO: move titleButtons into state renderers, remove state checks in the buttons\n\n    /** Render icon-button to edit the attributes (format, permissions, etc.) this dataset. */\n    _renderEditButton : function(){\n        // don't show edit while uploading, in-accessible\n        // DO show if in error (ala previous history panel)\n        if( ( this.model.get( 'state' ) === STATES.DISCARDED )\n        ||  ( !this.model.get( 'accessible' ) ) ){\n            return null;\n        }\n\n        var purged = this.model.get( 'purged' ),\n            deleted = this.model.get( 'deleted' ),\n            editBtnData = {\n                title       : _l( 'Edit attributes' ),\n                href        : this.model.urls.edit,\n                target      : this.linkTarget,\n                faIcon      : 'fa-pencil',\n                classes     : 'edit-btn'\n            };\n\n        // disable if purged or deleted and explain why in the tooltip\n        if( deleted || purged ){\n            editBtnData.disabled = true;\n            if( purged ){\n                editBtnData.title = _l( 'Cannot edit attributes of datasets removed from disk' );\n            } else if( deleted ){\n                editBtnData.title = _l( 'Undelete dataset to edit attributes' );\n            }\n\n        // disable if still uploading or new\n        } else if( _.contains( [ STATES.UPLOAD, STATES.NEW ], this.model.get( 'state' ) ) ){\n            editBtnData.disabled = true;\n            editBtnData.title = _l( 'This dataset is not yet editable' );\n        }\n        return faIconButton( editBtnData );\n    },\n\n    /** Render icon-button to delete this hda. */\n    _renderDeleteButton : function(){\n        // don't show delete if...\n        if( ( !this.model.get( 'accessible' ) ) ){\n            return null;\n        }\n\n        var self = this,\n            deletedAlready = this.model.isDeletedOrPurged();\n        return faIconButton({\n                title       : !deletedAlready? _l( 'Delete' ) : _l( 'Dataset is already deleted' ),\n                disabled    : deletedAlready,\n                faIcon      : 'fa-times',\n                classes     : 'delete-btn',\n                onclick     : function() {\n                    // ...bler... tooltips being left behind in DOM (hover out never called on deletion)\n                    self.$el.find( '.icon-btn.delete-btn' ).trigger( 'mouseout' );\n                    self.model[ 'delete' ]();\n                }\n        });\n    },\n\n    // ......................................................................... details\n    /** In this override, add tags and annotations controls, make the ? dbkey a link to editing page */\n    _renderDetails : function(){\n        //TODO: generalize to be allow different details for each state\n        var $details = _super.prototype._renderDetails.call( this ),\n            state = this.model.get( 'state' );\n\n        if( !this.model.isDeletedOrPurged() && _.contains([ STATES.OK, STATES.FAILED_METADATA ], state ) ){\n            this._renderTags( $details );\n            this._renderAnnotation( $details );\n            this._makeDbkeyEditLink( $details );\n        }\n\n//TODO: TRIPLE tap, ugh.\n        this._setUpBehaviors( $details );\n        return $details;\n    },\n\n    /** Add less commonly used actions in the details section based on state */\n    _renderSecondaryActions : function(){\n        var actions = _super.prototype._renderSecondaryActions.call( this );\n        switch( this.model.get( 'state' ) ){\n            case STATES.UPLOAD:\n            case STATES.NOT_VIEWABLE:\n                return actions;\n            case STATES.ERROR:\n                // error button comes first\n                actions.unshift( this._renderErrButton() );\n                return actions.concat([ this._renderRerunButton() ]);\n            case STATES.OK:\n            case STATES.FAILED_METADATA:\n                return actions.concat([ this._renderRerunButton(), this._renderVisualizationsButton() ]);\n        }\n        return actions.concat([ this._renderRerunButton() ]);\n    },\n\n    /** Render icon-button to report an error on this dataset to the galaxy admin. */\n    _renderErrButton : function(){\n        return faIconButton({\n            title       : _l( 'View or report this error' ),\n            href        : this.model.urls.report_error,\n            classes     : 'report-error-btn',\n            target      : this.linkTarget,\n            faIcon      : 'fa-bug'\n        });\n    },\n\n    /** Render icon-button to re-run the job that created this dataset. */\n    _renderRerunButton : function(){\n        var creating_job = this.model.get( 'creating_job' );\n        if( this.model.get( 'rerunnable' ) ){\n            return faIconButton({\n                title       : _l( 'Run this job again' ),\n                href        : this.model.urls.rerun,\n                classes     : 'rerun-btn',\n                target      : this.linkTarget,\n                faIcon      : 'fa-refresh',\n                onclick     : function( ev ) {\n                    ev.preventDefault();\n                    // create webpack split point in order to load the tool form async\n                    // TODO: split not working (tool loads fine)\n                    require([ 'mvc/tool/tool-form' ], function( ToolForm ){\n                        var form = new ToolForm.View({ 'job_id' : creating_job });\n                        form.deferred.execute( function(){\n                            Galaxy.app.display( form );\n                        });\n                    });\n                }\n            });\n        }\n    },\n\n    /** Render an icon-button or popupmenu of links based on the applicable visualizations */\n    _renderVisualizationsButton : function(){\n        //TODO: someday - lazyload visualizations\n        var visualizations = this.model.get( 'visualizations' );\n        if( ( this.model.isDeletedOrPurged() )\n        ||  ( !this.hasUser )\n        ||  ( !this.model.hasData() )\n        ||  ( _.isEmpty( visualizations ) ) ){\n            return null;\n        }\n        if( !_.isObject( visualizations[0] ) ){\n            this.warn( 'Visualizations have been switched off' );\n            return null;\n        }\n\n        var $visualizations = $( this.templates.visualizations( visualizations, this ) );\n        //HACK: need to re-write those directed at galaxy_main with linkTarget\n        $visualizations.find( '[target=\"galaxy_main\"]').attr( 'target', this.linkTarget );\n        // use addBack here to include the root $visualizations elem (for the case of 1 visualization)\n        this._addScratchBookFn( $visualizations.find( '.visualization-link' ).addBack( '.visualization-link' ) );\n        return $visualizations;\n    },\n\n    /** add scratchbook functionality to visualization links */\n    _addScratchBookFn : function( $links ){\n        var li = this;\n        $links.click( function( ev ){\n            if( Galaxy.frame && Galaxy.frame.active ){\n                Galaxy.frame.add({\n                    title       : 'Visualization',\n                    url         : $( this ).attr( 'href' )\n                });\n                ev.preventDefault();\n                ev.stopPropagation();\n            }\n        });\n    },\n\n//TODO: if possible move these to readonly view - but display the owner's tags/annotation (no edit)\n    /** Render the tags list/control */\n    _renderTags : function( $where ){\n        if( !this.hasUser ){ return; }\n        var view = this;\n        this.tagsEditor = new TAGS.TagsEditor({\n            model           : this.model,\n            el              : $where.find( '.tags-display' ),\n            onshowFirstTime : function(){ this.render(); },\n            // persist state on the hda view (and not the editor) since these are currently re-created each time\n            onshow          : function(){ view.tagsEditorShown = true; },\n            onhide          : function(){ view.tagsEditorShown = false; },\n            $activator      : faIconButton({\n                title   : _l( 'Edit dataset tags' ),\n                classes : 'tag-btn',\n                faIcon  : 'fa-tags'\n            }).appendTo( $where.find( '.actions .right' ) )\n        });\n        if( this.tagsEditorShown ){ this.tagsEditor.toggle( true ); }\n    },\n\n    /** Render the annotation display/control */\n    _renderAnnotation : function( $where ){\n        if( !this.hasUser ){ return; }\n        var view = this;\n        this.annotationEditor = new ANNOTATIONS.AnnotationEditor({\n            model           : this.model,\n            el              : $where.find( '.annotation-display' ),\n            onshowFirstTime : function(){ this.render(); },\n            // persist state on the hda view (and not the editor) since these are currently re-created each time\n            onshow          : function(){ view.annotationEditorShown = true; },\n            onhide          : function(){ view.annotationEditorShown = false; },\n            $activator      : faIconButton({\n                title   : _l( 'Edit dataset annotation' ),\n                classes : 'annotate-btn',\n                faIcon  : 'fa-comment'\n            }).appendTo( $where.find( '.actions .right' ) )\n        });\n        if( this.annotationEditorShown ){ this.annotationEditor.toggle( true ); }\n    },\n\n    /** If the format/dbkey/genome_build isn't set, make the display a link to the edit page */\n    _makeDbkeyEditLink : function( $details ){\n        // make the dbkey a link to editing\n        if( this.model.get( 'metadata_dbkey' ) === '?'\n        &&  !this.model.isDeletedOrPurged() ){\n            var editableDbkey = $( '<a class=\"value\">?</a>' )\n                .attr( 'href', this.model.urls.edit )\n                .attr( 'target', this.linkTarget );\n            $details.find( '.dbkey .value' ).replaceWith( editableDbkey );\n        }\n    },\n\n    // ......................................................................... events\n    /** event map */\n    events : _.extend( _.clone( _super.prototype.events ), {\n        'click .undelete-link'  : '_clickUndeleteLink',\n        'click .purge-link'     : '_clickPurgeLink',\n\n        'click .edit-btn'       : function( ev ){ this.trigger( 'edit', this, ev ); },\n        'click .delete-btn'     : function( ev ){ this.trigger( 'delete', this, ev ); },\n        'click .rerun-btn'      : function( ev ){ this.trigger( 'rerun', this, ev ); },\n        'click .report-err-btn' : function( ev ){ this.trigger( 'report-err', this, ev ); },\n        'click .visualization-btn' : function( ev ){ this.trigger( 'visualize', this, ev ); },\n        'click .dbkey a'        : function( ev ){ this.trigger( 'edit', this, ev ); }\n    }),\n\n\n    /** listener for item undelete (in the messages section) */\n    _clickUndeleteLink : function( ev ){\n        this.model.undelete();\n        return false;\n    },\n\n    /** listener for item purge (in the messages section) */\n    _clickPurgeLink : function( ev ){\n//TODO: confirm dialog\n        this.model.purge();\n        return false;\n    },\n\n    // ......................................................................... misc\n    /** string rep */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'HDAEditView(' + modelString + ')';\n    }\n});\n\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDatasetListItemEdit.prototype.templates = (function(){\n//TODO: move to require text! plugin\n\n    var warnings = _.extend( {}, _super.prototype.templates.warnings, {\n        failed_metadata : BASE_MVC.wrapTemplate([\n            // in this override, provide a link to the edit page\n            '<% if( dataset.state === \"failed_metadata\" ){ %>',\n                '<div class=\"failed_metadata-warning warningmessagesmall\">',\n                    _l( 'An error occurred setting the metadata for this dataset' ),\n                    '<br /><a href=\"<%- dataset.urls.edit %>\" target=\"<%- view.linkTarget %>\">',\n                        _l( 'Set it manually or retry auto-detection' ),\n                    '</a>',\n                '</div>',\n            '<% } %>'\n        ], 'dataset' ),\n\n        deleted : BASE_MVC.wrapTemplate([\n            // in this override, provide links to undelete or purge the dataset\n            '<% if( dataset.deleted && !dataset.purged ){ %>',\n                // deleted not purged\n                '<div class=\"deleted-msg warningmessagesmall\">',\n                    _l( 'This dataset has been deleted' ),\n                    '<br /><a class=\"undelete-link\" href=\"javascript:void(0);\">', _l( 'Undelete it' ), '</a>',\n                    '<% if( view.purgeAllowed ){ %>',\n                        '<br /><a class=\"purge-link\" href=\"javascript:void(0);\">',\n                            _l( 'Permanently remove it from disk' ),\n                        '</a>',\n                    '<% } %>',\n                '</div>',\n            '<% } %>'\n        ], 'dataset' )\n    });\n\n    var visualizationsTemplate = BASE_MVC.wrapTemplate([\n        '<% if( visualizations.length === 1 ){ %>',\n            '<a class=\"visualization-btn visualization-link icon-btn\" href=\"<%- visualizations[0].href %>\"',\n                    ' target=\"<%- visualizations[0].target %>\" title=\"', _l( 'Visualize in' ),\n                    ' <%- visualizations[0].html %>\">',\n                '<span class=\"fa fa-bar-chart-o\"></span>',\n            '</a>',\n\n        '<% } else { %>',\n            '<div class=\"visualizations-dropdown dropdown\">',\n                '<a class=\"visualization-btn icon-btn\" data-toggle=\"dropdown\" title=\"', _l( 'Visualize' ), '\">',\n                    '<span class=\"fa fa-bar-chart-o\"></span>',\n                '</a>',\n                '<ul class=\"dropdown-menu\" role=\"menu\">',\n                    '<% _.each( visualizations, function( visualization ){ %>',\n                        '<li><a class=\"visualization-link\" href=\"<%- visualization.href %>\"',\n                                ' target=\"<%- visualization.target %>\">',\n                            '<%- visualization.html %>',\n                        '</a></li>',\n                    '<% }); %>',\n                '</ul>',\n            '</div>',\n        '<% } %>'\n    ], 'visualizations' );\n\n    return _.extend( {}, _super.prototype.templates, {\n        warnings : warnings,\n        visualizations : visualizationsTemplate\n    });\n}());\n\n\n//==============================================================================\n    return {\n        DatasetListItemEdit : DatasetListItemEdit\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/dataset/dataset-li-edit.js\n **/","define([\n    \"mvc/dataset/states\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( STATES, BASE_MVC, _l ){\n'use strict';\n\nvar logNamespace = 'dataset';\n//==============================================================================\nvar searchableMixin = BASE_MVC.SearchableModelMixin;\n/** @class base model for any DatasetAssociation (HDAs, LDDAs, DatasetCollectionDAs).\n *      No knowledge of what type (HDA/LDDA/DCDA) should be needed here.\n *  The DA's are made searchable (by attribute) by mixing in SearchableModelMixin.\n */\nvar DatasetAssociation = Backbone.Model\n        .extend( BASE_MVC.LoggableMixin )\n        .extend( BASE_MVC.mixin( searchableMixin, /** @lends DatasetAssociation.prototype */{\n    _logNamespace : logNamespace,\n\n    /** default attributes for a model */\n    defaults : {\n        state               : STATES.NEW,\n        deleted             : false,\n        purged              : false,\n\n        // unreliable attribute\n        name                : '(unnamed dataset)',\n\n//TODO: update to false when this is correctly passed from the API (when we have a security model for this)\n        accessible          : true,\n\n        // sniffed datatype (sam, tabular, bed, etc.)\n        data_type           : '',\n        file_ext            : '',\n\n        // size in bytes\n        file_size           : 0,\n\n        // array of associated file types (eg. [ 'bam_index', ... ])\n        meta_files          : [],\n\n        misc_blurb          : '',\n        misc_info           : '',\n\n        tags                : []\n        // do NOT default on annotation, as this default is valid and will be passed on 'save'\n        //  which is incorrect behavior when the model is only partially fetched (annos are not passed in summary data)\n        //annotation          : ''\n    },\n\n    /** instance vars and listeners */\n    initialize : function( attributes, options ){\n        this.debug( this + '(Dataset).initialize', attributes, options );\n\n        //!! this state is not in trans.app.model.Dataset.states - set it here -\n        if( !this.get( 'accessible' ) ){\n            this.set( 'state', STATES.NOT_VIEWABLE );\n        }\n\n        /** Datasets rely/use some web controllers - have the model generate those URLs on startup */\n        this.urls = this._generateUrls();\n\n        this._setUpListeners();\n    },\n\n    /** returns misc. web urls for rendering things like re-run, display, etc. */\n    _generateUrls : function(){\n//TODO: would be nice if the API did this\n        var id = this.get( 'id' );\n        if( !id ){ return {}; }\n        var urls = {\n            'purge'         : 'datasets/' + id + '/purge_async',\n            'display'       : 'datasets/' + id + '/display/?preview=True',\n            'edit'          : 'datasets/' + id + '/edit',\n            'download'      : 'datasets/' + id + '/display?to_ext=' + this.get( 'file_ext' ),\n            'report_error'  : 'dataset/errors?id=' + id,\n            'rerun'         : 'tool_runner/rerun?id=' + id,\n            'show_params'   : 'datasets/' + id + '/show_params',\n            'visualization' : 'visualization',\n            'meta_download' : 'dataset/get_metadata_file?hda_id=' + id + '&metadata_name='\n        };\n//TODO: global\n        _.each( urls, function( value, key ){\n            urls[ key ] = Galaxy.root + value;\n        });\n        this.urls = urls;\n        return urls;\n    },\n\n    /** set up any event listeners\n     *  event: state:ready  fired when this DA moves into/is already in a ready state\n     */\n    _setUpListeners : function(){\n        // if the state has changed and the new state is a ready state, fire an event\n        this.on( 'change:state', function( currModel, newState ){\n            this.log( this + ' has changed state:', currModel, newState );\n            if( this.inReadyState() ){\n                this.trigger( 'state:ready', currModel, newState, this.previous( 'state' ) );\n            }\n        });\n        // the download url (currently) relies on having a correct file extension\n        this.on( 'change:id change:file_ext', function( currModel ){\n            this._generateUrls();\n        });\n    },\n\n    // ........................................................................ common queries\n    /** override to add urls */\n    toJSON : function(){\n        var json = Backbone.Model.prototype.toJSON.call( this );\n        //console.warn( 'returning json?' );\n        //return json;\n        return _.extend( json, {\n            urls : this.urls\n        });\n    },\n\n    /** Is this dataset deleted or purged? */\n    isDeletedOrPurged : function(){\n        return ( this.get( 'deleted' ) || this.get( 'purged' ) );\n    },\n\n    /** Is this dataset in a 'ready' state; where 'Ready' states are states where no\n     *      processing (for the ds) is left to do on the server.\n     */\n    inReadyState : function(){\n        var ready = _.contains( STATES.READY_STATES, this.get( 'state' ) );\n        return ( this.isDeletedOrPurged() || ready );\n    },\n\n    /** Does this model already contain detailed data (as opposed to just summary level data)? */\n    hasDetails : function(){\n        // if it's inaccessible assume it has everything it needs\n        if( !this.get( 'accessible' ) ){ return true; }\n        //?? this may not be reliable\n        return _.has( this.attributes, 'genome_build' );\n    },\n\n    /** Convenience function to match dataset.has_data. */\n    hasData : function(){\n        return ( this.get( 'file_size' ) > 0 );\n    },\n\n    // ........................................................................ ajax\n    fetch : function( options ){\n        var dataset = this;\n        return Backbone.Model.prototype.fetch.call( this, options )\n            .always( function(){\n                dataset._generateUrls();\n            });\n    },\n\n    //NOTE: subclasses of DA's will need to implement url and urlRoot in order to have these work properly\n    /** save this dataset, _Mark_ing it as deleted (just a flag) */\n    'delete' : function( options ){\n        if( this.get( 'deleted' ) ){ return jQuery.when(); }\n        return this.save( { deleted: true }, options );\n    },\n    /** save this dataset, _Mark_ing it as undeleted */\n    undelete : function( options ){\n        if( !this.get( 'deleted' ) || this.get( 'purged' ) ){ return jQuery.when(); }\n        return this.save( { deleted: false }, options );\n    },\n\n    /** remove the file behind this dataset from the filesystem (if permitted) */\n    purge : function _purge( options ){\n//TODO: use, override model.destroy, HDA.delete({ purge: true })\n        if( this.get( 'purged' ) ){ return jQuery.when(); }\n        options = options || {};\n        //var hda = this,\n        //    //xhr = jQuery.ajax( this.url() + '?' + jQuery.param({ purge: true }), _.extend({\n        //    xhr = jQuery.ajax( this.url(), _.extend({\n        //        type : 'DELETE',\n        //        data : {\n        //            purge : true\n        //        }\n        //    }, options ));\n        //\n        //xhr.done( function( response ){\n        //    hda.debug( 'response', response );\n        //    //hda.set({ deleted: true, purged: true });\n        //    hda.set( response );\n        //});\n        //return xhr;\n\n        options.url = this.urls.purge;\n\n        //TODO: ideally this would be a DELETE call to the api\n        //  using purge async for now\n        var hda = this,\n            xhr = jQuery.ajax( options );\n        xhr.done( function( message, status, responseObj ){\n            hda.set({ deleted: true, purged: true });\n        });\n        xhr.fail( function( xhr, status, message ){\n            // Exception messages are hidden within error page including:  '...not allowed in this Galaxy instance.'\n            // unbury and re-add to xhr\n            var error = _l( \"Unable to purge dataset\" );\n            var messageBuriedInUnfortunatelyFormattedError = ( 'Removal of datasets by users '\n                + 'is not allowed in this Galaxy instance' );\n            if( xhr.responseJSON && xhr.responseJSON.error ){\n                error = xhr.responseJSON.error;\n            } else if( xhr.responseText.indexOf( messageBuriedInUnfortunatelyFormattedError ) !== -1 ){\n                error = messageBuriedInUnfortunatelyFormattedError;\n            }\n            xhr.responseText = error;\n            hda.trigger( 'error', hda, xhr, options, _l( error ), { error: error } );\n        });\n        return xhr;\n    },\n\n    // ........................................................................ searching\n    // see base-mvc, SearchableModelMixin\n\n    /** what attributes of an HDA will be used in a text search */\n    searchAttributes : [\n        'name', 'file_ext', 'genome_build', 'misc_blurb', 'misc_info', 'annotation', 'tags'\n    ],\n\n    /** our attr keys don't often match the labels we display to the user - so, when using\n     *      attribute specifiers ('name=\"bler\"') in a term, allow passing in aliases for the\n     *      following attr keys.\n     */\n    searchAliases : {\n        title       : 'name',\n        format      : 'file_ext',\n        database    : 'genome_build',\n        blurb       : 'misc_blurb',\n        description : 'misc_blurb',\n        info        : 'misc_info',\n        tag         : 'tags'\n    },\n\n    // ........................................................................ misc\n    /** String representation */\n    toString : function(){\n        var nameAndId = this.get( 'id' ) || '';\n        if( this.get( 'name' ) ){\n            nameAndId = '\"' + this.get( 'name' ) + '\",' + nameAndId;\n        }\n        return 'Dataset(' + nameAndId + ')';\n    }\n}));\n\n\n//==============================================================================\n/** @class Backbone collection for dataset associations.\n */\nvar DatasetAssociationCollection = Backbone.Collection.extend( BASE_MVC.LoggableMixin ).extend(\n/** @lends HistoryContents.prototype */{\n    _logNamespace : logNamespace,\n\n    model : DatasetAssociation,\n\n    /** root api url */\n    urlRoot : Galaxy.root + 'api/datasets',\n\n    /** url fn */\n    url : function(){\n        return this.urlRoot;\n    },\n\n    // ........................................................................ common queries\n    /** Get the ids of every item in this collection\n     *  @returns array of encoded ids\n     */\n    ids : function(){\n        return this.map( function( item ){ return item.get('id'); });\n    },\n\n    /** Get contents that are not ready\n     *  @returns array of content models\n     */\n    notReady : function(){\n        return this.filter( function( content ){\n            return !content.inReadyState();\n        });\n    },\n\n    /** return true if any datasets don't have details */\n    haveDetails : function(){\n        return this.all( function( dataset ){ return dataset.hasDetails(); });\n    },\n\n    // ........................................................................ ajax\n    /** using a queue, perform ajaxFn on each of the models in this collection */\n    ajaxQueue : function( ajaxFn, options ){\n        var deferred = jQuery.Deferred(),\n            startingLength = this.length,\n            responses = [];\n\n        if( !startingLength ){\n            deferred.resolve([]);\n            return deferred;\n        }\n\n        // use reverse order (stylistic choice)\n        var ajaxFns = this.chain().reverse().map( function( dataset, i ){\n            return function(){\n                var xhr = ajaxFn.call( dataset, options );\n                // if successful, notify using the deferred to allow tracking progress\n                xhr.done( function( response ){\n                    deferred.notify({ curr: i, total: startingLength, response: response, model: dataset });\n                });\n                // (regardless of previous error or success) if not last ajax call, shift and call the next\n                //  if last fn, resolve deferred\n                xhr.always( function( response ){\n                    responses.push( response );\n                    if( ajaxFns.length ){\n                        ajaxFns.shift()();\n                    } else {\n                        deferred.resolve( responses );\n                    }\n                });\n            };\n        }).value();\n        // start the queue\n        ajaxFns.shift()();\n\n        return deferred;\n    },\n\n    // ........................................................................ sorting/filtering\n    /** return a new collection of datasets whose attributes contain the substring matchesWhat */\n    matches : function( matchesWhat ){\n        return this.filter( function( dataset ){\n            return dataset.matches( matchesWhat );\n        });\n    },\n\n    // ........................................................................ misc\n    ///** Convert this ad-hoc collection of hdas to a formal collection tracked\n    //    by the server.\n    //**/\n    //promoteToHistoryDatasetCollection : function _promote( history, collection_type, options ){\n    //},\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'DatasetAssociationCollection(', this.length, ')' ].join( '' ));\n    }\n});\n\n\n//==============================================================================\n    return {\n        DatasetAssociation              : DatasetAssociation,\n        DatasetAssociationCollection    : DatasetAssociationCollection\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/dataset/dataset-model.js\n **/","define([\n    \"mvc/dataset/dataset-li\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( DATASET_LI, BASE_MVC, _l ){\n\n'use strict';\n\n//==============================================================================\nvar _super = DATASET_LI.DatasetListItemView;\n/** @class Read only view for HistoryDatasetAssociation.\n *      Since there are no controls on the HDAView to hide the dataset,\n *      the primary thing this class does (currently) is override templates\n *      to render the HID.\n */\nvar HDAListItemView = _super.extend(\n/** @lends HDAListItemView.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    className   : _super.prototype.className + \" history-content\",\n\n    initialize : function( attributes, options ){\n        _super.prototype.initialize.call( this, attributes, options );\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'HDAListItemView(' + modelString + ')';\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nHDAListItemView.prototype.templates = (function(){\n//TODO: move to require text! plugin\n\n    var titleBarTemplate = BASE_MVC.wrapTemplate([\n        // adding the hid display to the title\n        '<div class=\"title-bar clear\" tabindex=\"0\">',\n            '<span class=\"state-icon\"></span>',\n            '<div class=\"title\">',\n                //TODO: remove whitespace and use margin-right\n                '<span class=\"hid\"><%- dataset.hid %></span> ',\n                '<span class=\"name\"><%- dataset.name %></span>',\n            '</div>',\n        '</div>'\n    ], 'dataset' );\n\n    var warnings = _.extend( {}, _super.prototype.templates.warnings, {\n        hidden : BASE_MVC.wrapTemplate([\n            // add a warning when hidden\n            '<% if( !dataset.visible ){ %>',\n                '<div class=\"hidden-msg warningmessagesmall\">',\n                    _l( 'This dataset has been hidden' ),\n                '</div>',\n            '<% } %>'\n        ], 'dataset' )\n    });\n\n    return _.extend( {}, _super.prototype.templates, {\n        titleBar : titleBarTemplate,\n        warnings : warnings\n    });\n}());\n\n\n\n//==============================================================================\n    return {\n        HDAListItemView  : HDAListItemView\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/history/hda-li.js\n **/","define([\n    \"mvc/dataset/dataset-model\",\n    \"mvc/history/history-content-model\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( DATASET, HISTORY_CONTENT, BASE_MVC, _l ){\n\n'use strict';\n\n//==============================================================================\nvar _super = DATASET.DatasetAssociation,\n    hcontentMixin = HISTORY_CONTENT.HistoryContentMixin;\n/** @class (HDA) model for a Galaxy dataset contained in and related to a history.\n */\nvar HistoryDatasetAssociation = _super.extend( BASE_MVC.mixin( hcontentMixin,\n/** @lends HistoryDatasetAssociation.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n    //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n    //  - re-apply manually it now\n    /** call the mixin constructor */\n    constructor : function( attrs, options ){\n        hcontentMixin.constructor.call( this, attrs, options );\n    },\n\n    /** default attributes for a model */\n    defaults : _.extend( {}, _super.prototype.defaults, hcontentMixin.defaults, {\n        model_class         : 'HistoryDatasetAssociation'\n    }),\n\n    /** Set up the model, determine if accessible, bind listeners\n     */\n    initialize : function( attributes, options ){\n        _super.prototype.initialize.call( this, attributes, options );\n        hcontentMixin.initialize.call( this, attributes, options );\n    },\n\n    // ........................................................................ misc\n    /** String representation */\n    toString : function(){\n        var nameAndId = this.get( 'id' ) || '';\n        if( this.get( 'name' ) ){\n            nameAndId = this.get( 'hid' ) + ' :\"' + this.get( 'name' ) + '\",' + nameAndId;\n        }\n        return 'HDA(' + nameAndId + ')';\n    }\n}));\n\n//==============================================================================\n    return {\n        HistoryDatasetAssociation   : HistoryDatasetAssociation\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/history/hda-model.js\n **/","define([\n    \"mvc/dataset/states\",\n    \"mvc/collection/collection-li\",\n    \"mvc/collection/collection-view\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( STATES, DC_LI, DC_VIEW, BASE_MVC, _l ){\n\n'use strict';\n\n//==============================================================================\nvar _super = DC_LI.DCListItemView;\n/** @class Read only view for HistoryDatasetCollectionAssociation (a dataset collection inside a history).\n */\nvar HDCAListItemView = _super.extend(\n/** @lends HDCAListItemView.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    className   : _super.prototype.className + \" history-content\",\n\n    /** event listeners */\n    _setUpListeners : function(){\n        _super.prototype._setUpListeners.call( this );\n\n        this.listenTo( this.model, {\n            'change:populated change:visible' : function( model, options ){ this.render(); },\n        });\n    },\n\n    /** Override to provide the proper collections panels as the foldout */\n    _getFoldoutPanelClass : function(){\n        switch( this.model.get( 'collection_type' ) ){\n            case 'list':\n                return DC_VIEW.ListCollectionView;\n            case 'paired':\n                return DC_VIEW.PairCollectionView;\n            case 'list:paired':\n                return DC_VIEW.ListOfPairsCollectionView;\n        }\n        throw new TypeError( 'Uknown collection_type: ' + this.model.get( 'collection_type' ) );\n    },\n\n    /** In this override, add the state as a class for use with state-based CSS */\n    _swapNewRender : function( $newRender ){\n        _super.prototype._swapNewRender.call( this, $newRender );\n//TODO: model currently has no state\n        var state = !this.model.get( 'populated' ) ? STATES.RUNNING : STATES.OK;\n        //if( this.model.has( 'state' ) ){\n        this.$el.addClass( 'state-' + state );\n        //}\n        return this.$el;\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'HDCAListItemView(' + modelString + ')';\n    }\n});\n\n/** underscore templates */\nHDCAListItemView.prototype.templates = (function(){\n\n    var warnings = _.extend( {}, _super.prototype.templates.warnings, {\n        hidden : BASE_MVC.wrapTemplate([\n            // add a warning when hidden\n            '<% if( !collection.visible ){ %>',\n                '<div class=\"hidden-msg warningmessagesmall\">',\n                    _l( 'This collection has been hidden' ),\n                '</div>',\n            '<% } %>'\n        ], 'collection' )\n    });\n\n// could steal this from hda-base (or use mixed content)\n    var titleBarTemplate = BASE_MVC.wrapTemplate([\n        // adding the hid display to the title\n        '<div class=\"title-bar clear\" tabindex=\"0\">',\n            '<span class=\"state-icon\"></span>',\n            '<div class=\"title\">',\n                //TODO: remove whitespace and use margin-right\n                '<span class=\"hid\"><%- collection.hid %></span> ',\n                '<span class=\"name\"><%- collection.name %></span>',\n            '</div>',\n            '<div class=\"subtitle\"></div>',\n        '</div>'\n    ], 'collection' );\n\n    return _.extend( {}, _super.prototype.templates, {\n        warnings : warnings,\n        titleBar : titleBarTemplate\n    });\n}());\n\n\n//==============================================================================\n    return {\n        HDCAListItemView : HDCAListItemView\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/history/hdca-li.js\n **/","\ndefine([\n    \"mvc/history/history-contents\",\n    \"utils/utils\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( HISTORY_CONTENTS, UTILS, BASE_MVC, _l ){\n\n'use strict';\n\nvar logNamespace = 'history';\n//==============================================================================\n/** @class Model for a Galaxy history resource - both a record of user\n *      tool use and a collection of the datasets those tools produced.\n *  @name History\n *  @augments Backbone.Model\n */\nvar History = Backbone.Model\n        .extend( BASE_MVC.LoggableMixin )\n        .extend( BASE_MVC.mixin( BASE_MVC.SearchableModelMixin, /** @lends History.prototype */{\n    _logNamespace : logNamespace,\n\n    // values from api (may need more)\n    defaults : {\n        model_class     : 'History',\n        id              : null,\n        name            : 'Unnamed History',\n        state           : 'new',\n\n        deleted         : false\n    },\n\n    // ........................................................................ urls\n    urlRoot: Galaxy.root + 'api/histories',\n\n    // ........................................................................ set up/tear down\n    /** Set up the model\n     *  @param {Object} historyJSON model data for this History\n     *  @param {Object[]} contentsJSON   array of model data for this History's contents (hdas or collections)\n     *  @param {Object} options     any extra settings including logger\n     */\n    initialize : function( historyJSON, contentsJSON, options ){\n        options = options || {};\n        this.logger = options.logger || null;\n        this.log( this + \".initialize:\", historyJSON, contentsJSON, options );\n\n        /** HistoryContents collection of the HDAs contained in this history. */\n        this.log( 'creating history contents:', contentsJSON );\n        this.contents = new HISTORY_CONTENTS.HistoryContents( contentsJSON || [], { historyId: this.get( 'id' )});\n        //// if we've got hdas passed in the constructor, load them\n        //if( contentsJSON && _.isArray( contentsJSON ) ){\n        //    this.log( 'resetting history contents:', contentsJSON );\n        //    this.contents.reset( contentsJSON );\n        //}\n\n        this._setUpListeners();\n\n        /** cached timeout id for the dataset updater */\n        this.updateTimeoutId = null;\n        // set up update timeout if needed\n        //this.checkForUpdates();\n    },\n\n    /** set up any event listeners for this history including those to the contained HDAs\n     *  events: error:contents  if an error occurred with the contents collection\n     */\n    _setUpListeners : function(){\n        this.on( 'error', function( model, xhr, options, msg, details ){\n            this.errorHandler( model, xhr, options, msg, details );\n        });\n\n        // hda collection listening\n        if( this.contents ){\n            this.listenTo( this.contents, 'error', function(){\n                this.trigger.apply( this, [ 'error:contents' ].concat( jQuery.makeArray( arguments ) ) );\n            });\n        }\n        // if the model's id changes ('current' or null -> an actual id), update the contents history_id\n        this.on( 'change:id', function( model, newId ){\n            if( this.contents ){\n                this.contents.historyId = newId;\n            }\n        });\n    },\n\n    //TODO: see base-mvc\n    //onFree : function(){\n    //    if( this.contents ){\n    //        this.contents.free();\n    //    }\n    //},\n\n    /** event listener for errors. Generally errors are handled outside this model */\n    errorHandler : function( model, xhr, options, msg, details ){\n        // clear update timeout on model err\n        this.clearUpdateTimeout();\n    },\n\n    /** convert size in bytes to a more human readable version */\n    nice_size : function(){\n        return UTILS.bytesToString( this.get( 'size' ), true, 2 );\n    },\n\n    /** override to add nice_size */\n    toJSON : function(){\n        return _.extend( Backbone.Model.prototype.toJSON.call( this ), {\n            nice_size : this.nice_size()\n        });\n    },\n\n    /** override to allow getting nice_size */\n    get : function( key ){\n        if( key === 'nice_size' ){\n            return this.nice_size();\n        }\n        return Backbone.Model.prototype.get.apply( this, arguments );\n    },\n\n    // ........................................................................ common queries\n    /** T/F is this history owned by the current user (Galaxy.user)\n     *      Note: that this will return false for an anon user even if the history is theirs.\n     */\n    ownedByCurrUser : function(){\n        // no currUser\n        if( !Galaxy || !Galaxy.user ){\n            return false;\n        }\n        // user is anon or history isn't owned\n        if( Galaxy.user.isAnonymous() || Galaxy.user.id !== this.get( 'user_id' ) ){\n            return false;\n        }\n        return true;\n    },\n\n    /**  */\n    contentsCount : function(){\n        return _.reduce( _.values( this.get( 'state_details' ) ), function( memo, num ){ return memo + num; }, 0 );\n    },\n\n    /** Return the number of running jobs assoc with this history (note: unknown === 0) */\n    numOfUnfinishedJobs : function(){\n        var unfinishedJobIds = this.get( 'non_ready_jobs' );\n        return unfinishedJobIds? unfinishedJobIds.length : 0;\n    },\n\n    /** Return the number of running hda/hdcas in this history (note: unknown === 0) */\n    numOfUnfinishedShownContents : function(){\n        var contents = this.contents.running().visibleAndUndeleted();\n        return contents? contents.length : 0;\n    },\n\n    // ........................................................................ search\n    /** What model fields to search with */\n    searchAttributes : [\n        'name', 'annotation', 'tags'\n    ],\n\n    /** Adding title and singular tag */\n    searchAliases : {\n        title       : 'name',\n        tag         : 'tags'\n    },\n\n    // ........................................................................ updates\n    _getSizeAndRunning : function(){\n        return this.fetch({ data : $.param({ keys : 'size,non_ready_jobs' }) });\n    },\n\n    /**  */\n    refresh : function( options ){\n        options = options || {};\n        var self = this;\n\n        var lastUpdateTime = self.lastUpdateTime;\n        // note: if there was no previous update time, all summary contents will be fetched\n        return self.contents.fetchUpdated( lastUpdateTime )\n            .done( function( response, status, xhr ){\n                var serverResponseDatetime;\n                try {\n                    serverResponseDatetime = new Date( xhr.getResponseHeader( 'Date' ) );\n                } catch( err ){}\n                self.lastUpdateTime = serverResponseDatetime || new Date();\n                self.checkForUpdates( options );\n            });\n    },\n\n    /**  */\n    checkForUpdates : function( options ){\n        options = options || {};\n        var delay = History.UPDATE_DELAY;\n        var self = this;\n\n        function _delayThenUpdate(){\n            // prevent buildup of updater timeouts by clearing previous if any, then set new and cache id\n            self.clearUpdateTimeout();\n            self.updateTimeoutId = setTimeout( function(){\n                self.refresh( options );\n            }, delay );\n        }\n\n        // if there are still datasets in the non-ready state, recurse into this function with the new time\n        if( this.numOfUnfinishedShownContents() > 0 ){\n            _delayThenUpdate();\n\n        } else {\n            // no datasets are running, but currently runnning jobs may still produce new datasets\n            // see if the history has any running jobs and continue to update if so\n            // (also update the size for the user in either case)\n            self._getSizeAndRunning()\n                .done( function( historyData ){\n                    if( self.numOfUnfinishedJobs() > 0 ){\n                        _delayThenUpdate();\n\n                    } else {\n                        // otherwise, let listeners know that all updates have stopped\n                        self.trigger( 'ready' );\n                    }\n                });\n        }\n    },\n\n    /** clear the timeout and the cached timeout id */\n    clearUpdateTimeout : function(){\n        if( this.updateTimeoutId ){\n            clearTimeout( this.updateTimeoutId );\n            this.updateTimeoutId = null;\n        }\n    },\n\n    // ........................................................................ ajax\n    /** save this history, _Mark_ing it as deleted (just a flag) */\n    _delete : function( options ){\n        if( this.get( 'deleted' ) ){ return jQuery.when(); }\n        return this.save( { deleted: true }, options );\n    },\n    /** purge this history, _Mark_ing it as purged and removing all dataset data from the server */\n    purge : function( options ){\n        if( this.get( 'purged' ) ){ return jQuery.when(); }\n        return this.save( { deleted: true, purged: true }, options );\n    },\n    /** save this history, _Mark_ing it as undeleted */\n    undelete : function( options ){\n        if( !this.get( 'deleted' ) ){ return jQuery.when(); }\n        return this.save( { deleted: false }, options );\n    },\n\n    /** Make a copy of this history on the server\n     *  @param {Boolean} current    if true, set the copy as the new current history (default: true)\n     *  @param {String} name        name of new history (default: none - server sets to: Copy of <current name>)\n     *  @fires copied               passed this history and the response JSON from the copy\n     *  @returns {xhr}\n     */\n    copy : function( current, name, allDatasets ){\n        current = ( current !== undefined )?( current ):( true );\n        if( !this.id ){\n            throw new Error( 'You must set the history ID before copying it.' );\n        }\n\n        var postData = { history_id  : this.id };\n        if( current ){\n            postData.current = true;\n        }\n        if( name ){\n            postData.name = name;\n        }\n        if( !allDatasets ){\n            postData.all_datasets = false;\n        }\n\n        var history = this,\n            copy = jQuery.post( this.urlRoot, postData );\n        // if current - queue to setAsCurrent before firing 'copied'\n        if( current ){\n            return copy.then( function( response ){\n                var newHistory = new History( response );\n                return newHistory.setAsCurrent()\n                    .done( function(){\n                        history.trigger( 'copied', history, response );\n                    });\n            });\n        }\n        return copy.done( function( response ){\n            history.trigger( 'copied', history, response );\n        });\n    },\n\n    setAsCurrent : function(){\n        var history = this,\n            xhr = jQuery.getJSON( Galaxy.root + 'history/set_as_current?id=' + this.id );\n\n        xhr.done( function(){\n            history.trigger( 'set-as-current', history );\n        });\n        return xhr;\n    },\n\n    // ........................................................................ misc\n    toString : function(){\n        return 'History(' + this.get( 'id' ) + ',' + this.get( 'name' ) + ')';\n    }\n}));\n\n//------------------------------------------------------------------------------ CLASS VARS\n/** When the history has running hdas,\n *  this is the amount of time between update checks from the server\n */\nHistory.UPDATE_DELAY = 4000;\n\n/** Get data for a history then its hdas using a sequential ajax call, return a deferred to receive both */\nHistory.getHistoryData = function getHistoryData( historyId, options ){\n    options = options || {};\n    var detailIdsFn = options.detailIdsFn || [];\n    var hdcaDetailIds = options.hdcaDetailIds || [];\n    //console.debug( 'getHistoryData:', historyId, options );\n\n    var df = jQuery.Deferred(),\n        historyJSON = null;\n\n    function getHistory( id ){\n        // get the history data\n        if( historyId === 'current' ){\n            return jQuery.getJSON( Galaxy.root + 'history/current_history_json' );\n        }\n        return jQuery.ajax( Galaxy.root + 'api/histories/' + historyId );\n    }\n    function isEmpty( historyData ){\n        // get the number of hdas accrd. to the history\n        return historyData && historyData.empty;\n    }\n    function getContents( historyData ){\n        // get the hda data\n        // if no hdas accrd. to history: return empty immed.\n        if( isEmpty( historyData ) ){ return []; }\n        // if there are hdas accrd. to history: get those as well\n        if( _.isFunction( detailIdsFn ) ){\n            detailIdsFn = detailIdsFn( historyData );\n        }\n        if( _.isFunction( hdcaDetailIds ) ){\n            hdcaDetailIds = hdcaDetailIds( historyData );\n        }\n        var data = {\n            v : 'dev'\n        };\n        if( detailIdsFn.length ) {\n            data.details = detailIdsFn.join( ',' );\n        }\n        return jQuery.ajax( Galaxy.root + 'api/histories/' + historyData.id + '/contents', { data: data });\n    }\n\n    // getting these concurrently is 400% slower (sqlite, local, vanilla) - so:\n    //  chain the api calls - getting history first then contents\n\n    var historyFn = options.historyFn || getHistory,\n        contentsFn = options.contentsFn || getContents;\n\n    // chain ajax calls: get history first, then hdas\n    var historyXHR = historyFn( historyId );\n    historyXHR.done( function( json ){\n        // set outer scope var here for use below\n        historyJSON = json;\n        df.notify({ status: 'history data retrieved', historyJSON: historyJSON });\n    });\n    historyXHR.fail( function( xhr, status, message ){\n        // call reject on the outer deferred to allow its fail callback to run\n        df.reject( xhr, 'loading the history' );\n    });\n\n    var contentsXHR = historyXHR.then( contentsFn );\n    contentsXHR.then( function( contentsJSON ){\n        df.notify({ status: 'contents data retrieved', historyJSON: historyJSON, contentsJSON: contentsJSON });\n        // we've got both: resolve the outer scope deferred\n        df.resolve( historyJSON, contentsJSON );\n    });\n    contentsXHR.fail( function( xhr, status, message ){\n        // call reject on the outer deferred to allow its fail callback to run\n        df.reject( xhr, 'loading the contents', { history: historyJSON } );\n    });\n\n    return df;\n};\n\n\n//==============================================================================\nvar ControlledFetchMixin = {\n\n    /** Override to convert certain options keys into API index parameters */\n    fetch : function( options ){\n        options = options || {};\n        options.data = options.data || this._buildFetchData( options );\n        // use repeated params for arrays, e.g. q=1&qv=1&q=2&qv=2\n        options.traditional = true;\n        return Backbone.Collection.prototype.fetch.call( this, options );\n    },\n\n    /** These attribute keys are valid params to fetch/API-index */\n    _fetchOptions : [\n        /** model dependent string to control the order of models returned */\n        'order',\n        /** limit the number of models returned from a fetch */\n        'limit',\n        /** skip this number of models when fetching */\n        'offset',\n        /** what series of attributes to return (model dependent) */\n        'view',\n        /** individual keys to return for the models (see api/histories.index) */\n        'keys'\n    ],\n\n    /** Build the data dictionary to send to fetch's XHR as data */\n    _buildFetchData : function( options ){\n        var data = {},\n            fetchDefaults = this._fetchDefaults();\n        options = _.defaults( options || {}, fetchDefaults );\n        data = _.pick( options, this._fetchOptions );\n\n        var filters = _.has( options, 'filters' )? options.filters : ( fetchDefaults.filters || {} );\n        if( !_.isEmpty( filters ) ){\n            _.extend( data, this._buildFetchFilters( filters ) );\n        }\n        return data;\n    },\n\n    /** Override to have defaults for fetch options and filters */\n    _fetchDefaults : function(){\n        // to be overridden\n        return {};\n    },\n\n    /** Convert dictionary filters to qqv style arrays */\n    _buildFetchFilters : function( filters ){\n        var filterMap = {\n            q  : [],\n            qv : []\n        };\n        _.each( filters, function( v, k ){\n            if( v === true ){ v = 'True'; }\n            if( v === false ){ v = 'False'; }\n            if( v === null ){ v = 'None'; }\n            filterMap.q.push( k );\n            filterMap.qv.push( v );\n        });\n        return filterMap;\n    },\n};\n\n//==============================================================================\n/** @class A collection of histories (per user).\n *      (stub) currently unused.\n */\nvar HistoryCollection = Backbone.Collection\n        .extend( BASE_MVC.LoggableMixin )\n        .extend( ControlledFetchMixin )\n        .extend(/** @lends HistoryCollection.prototype */{\n    _logNamespace : logNamespace,\n\n    model   : History,\n\n    /** @type {String} the default sortOrders key for sorting */\n    DEFAULT_ORDER : 'update_time',\n\n    /** @type {Object} map of collection sorting orders generally containing a getter to return the attribute\n     *      sorted by and asc T/F if it is an ascending sort.\n     */\n    sortOrders : {\n        'update_time' : {\n            getter : function( h ){ return new Date( h.get( 'update_time' ) ); },\n            asc : false\n        },\n        'update_time-asc' : {\n            getter : function( h ){ return new Date( h.get( 'update_time' ) ); },\n            asc : true\n        },\n        'name' : {\n            getter : function( h ){ return h.get( 'name' ); },\n            asc : true\n        },\n        'name-dsc' : {\n            getter : function( h ){ return h.get( 'name' ); },\n            asc : false\n        },\n        'size' : {\n            getter : function( h ){ return h.get( 'size' ); },\n            asc : false\n        },\n        'size-asc' : {\n            getter : function( h ){ return h.get( 'size' ); },\n            asc : true\n        }\n    },\n\n    initialize : function( models, options ){\n        options = options || {};\n        this.log( 'HistoryCollection.initialize', arguments );\n\n        // instance vars\n        /** @type {boolean} should deleted histories be included */\n        this.includeDeleted = options.includeDeleted || false;\n        // set the sort order\n        this.setOrder( options.order || this.DEFAULT_ORDER );\n        /** @type {String} encoded id of the history that's current */\n        this.currentHistoryId = options.currentHistoryId;\n        /** @type {boolean} have all histories been fetched and in the collection? */\n        this.allFetched = options.allFetched || false;\n\n        // this.on( 'all', function(){\n        //    console.info( 'event:', arguments );\n        // });\n        this.setUpListeners();\n    },\n\n    urlRoot : Galaxy.root + 'api/histories',\n    url     : function(){ return this.urlRoot; },\n\n    /** returns map of default filters and settings for fetching from the API */\n    _fetchDefaults : function(){\n        // to be overridden\n        var defaults = {\n            order   : this.order,\n            view    : 'detailed'\n        };\n        if( !this.includeDeleted ){\n            defaults.filters = {\n                deleted : false,\n                purged  : false,\n            };\n        } else {\n            defaults.filters = {\n                // TODO: for bypassing defaults on current API\n                deleted : null,\n            };\n        }\n        return defaults;\n    },\n\n    /** set up reflexive event handlers */\n    setUpListeners : function setUpListeners(){\n        this.on({\n            // when a history is deleted, remove it from the collection (if optionally set to do so)\n            'change:deleted' : function( history ){\n                // TODO: this becomes complicated when more filters are used\n                this.debug( 'change:deleted', this.includeDeleted, history.get( 'deleted' ) );\n                if( !this.includeDeleted && history.get( 'deleted' ) ){\n                    this.remove( history );\n                }\n            },\n            // listen for a history copy, setting it to current\n            'copied' : function( original, newData ){\n                this.setCurrent( new History( newData, [] ) );\n            },\n            // when a history is made current, track the id in the collection\n            'set-as-current' : function( history ){\n                var oldCurrentId = this.currentHistoryId;\n                this.trigger( 'no-longer-current', oldCurrentId );\n                this.currentHistoryId = history.id;\n            }\n        });\n    },\n\n    /** override to allow passing options.order and setting the sort order to one of sortOrders */\n    sort : function( options ){\n        options = options || {};\n        this.setOrder( options.order );\n        return Backbone.Collection.prototype.sort.call( this, options );\n    },\n\n    /** build the comparator used to sort this collection using the sortOrder map and the given order key\n     *  @event 'changed-order' passed the new order and the collection\n     */\n    setOrder : function( order ){\n        var collection = this,\n            sortOrder = this.sortOrders[ order ];\n        if( _.isUndefined( sortOrder ) ){ return; }\n\n        collection.order = order;\n        collection.comparator = function comparator( a, b ){\n            var currentHistoryId = collection.currentHistoryId;\n            // current always first\n            if( a.id === currentHistoryId ){ return -1; }\n            if( b.id === currentHistoryId ){ return 1; }\n            // then compare by an attribute\n            a = sortOrder.getter( a );\n            b = sortOrder.getter( b );\n            return sortOrder.asc?\n                ( ( a === b )?( 0 ):( a > b ?  1 : -1 ) ):\n                ( ( a === b )?( 0 ):( a > b ? -1 :  1 ) );\n        };\n        collection.trigger( 'changed-order', collection.order, collection );\n        return collection;\n    },\n\n    /** override to provide order and offsets based on instance vars, set limit if passed,\n     *  and set allFetched/fire 'all-fetched' when xhr returns\n     */\n    fetch : function( options ){\n        options = options || {};\n        if( this.allFetched ){ return jQuery.when({}); }\n        var collection = this,\n            fetchOptions = _.defaults( options, {\n                remove : false,\n                offset : collection.length >= 1? ( collection.length - 1 ) : 0,\n                order  : collection.order\n            }),\n            limit = options.limit;\n        if( !_.isUndefined( limit ) ){\n            fetchOptions.limit = limit;\n        }\n\n        return ControlledFetchMixin.fetch.call( this, fetchOptions )\n            .done( function _postFetchMore( fetchData ){\n                var numFetched = _.isArray( fetchData )? fetchData.length : 0;\n                // anything less than a full page means we got all there is to get\n                if( !limit || numFetched < limit ){\n                    collection.allFetched = true;\n                    collection.trigger( 'all-fetched', collection );\n                }\n            }\n        );\n    },\n\n    /** create a new history and by default set it to be the current history */\n    create : function create( data, hdas, historyOptions, xhrOptions ){\n        //TODO: .create is actually a collection function that's overridden here\n        var collection = this,\n            xhr = jQuery.getJSON( Galaxy.root + 'history/create_new_current'  );\n        return xhr.done( function( newData ){\n            collection.setCurrent( new History( newData, [], historyOptions || {} ) );\n        });\n    },\n\n    /** set the current history to the given history, placing it first in the collection.\n     *  Pass standard bbone options for use in unshift.\n     *  @triggers new-current passed history and this collection\n     */\n    setCurrent : function( history, options ){\n        options = options || {};\n        // new histories go in the front\n        this.unshift( history, options );\n        this.currentHistoryId = history.get( 'id' );\n        if( !options.silent ){\n            this.trigger( 'new-current', history, this );\n        }\n        return this;\n    },\n\n    /** override to reset allFetched flag to false */\n    reset : function( models, options ){\n        this.allFetched = false;\n        return Backbone.Collection.prototype.reset.call( this, models, options );\n    },\n\n    toString: function toString(){\n        return 'HistoryCollection(' + this.length + ')';\n    }\n});\n\n//==============================================================================\nreturn {\n    History           : History,\n    HistoryCollection : HistoryCollection\n};});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/history/history-model.js\n **/","define([\n    \"mvc/list/list-item\",\n    \"ui/loading-indicator\",\n    \"mvc/base-mvc\",\n    \"utils/localization\",\n    \"ui/search-input\"\n], function( LIST_ITEM, LoadingIndicator, BASE_MVC, _l ){\n\n'use strict';\n\nvar logNamespace = 'list';\n/* ============================================================================\nTODO:\n\n============================================================================ */\n/** @class View for a list/collection of models and the sub-views of those models.\n *      Sub-views must (at least have the interface if not) inherit from ListItemView.\n *      (For a list panel that also includes some 'container' model (History->HistoryContents)\n *      use ModelWithListPanel)\n *\n *  Allows for:\n *      searching collection/sub-views\n *      selecting/multi-selecting sub-views\n *\n *  Currently used:\n *      for dataset/dataset-choice\n *      as superclass of ModelListPanel\n */\nvar ListPanel = Backbone.View.extend( BASE_MVC.LoggableMixin ).extend(/** @lends ListPanel.prototype */{\n    _logNamespace : logNamespace,\n\n    /** class to use for constructing the sub-views */\n    viewClass           : LIST_ITEM.ListItemView,\n    /** class to used for constructing collection of sub-view models */\n    collectionClass     : Backbone.Collection,\n\n    tagName             : 'div',\n    className           : 'list-panel',\n\n    /** (in ms) that jquery effects will use */\n    fxSpeed             : 'fast',\n\n    /** string to display when the collection has no contents */\n    emptyMsg            : _l( 'This list is empty' ),\n    /** displayed when no items match the search terms */\n    noneFoundMsg        : _l( 'No matching items found' ),\n    /** string used for search placeholder */\n    searchPlaceholder   : _l( 'search' ),\n\n    // ......................................................................... SET UP\n    /** Set up the view, set up storage, bind listeners to HistoryContents events\n     *  @param {Object} attributes optional settings for the list\n     */\n    initialize : function( attributes, options ){\n        attributes = attributes || {};\n        // set the logger if requested\n        if( attributes.logger ){\n            this.logger = attributes.logger;\n        }\n        this.log( this + '.initialize:', attributes );\n\n        // ---- instance vars\n        /** how quickly should jquery fx run? */\n        this.fxSpeed = _.has( attributes, 'fxSpeed' )?( attributes.fxSpeed ):( this.fxSpeed );\n\n        /** filters for displaying subviews */\n        this.filters = [];\n        /** current search terms */\n        this.searchFor = attributes.searchFor || '';\n\n        /** loading indicator */\n        this.indicator = new LoadingIndicator( this.$el );\n\n        /** currently showing selectors on items? */\n        this.selecting = ( attributes.selecting !== undefined )? attributes.selecting : true;\n        //this.selecting = false;\n\n        /** cached selected item.model.ids to persist btwn renders */\n        this.selected = attributes.selected || [];\n        /** the last selected item.model.id */\n        this.lastSelected = null;\n\n        /** are sub-views draggable */\n        this.dragItems = attributes.dragItems || false;\n\n        /** list item view class (when passed models) */\n        this.viewClass = attributes.viewClass || this.viewClass;\n\n        /** list item views */\n        this.views = [];\n        /** list item models */\n        this.collection = attributes.collection || ( new this.collectionClass([]) );\n\n        /** filter fns run over collection items to see if they should show in the list */\n        this.filters = attributes.filters || [];\n\n        /** override $scrollContainer fn via attributes - fn should return jq for elem to call scrollTo on */\n        this.$scrollContainer = attributes.$scrollContainer || this.$scrollContainer;\n\n//TODO: remove\n        this.title = attributes.title || '';\n        this.subtitle = attributes.subtitle || '';\n\n        this._setUpListeners();\n    },\n\n    /** free any sub-views the list has */\n    freeViews : function(){\n//TODO: stopListening? remove?\n        _.each( this.views, function( view ){\n            view.off();\n        });\n        this.views = [];\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ listeners\n    /** create any event listeners for the list\n     */\n    _setUpListeners : function(){\n        this.off();\n\n        //TODO: move errorHandler down into list-view from history-view or\n        //  pass to global error handler (Galaxy)\n        this.on({\n            error: function( model, xhr, options, msg, details ){\n                //this.errorHandler( model, xhr, options, msg, details );\n                console.error( model, xhr, options, msg, details );\n            },\n            // show hide the loading indicator\n            loading: function(){\n                this._showLoadingIndicator( 'loading...', 40 );\n            },\n            'loading-done': function(){\n                this._hideLoadingIndicator( 40 );\n            },\n        });\n\n        // throw the first render up as a diff namespace using once (for outside consumption)\n        this.once( 'rendered', function(){\n            this.trigger( 'rendered:initial', this );\n        });\n\n        // debugging\n        if( this.logger ){\n            this.on( 'all', function( event ){\n                this.log( this + '', arguments );\n            });\n        }\n\n        this._setUpCollectionListeners();\n        this._setUpViewListeners();\n        return this;\n    },\n\n    /** listening for collection events */\n    _setUpCollectionListeners : function(){\n        this.log( this + '._setUpCollectionListeners', this.collection );\n        this.collection.off();\n\n        // bubble up error events\n        this.listenTo( this.collection, {\n            error   : function( model, xhr, options, msg, details ){\n                this.trigger( 'error', model, xhr, options, msg, details );\n            },\n            reset   : function(){\n                this.renderItems();\n            },\n            add     : this.addItemView,\n            remove  : this.removeItemView\n        });\n\n        // debugging\n        if( this.logger ){\n            this.listenTo( this.collection, 'all', function( event ){\n                this.info( this + '(collection)', arguments );\n            });\n        }\n        return this;\n    },\n\n    /** listening for sub-view events that bubble up with the 'view:' prefix */\n    _setUpViewListeners : function(){\n        this.log( this + '._setUpViewListeners' );\n\n        // shift to select a range\n        this.on({\n            'view:selected': function( view, ev ){\n                if( ev && ev.shiftKey && this.lastSelected ){\n                    var lastSelectedView = this.viewFromModelId( this.lastSelected );\n                    if( lastSelectedView ){\n                        this.selectRange( view, lastSelectedView );\n                    }\n                } else if( ev && ev.altKey && !this.selecting ){\n                    this.showSelectors();\n                }\n                this.selected.push( view.model.id );\n                this.lastSelected = view.model.id;\n            },\n\n            'view:de-selected': function( view, ev ){\n                this.selected = _.without( this.selected, view.model.id );\n                //this.lastSelected = view.model.id;\n            }\n        });\n    },\n\n    // ------------------------------------------------------------------------ rendering\n    /** Render this content, set up ui.\n     *  @param {Number or String} speed   the speed of the render\n     */\n    render : function( speed ){\n        this.log( this + '.render', speed );\n        var $newRender = this._buildNewRender();\n        this._setUpBehaviors( $newRender );\n        this._queueNewRender( $newRender, speed );\n        return this;\n    },\n\n    /** Build a temp div containing the new children for the view's $el.\n     */\n    _buildNewRender : function(){\n        this.debug( this + '(ListPanel)._buildNewRender' );\n        var $newRender = $( this.templates.el( {}, this ) );\n        this._renderControls( $newRender );\n        this._renderTitle( $newRender );\n        this._renderSubtitle( $newRender );\n        this._renderSearch( $newRender );\n        this.renderItems( $newRender );\n        return $newRender;\n    },\n\n    /** Build a temp div containing the new children for the view's $el.\n     */\n    _renderControls : function( $newRender ){\n        this.debug( this + '(ListPanel)._renderControls' );\n        var $controls = $( this.templates.controls( {}, this ) );\n        $newRender.find( '.controls' ).replaceWith( $controls );\n        return $controls;\n    },\n\n    /**\n     */\n    _renderTitle : function( $where ){\n        //$where = $where || this.$el;\n        //$where.find( '.title' ).replaceWith( ... )\n    },\n\n    /**\n     */\n    _renderSubtitle : function( $where ){\n        //$where = $where || this.$el;\n        //$where.find( '.title' ).replaceWith( ... )\n    },\n\n    /** Fade out the old el, swap in the new contents, then fade in.\n     *  @param {Number or String} speed   jq speed to use for rendering effects\n     *  @fires rendered when rendered\n     */\n    _queueNewRender : function( $newRender, speed ) {\n        speed = ( speed === undefined )?( this.fxSpeed ):( speed );\n        var panel = this;\n        panel.log( '_queueNewRender:', $newRender, speed );\n\n        $( panel ).queue( 'fx', [\n            function( next ){ this.$el.fadeOut( speed, next ); },\n            function( next ){\n                panel._swapNewRender( $newRender );\n                next();\n            },\n            function( next ){ this.$el.fadeIn( speed, next ); },\n            function( next ){\n                panel.trigger( 'rendered', panel );\n                next();\n            }\n        ]);\n    },\n\n    /** empty out the current el, move the $newRender's children in */\n    _swapNewRender : function( $newRender ){\n        this.$el.empty().attr( 'class', this.className ).append( $newRender.children() );\n        if( this.selecting ){ this.showSelectors( 0 ); }\n        return this;\n    },\n\n    /**  */\n    _setUpBehaviors : function( $where ){\n        $where = $where || this.$el;\n        $where.find( '.controls [title]' ).tooltip({ placement: 'bottom' });\n        // set up the pupup for actions available when multi selecting\n        this._renderMultiselectActionMenu( $where );\n        return this;\n    },\n\n    /** render a menu containing the actions available to sets of selected items */\n    _renderMultiselectActionMenu : function( $where ){\n        $where = $where || this.$el;\n        var $menu = $where.find( '.list-action-menu' ),\n            actions = this.multiselectActions();\n        if( !actions.length ){\n            return $menu.empty();\n        }\n\n        var $newMenu = $([\n            '<div class=\"list-action-menu btn-group\">',\n                '<button class=\"list-action-menu-btn btn btn-default dropdown-toggle\" data-toggle=\"dropdown\">',\n                    _l( 'For all selected' ), '...',\n                '</button>',\n                '<ul class=\"dropdown-menu pull-right\" role=\"menu\">', '</ul>',\n            '</div>'\n        ].join(''));\n        var $actions = actions.map( function( action ){\n            var html = [ '<li><a href=\"javascript:void(0);\">', action.html, '</a></li>' ].join( '' );\n            return $( html ).click( function( ev ){\n                ev.preventDefault();\n                return action.func( ev );\n            });\n        });\n        $newMenu.find( 'ul' ).append( $actions );\n        $menu.replaceWith( $newMenu );\n        return $newMenu;\n    },\n\n    /** return a list of plain objects used to render multiselect actions menu. Each object should have:\n     *      html: an html string used as the anchor contents\n     *      func: a function called when the anchor is clicked (passed the click event)\n     */\n    multiselectActions : function(){\n        return [];\n    },\n\n    // ------------------------------------------------------------------------ sub-$element shortcuts\n    /** the scroll container for this panel - can be $el, $el.parent(), or grandparent depending on context */\n    $scrollContainer : function(){\n        // override or set via attributes.$scrollContainer\n        return this.$el.parent().parent();\n    },\n    /**  */\n    $list : function( $where ){\n        return ( $where || this.$el ).find( '> .list-items' );\n    },\n    /** container where list messages are attached */\n    $messages : function( $where ){\n        return ( $where || this.$el ).find( '> .controls .messages' );\n    },\n    /** the message displayed when no views can be shown (no views, none matching search) */\n    $emptyMessage : function( $where ){\n        return ( $where || this.$el ).find( '> .empty-message' );\n    },\n\n    // ------------------------------------------------------------------------ hda sub-views\n    /**\n     *  @param {jQuery} $whereTo what dom element to prepend the sub-views to\n     *  @returns the visible item views\n     */\n    renderItems : function( $whereTo ){\n        $whereTo = $whereTo || this.$el;\n        var panel = this;\n        panel.log( this + '.renderItems', $whereTo );\n\n        var $list = panel.$list( $whereTo );\n//TODO: free prev. views?\n        panel.views = panel._filterCollection().map( function( itemModel ){\n//TODO: creates views each time - not neccessarily good\n//TODO: pass speed here\n                return panel._createItemView( itemModel ).render( 0 );\n            });\n        //panel.debug( item$els );\n        //panel.debug( newViews );\n\n        $list.empty();\n        if( panel.views.length ){\n            panel._attachItems( $whereTo );\n            panel.$emptyMessage( $whereTo ).hide();\n\n        } else {\n            panel._renderEmptyMessage( $whereTo ).show();\n        }\n        panel.trigger( 'views:ready', panel.views );\n\n        return panel.views;\n    },\n\n    /** Filter the collection to only those models that should be currently viewed */\n    _filterCollection : function(){\n        // override this\n        var panel = this;\n        return panel.collection.filter( _.bind( panel._filterItem, panel ) );\n    },\n\n    /** Should the model be viewable in the current state?\n     *     Checks against this.filters and this.searchFor\n     */\n    _filterItem : function( model ){\n        // override this\n        var panel = this;\n        return ( _.every( panel.filters.map( function( fn ){ return fn.call( model ); }) ) )\n            && ( !panel.searchFor || model.matchesAll( panel.searchFor ) );\n    },\n\n    /** Create a view for a model and set up it's listeners */\n    _createItemView : function( model ){\n        var ViewClass = this._getItemViewClass( model ),\n            options = _.extend( this._getItemViewOptions( model ), {\n                    model : model\n                }),\n            view = new ViewClass( options );\n        this._setUpItemViewListeners( view );\n        return view;\n    },\n\n    /** Get the bbone view class based on the model */\n    _getItemViewClass : function( model ){\n        // override this\n        return this.viewClass;\n    },\n\n    /** Get the options passed to the new view based on the model */\n    _getItemViewOptions : function( model ){\n        // override this\n        return {\n            //logger      : this.logger,\n            fxSpeed     : this.fxSpeed,\n            expanded    : false,\n            selectable  : this.selecting,\n            selected    : _.contains( this.selected, model.id ),\n            draggable   : this.dragItems\n        };\n    },\n\n    /** Set up listeners for new models */\n    _setUpItemViewListeners : function( view ){\n        var panel = this;\n        // send all events to the panel, re-namspaceing them with the view prefix\n        this.listenTo( view, 'all', function(){\n            var args = Array.prototype.slice.call( arguments, 0 );\n            args[0] = 'view:' + args[0];\n            panel.trigger.apply( panel, args );\n        });\n\n        // drag multiple - hijack ev.setData to add all selected items\n        this.listenTo( view, 'draggable:dragstart', function( ev, v ){\n            //TODO: set multiple drag data here\n            var json = {},\n                selected = this.getSelectedModels();\n            if( selected.length ){\n                json = selected.toJSON();\n            } else {\n                json = [ v.model.toJSON() ];\n            }\n            ev.dataTransfer.setData( 'text', JSON.stringify( json ) );\n            //ev.dataTransfer.setDragImage( v.el, 60, 60 );\n        }, this );\n\n        // debugging\n        //if( this.logger ){\n        //    view.on( 'all', function( event ){\n        //        this.log( this + '(view)', arguments );\n        //    }, this );\n        //}\n        return panel;\n    },\n\n    /** Attach views in this.views to the model based on $whereTo */\n    _attachItems : function( $whereTo ){\n        //ASSUMES: $list has been emptied\n        this.$list( $whereTo ).append( this.views.map( function( view ){\n            return view.$el;\n        }));\n        return this;\n    },\n\n    /** render the empty/none-found message */\n    _renderEmptyMessage : function( $whereTo ){\n        this.debug( '_renderEmptyMessage', $whereTo, this.searchFor );\n        var text = this.searchFor? this.noneFoundMsg : this.emptyMsg;\n        return this.$emptyMessage( $whereTo ).text( text );\n    },\n\n    /** collapse all item views */\n    expandAll : function(){\n        _.each( this.views, function( view ){\n            view.expand();\n        });\n    },\n\n    /** collapse all item views */\n    collapseAll : function(){\n        _.each( this.views, function( view ){\n            view.collapse();\n        });\n    },\n\n    // ------------------------------------------------------------------------ collection/views syncing\n    /** Add a view (if the model should be viewable) to the panel */\n    addItemView : function( model, collection, options ){\n        this.log( this + '.addItemView:', model );\n        var panel = this;\n        if( !panel._filterItem( model ) ){ return undefined; }\n\n        var view = panel._createItemView( model );\n        // hide the empty message if only view\n        $( view ).queue( 'fx', [\n            //TODO:? could poss. pubsub this\n            function( next ){ panel.$emptyMessage().fadeOut( panel.fxSpeed, next ); },\n            function( next ){\n                panel._attachView( view );\n                next();\n            }\n        ]);\n        return view;\n    },\n\n    /** internal fn to add view (to both panel.views and panel.$list) */\n    _attachView : function( view ){\n        var panel = this;\n        // override to control where the view is added, how/whether it's rendered\n        panel.views.push( view );\n        panel.$list().append( view.render( 0 ).$el.hide() );\n        panel.trigger( 'view:attached', view );\n        view.$el.slideDown( panel.fxSpeed, function(){\n            panel.trigger( 'view:attached:rendered' );\n        });\n    },\n\n    /** Remove a view from the panel (if found) */\n    removeItemView : function( model, collection, options ){\n        this.log( this + '.removeItemView:', model );\n        var panel = this,\n            view = panel.viewFromModel( model );\n        if( !view ){ return undefined; }\n        panel.views = _.without( panel.views, view );\n        panel.trigger( 'view:removed', view );\n\n        // potentially show the empty message if no views left\n        // use anonymous queue here - since remove can happen multiple times\n        $({}).queue( 'fx', [\n            function( next ){ view.$el.fadeOut( panel.fxSpeed, next ); },\n            function( next ){\n                view.remove();\n                panel.trigger( 'view:removed:rendered' );\n                if( !panel.views.length ){\n                    panel._renderEmptyMessage().fadeIn( panel.fxSpeed, next );\n                } else {\n                    next();\n                }\n            }\n        ]);\n        return view;\n    },\n\n    /** get views based on model.id */\n    viewFromModelId : function( id ){\n        for( var i = 0; i < this.views.length; i++ ){\n            if( this.views[i].model.id === id ){\n                return this.views[i];\n            }\n        }\n        return undefined;\n    },\n\n    /** get views based on model */\n    viewFromModel : function( model ){\n        if( !model ){ return undefined; }\n        return this.viewFromModelId( model.id );\n    },\n\n    /** get views based on model properties */\n    viewsWhereModel : function( properties ){\n        return this.views.filter( function( view ){\n            //return view.model.matches( properties );\n//TODO: replace with _.matches (underscore 1.6.0)\n            var json = view.model.toJSON();\n            for( var key in properties ){\n                if( properties.hasOwnProperty( key ) ){\n                    if( json[ key ] !== properties[ key ] ){\n                        return false;\n                    }\n                }\n            }\n            return true;\n        });\n    },\n\n    /** A range of views between (and including) viewA and viewB */\n    viewRange : function( viewA, viewB ){\n        if( viewA === viewB ){ return ( viewA )?( [ viewA ] ):( [] ); }\n\n        var indexA = this.views.indexOf( viewA ),\n            indexB = this.views.indexOf( viewB );\n\n        // handle not found\n        if( indexA === -1 || indexB === -1 ){\n            if( indexA === indexB ){ return []; }\n            return ( indexA === -1 )?( [ viewB ] ):( [ viewA ] );\n        }\n        // reverse if indeces are\n        //note: end inclusive\n        return ( indexA < indexB )?\n            this.views.slice( indexA, indexB + 1 ) :\n            this.views.slice( indexB, indexA + 1 );\n    },\n\n    // ------------------------------------------------------------------------ searching\n    /** render a search input for filtering datasets shown\n     *      (see SearchableMixin in base-mvc for implementation of the actual searching)\n     *      return will start the search\n     *      esc will clear the search\n     *      clicking the clear button will clear the search\n     *      uses searchInput in ui.js\n     */\n    _renderSearch : function( $where ){\n        $where.find( '.controls .search-input' ).searchInput({\n            placeholder     : this.searchPlaceholder,\n            initialVal      : this.searchFor,\n            onfirstsearch   : _.bind( this._firstSearch, this ),\n            onsearch        : _.bind( this.searchItems, this ),\n            onclear         : _.bind( this.clearSearch, this )\n        });\n        return $where;\n    },\n\n    /** What to do on the first search entered */\n    _firstSearch : function( searchFor ){\n        // override to load model details if necc.\n        this.log( 'onFirstSearch', searchFor );\n        return this.searchItems( searchFor );\n    },\n\n    /** filter view list to those that contain the searchFor terms */\n    searchItems : function( searchFor ){\n        this.searchFor = searchFor;\n        this.trigger( 'search:searching', searchFor, this );\n        this.renderItems();\n        this.$( '> .controls .search-query' ).val( searchFor );\n        return this;\n    },\n\n    /** clear the search filters and show all views that are normally shown */\n    clearSearch : function( searchFor ){\n        //this.log( 'onSearchClear', this );\n        this.searchFor = '';\n        this.trigger( 'search:clear', this );\n        this.$( '> .controls .search-query' ).val( '' );\n        this.renderItems();\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ selection\n    /** @type Integer when the number of list item views is >= to this, don't animate selectors */\n    THROTTLE_SELECTORS_AT : 20,\n\n    /** show selectors on all visible itemViews and associated controls */\n    showSelectors : function( speed ){\n        speed = ( speed !== undefined )?( speed ):( this.fxSpeed );\n        this.selecting = true;\n        this.$( '.list-actions' ).slideDown( speed );\n        speed = this.views.length >= this.THROTTLE_SELECTORS_AT? 0 : speed;\n        _.each( this.views, function( view ){\n            view.showSelector( speed );\n        });\n        //this.selected = [];\n        //this.lastSelected = null;\n    },\n\n    /** hide selectors on all visible itemViews and associated controls */\n    hideSelectors : function( speed ){\n        speed = ( speed !== undefined )?( speed ):( this.fxSpeed );\n        this.selecting = false;\n        this.$( '.list-actions' ).slideUp( speed );\n        speed = this.views.length >= this.THROTTLE_SELECTORS_AT? 0 : speed;\n        _.each( this.views, function( view ){\n            view.hideSelector( speed );\n        });\n        this.selected = [];\n        this.lastSelected = null;\n    },\n\n    /** show or hide selectors on all visible itemViews and associated controls */\n    toggleSelectors : function(){\n        if( !this.selecting ){\n            this.showSelectors();\n        } else {\n            this.hideSelectors();\n        }\n    },\n\n    /** select all visible items */\n    selectAll : function( event ){\n        _.each( this.views, function( view ){\n            view.select( event );\n        });\n    },\n\n    /** deselect all visible items */\n    deselectAll : function( event ){\n        this.lastSelected = null;\n        _.each( this.views, function( view ){\n            view.deselect( event );\n        });\n    },\n\n    /** select a range of datasets between A and B */\n    selectRange : function( viewA, viewB ){\n        var range = this.viewRange( viewA, viewB );\n        _.each( range, function( view ){\n            view.select();\n        });\n        return range;\n    },\n\n    /** return an array of all currently selected itemViews */\n    getSelectedViews : function(){\n        return _.filter( this.views, function( v ){\n            return v.selected;\n        });\n    },\n\n    /** return a collection of the models of all currenly selected items */\n    getSelectedModels : function(){\n        return new this.collection.constructor( _.map( this.getSelectedViews(), function( view ){\n            return view.model;\n        }));\n    },\n\n    // ------------------------------------------------------------------------ loading indicator\n//TODO: questionable\n    /** hide the $el and display a loading indicator (in the $el's parent) when loading new data */\n    _showLoadingIndicator : function( msg, speed, callback ){\n        this.debug( '_showLoadingIndicator', this.indicator, msg, speed, callback );\n        speed = ( speed !== undefined )?( speed ):( this.fxSpeed );\n        if( !this.indicator ){\n            this.indicator = new LoadingIndicator( this.$el, this.$el.parent() );\n            this.debug( '\\t created', this.indicator );\n        }\n        if( !this.$el.is( ':visible' ) ){\n            this.indicator.show( 0, callback );\n        } else {\n            this.$el.fadeOut( speed );\n            this.indicator.show( msg, speed, callback );\n        }\n    },\n\n    /** hide the loading indicator */\n    _hideLoadingIndicator : function( speed, callback ){\n        this.debug( '_hideLoadingIndicator', this.indicator, speed, callback );\n        speed = ( speed !== undefined )?( speed ):( this.fxSpeed );\n        if( this.indicator ){\n            this.indicator.hide( speed, callback );\n        }\n    },\n\n    // ------------------------------------------------------------------------ scrolling\n    /** get the current scroll position of the panel in its parent */\n    scrollPosition : function(){\n        return this.$scrollContainer().scrollTop();\n    },\n\n    /** set the current scroll position of the panel in its parent */\n    scrollTo : function( pos, speed ){\n        speed = speed || 0;\n        this.$scrollContainer().animate({ scrollTop: pos }, speed );\n        return this;\n    },\n\n    /** Scrolls the panel to the top. */\n    scrollToTop : function( speed ){\n        return this.scrollTo( 0, speed );\n    },\n\n    /**  */\n    scrollToItem : function( view, speed ){\n        if( !view ){ return this; }\n        //var itemTop = view.$el.offset().top;\n        var itemTop = view.el.offsetTop;\n        return this.scrollTo( itemTop, speed );\n    },\n\n    /** Scrolls the panel to show the content with the given id. */\n    scrollToId : function( id, speed ){\n        return this.scrollToItem( this.viewFromModelId( id ), speed );\n    },\n\n    // ------------------------------------------------------------------------ panel events\n    /** event map */\n    events : {\n        'click .select-all'     : 'selectAll',\n        'click .deselect-all'   : 'deselectAll'\n    },\n\n    // ------------------------------------------------------------------------ misc\n    /** Return a string rep of the panel */\n    toString : function(){\n        return 'ListPanel(' + this.collection + ')';\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nListPanel.prototype.templates = (function(){\n//TODO: move to require text! plugin\n\n    var elTemplate = BASE_MVC.wrapTemplate([\n        // temp container\n        '<div>',\n            '<div class=\"controls\"></div>',\n            '<div class=\"list-items\"></div>',\n            '<div class=\"empty-message infomessagesmall\"></div>',\n        '</div>'\n    ]);\n\n    var controlsTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"controls\">',\n            '<div class=\"title\">',\n                '<div class=\"name\"><%- view.title %></div>',\n            '</div>',\n            '<div class=\"subtitle\"><%- view.subtitle %></div>',\n            // buttons, controls go here\n            '<div class=\"actions\"></div>',\n            // deleted msg, etc.\n            '<div class=\"messages\"></div>',\n\n            '<div class=\"search\">',\n                '<div class=\"search-input\"></div>',\n            '</div>',\n\n            // show when selectors are shown\n            '<div class=\"list-actions\">',\n                '<div class=\"btn-group\">',\n                    '<button class=\"select-all btn btn-default\"',\n                            'data-mode=\"select\">', _l( 'All' ), '</button>',\n                    '<button class=\"deselect-all btn btn-default\"',\n                            'data-mode=\"select\">', _l( 'None' ), '</button>',\n                '</div>',\n                '<div class=\"list-action-menu btn-group\">',\n                '</div>',\n            '</div>',\n        '</div>'\n    ]);\n\n    return {\n        el          : elTemplate,\n        controls    : controlsTemplate\n    };\n}());\n\n\n//=============================================================================\n/** View for a model that has a sub-collection (e.g. History, DatasetCollection)\n *  Allows:\n *      the model to be reset\n *      auto assign panel.collection to panel.model[ panel.modelCollectionKey ]\n *\n */\nvar ModelListPanel = ListPanel.extend({\n\n    /** key of attribute in model to assign to this.collection */\n    modelCollectionKey : 'contents',\n\n    initialize : function( attributes ){\n        ListPanel.prototype.initialize.call( this, attributes );\n        this.selecting = ( attributes.selecting !== undefined )? attributes.selecting : false;\n\n        this.setModel( this.model, attributes );\n    },\n\n    /** release/free/shutdown old models and set up panel for new models\n     *  @fires new-model with the panel as parameter\n     */\n    setModel : function( model, attributes ){\n        attributes = attributes || {};\n        this.debug( this + '.setModel:', model, attributes );\n\n        this.freeModel();\n        this.freeViews();\n\n        if( model ){\n            var oldModelId = this.model? this.model.get( 'id' ): null;\n\n            // set up the new model with user, logger, storage, events\n            this.model = model;\n            if( this.logger ){\n                this.model.logger = this.logger;\n            }\n            this._setUpModelListeners();\n\n//TODO: relation btwn model, collection becoming tangled here\n            // free the collection, and assign the new collection to either\n            //  the model[ modelCollectionKey ], attributes.collection, or an empty vanilla collection\n            this.collection.off();\n            this.collection = ( this.model[ this.modelCollectionKey ] )?\n                this.model[ this.modelCollectionKey ]:\n                ( attributes.collection || ( new this.collectionClass([]) ) );\n            this._setUpCollectionListeners();\n\n            if( oldModelId && model.get( 'id' ) !== oldModelId  ){\n                this.trigger( 'new-model', this );\n            }\n        }\n        return this;\n    },\n\n    /** free the current model and all listeners for it, free any views for the model */\n    freeModel : function(){\n        // stop/release the previous model, and clear cache to sub-views\n        if( this.model ){\n            this.stopListening( this.model );\n            //TODO: see base-mvc\n            //this.model.free();\n            //this.model = null;\n        }\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ listening\n    /** listening for model events */\n    _setUpModelListeners : function(){\n        // override\n        this.log( this + '._setUpModelListeners', this.model );\n        // bounce model errors up to the panel\n        this.listenTo( this.model, 'error', function(){\n            var args = Array.prototype.slice.call( arguments, 0 );\n            //args.unshift( 'model:error' );\n            args.unshift( 'error' );\n            this.trigger.apply( this, args );\n        }, this );\n        return this;\n    },\n\n    /** Build a temp div containing the new children for the view's $el.\n     */\n    _renderControls : function( $newRender ){\n        this.debug( this + '(ListPanel)._renderControls' );\n        var json = this.model? this.model.toJSON() : {},\n            $controls = $( this.templates.controls( json, this ) );\n        $newRender.find( '.controls' ).replaceWith( $controls );\n        return $controls;\n    },\n\n    // ------------------------------------------------------------------------ misc\n    /** Return a string rep of the panel */\n    toString : function(){\n        return 'ModelListPanel(' + this.model + ')';\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nModelListPanel.prototype.templates = (function(){\n//TODO: move to require text! plugin\n\n    var controlsTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"controls\">',\n            '<div class=\"title\">',\n//TODO: this is really the only difference - consider factoring titlebar out\n                '<div class=\"name\"><%- model.name %></div>',\n            '</div>',\n            '<div class=\"subtitle\"><%- view.subtitle %></div>',\n            '<div class=\"actions\"></div>',\n            '<div class=\"messages\"></div>',\n\n            '<div class=\"search\">',\n                '<div class=\"search-input\"></div>',\n            '</div>',\n\n            '<div class=\"list-actions\">',\n                '<div class=\"btn-group\">',\n                    '<button class=\"select-all btn btn-default\"',\n                            'data-mode=\"select\">', _l( 'All' ), '</button>',\n                    '<button class=\"deselect-all btn btn-default\"',\n                            'data-mode=\"select\">', _l( 'None' ), '</button>',\n                '</div>',\n                '<div class=\"list-action-menu btn-group\">',\n                '</div>',\n            '</div>',\n        '</div>'\n    ]);\n\n    return _.extend( _.clone( ListPanel.prototype.templates ), {\n        controls : controlsTemplate\n    });\n}());\n\n\n//=============================================================================\n    return {\n        ListPanel      : ListPanel,\n        ModelListPanel : ModelListPanel\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/list/list-view.js\n **/","define([\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( baseMVC, _l ){\n// =============================================================================\n/** A view on any model that has a 'tags' attribute (a list of tag strings)\n *      Incorporates the select2 jQuery plugin for tags display/editing:\n *      http://ivaynberg.github.io/select2/\n */\nvar TagsEditor = Backbone.View\n        .extend( baseMVC.LoggableMixin )\n        .extend( baseMVC.HiddenUntilActivatedViewMixin ).extend({\n\n    tagName     : 'div',\n    className   : 'tags-display',\n\n    /** Set up listeners, parse options */\n    initialize : function( options ){\n        //console.debug( this, options );\n        // only listen to the model only for changes to tags - re-render\n        this.listenTo( this.model, 'change:tags', function(){\n            this.render();\n        });\n        this.hiddenUntilActivated( options.$activator, options );\n    },\n\n    /** Build the DOM elements, call select to on the created input, and set up behaviors */\n    render : function(){\n        var view = this;\n        this.$el.html( this._template() );\n\n        this.$input().select2({\n            placeholder : 'Add tags',\n            width       : '100%',\n            tags : function(){\n                // initialize possible tags in the dropdown based on all the tags the user has used so far\n                return view._getTagsUsed();\n            }\n        });\n\n        this._setUpBehaviors();\n        return this;\n    },\n\n    /** @returns {String} the html text used to build the view's DOM */\n    _template : function(){\n        return [\n            //TODO: make prompt optional\n            '<label class=\"prompt\">', _l( 'Tags' ), '</label>',\n            // set up initial tags by adding as CSV to input vals (necc. to init select2)\n            '<input class=\"tags-input\" value=\"', this.tagsToCSV(), '\" />'\n        ].join( '' );\n    },\n\n    /** @returns {String} the sorted, comma-separated tags from the model */\n    tagsToCSV : function(){\n        var tagsArray = this.model.get( 'tags' );\n        if( !_.isArray( tagsArray ) || _.isEmpty( tagsArray ) ){\n            return '';\n        }\n        return tagsArray.map( function( tag ){\n            return _.escape( tag );\n        }).sort().join( ',' );\n    },\n\n    /** @returns {jQuery} the input for this view */\n    $input : function(){\n        return this.$el.find( 'input.tags-input' );\n    },\n\n    /** @returns {String[]} all tags used by the current user */\n    _getTagsUsed : function(){\n//TODO: global\n        return Galaxy.user.get( 'tags_used' );\n    },\n\n    /** set up any event listeners on the view's DOM (mostly handled by select2) */\n    _setUpBehaviors : function(){\n        var view = this;\n        this.$input().on( 'change', function( event ){\n            // save the model's tags in either remove or added event\n            view.model.save({ tags: event.val }, { silent: true });\n            // if it's new, add the tag to the users tags\n            if( event.added ){\n                //??: solve weird behavior in FF on test.galaxyproject.org where\n                //  event.added.text is string object: 'String{ 0=\"o\", 1=\"n\", 2=\"e\" }'\n                view._addNewTagToTagsUsed( event.added.text + '' );\n            }\n        });\n    },\n\n    /** add a new tag (if not already there) to the list of all tags used by the user\n     *  @param {String} newTag  the tag to add to the list of used\n     */\n    _addNewTagToTagsUsed : function( newTag ){\n//TODO: global\n        var tagsUsed = Galaxy.user.get( 'tags_used' );\n        if( !_.contains( tagsUsed, newTag ) ){\n            tagsUsed.push( newTag );\n            tagsUsed.sort();\n            Galaxy.user.set( 'tags_used', tagsUsed );\n        }\n    },\n\n    /** shut down event listeners and remove this view's DOM */\n    remove : function(){\n        this.$input.off();\n        this.stopListening( this.model );\n        Backbone.View.prototype.remove.call( this );\n    },\n\n    /** string rep */\n    toString : function(){ return [ 'TagsEditor(', this.model + '', ')' ].join(''); }\n});\n\n// =============================================================================\nreturn {\n    TagsEditor : TagsEditor\n};\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/tag.js\n **/","/** This renders the content of the ftp popup **/\ndefine(['utils/utils'], function(Utils) {\nreturn Backbone.View.extend({\n    // render\n    initialize: function(options) {\n        // link options\n        this.options = Utils.merge(options, {\n            class_add       : 'upload-icon-button fa fa-square-o',\n            class_remove    : 'upload-icon-button fa fa-check-square-o',\n            class_partial   : 'upload-icon-button fa fa-minus-square-o',\n            collection      : null,\n            onchange        : function() {},\n            onadd           : function() {},\n            onremove        : function() {}\n        });\n\n        // link this\n        var self = this;\n\n        // link app\n        this.collection = this.options.collection;\n\n        // set template\n        this.setElement(this._template());\n\n        // list of rows\n        this.rows = [];\n\n        // load extension\n        Utils.get({\n            url     : Galaxy.root + 'api/remote_files',\n            success : function(ftp_files) { self._fill(ftp_files); },\n            error   : function() { self._fill(); }\n        });\n    },\n\n    // fill table\n    _fill: function(ftp_files) {\n        if (ftp_files && ftp_files.length > 0) {\n            // add table\n            this.$el.find('#upload-ftp-content').html($(this._templateTable()));\n\n            // add files to table\n            var size = 0;\n            for (index in ftp_files) {\n                this.rows.push(this._add(ftp_files[index]));\n                size += ftp_files[index].size;\n            }\n\n            // update stats\n            this.$el.find('#upload-ftp-number').html(ftp_files.length + ' files');\n            this.$el.find('#upload-ftp-disk').html(Utils.bytesToString (size, true));\n\n            // add event handler to select/unselect all\n            if (this.collection) {\n                var self = this;\n                this.$('._has_collection').show();\n                this.$select_all = $('#upload-selectall');\n                this.$select_all.addClass(this.options.class_add);\n                this.$select_all.on('click', function() {\n                    var add = self.$select_all.hasClass(self.options.class_add);\n                    for (index in ftp_files) {\n                        var ftp_file = ftp_files[index];\n                        var model_index = self._find(ftp_file);\n                        if(!model_index && add || model_index && !add) {\n                            self.rows[index].trigger('click');\n                        }\n                    }\n                });\n                this._refresh();\n            }\n        } else {\n            this.$el.find('#upload-ftp-content').html($(this._templateInfo()));\n        }\n        this.$el.find('#upload-ftp-wait').hide();\n    },\n\n    // add\n    _add: function(ftp_file) {\n        // link this\n        var self = this;\n\n        // create new item\n        var $it = $(this._templateRow(ftp_file));\n\n        // identify icon\n        var $icon = $it.find('.icon');\n\n        // append to table\n        $(this.el).find('tbody').append($it);\n\n        // collection mode with add/remove triggers\n        if (this.collection) {\n            // find model and set initial 'add' icon class\n            var icon_class = '';\n            if (this._find(ftp_file)) {\n                icon_class = this.options.class_remove;\n            } else {\n                icon_class = this.options.class_add;\n            }\n            $icon.addClass(icon_class);\n\n            // click triggers add/remove events\n            $it.on('click', function() {\n                var model_index = self._find(ftp_file);\n                $icon.removeClass();\n                if (!model_index) {\n                    self.options.onadd(ftp_file);\n                    $icon.addClass(self.options.class_remove);\n                } else {\n                    self.options.onremove(model_index);\n                    $icon.addClass(self.options.class_add);\n                }\n                self._refresh();\n            });\n        } else {\n            // click triggers only change\n            $it.on('click', function() {\n                self.options.onchange(ftp_file);\n            });\n        }\n\n        // return dom handler\n        return $it;\n    },\n\n    // refresh\n    _refresh: function() {\n        var filtered = this.collection.where({file_mode: 'ftp', enabled: true});\n        this.$select_all.removeClass();\n        if (filtered.length == 0) {\n            this.$select_all.addClass(this.options.class_add);\n        } else {\n            if (filtered.length == this.rows.length) {\n                this.$select_all.addClass(this.options.class_remove);\n            } else {\n                this.$select_all.addClass(this.options.class_partial);\n            }\n        }\n    },\n\n    // get model index\n    _find: function(ftp_file) {\n        var item = this.collection.findWhere({\n            file_path   : ftp_file.path,\n            file_mode   : 'ftp',\n            enabled     : true\n        });\n        return item && item.get('id');\n    },\n\n    // template row\n    _templateRow: function(options) {\n        return  '<tr class=\"upload-ftp-row\">' +\n                    '<td class=\"_has_collection\" style=\"display: none;\"><div class=\"icon\"/></td>' +\n                    '<td class=\"ftp-name\">' + options.path + '</td>' +\n                    '<td class=\"ftp-size\">' + Utils.bytesToString(options.size) + '</td>' +\n                    '<td class=\"ftp-time\">' + options.ctime + '</td>' +\n                '</tr>';\n    },\n\n    // load table template\n    _templateTable: function() {\n        return  '<span style=\"whitespace: nowrap; float: left;\">Available files: </span>' +\n                '<span style=\"whitespace: nowrap; float: right;\">' +\n                    '<span class=\"upload-icon fa fa-file-text-o\"/>' +\n                    '<span id=\"upload-ftp-number\"/>&nbsp;&nbsp;' +\n                    '<span class=\"upload-icon fa fa-hdd-o\"/>' +\n                    '<span id=\"upload-ftp-disk\"/>' +\n                '</span>' +\n                '<table class=\"grid\" style=\"float: left;\">' +\n                    '<thead>' +\n                        '<tr>' +\n                            '<th class=\"_has_collection\" style=\"display: none;\"><div id=\"upload-selectall\"></th>' +\n                            '<th>Name</th>' +\n                            '<th>Size</th>' +\n                            '<th>Created</th>' +\n                        '</tr>' +\n                    '</thead>' +\n                    '<tbody/>' +\n                '</table>';\n    },\n\n    // load table template\n    _templateInfo: function() {\n        return  '<div class=\"upload-ftp-warning warningmessage\">' +\n                    'Your FTP directory does not contain any files.' +\n                '</div>';\n    },\n\n    // load html template\n    _template: function() {\n        return  '<div class=\"upload-ftp\">' +\n                    '<div id=\"upload-ftp-wait\" class=\"upload-ftp-wait fa fa-spinner fa-spin\"/>' +\n                    '<div class=\"upload-ftp-help\">This Galaxy server allows you to upload files via FTP. To upload some files, log in to the FTP server at <strong>' + this.options.ftp_upload_site + '</strong> using your Galaxy credentials (email address and password).</div>' +\n                    '<div id=\"upload-ftp-content\"/>' +\n                '<div>';\n    }\n});\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/upload/upload-ftp.js\n **/","/** This renders the content of the settings popup, allowing users to specify flags i.e. for space-to-tab conversion **/\ndefine( [ 'utils/utils' ], function( Utils ) {\nreturn Backbone.View.extend({\n    options: {\n        class_check     : 'fa-check-square-o',\n        class_uncheck   : 'fa-square-o',\n        parameters      : [{\n            id          : 'space_to_tab',\n            title       : 'Convert spaces to tabs',\n        },{\n            id          : 'to_posix_lines',\n            title       : 'Use POSIX standard'\n        }]\n    },\n\n    initialize: function( options ) {\n        var self = this;\n        this.model = options.model;\n        this.setElement( $( '<div/>' ).addClass( 'upload-settings' ) );\n        this.$el.append( $( '<div/>' ).addClass( 'upload-settings-cover' ) );\n        this.$el.append( $( '<table/>' ).addClass( 'upload-settings-table ui-table-striped' ).append( '<tbody/>' ) );\n        this.$cover = this.$( '.upload-settings-cover' );\n        this.$table = this.$( '.upload-settings-table > tbody' );\n        this.listenTo ( this.model, 'change', this.render, this );\n        this.model.trigger( 'change' );\n    },\n\n    render: function() {\n        var self = this;\n        this.$table.empty();\n        _.each( this.options.parameters, function( parameter ) {\n            var $checkbox = $( '<div/>' ).addClass( 'upload-' + parameter.id + ' upload-icon-button fa' )\n                                         .addClass( self.model.get( parameter.id ) && self.options.class_check || self.options.class_uncheck )\n                                         .on( 'click', function() {\n                                            self.model.get( 'enabled' ) && self.model.set( parameter.id, !self.model.get( parameter.id ) )\n                                         });\n            self.$table.append( $( '<tr/>' ).append( $( '<td/>' ).append( $checkbox ) )\n                                            .append( $( '<td/>' ).append( parameter.title ) ) )\n        });\n        this.$cover[ this.model.get( 'enabled' ) && 'hide' || 'show' ]();\n    }\n});\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/upload/upload-settings.js\n **/","(function (factory) {\n    if (typeof define === 'function' && define.amd) {\n        define([], factory);\n    } else {\n        // Browser globals\n        factory(jQuery);\n    }\n\n}(function () {\n//=============================================================================\n\n    jQuery.fn.extend({\n        hoverhighlight : function $hoverhighlight( scope, color ){\n            scope = scope || 'body';\n            if( !this.length ){ return this; }\n\n            $( this ).each( function(){\n                var $this = $( this ),\n                    targetSelector = $this.data( 'target' );\n\n                if( targetSelector ){\n                    $this.mouseover( function( ev ){\n                        $( targetSelector, scope ).css({\n                            background: color\n                        });\n                    })\n                    .mouseout( function( ev ){\n                        $( targetSelector ).css({\n                            background: ''\n                        });\n                    });\n                }\n            });\n            return this;\n        }\n    });\n}));\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/ui/hoverhighlight.js\n **/","// from: https://raw.githubusercontent.com/umdjs/umd/master/jqueryPlugin.js\n// Uses AMD or browser globals to create a jQuery plugin.\n(function (factory) {\n    if (typeof define === 'function' && define.amd) {\n        //TODO: So...this turns out to be an all or nothing thing. If I load jQuery in the define below, it will\n        //  (of course) wipe the old jquery *and all the plugins loaded into it*. So the define below *is still\n        //  relying on jquery being loaded globally* in order to preserve plugins.\n        define([], factory);\n    } else {\n        // Browser globals\n        factory(jQuery);\n    }\n\n}(function () {\n    var _l = window._l || function( s ){ return s; };\n\n    /** searchInput: (jQuery plugin)\n     *      Creates a search input, a clear button, and loading indicator\n     *      within the selected node.\n     *\n     *      When the user either presses return or enters some minimal number\n     *      of characters, a callback is called. Pressing ESC when the input\n     *      is focused will clear the input and call a separate callback.\n     */\n    function searchInput( parentNode, options ){\n//TODO: consolidate with tool menu functionality, use there\n        var KEYCODE_ESC     = 27,\n            KEYCODE_RETURN  = 13,\n            $parentNode     = $( parentNode ),\n            firstSearch     = true,\n            defaults = {\n                initialVal      : '',\n                name            : 'search',\n                placeholder     : 'search',\n                classes         : '',\n                onclear         : function(){},\n                onfirstsearch   : null,\n                onsearch        : function( inputVal ){},\n                minSearchLen    : 0,\n                escWillClear    : true,\n                oninit          : function(){}\n            };\n\n        // .................................................................... input rendering and events\n        // visually clear the search, trigger an event, and call the callback\n        function clearSearchInput( event ){\n            var $input = $( this ).parent().children( 'input' );\n            //console.debug( this, 'clear', $input );\n            $input.focus().val( '' ).trigger( 'clear:searchInput' );\n            options.onclear();\n        }\n\n        // search for searchTerms, trigger an event, call the appropo callback (based on whether this is the first)\n        function search( event, searchTerms ){\n            //console.debug( this, 'searching', searchTerms );\n            //TODO: I don't think this is classic jq custom event form? search.searchInput?\n            $( this ).trigger( 'search:searchInput', searchTerms );\n            if( typeof options.onfirstsearch === 'function' && firstSearch ){\n                firstSearch = false;\n                options.onfirstsearch( searchTerms );\n            } else {\n                options.onsearch( searchTerms );\n            }\n        }\n\n        // .................................................................... input rendering and events\n        function inputTemplate(){\n            // class search-query is bootstrap 2.3 style that now lives in base.less\n            return [ '<input type=\"text\" name=\"', options.name, '\" placeholder=\"', options.placeholder, '\" ',\n                            'class=\"search-query ', options.classes, '\" ', '/>' ].join( '' );\n        }\n\n        // the search input that responds to keyboard events and displays the search value\n        function $input(){\n            return $( inputTemplate() )\n                // select all text on a focus\n                .focus( function( event ){\n                    $( this ).select();\n                })\n                // attach behaviors to esc, return if desired, search on some min len string\n                .keyup( function( event ){\n                    event.preventDefault();\n                    event.stopPropagation();\n//TODO: doesn't work\n                    if( !$( this ).val() ){ $( this ).blur(); }\n\n                    // esc key will clear if desired\n                    if( event.which === KEYCODE_ESC && options.escWillClear ){\n                        clearSearchInput.call( this, event );\n\n                    } else {\n                        var searchTerms = $( this ).val();\n                        // return key or the search string len > minSearchLen (if not 0) triggers search\n                        if( ( event.which === KEYCODE_RETURN )\n                        ||  ( options.minSearchLen && searchTerms.length >= options.minSearchLen ) ){\n                            search.call( this, event, searchTerms );\n                        } else if( !searchTerms.length ){\n                            clearSearchInput.call( this, event );\n                        }\n                    }\n                })\n                .on( 'change', function( event ){\n                    search.call( this, event, $( this ).val() );\n                })\n                .val( options.initialVal );\n        }\n\n        // .................................................................... clear button rendering and events\n        // a button for clearing the search bar, placed on the right hand side\n        function $clearBtn(){\n            return $([ '<span class=\"search-clear fa fa-times-circle\" ',\n                             'title=\"', _l( 'clear search (esc)' ), '\"></span>' ].join('') )\n            .tooltip({ placement: 'bottom' })\n            .click( function( event ){\n                clearSearchInput.call( this, event );\n            });\n        }\n\n        // .................................................................... loadingIndicator rendering\n        // a button for clearing the search bar, placed on the right hand side\n        function $loadingIndicator(){\n            return $([ '<span class=\"search-loading fa fa-spinner fa-spin\" ',\n                             'title=\"', _l( 'loading...' ), '\"></span>' ].join('') )\n                .hide().tooltip({ placement: 'bottom' });\n        }\n\n        // .................................................................... commands\n        // visually swap the load, clear buttons\n        function toggleLoadingIndicator(){\n            $parentNode.find( '.search-loading' ).toggle();\n            $parentNode.find( '.search-clear' ).toggle();\n        }\n\n        // .................................................................... init\n        // string command (not constructor)\n        if( jQuery.type( options ) === 'string' ){\n            if( options === 'toggle-loading' ){\n                toggleLoadingIndicator();\n            }\n            return $parentNode;\n        }\n\n        // initial render\n        if( jQuery.type( options ) === 'object' ){\n            options = jQuery.extend( true, {}, defaults, options );\n        }\n        //NOTE: prepended\n        return $parentNode.addClass( 'search-input' ).prepend([ $input(), $clearBtn(), $loadingIndicator() ]);\n    }\n\n    // as jq plugin\n    jQuery.fn.extend({\n        searchInput : function $searchInput( options ){\n            return this.each( function(){\n                return searchInput( this, options );\n            });\n        }\n    });\n}));\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/ui/search-input.js\n **/","define([], function(){\n// Alphanumeric/natural sort fn\nfunction naturalSort(a, b) {\n    // setup temp-scope variables for comparison evauluation\n    var re = /(-?[0-9\\.]+)/g,\n        x = a.toString().toLowerCase() || '',\n        y = b.toString().toLowerCase() || '',\n        nC = String.fromCharCode(0),\n        xN = x.replace( re, nC + '$1' + nC ).split(nC),\n        yN = y.replace( re, nC + '$1' + nC ).split(nC),\n        xD = (new Date(x)).getTime(),\n        yD = xD ? (new Date(y)).getTime() : null;\n    // natural sorting of dates\n    if ( yD ) {\n        if ( xD < yD ) { return -1; }\n        else if ( xD > yD ) { return 1; }\n    }\n    // natural sorting through split numeric strings and default strings\n    var oFxNcL, oFyNcL;\n    for ( var cLoc = 0, numS = Math.max(xN.length, yN.length); cLoc < numS; cLoc++ ) {\n        oFxNcL = parseFloat(xN[cLoc]) || xN[cLoc];\n        oFyNcL = parseFloat(yN[cLoc]) || yN[cLoc];\n        if (oFxNcL < oFyNcL) { return -1; }\n        else if (oFxNcL > oFyNcL) { return 1; }\n    }\n    return 0;\n}\n\nreturn naturalSort;\n})\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/utils/natural-sort.js\n **/","/*\n    galaxy upload plugins - requires FormData and XMLHttpRequest\n*/\n;(function($){\n    // add event properties\n    jQuery.event.props.push(\"dataTransfer\");\n\n    /**\n        Posts file data to the API\n    */\n    $.uploadpost = function (config) {\n        // parse options\n        var cnf = $.extend({}, {\n            data            : {},\n            success         : function() {},\n            error           : function() {},\n            progress        : function() {},\n            url             : null,\n            maxfilesize     : 2048,\n            error_filesize  : 'File exceeds 2GB. Please use a FTP client.',\n            error_default   : 'Please make sure the file is available.',\n            error_server    : 'Upload request failed.',\n            error_login     : 'Uploads require you to log in.'\n        }, config);\n\n        // link data\n        var data = cnf.data;\n\n        // check errors\n        if (data.error_message) {\n            cnf.error(data.error_message);\n            return;\n        }\n\n        // construct form data\n        var form = new FormData();\n        for (var key in data.payload) {\n            form.append(key, data.payload[key]);\n        }\n\n        // add files to submission\n        var sizes = 0;\n        for (var key in data.files) {\n            var d = data.files[key];\n            form.append(d.name, d.file, d.file.name);\n            sizes += d.file.size;\n        }\n\n        // check file size, unless it's an ftp file\n        if (sizes > 1048576 * cnf.maxfilesize) {\n            cnf.error(cnf.error_filesize);\n            return;\n        }\n\n        // prepare request\n        xhr = new XMLHttpRequest();\n        xhr.open('POST', cnf.url, true);\n        xhr.setRequestHeader('Accept', 'application/json');\n        xhr.setRequestHeader('Cache-Control', 'no-cache');\n        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n\n        // captures state changes\n        xhr.onreadystatechange = function() {\n            // check for request completed, server connection closed\n            if (xhr.readyState == xhr.DONE) {\n                // parse response\n                var response = null;\n                if (xhr.responseText) {\n                    try {\n                        response = jQuery.parseJSON(xhr.responseText);\n                    } catch (e) {\n                        response = xhr.responseText;\n                    }\n                }\n                // pass any error to the error option\n                if (xhr.status < 200 || xhr.status > 299) {\n                    var text = xhr.statusText;\n                    if (xhr.status == 403) {\n                        text = cnf.error_login;\n                    } else if (xhr.status == 0) {\n                        text = cnf.error_server;\n                    } else if (!text) {\n                        text = cnf.error_default;\n                    }\n                    cnf.error(text + ' (' + xhr.status + ')');\n                } else {\n                    cnf.success(response);\n                }\n            }\n        }\n\n        // prepare upload progress\n        xhr.upload.addEventListener('progress', function(e) {\n            if (e.lengthComputable) {\n                cnf.progress(Math.round((e.loaded * 100) / e.total));\n            }\n        }, false);\n\n        // send request\n        Galaxy.emit.debug('uploadbox::uploadpost()', 'Posting following data.', cnf);\n        xhr.send(form);\n    }\n\n    /**\n        Handles the upload events drag/drop etc.\n    */\n    $.fn.uploadinput = function(options) {\n        // initialize\n        var el = this;\n        var opts = $.extend({}, {\n            ondragover  : function() {},\n            ondragleave : function() {},\n            onchange    : function() {},\n            multiple    : false\n        }, options);\n\n        // append hidden upload field\n        var $input = $('<input type=\"file\" style=\"display: none\" ' + (opts.multiple && 'multiple' || '') + '/>');\n        el.append($input.change(function (e) {\n            opts.onchange(e.target.files);\n            $(this).val('');\n        }));\n\n        // drag/drop events\n        el.on('drop', function (e) {\n            opts.ondragleave(e);\n            if(e.dataTransfer) {\n                opts.onchange(e.dataTransfer.files);\n                e.preventDefault();\n            }\n        });\n        el.on('dragover',  function (e) {\n            e.preventDefault();\n            opts.ondragover(e);\n        });\n        el.on('dragleave', function (e) {\n            e.stopPropagation();\n            opts.ondragleave(e);\n        });\n\n        // exports\n        return {\n            dialog: function () {\n                $input.trigger('click');\n            }\n        }\n    }\n\n    /**\n        Handles the upload queue and events such as drag/drop etc.\n    */\n    $.fn.uploadbox = function(options) {\n        // parse options\n        var opts = $.extend({}, {\n            dragover        : function() {},\n            dragleave       : function() {},\n            announce        : function(d) {},\n            initialize      : function(d) {},\n            progress        : function(d, m) {},\n            success         : function(d, m) {},\n            error           : function(d, m) { alert(m); },\n            complete        : function() {}\n        }, options);\n\n        // file queue\n        var queue = {};\n\n        // queue index/length counter\n        var queue_index = 0;\n        var queue_length = 0;\n\n        // indicates if queue is currently running\n        var queue_running = false;\n        var queue_stop = false;\n\n        // element\n        var uploadinput = $(this).uploadinput({\n            multiple    : true,\n            onchange    : function(files) { add(files); },\n            ondragover  : options.ondragover,\n            ondragleave : options.ondragleave\n        });\n\n        // add new files to upload queue\n        function add(files) {\n            if (files && files.length && !queue_running) {\n                var current_index = queue_index;\n                _.each(files, function(file, key) {\n                    if (file.mode !== 'new' && _.filter(queue, function(f) {\n                        return f.name === file.name && f.size === file.size;\n                    }).length) {\n                        file.duplicate = true;\n                    }\n                });\n                _.each(files, function(file) {\n                    if (!file.duplicate) {\n                        var index = String(queue_index++);\n                        queue[index] = file;\n                        opts.announce(index, queue[index]);\n                        queue_length++;\n                    }\n                });\n                return current_index;\n            }\n        }\n\n        // remove file from queue\n        function remove(index) {\n            if (queue[index]) {\n                delete queue[index];\n                queue_length--;\n            }\n        }\n\n        // process an upload, recursive\n        function process() {\n            // validate\n            if (queue_length == 0 || queue_stop) {\n                queue_stop = false;\n                queue_running = false;\n                opts.complete();\n                return;\n            } else {\n                queue_running = true;\n            }\n\n            // get an identifier from the queue\n            var index = -1;\n            for (var key in queue) {\n                index = key;\n                break;\n            }\n\n            // get current file from queue\n            var file = queue[index];\n\n            // remove from queue\n            remove(index)\n\n            // create and submit data\n            $.uploadpost({\n                url      : opts.url,\n                data     : opts.initialize(index),\n                success  : function(message) { opts.success(index, message); process();},\n                error    : function(message) { opts.error(index, message); process();},\n                progress : function(percentage) { opts.progress(index, percentage); }\n            });\n        }\n\n        /*\n            public interface\n        */\n\n        // open file browser for selection\n        function select() {\n            uploadinput.dialog();\n        }\n\n        // remove all entries from queue\n        function reset(index) {\n            for (index in queue) {\n                remove(index);\n            }\n        }\n\n        // initiate upload process\n        function start() {\n            if (!queue_running) {\n                queue_running = true;\n                process();\n            }\n        }\n\n        // stop upload process\n        function stop() {\n            queue_stop = true;\n        }\n\n        // set options\n        function configure(options) {\n            opts = $.extend({}, opts, options);\n            return opts;\n        }\n\n        // verify browser compatibility\n        function compatible() {\n            return window.File && window.FormData && window.XMLHttpRequest && window.FileList;\n        }\n\n        // export functions\n        return {\n            'select'        : select,\n            'add'           : add,\n            'remove'        : remove,\n            'start'         : start,\n            'stop'          : stop,\n            'reset'         : reset,\n            'configure'     : configure,\n            'compatible'    : compatible\n        };\n    }\n})(jQuery);\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/utils/uploadbox.js\n **/","var RightPanel = require( 'layout/panel' ).RightPanel,\n    Ui = require( 'mvc/ui/ui-misc' ),\n    historyOptionsMenu = require( 'mvc/history/options-menu' ),\n    CurrentHistoryView = require( 'mvc/history/history-view-edit-current' ).CurrentHistoryView,\n    _l = require( 'utils/localization' );\n\n/** the right hand panel in the analysis page that shows the current history */\nvar HistoryPanel = RightPanel.extend({\n\n    title : _l( 'History' ),\n\n    initialize : function( options ){\n        RightPanel.prototype.initialize.call( this, options );\n        var self = this;\n\n        // this button re-fetches the history and contents and re-renders the history panel\n        this.refreshButton = new Ui.ButtonLink({\n            id      : 'history-refresh-button',\n            title   : _l( 'Refresh history' ),\n            cls     : 'panel-header-button',\n            icon    : 'fa fa-refresh',\n            onclick : function() {\n                self.historyView.loadCurrentHistory();\n            }\n        });\n        // opens a drop down menu with history related functions (like view all, delete, share, etc.)\n        this.optionsButton = new Ui.ButtonLink({\n            id      : 'history-options-button',\n            title   : _l( 'History options' ),\n            cls     : 'panel-header-button',\n            icon    : 'fa fa-cog',\n        });\n        // goes to a page showing all the users histories in panel form (for logged in users)\n        this.viewMultiButton = null;\n        if( !options.userIsAnonymous ){\n            this.viewMultiButton = new Ui.ButtonLink({\n                id      : 'history-view-multi-button',\n                title   : _l( 'View all histories' ),\n                cls     : 'panel-header-button',\n                icon    : 'fa fa-columns',\n                href    : options.galaxyRoot + 'history/view_multiple'\n            });\n        }\n\n        // build history options menu\n        this.optionsMenu = historyOptionsMenu( this.optionsButton.$el, {\n            anonymous    : options.userIsAnonymous,\n            purgeAllowed : options.allow_user_dataset_purge,\n            root         : options.galaxyRoot\n        });\n\n        // view of the current history\n        this.historyView = new CurrentHistoryView({\n            purgeAllowed    : options.allow_user_dataset_purge,\n            linkTarget      : 'galaxy_main',\n            $scrollContainer: function(){ return this.$el.parent(); }\n        });\n    },\n\n    render : function(){\n        RightPanel.prototype.render.call( this );\n        this.$( '.unified-panel-header' ).addClass( 'history-panel-header' );\n        this.$( '.panel-header-buttons' ).append([\n            this.refreshButton.$el,\n            this.optionsButton.$el,\n            this.viewMultiButton? this.viewMultiButton.$el : null,\n        ]);\n        this.historyView\n            .setElement( this.$( '.history-panel' ) );\n            // causes blink/flash due to loadCurrentHistory rendering as well\n            // .render();\n    },\n\n    _templateBody : function( data ){\n        return [\n            '<div class=\"unified-panel-body unified-panel-body-background\">',\n                '<div id=\"current-history-panel\" class=\"history-panel\"/>',\n            '</div>'\n        ].join('');\n    },\n\n    toString : function(){ return 'HistoryPanel'; }\n});\n\nmodule.exports = HistoryPanel;\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/apps/history-panel.js\n **/","var LeftPanel = require( 'layout/panel' ).LeftPanel,\n    Tools = require( 'mvc/tool/tools' ),\n    Upload = require( 'mvc/upload/upload-view' ),\n    _l = require( 'utils/localization' );\n\n/* Builds the tool menu panel on the left of the analysis page */\nvar ToolPanel = LeftPanel.extend({\n\n    title : _l( 'Tools' ),\n\n    initialize: function( options ){\n        LeftPanel.prototype.initialize.call( this, options );\n        this.log( this + '.initialize:', options );\n\n        /** @type {Object[]} descriptions of user's workflows to be shown in the tool menu */\n        this.stored_workflow_menu_entries = options.stored_workflow_menu_entries || [];\n\n        // create tool search, tool panel, and tool panel view.\n        var tool_search = new Tools.ToolSearch({\n            search_url  : options.search_url,\n            hidden      : false\n        });\n        var tools = new Tools.ToolCollection( options.toolbox );\n        this.tool_panel = new Tools.ToolPanel({\n            tool_search : tool_search,\n            tools       : tools,\n            layout      : options.toolbox_in_panel\n        });\n        this.tool_panel_view = new Tools.ToolPanelView({ model: this.tool_panel });\n\n        // add upload modal\n        this.uploadButton = new Upload({\n            nginx_upload_path   : options.nginx_upload_path,\n            ftp_upload_site     : options.ftp_upload_site,\n            default_genome      : options.default_genome,\n            default_extension   : options.default_extension,\n        });\n    },\n\n    render : function(){\n        var self = this;\n        LeftPanel.prototype.render.call( self );\n        self.$( '.panel-header-buttons' ).append( self.uploadButton.$el );\n\n        // if there are tools, render panel and display everything\n        if (self.tool_panel.get( 'layout' ).size() > 0) {\n            self.tool_panel_view.render();\n            //TODO: why the hide/show?\n            self.$( '.toolMenu' ).show();\n        }\n        self.$( '.toolMenuContainer' ).prepend( self.tool_panel_view.$el );\n\n        self._renderWorkflowMenu();\n\n        // if a tool link has the minsizehint attribute, handle it here (gen. by hiding the tool panel)\n        self.$( 'a[minsizehint]' ).click( function() {\n            if ( parent.handle_minwidth_hint ) {\n                parent.handle_minwidth_hint( $( self ).attr( 'minsizehint' ) );\n            }\n        });\n    },\n\n    /** build the dom for the workflow portion of the tool menu */\n    _renderWorkflowMenu : function(){\n        var self = this;\n        // add internal workflow list\n        self.$( '#internal-workflows' ).append( self._templateTool({\n            title   : _l( 'All workflows' ),\n            href    : 'workflow/list_for_run'\n        }));\n        _.each( self.stored_workflow_menu_entries, function( menu_entry ){\n            self.$( '#internal-workflows' ).append( self._templateTool({\n                title : menu_entry.stored_workflow.name,\n                href  : 'workflow/run?id=' + menu_entry.encoded_stored_workflow_id\n            }));\n        });\n    },\n\n    /** build a link to one tool */\n    _templateTool: function( tool ) {\n        return [\n            '<div class=\"toolTitle\">',\n                // global\n                '<a href=\"', Galaxy.root, tool.href, '\" target=\"galaxy_main\">', tool.title, '</a>',\n            '</div>'\n        ].join('');\n    },\n\n    /** override to include inital menu dom and workflow section */\n    _templateBody : function(){\n        return [\n            '<div class=\"unified-panel-body unified-panel-body-background\">',\n                '<div class=\"toolMenuContainer\">',\n                    '<div class=\"toolMenu\" style=\"display: none\">',\n                        '<div id=\"search-no-results\" style=\"display: none; padding-top: 5px\">',\n                            '<em><strong>', _l( 'Search did not match any tools.' ), '</strong></em>',\n                        '</div>',\n                    '</div>',\n                    '<div class=\"toolSectionPad\"/>',\n                    '<div class=\"toolSectionPad\"/>',\n                    '<div class=\"toolSectionTitle\" id=\"title_XXinternalXXworkflow\">',\n                        '<span>', _l( 'Workflows' ), '</span>',\n                    '</div>',\n                    '<div id=\"internal-workflows\" class=\"toolSectionBody\">',\n                        '<div class=\"toolSectionBg\"/>',\n                    '</div>',\n                '</div>',\n            '</div>'\n        ].join('');\n    },\n\n    toString : function(){ return 'ToolPanel'; }\n});\n\nmodule.exports = ToolPanel;\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/apps/tool-panel.js\n **/","define([\n    \"mvc/collection/collection-li\",\n    \"mvc/dataset/dataset-li-edit\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( DC_LI, DATASET_LI_EDIT, BASE_MVC, _l ){\n\n'use strict';\n//==============================================================================\nvar DCListItemView = DC_LI.DCListItemView;\n/** @class Edit view for DatasetCollection.\n */\nvar DCListItemEdit = DCListItemView.extend(\n/** @lends DCListItemEdit.prototype */{\n//TODO: may not be needed\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** override to add linkTarget */\n    initialize : function( attributes ){\n        DCListItemView.prototype.initialize.call( this, attributes );\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'DCListItemEdit(' + modelString + ')';\n    }\n});\n\n\n//==============================================================================\nvar DCEListItemView = DC_LI.DCEListItemView;\n/** @class Read only view for DatasetCollectionElement.\n */\nvar DCEListItemEdit = DCEListItemView.extend(\n/** @lends DCEListItemEdit.prototype */{\n//TODO: this might be expendable - compacted with HDAListItemView\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** set up */\n    initialize  : function( attributes ){\n        DCEListItemView.prototype.initialize.call( this, attributes );\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'DCEListItemEdit(' + modelString + ')';\n    }\n});\n\n\n//==============================================================================\n// NOTE: this does not inherit from DatasetDCEListItemView as you would expect\n//TODO: but should - if we can find something simpler than using diamond\n/** @class Editable view for a DatasetCollectionElement that is also an DatasetAssociation\n *      (a dataset contained in a dataset collection).\n */\nvar DatasetDCEListItemEdit = DATASET_LI_EDIT.DatasetListItemEdit.extend(\n/** @lends DatasetDCEListItemEdit.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** set up */\n    initialize  : function( attributes ){\n        DATASET_LI_EDIT.DatasetListItemEdit.prototype.initialize.call( this, attributes );\n    },\n\n    // NOTE: this does not inherit from DatasetDCEListItemView - so we duplicate this here\n    //TODO: fix\n    /** In this override, only get details if in the ready state.\n     *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n     */\n    _fetchModelDetails : function(){\n        var view = this;\n        if( view.model.inReadyState() && !view.model.hasDetails() ){\n            return view.model.fetch({ silent: true });\n        }\n        return jQuery.when();\n    },\n\n    /** Override to remove delete button */\n    _renderDeleteButton : function(){\n        return null;\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'DatasetDCEListItemEdit(' + modelString + ')';\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDatasetDCEListItemEdit.prototype.templates = (function(){\n\n    return _.extend( {}, DATASET_LI_EDIT.DatasetListItemEdit.prototype.templates, {\n        titleBar : DC_LI.DatasetDCEListItemView.prototype.templates.titleBar\n    });\n}());\n\n\n//==============================================================================\n/** @class Read only view for a DatasetCollectionElement that is also a DatasetCollection\n *      (a nested DC).\n */\nvar NestedDCDCEListItemEdit = DC_LI.NestedDCDCEListItemView.extend(\n/** @lends NestedDCDCEListItemEdit.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    // comment this out to suppress log output\n    //logger              : console,\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'NestedDCDCEListItemEdit(' + modelString + ')';\n    }\n});\n\n\n//==============================================================================\n    return {\n        DCListItemEdit          : DCListItemEdit,\n        DCEListItemEdit         : DCEListItemEdit,\n        DatasetDCEListItemEdit  : DatasetDCEListItemEdit,\n        NestedDCDCEListItemEdit : NestedDCDCEListItemEdit\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/collection/collection-li-edit.js\n **/","define([\n    \"mvc/collection/collection-view\",\n    \"mvc/collection/collection-model\",\n    \"mvc/collection/collection-li-edit\",\n    \"mvc/base-mvc\",\n    \"utils/localization\",\n    \"ui/editable-text\",\n], function( DC_VIEW, DC_MODEL, DC_EDIT, BASE_MVC, _l ){\n\n'use strict';\n/* =============================================================================\nTODO:\n\n============================================================================= */\n/** @class editable View/Controller for a dataset collection.\n */\nvar _super = DC_VIEW.CollectionView;\nvar CollectionViewEdit = _super.extend(\n/** @lends CollectionView.prototype */{\n    //MODEL is either a DatasetCollection (or subclass) or a DatasetCollectionElement (list of pairs)\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** sub view class used for datasets */\n    DatasetDCEViewClass : DC_EDIT.DatasetDCEListItemEdit,\n    /** sub view class used for nested collections */\n    NestedDCDCEViewClass: DC_EDIT.NestedDCDCEListItemEdit,\n\n    // ......................................................................... SET UP\n    /** Set up the view, set up storage, bind listeners to HistoryContents events\n     *  @param {Object} attributes optional settings for the panel\n     */\n    initialize : function( attributes ){\n        _super.prototype.initialize.call( this, attributes );\n    },\n\n    /** In this override, make the collection name editable\n     */\n    _setUpBehaviors : function( $where ){\n        $where = $where || this.$el;\n        _super.prototype._setUpBehaviors.call( this, $where );\n        if( !this.model ){ return; }\n\n        // anon users shouldn't have access to any of the following\n        if( !Galaxy.user || Galaxy.user.isAnonymous() ){\n            return;\n        }\n\n        //TODO: extract\n        var panel = this,\n            nameSelector = '> .controls .name';\n        $where.find( nameSelector )\n            .attr( 'title', _l( 'Click to rename collection' ) )\n            .tooltip({ placement: 'bottom' })\n            .make_text_editable({\n                on_finish: function( newName ){\n                    var previousName = panel.model.get( 'name' );\n                    if( newName && newName !== previousName ){\n                        panel.$el.find( nameSelector ).text( newName );\n                        panel.model.save({ name: newName })\n                            .fail( function(){\n                                panel.$el.find( nameSelector ).text( panel.model.previous( 'name' ) );\n                            });\n                    } else {\n                        panel.$el.find( nameSelector ).text( previousName );\n                    }\n                }\n            });\n    },\n\n    // ........................................................................ misc\n    /** string rep */\n    toString    : function(){\n        return 'CollectionViewEdit(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n// =============================================================================\n/** @class non-editable, read-only View/Controller for a dataset collection. */\nvar ListCollectionViewEdit = CollectionViewEdit.extend(\n/** @lends ListCollectionView.prototype */{\n\n    //TODO: not strictly needed - due to switch in CollectionView._getContentClass\n    /** sub view class used for datasets */\n    DatasetDCEViewClass : DC_EDIT.DatasetDCEListItemEdit,\n\n    // ........................................................................ misc\n    /** string rep */\n    toString    : function(){\n        return 'ListCollectionViewEdit(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n// =============================================================================\n/** @class Editable, read-only View/Controller for a dataset collection. */\nvar PairCollectionViewEdit = ListCollectionViewEdit.extend(\n/** @lends PairCollectionViewEdit.prototype */{\n\n    // ........................................................................ misc\n    /** string rep */\n    toString    : function(){\n        return 'PairCollectionViewEdit(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n// =============================================================================\n/** @class Editable (roughly since these collections are immutable),\n *  View/Controller for a dataset collection.\n */\nvar NestedPairCollectionViewEdit = PairCollectionViewEdit.extend(\n/** @lends NestedPairCollectionViewEdit.prototype */{\n\n    /** Override to remove the editable text from the name/identifier - these collections are considered immutable */\n    _setUpBehaviors : function( $where ){\n        _super.prototype._setUpBehaviors.call( this, $where );\n    },\n\n    // ........................................................................ misc\n    /** string rep */\n    toString    : function(){\n        return 'NestedPairCollectionViewEdit(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n// =============================================================================\n/** @class non-editable, read-only View/Controller for a dataset collection. */\nvar ListOfPairsCollectionViewEdit = CollectionViewEdit.extend(\n/** @lends ListOfPairsCollectionView.prototype */{\n\n    //TODO: not strictly needed - due to switch in CollectionView._getContentClass\n    /** sub view class used for nested collections */\n    NestedDCDCEViewClass : DC_EDIT.NestedDCDCEListItemEdit.extend({\n        foldoutPanelClass : NestedPairCollectionViewEdit\n    }),\n\n    // ........................................................................ misc\n    /** string rep */\n    toString    : function(){\n        return 'ListOfPairsCollectionViewEdit(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n//==============================================================================\n    return {\n        CollectionViewEdit              : CollectionViewEdit,\n        ListCollectionViewEdit          : ListCollectionViewEdit,\n        PairCollectionViewEdit          : PairCollectionViewEdit,\n        ListOfPairsCollectionViewEdit   : ListOfPairsCollectionViewEdit\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/collection/collection-view-edit.js\n **/","define([\n    \"utils/levenshtein\",\n    \"utils/natural-sort\",\n    \"mvc/collection/list-collection-creator\",\n    \"mvc/base-mvc\",\n    \"utils/localization\",\n    \"ui/hoverhighlight\"\n], function( levenshteinDistance, naturalSort, LIST_COLLECTION_CREATOR, baseMVC, _l ){\n\n'use strict';\n\nvar logNamespace = 'collections';\n/* ============================================================================\nTODO:\n\n\nPROGRAMMATICALLY:\ncurrPanel.once( 'rendered', function(){\n    currPanel.showSelectors();\n    currPanel.selectAll();\n    _.last( currPanel.actionsPopup.options ).func();\n});\n\n============================================================================ */\n/** A view for paired datasets in the collections creator.\n */\nvar PairView = Backbone.View.extend( baseMVC.LoggableMixin ).extend({\n    _logNamespace : logNamespace,\n\n    tagName     : 'li',\n    className   : 'dataset paired',\n\n    initialize : function( attributes ){\n        this.pair = attributes.pair || {};\n    },\n\n    template : _.template([\n        '<span class=\"forward-dataset-name flex-column\"><%- pair.forward.name %></span>',\n        '<span class=\"pair-name-column flex-column\">',\n            '<span class=\"pair-name\"><%- pair.name %></span>',\n        '</span>',\n        '<span class=\"reverse-dataset-name flex-column\"><%- pair.reverse.name %></span>'\n    ].join('')),\n\n    render : function(){\n        this.$el\n            .attr( 'draggable', true )\n            .data( 'pair', this.pair )\n            .html( this.template({ pair: this.pair }) )\n            .addClass( 'flex-column-container' );\n        return this;\n    },\n\n    events : {\n        'dragstart'         : '_dragstart',\n        'dragend'           : '_dragend',\n        'dragover'          : '_sendToParent',\n        'drop'              : '_sendToParent'\n    },\n\n    /** dragging pairs for re-ordering */\n    _dragstart : function( ev ){\n        ev.currentTarget.style.opacity = '0.4';\n        if( ev.originalEvent ){ ev = ev.originalEvent; }\n\n        ev.dataTransfer.effectAllowed = 'move';\n        ev.dataTransfer.setData( 'text/plain', JSON.stringify( this.pair ) );\n\n        this.$el.parent().trigger( 'pair.dragstart', [ this ] );\n    },\n\n    /** dragging pairs for re-ordering */\n    _dragend : function( ev ){\n        ev.currentTarget.style.opacity = '1.0';\n        this.$el.parent().trigger( 'pair.dragend', [ this ] );\n    },\n\n    /** manually bubble up an event to the parent/container */\n    _sendToParent : function( ev ){\n        this.$el.parent().trigger( ev );\n    },\n\n    /** string rep */\n    toString : function(){\n        return 'PairView(' + this.pair.name + ')';\n    }\n});\n\n\n// ============================================================================\n/** returns an autopair function that uses the provided options.match function */\nfunction autoPairFnBuilder( options ){\n    options = options || {};\n    options.createPair = options.createPair || function _defaultCreatePair( params ){\n        params = params || {};\n        var a = params.listA.splice( params.indexA, 1 )[0],\n            b = params.listB.splice( params.indexB, 1 )[0],\n            aInBIndex = params.listB.indexOf( a ),\n            bInAIndex = params.listA.indexOf( b );\n        if( aInBIndex !== -1 ){ params.listB.splice( aInBIndex, 1 ); }\n        if( bInAIndex !== -1 ){ params.listA.splice( bInAIndex, 1 ); }\n        return this._pair( a, b, { silent: true });\n    };\n    // compile these here outside of the loop\n    var _regexps = [];\n    function getRegExps(){\n        if( !_regexps.length ){\n            _regexps = [\n                new RegExp( this.filters[0] ),\n                new RegExp( this.filters[1] )\n            ];\n        }\n        return _regexps;\n    }\n    // mangle params as needed\n    options.preprocessMatch = options.preprocessMatch || function _defaultPreprocessMatch( params ){\n        var regexps = getRegExps.call( this );\n        return _.extend( params, {\n            matchTo     : params.matchTo.name.replace( regexps[0], '' ),\n            possible    : params.possible.name.replace( regexps[1], '' )\n        });\n    };\n\n    return function _strategy( params ){\n        this.debug( 'autopair _strategy ---------------------------' );\n        params = params || {};\n        var listA = params.listA,\n            listB = params.listB,\n            indexA = 0, indexB,\n            bestMatch = {\n                score : 0.0,\n                index : null\n            },\n            paired = [];\n        //console.debug( 'params:', JSON.stringify( params, null, '  ' ) );\n        this.debug( 'starting list lens:', listA.length, listB.length );\n        this.debug( 'bestMatch (starting):', JSON.stringify( bestMatch, null, '  ' ) );\n\n        while( indexA < listA.length ){\n            var matchTo = listA[ indexA ];\n            bestMatch.score = 0.0;\n\n            for( indexB=0; indexB<listB.length; indexB++ ){\n                var possible = listB[ indexB ];\n                this.debug( indexA + ':' + matchTo.name );\n                this.debug( indexB + ':' + possible.name );\n\n                // no matching with self\n                if( listA[ indexA ] !== listB[ indexB ] ){\n                    bestMatch = options.match.call( this, options.preprocessMatch.call( this, {\n                        matchTo : matchTo,\n                        possible: possible,\n                        index   : indexB,\n                        bestMatch : bestMatch\n                    }));\n                    this.debug( 'bestMatch:', JSON.stringify( bestMatch, null, '  ' ) );\n                    if( bestMatch.score === 1.0 ){\n                        this.debug( 'breaking early due to perfect match' );\n                        break;\n                    }\n                }\n            }\n            var scoreThreshold = options.scoreThreshold.call( this );\n            this.debug( 'scoreThreshold:', scoreThreshold );\n            this.debug( 'bestMatch.score:', bestMatch.score );\n\n            if( bestMatch.score >= scoreThreshold ){\n                //console.debug( 'autoPairFnBuilder.strategy', listA[ indexA ].name, listB[ bestMatch.index ].name );\n                paired.push( options.createPair.call( this, {\n                    listA   : listA,\n                    indexA  : indexA,\n                    listB   : listB,\n                    indexB  : bestMatch.index\n                }));\n                //console.debug( 'list lens now:', listA.length, listB.length );\n            } else {\n                indexA += 1;\n            }\n            if( !listA.length || !listB.length ){\n                return paired;\n            }\n        }\n        this.debug( 'paired:', JSON.stringify( paired, null, '  ' ) );\n        this.debug( 'autopair _strategy ---------------------------' );\n        return paired;\n    };\n}\n\n\n// ============================================================================\n/** An interface for building collections of paired datasets.\n */\nvar PairedCollectionCreator = Backbone.View.extend( baseMVC.LoggableMixin ).extend({\n    _logNamespace : logNamespace,\n\n    className: 'list-of-pairs-collection-creator collection-creator flex-row-container',\n\n    /** set up initial options, instance vars, behaviors, and autopair (if set to do so) */\n    initialize : function( attributes ){\n        this.metric( 'PairedCollectionCreator.initialize', attributes );\n        //this.debug( '-- PairedCollectionCreator:', attributes );\n\n        attributes = _.defaults( attributes, {\n            datasets            : [],\n            filters             : this.DEFAULT_FILTERS,\n            automaticallyPair   : true,\n            strategy            : 'lcs',\n            matchPercentage     : 0.9,\n            twoPassAutopairing  : true\n        });\n\n        /** unordered, original list */\n        this.initialList = attributes.datasets;\n\n        /** is this from a history? if so, what's its id? */\n        this.historyId = attributes.historyId;\n\n        /** which filters should be used initially? (String[2] or name in commonFilters) */\n        this.filters = this.commonFilters[ attributes.filters ] || this.commonFilters[ this.DEFAULT_FILTERS ];\n        if( _.isArray( attributes.filters ) ){\n            this.filters = attributes.filters;\n        }\n\n        /** try to auto pair the unpaired datasets on load? */\n        this.automaticallyPair = attributes.automaticallyPair;\n\n        /** what method to use for auto pairing (will be passed aggression level) */\n        this.strategy = this.strategies[ attributes.strategy ] || this.strategies[ this.DEFAULT_STRATEGY ];\n        if( _.isFunction( attributes.strategy ) ){\n            this.strategy = attributes.strategy;\n        }\n\n        /** distance/mismatch level allowed for autopairing */\n        this.matchPercentage = attributes.matchPercentage;\n\n        /** try to autopair using simple first, then this.strategy on the remainder */\n        this.twoPassAutopairing = attributes.twoPassAutopairing;\n\n        /** remove file extensions (\\.*) from created pair names? */\n        this.removeExtensions = true;\n        //this.removeExtensions = false;\n\n        /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n        this.oncancel = attributes.oncancel;\n        /** fn to call when the collection is created (scoped to this) */\n        this.oncreate = attributes.oncreate;\n\n        /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n        this.autoscrollDist = attributes.autoscrollDist || 24;\n\n        /** is the unpaired panel shown? */\n        this.unpairedPanelHidden = false;\n        /** is the paired panel shown? */\n        this.pairedPanelHidden = false;\n\n        /** DOM elements currently being dragged */\n        this.$dragging = null;\n\n        /** Used for blocking UI events during ajax/operations (don't post twice) */\n        this.blocking = false;\n\n        this._setUpBehaviors();\n        this._dataSetUp();\n    },\n\n    /** map of common filter pairs by name */\n    commonFilters : {\n        illumina        : [ '_1', '_2' ],\n        Rs              : [ '_R1', '_R2' ]\n    },\n    /** which commonFilter to use by default */\n    DEFAULT_FILTERS : 'illumina',\n\n    /** map of name->fn for autopairing */\n    strategies : {\n        'simple'        : 'autopairSimple',\n        'lcs'           : 'autopairLCS',\n        'levenshtein'   : 'autopairLevenshtein'\n    },\n    /** default autopair strategy name */\n    DEFAULT_STRATEGY : 'lcs',\n\n    // ------------------------------------------------------------------------ process raw list\n    /** set up main data: cache initialList, sort, and autopair */\n    _dataSetUp : function(){\n        //this.debug( '-- _dataSetUp' );\n\n        this.paired = [];\n        this.unpaired = [];\n\n        this.selectedIds = [];\n\n        // sort initial list, add ids if needed, and save new working copy to unpaired\n        this._sortInitialList();\n        this._ensureIds();\n        this.unpaired = this.initialList.slice( 0 );\n\n        if( this.automaticallyPair ){\n            this.autoPair();\n            this.once( 'rendered:initial', function(){\n                this.trigger( 'autopair' );\n            });\n        }\n    },\n\n    /** sort initial list */\n    _sortInitialList : function(){\n        //this.debug( '-- _sortInitialList' );\n        this._sortDatasetList( this.initialList );\n    },\n\n    /** sort a list of datasets */\n    _sortDatasetList : function( list ){\n        // currently only natural sort by name\n        list.sort( function( a, b ){ return naturalSort( a.name, b.name ); });\n        return list;\n    },\n\n    /** add ids to dataset objs in initial list if none */\n    _ensureIds : function(){\n        this.initialList.forEach( function( dataset ){\n            if( !dataset.hasOwnProperty( 'id' ) ){\n                dataset.id = _.uniqueId();\n            }\n        });\n        return this.initialList;\n    },\n\n    /** split initial list into two lists, those that pass forward filters & those passing reverse */\n    _splitByFilters : function(){\n        var regexFilters = this.filters.map( function( stringFilter ){\n                return new RegExp( stringFilter );\n            }),\n            split = [ [], [] ];\n\n        function _filter( unpaired, filter ){\n            return filter.test( unpaired.name );\n            //return dataset.name.indexOf( filter ) >= 0;\n        }\n        this.unpaired.forEach( function _filterEach( unpaired ){\n            // 90% of the time this seems to work, but:\n            //TODO: this treats *all* strings as regex which may confuse people - possibly check for // surrounding?\n            //  would need explanation in help as well\n            regexFilters.forEach( function( filter, i ){\n                if( _filter( unpaired, filter ) ){\n                    split[i].push( unpaired );\n                }\n            });\n        });\n        return split;\n    },\n\n    /** add a dataset to the unpaired list in it's proper order */\n    _addToUnpaired : function( dataset ){\n        // currently, unpaired is natural sorted by name, use binary search to find insertion point\n        var binSearchSortedIndex = function( low, hi ){\n            if( low === hi ){ return low; }\n\n            var mid = Math.floor( ( hi - low ) / 2 ) + low,\n                compared = naturalSort( dataset.name, this.unpaired[ mid ].name );\n\n            if( compared < 0 ){\n                return binSearchSortedIndex( low, mid );\n            } else if( compared > 0 ){\n                return binSearchSortedIndex( mid + 1, hi );\n            }\n            // walk the equal to find the last\n            while( this.unpaired[ mid ] && this.unpaired[ mid ].name === dataset.name ){ mid++; }\n            return mid;\n\n        }.bind( this );\n\n        this.unpaired.splice( binSearchSortedIndex( 0, this.unpaired.length ), 0, dataset );\n    },\n\n    // ------------------------------------------------------------------------ auto pairing\n    /** two passes to automatically create pairs:\n     *  use both simpleAutoPair, then the fn mentioned in strategy\n     */\n    autoPair : function( strategy ){\n        // split first using exact matching\n        var split = this._splitByFilters(),\n            paired = [];\n        if( this.twoPassAutopairing ){\n            paired = this.autopairSimple({\n                listA : split[0],\n                listB : split[1]\n            });\n            split = this._splitByFilters();\n        }\n\n        // uncomment to see printlns while running tests\n        //this.debug = function(){ console.log.apply( console, arguments ); };\n\n        // then try the remainder with something less strict\n        strategy = strategy || this.strategy;\n        split = this._splitByFilters();\n        paired = paired.concat( this[ strategy ].call( this, {\n            listA : split[0],\n            listB : split[1]\n        }));\n        return paired;\n    },\n\n    /** autopair by exact match */\n    autopairSimple : autoPairFnBuilder({\n        scoreThreshold: function(){ return 1.0; },\n        match : function _match( params ){\n            params = params || {};\n            if( params.matchTo === params.possible ){\n                return {\n                    index: params.index,\n                    score: 1.0\n                };\n            }\n            return params.bestMatch;\n        }\n    }),\n\n    /** autopair by levenshtein edit distance scoring */\n    autopairLevenshtein : autoPairFnBuilder({\n        scoreThreshold: function(){ return this.matchPercentage; },\n        match : function _matches( params ){\n            params = params || {};\n            var distance = levenshteinDistance( params.matchTo, params.possible ),\n                score = 1.0 - ( distance / ( Math.max( params.matchTo.length, params.possible.length ) ) );\n            if( score > params.bestMatch.score ){\n                return {\n                    index: params.index,\n                    score: score\n                };\n            }\n            return params.bestMatch;\n        }\n    }),\n\n    /** autopair by longest common substrings scoring */\n    autopairLCS : autoPairFnBuilder({\n        scoreThreshold: function(){ return this.matchPercentage; },\n        match : function _matches( params ){\n            params = params || {};\n            var match = this._naiveStartingAndEndingLCS( params.matchTo, params.possible ).length,\n                score = match / ( Math.max( params.matchTo.length, params.possible.length ) );\n            if( score > params.bestMatch.score ){\n                return {\n                    index: params.index,\n                    score: score\n                };\n            }\n            return params.bestMatch;\n        }\n    }),\n\n    /** return the concat'd longest common prefix and suffix from two strings */\n    _naiveStartingAndEndingLCS : function( s1, s2 ){\n        var fwdLCS = '',\n            revLCS = '',\n            i = 0, j = 0;\n        while( i < s1.length && i < s2.length ){\n            if( s1[ i ] !== s2[ i ] ){\n                break;\n            }\n            fwdLCS += s1[ i ];\n            i += 1;\n        }\n        if( i === s1.length ){ return s1; }\n        if( i === s2.length ){ return s2; }\n\n        i = ( s1.length - 1 );\n        j = ( s2.length - 1 );\n        while( i >= 0 && j >= 0 ){\n            if( s1[ i ] !== s2[ j ] ){\n                break;\n            }\n            revLCS = [ s1[ i ], revLCS ].join( '' );\n            i -= 1;\n            j -= 1;\n        }\n        return fwdLCS + revLCS;\n    },\n\n    // ------------------------------------------------------------------------ pairing / unpairing\n    /** create a pair from fwd and rev, removing them from unpaired, and placing the new pair in paired */\n    _pair : function( fwd, rev, options ){\n        options = options || {};\n        this.debug( '_pair:', fwd, rev );\n        var pair = this._createPair( fwd, rev, options.name );\n        this.paired.push( pair );\n        this.unpaired = _.without( this.unpaired, fwd, rev );\n        if( !options.silent ){\n            this.trigger( 'pair:new', pair );\n        }\n        return pair;\n    },\n\n    /** create a pair Object from fwd and rev, adding the name attribute (will guess if not given) */\n    _createPair : function( fwd, rev, name ){\n        // ensure existance and don't pair something with itself\n        if( !( fwd && rev ) || ( fwd === rev ) ){\n            throw new Error( 'Bad pairing: ' + [ JSON.stringify( fwd ), JSON.stringify( rev ) ] );\n        }\n        name = name || this._guessNameForPair( fwd, rev );\n        return { forward : fwd, name : name, reverse : rev };\n    },\n\n    /** try to find a good pair name for the given fwd and rev datasets */\n    _guessNameForPair : function( fwd, rev, removeExtensions ){\n        removeExtensions = ( removeExtensions !== undefined )?( removeExtensions ):( this.removeExtensions );\n        var fwdName = fwd.name,\n            revName = rev.name,\n            lcs = this._naiveStartingAndEndingLCS(\n                fwdName.replace( new RegExp( this.filters[0] ), '' ),\n                revName.replace( new RegExp( this.filters[1] ), '' )\n            );\n        if( removeExtensions ){\n            var lastDotIndex = lcs.lastIndexOf( '.' );\n            if( lastDotIndex > 0 ){\n                var extension = lcs.slice( lastDotIndex, lcs.length );\n                lcs = lcs.replace( extension, '' );\n                fwdName = fwdName.replace( extension, '' );\n                revName = revName.replace( extension, '' );\n            }\n        }\n        return lcs || ( fwdName + ' & ' + revName );\n    },\n\n    /** unpair a pair, removing it from paired, and adding the fwd,rev datasets back into unpaired */\n    _unpair : function( pair, options ){\n        options = options || {};\n        if( !pair ){\n            throw new Error( 'Bad pair: ' + JSON.stringify( pair ) );\n        }\n        this.paired = _.without( this.paired, pair );\n        this._addToUnpaired( pair.forward );\n        this._addToUnpaired( pair.reverse );\n\n        if( !options.silent ){\n            this.trigger( 'pair:unpair', [ pair ] );\n        }\n        return pair;\n    },\n\n    /** unpair all paired datasets */\n    unpairAll : function(){\n        var pairs = [];\n        while( this.paired.length ){\n            pairs.push( this._unpair( this.paired[ 0 ], { silent: true }) );\n        }\n        this.trigger( 'pair:unpair', pairs );\n    },\n\n    // ------------------------------------------------------------------------ API\n    /** convert a pair into JSON compatible with the collections API */\n    _pairToJSON : function( pair, src ){\n        src = src || 'hda';\n        //TODO: consider making this the pair structure when created instead\n        return {\n            collection_type : 'paired',\n            src             : 'new_collection',\n            name            : pair.name,\n            element_identifiers : [{\n                name    : 'forward',\n                id      : pair.forward.id,\n                src     : src\n            }, {\n                name    : 'reverse',\n                id      : pair.reverse.id,\n                src     : src\n            }]\n        };\n    },\n\n    /** create the collection via the API\n     *  @returns {jQuery.xhr Object}    the jquery ajax request\n     */\n    createList : function( name ){\n        var creator = this,\n            url = Galaxy.root + 'api/histories/' + this.historyId + '/contents/dataset_collections';\n\n        //TODO: use ListPairedCollection.create()\n        var ajaxData = {\n            type            : 'dataset_collection',\n            collection_type : 'list:paired',\n            name            : _.escape( name || creator.$( '.collection-name' ).val() ),\n            element_identifiers : creator.paired.map( function( pair ){\n                return creator._pairToJSON( pair );\n            })\n\n        };\n        //this.debug( JSON.stringify( ajaxData ) );\n        creator.blocking = true;\n        return jQuery.ajax( url, {\n            type        : 'POST',\n            contentType : 'application/json',\n            dataType    : 'json',\n            data        : JSON.stringify( ajaxData )\n        })\n        .always( function(){\n            creator.blocking = false;\n        })\n        .fail( function( xhr, status, message ){\n            creator._ajaxErrHandler( xhr, status, message );\n        })\n        .done( function( response, message, xhr ){\n            //this.info( 'ok', response, message, xhr );\n            creator.trigger( 'collection:created', response, message, xhr );\n            creator.metric( 'collection:created', response );\n            if( typeof creator.oncreate === 'function' ){\n                creator.oncreate.call( this, response, message, xhr );\n            }\n        });\n    },\n\n    /** handle ajax errors with feedback and details to the user (if available) */\n    _ajaxErrHandler : function( xhr, status, message ){\n        this.error( xhr, status, message );\n        var content = _l( 'An error occurred while creating this collection' );\n        if( xhr ){\n            if( xhr.readyState === 0 && xhr.status === 0 ){\n                content += ': ' + _l( 'Galaxy could not be reached and may be updating.' )\n                    + _l( ' Try again in a few minutes.' );\n            } else if( xhr.responseJSON ){\n                content += '<br /><pre>' + JSON.stringify( xhr.responseJSON ) + '</pre>';\n            } else {\n                content += ': ' + message;\n            }\n        }\n        creator._showAlert( content, 'alert-danger' );\n    },\n\n    // ------------------------------------------------------------------------ rendering\n    /** render the entire interface */\n    render : function( speed, callback ){\n        //this.debug( '-- _render' );\n        //this.$el.empty().html( PairedCollectionCreator.templates.main() );\n        this.$el.empty().html( PairedCollectionCreator.templates.main() );\n        this._renderHeader( speed );\n        this._renderMiddle( speed );\n        this._renderFooter( speed );\n        this._addPluginComponents();\n        this.trigger( 'rendered', this );\n        return this;\n    },\n\n    /** render the header section */\n    _renderHeader : function( speed, callback ){\n        //this.debug( '-- _renderHeader' );\n        var $header = this.$( '.header' ).empty().html( PairedCollectionCreator.templates.header() )\n            .find( '.help-content' ).prepend( $( PairedCollectionCreator.templates.helpContent() ) );\n\n        this._renderFilters();\n        return $header;\n    },\n    /** fill the filter inputs with the filter values */\n    _renderFilters : function(){\n        return    this.$( '.forward-column .column-header input' ).val( this.filters[0] )\n            .add( this.$( '.reverse-column .column-header input' ).val( this.filters[1] ) );\n    },\n\n    /** render the middle including unpaired and paired sections (which may be hidden) */\n    _renderMiddle : function( speed, callback ){\n        var $middle = this.$( '.middle' ).empty().html( PairedCollectionCreator.templates.middle() );\n\n        // (re-) hide the un/paired panels based on instance vars\n        if( this.unpairedPanelHidden ){\n            this.$( '.unpaired-columns' ).hide();\n        } else if( this.pairedPanelHidden ){\n            this.$( '.paired-columns' ).hide();\n        }\n\n        this._renderUnpaired();\n        this._renderPaired();\n        return $middle;\n    },\n    /** render the unpaired section, showing datasets accrd. to filters, update the unpaired counts */\n    _renderUnpaired : function( speed, callback ){\n        //this.debug( '-- _renderUnpaired' );\n        var creator = this,\n            $fwd, $rev, $prd = [],\n            split = this._splitByFilters();\n        // update unpaired counts\n        this.$( '.forward-column .title' )\n            .text([ split[0].length, _l( 'unpaired forward' ) ].join( ' ' ));\n        this.$( '.forward-column .unpaired-info' )\n            .text( this._renderUnpairedDisplayStr( this.unpaired.length - split[0].length ) );\n        this.$( '.reverse-column .title' )\n            .text([ split[1].length, _l( 'unpaired reverse' ) ].join( ' ' ));\n        this.$( '.reverse-column .unpaired-info' )\n            .text( this._renderUnpairedDisplayStr( this.unpaired.length - split[1].length ) );\n\n        this.$( '.unpaired-columns .column-datasets' ).empty();\n\n        // show/hide the auto pair button if any unpaired are left\n        this.$( '.autopair-link' ).toggle( this.unpaired.length !== 0 );\n        if( this.unpaired.length === 0 ){\n            this._renderUnpairedEmpty();\n            return;\n        }\n\n        // create the dataset dom arrays\n        $rev = split[1].map( function( dataset, i ){\n            // if there'll be a fwd dataset across the way, add a button to pair the row\n            if( ( split[0][ i ] !== undefined )\n            &&  ( split[0][ i ] !== dataset ) ){\n                $prd.push( creator._renderPairButton() );\n            }\n            return creator._renderUnpairedDataset( dataset );\n        });\n        $fwd = split[0].map( function( dataset ){\n            return creator._renderUnpairedDataset( dataset );\n        });\n\n        if( !$fwd.length && !$rev.length ){\n            this._renderUnpairedNotShown();\n            return;\n        }\n        // add to appropo cols\n        //TODO: not the best way to render - consider rendering the entire unpaired-columns section in a fragment\n        //  and swapping out that\n        this.$( '.unpaired-columns .forward-column .column-datasets' ).append( $fwd )\n            .add( this.$( '.unpaired-columns .paired-column .column-datasets' ).append( $prd ) )\n            .add( this.$( '.unpaired-columns .reverse-column .column-datasets' ).append( $rev ) );\n        this._adjUnpairedOnScrollbar();\n    },\n    /** return a string to display the count of filtered out datasets */\n    _renderUnpairedDisplayStr : function( numFiltered ){\n        return [ '(', numFiltered, ' ', _l( 'filtered out' ), ')' ].join('');\n    },\n    /** return an unattached jQuery DOM element to represent an unpaired dataset */\n    _renderUnpairedDataset : function( dataset ){\n        //TODO: to underscore template\n        return $( '<li/>')\n            .attr( 'id', 'dataset-' + dataset.id )\n            .addClass( 'dataset unpaired' )\n            .attr( 'draggable', true )\n            .addClass( dataset.selected? 'selected': '' )\n            .append( $( '<span/>' ).addClass( 'dataset-name' ).text( dataset.name ) )\n            //??\n            .data( 'dataset', dataset );\n    },\n    /** render the button that may go between unpaired datasets, allowing the user to pair a row */\n    _renderPairButton : function(){\n        //TODO: *not* a dataset - don't pretend like it is\n        return $( '<li/>').addClass( 'dataset unpaired' )\n            .append( $( '<span/>' ).addClass( 'dataset-name' ).text( _l( 'Pair these datasets' ) ) );\n    },\n    /** a message to display when no unpaired left */\n    _renderUnpairedEmpty : function(){\n        //this.debug( '-- renderUnpairedEmpty' );\n        var $msg = $( '<div class=\"empty-message\"></div>' )\n            .text( '(' + _l( 'no remaining unpaired datasets' ) + ')' );\n        this.$( '.unpaired-columns .paired-column .column-datasets' ).empty().prepend( $msg );\n        return $msg;\n    },\n    /** a message to display when no unpaired can be shown with the current filters */\n    _renderUnpairedNotShown : function(){\n        //this.debug( '-- renderUnpairedEmpty' );\n        var $msg = $( '<div class=\"empty-message\"></div>' )\n            .text( '(' + _l( 'no datasets were found matching the current filters' ) + ')' );\n        this.$( '.unpaired-columns .paired-column .column-datasets' ).empty().prepend( $msg );\n        return $msg;\n    },\n    /** try to detect if the unpaired section has a scrollbar and adjust left column for better centering of all */\n    _adjUnpairedOnScrollbar : function(){\n        var $unpairedColumns = this.$( '.unpaired-columns' ).last(),\n            $firstDataset = this.$( '.unpaired-columns .reverse-column .dataset' ).first();\n        if( !$firstDataset.length ){ return; }\n        var ucRight = $unpairedColumns.offset().left + $unpairedColumns.outerWidth(),\n            dsRight = $firstDataset.offset().left + $firstDataset.outerWidth(),\n            rightDiff = Math.floor( ucRight ) - Math.floor( dsRight );\n        //this.debug( 'rightDiff:', ucRight, '-', dsRight, '=', rightDiff );\n        this.$( '.unpaired-columns .forward-column' )\n            .css( 'margin-left', ( rightDiff > 0 )? rightDiff: 0 );\n    },\n\n    /** render the paired section and update counts of paired datasets */\n    _renderPaired : function( speed, callback ){\n        //this.debug( '-- _renderPaired' );\n        this.$( '.paired-column-title .title' ).text([ this.paired.length, _l( 'paired' ) ].join( ' ' ) );\n        // show/hide the unpair all link\n        this.$( '.unpair-all-link' ).toggle( this.paired.length !== 0 );\n        if( this.paired.length === 0 ){\n            this._renderPairedEmpty();\n            return;\n            //TODO: would be best to return here (the $columns)\n        } else {\n            // show/hide 'remove extensions link' when any paired and they seem to have extensions\n            this.$( '.remove-extensions-link' ).show();\n        }\n\n        this.$( '.paired-columns .column-datasets' ).empty();\n        var creator = this;\n        this.paired.forEach( function( pair, i ){\n            //TODO: cache these?\n            var pairView = new PairView({ pair: pair });\n            creator.$( '.paired-columns .column-datasets' )\n                .append( pairView.render().$el )\n                .append([\n                    '<button class=\"unpair-btn\">',\n                        '<span class=\"fa fa-unlink\" title=\"', _l( 'Unpair' ), '\"></span>',\n                    '</button>'\n                ].join( '' ));\n        });\n    },\n    /** a message to display when none paired */\n    _renderPairedEmpty : function(){\n        var $msg = $( '<div class=\"empty-message\"></div>' )\n            .text( '(' + _l( 'no paired datasets yet' ) + ')' );\n        this.$( '.paired-columns .column-datasets' ).empty().prepend( $msg );\n        return $msg;\n    },\n\n    /** render the footer, completion controls, and cancel controls */\n    _renderFooter : function( speed, callback ){\n        var $footer = this.$( '.footer' ).empty().html( PairedCollectionCreator.templates.footer() );\n        this.$( '.remove-extensions' ).prop( 'checked', this.removeExtensions );\n        if( typeof this.oncancel === 'function' ){\n            this.$( '.cancel-create.btn' ).show();\n        }\n        return $footer;\n    },\n\n    /** add any jQuery/bootstrap/custom plugins to elements rendered */\n    _addPluginComponents : function(){\n        this._chooseFiltersPopover( '.choose-filters-link' );\n        this.$( '.help-content i' ).hoverhighlight( '.collection-creator', 'rgba( 64, 255, 255, 1.0 )' );\n    },\n\n    /** build a filter selection popover allowing selection of common filter pairs */\n    _chooseFiltersPopover : function( selector ){\n        function filterChoice( val1, val2 ){\n            return [\n                '<button class=\"filter-choice btn\" ',\n                        'data-forward=\"', val1, '\" data-reverse=\"', val2, '\">',\n                    _l( 'Forward' ), ': ', val1, ', ',\n                    _l( 'Reverse' ), ': ', val2,\n                '</button>'\n            ].join('');\n        }\n        var $popoverContent = $( _.template([\n            '<div class=\"choose-filters\">',\n                '<div class=\"help\">',\n                    _l( 'Choose from the following filters to change which unpaired reads are shown in the display' ),\n                ':</div>',\n                _.values( this.commonFilters ).map( function( filterSet ){\n                    return filterChoice( filterSet[0], filterSet[1] );\n                }).join( '' ),\n            '</div>'\n        ].join(''))({}));\n\n        return this.$( selector ).popover({\n            container   : '.collection-creator',\n            placement   : 'bottom',\n            html        : true,\n            //animation   : false,\n            content     : $popoverContent\n        });\n    },\n\n    /** add (or clear if clear is truthy) a validation warning to what */\n    _validationWarning : function( what, clear ){\n        var VALIDATION_CLASS = 'validation-warning';\n        if( what === 'name' ){\n            what = this.$( '.collection-name' ).add( this.$( '.collection-name-prompt' ) );\n            this.$( '.collection-name' ).focus().select();\n        }\n        if( clear ){\n            what = what || this.$( '.' + VALIDATION_CLASS );\n            what.removeClass( VALIDATION_CLASS );\n        } else {\n            what.addClass( VALIDATION_CLASS );\n        }\n    },\n\n    // ------------------------------------------------------------------------ events\n    /** set up event handlers on self */\n    _setUpBehaviors : function(){\n        this.once( 'rendered', function(){\n            this.trigger( 'rendered:initial', this );\n        });\n\n        this.on( 'pair:new', function(){\n            //TODO: ideally only re-render the columns (or even elements) involved\n            this._renderUnpaired();\n            this._renderPaired();\n\n            // scroll to bottom where new pairs are added\n            //TODO: this doesn't seem to work - innerHeight sticks at 133...\n            //  may have to do with improper flex columns\n            //var $pairedView = this.$( '.paired-columns' );\n            //$pairedView.scrollTop( $pairedView.innerHeight() );\n            //this.debug( $pairedView.height() )\n            this.$( '.paired-columns' ).scrollTop( 8000000 );\n        });\n        this.on( 'pair:unpair', function( pairs ){\n            //TODO: ideally only re-render the columns (or even elements) involved\n            this._renderUnpaired();\n            this._renderPaired();\n            this.splitView();\n        });\n\n        this.on( 'filter-change', function(){\n            this.filters = [\n                this.$( '.forward-unpaired-filter input' ).val(),\n                this.$( '.reverse-unpaired-filter input' ).val()\n            ];\n            this.metric( 'filter-change', this.filters );\n            this._renderFilters();\n            this._renderUnpaired();\n        });\n\n        this.on( 'autopair', function(){\n            this._renderUnpaired();\n            this._renderPaired();\n\n            var message, msgClass = null;\n            if( this.paired.length ){\n                msgClass = 'alert-success';\n                message = this.paired.length + ' ' + _l( 'pairs created' );\n                if( !this.unpaired.length ){\n                    message += ': ' + _l( 'all datasets have been successfully paired' );\n                    this.hideUnpaired();\n                    this.$( '.collection-name' ).focus();\n                }\n            } else {\n                message = _l([\n                    'Could not automatically create any pairs from the given dataset names.',\n                    'You may want to choose or enter different filters and try auto-pairing again.',\n                    'Close this message using the X on the right to view more help.'\n                ].join( ' ' ));\n            }\n            this._showAlert( message, msgClass );\n        });\n\n        //this.on( 'all', function(){\n        //    this.info( arguments );\n        //});\n        return this;\n    },\n\n    events : {\n        // header\n        'click .more-help'                          : '_clickMoreHelp',\n        'click .less-help'                          : '_clickLessHelp',\n        'click .header .alert button'               : '_hideAlert',\n        'click .forward-column .column-title'       : '_clickShowOnlyUnpaired',\n        'click .reverse-column .column-title'       : '_clickShowOnlyUnpaired',\n        'click .unpair-all-link'                    : '_clickUnpairAll',\n        //TODO: this seems kinda backasswards - re-sending jq event as a backbone event, can we listen directly?\n        'change .forward-unpaired-filter input'     : function( ev ){ this.trigger( 'filter-change' ); },\n        'focus .forward-unpaired-filter input'      : function( ev ){ $( ev.currentTarget ).select(); },\n        'click .autopair-link'                      : '_clickAutopair',\n        'click .choose-filters .filter-choice'      : '_clickFilterChoice',\n        'click .clear-filters-link'                 : '_clearFilters',\n        'change .reverse-unpaired-filter input'     : function( ev ){ this.trigger( 'filter-change' ); },\n        'focus .reverse-unpaired-filter input'      : function( ev ){ $( ev.currentTarget ).select(); },\n        // unpaired\n        'click .forward-column .dataset.unpaired'   : '_clickUnpairedDataset',\n        'click .reverse-column .dataset.unpaired'   : '_clickUnpairedDataset',\n        'click .paired-column .dataset.unpaired'    : '_clickPairRow',\n        'click .unpaired-columns'                   : 'clearSelectedUnpaired',\n        'mousedown .unpaired-columns .dataset'      : '_mousedownUnpaired',\n        // divider\n        'click .paired-column-title'                : '_clickShowOnlyPaired',\n        'mousedown .flexible-partition-drag'        : '_startPartitionDrag',\n        // paired\n        'click .paired-columns .dataset.paired'     : 'selectPair',\n        'click .paired-columns'                     : 'clearSelectedPaired',\n        'click .paired-columns .pair-name'          : '_clickPairName',\n        'click .unpair-btn'                         : '_clickUnpair',\n        // paired - drop target\n        //'dragenter .paired-columns'                 : '_dragenterPairedColumns',\n        //'dragleave .paired-columns .column-datasets': '_dragleavePairedColumns',\n        'dragover .paired-columns .column-datasets' : '_dragoverPairedColumns',\n        'drop .paired-columns .column-datasets'     : '_dropPairedColumns',\n\n        'pair.dragstart .paired-columns .column-datasets' : '_pairDragstart',\n        'pair.dragend   .paired-columns .column-datasets' : '_pairDragend',\n\n        // footer\n        'change .remove-extensions'                 : function( ev ){ this.toggleExtensions(); },\n        'change .collection-name'                   : '_changeName',\n        'keydown .collection-name'                  : '_nameCheckForEnter',\n        'click .cancel-create'                      : function( ev ){\n            if( typeof this.oncancel === 'function' ){\n                this.oncancel.call( this );\n            }\n        },\n        'click .create-collection'                  : '_clickCreate'//,\n    },\n\n    // ........................................................................ header\n    /** expand help */\n    _clickMoreHelp : function( ev ){\n        this.$( '.main-help' ).addClass( 'expanded' );\n        this.$( '.more-help' ).hide();\n    },\n    /** collapse help */\n    _clickLessHelp : function( ev ){\n        this.$( '.main-help' ).removeClass( 'expanded' );\n        this.$( '.more-help' ).show();\n    },\n\n    /** show an alert on the top of the interface containing message (alertClass is bootstrap's alert-*)*/\n    _showAlert : function( message, alertClass ){\n        alertClass = alertClass || 'alert-danger';\n        this.$( '.main-help' ).hide();\n        this.$( '.header .alert' ).attr( 'class', 'alert alert-dismissable' ).addClass( alertClass ).show()\n            .find( '.alert-message' ).html( message );\n    },\n    /** hide the alerts at the top */\n    _hideAlert : function( message ){\n        this.$( '.main-help' ).show();\n        this.$( '.header .alert' ).hide();\n    },\n\n    /** toggle between showing only unpaired and split view */\n    _clickShowOnlyUnpaired : function( ev ){\n        //this.debug( 'click unpaired', ev.currentTarget );\n        if( this.$( '.paired-columns' ).is( ':visible' ) ){\n            this.hidePaired();\n        } else {\n            this.splitView();\n        }\n    },\n    /** toggle between showing only paired and split view */\n    _clickShowOnlyPaired : function( ev ){\n        //this.debug( 'click paired' );\n        if( this.$( '.unpaired-columns' ).is( ':visible' ) ){\n            this.hideUnpaired();\n        } else {\n            this.splitView();\n        }\n    },\n\n    /** hide unpaired, show paired */\n    hideUnpaired : function( speed, callback ){\n        this.unpairedPanelHidden = true;\n        this.pairedPanelHidden = false;\n        this._renderMiddle( speed, callback );\n    },\n    /** hide paired, show unpaired */\n    hidePaired : function( speed, callback ){\n        this.unpairedPanelHidden = false;\n        this.pairedPanelHidden = true;\n        this._renderMiddle( speed, callback );\n    },\n    /** show both paired and unpaired (splitting evenly) */\n    splitView : function( speed, callback ){\n        this.unpairedPanelHidden = this.pairedPanelHidden = false;\n        this._renderMiddle( speed, callback );\n        return this;\n    },\n\n    /** unpair all paired and do other super neat stuff which I'm not really sure about yet... */\n    _clickUnpairAll : function( ev ){\n        this.metric( 'unpairAll' );\n        this.unpairAll();\n    },\n\n    /** attempt to autopair */\n    _clickAutopair : function( ev ){\n        var paired = this.autoPair();\n        this.metric( 'autopair', paired.length, this.unpaired.length );\n        this.trigger( 'autopair' );\n    },\n\n    /** set the filters based on the data attributes of the button click target */\n    _clickFilterChoice : function( ev ){\n        var $selected = $( ev.currentTarget );\n        this.$( '.forward-unpaired-filter input' ).val( $selected.data( 'forward' ) );\n        this.$( '.reverse-unpaired-filter input' ).val( $selected.data( 'reverse' ) );\n        this._hideChooseFilters();\n        this.trigger( 'filter-change' );\n    },\n\n    /** hide the choose filters popover */\n    _hideChooseFilters : function(){\n        //TODO: update bootstrap and remove the following hack\n        //  see also: https://github.com/twbs/bootstrap/issues/10260\n        this.$( '.choose-filters-link' ).popover( 'hide' );\n        this.$( '.popover' ).css( 'display', 'none' );\n    },\n\n    /** clear both filters */\n    _clearFilters : function( ev ){\n        this.$( '.forward-unpaired-filter input' ).val( '' );\n        this.$( '.reverse-unpaired-filter input' ).val( '' );\n        this.trigger( 'filter-change' );\n    },\n\n    // ........................................................................ unpaired\n    /** select an unpaired dataset */\n    _clickUnpairedDataset : function( ev ){\n        ev.stopPropagation();\n        return this.toggleSelectUnpaired( $( ev.currentTarget ) );\n    },\n\n    /** Toggle the selection of an unpaired dataset representation.\n     *  @param [jQuery] $dataset        the unpaired dataset dom rep to select\n     *  @param [Boolean] options.force  if defined, force selection based on T/F; otherwise, toggle\n     */\n    toggleSelectUnpaired : function( $dataset, options ){\n        options = options || {};\n        var dataset = $dataset.data( 'dataset' ),\n            select = options.force !== undefined? options.force: !$dataset.hasClass( 'selected' );\n        //this.debug( id, options.force, $dataset, dataset );\n        if( !$dataset.length || dataset === undefined ){ return $dataset; }\n\n        if( select ){\n            $dataset.addClass( 'selected' );\n            if( !options.waitToPair ){\n                this.pairAllSelected();\n            }\n\n        } else {\n            $dataset.removeClass( 'selected' );\n            //delete dataset.selected;\n        }\n        return $dataset;\n    },\n\n    /** pair all the currently selected unpaired datasets */\n    pairAllSelected : function( options ){\n        options = options || {};\n        var creator = this,\n            fwds = [],\n            revs = [],\n            pairs = [];\n        creator.$( '.unpaired-columns .forward-column .dataset.selected' ).each( function(){\n            fwds.push( $( this ).data( 'dataset' ) );\n        });\n        creator.$( '.unpaired-columns .reverse-column .dataset.selected' ).each( function(){\n            revs.push( $( this ).data( 'dataset' ) );\n        });\n        fwds.length = revs.length = Math.min( fwds.length, revs.length );\n        //this.debug( fwds );\n        //this.debug( revs );\n        fwds.forEach( function( fwd, i ){\n            try {\n                pairs.push( creator._pair( fwd, revs[i], { silent: true }) );\n\n            } catch( err ){\n                //TODO: preserve selected state of those that couldn't be paired\n                //TODO: warn that some could not be paired\n                creator.error( err );\n            }\n        });\n        if( pairs.length && !options.silent ){\n            this.trigger( 'pair:new', pairs );\n        }\n        return pairs;\n    },\n\n    /** clear the selection on all unpaired datasets */\n    clearSelectedUnpaired : function(){\n        this.$( '.unpaired-columns .dataset.selected' ).removeClass( 'selected' );\n    },\n\n    /** when holding down the shift key on a click, 'paint' the moused over datasets as selected */\n    _mousedownUnpaired : function( ev ){\n        if( ev.shiftKey ){\n            var creator = this,\n                $startTarget = $( ev.target ).addClass( 'selected' ),\n                moveListener = function( ev ){\n                    creator.$( ev.target ).filter( '.dataset' ).addClass( 'selected' );\n                };\n            $startTarget.parent().on( 'mousemove', moveListener );\n\n            // on any mouseup, stop listening to the move and try to pair any selected\n            $( document ).one( 'mouseup', function( ev ){\n                $startTarget.parent().off( 'mousemove', moveListener );\n                creator.pairAllSelected();\n            });\n        }\n    },\n\n    /** attempt to pair two datasets directly across from one another */\n    _clickPairRow : function( ev ){\n        //if( !ev.currentTarget ){ return true; }\n        var rowIndex = $( ev.currentTarget ).index(),\n            fwd = $( '.unpaired-columns .forward-column .dataset' ).eq( rowIndex ).data( 'dataset' ),\n            rev = $( '.unpaired-columns .reverse-column .dataset' ).eq( rowIndex ).data( 'dataset' );\n        //this.debug( 'row:', rowIndex, fwd, rev );\n        this._pair( fwd, rev );\n    },\n\n    // ........................................................................ divider/partition\n    /** start dragging the visible divider/partition between unpaired and paired panes */\n    _startPartitionDrag : function( ev ){\n        var creator = this,\n            startingY = ev.pageY;\n        //this.debug( 'partition drag START:', ev );\n        $( 'body' ).css( 'cursor', 'ns-resize' );\n        creator.$( '.flexible-partition-drag' ).css( 'color', 'black' );\n\n        function endDrag( ev ){\n            //creator.debug( 'partition drag STOP:', ev );\n            // doing this by an added class didn't really work well - kept flashing still\n            creator.$( '.flexible-partition-drag' ).css( 'color', '' );\n            $( 'body' ).css( 'cursor', '' ).unbind( 'mousemove', trackMouse );\n        }\n        function trackMouse( ev ){\n            var offset = ev.pageY - startingY;\n            //creator.debug( 'partition:', startingY, offset );\n            if( !creator.adjPartition( offset ) ){\n                //creator.debug( 'mouseup triggered' );\n                $( 'body' ).trigger( 'mouseup' );\n            }\n            creator._adjUnpairedOnScrollbar();\n            startingY += offset;\n        }\n        $( 'body' ).mousemove( trackMouse );\n        $( 'body' ).one( 'mouseup', endDrag );\n    },\n\n    /** adjust the parition up/down +/-adj pixels */\n    adjPartition : function( adj ){\n        var $unpaired = this.$( '.unpaired-columns' ),\n            $paired = this.$( '.paired-columns' ),\n            unpairedHi = parseInt( $unpaired.css( 'height' ), 10 ),\n            pairedHi = parseInt( $paired.css( 'height' ), 10 );\n        //this.debug( adj, 'hi\\'s:', unpairedHi, pairedHi, unpairedHi + adj, pairedHi - adj );\n\n        unpairedHi = Math.max( 10, unpairedHi + adj );\n        pairedHi = pairedHi - adj;\n\n        var movingUpwards = adj < 0;\n        // when the divider gets close to the top - lock into hiding the unpaired section\n        if( movingUpwards ){\n            if( this.unpairedPanelHidden ){\n                return false;\n            } else if( unpairedHi <= 10 ){\n                this.hideUnpaired();\n                return false;\n            }\n        } else {\n            if( this.unpairedPanelHidden ){\n                $unpaired.show();\n                this.unpairedPanelHidden = false;\n            }\n        }\n\n        // when the divider gets close to the bottom - lock into hiding the paired section\n        if( !movingUpwards ){\n            if( this.pairedPanelHidden ){\n                return false;\n            } else if( pairedHi <= 15 ){\n                this.hidePaired();\n                return false;\n            }\n\n        } else {\n            if( this.pairedPanelHidden ){\n                $paired.show();\n                this.pairedPanelHidden = false;\n            }\n        }\n\n        $unpaired.css({\n            height  : unpairedHi + 'px',\n            flex    : '0 0 auto'\n        });\n        return true;\n    },\n\n    // ........................................................................ paired\n    /** select a pair when clicked */\n    selectPair : function( ev ){\n        ev.stopPropagation();\n        $( ev.currentTarget ).toggleClass( 'selected' );\n    },\n\n    /** deselect all pairs */\n    clearSelectedPaired : function( ev ){\n        this.$( '.paired-columns .dataset.selected' ).removeClass( 'selected' );\n    },\n\n    /** rename a pair when the pair name is clicked */\n    _clickPairName : function( ev ){\n        ev.stopPropagation();\n        var $name = $( ev.currentTarget ),\n            $pair = $name.parent().parent(),\n            index = $pair.index( '.dataset.paired' ),\n            pair = this.paired[ index ],\n            response = prompt( 'Enter a new name for the pair:', pair.name );\n        if( response ){\n            pair.name = response;\n            // set a flag (which won't be passed in json creation) for manual naming so we don't overwrite these\n            //  when adding/removing extensions\n            //hackish\n            pair.customizedName = true;\n            $name.text( pair.name );\n        }\n    },\n\n    /** unpair this pair */\n    _clickUnpair : function( ev ){\n        //if( !ev.currentTarget ){ return true; }\n        var pairIndex = Math.floor( $( ev.currentTarget ).index( '.unpair-btn' ) );\n        //this.debug( 'pair:', pairIndex );\n        this._unpair( this.paired[ pairIndex ] );\n    },\n\n    // ........................................................................ paired - drag and drop re-ordering\n    //_dragenterPairedColumns : function( ev ){\n    //    this.debug( '_dragenterPairedColumns:', ev );\n    //},\n    //_dragleavePairedColumns : function( ev ){\n    //    //this.debug( '_dragleavePairedColumns:', ev );\n    //},\n    /** track the mouse drag over the paired list adding a placeholder to show where the drop would occur */\n    _dragoverPairedColumns : function( ev ){\n        //this.debug( '_dragoverPairedColumns:', ev );\n        ev.preventDefault();\n\n        var $list = this.$( '.paired-columns .column-datasets' );\n        this._checkForAutoscroll( $list, ev.originalEvent.clientY );\n        //this.debug( ev.originalEvent.clientX, ev.originalEvent.clientY );\n        var $nearest = this._getNearestPairedDatasetLi( ev.originalEvent.clientY );\n\n        $( '.element-drop-placeholder' ).remove();\n        var $placeholder = $( '<div class=\"element-drop-placeholder\"></div>' );\n        if( !$nearest.length ){\n            $list.append( $placeholder );\n        } else {\n            $nearest.before( $placeholder );\n        }\n    },\n\n    /** If the mouse is near enough to the list's top or bottom, scroll the list */\n    _checkForAutoscroll : function( $element, y ){\n        var AUTOSCROLL_SPEED = 2;\n        var offset = $element.offset(),\n            scrollTop = $element.scrollTop(),\n            upperDist = y - offset.top,\n            lowerDist = ( offset.top + $element.outerHeight() ) - y;\n        //this.debug( '_checkForAutoscroll:', scrollTop, upperDist, lowerDist );\n        if( upperDist >= 0 && upperDist < this.autoscrollDist ){\n            $element.scrollTop( scrollTop - AUTOSCROLL_SPEED );\n        } else if( lowerDist >= 0 && lowerDist < this.autoscrollDist ){\n            $element.scrollTop( scrollTop + AUTOSCROLL_SPEED );\n        }\n    },\n\n    /** get the nearest *previous* paired dataset PairView based on the mouse's Y coordinate.\n     *      If the y is at the end of the list, return an empty jQuery object.\n     */\n    _getNearestPairedDatasetLi : function( y ){\n        var WIGGLE = 4,\n            lis = this.$( '.paired-columns .column-datasets li' ).toArray();\n        for( var i=0; i<lis.length; i++ ){\n            var $li = $( lis[i] ),\n                top = $li.offset().top,\n                halfHeight = Math.floor( $li.outerHeight() / 2 ) + WIGGLE;\n            if( top + halfHeight > y && top - halfHeight < y ){\n                //this.debug( y, top + halfHeight, top - halfHeight )\n                return $li;\n            }\n        }\n        return $();\n    },\n    /** drop (dragged/selected PairViews) onto the list, re-ordering both the DOM and the internal array of pairs */\n    _dropPairedColumns : function( ev ){\n        // both required for firefox\n        ev.preventDefault();\n        ev.dataTransfer.dropEffect = 'move';\n\n        var $nearest = this._getNearestPairedDatasetLi( ev.originalEvent.clientY );\n        if( $nearest.length ){\n            this.$dragging.insertBefore( $nearest );\n\n        } else {\n            // no nearest before - insert after last element (unpair button)\n            this.$dragging.insertAfter( this.$( '.paired-columns .unpair-btn' ).last() );\n        }\n        // resync the creator's list of paired based on the new DOM order\n        this._syncPairsToDom();\n        return false;\n    },\n    /** resync the creator's list of paired based on the DOM order of pairs */\n    _syncPairsToDom : function(){\n        var newPaired = [];\n        //TODO: doesn't seem wise to use the dom to store these - can't we sync another way?\n        this.$( '.paired-columns .dataset.paired' ).each( function(){\n            newPaired.push( $( this ).data( 'pair' ) );\n        });\n        //this.debug( newPaired );\n        this.paired = newPaired;\n        this._renderPaired();\n    },\n    /** drag communication with pair sub-views: dragstart */\n    _pairDragstart : function( ev, pair ){\n        //this.debug( '_pairDragstart', ev, pair )\n        // auto select the pair causing the event and move all selected\n        pair.$el.addClass( 'selected' );\n        var $selected = this.$( '.paired-columns .dataset.selected' );\n        this.$dragging = $selected;\n    },\n    /** drag communication with pair sub-views: dragend - remove the placeholder */\n    _pairDragend : function( ev, pair ){\n        //this.debug( '_pairDragend', ev, pair )\n        $( '.element-drop-placeholder' ).remove();\n        this.$dragging = null;\n    },\n\n    // ........................................................................ footer\n    toggleExtensions : function( force ){\n        var creator = this;\n        creator.removeExtensions = ( force !== undefined )?( force ):( !creator.removeExtensions );\n\n        _.each( creator.paired, function( pair ){\n            // don't overwrite custom names\n            if( pair.customizedName ){ return; }\n            pair.name = creator._guessNameForPair( pair.forward, pair.reverse );\n        });\n\n        creator._renderPaired();\n        creator._renderFooter();\n    },\n\n    /** handle a collection name change */\n    _changeName : function( ev ){\n        this._validationWarning( 'name', !!this._getName() );\n    },\n\n    /** check for enter key press when in the collection name and submit */\n    _nameCheckForEnter : function( ev ){\n        if( ev.keyCode === 13 && !this.blocking ){\n            this._clickCreate();\n        }\n    },\n\n    /** get the current collection name */\n    _getName : function(){\n        return _.escape( this.$( '.collection-name' ).val() );\n    },\n\n    /** attempt to create the current collection */\n    _clickCreate : function( ev ){\n        var name = this._getName();\n        if( !name ){\n            this._validationWarning( 'name' );\n        } else if( !this.blocking ){\n            this.createList();\n        }\n    },\n\n    // ------------------------------------------------------------------------ misc\n    /** debug a dataset list */\n    _printList : function( list ){\n        var creator = this;\n        _.each( list, function( e ){\n            if( list === creator.paired ){\n                creator._printPair( e );\n            } else {\n                //creator.debug( e );\n            }\n        });\n    },\n\n    /** print a pair Object */\n    _printPair : function( pair ){\n        this.debug( pair.forward.name, pair.reverse.name, ': ->', pair.name );\n    },\n\n    /** string rep */\n    toString : function(){ return 'PairedCollectionCreator'; }\n});\n\n\n//TODO: move to require text plugin and load these as text\n//TODO: underscore currently unnecc. bc no vars are used\n//TODO: better way of localizing text-nodes in long strings\n/** underscore template fns attached to class */\nPairedCollectionCreator.templates = PairedCollectionCreator.templates || {\n\n    /** the skeleton */\n    main : _.template([\n        '<div class=\"header flex-row no-flex\"></div>',\n        '<div class=\"middle flex-row flex-row-container\"></div>',\n        '<div class=\"footer flex-row no-flex\">'\n    ].join('')),\n\n    /** the header (not including help text) */\n    header : _.template([\n        '<div class=\"main-help well clear\">',\n            '<a class=\"more-help\" href=\"javascript:void(0);\">', _l( 'More help' ), '</a>',\n            '<div class=\"help-content\">',\n                '<a class=\"less-help\" href=\"javascript:void(0);\">', _l( 'Less' ), '</a>',\n            '</div>',\n        '</div>',\n        '<div class=\"alert alert-dismissable\">',\n            '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-hidden=\"true\">&times;</button>',\n            '<span class=\"alert-message\"></span>',\n        '</div>',\n\n        '<div class=\"column-headers vertically-spaced flex-column-container\">',\n            '<div class=\"forward-column flex-column column\">',\n                '<div class=\"column-header\">',\n                    '<div class=\"column-title\">',\n                        '<span class=\"title\">', _l( 'Unpaired forward' ), '</span>',\n                        '<span class=\"title-info unpaired-info\"></span>',\n                    '</div>',\n                    '<div class=\"unpaired-filter forward-unpaired-filter pull-left\">',\n                        '<input class=\"search-query\" placeholder=\"', _l( 'Filter this list' ), '\" />',\n                    '</div>',\n                '</div>',\n            '</div>',\n            '<div class=\"paired-column flex-column no-flex column\">',\n                '<div class=\"column-header\">',\n                    '<a class=\"choose-filters-link\" href=\"javascript:void(0)\">',\n                        _l( 'Choose filters' ),\n                    '</a>',\n                    '<a class=\"clear-filters-link\" href=\"javascript:void(0);\">',\n                        _l( 'Clear filters' ),\n                    '</a><br />',\n                    '<a class=\"autopair-link\" href=\"javascript:void(0);\">',\n                        _l( 'Auto-pair' ),\n                    '</a>',\n                '</div>',\n            '</div>',\n            '<div class=\"reverse-column flex-column column\">',\n                '<div class=\"column-header\">',\n                    '<div class=\"column-title\">',\n                        '<span class=\"title\">', _l( 'Unpaired reverse' ), '</span>',\n                        '<span class=\"title-info unpaired-info\"></span>',\n                    '</div>',\n                    '<div class=\"unpaired-filter reverse-unpaired-filter pull-left\">',\n                        '<input class=\"search-query\" placeholder=\"', _l( 'Filter this list' ), '\" />',\n                    '</div>',\n                '</div>',\n            '</div>',\n        '</div>'\n    ].join('')),\n\n    /** the middle: unpaired, divider, and paired */\n    middle : _.template([\n        // contains two flex rows (rows that fill available space) and a divider btwn\n        '<div class=\"unpaired-columns flex-column-container scroll-container flex-row\">',\n            '<div class=\"forward-column flex-column column\">',\n                '<ol class=\"column-datasets\"></ol>',\n            '</div>',\n            '<div class=\"paired-column flex-column no-flex column\">',\n                '<ol class=\"column-datasets\"></ol>',\n            '</div>',\n            '<div class=\"reverse-column flex-column column\">',\n                '<ol class=\"column-datasets\"></ol>',\n            '</div>',\n        '</div>',\n        '<div class=\"flexible-partition\">',\n            '<div class=\"flexible-partition-drag\" title=\"', _l( 'Drag to change' ), '\"></div>',\n            '<div class=\"column-header\">',\n                '<div class=\"column-title paired-column-title\">',\n                    '<span class=\"title\"></span>',\n                '</div>',\n                '<a class=\"unpair-all-link\" href=\"javascript:void(0);\">',\n                    _l( 'Unpair all' ),\n                '</a>',\n            '</div>',\n        '</div>',\n        '<div class=\"paired-columns flex-column-container scroll-container flex-row\">',\n            '<ol class=\"column-datasets\"></ol>',\n        '</div>'\n    ].join('')),\n\n    /** creation and cancel controls */\n    footer : _.template([\n        '<div class=\"attributes clear\">',\n            '<div class=\"clear\">',\n                '<label class=\"remove-extensions-prompt pull-right\">',\n                    _l( 'Remove file extensions from pair names' ), '?',\n                    '<input class=\"remove-extensions pull-right\" type=\"checkbox\" />',\n                '</label>',\n            '</div>',\n            '<div class=\"clear\">',\n                '<input class=\"collection-name form-control pull-right\" ',\n                    'placeholder=\"', _l( 'Enter a name for your new list' ), '\" />',\n                '<div class=\"collection-name-prompt pull-right\">', _l( 'Name' ), ':</div>',\n            '</div>',\n        '</div>',\n\n        '<div class=\"actions clear vertically-spaced\">',\n            '<div class=\"other-options pull-left\">',\n                '<button class=\"cancel-create btn\" tabindex=\"-1\">', _l( 'Cancel' ), '</button>',\n                '<div class=\"create-other btn-group dropup\">',\n                    '<button class=\"btn btn-default dropdown-toggle\" data-toggle=\"dropdown\">',\n                          _l( 'Create a different kind of collection' ),\n                          ' <span class=\"caret\"></span>',\n                    '</button>',\n                    '<ul class=\"dropdown-menu\" role=\"menu\">',\n                          '<li><a href=\"#\">', _l( 'Create a <i>single</i> pair' ), '</a></li>',\n                          '<li><a href=\"#\">', _l( 'Create a list of <i>unpaired</i> datasets' ), '</a></li>',\n                    '</ul>',\n                '</div>',\n            '</div>',\n\n            '<div class=\"main-options pull-right\">',\n                '<button class=\"create-collection btn btn-primary\">', _l( 'Create list' ), '</button>',\n            '</div>',\n        '</div>'\n    ].join('')),\n\n    /** help content */\n    helpContent : _.template([\n        '<p>', _l([\n            'Collections of paired datasets are ordered lists of dataset pairs (often forward and reverse reads). ',\n            'These collections can be passed to tools and workflows in order to have analyses done on each member of ',\n            'the entire group. This interface allows you to create a collection, choose which datasets are paired, ',\n            'and re-order the final collection.'\n        ].join( '' )), '</p>',\n        '<p>', _l([\n            'Unpaired datasets are shown in the <i data-target=\".unpaired-columns\">unpaired section</i> ',\n            '(hover over the underlined words to highlight below). ',\n            'Paired datasets are shown in the <i data-target=\".paired-columns\">paired section</i>.',\n            '<ul>To pair datasets, you can:',\n                '<li>Click a dataset in the ',\n                    '<i data-target=\".unpaired-columns .forward-column .column-datasets,',\n                                    '.unpaired-columns .forward-column\">forward column</i> ',\n                    'to select it then click a dataset in the ',\n                    '<i data-target=\".unpaired-columns .reverse-column .column-datasets,',\n                                    '.unpaired-columns .reverse-column\">reverse column</i>.',\n                '</li>',\n                '<li>Click one of the \"Pair these datasets\" buttons in the ',\n                    '<i data-target=\".unpaired-columns .paired-column .column-datasets,',\n                                    '.unpaired-columns .paired-column\">middle column</i> ',\n                    'to pair the datasets in a particular row.',\n                '</li>',\n                '<li>Click <i data-target=\".autopair-link\">\"Auto-pair\"</i> ',\n                    'to have your datasets automatically paired based on name.',\n                '</li>',\n            '</ul>'\n        ].join( '' )), '</p>',\n        '<p>', _l([\n            '<ul>You can filter what is shown in the unpaired sections by:',\n                '<li>Entering partial dataset names in either the ',\n                    '<i data-target=\".forward-unpaired-filter input\">forward filter</i> or ',\n                    '<i data-target=\".reverse-unpaired-filter input\">reverse filter</i>.',\n                '</li>',\n                '<li>Choosing from a list of preset filters by clicking the ',\n                    '<i data-target=\".choose-filters-link\">\"Choose filters\" link</i>.',\n                '</li>',\n                '<li>Entering regular expressions to match dataset names. See: ',\n                    '<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions\"',\n                        ' target=\"_blank\">MDN\\'s JavaScript Regular Expression Tutorial</a>. ',\n                    'Note: forward slashes (\\\\) are not needed.',\n                '</li>',\n                '<li>Clearing the filters by clicking the ',\n                    '<i data-target=\".clear-filters-link\">\"Clear filters\" link</i>.',\n                '</li>',\n            '</ul>'\n        ].join( '' )), '</p>',\n        '<p>', _l([\n            'To unpair individual dataset pairs, click the ',\n                '<i data-target=\".unpair-btn\">unpair buttons ( <span class=\"fa fa-unlink\"></span> )</i>. ',\n            'Click the <i data-target=\".unpair-all-link\">\"Unpair all\" link</i> to unpair all pairs.'\n        ].join( '' )), '</p>',\n        '<p>', _l([\n            'You can include or remove the file extensions (e.g. \".fastq\") from your pair names by toggling the ',\n                '<i data-target=\".remove-extensions-prompt\">\"Remove file extensions from pair names?\"</i> control.'\n        ].join( '' )), '</p>',\n        '<p>', _l([\n            'Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ',\n            'click <i data-target=\".create-collection\">\"Create list\"</i>. ',\n            '(Note: you do not have to pair all unpaired datasets to finish.)'\n        ].join( '' )), '</p>'\n    ].join(''))\n};\n\n\n//=============================================================================\n/** a modal version of the paired collection creator */\nvar pairedCollectionCreatorModal = function _pairedCollectionCreatorModal( datasets, options ){\n\n    var deferred = jQuery.Deferred(),\n        creator;\n\n    options = _.defaults( options || {}, {\n        datasets    : datasets,\n        oncancel    : function(){\n            Galaxy.modal.hide();\n            deferred.reject( 'cancelled' );\n        },\n        oncreate    : function( creator, response ){\n            Galaxy.modal.hide();\n            deferred.resolve( response );\n        }\n    });\n\n    if( !window.Galaxy || !Galaxy.modal ){\n        throw new Error( 'Galaxy or Galaxy.modal not found' );\n    }\n\n    creator = new PairedCollectionCreator( options );\n    Galaxy.modal.show({\n        title   : 'Create a collection of paired datasets',\n        body    : creator.$el,\n        width   : '80%',\n        height  : '800px',\n        closing_events: true\n    });\n    creator.render();\n    window.creator = creator;\n\n    //TODO: remove modal header\n    return deferred;\n};\n\n\n//=============================================================================\nfunction createListOfPairsCollection( collection ){\n    var elements = collection.toJSON();\n//TODO: validate elements\n    return pairedCollectionCreatorModal( elements, {\n        historyId : collection.historyId\n    });\n}\n\n\n//=============================================================================\n    return {\n        PairedCollectionCreator : PairedCollectionCreator,\n        pairedCollectionCreatorModal : pairedCollectionCreatorModal,\n        createListOfPairsCollection : createListOfPairsCollection\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/collection/list-of-pairs-collection-creator.js\n **/","define([\n    \"mvc/collection/list-collection-creator\",\n    \"mvc/history/hdca-model\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( LIST_CREATOR, HDCA, BASE_MVC, _l ){\n\n'use strict';\n\nvar logNamespace = 'collections';\n/*==============================================================================\nTODO:\n    the paired creator doesn't really mesh with the list creator as parent\n        it may be better to make an abstract super class for both\n    composites may inherit from this (or vis-versa)\n    PairedDatasetCollectionElementView doesn't make a lot of sense\n\n==============================================================================*/\n/**  */\nvar PairedDatasetCollectionElementView = Backbone.View.extend( BASE_MVC.LoggableMixin ).extend({\n    _logNamespace : logNamespace,\n\n//TODO: use proper class (DatasetDCE or NestedDCDCE (or the union of both))\n    tagName     : 'li',\n    className   : 'collection-element',\n\n    initialize : function( attributes ){\n        this.element = attributes.element || {};\n        this.identifier = attributes.identifier;\n    },\n\n    render : function(){\n        this.$el\n            .attr( 'data-element-id', this.element.id )\n            .html( this.template({ identifier: this.identifier, element: this.element }) );\n        return this;\n    },\n\n    //TODO: lots of unused space in the element - possibly load details and display them horiz.\n    template : _.template([\n        '<span class=\"identifier\"><%- identifier %></span>',\n        '<span class=\"name\"><%- element.name %></span>',\n    ].join('')),\n\n    /** remove the DOM and any listeners */\n    destroy : function(){\n        this.off();\n        this.$el.remove();\n    },\n\n    /** string rep */\n    toString : function(){\n        return 'DatasetCollectionElementView()';\n    }\n});\n\n\n// ============================================================================\nvar _super = LIST_CREATOR.ListCollectionCreator;\n\n/** An interface for building collections.\n */\nvar PairCollectionCreator = _super.extend({\n\n    /** the class used to display individual elements */\n    elementViewClass : PairedDatasetCollectionElementView,\n    /** the class this creator will create and save */\n    collectionClass : HDCA.HistoryPairDatasetCollection,\n    className : 'pair-collection-creator collection-creator flex-row-container',\n\n    /** override to no-op */\n    _mangleDuplicateNames : function(){},\n\n    // TODO: this whole pattern sucks. There needs to be two classes of problem area:\n    //      bad inital choices and\n    //      when the user has painted his/her self into a corner during creation/use-of-the-creator\n    /** render the entire interface */\n    render : function( speed, callback ){\n        if( this.workingElements.length === 2 ){\n            return _super.prototype.render.call( this, speed, callback );\n        }\n        return this._renderInvalid( speed, callback );\n    },\n\n    // ------------------------------------------------------------------------ rendering elements\n    /** render forward/reverse */\n    _renderList : function( speed, callback ){\n        //this.debug( '-- _renderList' );\n        //precondition: there are two valid elements in workingElements\n        var creator = this,\n            $tmp = jQuery( '<div/>' ),\n            $list = creator.$list();\n\n        // lose the original views, create the new, append all at once, then call their renders\n        _.each( this.elementViews, function( view ){\n            view.destroy();\n            creator.removeElementView( view );\n        });\n        $tmp.append( creator._createForwardElementView().$el );\n        $tmp.append( creator._createReverseElementView().$el );\n        $list.empty().append( $tmp.children() );\n        _.invoke( creator.elementViews, 'render' );\n    },\n\n    /** create the forward element view */\n    _createForwardElementView : function(){\n        return this._createElementView( this.workingElements[0], { identifier: 'forward' } );\n    },\n\n    /** create the forward element view */\n    _createReverseElementView : function(){\n        return this._createElementView( this.workingElements[1], { identifier: 'reverse' } );\n    },\n\n    /** create an element view, cache in elementViews, and return */\n    _createElementView : function( element, options ){\n        var elementView = new this.elementViewClass( _.extend( options, {\n            element : element,\n        }));\n        this.elementViews.push( elementView );\n        return elementView;\n    },\n\n    /** swap the forward, reverse elements and re-render */\n    swap : function(){\n        this.workingElements = [\n            this.workingElements[1],\n            this.workingElements[0],\n        ];\n        this._renderList();\n    },\n\n    events : _.extend( _.clone( _super.prototype.events ), {\n        'click .swap' : 'swap',\n    }),\n\n    // ------------------------------------------------------------------------ templates\n    //TODO: move to require text plugin and load these as text\n    //TODO: underscore currently unnecc. bc no vars are used\n    //TODO: better way of localizing text-nodes in long strings\n    /** underscore template fns attached to class */\n    templates : _.extend( _.clone( _super.prototype.templates ), {\n        /** the middle: element list */\n        middle : _.template([\n            '<div class=\"collection-elements-controls\">',\n                '<a class=\"swap\" href=\"javascript:void(0);\" title=\"', _l( 'Swap forward and reverse datasets' ), '\">',\n                    _l( 'Swap' ),\n                '</a>',\n            '</div>',\n            '<div class=\"collection-elements scroll-container flex-row\">',\n            '</div>'\n        ].join('')),\n\n        /** help content */\n        helpContent : _.template([\n            '<p>', _l([\n                'Pair collections are permanent collections containing two datasets: one forward and one reverse. ',\n                'Often these are forward and reverse reads. The pair collections can be passed to tools and ',\n                'workflows in order to have analyses done on both datasets. This interface allows ',\n                'you to create a pair, name it, and swap which is forward and which reverse.'\n            ].join( '' )), '</p>',\n            '<ul>',\n                '<li>', _l([\n                    'Click the <i data-target=\".swap\">\"Swap\"</i> link to make your forward dataset the reverse ',\n                    'and the reverse dataset forward.'\n                ].join( '' )), '</li>',\n                '<li>', _l([\n                    'Click the <i data-target=\".cancel-create\">\"Cancel\"</i> button to exit the interface.'\n                ].join( '' )), '</li>',\n            '</ul><br />',\n            '<p>', _l([\n                'Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ',\n                'click <i data-target=\".create-collection\">\"Create list\"</i>.'\n            ].join( '' )), '</p>'\n        ].join('')),\n\n        /** a simplified page communicating what went wrong and why the user needs to reselect something else */\n        invalidInitial : _.template([\n            '<div class=\"header flex-row no-flex\">',\n                '<div class=\"alert alert-warning\" style=\"display: block\">',\n                    '<span class=\"alert-message\">',\n                        '<% if( _.size( problems ) ){ %>',\n                            _l( 'The following selections could not be included due to problems' ),\n                            '<ul><% _.each( problems, function( problem ){ %>',\n                                '<li><b><%- problem.element.name %></b>: <%- problem.text %></li>',\n                            '<% }); %></ul>',\n                        '<% } else if( _.size( elements ) === 0 ){ %>',\n                            _l( 'No datasets were selected' ), '.',\n                        '<% } else if( _.size( elements ) === 1 ){ %>',\n                            _l( 'Only one dataset was selected' ), ': <%- elements[0].name %>',\n                        '<% } else if( _.size( elements ) > 2 ){ %>',\n                            _l( 'Too many datasets were selected' ),\n                            ': <%- _.pluck( elements, \"name\" ).join( \", \") %>',\n                        '<% } %>',\n                        '<br />',\n                        _l( 'Two (and only two) elements are needed for the pair' ), '. ',\n                        _l( 'You may need to ' ),\n                        '<a class=\"cancel-create\" href=\"javascript:void(0)\">', _l( 'cancel' ), '</a> ',\n                        _l( 'and reselect new elements' ), '.',\n                    '</span>',\n                '</div>',\n            '</div>',\n            '<div class=\"footer flex-row no-flex\">',\n                '<div class=\"actions clear vertically-spaced\">',\n                    '<div class=\"other-options pull-left\">',\n                        '<button class=\"cancel-create btn\" tabindex=\"-1\">', _l( 'Cancel' ), '</button>',\n                        // _l( 'Create a different kind of collection' ),\n                    '</div>',\n                '</div>',\n            '</div>'\n        ].join('')),\n    }),\n\n    // ------------------------------------------------------------------------ misc\n    /** string rep */\n    toString : function(){ return 'PairCollectionCreator'; }\n});\n\n\n//==============================================================================\n/** List collection flavor of collectionCreatorModal. */\nvar pairCollectionCreatorModal = function _pairCollectionCreatorModal( elements, options ){\n    options = options || {};\n    options.title = _l( 'Create a collection from a pair of datasets' );\n    return LIST_CREATOR.collectionCreatorModal( elements, options, PairCollectionCreator );\n};\n\n\n//==============================================================================\n/** Use a modal to create a pair collection, then add it to the given history contents.\n *  @returns {Deferred} resolved when the collection is added to the history.\n */\nfunction createPairCollection( contents ){\n    var elements = contents.toJSON(),\n        promise = pairCollectionCreatorModal( elements, {\n            creationFn : function( elements, name ){\n                elements = [\n                    { name: \"forward\", src: \"hda\", id: elements[0].id },\n                    { name: \"reverse\", src: \"hda\", id: elements[1].id }\n                ];\n                return contents.createHDCA( elements, 'paired', name );\n            }\n        });\n    return promise;\n}\n\n//==============================================================================\n    return {\n        PairCollectionCreator       : PairCollectionCreator,\n        pairCollectionCreatorModal  : pairCollectionCreatorModal,\n        createPairCollection        : createPairCollection,\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/collection/pair-collection-creator.js\n **/","define([\n    \"mvc/ui/ui-modal\",\n    \"utils/localization\"\n], function( MODAL, _l ){\n\n'use strict';\n\n//==============================================================================\n/**\n * A dialog/modal that allows copying a user history or 'importing' from user\n * another. Generally called via historyCopyDialog below.\n * @type {Object}\n */\nvar CopyDialog = {\n\n    // language related strings/fns\n    defaultName     : _.template( \"Copy of '<%- name %>'\" ),\n    title           : _.template( _l( 'Copying history' ) + ' \"<%- name %>\"' ),\n    submitLabel     : _l( 'Copy' ),\n    errorMessage    : _l( 'History could not be copied' ),\n    progressive     : _l( 'Copying history' ),\n    activeLabel     : _l( 'Copy only the active, non-deleted datasets' ),\n    allLabel        : _l( 'Copy all datasets including deleted ones' ),\n    anonWarning     : _l( 'As an anonymous user, unless you login or register, you will lose your current history ' ) +\n                      _l( 'after copying this history. ' ),\n\n    // template for modal body\n    _template : _.template([\n        //TODO: remove inline styles\n        // show a warning message for losing current to anon users\n        '<% if( isAnon ){ %>',\n            '<div class=\"warningmessage\">',\n                '<%- anonWarning %>',\n                _l( 'You can' ),\n                ' <a href=\"/user/login\">', _l( 'login here' ), '</a> ', _l( 'or' ), ' ',\n                ' <a href=\"/user/create\">', _l( 'register here' ), '</a>.',\n            '</div>',\n        '<% } %>',\n        '<form>',\n            '<label for=\"copy-modal-title\">',\n                _l( 'Enter a title for the new history' ), ':',\n            '</label><br />',\n            // TODO: could use required here and the form validators\n            // NOTE: use unescaped here if escaped in the modal function below\n            '<input id=\"copy-modal-title\" class=\"form-control\" style=\"width: 100%\" value=\"<%= name %>\" />',\n            '<p class=\"invalid-title bg-danger\" style=\"color: red; margin: 8px 0px 8px 0px; display: none\">',\n                _l( 'Please enter a valid history title' ),\n            '</p>',\n            // if allowAll, add the option to copy deleted datasets, too\n            '<% if( allowAll ){ %>',\n                '<br />',\n                '<p>', _l( 'Choose which datasets from the original history to include:' ), '</p>',\n                // copy non-deleted is the default\n                '<input name=\"copy-what\" type=\"radio\" id=\"copy-non-deleted\" value=\"copy-non-deleted\" ',\n                    '<% if( copyWhat === \"copy-non-deleted\" ){ print( \"checked\" ); } %>/>',\n                '<label for=\"copy-non-deleted\"> <%- activeLabel %></label>',\n                '<br />',\n                '<input name=\"copy-what\" type=\"radio\" id=\"copy-all\" value=\"copy-all\" ',\n                    '<% if( copyWhat === \"copy-all\" ){ print( \"checked\" ); } %>/>',\n                '<label for=\"copy-all\"> <%- allLabel %></label>',\n            '<% } %>',\n        '</form>'\n    ].join( '' )),\n\n    // empty modal body and let the user know the copy is happening\n    _showAjaxIndicator : function _showAjaxIndicator(){\n        var indicator = '<p><span class=\"fa fa-spinner fa-spin\"></span> ' + this.progressive + '...</p>';\n        this.modal.$( '.modal-body' ).empty().append( indicator ).css({ 'margin-top': '8px' });\n    },\n\n    // (sorta) public interface - display the modal, render the form, and potentially copy the history\n    // returns a jQuery.Deferred done->history copied, fail->user cancelled\n    dialog : function _dialog( modal, history, options ){\n        options = options || {};\n\n        var dialog = this,\n            deferred = jQuery.Deferred(),\n            // TODO: getting a little byzantine here\n            defaultCopyNameFn = options.nameFn || this.defaultName,\n            defaultCopyName = defaultCopyNameFn({ name: history.get( 'name' ) }),\n            // TODO: these two might be simpler as one 3 state option (all,active,no-choice)\n            defaultCopyWhat = options.allDatasets? 'copy-all' : 'copy-non-deleted',\n            allowAll = !_.isUndefined( options.allowAll )? options.allowAll : true,\n            autoClose = !_.isUndefined( options.autoClose )? options.autoClose : true;\n\n        this.modal = modal;\n\n\n        // validate the name and copy if good\n        function checkNameAndCopy(){\n            var name = modal.$( '#copy-modal-title' ).val();\n            if( !name ){\n                modal.$( '.invalid-title' ).show();\n                return;\n            }\n            // get further settings, shut down and indicate the ajax call, then hide and resolve/reject\n            var copyAllDatasets = modal.$( 'input[name=\"copy-what\"]:checked' ).val() === 'copy-all';\n            modal.$( 'button' ).prop( 'disabled', true );\n            dialog._showAjaxIndicator();\n            history.copy( true, name, copyAllDatasets )\n                .done( function( response ){\n                    deferred.resolve( response );\n                })\n                //TODO: make this unneccessary with pub-sub error or handling via Galaxy\n                .fail( function(){\n                    alert([ dialog.errorMessage, _l( 'Please contact a Galaxy administrator' ) ].join( '. ' ));\n                    deferred.rejectWith( deferred, arguments );\n                })\n                .always( function(){\n                    if( autoClose ){ modal.hide(); }\n                });\n        }\n\n        var originalClosingCallback = options.closing_callback;\n        modal.show( _.extend( options, {\n            title   : this.title({ name: history.get( 'name' ) }),\n            body    : $( dialog._template({\n                    name        : defaultCopyName,\n                    isAnon      : Galaxy.user.isAnonymous(),\n                    allowAll    : allowAll,\n                    copyWhat    : defaultCopyWhat,\n                    activeLabel : this.activeLabel,\n                    allLabel    : this.allLabel,\n                    anonWarning : this.anonWarning,\n                })),\n            buttons : _.object([\n                    [ _l( 'Cancel' ),   function(){ modal.hide(); } ],\n                    [ this.submitLabel, checkNameAndCopy ]\n                ]),\n            height          : 'auto',\n            closing_events  : true,\n            closing_callback: function _historyCopyClose( cancelled ){\n                    if( cancelled ){\n                        deferred.reject({ cancelled : true });\n                    }\n                    if( originalClosingCallback ){\n                        originalClosingCallback( cancelled );\n                    }\n                }\n            }));\n\n        // set the default dataset copy, autofocus the title, and set up for a simple return\n        modal.$( '#copy-modal-title' ).focus().select();\n        modal.$( '#copy-modal-title' ).on( 'keydown', function( ev ){\n            if( ev.keyCode === 13 ){\n                ev.preventDefault();\n                checkNameAndCopy();\n            }\n        });\n\n        return deferred;\n    },\n};\n\n//==============================================================================\n// maintain the (slight) distinction between copy and import\n/**\n * Subclass CopyDialog to use the import language.\n */\nvar ImportDialog = _.extend( {}, CopyDialog, {\n    defaultName     : _.template( \"imported: <%- name %>\" ),\n    title           : _.template( _l( 'Importing history' ) + ' \"<%- name %>\"' ),\n    submitLabel     : _l( 'Import' ),\n    errorMessage    : _l( 'History could not be imported' ),\n    progressive     : _l( 'Importing history' ),\n    activeLabel     : _l( 'Import only the active, non-deleted datasets' ),\n    allLabel        : _l( 'Import all datasets including deleted ones' ),\n    anonWarning     : _l( 'As an anonymous user, unless you login or register, you will lose your current history ' ) +\n                      _l( 'after importing this history. ' ),\n\n});\n\n//==============================================================================\n/**\n * Main interface for both history import and history copy dialogs.\n * @param  {Backbone.Model} history     the history to copy\n * @param  {Object}         options     a hash\n * @return {jQuery.Deferred}            promise that fails on close and succeeds on copy\n *\n * options:\n *     (this object is also passed to the modal used to display the dialog and accepts modal options)\n *     {Function} nameFn    if defined, use this to build the default name shown to the user\n *                          (the fn is passed: {name: <original history's name>})\n *     {bool} useImport     if true, use the 'import' language (instead of Copy)\n *     {bool} allowAll      if true, allow the user to choose between copying all datasets and\n *                          only non-deleted datasets\n *     {String} allDatasets default initial checked radio button: 'copy-all' or 'copy-non-deleted',\n */\nvar historyCopyDialog = function( history, options ){\n    options = options || {};\n    // create our own modal if Galaxy doesn't have one (mako tab without use_panels)\n    var modal = window.parent.Galaxy.modal || new MODAL.View({});\n    return options.useImport?\n        ImportDialog.dialog( modal, history, options ):\n        CopyDialog.dialog( modal, history, options );\n};\n\n\n//==============================================================================\n    return historyCopyDialog;\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/history/copy-dialog.js\n **/","define([\n    \"mvc/dataset/dataset-li-edit\",\n    \"mvc/history/hda-li\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( DATASET_LI_EDIT, HDA_LI, BASE_MVC, _l ){\n\n'use strict';\n\n//==============================================================================\nvar _super = DATASET_LI_EDIT.DatasetListItemEdit;\n/** @class Editing view for HistoryDatasetAssociation.\n */\nvar HDAListItemEdit = _super.extend(\n/** @lends HDAListItemEdit.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    className   : _super.prototype.className + \" history-content\",\n\n    /** In this override, only get details if in the ready state, get rerunnable if in other states.\n     *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n     */\n    _fetchModelDetails : function(){\n        var view = this;\n        if( view.model.inReadyState() && !view.model.hasDetails() ){\n            return view.model.fetch({ silent: true });\n\n        // special case the need for the rerunnable and creating_job attributes\n        // needed for rendering re-run button on queued, running datasets\n        } else if( !view.model.has( 'rerunnable' ) ){\n            return view.model.fetch({ silent: true, data: {\n                // only fetch rerunnable and creating_job to keep overhead down\n                keys: [ 'rerunnable', 'creating_job' ].join(',')\n            }});\n        }\n        return jQuery.when();\n    },\n\n    /** event map */\n    events : _.extend( _.clone( _super.prototype.events ), {\n        'click .unhide-link' : function( ev ){ this.model.unhide(); return false; }\n    }),\n\n    /** string rep */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'HDAListItemEdit(' + modelString + ')';\n    }\n});\n\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nHDAListItemEdit.prototype.templates = (function(){\n//TODO: move to require text! plugin\n\n    var warnings = _.extend( {}, _super.prototype.templates.warnings, {\n        hidden : BASE_MVC.wrapTemplate([\n            '<% if( !dataset.visible ){ %>',\n                // add a link to unhide a dataset\n                '<div class=\"hidden-msg warningmessagesmall\">',\n                    _l( 'This dataset has been hidden' ),\n                    '<br /><a class=\"unhide-link\" a href=\"javascript:void(0);\">', _l( 'Unhide it' ), '</a>',\n                '</div>',\n            '<% } %>'\n        ], 'dataset' )\n    });\n\n    return _.extend( {}, _super.prototype.templates, {\n        //NOTE: *steal* the HDAListItemView titleBar\n        titleBar : HDA_LI.HDAListItemView.prototype.templates.titleBar,\n        warnings : warnings\n    });\n}());\n\n\n//==============================================================================\n    return {\n        HDAListItemEdit  : HDAListItemEdit\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/history/hda-li-edit.js\n **/","define([\n    \"mvc/history/hdca-li\",\n    \"mvc/collection/collection-view-edit\",\n    \"ui/fa-icon-button\",\n    \"utils/localization\"\n], function( HDCA_LI, DC_VIEW_EDIT, faIconButton, _l ){\n\n'use strict';\n\n//==============================================================================\nvar _super = HDCA_LI.HDCAListItemView;\n/** @class Editing view for HistoryDatasetCollectionAssociation.\n */\nvar HDCAListItemEdit = _super.extend(\n/** @lends HDCAListItemEdit.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** Override to return editable versions of the collection panels */\n    _getFoldoutPanelClass : function(){\n        switch( this.model.get( 'collection_type' ) ){\n            case 'list':\n                return DC_VIEW_EDIT.ListCollectionViewEdit;\n            case 'paired':\n                return DC_VIEW_EDIT.PairCollectionViewEdit;\n            case 'list:paired':\n                return DC_VIEW_EDIT.ListOfPairsCollectionViewEdit;\n        }\n        throw new TypeError( 'Uknown collection_type: ' + this.model.get( 'collection_type' ) );\n    },\n\n    // ......................................................................... delete\n    /** In this override, add the delete button. */\n    _renderPrimaryActions : function(){\n        this.log( this + '._renderPrimaryActions' );\n        // render the display, edit attr and delete icon-buttons\n        return _super.prototype._renderPrimaryActions.call( this )\n            .concat([\n                this._renderDeleteButton()\n            ]);\n    },\n\n    /** Render icon-button to delete this collection. */\n    _renderDeleteButton : function(){\n        var self = this,\n            deleted = this.model.get( 'deleted' );\n        return faIconButton({\n            title       : deleted? _l( 'Dataset collection is already deleted' ): _l( 'Delete' ),\n            classes     : 'delete-btn',\n            faIcon      : 'fa-times',\n            disabled    : deleted,\n            onclick     : function() {\n                // ...bler... tooltips being left behind in DOM (hover out never called on deletion)\n                self.$el.find( '.icon-btn.delete-btn' ).trigger( 'mouseout' );\n                self.model[ 'delete' ]();\n            }\n        });\n    },\n\n    // ......................................................................... misc\n    /** string rep */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'HDCAListItemEdit(' + modelString + ')';\n    }\n});\n\n//==============================================================================\n    return {\n        HDCAListItemEdit : HDCAListItemEdit\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/history/hdca-li-edit.js\n **/","define([\n    \"mvc/history/history-model\",\n    \"mvc/history/history-view-edit\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( HISTORY_MODEL, HISTORY_VIEW_EDIT, BASE_MVC, _l ){\n\n'use strict';\n\n// ============================================================================\n/** session storage for history panel preferences (and to maintain state)\n */\nvar HistoryViewPrefs = BASE_MVC.SessionStorageModel.extend(\n/** @lends HistoryViewPrefs.prototype */{\n    defaults : {\n        /** should the tags editor be shown or hidden initially? */\n        tagsEditorShown : false,\n        /** should the annotation editor be shown or hidden initially? */\n        annotationEditorShown : false,\n        ///** what is the currently focused content (dataset or collection) in the current history?\n        // *      (the history panel will highlight and scroll to the focused content view)\n        // */\n        //focusedContentId : null\n        /** Current scroll position */\n        scrollPosition : 0\n    },\n    toString : function(){\n        return 'HistoryViewPrefs(' + JSON.stringify( this.toJSON() ) + ')';\n    }\n});\n\n/** key string to store panel prefs (made accessible on class so you can access sessionStorage directly) */\nHistoryViewPrefs.storageKey = function storageKey(){\n    return ( 'history-panel' );\n};\n\n/* =============================================================================\nTODO:\n\n============================================================================= */\nvar _super = HISTORY_VIEW_EDIT.HistoryViewEdit;\n// used in root/index.mako\n/** @class View/Controller for the user's current history model as used in the history\n *      panel (current right hand panel) of the analysis page.\n *\n *  The only history panel that:\n *      will poll for updates.\n *      displays datasets in reverse hid order.\n */\nvar CurrentHistoryView = _super.extend(\n/** @lends CurrentHistoryView.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    className           : _super.prototype.className + ' current-history-panel',\n\n    emptyMsg            : _l( \"This history is empty. Click 'Get Data' on the left tool menu to start\" ),\n    noneFoundMsg        : _l( \"No matching datasets found\" ),\n\n    /**  */\n    HDCAViewClass       : _super.prototype.HDCAViewClass.extend({\n        foldoutStyle : 'drilldown'\n    }),\n\n    // ......................................................................... SET UP\n    /** Set up the view, set up storage, bind listeners to HistoryContents events */\n    initialize : function( attributes ){\n        attributes = attributes || {};\n\n        // ---- persistent preferences\n        /** maintain state / preferences over page loads */\n        this.preferences = new HistoryViewPrefs( _.extend({\n            id : HistoryViewPrefs.storageKey()\n        }, _.pick( attributes, _.keys( HistoryViewPrefs.prototype.defaults ) )));\n\n        _super.prototype.initialize.call( this, attributes );\n\n        /** sub-views that will overlay this panel (collections) */\n        this.panelStack = [];\n\n        /** id of currently focused content */\n        this.currentContentId = attributes.currentContentId || null;\n        //NOTE: purposely not sent to localstorage since panel recreation roughly lines up with a reset of this value\n    },\n\n    /** Override to cache the current scroll position with a listener */\n    _setUpListeners : function(){\n        _super.prototype._setUpListeners.call( this );\n\n        var panel = this;\n        // reset scroll position when there's a new history\n        this.on( 'new-model', function(){\n            panel.preferences.set( 'scrollPosition', 0 );\n        });\n    },\n\n    // ------------------------------------------------------------------------ loading history/item models\n    /** (re-)loads the user's current history & contents w/ details */\n    loadCurrentHistory : function( attributes ){\n        this.debug( this + '.loadCurrentHistory' );\n        // implemented as a 'fresh start' or for when there is no model (intial panel render)\n        var panel = this;\n        return this.loadHistoryWithDetails( 'current', attributes )\n            .then(function( historyData, contentsData ){\n                panel.trigger( 'current-history', panel );\n            });\n    },\n\n    /** loads a history & contents w/ details and makes them the current history */\n    switchToHistory : function( historyId, attributes ){\n        //this.info( 'switchToHistory:', historyId, attributes );\n        var panel = this,\n            historyFn = function(){\n                // make this current and get history data with one call\n                return jQuery.getJSON( Galaxy.root + 'history/set_as_current?id=' + historyId  );\n                //    method  : 'PUT'\n                //});\n            };\n        return this.loadHistoryWithDetails( historyId, attributes, historyFn )\n            .then( function( historyData, contentsData ){\n                panel.trigger( 'switched-history', panel );\n            });\n    },\n\n    /** creates a new history on the server and sets it as the user's current history */\n    createNewHistory : function( attributes ){\n        if( !Galaxy || !Galaxy.user || Galaxy.user.isAnonymous() ){\n            this.displayMessage( 'error', _l( 'You must be logged in to create histories' ) );\n            return $.when();\n        }\n        var panel = this,\n            historyFn = function(){\n                // create a new history and save: the server will return the proper JSON\n                return jQuery.getJSON( Galaxy.root + 'history/create_new_current'  );\n            };\n\n        // id undefined bc there is no historyId yet - the server will provide\n        //  (no need for details - nothing expanded in new history)\n        return this.loadHistory( undefined, attributes, historyFn )\n            .then(function( historyData, contentsData ){\n                panel.trigger( 'new-history', panel );\n            });\n    },\n\n    /** release/free/shutdown old models and set up panel for new models */\n    setModel : function( model, attributes, render ){\n        _super.prototype.setModel.call( this, model, attributes, render );\n        if( this.model ){\n            this.log( 'checking for updates' );\n            this.model.checkForUpdates();\n        }\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ history/content event listening\n    /** listening for collection events */\n    _setUpCollectionListeners : function(){\n        _super.prototype._setUpCollectionListeners.call( this );\n\n        //TODO:?? may not be needed? see history-view-edit, 369\n        // if a hidden item is created (gen. by a workflow), moves thru the updater to the ready state,\n        //  then: remove it from the collection if the panel is set to NOT show hidden datasets\n        this.listenTo( this.collection, 'state:ready', function( model, newState, oldState ){\n            if( ( !model.get( 'visible' ) )\n            &&  ( !this.storage.get( 'show_hidden' ) ) ){\n                this.removeItemView( model );\n            }\n        });\n    },\n\n    /** listening for history events */\n    _setUpModelListeners : function(){\n        _super.prototype._setUpModelListeners.call( this );\n        // ---- history\n        // re-broadcast any model change events so that listeners don't have to re-bind to each history\n        this.listenTo( this.model, 'change:nice_size change:size', function(){\n            this.trigger( 'history-size-change', this, this.model, arguments );\n        }, this );\n    },\n\n    // ------------------------------------------------------------------------ panel rendering\n    /** override to add a handler to capture the scroll position when the parent scrolls */\n    _setUpBehaviors : function( $where ){\n        $where = $where || this.$el;\n        // we need to call this in _setUpBehaviors which is called after render since the $el\n        // may not be attached to $el.parent and $scrollContainer() may not work\n        var panel = this;\n        _super.prototype._setUpBehaviors.call( panel, $where );\n\n        // cache the handler to remove and re-add so we don't pile up the handlers\n        if( !this._debouncedScrollCaptureHandler ){\n            this._debouncedScrollCaptureHandler = _.debounce( function scrollCapture(){\n                // cache the scroll position (only if visible)\n                if( panel.$el.is( ':visible' ) ){\n                    panel.preferences.set( 'scrollPosition', $( this ).scrollTop() );\n                }\n            }, 40 );\n        }\n\n        panel.$scrollContainer()\n            .off( 'scroll', this._debouncedScrollCaptureHandler )\n            .on( 'scroll', this._debouncedScrollCaptureHandler );\n        return panel;\n    },\n\n    /** In this override, handle null models and move the search input to the top */\n    _buildNewRender : function(){\n        if( !this.model ){ return $(); }\n        var $newRender = _super.prototype._buildNewRender.call( this );\n        //TODO: hacky\n        $newRender.find( '.search' ).prependTo( $newRender.find( '.controls' ) );\n        this._renderQuotaMessage( $newRender );\n        return $newRender;\n    },\n\n    /** render the message displayed when a user is over quota and can't run jobs */\n    _renderQuotaMessage : function( $whereTo ){\n        $whereTo = $whereTo || this.$el;\n        return $( this.templates.quotaMsg( {}, this ) ).prependTo( $whereTo.find( '.messages' ) );\n    },\n\n    /** In this override, add links to open data uploader or get data in the tools section */\n    _renderEmptyMessage : function( $whereTo ){\n        var panel = this,\n            $emptyMsg = panel.$emptyMessage( $whereTo ),\n            $toolMenu = $( '.toolMenuContainer' );\n\n        if( ( _.isEmpty( panel.views ) && !panel.searchFor )\n        &&  ( Galaxy && Galaxy.upload && $toolMenu.length ) ){\n            $emptyMsg.empty();\n\n            $emptyMsg.html([\n                _l( 'This history is empty' ), '. ', _l( 'You can ' ),\n                '<a class=\"uploader-link\" href=\"javascript:void(0)\">',\n                    _l( 'load your own data' ),\n                '</a>',\n                _l( ' or ' ), '<a class=\"get-data-link\" href=\"javascript:void(0)\">',\n                    _l( 'get data from an external source' ),\n                '</a>'\n            ].join('') );\n            $emptyMsg.find( '.uploader-link' ).click( function( ev ){\n                Galaxy.upload.show( ev );\n            });\n            $emptyMsg.find( '.get-data-link' ).click( function( ev ){\n                $toolMenu.parent().scrollTop( 0 );\n                $toolMenu.find( 'span:contains(\"Get Data\")' )\n                    .click();\n                    //.fadeTo( 200, 0.1, function(){\n                    //    this.debug( this )\n                    //    $( this ).fadeTo( 200, 1.0 );\n                    //});\n            });\n            return $emptyMsg.show();\n        }\n        return _super.prototype._renderEmptyMessage.call( this, $whereTo );\n    },\n\n    /** In this override, get and set current panel preferences when editor is used */\n    _renderTags : function( $where ){\n        var panel = this;\n        // render tags and show/hide based on preferences\n        _super.prototype._renderTags.call( panel, $where );\n        if( panel.preferences.get( 'tagsEditorShown' ) ){\n            panel.tagsEditor.toggle( true );\n        }\n        // store preference when shown or hidden\n        panel.listenTo( panel.tagsEditor, 'hiddenUntilActivated:shown hiddenUntilActivated:hidden',\n            function( tagsEditor ){\n                panel.preferences.set( 'tagsEditorShown', tagsEditor.hidden );\n            }\n        );\n    },\n\n    /** In this override, get and set current panel preferences when editor is used */\n    _renderAnnotation : function( $where ){\n        var panel = this;\n        // render annotation and show/hide based on preferences\n        _super.prototype._renderAnnotation.call( panel, $where );\n        if( panel.preferences.get( 'annotationEditorShown' ) ){\n            panel.annotationEditor.toggle( true );\n        }\n        // store preference when shown or hidden\n        panel.listenTo( panel.annotationEditor, 'hiddenUntilActivated:shown hiddenUntilActivated:hidden',\n            function( annotationEditor ){\n                panel.preferences.set( 'annotationEditorShown', annotationEditor.hidden );\n            }\n        );\n    },\n\n    /** Override to scroll to cached position (in prefs) after swapping */\n    _swapNewRender : function( $newRender ){\n        _super.prototype._swapNewRender.call( this, $newRender );\n        var panel = this;\n        _.delay( function(){\n            var pos = panel.preferences.get( 'scrollPosition' );\n            if( pos ){\n                panel.scrollTo( pos, 0 );\n            }\n        }, 10 );\n        //TODO: is this enough of a delay on larger histories?\n\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ sub-views\n    /** Override to add the current-content highlight class to currentContentId's view */\n    _attachItems : function( $whereTo ){\n        _super.prototype._attachItems.call( this, $whereTo );\n        var panel = this;\n        if( panel.currentContentId ){\n            panel._setCurrentContentById( panel.currentContentId );\n        }\n        return this;\n    },\n\n    /** Override to remove any drill down panels */\n    addItemView : function( model, collection, options ){\n        var view = _super.prototype.addItemView.call( this, model, collection, options );\n        if( !view ){ return view; }\n        if( this.panelStack.length ){ return this._collapseDrilldownPanel(); }\n        return view;\n    },\n\n    // ------------------------------------------------------------------------ collection sub-views\n    /** In this override, add/remove expanded/collapsed model ids to/from web storage */\n    _setUpItemViewListeners : function( view ){\n        var panel = this;\n        _super.prototype._setUpItemViewListeners.call( panel, view );\n\n        // use pub-sub to: handle drilldown expansion and collapse\n        panel.listenTo( view, 'expanded:drilldown', function( v, drilldown ){\n            this._expandDrilldownPanel( drilldown );\n        });\n        panel.listenTo( view, 'collapsed:drilldown', function( v, drilldown ){\n            this._collapseDrilldownPanel( drilldown );\n        });\n\n        // when content is manipulated, make it the current-content\n        // view.on( 'visualize', function( v, ev ){\n        //     this.setCurrentContent( v );\n        // }, this );\n\n        return this;\n    },\n\n    /** display 'current content': add a visible highlight and store the id of a content item */\n    setCurrentContent : function( view ){\n        this.$( '.history-content.current-content' ).removeClass( 'current-content' );\n        if( view ){\n            view.$el.addClass( 'current-content' );\n            this.currentContentId = view.model.id;\n        } else {\n            this.currentContentId = null;\n        }\n    },\n\n    /** find the view with the id and then call setCurrentContent on it */\n    _setCurrentContentById : function( id ){\n        var view = this.viewFromModelId( id ) || null;\n        this.setCurrentContent( view );\n    },\n\n    /** Handle drill down by hiding this panels list and controls and showing the sub-panel */\n    _expandDrilldownPanel : function( drilldown ){\n        this.panelStack.push( drilldown );\n        // hide this panel's controls and list, set the name for back navigation, and attach to the $el\n        this.$( '> .controls' ).add( this.$list() ).hide();\n        drilldown.parentName = this.model.get( 'name' );\n        this.$el.append( drilldown.render().$el );\n    },\n\n    /** Handle drilldown close by freeing the panel and re-rendering this panel */\n    _collapseDrilldownPanel : function( drilldown ){\n        this.panelStack.pop();\n//TODO: MEM: free the panel\n        this.render();\n    },\n\n    // ........................................................................ external objects/MVC\n    listenToGalaxy : function( galaxy ){\n        // TODO: MEM: questionable reference island / closure practice\n        this.listenTo( galaxy, 'galaxy_main:load', function( data ){\n            var pathToMatch = data.fullpath,\n                useToURLRegexMap = {\n                    'display'       : /datasets\\/([a-f0-9]+)\\/display/,\n                    'edit'          : /datasets\\/([a-f0-9]+)\\/edit/,\n                    'report_error'  : /dataset\\/errors\\?id=([a-f0-9]+)/,\n                    'rerun'         : /tool_runner\\/rerun\\?id=([a-f0-9]+)/,\n                    'show_params'   : /datasets\\/([a-f0-9]+)\\/show_params/,\n                    // no great way to do this here? (leave it in the dataset event handlers above?)\n                    // 'visualization' : 'visualization',\n                },\n                hdaId = null,\n                hdaUse = null;\n            _.find( useToURLRegexMap, function( regex, use ){\n                var match = pathToMatch.match( regex );\n                if( match && match.length == 2 ){\n                    hdaId = match[1];\n                    hdaUse = use;\n                    return true;\n                }\n                return false;\n            });\n            // need to type mangle to go from web route to history contents\n            hdaId = 'dataset-' + hdaId;\n            this._setCurrentContentById( hdaId );\n        });\n    },\n\n//TODO: remove quota meter from panel and remove this\n    /** add listeners to an external quota meter (mvc/user/user-quotameter.js) */\n    connectToQuotaMeter : function( quotaMeter ){\n        if( !quotaMeter ){\n            return this;\n        }\n        // show/hide the 'over quota message' in the history when the meter tells it to\n        this.listenTo( quotaMeter, 'quota:over',  this.showQuotaMessage );\n        this.listenTo( quotaMeter, 'quota:under', this.hideQuotaMessage );\n\n        // having to add this to handle re-render of hview while overquota (the above do not fire)\n        this.on( 'rendered rendered:initial', function(){\n            if( quotaMeter && quotaMeter.isOverQuota() ){\n                this.showQuotaMessage();\n            }\n        });\n        return this;\n    },\n\n//TODO: this seems more like a per user message than a history message; IOW, this doesn't belong here\n    /** Override to preserve the quota message */\n    clearMessages : function( ev ){\n        var $target = !_.isUndefined( ev )?\n            $( ev.currentTarget )\n            :this.$messages().children( '[class$=\"message\"]' );\n        $target = $target.not( '.quota-message' );\n        $target.fadeOut( this.fxSpeed, function(){\n            $( this ).remove();\n        });\n        return this;\n    },\n\n    /** Show the over quota message (which happens to be in the history panel).\n     */\n    showQuotaMessage : function(){\n        var $msg = this.$( '.quota-message' );\n        if( $msg.is( ':hidden' ) ){ $msg.slideDown( this.fxSpeed ); }\n    },\n\n//TODO: this seems more like a per user message than a history message\n    /** Hide the over quota message (which happens to be in the history panel).\n     */\n    hideQuotaMessage : function(){\n        var $msg = this.$( '.quota-message' );\n        if( !$msg.is( ':hidden' ) ){ $msg.slideUp( this.fxSpeed ); }\n    },\n\n    /** Return a string rep of the history\n     */\n    toString    : function(){\n        return 'CurrentHistoryView(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n//------------------------------------------------------------------------------ TEMPLATES\nCurrentHistoryView.prototype.templates = (function(){\n\n    var quotaMsgTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"quota-message errormessage\">',\n            _l( 'You are over your disk quota' ), '. ',\n            _l( 'Tool execution is on hold until your disk usage drops below your allocated quota' ), '.',\n        '</div>'\n    ], 'history' );\n    return _.extend( _.clone( _super.prototype.templates ), {\n        quotaMsg : quotaMsgTemplate\n    });\n\n}());\n\n\n//==============================================================================\n    return {\n        CurrentHistoryView        : CurrentHistoryView\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/history/history-view-edit-current.js\n **/","define([\n    \"mvc/history/history-view\",\n    \"mvc/history/history-contents\",\n    \"mvc/dataset/states\",\n    \"mvc/history/hda-model\",\n    \"mvc/history/hda-li-edit\",\n    \"mvc/history/hdca-li-edit\",\n    \"mvc/tag\",\n    \"mvc/annotation\",\n    \"mvc/collection/list-collection-creator\",\n    \"mvc/collection/pair-collection-creator\",\n    \"mvc/collection/list-of-pairs-collection-creator\",\n    \"ui/fa-icon-button\",\n    \"mvc/ui/popup-menu\",\n    \"utils/localization\",\n    \"ui/editable-text\",\n], function(\n    HISTORY_VIEW,\n    HISTORY_CONTENTS,\n    STATES,\n    HDA_MODEL,\n    HDA_LI_EDIT,\n    HDCA_LI_EDIT,\n    TAGS,\n    ANNOTATIONS,\n    LIST_COLLECTION_CREATOR,\n    PAIR_COLLECTION_CREATOR,\n    LIST_OF_PAIRS_COLLECTION_CREATOR,\n    faIconButton,\n    PopupMenu,\n    _l\n){\n\n'use strict';\n\n/* =============================================================================\nTODO:\n\n============================================================================= */\nvar _super = HISTORY_VIEW.HistoryView;\n// base class for history-view-edit-current and used as-is in history/view.mako\n/** @class Editable View/Controller for the history model.\n *\n *  Allows:\n *      (everything HistoryView allows)\n *      changing the name\n *      displaying and editing tags and annotations\n *      multi-selection and operations on mulitple content items\n */\nvar HistoryViewEdit = _super.extend(\n/** @lends HistoryViewEdit.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** class to use for constructing the HistoryDatasetAssociation views */\n    HDAViewClass    : HDA_LI_EDIT.HDAListItemEdit,\n    /** class to use for constructing the HistoryDatasetCollectionAssociation views */\n    HDCAViewClass   : HDCA_LI_EDIT.HDCAListItemEdit,\n\n    // ......................................................................... SET UP\n    /** Set up the view, set up storage, bind listeners to HistoryContents events\n     *  @param {Object} attributes\n     */\n    initialize : function( attributes ){\n        attributes = attributes || {};\n        _super.prototype.initialize.call( this, attributes );\n\n        // ---- set up instance vars\n        /** editor for tags - sub-view */\n        this.tagsEditor = null;\n        /** editor for annotations - sub-view */\n        this.annotationEditor = null;\n\n        /** allow user purge of dataset files? */\n        this.purgeAllowed = attributes.purgeAllowed || false;\n\n        // states/modes the panel can be in\n        /** is the panel currently showing the dataset selection controls? */\n        this.annotationEditorShown  = attributes.annotationEditorShown || false;\n        this.tagsEditorShown  = attributes.tagsEditorShown || false;\n    },\n\n    /** Override to handle history as drag-drop target */\n    _setUpListeners : function(){\n        var panel = this;\n        _super.prototype._setUpListeners.call( panel );\n\n        panel.on( 'drop', function( ev, data ){\n            panel.dataDropped( data );\n            // remove the drop target\n            panel.dropTargetOff();\n        });\n        panel.on( 'view:attached view:removed', function(){\n            panel._renderCounts();\n        });\n    },\n\n    // ------------------------------------------------------------------------ listeners\n    /** listening for collection events */\n    _setUpCollectionListeners : function(){\n        _super.prototype._setUpCollectionListeners.call( this );\n\n        this.listenTo( this.collection, {\n            'change:deleted': this._handleHdaDeletionChange,\n            'change:visible': this._handleHdaVisibleChange,\n            'change:purged' : function( model ){\n                // hafta get the new nice-size w/o the purged model\n                this.model.fetch();\n            }\n        });\n        return this;\n    },\n\n    /** listening for history and HDA events */\n    _setUpModelListeners : function(){\n        _super.prototype._setUpModelListeners.call( this );\n        this.listenTo( this.model, 'change:size', this.updateHistoryDiskSize );\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ panel rendering\n    /** In this override, add tag and annotation editors and a btn to toggle the selectors */\n    _buildNewRender : function(){\n        // create a new render using a skeleton template, render title buttons, render body, and set up events, etc.\n        var $newRender = _super.prototype._buildNewRender.call( this );\n        if( !this.model ){ return $newRender; }\n\n        if( Galaxy && Galaxy.user && Galaxy.user.id && Galaxy.user.id === this.model.get( 'user_id' ) ){\n            this._renderTags( $newRender );\n            this._renderAnnotation( $newRender );\n        }\n        return $newRender;\n    },\n\n    /** override to render counts when the items are rendered */\n    renderItems : function( $whereTo ){\n        var views = _super.prototype.renderItems.call( this, $whereTo );\n        this._renderCounts( $whereTo );\n        return views;\n    },\n\n    /** override to show counts, what's deleted/hidden, and links to toggle those */\n    _renderCounts : function( $whereTo ){\n//TODO: too complicated\n        function toggleLink( _class, text ){\n            return [ '<a class=\"', _class, '\" href=\"javascript:void(0);\">', text, '</a>' ].join( '' );\n        }\n        $whereTo = $whereTo || this.$el;\n        var deleted  = this.collection.where({ deleted: true }),\n            hidden   = this.collection.where({ visible: false }),\n            msgs = [];\n\n        if( this.views.length ){\n            msgs.push( [ this.views.length, _l( 'shown' ) ].join( ' ' ) );\n        }\n        if( deleted.length ){\n            msgs.push( ( !this.showDeleted )?\n                 ([ deleted.length, toggleLink( 'toggle-deleted-link', _l( 'deleted' ) ) ].join( ' ' ))\n                :( toggleLink( 'toggle-deleted-link', _l( 'hide deleted' ) ) )\n            );\n        }\n        if( hidden.length ){\n            msgs.push( ( !this.showHidden )?\n                 ([ hidden.length, toggleLink( 'toggle-hidden-link', _l( 'hidden' ) ) ].join( ' ' ))\n                :( toggleLink( 'toggle-hidden-link', _l( 'hide hidden' ) ) )\n            );\n        }\n        return $whereTo.find( '> .controls .subtitle' ).html( msgs.join( ', ' ) );\n    },\n\n    /** render the tags sub-view controller */\n    _renderTags : function( $where ){\n        var panel = this;\n        this.tagsEditor = new TAGS.TagsEditor({\n            model           : this.model,\n            el              : $where.find( '.controls .tags-display' ),\n            onshowFirstTime : function(){ this.render(); },\n            // show hide sub-view tag editors when this is shown/hidden\n            onshow          : function(){\n                panel.toggleHDATagEditors( true,  panel.fxSpeed );\n            },\n            onhide          : function(){\n                panel.toggleHDATagEditors( false, panel.fxSpeed );\n            },\n            $activator      : faIconButton({\n                title   : _l( 'Edit history tags' ),\n                classes : 'history-tag-btn',\n                faIcon  : 'fa-tags'\n            }).appendTo( $where.find( '.controls .actions' ) )\n        });\n    },\n    /** render the annotation sub-view controller */\n    _renderAnnotation : function( $where ){\n        var panel = this;\n        this.annotationEditor = new ANNOTATIONS.AnnotationEditor({\n            model           : this.model,\n            el              : $where.find( '.controls .annotation-display' ),\n            onshowFirstTime : function(){ this.render(); },\n            // show hide sub-view view annotation editors when this is shown/hidden\n            onshow          : function(){\n                panel.toggleHDAAnnotationEditors( true,  panel.fxSpeed );\n            },\n            onhide          : function(){\n                panel.toggleHDAAnnotationEditors( false, panel.fxSpeed );\n            },\n            $activator      : faIconButton({\n                title   : _l( 'Edit history annotation' ),\n                classes : 'history-annotate-btn',\n                faIcon  : 'fa-comment'\n            }).appendTo( $where.find( '.controls .actions' ) )\n        });\n    },\n\n    /** Set up HistoryViewEdit js/widget behaviours\n     *  In this override, make the name editable\n     */\n    _setUpBehaviors : function( $where ){\n        $where = $where || this.$el;\n        _super.prototype._setUpBehaviors.call( this, $where );\n        if( !this.model ){ return; }\n\n        // anon users shouldn't have access to any of the following\n        if( ( !Galaxy.user || Galaxy.user.isAnonymous() )\n        ||  ( Galaxy.user.id !== this.model.get( 'user_id' ) ) ){\n            return;\n        }\n\n        var panel = this,\n            nameSelector = '> .controls .name';\n        $where.find( nameSelector )\n            .attr( 'title', _l( 'Click to rename history' ) )\n            .tooltip({ placement: 'bottom' })\n            .make_text_editable({\n                on_finish: function( newName ){\n                    var previousName = panel.model.get( 'name' );\n                    if( newName && newName !== previousName ){\n                        panel.$el.find( nameSelector ).text( newName );\n                        panel.model.save({ name: newName })\n                            .fail( function(){\n                                panel.$el.find( nameSelector ).text( panel.model.previous( 'name' ) );\n                            });\n                    } else {\n                        panel.$el.find( nameSelector ).text( previousName );\n                    }\n                }\n            });\n    },\n\n    /** return a new popup menu for choosing a multi selection action\n     *  ajax calls made for multiple datasets are queued\n     */\n    multiselectActions : function(){\n        var panel = this,\n            actions = [\n                {   html: _l( 'Hide datasets' ), func: function(){\n                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype.hide;\n                        panel.getSelectedModels().ajaxQueue( action );\n                    }\n                },\n                {   html: _l( 'Unhide datasets' ), func: function(){\n                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype.unhide;\n                        panel.getSelectedModels().ajaxQueue( action );\n                    }\n                },\n                {   html: _l( 'Delete datasets' ), func: function(){\n                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype['delete'];\n                        panel.getSelectedModels().ajaxQueue( action );\n                    }\n                },\n                {   html: _l( 'Undelete datasets' ), func: function(){\n                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype.undelete;\n                        panel.getSelectedModels().ajaxQueue( action );\n                    }\n                }\n            ];\n        if( panel.purgeAllowed ){\n            actions.push({\n                html: _l( 'Permanently delete datasets' ), func: function(){\n                    if( confirm( _l( 'This will permanently remove the data in your datasets. Are you sure?' ) ) ){\n                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype.purge;\n                        panel.getSelectedModels().ajaxQueue( action );\n                    }\n                }\n            });\n        }\n        actions = actions.concat( panel._collectionActions() );\n        return actions;\n    },\n\n    /**   */\n    _collectionActions : function(){\n        var panel = this;\n        return [\n            {   html: _l( 'Build Dataset List' ), func: function() {\n                    LIST_COLLECTION_CREATOR.createListCollection( panel.getSelectedModels() )\n                        .done( function(){ panel.model.refresh() });\n                }\n            },\n            // TODO: Only show quick pair if two things selected.\n            {   html: _l( 'Build Dataset Pair' ), func: function() {\n                    PAIR_COLLECTION_CREATOR.createPairCollection( panel.getSelectedModels() )\n                        .done( function(){ panel.model.refresh() });\n                }\n            },\n            {   html: _l( 'Build List of Dataset Pairs' ), func: function() {\n                    LIST_OF_PAIRS_COLLECTION_CREATOR.createListOfPairsCollection( panel.getSelectedModels() )\n                        .done( function(){ panel.model.refresh() });\n                }\n            },\n        ];\n    },\n\n    // ------------------------------------------------------------------------ sub-views\n    // reverse HID order\n    /** Override to reverse order of views - newest contents on top */\n    _attachItems : function( $whereTo ){\n        this.$list( $whereTo ).append( this.views.reverse().map( function( view ){\n            return view.$el;\n        }));\n        return this;\n    },\n\n    /** Override to add new contents at the top */\n    _attachView : function( view ){\n        var panel = this;\n        // override to control where the view is added, how/whether it's rendered\n        panel.views.unshift( view );\n        panel.$list().prepend( view.render( 0 ).$el.hide() );\n        panel.trigger( 'view:attached', view );\n        view.$el.slideDown( panel.fxSpeed, function(){\n            panel.trigger( 'view:attached:rendered' );\n        });\n    },\n\n    /** In this override, add purgeAllowed and whether tags/annotation editors should be shown */\n    _getItemViewOptions : function( model ){\n        var options = _super.prototype._getItemViewOptions.call( this, model );\n        _.extend( options, {\n            purgeAllowed            : this.purgeAllowed,\n//TODO: not working\n            tagsEditorShown         : ( this.tagsEditor && !this.tagsEditor.hidden ),\n            annotationEditorShown   : ( this.annotationEditor && !this.annotationEditor.hidden )\n        });\n        return options;\n    },\n\n    ///** Override to alter data in drag based on multiselection */\n    //_setUpItemViewListeners : function( view ){\n    //    var panel = this;\n    //    _super.prototype._setUpItemViewListeners.call( panel, view );\n    //\n    //},\n\n    /** If this item is deleted and we're not showing deleted items, remove the view\n     *  @param {Model} the item model to check\n     */\n    _handleHdaDeletionChange : function( itemModel ){\n        if( itemModel.get( 'deleted' ) && !this.showDeleted ){\n            this.removeItemView( itemModel );\n        }\n        this._renderCounts();\n    },\n\n    /** If this item is hidden and we're not showing hidden items, remove the view\n     *  @param {Model} the item model to check\n     */\n    _handleHdaVisibleChange : function( itemModel ){\n        if( itemModel.hidden() && !this.showHidden ){\n            this.removeItemView( itemModel );\n        }\n        this._renderCounts();\n    },\n\n    /** toggle the visibility of each content's tagsEditor applying all the args sent to this function */\n    toggleHDATagEditors : function( showOrHide ){\n        var args = Array.prototype.slice.call( arguments, 1 );\n        _.each( this.views, function( view ){\n            if( view.tagsEditor ){\n                view.tagsEditor.toggle.apply( view.tagsEditor, args );\n            }\n        });\n    },\n\n    /** toggle the visibility of each content's annotationEditor applying all the args sent to this function */\n    toggleHDAAnnotationEditors : function( showOrHide ){\n        var args = Array.prototype.slice.call( arguments, 1 );\n        _.each( this.views, function( view ){\n            if( view.annotationEditor ){\n                view.annotationEditor.toggle.apply( view.annotationEditor, args );\n            }\n        });\n    },\n\n    // ------------------------------------------------------------------------ panel events\n    /** event map */\n    events : _.extend( _.clone( _super.prototype.events ), {\n        'click .show-selectors-btn'                 : 'toggleSelectors',\n        'click .toggle-deleted-link'                : function( ev ){ this.toggleShowDeleted(); },\n        'click .toggle-hidden-link'                 : function( ev ){ this.toggleShowHidden(); }\n    }),\n\n    /** Update the history size display (curr. upper right of panel).\n     */\n    updateHistoryDiskSize : function(){\n        this.$el.find( '.history-size' ).text( this.model.get( 'nice_size' ) );\n    },\n\n    // ------------------------------------------------------------------------ as drop target\n    /**  */\n    dropTargetOn : function(){\n        if( this.dropTarget ){ return this; }\n        this.dropTarget = true;\n\n        //TODO: to init\n        var dropHandlers = {\n            'dragenter' : _.bind( this.dragenter, this ),\n            'dragover'  : _.bind( this.dragover,  this ),\n            'dragleave' : _.bind( this.dragleave, this ),\n            'drop'      : _.bind( this.drop, this )\n        };\n//TODO: scroll to top\n        var $dropTarget = this._renderDropTarget();\n        this.$list().before([ this._renderDropTargetHelp(), $dropTarget ]);\n        for( var evName in dropHandlers ){\n            if( dropHandlers.hasOwnProperty( evName ) ){\n                //console.debug( evName, dropHandlers[ evName ] );\n                $dropTarget.on( evName, dropHandlers[ evName ] );\n            }\n        }\n        return this;\n    },\n\n    /**  */\n    _renderDropTarget : function(){\n        this.$( '.history-drop-target' ).remove();\n        return $( '<div/>' ).addClass( 'history-drop-target' )\n            .css({\n                'height': '64px',\n                'margin': '0px 10px 10px 10px',\n                'border': '1px dashed black',\n                'border-radius' : '3px'\n            });\n    },\n\n    /**  */\n    _renderDropTargetHelp : function(){\n        this.$( '.history-drop-target-help' ).remove();\n        return $( '<div/>' ).addClass( 'history-drop-target-help' )\n            .css({\n                'margin'        : '10px 10px 4px 10px',\n                'color'         : 'grey',\n                'font-size'     : '80%',\n                'font-style'    : 'italic'\n            })\n            .text( _l( 'Drag datasets here to copy them to the current history' ) );\n    },\n\n    /**  */\n    dropTargetOff : function(){\n        if( !this.dropTarget ){ return this; }\n        //this.log( 'dropTargetOff' );\n        this.dropTarget = false;\n        var dropTarget = this.$( '.history-drop-target' ).get(0);\n        for( var evName in this._dropHandlers ){\n            if( this._dropHandlers.hasOwnProperty( evName ) ){\n                dropTarget.off( evName, this._dropHandlers[ evName ] );\n            }\n        }\n        this.$( '.history-drop-target' ).remove();\n        this.$( '.history-drop-target-help' ).remove();\n        return this;\n    },\n    /**  */\n    dropTargetToggle : function(){\n        if( this.dropTarget ){\n            this.dropTargetOff();\n        } else {\n            this.dropTargetOn();\n        }\n        return this;\n    },\n\n    /**  */\n    dragenter : function( ev ){\n        //console.debug( 'dragenter:', this, ev );\n        ev.preventDefault();\n        ev.stopPropagation();\n        this.$( '.history-drop-target' ).css( 'border', '2px solid black' );\n    },\n    /**  */\n    dragover : function( ev ){\n        ev.preventDefault();\n        ev.stopPropagation();\n    },\n    /**  */\n    dragleave : function( ev ){\n        //console.debug( 'dragleave:', this, ev );\n        ev.preventDefault();\n        ev.stopPropagation();\n        this.$( '.history-drop-target' ).css( 'border', '1px dashed black' );\n    },\n    /**  */\n    drop : function( ev ){\n        ev.preventDefault();\n        //ev.stopPropagation();\n\n        var dataTransfer = ev.originalEvent.dataTransfer;\n        dataTransfer.dropEffect = 'move';\n\n        var panel = this,\n            data = dataTransfer.getData( \"text\" );\n        try {\n            data = JSON.parse( data );\n\n        } catch( err ){\n            this.warn( 'error parsing JSON from drop:', data );\n        }\n        this.trigger( 'droptarget:drop', ev, data, panel );\n        return false;\n    },\n\n    /**  */\n    dataDropped : function( data ){\n        var panel = this;\n        // HDA: dropping will copy it to the history\n        if( _.isObject( data ) && data.model_class === 'HistoryDatasetAssociation' && data.id ){\n            return panel.model.contents.copy( data.id );\n        }\n        return jQuery.when();\n    },\n\n    // ........................................................................ misc\n    /** Return a string rep of the history */\n    toString    : function(){\n        return 'HistoryViewEdit(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n//==============================================================================\n    return {\n        HistoryViewEdit : HistoryViewEdit\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/history/history-view-edit.js\n **/","define([\n    \"mvc/list/list-view\",\n    \"mvc/history/history-model\",\n    \"mvc/history/history-contents\",\n    \"mvc/history/hda-li\",\n    \"mvc/history/hdca-li\",\n    \"mvc/user/user-model\",\n    \"ui/fa-icon-button\",\n    \"mvc/ui/popup-menu\",\n    \"mvc/base-mvc\",\n    \"utils/localization\",\n    \"ui/search-input\"\n], function(\n    LIST_VIEW,\n    HISTORY_MODEL,\n    HISTORY_CONTENTS,\n    HDA_LI,\n    HDCA_LI,\n    USER,\n    faIconButton,\n    PopupMenu,\n    BASE_MVC,\n    _l\n){\n\n'use strict';\n\nvar logNamespace = 'history';\n\n// ============================================================================\n/** session storage for individual history preferences */\nvar HistoryPrefs = BASE_MVC.SessionStorageModel.extend(\n/** @lends HistoryPrefs.prototype */{\n//TODO:?? possibly mark as current T/F - have History.currId() (a class method) return that value\n    defaults : {\n//TODO:?? expandedIds to array?\n        expandedIds : {},\n        //TODO:?? move to user?\n        show_deleted : false,\n        show_hidden  : false\n        //TODO: add scroll position?\n    },\n    /** add an hda id to the hash of expanded hdas */\n    addExpanded : function( model ){\n        var key = 'expandedIds';\n//TODO:?? is this right anymore?\n        this.save( key, _.extend( this.get( key ), _.object([ model.id ], [ model.get( 'id' ) ]) ) );\n    },\n    /** remove an hda id from the hash of expanded hdas */\n    removeExpanded : function( model ){\n        var key = 'expandedIds';\n        this.save( key, _.omit( this.get( key ), model.id ) );\n    },\n    toString : function(){\n        return 'HistoryPrefs(' + this.id + ')';\n    }\n});\n// class lvl for access w/o instantiation\nHistoryPrefs.storageKeyPrefix = 'history:';\n\n/** key string to store each histories settings under */\nHistoryPrefs.historyStorageKey = function historyStorageKey( historyId ){\n    if( !historyId ){\n        throw new Error( 'HistoryPrefs.historyStorageKey needs valid id: ' + historyId );\n    }\n    // single point of change\n    return ( HistoryPrefs.storageKeyPrefix + historyId );\n};\n/** return the existing storage for the history with the given id (or create one if it doesn't exist) */\nHistoryPrefs.get = function get( historyId ){\n    return new HistoryPrefs({ id: HistoryPrefs.historyStorageKey( historyId ) });\n};\n/** clear all history related items in sessionStorage */\nHistoryPrefs.clearAll = function clearAll( historyId ){\n    for( var key in sessionStorage ){\n        if( key.indexOf( HistoryPrefs.storageKeyPrefix ) === 0 ){\n            sessionStorage.removeItem( key );\n        }\n    }\n};\n\n\n/* =============================================================================\nTODO:\n\n============================================================================= */\n/** @class  non-editable, read-only View/Controller for a history model.\n *  Allows:\n *      changing the loaded history\n *      displaying data, info, and download\n *      tracking history attrs: size, tags, annotations, name, etc.\n *  Does not allow:\n *      changing the name\n */\nvar _super = LIST_VIEW.ModelListPanel;\nvar HistoryView = _super.extend(\n/** @lends HistoryView.prototype */{\n    _logNamespace : logNamespace,\n\n    /** class to use for constructing the HDA views */\n    HDAViewClass        : HDA_LI.HDAListItemView,\n    /** class to use for constructing the HDCA views */\n    HDCAViewClass       : HDCA_LI.HDCAListItemView,\n    /** class to used for constructing collection of sub-view models */\n    collectionClass     : HISTORY_CONTENTS.HistoryContents,\n    /** key of attribute in model to assign to this.collection */\n    modelCollectionKey  : 'contents',\n\n    tagName             : 'div',\n    className           : _super.prototype.className + ' history-panel',\n\n    /** string to display when the collection is empty */\n    emptyMsg            : _l( 'This history is empty' ),\n    /** displayed when no items match the search terms */\n    noneFoundMsg        : _l( 'No matching datasets found' ),\n    /** string used for search placeholder */\n    searchPlaceholder   : _l( 'search datasets' ),\n\n    // ......................................................................... SET UP\n    /** Set up the view, bind listeners.\n     *  @param {Object} attributes optional settings for the panel\n     */\n    initialize : function( attributes ){\n        _super.prototype.initialize.call( this, attributes );\n        // ---- instance vars\n        // control contents/behavior based on where (and in what context) the panel is being used\n        /** where should pages from links be displayed? (default to new tab/window) */\n        this.linkTarget = attributes.linkTarget || '_blank';\n    },\n\n    /** In this override, clear the update timer on the model */\n    freeModel : function(){\n        _super.prototype.freeModel.call( this );\n        if( this.model ){\n//TODO: move to History.free()\n            this.model.clearUpdateTimeout();\n        }\n        return this;\n    },\n\n    /** create any event listeners for the panel\n     *  @fires: rendered:initial    on the first render\n     *  @fires: empty-history       when switching to a history with no contents or creating a new history\n     */\n    _setUpListeners : function(){\n        _super.prototype._setUpListeners.call( this );\n        this.on({\n            error : function( model, xhr, options, msg, details ){\n                this.errorHandler( model, xhr, options, msg, details );\n            },\n            'loading-done' : function(){\n                //TODO:?? if( this.collection.length ){\n                if( !this.views.length ){\n                    this.trigger( 'empty-history', this );\n                }\n            },\n            'views:ready view:attached view:removed' : function( view ){\n                this._renderSelectButton();\n            }\n        });\n        // this.on( 'all', function(){ console.debug( arguments ); });\n    },\n\n    // ------------------------------------------------------------------------ loading history/hda models\n    //NOTE: all the following fns replace the existing history model with a new model\n    // (in the following 'details' refers to the full set of contents api data (urls, display_apps, misc_info, etc.)\n    //  - contents w/o details will have summary data only (name, hid, deleted, visible, state, etc.))\n//TODO: too tangled...\n\n    /** loads a history & contents, getting details of any contents whose ids are stored in sessionStorage\n     *      (but does not make them the current history)\n     */\n    loadHistoryWithDetails : function( historyId, attributes, historyFn, contentsFn ){\n        this.info( 'loadHistoryWithDetails:', historyId, attributes, historyFn, contentsFn );\n        var detailIdsFn = function( historyData ){\n                // will be called to get content ids that need details from the api\n//TODO:! non-visible contents are getting details loaded... either stop loading them at all or filter ids thru isVisible\n                return _.values( HistoryPrefs.get( historyData.id ).get( 'expandedIds' ) );\n            };\n        return this.loadHistory( historyId, attributes, historyFn, contentsFn, detailIdsFn );\n    },\n\n    /** @type {Number} ms to wait after history load to fetch/decorate hdcas with element_count */\n    FETCH_COLLECTION_COUNTS_DELAY : 2000,\n\n    /** loads a history & contents (but does not make them the current history) */\n    loadHistory : function( historyId, attributes, historyFn, contentsFn, detailIdsFn ){\n        this.info( 'loadHistory:', historyId, attributes, historyFn, contentsFn, detailIdsFn );\n        var panel = this;\n        attributes = attributes || {};\n\n        panel.trigger( 'loading', panel );\n        //this.info( 'loadHistory:', historyId, attributes, historyFn, contentsFn, detailIdsFn );\n        var xhr = HISTORY_MODEL.History.getHistoryData( historyId, {\n                historyFn       : historyFn,\n                contentsFn      : contentsFn,\n                detailIdsFn     : attributes.initiallyExpanded || detailIdsFn\n            });\n\n        return panel._loadHistoryFromXHR( xhr, attributes )\n            .fail( function( xhr, where, history ){\n                // throw an error up for the error handler\n                panel.trigger( 'error', panel, xhr, attributes, _l( 'An error was encountered while ' + where ),\n                    { historyId: historyId, history: history || {} });\n            })\n            .done( function(){\n                // after the initial load, decorate with more time consuming fields (like HDCA element_counts)\n                _.delay( function(){\n                    panel.model.contents.fetchCollectionCounts();\n                }, panel.FETCH_COLLECTION_COUNTS_DELAY );\n            })\n            .always( function(){\n                // bc _hideLoadingIndicator relies on this firing\n                panel.trigger( 'loading-done', panel );\n            });\n    },\n\n    /** given an xhr that will provide both history and contents data, pass data to set model or handle xhr errors */\n    _loadHistoryFromXHR : function( xhr, attributes ){\n        var panel = this;\n        xhr\n            .then( function( historyJSON, contentsJSON ){\n                panel.JSONToModel( historyJSON, contentsJSON, attributes );\n                panel.render();\n            })\n            .fail( function( xhr, where ){\n                // render anyways - whether we get a model or not\n                panel.render();\n            });\n        return xhr;\n    },\n\n    /** convenience alias to the model. Updates the item list only (not the history) */\n    refreshContents : function( options ){\n        if( this.model ){\n            return this.model.refresh( options );\n        }\n        // may have callbacks - so return an empty promise\n        return $.when();\n    },\n\n//TODO:?? seems unneccesary\n//TODO: Maybe better in History?\n    /** create a new history model from JSON and call setModel on it */\n    JSONToModel : function( newHistoryJSON, newHdaJSON, attributes ){\n        this.log( 'JSONToModel:', newHistoryJSON, newHdaJSON, attributes );\n        attributes = attributes || {};\n        //this.log( 'JSONToModel:', newHistoryJSON, newHdaJSON.length, attributes );\n\n        var model = new HISTORY_MODEL.History( newHistoryJSON, newHdaJSON, attributes );\n//TODO:?? here?\n        this.setModel( model );\n        return model;\n    },\n\n    /** release/free/shutdown old models and set up panel for new models\n     *  @fires new-model with the panel as parameter\n     */\n    setModel : function( model, attributes ){\n        attributes = attributes || {};\n        _super.prototype.setModel.call( this, model, attributes );\n        if( this.model ){\n            this._setUpWebStorage( attributes.initiallyExpanded, attributes.show_deleted, attributes.show_hidden );\n        }\n    },\n\n    // ------------------------------------------------------------------------ browser stored prefs\n    /** Set up client side storage. Currently PersistanStorage keyed under 'history:<id>'\n     *  @param {Object} initiallyExpanded\n     *  @param {Boolean} show_deleted whether to show deleted contents (overrides stored)\n     *  @param {Boolean} show_hidden\n     *  @see PersistentStorage\n     */\n    _setUpWebStorage : function( initiallyExpanded, show_deleted, show_hidden ){\n        //if( !this.model ){ return this; }\n        //this.log( '_setUpWebStorage', initiallyExpanded, show_deleted, show_hidden );\n        if( this.storage ){\n            this.stopListening( this.storage );\n        }\n\n        this.storage = new HistoryPrefs({\n            id: HistoryPrefs.historyStorageKey( this.model.get( 'id' ) )\n        });\n\n        // expandedIds is a map of content.ids -> a boolean repr'ing whether that item's body is already expanded\n        // store any pre-expanded ids passed in\n        if( _.isObject( initiallyExpanded ) ){\n            this.storage.set( 'expandedIds', initiallyExpanded );\n        }\n\n        // get the show_deleted/hidden settings giving priority to values passed in, using web storage otherwise\n        // if the page has specifically requested show_deleted/hidden, these will be either true or false\n        //  (as opposed to undefined, null) - and we give priority to that setting\n        if( _.isBoolean( show_deleted ) ){\n            this.storage.set( 'show_deleted', show_deleted );\n        }\n        if( _.isBoolean( show_hidden ) ){\n            this.storage.set( 'show_hidden', show_hidden );\n        }\n\n        this.trigger( 'new-storage', this.storage, this );\n        this.log( this + ' (init\\'d) storage:', this.storage.get() );\n\n        this.listenTo( this.storage, {\n            'change:show_deleted' : function( view, newVal ){\n                this.showDeleted = newVal;\n            },\n            'change:show_hidden' : function( view, newVal ){\n                this.showHidden = newVal;\n            }\n        }, this );\n        this.showDeleted = ( show_deleted !== undefined )? show_deleted : this.storage.get( 'show_deleted' );\n        this.showHidden  = ( show_hidden  !== undefined )? show_hidden  : this.storage.get( 'show_hidden' );\n\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ panel rendering\n    /** In this override, add a btn to toggle the selectors */\n    _buildNewRender : function(){\n        var $newRender = _super.prototype._buildNewRender.call( this );\n        this._renderSelectButton( $newRender );\n        return $newRender;\n    },\n\n    /** button for starting select mode */\n    _renderSelectButton : function( $where ){\n        $where = $where || this.$el;\n        // do not render selector option if no actions\n        if( !this.multiselectActions().length ){\n            return null;\n        }\n        // do not render (and remove even) if nothing to select\n        if( !this.views.length ){\n            this.hideSelectors();\n            $where.find( '.controls .actions .show-selectors-btn' ).remove();\n            return null;\n        }\n        // don't bother rendering if there's one already\n        var $existing = $where.find( '.controls .actions .show-selectors-btn' );\n        if( $existing.length ){\n            return $existing;\n        }\n\n        return faIconButton({\n            title   : _l( 'Operations on multiple datasets' ),\n            classes : 'show-selectors-btn',\n            faIcon  : 'fa-check-square-o'\n        }).prependTo( $where.find( '.controls .actions' ) );\n    },\n\n    // ------------------------------------------------------------------------ sub-views\n    /** In this override, since history contents are mixed,\n     *      get the appropo view class based on history_content_type\n     */\n    _getItemViewClass : function( model ){\n        var contentType = model.get( \"history_content_type\" );\n        switch( contentType ){\n            case 'dataset':\n                return this.HDAViewClass;\n            case 'dataset_collection':\n                return this.HDCAViewClass;\n        }\n        throw new TypeError( 'Unknown history_content_type: ' + contentType );\n    },\n\n    /** in this override, check if the contents would also display based on show_deleted/hidden */\n    _filterItem : function( model ){\n        var panel = this;\n        return ( _super.prototype._filterItem.call( panel, model )\n            && ( !model.hidden() || panel.showHidden )\n            && ( !model.isDeletedOrPurged() || panel.showDeleted ) );\n    },\n\n    /** in this override, add a linktarget, and expand if id is in web storage */\n    _getItemViewOptions : function( model ){\n        var options = _super.prototype._getItemViewOptions.call( this, model );\n        return _.extend( options, {\n            linkTarget      : this.linkTarget,\n            expanded        : !!this.storage.get( 'expandedIds' )[ model.id ],\n            hasUser         : this.model.ownedByCurrUser()\n        });\n    },\n\n    /** In this override, add/remove expanded/collapsed model ids to/from web storage */\n    _setUpItemViewListeners : function( view ){\n        var panel = this;\n        _super.prototype._setUpItemViewListeners.call( panel, view );\n\n        //TODO:?? could use 'view:expanded' here?\n        // maintain a list of items whose bodies are expanded\n        panel.listenTo( view, {\n            'expanded': function( v ){\n                panel.storage.addExpanded( v.model );\n            },\n            'collapsed': function( v ){\n                panel.storage.removeExpanded( v.model );\n            }\n        });\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ selection\n    /** Override to correctly set the historyId of the new collection */\n    getSelectedModels : function(){\n        var collection = _super.prototype.getSelectedModels.call( this );\n        collection.historyId = this.collection.historyId;\n        return collection;\n    },\n\n    // ------------------------------------------------------------------------ panel events\n    /** event map */\n    events : _.extend( _.clone( _super.prototype.events ), {\n        // toggle list item selectors\n        'click .show-selectors-btn'         : 'toggleSelectors',\n        // allow (error) messages to be clicked away\n        'click .messages [class$=message]'  : 'clearMessages'\n    }),\n\n    /** Handle the user toggling the deleted visibility by:\n     *      (1) storing the new value in the persistent storage\n     *      (2) re-rendering the history\n     * @returns {Boolean} new show_deleted setting\n     */\n    toggleShowDeleted : function( show, store ){\n        show = ( show !== undefined )?( show ):( !this.showDeleted );\n        store = ( store !== undefined )?( store ):( true );\n        this.showDeleted = show;\n        if( store ){\n            this.storage.set( 'show_deleted', show );\n        }\n        //TODO:?? to events on storage('change:show_deleted')\n        this.renderItems();\n        this.trigger( 'show-deleted', show );\n        return this.showDeleted;\n    },\n\n    /** Handle the user toggling the hidden visibility by:\n     *      (1) storing the new value in the persistent storage\n     *      (2) re-rendering the history\n     * @returns {Boolean} new show_hidden setting\n     */\n    toggleShowHidden : function( show, store ){\n        show = ( show !== undefined )?( show ):( !this.showHidden );\n        store = ( store !== undefined )?( store ):( true );\n        this.showHidden = show;\n        if( store ){\n            this.storage.set( 'show_hidden', show );\n        }\n        //TODO:?? to events on storage('change:show_deleted')\n        this.renderItems();\n        this.trigger( 'show-hidden', show );\n        return this.showHidden;\n    },\n\n    /** On the first search, if there are no details - load them, then search */\n    _firstSearch : function( searchFor ){\n        var panel = this,\n            inputSelector = '.history-search-input';\n        this.log( 'onFirstSearch', searchFor );\n\n        if( panel.model.contents.haveDetails() ){\n            panel.searchItems( searchFor );\n            return;\n        }\n\n        panel.$el.find( inputSelector ).searchInput( 'toggle-loading' );\n        panel.model.contents.fetchAllDetails({ silent: true })\n            .always( function(){\n                panel.$el.find( inputSelector ).searchInput( 'toggle-loading' );\n            })\n            .done( function(){\n                panel.searchItems( panel.searchFor );\n            });\n    },\n\n//TODO: break this out\n    // ........................................................................ error handling\n    /** Event handler for errors (from the panel, the history, or the history's contents)\n     *  @param {Model or View} model    the (Backbone) source of the error\n     *  @param {XMLHTTPRequest} xhr     any ajax obj. assoc. with the error\n     *  @param {Object} options         the options map commonly used with bbone ajax\n     *  @param {String} msg             optional message passed to ease error location\n     *  @param {Object} msg             optional object containing error details\n     */\n    errorHandler : function( model, xhr, options, msg, details ){\n        this.error( model, xhr, options, msg, details );\n\n        // interrupted ajax\n        if( xhr && xhr.status === 0 && xhr.readyState === 0 ){\n            //TODO: gmail style 'retrying in Ns'\n\n        // bad gateway\n        } else if( xhr && xhr.status === 502 ){\n            //TODO: gmail style 'retrying in Ns'\n\n        // otherwise, show an error message inside the panel\n        } else {\n            // if sentry is available, attempt to get the event id\n            var parsed = this._parseErrorMessage( model, xhr, options, msg, details );\n            // it's possible to have a triggered error before the message container is rendered - wait for it to show\n            if( !this.$messages().is( ':visible' ) ){\n                this.once( 'rendered', function(){\n                    this.displayMessage( 'error', parsed.message, parsed.details );\n                });\n            } else {\n                this.displayMessage( 'error', parsed.message, parsed.details );\n            }\n        }\n    },\n\n    /** Parse an error event into an Object usable by displayMessage based on the parameters\n     *      note: see errorHandler for more info on params\n     */\n    _parseErrorMessage : function( model, xhr, options, msg, details, sentryId ){\n        //if( xhr.responseText ){\n        //    xhr.responseText = _.escape( xhr.responseText );\n        //}\n        var user = Galaxy.user,\n            // add the args (w/ some extra info) into an obj\n            parsed = {\n                message : this._bePolite( msg ),\n                details : {\n                    message : msg,\n                    raven   : ( window.Raven && _.isFunction( Raven.lastEventId) )?\n                                    ( Raven.lastEventId() ):( undefined ),\n                    agent   : navigator.userAgent,\n                    // add ajax data from Galaxy object cache\n                    url     : ( window.Galaxy )?( Galaxy.lastAjax.url ):( undefined ),\n                    data    : ( window.Galaxy )?( Galaxy.lastAjax.data ):( undefined ),\n                    options : ( xhr )?( _.omit( options, 'xhr' ) ):( options ),\n                    xhr     : xhr,\n                    source  : ( _.isFunction( model.toJSON ) )?( model.toJSON() ):( model + '' ),\n                    user    : ( user instanceof USER.User )?( user.toJSON() ):( user + '' )\n                }\n            };\n\n        // add any extra details passed in\n        _.extend( parsed.details, details || {} );\n        // fancy xhr.header parsing (--> obj)\n        if( xhr &&  _.isFunction( xhr.getAllResponseHeaders ) ){\n            var responseHeaders = xhr.getAllResponseHeaders();\n            responseHeaders = _.compact( responseHeaders.split( '\\n' ) );\n            responseHeaders = _.map( responseHeaders, function( header ){\n                return header.split( ': ' );\n            });\n            parsed.details.xhr.responseHeaders = _.object( responseHeaders );\n        }\n        return parsed;\n    },\n\n    /** Modify an error message to be fancy and wear a monocle. */\n    _bePolite : function( msg ){\n        msg = msg || _l( 'An error occurred while getting updates from the server' );\n        return msg + '. ' + _l( 'Please contact a Galaxy administrator if the problem persists' ) + '.';\n    },\n\n    // ........................................................................ (error) messages\n    /** Display a message in the top of the panel.\n     *  @param {String} type    type of message ('done', 'error', 'warning')\n     *  @param {String} msg     the message to display\n     *  @param {Object or HTML} modal contents displayed when the user clicks 'details' in the message\n     */\n    displayMessage : function( type, msg, details ){\n        //precondition: msgContainer must have been rendered even if there's no model\n        var panel = this;\n        //this.log( 'displayMessage', type, msg, details );\n\n        this.scrollToTop();\n        var $msgContainer = this.$messages(),\n            $msg = $( '<div/>' ).addClass( type + 'message' ).html( msg );\n        //this.log( '  ', $msgContainer );\n\n        if( !_.isEmpty( details ) ){\n            var $detailsLink = $( '<a href=\"javascript:void(0)\">Details</a>' )\n                .click( function(){\n                    Galaxy.modal.show( panel._messageToModalOptions( type, msg, details ) );\n                    return false;\n                });\n            $msg.append( ' ', $detailsLink );\n        }\n        return $msgContainer.append( $msg );\n    },\n\n    /** convert msg and details into modal options usable by Galaxy.modal */\n    _messageToModalOptions : function( type, msg, details ){\n        // only error is fleshed out here\n        var panel = this,\n            options = { title: 'Details' };\n        if( _.isObject( details ) ){\n\n            details = _.omit( details, _.functions( details ) );\n            var text = JSON.stringify( details, null, '  ' ),\n                pre = $( '<pre/>' ).text( text );\n            options.body = $( '<div/>' ).append( pre );\n\n        } else {\n            options.body = $( '<div/>' ).html( details );\n        }\n\n        options.buttons = {\n            'Ok': function(){\n                Galaxy.modal.hide();\n                panel.clearMessages();\n            }\n            //TODO: if( type === 'error' ){ options.buttons[ 'Report this error' ] = function(){} }\n        };\n        return options;\n    },\n\n    /** Remove all messages from the panel. */\n    clearMessages : function( ev ){\n        var $target = !_.isUndefined( ev )?\n            $( ev.currentTarget )\n            :this.$messages().children( '[class$=\"message\"]' );\n        $target.fadeOut( this.fxSpeed, function(){\n            $( this ).remove();\n        });\n        return this;\n    },\n\n    // ........................................................................ scrolling\n    /** Scrolls the panel to show the content sub-view with the given hid.\n     *  @param {Integer} hid    the hid of item to scroll into view\n     *  @returns {HistoryView} the panel\n     */\n    scrollToHid : function( hid ){\n        return this.scrollToItem( _.first( this.viewsWhereModel({ hid: hid }) ) );\n    },\n\n    // ........................................................................ misc\n    /** Return a string rep of the history */\n    toString : function(){\n        return 'HistoryView(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n//------------------------------------------------------------------------------ TEMPLATES\nHistoryView.prototype.templates = (function(){\n\n    var controlsTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"controls\">',\n            '<div class=\"title\">',\n                '<div class=\"name\"><%- history.name %></div>',\n            '</div>',\n            '<div class=\"subtitle\"></div>',\n            '<div class=\"history-size\"><%- history.nice_size %></div>',\n\n            '<div class=\"actions\"></div>',\n\n            '<div class=\"messages\">',\n                '<% if( history.deleted && history.purged ){ %>',\n                    '<div class=\"deleted-msg warningmessagesmall\">',\n                        _l( 'This history has been purged and deleted' ),\n                    '</div>',\n                '<% } else if( history.deleted ){ %>',\n                    '<div class=\"deleted-msg warningmessagesmall\">',\n                        _l( 'This history has been deleted' ),\n                    '</div>',\n                '<% } else if( history.purged ){ %>',\n                    '<div class=\"deleted-msg warningmessagesmall\">',\n                        _l( 'This history has been purged' ),\n                    '</div>',\n                '<% } %>',\n\n                '<% if( history.message ){ %>',\n                    // should already be localized\n                    '<div class=\"<%= history.message.level || \"info\" %>messagesmall\">',\n                        '<%= history.message.text %>',\n                    '</div>',\n                '<% } %>',\n            '</div>',\n\n            // add tags and annotations\n            '<div class=\"tags-display\"></div>',\n            '<div class=\"annotation-display\"></div>',\n\n            '<div class=\"search\">',\n                '<div class=\"search-input\"></div>',\n            '</div>',\n\n            '<div class=\"list-actions\">',\n                '<div class=\"btn-group\">',\n                    '<button class=\"select-all btn btn-default\"',\n                            'data-mode=\"select\">', _l( 'All' ), '</button>',\n                    '<button class=\"deselect-all btn btn-default\"',\n                            'data-mode=\"select\">', _l( 'None' ), '</button>',\n                '</div>',\n                '<div class=\"list-action-menu btn-group\">',\n                '</div>',\n            '</div>',\n        '</div>'\n    ], 'history' );\n\n    return _.extend( _.clone( _super.prototype.templates ), {\n        controls : controlsTemplate\n    });\n}());\n\n\n//==============================================================================\n    return {\n        HistoryView: HistoryView\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/history/history-view.js\n **/","define([\n    \"mvc/ui/popup-menu\",\n    \"mvc/history/copy-dialog\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( PopupMenu, historyCopyDialog, BASE_MVC, _l ){\n\n'use strict';\n\n// ============================================================================\nvar menu = [\n    {\n        html    : _l( 'History Lists' ),\n        header  : true\n    },\n    {\n        html    : _l( 'Saved Histories' ),\n        href    : 'history/list',\n    },\n    {\n        html    : _l( 'Histories Shared with Me' ),\n        href    : 'history/list_shared'\n    },\n\n    {\n        html    : _l( 'History Actions' ),\n        header  : true,\n        anon    : true\n    },\n    {\n        html    : _l( 'Create New' ),\n        func    : function() {\n            if( Galaxy && Galaxy.currHistoryPanel ){\n                Galaxy.currHistoryPanel.createNewHistory();\n            }\n        },\n    },\n    {\n        html    : _l( 'Copy History' ),\n        func    : function() {\n            historyCopyDialog( Galaxy.currHistoryPanel.model )\n                .done( function(){\n                    Galaxy.currHistoryPanel.loadCurrentHistory();\n                });\n        },\n    },\n    {\n        html    : _l( 'Share or Publish' ),\n        href    : 'history/sharing',\n    },\n    {\n        html    : _l( 'Show Structure' ),\n        href    : 'history/display_structured',\n        anon    : true,\n    },\n    {\n        html    : _l( 'Extract Workflow' ),\n        href    : 'workflow/build_from_current_history',\n    },\n    {\n        html    : _l( 'Delete' ),\n        confirm : _l( 'Really delete the current history?' ),\n        href    : 'history/delete_current',\n    },\n    {\n        html    : _l( 'Delete Permanently' ),\n        confirm : _l( 'Really delete the current history permanently? This cannot be undone.' ),\n        href    : 'history/delete_current?purge=True',\n        purge   : true,\n        anon    : true,\n    },\n\n\n    {\n        html    : _l( 'Dataset Actions' ),\n        header  : true,\n        anon    : true\n    },\n    {\n        html    : _l( 'Copy Datasets' ),\n        href    : 'dataset/copy_datasets',\n    },\n    {\n        html    : _l( 'Dataset Security' ),\n        href    : 'root/history_set_default_permissions',\n    },\n    {\n        html    : _l( 'Resume Paused Jobs' ),\n        href    : 'history/resume_paused_jobs?current=True',\n        anon    : true,\n    },\n    {\n        html    : _l( 'Collapse Expanded Datasets' ),\n        func    : function() {\n            if( Galaxy && Galaxy.currHistoryPanel ){\n                Galaxy.currHistoryPanel.collapseAll();\n            }\n        },\n    },\n    {\n        html    : _l( 'Unhide Hidden Datasets' ),\n        anon    : true,\n        func    : function() {\n            if( Galaxy && Galaxy.currHistoryPanel && confirm( _l( 'Really unhide all hidden datasets?' ) ) ){\n                var filtered = Galaxy.currHistoryPanel.model.contents.hidden();\n                //TODO: batch\n                filtered.ajaxQueue( Backbone.Model.prototype.save, { visible : true })\n                    .done( function(){\n                        Galaxy.currHistoryPanel.renderItems();\n                    })\n                    .fail( function(){\n                        alert( 'There was an error unhiding the datasets' );\n                        console.error( arguments );\n                    });\n            }\n        },\n    },\n    {\n        html    : _l( 'Delete Hidden Datasets' ),\n        anon    : true,\n        func    : function() {\n            if( Galaxy && Galaxy.currHistoryPanel && confirm( _l( 'Really delete all hidden datasets?' ) ) ){\n                var filtered = Galaxy.currHistoryPanel.model.contents.hidden();\n                //TODO: batch\n                // both delete *and* unhide them\n                filtered.ajaxQueue( Backbone.Model.prototype.save, { deleted : true, visible: true })\n                    .done( function(){\n                        Galaxy.currHistoryPanel.renderItems();\n                    })\n                    .fail( function(){\n                        alert( 'There was an error deleting the datasets' );\n                        console.error( arguments );\n                    });\n            }\n        },\n    },\n    {\n        html    : _l( 'Purge Deleted Datasets' ),\n        confirm : _l( 'Really delete all deleted datasets permanently? This cannot be undone.' ),\n        href    : 'history/purge_deleted_datasets',\n        purge   : true,\n        anon    : true,\n    },\n\n\n    {\n        html    : _l( 'Downloads' ),\n        header  : true\n    },\n    {\n        html    : _l( 'Export Tool Citations' ),\n        href    : 'history/citations',\n        anon    : true,\n    },\n    {\n        html    : _l( 'Export History to File' ),\n        href    : 'history/export_archive?preview=True',\n        anon    : true,\n    },\n\n    {\n        html    : _l( 'Other Actions' ),\n        header  : true\n    },\n    {\n        html    : _l( 'Import from File' ),\n        href    : 'history/import_archive',\n    }\n];\n\nfunction buildMenu( isAnon, purgeAllowed, urlRoot ){\n    return _.clone( menu ).filter( function( menuOption ){\n        if( isAnon && !menuOption.anon ){\n            return false;\n        }\n        if( !purgeAllowed && menuOption.purge ){\n            return false;\n        }\n\n        //TODO:?? hard-coded galaxy_main\n        if( menuOption.href ){\n            menuOption.href = urlRoot + menuOption.href;\n            menuOption.target = 'galaxy_main';\n        }\n\n        if( menuOption.confirm ){\n            menuOption.func = function(){\n                if( confirm( menuOption.confirm ) ){\n                    galaxy_main.location = menuOption.href;\n                }\n            };\n        }\n        return true;\n    });\n}\n\nvar create = function( $button, options ){\n    options = options || {};\n    var isAnon = options.anonymous === undefined? true : options.anonymous,\n        purgeAllowed = options.purgeAllowed || false,\n        menu = buildMenu( isAnon, purgeAllowed, Galaxy.root );\n    //console.debug( 'menu:', menu );\n    return new PopupMenu( $button, menu );\n};\n\n\n// ============================================================================\n    return create;\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/history/options-menu.js\n **/","// dependencies\ndefine(['utils/utils'], function(Utils) {\n\n// return\nvar View = Backbone.View.extend({\n    // defaults options\n    optionsDefault: {\n        title_new       : '',\n        operations      : null,\n        onnew           : null,\n        max             : null,\n        onchange        : null\n    },\n    \n    // initialize\n    initialize : function(options) {\n        // configure\n        this.visible    = false;\n        this.$nav       = null;\n        this.$content   = null;\n        this.first_tab  = null;\n        this.current_id = null;\n            \n        // configure options\n        this.options = Utils.merge(options, this.optionsDefault);\n        \n        // create tabs\n        var $tabs = $(this._template(this.options));\n        \n        // link elements\n        this.$nav       = $tabs.find('.tab-navigation');\n        this.$content   = $tabs.find('.tab-content');\n        \n        // create new element\n        this.setElement($tabs);\n        \n        // clear list\n        this.list = {};\n        \n        // link this\n        var self = this;\n            \n        // append operations\n        if (this.options.operations) {\n            $.each(this.options.operations, function(name, item) {\n                item.$el.prop('id', name);\n                self.$nav.find('.operations').append(item.$el);\n            });\n        }\n        \n        // add built-in add-new-tab tab\n        if (this.options.onnew) {\n            // create tab object\n            var $tab_new = $(this._template_tab_new(this.options));\n            \n            // append to navbar\n            this.$nav.append($tab_new);\n            \n            // add tooltip\n            $tab_new.tooltip({title: 'Add a new tab', placement: 'bottom', container: self.$el});\n            \n            // link click event\n            $tab_new.on('click', function(e) {\n                $tab_new.tooltip('hide');\n                self.options.onnew();\n            });\n        }\n    },\n    \n    // size\n    size: function() {\n        return _.size(this.list);\n    },\n    \n    // front\n    current: function() {\n        return this.$el.find('.tab-pane.active').attr('id');\n    },\n    \n    // append\n    add: function(options) {\n        // self\n        var self = this;\n            \n        // get tab id\n        var id = options.id;\n\n        // create tab object\n        var $tab_title      = $(this._template_tab(options));\n        var $tab_content    = $(this._template_tab_content(options));\n        \n        // add to list\n        this.list[id] = options.ondel ? true : false;\n            \n        // add a new tab either before the add-new-tab tab or behind the last tab\n        if (this.options.onnew) {\n            this.$nav.find('#new-tab').before($tab_title);\n        } else {\n            this.$nav.append($tab_title);\n        }\n        \n        // add content\n        $tab_content.append(options.$el);\n        this.$content.append($tab_content);\n        \n        // activate this tab if this is the first tab\n        if (this.size() == 1) {\n            $tab_title.addClass('active');\n            $tab_content.addClass('active');\n            this.first_tab = id;\n        }\n        \n        // hide add tab\n        if (this.options.max && this.size() >= this.options.max) {\n            this.$el.find('#new-tab').hide();\n        }\n        \n        // add click event to remove tab\n        if (options.ondel) {\n            var $del_icon = $tab_title.find('#delete');\n            $del_icon.tooltip({title: 'Delete this tab', placement: 'bottom', container: self.$el});\n            $del_icon.on('click', function() {\n                $del_icon.tooltip('destroy');\n                self.$el.find('.tooltip').remove();\n                options.ondel();\n                return false;\n            });\n        }\n        \n        // add custom click event handler\n        $tab_title.on('click', function(e) {\n            // prevent default\n            e.preventDefault();\n            \n            // click\n            if (options.onclick) {\n                options.onclick();\n            } else {\n                self.show(id);\n            }\n        });\n        \n        // initialize current id\n        if (!this.current_id) {\n            this.current_id = id;\n        }\n    },\n    \n    // delete tab\n    del: function(id) {\n        // delete tab from dom\n        this.$el.find('#tab-' + id).remove();\n        this.$el.find('#' + id).remove();\n        \n        // check if first tab has been deleted\n        if (this.first_tab == id) {\n            this.first_tab = null;\n        }\n        \n        // show first tab\n        if (this.first_tab != null) {\n            this.show(this.first_tab);\n        }\n        \n        // delete from list\n        if (this.list[id]) {\n            delete this.list[id];\n        }\n        \n        // show add tab\n        if (this.size() < this.options.max) {\n            this.$el.find('#new-tab').show();\n        }\n    },\n    \n    // delete tab\n    delRemovable: function() {\n        for (var id in this.list) {\n            this.del(id);\n        }\n    },\n    \n    // show\n    show: function(id){\n        // show tab view\n        this.$el.fadeIn('fast');\n        this.visible = true;\n        \n        // show selected tab\n        if (id) {\n            // reassign active class\n            this.$el.find('#tab-' + this.current_id).removeClass('active');\n            this.$el.find('#' + this.current_id).removeClass('active');\n            this.$el.find('#tab-' + id).addClass('active');\n            this.$el.find('#' + id).addClass('active');\n            \n            // update current id\n            this.current_id = id;\n        }\n        \n        // change\n        if (this.options.onchange) {\n            this.options.onchange(id);\n        }\n    },\n    \n    // hide\n    hide: function(){\n        this.$el.fadeOut('fast');\n        this.visible = false;\n    },\n\n    // hide operation\n    hideOperation: function(id) {\n        this.$nav.find('#' + id).hide();\n    },\n\n    // show operation\n    showOperation: function(id) {\n        this.$nav.find('#' + id).show();\n    },\n    \n    // set operation\n    setOperation: function(id, callback) {\n        var $el = this.$nav.find('#' + id);\n        $el.off('click');\n        $el.on('click', callback);\n    },\n    \n    // title\n    title: function(id, new_title) {\n        var $el = this.$el.find('#tab-title-text-' + id);\n        if (new_title) {\n            $el.html(new_title);\n        }\n        return $el.html();\n    },\n    \n    // retitle\n    retitle: function(new_title) {\n        var index = 0;\n        for (var id in this.list) {\n            this.title(id, ++index + ': ' + new_title);\n        }\n    },\n    \n    // fill template\n    _template: function(options) {\n        return  '<div class=\"ui-tabs tabbable tabs-left\">' +\n                    '<ul id=\"tab-navigation\" class=\"tab-navigation nav nav-tabs\">' +\n                        '<div class=\"operations\" style=\"float: right; margin-bottom: 4px;\"></div>' +\n                    '</ul>'+\n                    '<div id=\"tab-content\" class=\"tab-content\"/>' +\n                '</div>';\n    },\n    \n    // fill template tab\n    _template_tab_new: function(options) {\n        return  '<li id=\"new-tab\">' +\n                    '<a href=\"javascript:void(0);\">' +\n                        '<i class=\"ui-tabs-add fa fa-plus-circle\"/>' +\n                            options.title_new +\n                    '</a>' +\n                '</li>';\n    },\n    \n    // fill template tab\n    _template_tab: function(options) {\n        var tmpl =  '<li id=\"tab-' + options.id + '\" class=\"tab-element\">' +\n                        '<a id=\"tab-title-link-' + options.id + '\" title=\"\" href=\"#' + options.id + '\" data-original-title=\"\">' +\n                            '<span id=\"tab-title-text-' + options.id + '\" class=\"tab-title-text\">' + options.title + '</span>';\n        \n        if (options.ondel) {\n            tmpl +=         '<i id=\"delete\" class=\"ui-tabs-delete fa fa-minus-circle\"/>';\n        }\n        \n        tmpl +=         '</a>' +\n                    '</li>';\n        \n        return tmpl;\n    },\n    \n    // fill template tab content\n    _template_tab_content: function(options) {\n        return  '<div id=\"' + options.id + '\" class=\"tab-pane\"/>';\n    }\n});\n\nreturn {\n    View : View\n}\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/ui-tabs.js\n **/","// dependencies\ndefine(['utils/utils',\n        'mvc/upload/upload-settings',\n        'mvc/upload/upload-ftp',\n        'mvc/ui/ui-popover',\n        'mvc/ui/ui-misc',\n        'mvc/ui/ui-select',\n        'utils/uploadbox'],\n\n        function(   Utils,\n                    UploadSettings,\n                    UploadFtp,\n                    Popover,\n                    Ui,\n                    Select\n                ) {\n\n// renders the composite upload row view\nreturn Backbone.View.extend({\n    // states\n    status_classes : {\n        init    : 'upload-mode fa fa-exclamation text-primary',\n        ready   : 'upload-mode fa fa-check text-success',\n        running : 'upload-mode fa fa-spinner fa-spin',\n        success : 'upload-mode fa fa-check',\n        error   : 'upload-mode fa fa-exclamation-triangle'\n    },\n\n    // initialize\n    initialize: function(app, options) {\n        // link app\n        this.app = app;\n\n        // link this\n        var self = this;\n\n        // create model\n        this.model = options.model;\n\n        // add upload row\n        this.setElement(this._template(options.model));\n\n        // build upload functions\n        this.uploadinput = this.$el.uploadinput({\n            ondragover: function() {\n                if (self.model.get('enabled')) {\n                    self.$el.addClass('warning');\n                }\n            },\n            ondragleave: function() {\n                self.$el.removeClass('warning');\n            },\n            onchange: function(files) {\n                if (self.model.get('status') != 'running' && files && files.length > 0) {\n                    self.model.reset({\n                        'file_data': files[0],\n                        'file_name': files[0].name,\n                        'file_size': files[0].size,\n                        'file_mode': files[0].mode || 'local'\n                    });\n                    self._refreshReady();\n                }\n            }\n        });\n\n        // source selection popup\n        this.button_menu = new Ui.ButtonMenu({\n            icon        : 'fa-caret-down',\n            title       : 'Select',\n            pull        : 'left'\n        });\n        this.$('#source').append(this.button_menu.$el);\n        this.button_menu.addMenu({\n            icon        : 'fa-laptop',\n            title       : 'Choose local file',\n            onclick     : function() {\n                self.uploadinput.dialog();\n            }\n        });\n        if (this.app.ftp_upload_site) {\n            this.button_menu.addMenu({\n                icon        : 'fa-folder-open-o',\n                title       : 'Choose FTP file',\n                onclick     : function() {\n                    self._showFtp();\n                }\n            });\n        }\n        this.button_menu.addMenu({\n            icon        : 'fa-edit',\n            title       : 'Paste/Fetch data',\n            onclick     : function() {\n                self.model.reset({\n                    'file_mode': 'new',\n                    'file_name': 'New File'\n                });\n            }\n        });\n\n        // add ftp file viewer\n        this.ftp = new Popover.View({\n            title       : 'Choose FTP file:',\n            container   : this.$('#source').find('.ui-button-menu'),\n            placement   : 'right'\n        });\n\n        // append popup to settings icon\n        this.settings = new Popover.View({\n            title       : 'Upload configuration',\n            container   : this.$('#settings'),\n            placement   : 'bottom'\n        });\n\n        //\n        // ui events\n        //\n\n        // handle text editing event\n        this.$('#text-content').on('change input', function(e) {\n            self.model.set('url_paste', $(e.target).val());\n            self.model.set('file_size', $(e.target).val().length);\n            self._refreshReady();\n        });\n\n        // handle settings popover\n        this.$('#settings').on('click' , function(e) { self._showSettings(); })\n                           .on('mousedown', function(e) { e.preventDefault(); });\n\n        //\n        // model events\n        //\n        this.model.on('change:percentage', function() {\n            self._refreshPercentage();\n        });\n        this.model.on('change:status', function() {\n            self._refreshStatus();\n        });\n        this.model.on('change:info', function() {\n            self._refreshInfo();\n        });\n        this.model.on('change:file_name', function() {\n            self._refreshFileName();\n        });\n        this.model.on('change:file_mode', function() {\n            self._refreshMode();\n        });\n        this.model.on('change:file_size', function() {\n            self._refreshFileSize();\n        });\n        this.model.on('remove', function() {\n            self.remove();\n        });\n        this.app.collection.on('reset', function() {\n            self.remove();\n        });\n    },\n\n    // render\n    render: function() {\n        this.$('#file_name').html(this.model.get('file_name') || '-');\n        this.$('#file_desc').html(this.model.get('file_desc') || 'Unavailable');\n        this.$('#file_size').html(Utils.bytesToString (this.model.get('file_size')));\n        this.$('#status').removeClass().addClass(this.status_classes.init);\n    },\n\n    // remove\n    remove: function() {\n        // call the base class remove method\n        Backbone.View.prototype.remove.apply(this);\n    },\n\n    //\n    // handle model events\n    //\n\n    // refresh ready or not states\n    _refreshReady: function() {\n        this.app.collection.each(function(model) {\n            model.set('status', (model.get('file_size') > 0) && 'ready' || 'init');\n        });\n    },\n\n    // refresh mode and e.g. show/hide textarea field\n    _refreshMode: function() {\n        var file_mode = this.model.get('file_mode');\n        if (file_mode == 'new') {\n            this.height = this.$el.height();\n            this.$('#text').css({\n                'width' : this.$el.width() - 16 + 'px',\n                'top'   : this.$el.height() - 8 + 'px'\n            }).show();\n            this.$el.height(this.$el.height() - 8 + this.$('#text').height() + 16);\n            this.$('#text-content').val('').trigger('keyup');\n        } else {\n            this.$el.height(this.height);\n            this.$('#text').hide();\n        }\n    },\n\n    // information\n    _refreshInfo: function() {\n        var info = this.model.get('info');\n        if (info) {\n            this.$('#info-text').html('<strong>Failed: </strong>' + info).show();\n        } else {\n            this.$('#info-text').hide();\n        }\n    },\n\n    // percentage\n    _refreshPercentage : function() {\n        var percentage = parseInt(this.model.get('percentage'));\n        if (percentage != 0) {\n            this.$('.progress-bar').css({ width : percentage + '%' });\n        } else {\n            this.$('.progress-bar').addClass('no-transition');\n            this.$('.progress-bar').css({ width : '0%' });\n            this.$('.progress-bar')[0].offsetHeight;\n            this.$('.progress-bar').removeClass('no-transition');\n        }\n        if (percentage != 100) {\n            this.$('#percentage').html(percentage + '%');\n        } else {\n            this.$('#percentage').html('Adding to history...');\n        }\n    },\n\n    // status\n    _refreshStatus : function() {\n        // identify new status\n        var status = this.model.get('status');\n\n        // identify symbol and reset classes\n        this.$('#status').removeClass().addClass(this.status_classes[status]);\n\n        // enable/disable model flag\n        this.model.set('enabled', status != 'running');\n\n        // enable/disable row fields\n        this.$('#text-content').attr('disabled', !this.model.get('enabled'));\n\n        // remove status classes\n        this.$el.removeClass('success danger warning');\n\n        // set status classes\n        if (status == 'running' || status == 'ready') {\n            this.model.set('percentage', 0);\n        }\n        if (status == 'running') {\n            this.$('#source').find('.button').addClass('disabled');\n        } else {\n            this.$('#source').find('.button').removeClass('disabled');\n        }\n        if (status == 'success') {\n            this.$el.addClass('success');\n            this.model.set('percentage', 100);\n            this.$('#percentage').html('100%');\n        }\n        if (status == 'error') {\n            this.$el.addClass('danger');\n            this.model.set('percentage', 0);\n            this.$('#info-progress').hide();\n            this.$('#info-text').show();\n        } else {\n            this.$('#info-progress').show();\n            this.$('#info-text').hide();\n        }\n    },\n\n    // file name\n    _refreshFileName: function() {\n        this.$('#file_name').html(this.model.get('file_name') || '-');\n    },\n\n    // file size\n    _refreshFileSize: function() {\n        this.$('#file_size').html(Utils.bytesToString (this.model.get('file_size')));\n    },\n\n    // show/hide ftp popup\n    _showFtp: function() {\n        if (!this.ftp.visible) {\n            this.ftp.empty();\n            var self = this;\n            this.ftp.append((new UploadFtp({\n                ftp_upload_site: this.app.ftp_upload_site,\n                onchange: function(ftp_file) {\n                    self.ftp.hide();\n                    if (self.model.get('status') != 'running' && ftp_file) {\n                        self.model.reset({\n                            'file_mode': 'ftp',\n                            'file_name': ftp_file.path,\n                            'file_size': ftp_file.size,\n                            'file_path': ftp_file.path\n                        });\n                        self._refreshReady();\n                    }\n                }\n            })).$el);\n            this.ftp.show();\n        } else {\n            this.ftp.hide();\n        }\n    },\n\n    // show/hide settings popup\n    _showSettings : function() {\n        if (!this.settings.visible) {\n            this.settings.empty();\n            this.settings.append((new UploadSettings(this)).$el);\n            this.settings.show();\n        } else {\n            this.settings.hide();\n        }\n    },\n\n    // template\n    _template: function(options) {\n        return  '<tr id=\"upload-row-' + options.id + '\" class=\"upload-row\">' +\n                    '<td>' +\n                        '<div id=\"source\"/>' +\n                        '<div class=\"upload-text-column\">' +\n                            '<div id=\"text\" class=\"text\">' +\n                                '<div class=\"text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div>' +\n                                '<textarea id=\"text-content\" class=\"text-content form-control\"/>' +\n                            '</div>' +\n                        '</div>' +\n                    '</td>' +\n                    '<td>' +\n                        '<div id=\"status\"/>' +\n                    '</td>' +\n                    '<td>' +\n                        '<div id=\"file_desc\" class=\"upload-title\"/>' +\n                    '</td>' +\n                    '<td>' +\n                        '<div id=\"file_name\" class=\"upload-title\"/>' +\n                    '</td>' +\n                    '<td>' +\n                        '<div id=\"file_size\" class=\"upload-size\"/>' +\n                    '</td>' +\n                    '<td><div id=\"settings\" class=\"upload-icon-button fa fa-gear\"/></td>' +\n                    '<td>' +\n                        '<div id=\"info\" class=\"upload-info\">' +\n                            '<div id=\"info-text\"/>' +\n                            '<div id=\"info-progress\" class=\"progress\">' +\n                                '<div class=\"progress-bar progress-bar-success\"/>' +\n                                '<div id=\"percentage\" class=\"percentage\">0%</div>' +\n                            '</div>' +\n                        '</div>' +\n                    '</td>' +\n                '</tr>';\n    }\n});\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/upload/composite/composite-row.js\n **/","/** Renders contents of the composite uploader */\ndefine(['utils/utils',\n        'mvc/upload/upload-model',\n        'mvc/upload/composite/composite-row',\n        'mvc/ui/ui-popover',\n        'mvc/ui/ui-select',\n        'mvc/ui/ui-misc'],\n\n        function(   Utils,\n                    UploadModel,\n                    UploadRow,\n                    Popover,\n                    Select,\n                    Ui\n                ) {\n\nreturn Backbone.View.extend({\n    // extension selector\n    select_extension: null,\n\n    // genome selector\n    select_genome: null,\n\n    // collection\n    collection: new UploadModel.Collection(),\n\n    // initialize\n    initialize: function(app) {\n        // link app\n        this.app                = app;\n        this.options            = app.options;\n        this.list_extensions    = app.list_extensions;\n        this.list_genomes       = app.list_genomes;\n        this.ftp_upload_site    = app.currentFtp();\n\n        // link this\n        var self = this;\n\n        // set element\n        this.setElement(this._template());\n\n        // create button section\n        this.btnStart = new Ui.Button({ title: 'Start', onclick: function() { self._eventStart(); } });\n        this.btnClose = new Ui.Button({ title: 'Close', onclick: function() { self.app.modal.hide(); } });\n\n        // append buttons to dom\n        var buttons = [ this.btnStart, this.btnClose ];\n        for (var i in buttons) {\n            this.$('#upload-buttons').prepend(buttons[i].$el);\n        }\n\n        // select extension\n        this.select_extension = new Select.View({\n            css         : 'footer-selection',\n            container   : this.$('#footer-extension'),\n            data        : _.filter(this.list_extensions, function(ext) { return ext.composite_files }),\n            onchange    : function(extension) {\n                self.collection.reset();\n                var details = _.findWhere(self.list_extensions, { id : extension });\n                if (details && details.composite_files) {\n                    for (var i in details.composite_files) {\n                        var item = details.composite_files[i];\n                        self.collection.add({\n                            id          : self.collection.size(),\n                            file_desc   : item['description'] || item['name']\n                        });\n                    }\n                }\n            }\n        });\n\n        // handle extension info popover\n        this.$('#footer-extension-info').on('click', function(e) {\n            self._showExtensionInfo({\n                $el         : $(e.target),\n                title       : self.select_extension.text(),\n                extension   : self.select_extension.value(),\n                placement   : 'top'\n            });\n        }).on('mousedown', function(e) { e.preventDefault(); });\n\n        // genome extension\n        this.select_genome = new Select.View({\n            css         : 'footer-selection',\n            container   : this.$('#footer-genome'),\n            data        : this.list_genomes,\n            value       : this.options.default_genome\n        });\n\n        // listener for collection triggers on change in composite datatype\n        this.collection.on('add', function (model) {\n            self._eventAnnounce(model);\n        });\n        this.collection.on('change add', function() {\n            self._updateScreen();\n        }).trigger('change');\n\n        // trigger initial onchange event\n        this.select_extension.options.onchange(this.select_extension.value());\n    },\n\n    //\n    // upload events / process pipeline\n    //\n\n    // builds the basic ui with placeholder rows for each composite data type file\n    _eventAnnounce: function(model) {\n        // create view/model\n        var upload_row = new UploadRow(this, { model : model });\n\n        // add upload row element to table\n        this.$('#upload-table > tbody:first').append(upload_row.$el);\n\n        // render\n        upload_row.render();\n\n        // table visibility\n        if (this.collection.length > 0) {\n            this.$('#upload-table').show();\n        } else {\n            this.$('#upload-table').hide();\n        }\n    },\n\n    // start upload process\n    _eventStart: function() {\n        var self = this;\n        this.collection.each(function(model) {\n            model.set('genome', self.select_genome.value());\n            model.set('extension', self.select_extension.value());\n        });\n        $.uploadpost({\n            url      : this.app.options.nginx_upload_path,\n            data     : this.app.toData(this.collection.filter()),\n            success  : function(message) { self._eventSuccess(message); },\n            error    : function(message) { self._eventError(message); },\n            progress : function(percentage) { self._eventProgress(percentage); }\n        });\n    },\n\n    // progress\n    _eventProgress: function(percentage) {\n        this.collection.each(function(it) { it.set('percentage', percentage); });\n    },\n\n    // success\n    _eventSuccess: function(message) {\n        this.collection.each(function(it) {\n            it.set('status', 'success');\n        });\n        Galaxy.currHistoryPanel.refreshContents();\n    },\n\n    // error\n    _eventError: function(message) {\n        this.collection.each(function(it) {\n            it.set('status', 'error');\n            it.set('info', message);\n        });\n    },\n\n    // display extension info popup\n    _showExtensionInfo: function(options) {\n        // initialize\n        var self = this;\n        var $el = options.$el;\n        var extension = options.extension;\n        var title = options.title;\n        var description = _.findWhere(this.list_extensions, { id : extension });\n\n        // create popup\n        this.extension_popup && this.extension_popup.remove();\n        this.extension_popup = new Popover.View({\n            placement: options.placement || 'bottom',\n            container: $el,\n            destroy: true\n        });\n\n        // add content and show popup\n        this.extension_popup.title(title);\n        this.extension_popup.empty();\n        this.extension_popup.append(this._templateDescription(description));\n        this.extension_popup.show();\n    },\n\n    // set screen\n    _updateScreen: function () {\n        // show start button if components have been selected\n        var model = this.collection.first();\n        if (model && model.get('status') == 'running') {\n            this.select_genome.disable();\n            this.select_extension.disable();\n        } else {\n            this.select_genome.enable();\n            this.select_extension.enable();\n        }\n        if (this.collection.where({ status : 'ready' }).length == this.collection.length && this.collection.length > 0) {\n            this.btnStart.enable();\n            this.btnStart.$el.addClass('btn-primary');\n        } else {\n            this.btnStart.disable();\n            this.btnStart.$el.removeClass('btn-primary');\n        }\n\n        // table visibility\n        if (this.collection.length > 0) {\n            this.$('#upload-table').show();\n        } else {\n            this.$('#upload-table').hide();\n        }\n    },\n\n    // template for extensions description\n    _templateDescription: function(options) {\n        if (options.description) {\n            var tmpl = options.description;\n            if (options.description_url) {\n                tmpl += '&nbsp;(<a href=\"' + options.description_url + '\" target=\"_blank\">read more</a>)';\n            }\n            return tmpl;\n        } else {\n            return 'There is no description available for this file extension.';\n        }\n    },\n\n    // load html template\n    _template: function() {\n        return  '<div class=\"upload-view-composite\">' +\n                    '<div id=\"upload-footer\" class=\"upload-footer\">' +\n                        '<span class=\"footer-title\">Composite Type:</span>' +\n                        '<span id=\"footer-extension\"/>' +\n                        '<span id=\"footer-extension-info\" class=\"upload-icon-button fa fa-search\"/> ' +\n                        '<span class=\"footer-title\">Genome/Build:</span>' +\n                        '<span id=\"footer-genome\"/>' +\n                    '</div>' +\n                    '<div id=\"upload-box\" class=\"upload-box\">' +\n                        '<table id=\"upload-table\" class=\"ui-table-striped\" style=\"display: none;\">' +\n                            '<thead>' +\n                                '<tr>' +\n                                    '<th/>' +\n                                    '<th/>' +\n                                    '<th>Description</th>' +\n                                    '<th>Name</th>' +\n                                    '<th>Size</th>' +\n                                    '<th>Settings</th>' +\n                                    '<th>Status</th>' +\n                                '</tr>' +\n                            '</thead>' +\n                            '<tbody></tbody>' +\n                        '</table>' +\n                    '</div>' +\n                    '<div id=\"upload-buttons\" class=\"upload-buttons\"/>' +\n                '</div>';\n    }\n});\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/upload/composite/composite-view.js\n **/","// dependencies\ndefine(['utils/utils',\n        'mvc/upload/upload-model',\n        'mvc/upload/upload-settings',\n        'mvc/ui/ui-popover',\n        'mvc/ui/ui-select'],\n\n        function(   Utils,\n                    UploadModel,\n                    UploadSettings,\n                    Popover,\n                    Select\n                ) {\n\n// row view\nreturn Backbone.View.extend({\n    // states\n    status_classes : {\n        init    : 'upload-icon-button fa fa-trash-o',\n        queued  : 'upload-icon fa fa-spinner fa-spin',\n        running : 'upload-icon fa fa-spinner fa-spin',\n        success : 'upload-icon-button fa fa-check',\n        error   : 'upload-icon-button fa fa-exclamation-triangle'\n    },\n\n    // handle for settings popover\n    settings: null,\n\n    // genome selector\n    select_genome : null,\n\n    // extension selector\n    select_extension : null,\n\n    // render\n    initialize: function(app, options) {\n        // link app\n        this.app = app;\n\n        // link this\n        var self = this;\n\n        // create model\n        this.model = options.model;\n\n        // add upload row\n        this.setElement(this._template(options.model));\n\n        // append popup to settings icon\n        this.settings = new Popover.View({\n            title       : 'Upload configuration',\n            container   : this.$('#settings'),\n            placement   : 'bottom'\n        });\n\n        // initialize default genome through default select field\n        var default_genome = this.app.select_genome.value();\n        \n        // select genomes\n        this.select_genome = new Select.View({\n            css: 'upload-genome',\n            onchange : function(genome) {\n                self.model.set('genome', genome);\n            },\n            data: self.app.list_genomes,\n            container: this.$('#genome'),\n            value: default_genome\n        });\n\n        // initialize genome\n        this.model.set('genome', default_genome);\n\n        // initialize default extension through default select field\n        var default_extension = this.app.select_extension.value();\n        \n        // select extension\n        this.select_extension = new Select.View({\n            css: 'upload-extension',\n            onchange : function(extension) {\n                self.model.set('extension', extension);\n            },\n            data: self.app.list_extensions,\n            container: this.$('#extension'),\n            value: default_extension\n        });\n\n        // initialize extension\n        this.model.set('extension', default_extension);\n        \n        //\n        // ui events\n        //\n\n        // handle click event\n        this.$('#symbol').on('click', function() { self._removeRow(); });\n\n        // handle extension info popover\n        this.$('#extension-info').on('click' , function(e) {\n            self.app.showExtensionInfo({\n                $el         : $(e.target),\n                title       : self.select_extension.text(),\n                extension   : self.select_extension.value()\n            });\n        }).on('mousedown', function(e) { e.preventDefault(); });\n\n        // handle settings popover\n        this.$('#settings').on('click' , function(e) { self._showSettings(); })\n                            .on('mousedown', function(e) { e.preventDefault(); });\n\n        // handle text editing event\n        this.$('#text-content').on('change input', function(e) {\n            self.model.set('url_paste', $(e.target).val());\n            self.model.set('file_size', $(e.target).val().length);\n        });\n\n        //\n        // model events\n        //\n        this.model.on('change:percentage', function() {\n            self._refreshPercentage();\n        });\n        this.model.on('change:status', function() {\n            self._refreshStatus();\n        });\n        this.model.on('change:info', function() {\n            self._refreshInfo();\n        });\n        this.model.on('change:genome', function() {\n            self._refreshGenome();\n        });\n        this.model.on('change:extension', function() {\n            self._refreshExtension();\n        });\n        this.model.on('change:file_size', function() {\n            self._refreshFileSize();\n        });\n        this.model.on('remove', function() {\n            self.remove();\n        });\n        this.app.collection.on('reset', function() {\n            self.remove();\n        });\n    },\n\n    // render\n    render: function() {\n        // read model\n        var file_name   = this.model.get('file_name');\n        var file_size   = this.model.get('file_size');\n        var file_mode   = this.model.get('file_mode');\n\n        // update title\n        this.$('#title').html(file_name);\n\n        // update info\n        this.$('#size').html(Utils.bytesToString (file_size));\n\n        // remove mode class\n        this.$('#mode')\n            .removeClass()\n            .addClass('upload-mode')\n            .addClass('text-primary');\n\n        // activate text field if file is new\n        if (file_mode == 'new') {\n            this.$('#text').css({\n                'width' : this.$el.width() - 16 + 'px',\n                'top'   : this.$el.height() - 8 + 'px'\n            }).show();\n            this.$el.height(this.$el.height() - 8 + this.$('#text').height() + 16);\n            this.$('#mode').addClass('fa fa-edit');\n        }\n\n        // file from local disk\n        if (file_mode == 'local') {\n            this.$('#mode').addClass('fa fa-laptop');\n        }\n\n        // file from ftp\n        if (file_mode == 'ftp') {\n            this.$('#mode').addClass('fa fa-folder-open-o');\n        }\n    },\n\n    // remove\n    remove: function() {\n        // trigger remove event\n        this.select_genome.remove();\n        this.select_extension.remove();\n\n        // call the base class remove method\n        Backbone.View.prototype.remove.apply(this);\n    },\n\n    //\n    // handle model events\n    //\n\n    // update extension\n    _refreshExtension: function() {\n        this.select_extension.value(this.model.get('extension'));\n    },\n    \n    // update genome\n    _refreshGenome: function() {\n        this.select_genome.value(this.model.get('genome'));\n    },\n\n    // progress\n    _refreshInfo: function() {\n        // write error message\n        var info = this.model.get('info');\n        if (info) {\n            this.$('#info').html('<strong>Failed: </strong>' + info).show();\n        } else {\n            this.$('#info').hide();\n        }\n    },\n\n    // progress\n    _refreshPercentage : function() {\n        var percentage = parseInt(this.model.get('percentage'));\n        this.$('.progress-bar').css({ width : percentage + '%' });\n        if (percentage != 100)\n            this.$('#percentage').html(percentage + '%');\n        else\n            this.$('#percentage').html('Adding to history...');\n    },\n\n    // status\n    _refreshStatus : function() {\n        // identify new status\n        var status = this.model.get('status');\n\n        // identify symbol and reset classes\n        this.$('#symbol').removeClass().addClass(this.status_classes[status]);\n\n        // enable/disable model flag\n        this.model.set('enabled', status == 'init');\n\n        // enable/disable row fields\n        var enabled = this.model.get('enabled');\n        this.$('#text-content').attr('disabled', !enabled);\n        if (enabled) {\n            this.select_genome.enable();\n            this.select_extension.enable();\n        } else {\n            this.select_genome.disable();\n            this.select_extension.disable();\n        }\n\n        // success\n        if (status == 'success') {\n            this.$el.addClass('success');\n            this.$('#percentage').html('100%');\n        }\n\n        // error\n        if (status == 'error') {\n            this.$el.addClass('danger');\n            this.$('.progress').remove();\n        }\n    },\n\n    // refresh size\n    _refreshFileSize: function() {\n        var count = this.model.get('file_size');\n        this.$('#size').html(Utils.bytesToString (count));\n    },\n\n    //\n    // handle ui events\n    //\n\n    // remove row\n    _removeRow: function() {\n        // get current status\n        var status = this.model.get('status');\n\n        // only remove from queue if not in processing line\n        if (status == 'init' || status == 'success' || status == 'error') {\n            this.app.collection.remove(this.model);\n        }\n    },\n\n    // attach file info popup\n    _showSettings : function() {\n        // check if popover is visible\n        if (!this.settings.visible) {\n            // show popover\n            this.settings.empty();\n            this.settings.append((new UploadSettings(this)).$el);\n            this.settings.show();\n        } else {\n            // hide popover\n            this.settings.hide();\n        }\n    },\n\n    // template\n    _template: function(options) {\n        return  '<tr id=\"upload-row-' + options.id + '\" class=\"upload-row\">' +\n                    '<td>' +\n                        '<div class=\"upload-text-column\">' +\n                            '<div id=\"mode\"/>' +\n                            '<div id=\"title\" class=\"upload-title\"/>' +\n                            '<div id=\"text\" class=\"text\">' +\n                                '<div class=\"text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div>' +\n                                '<textarea id=\"text-content\" class=\"text-content form-control\"/>' +\n                            '</div>' +\n                        '</div>' +\n                    '</td>' +\n                    '<td>' +\n                        '<div id=\"size\" class=\"upload-size\"/>' +\n                    '</td>' +\n                    '<td>' +\n                        '<div id=\"extension\" class=\"upload-extension\" style=\"float: left;\"/>&nbsp;&nbsp' +\n                        '<div id=\"extension-info\" class=\"upload-icon-button fa fa-search\"/>' +\n                    '</td>' +\n                    '<td>' +\n                        '<div id=\"genome\" class=\"upload-genome\"/>' +\n                    '</td>' +\n                    '<td><div id=\"settings\" class=\"upload-settings upload-icon-button fa fa-gear\"/></td>' +\n                    '<td>' +\n                        '<div id=\"info\" class=\"upload-info\">' +\n                            '<div class=\"progress\">' +\n                                '<div class=\"progress-bar progress-bar-success\"/>' +\n                                '<div id=\"percentage\" class=\"percentage\">0%</div>' +\n                            '</div>' +\n                        '</div>' +\n                    '</td>' +\n                    '<td>' +\n                        '<div id=\"symbol\" class=\"' + this.status_classes.init + '\"/>' +\n                    '</td>' +\n                '</tr>';\n    }\n\n});\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/upload/default/default-row.js\n **/","/** Renders contents of the default uploader */\ndefine(['utils/utils',\n        'mvc/upload/upload-model',\n        'mvc/upload/default/default-row',\n        'mvc/upload/upload-ftp',\n        'mvc/ui/ui-popover',\n        'mvc/ui/ui-select',\n        'mvc/ui/ui-misc',\n        'utils/uploadbox'],\n\n        function(   Utils,\n                    UploadModel,\n                    UploadRow,\n                    UploadFtp,\n                    Popover,\n                    Select,\n                    Ui\n                ) {\n\nreturn Backbone.View.extend({\n    // extension selector\n    select_extension : null,\n\n    // genome selector\n    select_genome: null,\n\n    // jquery uploadbox plugin\n    uploadbox: null,\n\n    // current upload size in bytes\n    upload_size: 0,\n\n    // contains upload row models\n    collection : new UploadModel.Collection(),\n\n    // ftp file viewer\n    ftp : null,\n\n    // keeps track of the current uploader state\n    counter : {\n        announce    : 0,\n        success     : 0,\n        error       : 0,\n        running     : 0,\n        reset : function() {\n            this.announce = this.success = this.error = this.running = 0;\n        }\n    },\n\n    // initialize\n    initialize : function(app) {\n        // link app\n        this.app                = app;\n        this.options            = app.options;\n        this.list_extensions    = app.list_extensions;\n        this.list_genomes       = app.list_genomes;\n        this.ui_button          = app.ui_button;\n        this.ftp_upload_site    = app.currentFtp();\n\n        // link this\n        var self = this;\n\n        // set element\n        this.setElement(this._template());\n\n        // create button section\n        this.btnLocal    = new Ui.Button({ id: 'btn-local', title: 'Choose local file',   onclick: function() { self.uploadbox.select(); }, icon: 'fa fa-laptop' });\n        this.btnFtp      = new Ui.Button({ id: 'btn-ftp',   title: 'Choose FTP file',     onclick: function() { self._eventFtp(); }, icon: 'fa fa-folder-open-o' });\n        this.btnCreate   = new Ui.Button({ id: 'btn-new',   title: 'Paste/Fetch data',    onclick: function() { self._eventCreate(); }, icon: 'fa fa-edit' });\n        this.btnStart    = new Ui.Button({ id: 'btn-start', title: 'Start',               onclick: function() { self._eventStart(); } });\n        this.btnStop     = new Ui.Button({ id: 'btn-stop',  title: 'Pause',               onclick: function() { self._eventStop(); } });\n        this.btnReset    = new Ui.Button({ id: 'btn-reset', title: 'Reset',               onclick: function() { self._eventReset(); } });\n        this.btnClose    = new Ui.Button({ id: 'btn-close', title: 'Close',               onclick: function() { self.app.modal.hide(); } });\n\n        // append buttons to dom\n        var buttons = [ this.btnLocal, this.btnFtp, this.btnCreate, this.btnStop, this.btnReset, this.btnStart, this.btnClose ];\n        for (var i in buttons) {\n            this.$('#upload-buttons').prepend(buttons[i].$el);\n        }\n\n        // file upload\n        var self = this;\n        this.uploadbox = this.$('#upload-box').uploadbox({\n            url             : this.app.options.nginx_upload_path,\n            announce        : function(index, file) { self._eventAnnounce(index, file) },\n            initialize      : function(index) { return self.app.toData([ self.collection.get(index) ], self.history_id) },\n            progress        : function(index, percentage) { self._eventProgress(index, percentage) },\n            success         : function(index, message) { self._eventSuccess(index, message) },\n            error           : function(index, message) { self._eventError(index, message) },\n            complete        : function() { self._eventComplete() },\n            ondragover      : function() { self.$('.upload-box').addClass('highlight'); },\n            ondragleave     : function() { self.$('.upload-box').removeClass('highlight'); }\n        });\n\n        // add ftp file viewer\n        this.ftp = new Popover.View({\n            title       : 'FTP files',\n            container   : this.btnFtp.$el\n        });\n\n        // select extension\n        this.select_extension = new Select.View({\n            css         : 'footer-selection',\n            container   : this.$('#footer-extension'),\n            data        : _.filter(this.list_extensions, function(ext) { return !ext.composite_files }),\n            value       : this.options.default_extension,\n            onchange    : function(extension) {\n                self.updateExtension(extension);\n            }\n        });\n\n        // handle extension info popover\n        self.$('#footer-extension-info').on('click', function(e) {\n            self.showExtensionInfo({\n                $el         : $(e.target),\n                title       : self.select_extension.text(),\n                extension   : self.select_extension.value(),\n                placement   : 'top'\n            });\n        }).on('mousedown', function(e) { e.preventDefault(); });\n\n        // genome extension\n        this.select_genome = new Select.View({\n            css         : 'footer-selection',\n            container   : this.$('#footer-genome'),\n            data        : this.list_genomes,\n            value       : this.options.default_genome,\n            onchange    : function(genome) {\n                self.updateGenome(genome);\n            }\n        });\n\n        // events\n        this.collection.on('remove', function(model) {\n            self._eventRemove(model);\n        });\n\n        // setup info\n        this._updateScreen();\n    },\n\n    //\n    // events triggered by the upload box plugin\n    //\n\n    // a new file has been dropped/selected through the uploadbox plugin\n    _eventAnnounce: function(index, file) {\n        // update counter\n        this.counter.announce++;\n\n        // create if model has not been created yet\n        var new_model = new UploadModel.Model({\n            id          : index,\n            file_name   : file.name,\n            file_size   : file.size,\n            file_mode   : file.mode || 'local',\n            file_path   : file.path,\n            file_data   : file\n        });\n\n        // add model to collection\n        this.collection.add(new_model);\n\n        // create view/model\n        var upload_row = new UploadRow(this, { model: new_model });\n\n        // add upload row element to table\n        this.$('#upload-table > tbody:first').append(upload_row.$el);\n\n        // show on screen info\n        this._updateScreen();\n\n        // render\n        upload_row.render();\n    },\n\n    // progress\n    _eventProgress: function(index, percentage) {\n        // set progress for row\n        var it = this.collection.get(index);\n        it.set('percentage', percentage);\n\n        // update ui button\n        this.ui_button.set('percentage', this._uploadPercentage(percentage, it.get('file_size')));\n    },\n\n    // success\n    _eventSuccess: function(index, message) {\n        // update status\n        var it = this.collection.get(index);\n        it.set('percentage', 100);\n        it.set('status', 'success');\n\n        // update ui button\n        this.ui_button.set('percentage', this._uploadPercentage(100, it.get('file_size')));\n\n        // update completed\n        this.upload_completed += it.get('file_size') * 100;\n\n        // update counter\n        this.counter.announce--;\n        this.counter.success++;\n\n        // update on screen info\n        this._updateScreen();\n\n        // update galaxy history\n        Galaxy.currHistoryPanel.refreshContents();\n    },\n\n    // error\n    _eventError: function(index, message) {\n        // get element\n        var it = this.collection.get(index);\n\n        // update status\n        it.set('percentage', 100);\n        it.set('status', 'error');\n        it.set('info', message);\n\n        // update ui button\n        this.ui_button.set('percentage', this._uploadPercentage(100, it.get('file_size')));\n        this.ui_button.set('status', 'danger');\n\n        // update completed\n        this.upload_completed += it.get('file_size') * 100;\n\n        // update counter\n        this.counter.announce--;\n        this.counter.error++;\n\n        // update on screen info\n        this._updateScreen();\n    },\n\n    // queue is done\n    _eventComplete: function() {\n        // reset queued upload to initial status\n        this.collection.each(function(model) {\n            if(model.get('status') == 'queued') {\n                model.set('status', 'init');\n            }\n        });\n\n        // update running\n        this.counter.running = 0;\n\n        // update on screen info\n        this._updateScreen();\n    },\n\n    //\n    // events triggered by collection\n    //\n\n    // remove model from upload list\n    _eventRemove: function(model) {\n        // update status\n        var status = model.get('status');\n\n        // reduce counter\n        if (status == 'success') {\n            this.counter.success--;\n        } else if (status == 'error') {\n            this.counter.error--;\n        } else {\n            this.counter.announce--;\n        }\n\n        // remove from queue\n        this.uploadbox.remove(model.id);\n\n        // show on screen info\n        this._updateScreen();\n    },\n\n    //\n    // events triggered by this view\n    //\n\n    // [public] display extension info popup\n    showExtensionInfo: function(options) {\n        // initialize\n        var self = this;\n        var $el = options.$el;\n        var extension = options.extension;\n        var title = options.title;\n        var description = _.findWhere(self.list_extensions, {'id': extension});\n\n        // create popup\n        this.extension_popup && this.extension_popup.remove();\n        this.extension_popup = new Popover.View({\n            placement: options.placement || 'bottom',\n            container: $el\n        });\n\n        // add content and show popup\n        this.extension_popup.title(title);\n        this.extension_popup.empty();\n        this.extension_popup.append(this._templateDescription(description));\n        this.extension_popup.show();\n    },\n\n    // show/hide ftp popup\n    _eventFtp: function() {\n        if (!this.ftp.visible) {\n            this.ftp.empty();\n            var self = this;\n            this.ftp.append((new UploadFtp({\n                collection      : this.collection,\n                ftp_upload_site : this.ftp_upload_site,\n                onadd: function(ftp_file) {\n                    self.uploadbox.add([{\n                        mode: 'ftp',\n                        name: ftp_file.path,\n                        size: ftp_file.size,\n                        path: ftp_file.path\n                    }]);\n                },\n                onremove: function(model_index) {\n                    self.collection.remove(model_index);\n                }\n            })).$el);\n            this.ftp.show();\n        } else {\n            this.ftp.hide();\n        }\n    },\n\n    // create a new file\n    _eventCreate: function (){\n        this.uploadbox.add([{\n            name    : 'New File',\n            size    : 0,\n            mode    : 'new'\n        }]);\n    },\n\n    // start upload process\n    _eventStart: function() {\n        // check\n        if (this.counter.announce == 0 || this.counter.running > 0) {\n            return;\n        }\n\n        // reset current size\n        var self = this;\n        this.upload_size = 0;\n        this.upload_completed = 0;\n        // switch icons for new uploads\n        this.collection.each(function(model) {\n            if(model.get('status') == 'init') {\n                model.set('status', 'queued');\n                self.upload_size += model.get('file_size');\n            }\n        });\n\n        // reset progress\n        this.ui_button.set('percentage', 0);\n        this.ui_button.set('status', 'success');\n\n        // update running\n        this.counter.running = this.counter.announce;\n\n        // set current history id\n        this.history_id = this.app.currentHistory();\n\n        // initiate upload procedure in plugin\n        this.uploadbox.start();\n\n        // update on screen info\n        this._updateScreen();\n    },\n\n    // pause upload process\n    _eventStop: function() {\n        // check\n        if (this.counter.running > 0) {\n            // show upload has paused\n            this.ui_button.set('status', 'info');\n\n            // set html content\n            $('#upload-info').html('Queue will pause after completing the current file...');\n\n            // request pause\n            this.uploadbox.stop();\n        }\n    },\n\n    // remove all\n    _eventReset: function() {\n        // make sure queue is not running\n        if (this.counter.running == 0){\n            // reset collection\n            this.collection.reset();\n\n            // reset counter\n            this.counter.reset();\n\n            // remove from queue\n            this.uploadbox.reset();\n\n            // reset value for universal type drop-down\n            this.select_extension.value(this.options.default_extension);\n            this.select_genome.value(this.options.default_genome);\n\n            // reset button\n            this.ui_button.set('percentage', 0);\n\n            // show on screen info\n            this._updateScreen();\n        }\n    },\n\n    // update extension for all models\n    updateExtension: function(extension, defaults_only) {\n        var self = this;\n        this.collection.each(function(model) {\n            if (model.get('status') == 'init' && (model.get('extension') == self.options.default_extension || !defaults_only)) {\n                model.set('extension', extension);\n            }\n        });\n    },\n\n    // update genome for all models\n    updateGenome: function(genome, defaults_only) {\n        var self = this;\n        this.collection.each(function(model) {\n            if (model.get('status') == 'init' && (model.get('genome') == self.options.default_genome || !defaults_only)) {\n                model.set('genome', genome);\n            }\n        });\n    },\n\n    // set screen\n    _updateScreen: function () {\n        /*\n            update on screen info\n        */\n\n        // check default message\n        if(this.counter.announce == 0) {\n            if (this.uploadbox.compatible()) {\n                message = '&nbsp;';\n            } else {\n                message = 'Browser does not support Drag & Drop. Try Firefox 4+, Chrome 7+, IE 10+, Opera 12+ or Safari 6+.';\n            }\n        } else {\n            if (this.counter.running == 0) {\n                message = 'You added ' + this.counter.announce + ' file(s) to the queue. Add more files or click \\'Start\\' to proceed.';\n            } else {\n                message = 'Please wait...' + this.counter.announce + ' out of ' + this.counter.running + ' remaining.';\n            }\n        }\n\n        // set html content\n        this.$('#upload-info').html(message);\n\n        /*\n            update button status\n        */\n\n        // update reset button\n        if (this.counter.running == 0 && this.counter.announce + this.counter.success + this.counter.error > 0) {\n            this.btnReset.enable();\n        } else {\n            this.btnReset.disable();\n        }\n\n        // update upload button\n        if (this.counter.running == 0 && this.counter.announce > 0) {\n            this.btnStart.enable();\n            this.btnStart.$el.addClass('btn-primary');\n        } else {\n            this.btnStart.disable();\n            this.btnStart.$el.removeClass('btn-primary');\n        }\n\n        // pause upload button\n        if (this.counter.running > 0) {\n            this.btnStop.enable();\n        } else {\n            this.btnStop.disable();\n        }\n\n        // select upload button\n        if (this.counter.running == 0) {\n            this.btnLocal.enable();\n            this.btnFtp.enable();\n            this.btnCreate.enable();\n        } else {\n            this.btnLocal.disable();\n            this.btnFtp.disable();\n            this.btnCreate.disable();\n        }\n\n        // ftp button\n        if (this.ftp_upload_site) {\n            this.btnFtp.$el.show();\n        } else {\n            this.btnFtp.$el.hide();\n        }\n\n        // table visibility\n        if (this.counter.announce + this.counter.success + this.counter.error > 0) {\n            this.$('#upload-table').show();\n            this.$('.upload-helper').hide();\n        } else {\n            this.$('#upload-table').hide();\n            this.$('.upload-helper').show();\n        }\n    },\n\n    // calculate percentage of all queued uploads\n    _uploadPercentage: function(percentage, size) {\n        return (this.upload_completed + (percentage * size)) / this.upload_size;\n    },\n\n    // template for extensions description\n    _templateDescription: function(options) {\n        if (options.description) {\n            var tmpl = options.description;\n            if (options.description_url) {\n                tmpl += '&nbsp;(<a href=\"' + options.description_url + '\" target=\"_blank\">read more</a>)';\n            }\n            return tmpl;\n        } else {\n            return 'There is no description available for this file extension.';\n        }\n    },\n\n    // load html template\n    _template: function() {\n        return  '<div class=\"upload-view-default\">' +\n                    '<div class=\"upload-top\">' +\n                        '<h6 id=\"upload-info\" class=\"upload-info\"/>' +\n                    '</div>' +\n                    '<div id=\"upload-box\" class=\"upload-box\">' +\n                        '<div class=\"upload-helper\"><i class=\"fa fa-files-o\"/>Drop files here</div>' +\n                        '<table id=\"upload-table\" class=\"ui-table-striped\" style=\"display: none;\">' +\n                            '<thead>' +\n                                '<tr>' +\n                                    '<th>Name</th>' +\n                                    '<th>Size</th>' +\n                                    '<th>Type</th>' +\n                                    '<th>Genome</th>' +\n                                    '<th>Settings</th>' +\n                                    '<th>Status</th>' +\n                                    '<th/>' +\n                                '</tr>' +\n                            '</thead>' +\n                            '<tbody/>' +\n                        '</table>' +\n                    '</div>' +\n                    '<div id=\"upload-footer\" class=\"upload-footer\">' +\n                        '<span class=\"footer-title\">Type (set all):</span>' +\n                        '<span id=\"footer-extension\"/>' +\n                        '<span id=\"footer-extension-info\" class=\"upload-icon-button fa fa-search\"/> ' +\n                        '<span class=\"footer-title\">Genome (set all):</span>' +\n                        '<span id=\"footer-genome\"/>' +\n                    '</div>' +\n                    '<div id=\"upload-buttons\" class=\"upload-buttons\"/>' +\n                '</div>';\n    }\n});\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/upload/default/default-view.js\n **/","// dependencies\ndefine([], function() {\n\n// model for upload/progress bar button\nvar Model = Backbone.Model.extend({\n    defaults: {\n        icon        : 'fa-upload',\n        tooltip     : 'Download from URL or upload files from disk',\n        label       : 'Load Data',\n        percentage  : 0,\n        status      : ''\n    }\n});\n\n// view for upload/progress bar button\nvar View = Backbone.View.extend({\n    // model\n    model : null,\n\n    // initialize\n    initialize : function( options ) {\n        // link this\n        var self = this;\n\n        // create model\n        var model = options.model;\n\n        // create new element\n        this.setElement( this._template() );\n\n        // add event\n        this.$el.on( 'click', function( e ) { options.onclick( e ); });\n\n        // add tooltip\n        this.$el.tooltip( { title: model.get('tooltip'), placement: 'bottom' } );\n\n        // events\n        model.on( 'change:percentage', function() {\n            self._percentage( model.get( 'percentage' ) );\n        });\n        model.on( 'change:status', function() {\n            self._status( model.get( 'status' ) );\n        });\n\n        // unload event\n        var self = this;\n        $( window ).on( 'beforeunload', function() {\n            var text = \"\";\n            if ( options.onunload ) {\n                text = options.onunload();\n            }\n            if ( text != \"\" ) {\n                return text;\n            }\n        });\n    },\n\n    // set status\n    _status: function( value ) {\n        var $el = this.$el.find( '.progress-bar' );\n        $el.removeClass();\n        $el.addClass( 'progress-bar' );\n        $el.addClass( 'progress-bar-notransition' );\n        if ( value != '' ) {\n            $el.addClass( 'progress-bar-' + value );\n        }\n    },\n\n    // set percentage\n    _percentage: function( value ) {\n        var $el = this.$el.find( '.progress-bar' );\n        $el.css( { width : value + '%' } );\n    },\n\n    // template\n    _template: function() {\n        return  '<div class=\"upload-button\">' +\n                    '<div class=\"progress\">' +\n                        '<div class=\"progress-bar\"/>' +\n                        '<a class=\"panel-header-button\" href=\"javascript:void(0)\" id=\"tool-panel-upload-button\">' +\n                            '<span class=\"fa fa-upload\"/>' +\n                        '</a>' +\n                    '</div>' +\n                '</div>';\n    }\n});\n\nreturn {\n    Model   : Model,\n    View    : View\n};\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/upload/upload-button.js\n **/","/** Upload app contains the upload progress button and upload modal, compiles model data for API request **/\ndefine(['utils/utils',\n        'mvc/ui/ui-modal',\n        'mvc/ui/ui-tabs',\n        'mvc/upload/upload-button',\n        'mvc/upload/default/default-view',\n        'mvc/upload/composite/composite-view'],\n        function(   Utils,\n                    Modal,\n                    Tabs,\n                    UploadButton,\n                    UploadViewDefault,\n                    UploadViewComposite ) {\nreturn Backbone.View.extend({\n    // default options\n    options : {\n        nginx_upload_path   : '',\n        ftp_upload_site     : 'n/a',\n        default_genome      : '?',\n        default_extension   : 'auto',\n        height              : 500,\n        width               : 900,\n        auto                : {\n            id          : 'auto',\n            text        : 'Auto-detect',\n            description : 'This system will try to detect the file type automatically. If your file is not detected properly as one of the known formats, it most likely means that it has some format problems (e.g., different number of columns on different rows). You can still coerce the system to set your data to the format you think it should be.  You can also upload compressed files, which will automatically be decompressed.'\n        }\n    },\n\n    // upload modal container\n    modal: null,\n\n    // progress button in panel\n    ui_button: null,\n\n    // current history identifier\n    current_history: null,\n\n    // contains all available dataset extensions/types\n    list_extensions: [],\n\n    // contains all available genomes\n    list_genomes: [],\n\n    // initialize\n    initialize: function( options ) {\n        // link this\n        var self = this;\n\n        // merge parsed options\n        this.options = Utils.merge( options, this.options );\n\n        // create model for upload/progress button\n        this.ui_button = new UploadButton.Model();\n\n        // create view for upload/progress button\n        this.ui_button_view = new UploadButton.View({\n            model       : this.ui_button,\n            onclick     : function(e) {\n                e.preventDefault();\n                self.show()\n            },\n            onunload    : function() {\n                var percentage = self.ui_button.get('percentage', 0);\n                if (percentage > 0 && percentage < 100) {\n                    return 'Several uploads are queued.';\n                }\n            }\n        });\n\n        // set element to button view\n        this.setElement( this.ui_button_view.$el );\n\n        // load extensions\n        var self = this;\n        Utils.get({\n            url     : Galaxy.root + 'api/datatypes?extension_only=False',\n            success : function( datatypes ) {\n                for ( var key in datatypes ) {\n                    self.list_extensions.push({\n                        id              : datatypes[ key ].extension,\n                        text            : datatypes[ key ].extension,\n                        description     : datatypes[ key ].description,\n                        description_url : datatypes[ key ].description_url,\n                        composite_files : datatypes[ key ].composite_files\n                    });\n                }\n                self.list_extensions.sort( function( a, b ) {\n                    var a_text = a.text && a.text.toLowerCase();\n                    var b_text = b.text && b.text.toLowerCase();\n                    return a_text > b_text ? 1 : a_text < b_text ? -1 : 0;\n                });\n                if ( !self.options.datatypes_disable_auto ) {\n                    self.list_extensions.unshift( self.options.auto );\n                }\n            }\n        });\n\n        // load genomes\n        Utils.get({\n            url     : Galaxy.root + 'api/genomes',\n            success : function( genomes ) {\n                for ( var key in genomes ) {\n                    self.list_genomes.push({\n                        id      : genomes[ key ][ 1 ],\n                        text    : genomes[ key ][ 0 ]\n                    });\n                }\n                self.list_genomes.sort( function( a, b ) {\n                    if ( a.id == self.options.default_genome ) { return -1; }\n                    if ( b.id == self.options.default_genome ) { return 1; }\n                    return a.text > b.text ? 1 : a.text < b.text ? -1 : 0;\n                });\n            }\n        });\n    },\n\n    //\n    // event triggered by upload button\n    //\n\n    // show/hide upload frame\n    show: function () {\n        // wait for galaxy history panel\n        var self = this;\n        if ( !Galaxy.currHistoryPanel || !Galaxy.currHistoryPanel.model ) {\n            window.setTimeout(function() { self.show() }, 500)\n            return;\n        }\n\n        // set current user\n        this.current_user = Galaxy.user.id;\n\n        // create modal\n        if ( !this.modal ) {\n            // build tabs\n            this.tabs = new Tabs.View();\n\n            // add tabs\n            this.default_view = new UploadViewDefault( this );\n            this.tabs.add({\n                id      : 'regular',\n                title   : 'Regular',\n                $el     : this.default_view.$el\n            });\n            this.composite_view = new UploadViewComposite( this );\n            this.tabs.add({\n                id      : 'composite',\n                title   : 'Composite',\n                $el     : this.composite_view.$el\n            });\n\n            // make modal\n            this.modal = new Modal.View({\n                title           : 'Download from web or upload from disk',\n                body            : this.tabs.$el,\n                height          : this.options.height,\n                width           : this.options.width,\n                closing_events  : true,\n                title_separator : false\n            });\n        }\n\n        // show modal\n        this.modal.show();\n    },\n\n    // refresh user and current history\n    currentHistory: function() {\n        return this.current_user && Galaxy.currHistoryPanel.model.get( 'id' );\n    },\n\n    // get ftp configuration\n    currentFtp: function() {\n        return this.current_user && this.options.ftp_upload_site;\n    },\n\n    /**\n      * Package API data from array of models\n      * @param{Array} items - Upload items/rows filtered from a collection\n    */\n    toData: function( items, history_id ) {\n        // create dictionary for data submission\n        var data = {\n            payload: {\n                'tool_id'       : 'upload1',\n                'history_id'    : history_id || this.currentHistory(),\n                'inputs'        : {}\n            },\n            files: [],\n            error_message: null\n        }\n        // add upload tools input data\n        if ( items && items.length > 0 ) {\n            var inputs = {};\n            inputs[ 'dbkey' ] = items[0].get( 'genome', null );\n            inputs[ 'file_type' ] = items[0].get( 'extension', null );\n            for ( var index in items ) {\n                var it = items[ index ];\n                it.set( 'status', 'running' );\n                if ( it.get( 'file_size' ) > 0 ) {\n                    var prefix = 'files_' + index + '|';\n                    inputs[ prefix + 'type' ] = 'upload_dataset';\n                    inputs[ prefix + 'space_to_tab' ] = it.get( 'space_to_tab' ) && 'Yes' || null;\n                    inputs[ prefix + 'to_posix_lines' ] = it.get( 'to_posix_lines' ) && 'Yes' || null;\n                    switch ( it.get( 'file_mode' ) ) {\n                        case 'new':\n                            inputs[ prefix + 'url_paste' ] = it.get( 'url_paste' );\n                            break;\n                        case 'ftp':\n                            inputs[ prefix + 'ftp_files' ] = it.get( 'file_path' );\n                            break;\n                        case 'local':\n                            data.files.push( { name: prefix + 'file_data', file: it.get( 'file_data' ) } );\n                    }\n                } else {\n                    data.error_message = 'Upload content incomplete.';\n                    it.set( 'status', 'error' );\n                    it.set( 'info', data.error_message );\n                    break;\n                }\n            }\n            data.payload.inputs = JSON.stringify( inputs );\n        }\n        return data;\n    }\n});\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/upload/upload-view.js\n **/","(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define([], factory);\n    } else {\n        // Browser globals\n        root.LoadingIndicator = factory();\n    }\n\n//============================================================================\n}(this, function () {\n    //TODO: too specific to history panel\n    function LoadingIndicator( $where, options ){\n\n        var self = this;\n        // defaults\n        options = jQuery.extend({\n            cover       : false\n        }, options || {} );\n\n        function render(){\n            var html = [\n                '<div class=\"loading-indicator\">',\n                    '<div class=\"loading-indicator-text\">',\n                        '<span class=\"fa fa-spinner fa-spin fa-lg\"></span>',\n                        '<span class=\"loading-indicator-message\">loading...</span>',\n                    '</div>',\n                '</div>'\n            ].join( '\\n' );\n\n            var $indicator = $( html ).hide().css( options.css || {\n                    position    : 'fixed'\n                }),\n                $text = $indicator.children( '.loading-indicator-text' );\n\n            if( options.cover ){\n                $indicator.css({\n                    'z-index'   : 2,\n                    top         : $where.css( 'top' ),\n                    bottom      : $where.css( 'bottom' ),\n                    left        : $where.css( 'left' ),\n                    right       : $where.css( 'right' ),\n                    opacity     : 0.5,\n                    'background-color': 'white',\n                    'text-align': 'center'\n                });\n                $text = $indicator.children( '.loading-indicator-text' ).css({\n                    'margin-top'        : '20px'\n                });\n\n            } else {\n                $text = $indicator.children( '.loading-indicator-text' ).css({\n                    margin              : '12px 0px 0px 10px',\n                    opacity             : '0.85',\n                    color               : 'grey'\n                });\n                $text.children( '.loading-indicator-message' ).css({\n                    margin          : '0px 8px 0px 0px',\n                    'font-style'    : 'italic'\n                });\n            }\n            return $indicator;\n        }\n\n        self.show = function( msg, speed, callback ){\n            msg = msg || 'loading...';\n            speed = speed || 'fast';\n            // remove previous\n            $where.parent().find( '.loading-indicator' ).remove();\n            // since position is fixed - we insert as sibling\n            self.$indicator = render().insertBefore( $where );\n            self.message( msg );\n            self.$indicator.fadeIn( speed, callback );\n            return self;\n        };\n\n        self.message = function( msg ){\n            self.$indicator.find( 'i' ).text( msg );\n        };\n\n        self.hide = function( speed, callback ){\n            speed = speed || 'fast';\n            if( self.$indicator && self.$indicator.length ){\n                self.$indicator.fadeOut( speed, function(){\n                    self.$indicator.remove();\n                    if( callback ){ callback(); }\n                });\n            } else {\n                if( callback ){ callback(); }\n            }\n            return self;\n        };\n        return self;\n    }\n\n//============================================================================\n    return LoadingIndicator;\n}));\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/ui/loading-indicator.js\n **/","define([\n], function(){\n//=============================================================================\n/**\n(Imported for edit distance algorith. From: https://gist.github.com/andrei-m/982927)\nCopyright (c) 2011 Andrei Mackenzie\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\ndocumentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the\nrights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit\npersons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the\nSoftware.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE\nWARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\nCOPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\nOTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*/\n// Compute the edit distance between the two given strings\n//exports.getEditDistance = function(a, b){\nfunction levenshteinDistance(a, b){\n  if(a.length === 0){ return b.length; }\n  if(b.length === 0){ return a.length; }\n\n  var matrix = [];\n\n  // increment along the first column of each row\n  var i;\n  for(i = 0; i <= b.length; i++){\n    matrix[i] = [i];\n  }\n\n  // increment each column in the first row\n  var j;\n  for(j = 0; j <= a.length; j++){\n    matrix[0][j] = j;\n  }\n\n  // Fill in the rest of the matrix\n  for(i = 1; i <= b.length; i++){\n    for(j = 1; j <= a.length; j++){\n      if(b.charAt(i-1) === a.charAt(j-1)){\n        matrix[i][j] = matrix[i-1][j-1];\n      } else {\n        matrix[i][j] = Math.min(matrix[i-1][j-1] + 1, // substitution\n                                Math.min(matrix[i][j-1] + 1, // insertion\n                                         matrix[i-1][j] + 1)); // deletion\n      }\n    }\n  }\n\n  //console.debug( '\\t\\t levenshteinDistance', a, b, matrix[b.length][a.length] );\n  return matrix[b.length][a.length];\n}\n\n//=============================================================================\n    return levenshteinDistance;\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/utils/levenshtein.js\n **/"],"sourceRoot":""}