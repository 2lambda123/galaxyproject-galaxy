{"version":3,"sources":["webpack:///login.bundled.js","webpack:///./galaxy/scripts/apps/login.js","webpack:///./galaxy/scripts/utils/utils.js?d2e7","webpack:///./galaxy/scripts/mvc/ui/ui-modal.js?120e","webpack:///./galaxy/scripts/mvc/ui/ui-frames.js?d017","webpack:///./galaxy/scripts/mvc/user/user-model.js?e6b2","webpack:///./galaxy/scripts/galaxy.js?88e6","webpack:///./galaxy/scripts/layout/masthead.js?08fd","webpack:///./galaxy/scripts/layout/menu.js?9a2d","webpack:///./galaxy/scripts/layout/page.js?047e","webpack:///./galaxy/scripts/layout/scratchbook.js?f9ea","webpack:///./galaxy/scripts/mvc/user/user-quotameter.js?f822","webpack:///./galaxy/scripts/utils/metrics-logger.js?2783"],"names":["webpackJsonp","0","module","exports","__webpack_require__","_","jQuery","$","GalaxyApp","PANEL","_l","PAGE","window","app","options","bootstrapped","Galaxy","debug","redirect","encodeURI","show_welcome_with_login","params","param","use_panels","location","href","root","loginPage","PageLayoutView","extend","el","center","CenterPanel","right","RightPanel","title","loginUrl","render","prop","welcome_url","css","html","call","4","__WEBPACK_AMD_DEFINE_ARRAY__","__WEBPACK_AMD_DEFINE_RESULT__","iframe","src","deepeach","dict","callback","i","d","isObject","new_dict","isJSON","text","test","replace","sanitize","content","isEmpty","value","Array","length","undefined","indexOf","textify","lst","isArray","toString","pos","lastIndexOf","substr","get","top","__utils__get__","cache_key","JSON","stringify","cache","success","console","url","request","data","response","error","ajaxConfig","contentType","type","isEmptyObject","dataType","ajax","done","parseJSON","e","fail","response_text","responseText","always","complete","cssGetAttribute","classname","name","appendTo","remove","cssLoadFile","merge","optionsDefault","defaults","roundToDecimalPlaces","number","numPlaces","placesMultiplier","Math","round","bytesToString","size","normal_font","numberPlaces","unit","tb","gb","mb","kb","rounded","uid","__utils__uid__","time","Date","hours","getHours","minutes","getMinutes","datetime","getDate","getMonth","getFullYear","apply","8","Backbone","View","container","cls","body","backdrop","height","width","closing_events","closing_callback","title_separator","buttonList","initialize","this","setElement","_template","prepend","$header","$dialog","$body","$footer","$backdrop","$buttons","show","visible","$el","fadeIn","self","document","on","keyCode","hide","canceled","fadeOut","off","removeClass","addClass","find","empty","buttons","counter","each","$button","attr","click","append","getButton","enableButton","disableButton","showButton","hideButton","scrollTop","16","FrameView","model","Model","tooltip","placement","$title","$content","listenTo","attributes","menu","option","$option","icon","isFunction","disabled","onclick","defaultOptions","frame","cols","rows","cell","margin","scroll","top_min","frame_max","top_max","frame_z","frame_counter","frame_uid","frame_list","frame_shadow","event","_frameInit","_frameResize","_panelRefresh","resize","add","modal","Close","frame_id","_toPixelCoord","parseInt","_frameInsert","left","trigger","del","$frame","id","_panelAnimationComplete","events","mousemove","mouseup","mouseleave","mousewheel","DOMMouseScroll","mousedown .frame","mousedown .frame-background","mousedown .frame-scroll-up","mousedown .frame-scroll-down","mousedown .f-close","_eventFrameMouseDown","target","hasClass","preventDefault","_frameIdentify","xy","x","originalEvent","pageX","y","pageY","_frameDragStart","_eventFrameMouseMove","event_xy_new","event_xy_delta","p","_frameScreen","min_dim","max","_toGridCoord","_frameOffset","l","_eventFrameMouseUp","_frameDragStop","_eventFrameClose","_eventHide","_eventPanelScroll","frames","srcElement","parents","stopPropagation","_panelScroll","detail","wheelDelta","_eventPanelScroll_up","_eventPanelScroll_down","closest","_frameFocus","_frameGrid","grid_location","px","sign","g","_toGrid","_toPixel","_isCollision","is_collision_pair","a","b","_locationRank","loc","animate","promise","delta","top_new","min","screen_location","grid_rank","substring","new_loc","place_list","push","f","sort","place","_framePlace","j","log","has_focus","29","baseMVC","logNamespace","User","LoggableMixin","_logNamespace","urlRoot","username","email","total_disk_usage","nice_total_disk_usage","quota_percent","is_admin","resp","changes","isAnonymous","isAdmin","loadFromApi","idOrCurrent","CURRENT_ID_STR","userFn","newModel","prototype","fetch","clearSessionStorage","key","sessionStorage","removeItem","userInfo","unshift","join","getCurrentUserFromApi","currentUser","Collection","31","BASE_MVC","userModel","metricsLogger","addLogging","localize","_init","DEBUGGING_KEY","NAMESPACE_KEY","localDebugging","localStorage","getItem","storageErr","Events","logger","_processOptions","_initConfig","config","_patchGalaxy","_initLogger","loggerOptions","_initLocale","_initUser","user","_setUpListeners","patchExisting","k","hasOwnProperty","patchWith","consoleLogger","consoleLevel","MetricsLogger","ALL","consoleNamespaceWhitelist","split","emit","map","arguments","slice","userJSON","lastAjax","bind","ev","xhr","parse","err","debugging","setting","setItem","debuggingNamespaces","namespaces","csv","newSettings","userEmail","32","Utils","Menu","Scratchbook","QuotaMeter","$navbarBrandLink","$navbarBrandImage","$navbarBrandTitle","$navbarTabs","$quoteMeter","collection","Tab","m","quotaMeter","UserQuotaMeter","$download_link","q","brand","logo_url","logo_src","33","Tours","reset","user_requests","lims_doc_url","helpTab","support_url","search_url","mailing_lists","screencasts_url","wiki_url","citation_url","display","ToursView","terms_url","biostar_url","biostar_url_redirect","userTab","divider","use_remote_user","allow_user_creation","activeView","active_view","set","Deferred","resolve","$dropdown","$toggle","$menu","$note","click .dropdown-toggle","visibility","_formatUrl","menuItem","_buildMenuItem","_toggleClick","buildLink","label","popover","setTimeout","charAt","34","Masthead","Panel","Modal","BaseMVC","className","_panelIds","message_box_visible","message_box_content","message_box_class","show_inactivity_warning","inactivity_box_content","pick","omit","masthead","replaceWith","$messagebox","$inactivebox","renderMessageBox","renderInactivityBox","renderPanels","level","toggle","verificationLink","page","forEach","panelId","has","hideSidePanels","35","Frames","buttonActive","active","show_note","note_cls","onbeforeunload","buttonLoad","note","history_cache","addDataset","dataset_id","current_dataset","currHistoryPanel","history_id","historyId","dataset_ids","_findDataset","dataset","offset","history_details","dataset_list","_loadDatasetOffset","new_dataset_id","_loadDataset","new_dataset","__WEBPACK_AMD_REQUIRE_ARRAY__","DATA","Dataset","when","then","is_tabular","data_type","createTabularDatasetChunkedView","TabularDataset","toJSON","embedded","addTrackster","viz_id","visualization","trackster","viz","Visualization","ui","TracksterUI","frame_config","parent_elt","view_config","dbkey","stand_alone","latest_revision","drawables","view","hda_ldda","create_visualization","viewport","bookmarks","open","$galaxy_main","parent","62","warnAtPercent","errorAtPercent","update","isOverQuota","_render_quota","modelJson","percent","$meter","_templateQuotaMeter","$bar","_render_usage","usage","_templateUsage","meterHtml","66","_typeof","Symbol","iterator","obj","constructor","userId","LoggingCache","LOG","DEBUG","INFO","WARN","ERROR","METRIC","NONE","logLevel","defaultNamespace","clientPrefix","maxCacheSize","postSize","addTime","cacheKeyPrefix","postUrl","delayPostInMs","getPingData","onServerResponse","_parseLevel","_sending","_waiting","_postSize","_initCache","maxSize","_emitToConsole","upper","toUpperCase","Error","namespace","logArguments","_addToCache","newLength","_buildEntry","_postCache","entry","args","toISOString","count","entries","entriesLength","postData","metrics","post","status","message","readyState","responseJSON","_delayPost","whitelist","info","warn","metric","_hasStorage","_initStorage","_cache","_fetchAndParse","overage","splice","_unparseAndStore","removed","print"],"mappings":"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","file":"login.bundled.js","sourcesContent":["webpackJsonp([4],{\n\n/***/ 0:\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* WEBPACK VAR INJECTION */(function(_) {'use strict';\n\t\n\tvar jQuery = __webpack_require__(1),\n\t    $ = jQuery,\n\t    GalaxyApp = __webpack_require__(31).GalaxyApp,\n\t    PANEL = __webpack_require__(10),\n\t    _l = __webpack_require__(5),\n\t    PAGE = __webpack_require__(34);\n\t\n\twindow.app = function app(options, bootstrapped) {\n\t    window.Galaxy = new GalaxyApp(options, bootstrapped);\n\t    Galaxy.debug('login app');\n\t    var redirect = encodeURI(options.redirect);\n\t\n\t    // TODO: remove iframe for user login (at least) and render login page from here\n\t    // then remove this redirect\n\t    if (!options.show_welcome_with_login) {\n\t        var params = jQuery.param({ use_panels: 'True', redirect: redirect });\n\t        window.location.href = Galaxy.root + 'user/login?' + params;\n\t        return;\n\t    }\n\t\n\t    var loginPage = new PAGE.PageLayoutView(_.extend(options, {\n\t        el: 'body',\n\t        center: new PANEL.CenterPanel({ el: '#center' }),\n\t        right: new PANEL.RightPanel({\n\t            title: _l('Login required'),\n\t            el: '#right'\n\t        })\n\t    }));\n\t\n\t    $(function () {\n\t        // TODO: incorporate *actual* referrer/redirect info as the original page does\n\t        var params = jQuery.param({ redirect: redirect }),\n\t            loginUrl = Galaxy.root + 'user/login?' + params;\n\t        loginPage.render();\n\t\n\t        // welcome page (probably) needs to remain sandboxed\n\t        loginPage.center.$('#galaxy_main').prop('src', options.welcome_url);\n\t\n\t        loginPage.right.$('.unified-panel-body').css('overflow', 'hidden').html('<iframe src=\"' + loginUrl + '\" frameborder=\"0\" style=\"width: 100%; height: 100%;\"/>');\n\t    });\n\t};\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2)))\n\n/***/ },\n\n/***/ 4:\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(_, $, jQuery) {'use strict';\n\t\n\t/**\n\t * Galaxy utilities comprises small functions, which at this point\n\t * do not require their own classes/files\n\t*/\n\t\n\t// dependencies\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t\n\t    /** Builds a basic iframe\n\t    */\n\t    function iframe(src) {\n\t        return '<iframe src=\"' + src + '\" frameborder=\"0\" style=\"width: 100%; height: 100%;\"/>';\n\t    }\n\t\n\t    /** Traverse through json\n\t    */\n\t    function deepeach(dict, callback) {\n\t        for (var i in dict) {\n\t            var d = dict[i];\n\t            if (_.isObject(d)) {\n\t                var new_dict = callback(d);\n\t                new_dict && (dict[i] = new_dict);\n\t                deepeach(d, callback);\n\t            }\n\t        }\n\t    }\n\t\n\t    /**\n\t     * Check if a string is a json string\n\t     * @param{String}   text - Content to be validated\n\t     */\n\t    function isJSON(text) {\n\t        return (/^[\\],:{}\\s]*$/.test(text.replace(/\\\\[\"\\\\\\/bfnrtu]/g, '@').replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, ']').replace(/(?:^|:|,)(?:\\s*\\[)+/g, ''))\n\t        );\n\t    };\n\t\n\t    /**\n\t     * Sanitize/escape a string\n\t     * @param{String}   content - Content to be sanitized\n\t     */\n\t    function sanitize(content) {\n\t        return $('<div/>').text(content).html();\n\t    };\n\t\n\t    /**\n\t     * Checks if a value or list of values is `empty`\n\t     * usually used for selectable options\n\t     * @param{String}   value - Value or list to be validated\n\t     */\n\t    function isEmpty(value) {\n\t        if (!(value instanceof Array)) {\n\t            value = [value];\n\t        }\n\t        if (value.length === 0) {\n\t            return true;\n\t        }\n\t        for (var i in value) {\n\t            if (['__null__', '__undefined__', null, undefined].indexOf(value[i]) > -1) {\n\t                return true;\n\t            }\n\t        }\n\t        return false;\n\t    };\n\t\n\t    /**\n\t     * Convert list to pretty string\n\t     * @param{String}   lst - List of strings to be converted in human readable list sentence\n\t     */\n\t    function textify(lst) {\n\t        if ($.isArray(lst)) {\n\t            var lst = lst.toString().replace(/,/g, ', ');\n\t            var pos = lst.lastIndexOf(', ');\n\t            if (pos != -1) {\n\t                lst = lst.substr(0, pos) + ' or ' + lst.substr(pos + 2);\n\t            }\n\t            return lst;\n\t        }\n\t        return '';\n\t    };\n\t\n\t    /**\n\t     * Request handler for GET\n\t     * @param{String}   url     - Url request is made to\n\t     * @param{Function} success - Callback on success\n\t     * @param{Function} error   - Callback on error\n\t     * @param{Boolean}  cache   - Use cached data if available\n\t     */\n\t    function get(options) {\n\t        top.__utils__get__ = top.__utils__get__ || {};\n\t        var cache_key = JSON.stringify(options);\n\t        if (options.cache && top.__utils__get__[cache_key]) {\n\t            options.success && options.success(top.__utils__get__[cache_key]);\n\t            window.console.debug('utils.js::get() - Fetching from cache [' + options.url + '].');\n\t        } else {\n\t            request({\n\t                url: options.url,\n\t                data: options.data,\n\t                success: function success(response) {\n\t                    top.__utils__get__[cache_key] = response;\n\t                    options.success && options.success(response);\n\t                },\n\t                error: function error(response) {\n\t                    options.error && options.error(response);\n\t                }\n\t            });\n\t        }\n\t    };\n\t\n\t    /**\n\t     * Request handler\n\t     * @param{String}   method  - Request method ['GET', 'POST', 'DELETE', 'PUT']\n\t     * @param{String}   url     - Url request is made to\n\t     * @param{Object}   data    - Data send to url\n\t     * @param{Function} success - Callback on success\n\t     * @param{Function} error   - Callback on error\n\t     */\n\t    function request(options) {\n\t        // prepare ajax\n\t        var ajaxConfig = {\n\t            contentType: 'application/json',\n\t            type: options.type || 'GET',\n\t            data: options.data || {},\n\t            url: options.url\n\t        };\n\t        // encode data into url\n\t        if (ajaxConfig.type == 'GET' || ajaxConfig.type == 'DELETE') {\n\t            if (!$.isEmptyObject(ajaxConfig.data)) {\n\t                ajaxConfig.url += ajaxConfig.url.indexOf('?') == -1 ? '?' : '&';\n\t                ajaxConfig.url += $.param(ajaxConfig.data, true);\n\t            }\n\t            ajaxConfig.data = null;\n\t        } else {\n\t            ajaxConfig.dataType = 'json';\n\t            ajaxConfig.url = ajaxConfig.url;\n\t            ajaxConfig.data = JSON.stringify(ajaxConfig.data);\n\t        }\n\t\n\t        // make request\n\t        $.ajax(ajaxConfig).done(function (response) {\n\t            if (typeof response === 'string') {\n\t                try {\n\t                    response = response.replace('Infinity,', '\"Infinity\",');\n\t                    response = jQuery.parseJSON(response);\n\t                } catch (e) {\n\t                    console.debug(e);\n\t                }\n\t            }\n\t            options.success && options.success(response);\n\t        }).fail(function (response) {\n\t            var response_text = null;\n\t            try {\n\t                response_text = jQuery.parseJSON(response.responseText);\n\t            } catch (e) {\n\t                response_text = response.responseText;\n\t            }\n\t            options.error && options.error(response_text, response);\n\t        }).always(function () {\n\t            options.complete && options.complete();\n\t        });\n\t    };\n\t\n\t    /**\n\t     * Read a property value from CSS\n\t     * @param{String}   classname   - CSS class\n\t     * @param{String}   name        - CSS property\n\t     */\n\t    function cssGetAttribute(classname, name) {\n\t        var el = $('<div class=\"' + classname + '\"></div>');\n\t        el.appendTo(':eq(0)');\n\t        var value = el.css(name);\n\t        el.remove();\n\t        return value;\n\t    };\n\t\n\t    /**\n\t     * Load a CSS file\n\t     * @param{String}   url - Url of CSS file\n\t     */\n\t    function cssLoadFile(url) {\n\t        if (!$('link[href^=\"' + url + '\"]').length) {\n\t            $('<link href=\"' + Galaxy.root + url + '\" rel=\"stylesheet\">').appendTo('head');\n\t        }\n\t    };\n\t\n\t    /**\n\t     * Safely merge to dictionaries\n\t     * @param{Object}   options         - Target dictionary\n\t     * @param{Object}   optionsDefault  - Source dictionary\n\t     */\n\t    function merge(options, optionsDefault) {\n\t        if (options) {\n\t            return _.defaults(options, optionsDefault);\n\t        } else {\n\t            return optionsDefault;\n\t        }\n\t    };\n\t\n\t    /**\n\t     * Round floaing point 'number' to 'numPlaces' number of decimal places.\n\t     * @param{Object}   number      a floaing point number\n\t     * @param{Object}   numPlaces   number of decimal places\n\t     */\n\t    function roundToDecimalPlaces(number, numPlaces) {\n\t        var placesMultiplier = 1;\n\t        for (var i = 0; i < numPlaces; i++) {\n\t            placesMultiplier *= 10;\n\t        }\n\t        return Math.round(number * placesMultiplier) / placesMultiplier;\n\t    }\n\t\n\t    // calculate on import\n\t    var kb = 1024,\n\t        mb = kb * kb,\n\t        gb = mb * kb,\n\t        tb = gb * kb;\n\t    /**\n\t     * Format byte size to string with units\n\t     * @param{Integer}   size           - Size in bytes\n\t     * @param{Boolean}   normal_font    - Switches font between normal and bold\n\t     */\n\t    function bytesToString(size, normal_font, numberPlaces) {\n\t        numberPlaces = numberPlaces !== undefined ? numberPlaces : 1;\n\t        // identify unit\n\t        var unit = \"\";\n\t        if (size >= tb) {\n\t            size = size / tb;unit = 'TB';\n\t        } else if (size >= gb) {\n\t            size = size / gb;unit = 'GB';\n\t        } else if (size >= mb) {\n\t            size = size / mb;unit = 'MB';\n\t        } else if (size >= kb) {\n\t            size = size / kb;unit = 'KB';\n\t        } else if (size > 0) {\n\t            unit = 'b';\n\t        } else {\n\t            return normal_font ? '0 b' : '<strong>-</strong>';\n\t        }\n\t        // return formatted string\n\t        var rounded = unit == 'b' ? size : roundToDecimalPlaces(size, numberPlaces);\n\t        if (normal_font) {\n\t            return rounded + ' ' + unit;\n\t        } else {\n\t            return '<strong>' + rounded + '</strong> ' + unit;\n\t        }\n\t    };\n\t\n\t    /**\n\t     * Create a unique id\n\t     */\n\t    function uid() {\n\t        top.__utils__uid__ = top.__utils__uid__ || 0;\n\t        return 'uid-' + top.__utils__uid__++;\n\t    };\n\t\n\t    /**\n\t     * Create a time stamp\n\t     */\n\t    function time() {\n\t        var d = new Date();\n\t        var hours = (d.getHours() < 10 ? \"0\" : \"\") + d.getHours();\n\t        var minutes = (d.getMinutes() < 10 ? \"0\" : \"\") + d.getMinutes();\n\t        return datetime = d.getDate() + \"/\" + (d.getMonth() + 1) + \"/\" + d.getFullYear() + \", \" + hours + \":\" + minutes;\n\t    };\n\t\n\t    return {\n\t        cssLoadFile: cssLoadFile,\n\t        cssGetAttribute: cssGetAttribute,\n\t        get: get,\n\t        merge: merge,\n\t        iframe: iframe,\n\t        bytesToString: bytesToString,\n\t        uid: uid,\n\t        time: time,\n\t        request: request,\n\t        sanitize: sanitize,\n\t        textify: textify,\n\t        isEmpty: isEmpty,\n\t        deepeach: deepeach,\n\t        isJSON: isJSON\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(1)))\n\n/***/ },\n\n/***/ 8:\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {'use strict';\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t    var View = Backbone.View.extend({\n\t        // defaults\n\t        optionsDefault: {\n\t            container: 'body',\n\t            title: 'ui-modal',\n\t            cls: 'ui-modal',\n\t            body: '',\n\t            backdrop: true,\n\t            height: null,\n\t            width: null,\n\t            closing_events: false,\n\t            closing_callback: null,\n\t            title_separator: true\n\t        },\n\t\n\t        // button list\n\t        buttonList: {},\n\t\n\t        // initialize\n\t        initialize: function initialize(options) {\n\t            this.setElement(this._template());\n\t            this.options = _.defaults(options || {}, this.optionsDefault);\n\t            $(this.options.container).prepend(this.el);\n\t\n\t            // link elements\n\t            this.$header = this.$('.modal-header');\n\t            this.$dialog = this.$('.modal-dialog');\n\t            this.$body = this.$('.modal-body');\n\t            this.$footer = this.$('.modal-footer');\n\t            this.$backdrop = this.$('.modal-backdrop');\n\t            this.$buttons = this.$('.buttons');\n\t\n\t            // optional render\n\t            options && this.render();\n\t        },\n\t\n\t        /**\n\t         * Displays modal\n\t        */\n\t        show: function show(options) {\n\t            if (options) {\n\t                this.options = _.defaults(options, this.optionsDefault);\n\t                this.render();\n\t            }\n\t            if (!this.visible) {\n\t                this.visible = true;\n\t                this.$el.fadeIn('fast');\n\t                if (this.options.closing_events) {\n\t                    var self = this;\n\t                    $(document).on('keyup.ui-modal', function (e) {\n\t                        e.keyCode == 27 && self.hide(true);\n\t                    });\n\t                    this.$backdrop.on('click', function () {\n\t                        self.hide(true);\n\t                    });\n\t                }\n\t            }\n\t        },\n\t\n\t        /**\n\t         * Hide modal\n\t        */\n\t        hide: function hide(canceled) {\n\t            this.visible = false;\n\t            this.$el.fadeOut('fast');\n\t            this.options.closing_callback && this.options.closing_callback(canceled);\n\t            $(document).off('keyup.ui-modal');\n\t            this.$backdrop.off('click');\n\t        },\n\t\n\t        /**\n\t         * Render modal\n\t        */\n\t        render: function render() {\n\t            var self = this;\n\t            if (this.options.body == 'progress') {\n\t                this.options.body = $('<div class=\"progress progress-striped active\">' + '<div class=\"progress-bar progress-bar-info\" style=\"width:100%\"/>' + '</div>');\n\t            }\n\t\n\t            // fix main content\n\t            this.$el.removeClass().addClass('modal').addClass(this.options.cls);\n\t            this.$header.find('.title').html(this.options.title);\n\t            this.$body.html(this.options.body);\n\t\n\t            // append buttons\n\t            this.$buttons.empty();\n\t            this.buttonList = {};\n\t            if (this.options.buttons) {\n\t                var counter = 0;\n\t                $.each(this.options.buttons, function (name, callback) {\n\t                    var $button = $('<button/>').attr('id', 'button-' + counter++).text(name).click(callback);\n\t                    self.$buttons.append($button).append('&nbsp;');\n\t                    self.buttonList[name] = $button;\n\t                });\n\t            } else {\n\t                this.$footer.hide();\n\t            }\n\t\n\t            // configure background, separator line\n\t            this.$backdrop[this.options.backdrop && 'addClass' || 'removeClass']('in');\n\t            this.$header[!this.options.title_separator && 'addClass' || 'removeClass']('no-separator');\n\t\n\t            // fix dimensions\n\t            if (this.options.height) {\n\t                this.$body.css('height', this.options.height);\n\t                this.$body.css('overflow', 'hidden');\n\t            } else {\n\t                this.$body.css('max-height', $(window).height() / 2);\n\t            }\n\t            if (this.options.width) {\n\t                this.$dialog.css('width', this.options.width);\n\t            }\n\t        },\n\t\n\t        /**\n\t         * Returns the button dom\n\t         * @param{String}   name    - Button name/title\n\t        */\n\t        getButton: function getButton(name) {\n\t            return this.buttonList[name];\n\t        },\n\t\n\t        /**\n\t         * Enables a button\n\t         * @param{String}   name    - Button name/title\n\t        */\n\t        enableButton: function enableButton(name) {\n\t            this.getButton(name).prop('disabled', false);\n\t        },\n\t\n\t        /**\n\t         * Disables a button\n\t         * @param{String}   name    - Button name/title\n\t        */\n\t        disableButton: function disableButton(name) {\n\t            this.getButton(name).prop('disabled', true);\n\t        },\n\t\n\t        /**\n\t         * Show a button\n\t         * @param{String}   name    - Button name/title\n\t        */\n\t        showButton: function showButton(name) {\n\t            this.getButton(name).show();\n\t        },\n\t\n\t        /**\n\t         * Hide a button\n\t         * @param{String}   name    - Button name/title\n\t        */\n\t        hideButton: function hideButton(name) {\n\t            this.getButton(name).hide();\n\t        },\n\t\n\t        /**\n\t         * Returns scroll top for body element\n\t        */\n\t        scrollTop: function scrollTop() {\n\t            return this.$body.scrollTop();\n\t        },\n\t\n\t        /**\n\t         * Returns the modal template\n\t        */\n\t        _template: function _template() {\n\t            return '<div class=\"ui-modal\">' + '<div class=\"modal-backdrop fade\"/>' + '<div class=\"modal-dialog\">' + '<div class=\"modal-content\">' + '<div class=\"modal-header\">' + '<h4 class=\"title\"/>' + '</div>' + '<div class=\"modal-body\"/>' + '<div class=\"modal-footer\">' + '<div class=\"buttons\"/>' + '</div>' + '</div>' + '</div>' + '</div>';\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n\n/***/ 16:\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {'use strict';\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t\n\t    /** Frame view */\n\t    var FrameView = Backbone.View.extend({\n\t        initialize: function initialize(options) {\n\t            var self = this;\n\t            this.model = options && options.model || new Backbone.Model(options);\n\t            this.setElement($('<div/>').addClass('corner frame'));\n\t            this.$el.append($('<div/>').addClass('f-header corner').append($('<div/>').addClass('f-title')).append($('<div/>').addClass('f-icon f-close fa fa-close').tooltip({ title: 'Close', placement: 'bottom' }))).append($('<div/>').addClass('f-content')).append($('<div/>').addClass('f-resize f-icon corner fa fa-expand').tooltip({ title: 'Resize' })).append($('<div/>').addClass('f-cover'));\n\t            this.$header = this.$('.f-header');\n\t            this.$title = this.$('.f-title');\n\t            this.$content = this.$('.f-content');\n\t            this.render();\n\t            this.listenTo(this.model, 'change', this.render, this);\n\t        },\n\t\n\t        render: function render() {\n\t            var self = this;\n\t            var options = this.model.attributes;\n\t            this.$title.html(options.title || '');\n\t            this.$header.find('.f-icon-left').remove();\n\t            _.each(options.menu, function (option) {\n\t                var $option = $('<div/>').addClass('f-icon-left').addClass(option.icon);\n\t                if (_.isFunction(option.disabled) && option.disabled()) {\n\t                    $option.attr('disabled', true);\n\t                } else {\n\t                    $option.on('click', function () {\n\t                        option.onclick(self);\n\t                    }).tooltip({ title: option.tooltip, placement: 'bottom' });\n\t                }\n\t                self.$header.append($option);\n\t            });\n\t            if (options.url) {\n\t                this.$content.html($('<iframe/>').addClass('f-iframe').attr('scrolling', 'auto').attr('src', options.url + (options.url.indexOf('?') === -1 ? '?' : '&') + 'widget=True'));\n\t            } else if (options.content) {\n\t                _.isFunction(options.content) ? options.content(self.$content) : self.$content.html(options.content);\n\t            }\n\t        }\n\t    });\n\t\n\t    /** Scratchbook viewer */\n\t    var View = Backbone.View.extend({\n\t        defaultOptions: {\n\t            frame: { // default frame size in cells\n\t                cols: 6,\n\t                rows: 3\n\t            },\n\t            rows: 1000, // maximum number of rows\n\t            cell: 130, // cell size in px\n\t            margin: 5, // margin between frames\n\t            scroll: 5, // scroll speed\n\t            top_min: 40, // top margin\n\t            frame_max: 9, // maximum number of frames\n\t            visible: true },\n\t\n\t        cols: 0, // number of columns\n\t        top: 0, // scroll/element top\n\t        top_max: 0, // viewport scrolling state\n\t        frame_z: 0, // frame z-index\n\t        frame_counter: 0, // frame counter\n\t        frame_uid: 0, // unique frame id counter\n\t        frame_list: {}, // list of all frames\n\t        frame_shadow: null, // frame shown as placeholder when moving active frames\n\t        visible: false, // flag indicating if scratchbook viewer is visible or not\n\t        event: {}, // dictionary keeping track of current event\n\t\n\t        initialize: function initialize(options) {\n\t            var self = this;\n\t            this.options = _.defaults(options || {}, this.defaultOptions);\n\t            this.visible = this.options.visible;\n\t            this.top = this.top_max = this.options.top_min;\n\t            this.setElement($('<div/>').addClass('galaxy-frame').append($('<div/>').addClass('frame-background')).append($('<div/>').addClass('frame-menu frame-scroll-up fa fa-chevron-up fa-2x')).append($('<div/>').addClass('frame-menu frame-scroll-down fa fa-chevron-down fa-2x')));\n\t\n\t            // initialize shadow to guiding drag/resize events\n\t            this.frame_shadow = new Backbone.View({ el: $('<div/>').addClass('corner frame-shadow') });\n\t            this.$el.append(this.frame_shadow.$el);\n\t            this._frameInit(this.frame_shadow, '#frame-shadow');\n\t            this._frameResize(this.frame_shadow, { width: 0, height: 0 });\n\t            this.frame_list['#frame-shadow'] = this.frame_shadow;\n\t\n\t            // initialize panel\n\t            this.visible ? this.show() : this.hide();\n\t            this._panelRefresh();\n\t            $(window).resize(function () {\n\t                self.visible && self._panelRefresh();\n\t            });\n\t        },\n\t\n\t        /** Render */\n\t        render: function render() {\n\t            this.$('.frame-scroll-up')[this.top != this.options.top_min && 'show' || 'hide']();\n\t            this.$('.frame-scroll-down')[this.top != this.top_max && 'show' || 'hide']();\n\t        },\n\t\n\t        /**\n\t         * Adds and displays a new frame.\n\t         *\n\t         * options:\n\t         *  url     : loaded into an iframe\n\t         *  content : content is treated as a function or raw HTML, function is passed a single\n\t         *              argument that is the frame's content DOM element\n\t         */\n\t        add: function add(options) {\n\t            if (this.frame_counter >= this.options.frame_max) {\n\t                Galaxy.modal.show({\n\t                    title: 'Warning',\n\t                    body: 'You have reached the maximum number of allowed frames (' + this.options.frame_max + ').',\n\t                    buttons: { 'Close': function Close() {\n\t                            Galaxy.modal.hide();\n\t                        } }\n\t                });\n\t            } else {\n\t                var frame_id = '#frame-' + this.frame_uid++;\n\t                if ($(frame_id).length !== 0) {\n\t                    Galaxy.modal.show({\n\t                        title: 'Error',\n\t                        body: 'This frame already exists. This page might contain multiple frame managers.',\n\t                        buttons: { 'Close': function Close() {\n\t                                Galaxy.modal.hide();\n\t                            } }\n\t                    });\n\t                } else {\n\t                    // initialize new frame elements\n\t                    this.top = this.options.top_min;\n\t                    var frame = new FrameView(options);\n\t                    this.$el.append(frame.$el);\n\t\n\t                    // set dimensions\n\t                    options.width = this._toPixelCoord('width', this.options.frame.cols);\n\t                    options.height = this._toPixelCoord('height', this.options.frame.rows);\n\t\n\t                    // set default z-index and add to ui and frame list\n\t                    this.frame_z = parseInt(frame.$el.css('z-index'));\n\t                    this.frame_list[frame_id] = frame;\n\t                    this.frame_counter++;\n\t                    this._frameInit(frame, frame_id);\n\t                    this._frameResize(frame, { width: options.width, height: options.height });\n\t                    this._frameInsert(frame, { top: 0, left: 0 }, true);\n\t                    !this.visible && this.show();\n\t                    this.trigger('add');\n\t                }\n\t            }\n\t        },\n\t\n\t        /** Remove a frame */\n\t        del: function del(frame) {\n\t            var self = this;\n\t            var $frame = frame.$el;\n\t            $frame.fadeOut('fast', function () {\n\t                $frame.remove();\n\t                delete self.frame_list[frame.id];\n\t                self.frame_counter--;\n\t                self._panelRefresh(true);\n\t                self._panelAnimationComplete();\n\t                self.trigger('remove');\n\t            });\n\t        },\n\t\n\t        /** Show panel */\n\t        show: function show() {\n\t            this.visible = true;\n\t            this.$el.fadeIn('fast');\n\t            this.trigger('show');\n\t        },\n\t\n\t        /** Hide panel */\n\t        hide: function hide() {\n\t            if (!this.event.type) {\n\t                this.visible = false;\n\t                this.$el.fadeOut('fast', function () {\n\t                    $(this).hide();\n\t                });\n\t                this.trigger('hide');\n\t            }\n\t        },\n\t\n\t        /** Returns the number of frames */\n\t        length: function length() {\n\t            return this.frame_counter;\n\t        },\n\t\n\t        /*\n\t            EVENT HANDLING\n\t        */\n\t        events: {\n\t            // global frame events\n\t            'mousemove': '_eventFrameMouseMove',\n\t            'mouseup': '_eventFrameMouseUp',\n\t            'mouseleave': '_eventFrameMouseUp',\n\t            'mousewheel': '_eventPanelScroll',\n\t            'DOMMouseScroll': '_eventPanelScroll',\n\t\n\t            // events fixed to elements\n\t            'mousedown .frame': '_eventFrameMouseDown',\n\t            'mousedown .frame-background': '_eventHide',\n\t            'mousedown .frame-scroll-up': '_eventPanelScroll_up',\n\t            'mousedown .frame-scroll-down': '_eventPanelScroll_down',\n\t            'mousedown .f-close': '_eventFrameClose'\n\t        },\n\t\n\t        /** Start drag/resize event */\n\t        _eventFrameMouseDown: function _eventFrameMouseDown(e) {\n\t            $('.tooltip').hide();\n\t            if (!this.event.type) {\n\t                if ($(e.target).hasClass('f-header') || $(e.target).hasClass('f-title')) {\n\t                    this.event.type = 'drag';\n\t                }\n\t                if ($(e.target).hasClass('f-resize')) {\n\t                    this.event.type = 'resize';\n\t                }\n\t                if (this.event.type) {\n\t                    e.preventDefault();\n\t                    this.event.target = this._frameIdentify(e.target);\n\t                    this.event.xy = {\n\t                        x: e.originalEvent.pageX,\n\t                        y: e.originalEvent.pageY\n\t                    };\n\t                    this._frameDragStart(this.event.target);\n\t                }\n\t            }\n\t        },\n\t\n\t        /** Processes drag/resize events */\n\t        _eventFrameMouseMove: function _eventFrameMouseMove(e) {\n\t            if (this.event.type) {\n\t                // get mouse motion and delta\n\t                var event_xy_new = {\n\t                    x: e.originalEvent.pageX,\n\t                    y: e.originalEvent.pageY\n\t                };\n\t                var event_xy_delta = {\n\t                    x: event_xy_new.x - this.event.xy.x,\n\t                    y: event_xy_new.y - this.event.xy.y\n\t                };\n\t                this.event.xy = event_xy_new;\n\t\n\t                // get current screen position and size of frame\n\t                var p = this._frameScreen(this.event.target);\n\t\n\t                // drag/resize event\n\t                if (this.event.type == 'resize') {\n\t                    p.width += event_xy_delta.x;\n\t                    p.height += event_xy_delta.y;\n\t                    var min_dim = this.options.cell - this.options.margin - 1;\n\t                    p.width = Math.max(p.width, min_dim);\n\t                    p.height = Math.max(p.height, min_dim);\n\t                    this._frameResize(this.event.target, p);\n\t                    p.width = this._toGridCoord('width', p.width) + 1;\n\t                    p.height = this._toGridCoord('height', p.height) + 1;\n\t                    p.width = this._toPixelCoord('width', p.width);\n\t                    p.height = this._toPixelCoord('height', p.height);\n\t                    this._frameResize(this.frame_shadow, p);\n\t                    this._frameInsert(this.frame_shadow, {\n\t                        top: this._toGridCoord('top', p.top),\n\t                        left: this._toGridCoord('left', p.left)\n\t                    });\n\t                } else if (this.event.type == 'drag') {\n\t                    p.left += event_xy_delta.x;\n\t                    p.top += event_xy_delta.y;\n\t                    this._frameOffset(this.event.target, p);\n\t                    var l = {\n\t                        top: this._toGridCoord('top', p.top),\n\t                        left: this._toGridCoord('left', p.left)\n\t                    };\n\t                    l.left !== 0 && l.left++;\n\t                    this._frameInsert(this.frame_shadow, l);\n\t                }\n\t            }\n\t        },\n\t\n\t        /** Stop drag/resize events */\n\t        _eventFrameMouseUp: function _eventFrameMouseUp(e) {\n\t            if (this.event.type) {\n\t                this._frameDragStop(this.event.target);\n\t                this.event.type = null;\n\t            }\n\t        },\n\t\n\t        /** Destroy a frame */\n\t        _eventFrameClose: function _eventFrameClose(e) {\n\t            if (!this.event.type) {\n\t                e.preventDefault();\n\t                this.del(this._frameIdentify(e.target));\n\t            }\n\t        },\n\t\n\t        /** Hide all frames */\n\t        _eventHide: function _eventHide(e) {\n\t            !this.event.type && this.hide();\n\t        },\n\t\n\t        /** Fired when scrolling occurs on panel */\n\t        _eventPanelScroll: function _eventPanelScroll(e) {\n\t            if (!this.event.type && this.visible) {\n\t                // Stop propagation if scrolling is happening inside a frame.\n\t                // TODO: could propagate scrolling if at top/bottom of frame.\n\t                var frames = $(e.srcElement).parents('.frame');\n\t                if (frames.length !== 0) {\n\t                    e.stopPropagation();\n\t                } else {\n\t                    e.preventDefault();\n\t                    this._panelScroll(e.originalEvent.detail ? e.originalEvent.detail : e.originalEvent.wheelDelta / -3);\n\t                }\n\t            }\n\t        },\n\t\n\t        /** Handle scroll up event */\n\t        _eventPanelScroll_up: function _eventPanelScroll_up(e) {\n\t            if (!this.event.type) {\n\t                e.preventDefault();\n\t                this._panelScroll(-this.options.scroll);\n\t            }\n\t        },\n\t\n\t        /** Handle scroll down */\n\t        _eventPanelScroll_down: function _eventPanelScroll_down(e) {\n\t            if (!this.event.type) {\n\t                e.preventDefault();\n\t                this._panelScroll(this.options.scroll);\n\t            }\n\t        },\n\t\n\t        /*\n\t            FRAME EVENTS SUPPORT\n\t        */\n\t\n\t        /** Identify the target frame */\n\t        _frameIdentify: function _frameIdentify(target) {\n\t            return this.frame_list['#' + $(target).closest('.frame').attr('id')];\n\t        },\n\t\n\t        /** Provides drag support */\n\t        _frameDragStart: function _frameDragStart(frame) {\n\t            this._frameFocus(frame, true);\n\t            var p = this._frameScreen(frame);\n\t            this._frameResize(this.frame_shadow, p);\n\t            this._frameGrid(this.frame_shadow, frame.grid_location);\n\t            frame.grid_location = null;\n\t            this.frame_shadow.$el.show();\n\t            $('.f-cover').show();\n\t        },\n\t\n\t        /** Removes drag support */\n\t        _frameDragStop: function _frameDragStop(frame) {\n\t            this._frameFocus(frame, false);\n\t            var p = this._frameScreen(this.frame_shadow);\n\t            this._frameResize(frame, p);\n\t            this._frameGrid(frame, this.frame_shadow.grid_location, true);\n\t            this.frame_shadow.grid_location = null;\n\t            this.frame_shadow.$el.hide();\n\t            $('.f-cover').hide();\n\t            this._panelAnimationComplete();\n\t        },\n\t\n\t        /*\n\t            GRID/PIXEL CONVERTER\n\t        */\n\t\n\t        /** Converts a pixel to a grid dimension */\n\t        _toGridCoord: function _toGridCoord(type, px) {\n\t            var sign = type == 'width' || type == 'height' ? 1 : -1;\n\t            type == 'top' && (px -= this.top);\n\t            return parseInt((px + sign * this.options.margin) / this.options.cell, 10);\n\t        },\n\t\n\t        /** Converts a grid to a pixels dimension */\n\t        _toPixelCoord: function _toPixelCoord(type, g) {\n\t            var sign = type == 'width' || type == 'height' ? 1 : -1;\n\t            var px = g * this.options.cell - sign * this.options.margin;\n\t            type == 'top' && (px += this.top);\n\t            return px;\n\t        },\n\t\n\t        /** Converts a pixel to a grid coordinate set */\n\t        _toGrid: function _toGrid(px) {\n\t            return {\n\t                top: this._toGridCoord('top', px.top),\n\t                left: this._toGridCoord('left', px.left),\n\t                width: this._toGridCoord('width', px.width),\n\t                height: this._toGridCoord('height', px.height)\n\t            };\n\t        },\n\t\n\t        /** Converts a pixel to a grid coordinate set */\n\t        _toPixel: function _toPixel(g) {\n\t            return {\n\t                top: this._toPixelCoord('top', g.top),\n\t                left: this._toPixelCoord('left', g.left),\n\t                width: this._toPixelCoord('width', g.width),\n\t                height: this._toPixelCoord('height', g.height)\n\t            };\n\t        },\n\t\n\t        /* \n\t            COLLISION DETECTION\n\t        */\n\t\n\t        /** Check collisions for a grid coordinate set */\n\t        _isCollision: function _isCollision(g) {\n\t            function is_collision_pair(a, b) {\n\t                return !(a.left > b.left + b.width - 1 || a.left + a.width - 1 < b.left || a.top > b.top + b.height - 1 || a.top + a.height - 1 < b.top);\n\t            }\n\t            for (var i in this.frame_list) {\n\t                var frame = this.frame_list[i];\n\t                if (frame.grid_location !== null && is_collision_pair(g, frame.grid_location)) {\n\t                    return true;\n\t                }\n\t            }\n\t            return false;\n\t        },\n\t\n\t        /** Return location/grid rank */\n\t        _locationRank: function _locationRank(loc) {\n\t            return loc.top * this.cols + loc.left;\n\t        },\n\t\n\t        /*\n\t            PANEL/WINDOW FUNCTIONS\n\t        */\n\t\n\t        /** Refresh panel */\n\t        _panelRefresh: function _panelRefresh(animate) {\n\t            this.cols = parseInt($(window).width() / this.options.cell, 10) + 1;\n\t            this._frameInsert(null, null, animate);\n\t        },\n\t\n\t        /** Complete panel animation / frames not moving */\n\t        _panelAnimationComplete: function _panelAnimationComplete() {\n\t            var self = this;\n\t            $('.frame').promise().done(function () {\n\t                self._panelScroll(0, true);\n\t            });\n\t        },\n\t\n\t        /** Scroll panel */\n\t        _panelScroll: function _panelScroll(delta, animate) {\n\t            var top_new = this.top - this.options.scroll * delta;\n\t            top_new = Math.max(top_new, this.top_max);\n\t            top_new = Math.min(top_new, this.options.top_min);\n\t            if (this.top != top_new) {\n\t                for (var i in this.frame_list) {\n\t                    var frame = this.frame_list[i];\n\t                    if (frame.grid_location !== null) {\n\t                        var screen_location = {\n\t                            top: frame.screen_location.top - (this.top - top_new),\n\t                            left: frame.screen_location.left\n\t                        };\n\t                        this._frameOffset(frame, screen_location, animate);\n\t                    }\n\t                }\n\t                this.top = top_new;\n\t            }\n\t            this.render();\n\t        },\n\t\n\t        /*\n\t            FRAME FUNCTIONS\n\t        */\n\t\n\t        /** Initialize a new frame */\n\t        _frameInit: function _frameInit(frame, id) {\n\t            frame.id = id;\n\t            frame.screen_location = {};\n\t            frame.grid_location = {};\n\t            frame.grid_rank = null;\n\t            frame.$el.attr('id', id.substring(1));\n\t        },\n\t\n\t        /** Insert frame at given location */\n\t        _frameInsert: function _frameInsert(frame, new_loc, animate) {\n\t            var self = this;\n\t            var place_list = [];\n\t            if (frame) {\n\t                frame.grid_location = null;\n\t                place_list.push([frame, this._locationRank(new_loc)]);\n\t            }\n\t            _.each(this.frame_list, function (f) {\n\t                if (f.grid_location !== null) {\n\t                    f.grid_location = null;\n\t                    place_list.push([f, f.grid_rank]);\n\t                }\n\t            });\n\t            place_list.sort(function (a, b) {\n\t                return a[1] < b[1] ? -1 : a[1] > b[1] ? 1 : 0;\n\t            });\n\t            _.each(place_list, function (place) {\n\t                self._framePlace(place[0], animate);\n\t            });\n\t            this.top_max = 0;\n\t            _.each(this.frame_list, function (f) {\n\t                if (f.grid_location !== null) {\n\t                    self.top_max = Math.max(self.top_max, f.grid_location.top + f.grid_location.height);\n\t                }\n\t            });\n\t            this.top_max = $(window).height() - this.top_max * this.options.cell - 2 * this.options.margin;\n\t            this.top_max = Math.min(this.top_max, this.options.top_min);\n\t            this.render();\n\t        },\n\t\n\t        /** Naive frame placement */\n\t        _framePlace: function _framePlace(frame, animate) {\n\t            frame.grid_location = null;\n\t            var g = this._toGrid(this._frameScreen(frame));\n\t            var done = false;\n\t            for (var i = 0; i < this.options.rows; i++) {\n\t                for (var j = 0; j < Math.max(1, this.cols - g.width); j++) {\n\t                    g.top = i;\n\t                    g.left = j;\n\t                    if (!this._isCollision(g)) {\n\t                        done = true;\n\t                        break;\n\t                    }\n\t                }\n\t                if (done) {\n\t                    break;\n\t                }\n\t            }\n\t            if (done) {\n\t                this._frameGrid(frame, g, animate);\n\t            } else {\n\t                console.log('Grid dimensions exceeded.');\n\t            }\n\t        },\n\t\n\t        /** Handle frame focussing */\n\t        _frameFocus: function _frameFocus(frame, has_focus) {\n\t            frame.$el.css('z-index', this.frame_z + (has_focus ? 1 : 0));\n\t        },\n\t\n\t        /** New left/top position frame */\n\t        _frameOffset: function _frameOffset(frame, p, animate) {\n\t            frame.screen_location.left = p.left;\n\t            frame.screen_location.top = p.top;\n\t            if (animate) {\n\t                this._frameFocus(frame, true);\n\t                var self = this;\n\t                frame.$el.animate({ top: p.top, left: p.left }, 'fast', function () {\n\t                    self._frameFocus(frame, false);\n\t                });\n\t            } else {\n\t                frame.$el.css({ top: p.top, left: p.left });\n\t            }\n\t        },\n\t\n\t        /** Resize frame */\n\t        _frameResize: function _frameResize(frame, p) {\n\t            frame.$el.css({ width: p.width, height: p.height });\n\t            frame.screen_location.width = p.width;\n\t            frame.screen_location.height = p.height;\n\t        },\n\t\n\t        /** Push frame to new grid location */\n\t        _frameGrid: function _frameGrid(frame, l, animate) {\n\t            frame.grid_location = l;\n\t            this._frameOffset(frame, this._toPixel(l), animate);\n\t            frame.grid_rank = this._locationRank(l);\n\t        },\n\t\n\t        /** Get frame dimensions */\n\t        _frameScreen: function _frameScreen(frame) {\n\t            var p = frame.screen_location;\n\t            return { top: p.top, left: p.left, width: p.width, height: p.height };\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n\n/***/ 29:\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;'use strict';\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(2), __webpack_require__(3), __webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (_, Backbone, baseMVC, _l) {\n\t    'use strict';\n\t\n\t    var logNamespace = 'user';\n\t    //==============================================================================\n\t    /** @class Model for a Galaxy user (including anonymous users).\n\t     *  @name User\n\t     */\n\t    var User = Backbone.Model.extend(baseMVC.LoggableMixin).extend(\n\t    /** @lends User.prototype */{\n\t        _logNamespace: logNamespace,\n\t\n\t        /** API location for this resource */\n\t        urlRoot: function urlRoot() {\n\t            return Galaxy.root + 'api/users';\n\t        },\n\t\n\t        /** Model defaults\n\t         *  Note: don't check for anon-users with the username as the default is '(anonymous user)'\n\t         *      a safer method is if( !user.get( 'email' ) ) -> anon user\n\t         */\n\t        defaults: /** @lends User.prototype */{\n\t            id: null,\n\t            username: '(' + _l(\"anonymous user\") + ')',\n\t            email: \"\",\n\t            total_disk_usage: 0,\n\t            nice_total_disk_usage: \"\",\n\t            quota_percent: null,\n\t            is_admin: false\n\t        },\n\t\n\t        /** Set up and bind events\n\t         *  @param {Object} data Initial model data.\n\t         */\n\t        initialize: function initialize(data) {\n\t            this.log('User.initialize:', data);\n\t\n\t            this.on('loaded', function (model, resp) {\n\t                this.log(this + ' has loaded:', model, resp);\n\t            });\n\t            this.on('change', function (model, data) {\n\t                this.log(this + ' has changed:', model, data.changes);\n\t            });\n\t        },\n\t\n\t        isAnonymous: function isAnonymous() {\n\t            return !this.get('email');\n\t        },\n\t\n\t        isAdmin: function isAdmin() {\n\t            return this.get('is_admin');\n\t        },\n\t\n\t        /** Load a user with the API using an id.\n\t         *      If getting an anonymous user or no access to a user id, pass the User.CURRENT_ID_STR\n\t         *      (e.g. 'current') and the API will return the current transaction's user data.\n\t         *  @param {String} idOrCurrent encoded user id or the User.CURRENT_ID_STR\n\t         *  @param {Object} options hash to pass to Backbone.Model.fetch. Can contain success, error fns.\n\t         *  @fires loaded when the model has been loaded from the API, passing the newModel and AJAX response.\n\t         */\n\t        loadFromApi: function loadFromApi(idOrCurrent, options) {\n\t            idOrCurrent = idOrCurrent || User.CURRENT_ID_STR;\n\t\n\t            options = options || {};\n\t            var model = this,\n\t                userFn = options.success;\n\t\n\t            /** @ignore */\n\t            options.success = function (newModel, response) {\n\t                model.trigger('loaded', newModel, response);\n\t                if (userFn) {\n\t                    userFn(newModel, response);\n\t                }\n\t            };\n\t\n\t            // requests for the current user must have a sep. constructed url (fetch don't work, ma)\n\t            if (idOrCurrent === User.CURRENT_ID_STR) {\n\t                options.url = this.urlRoot + '/' + User.CURRENT_ID_STR;\n\t            }\n\t            return Backbone.Model.prototype.fetch.call(this, options);\n\t        },\n\t\n\t        /** Clears all data from the sessionStorage.\n\t         */\n\t        clearSessionStorage: function clearSessionStorage() {\n\t            for (var key in sessionStorage) {\n\t                //TODO: store these under the user key so we don't have to do this\n\t                // currently only history\n\t                if (key.indexOf('history:') === 0) {\n\t                    sessionStorage.removeItem(key);\n\t                } else if (key === 'history-panel') {\n\t                    sessionStorage.removeItem(key);\n\t                }\n\t            }\n\t        },\n\t\n\t        /** string representation */\n\t        toString: function toString() {\n\t            var userInfo = [this.get('username')];\n\t            if (this.get('id')) {\n\t                userInfo.unshift(this.get('id'));\n\t                userInfo.push(this.get('email'));\n\t            }\n\t            return 'User(' + userInfo.join(':') + ')';\n\t        }\n\t    });\n\t\n\t    // string to send to tell server to return this transaction's user (see api/users.py)\n\t    User.CURRENT_ID_STR = 'current';\n\t\n\t    // class method to load the current user via the api and return that model\n\t    User.getCurrentUserFromApi = function (options) {\n\t        var currentUser = new User();\n\t        currentUser.loadFromApi(User.CURRENT_ID_STR, options);\n\t        return currentUser;\n\t    };\n\t\n\t    // (stub) collection for users (shouldn't be common unless admin UI)\n\t    var UserCollection = Backbone.Collection.extend(baseMVC.LoggableMixin).extend({\n\t        model: User,\n\t        urlRoot: function urlRoot() {\n\t            return Galaxy.root + 'api/users';\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    return {\n\t        User: User\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/***/ },\n\n/***/ 31:\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function($) {'use strict';\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(2), __webpack_require__(3), __webpack_require__(6), __webpack_require__(29), __webpack_require__(66), __webpack_require__(63), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (_, Backbone, BASE_MVC, userModel, metricsLogger, addLogging, localize) {\n\t\n\t    // TODO: move into a singleton pattern and have dependents import Galaxy\n\t    // ============================================================================\n\t    /** Base galaxy client-side application.\n\t     *      Iniitializes:\n\t     *          logger      : the logger/metrics-logger\n\t     *          localize    : the string localizer\n\t     *          config      : the current configuration (any k/v in\n\t     *              galaxy.ini available from the configuration API)\n\t     *          user        : the current user (as a mvc/user/user-model)\n\t     */\n\t    function GalaxyApp(options, bootstrapped) {\n\t        var self = this;\n\t        return self._init(options || {}, bootstrapped || {});\n\t    }\n\t\n\t    // add logging shortcuts for this object\n\t    addLogging(GalaxyApp, 'GalaxyApp');\n\t\n\t    // a debug flag can be set via local storage and made available during script/page loading\n\t    var DEBUGGING_KEY = 'galaxy:debug',\n\t        NAMESPACE_KEY = DEBUGGING_KEY + ':namespaces',\n\t        localDebugging = false;\n\t    try {\n\t        localDebugging = localStorage.getItem(DEBUGGING_KEY) == 'true';\n\t    } catch (storageErr) {\n\t        console.log(localize('localStorage not available for debug flag retrieval'));\n\t    }\n\t\n\t    /** initalize options and sub-components */\n\t    GalaxyApp.prototype._init = function __init(options, bootstrapped) {\n\t        var self = this;\n\t        _.extend(self, Backbone.Events);\n\t        if (localDebugging) {\n\t            self.logger = console;\n\t            console.debug('debugging galaxy:', 'options:', options, 'bootstrapped:', bootstrapped);\n\t        }\n\t\n\t        self._processOptions(options);\n\t        // special case for root\n\t        self.root = options.root || '/';\n\t\n\t        self._initConfig(options.config || {});\n\t        self._patchGalaxy(window.Galaxy);\n\t\n\t        self._initLogger(self.options.loggerOptions || {});\n\t        // at this point, either logging or not and namespaces are enabled - chat it up\n\t        self.debug('GalaxyApp.options: ', self.options);\n\t        self.debug('GalaxyApp.config: ', self.config);\n\t        self.debug('GalaxyApp.logger: ', self.logger);\n\t\n\t        self._initLocale();\n\t        self.debug('GalaxyApp.localize: ', self.localize);\n\t\n\t        self.config = options.config || {};\n\t        self.debug('GalaxyApp.config: ', self.config);\n\t\n\t        self._initUser(options.user || {});\n\t        self.debug('GalaxyApp.user: ', self.user);\n\t\n\t        self._setUpListeners();\n\t        self.trigger('ready', self);\n\t\n\t        return self;\n\t    };\n\t\n\t    /** default options */\n\t    GalaxyApp.prototype.defaultOptions = {\n\t        /** monkey patch attributes from existing window.Galaxy object? */\n\t        patchExisting: true,\n\t        /** root url of this app */\n\t        root: '/'\n\t    };\n\t\n\t    /** filter to options present in defaultOptions (and default to them) */\n\t    GalaxyApp.prototype._processOptions = function _processOptions(options) {\n\t        var self = this,\n\t            defaults = self.defaultOptions;\n\t\n\t        self.options = {};\n\t        for (var k in defaults) {\n\t            if (defaults.hasOwnProperty(k)) {\n\t                self.options[k] = options.hasOwnProperty(k) ? options[k] : defaults[k];\n\t            }\n\t        }\n\t        return self;\n\t    };\n\t\n\t    /** parse the config and any extra info derived from it */\n\t    GalaxyApp.prototype._initConfig = function _initConfig(config) {\n\t        var self = this;\n\t        self.config = config;\n\t\n\t        // give precendence to localdebugging for this setting\n\t        self.config.debug = localDebugging || self.config.debug;\n\t\n\t        return self;\n\t    };\n\t\n\t    /** add an option from options if the key matches an option in defaultOptions */\n\t    GalaxyApp.prototype._patchGalaxy = function _patchGalaxy(patchWith) {\n\t        var self = this;\n\t        // in case req or plain script tag order has created a prev. version of the Galaxy obj...\n\t        if (self.options.patchExisting && patchWith) {\n\t            // self.debug( 'found existing Galaxy object:', patchWith );\n\t            // ...(for now) monkey patch any added attributes that the previous Galaxy may have had\n\t            //TODO: move those attributes to more formal assignment in GalaxyApp\n\t            for (var k in patchWith) {\n\t                if (patchWith.hasOwnProperty(k)) {\n\t                    // self.debug( '\\t patching in ' + k + ' to Galaxy:', self[ k ] );\n\t                    self[k] = patchWith[k];\n\t                }\n\t            }\n\t        }\n\t    };\n\t\n\t    /** set up the metrics logger (utils/metrics-logger) and pass loggerOptions */\n\t    GalaxyApp.prototype._initLogger = function _initLogger(loggerOptions) {\n\t        var self = this;\n\t\n\t        // default to console logging at the debug level if the debug flag is set\n\t        if (self.config.debug) {\n\t            loggerOptions.consoleLogger = loggerOptions.consoleLogger || console;\n\t            loggerOptions.consoleLevel = loggerOptions.consoleLevel || metricsLogger.MetricsLogger.ALL;\n\t            // load any logging namespaces from localStorage if we can\n\t            try {\n\t                loggerOptions.consoleNamespaceWhitelist = localStorage.getItem(NAMESPACE_KEY).split(',');\n\t            } catch (storageErr) {}\n\t        }\n\t\n\t        self.logger = new metricsLogger.MetricsLogger(loggerOptions);\n\t        self.emit = {};\n\t        ['log', 'debug', 'info', 'warn', 'error', 'metric'].map(function (i) {\n\t            self.emit[i] = function (data) {\n\t                self.logger.emit(i, arguments[0], Array.prototype.slice.call(arguments, 1));\n\t            };\n\t        });\n\t\n\t        if (self.config.debug) {\n\t            // add this logger to mvc's loggable mixin so that all models can use the logger\n\t            BASE_MVC.LoggableMixin.logger = self.logger;\n\t        }\n\t        return self;\n\t    };\n\t\n\t    /** add the localize fn to this object and the window namespace (as '_l') */\n\t    GalaxyApp.prototype._initLocale = function _initLocale(options) {\n\t        var self = this;\n\t        self.debug('_initLocale:', options);\n\t        self.localize = localize;\n\t        // add to window as global shortened alias\n\t        // TODO: temporary - remove when can require for plugins\n\t        window._l = self.localize;\n\t        return self;\n\t    };\n\t\n\t    /** set up the current user as a Backbone model (mvc/user/user-model) */\n\t    GalaxyApp.prototype._initUser = function _initUser(userJSON) {\n\t        var self = this;\n\t        self.debug('_initUser:', userJSON);\n\t        self.user = new userModel.User(userJSON);\n\t        self.user.logger = self.logger;\n\t        return self;\n\t    };\n\t\n\t    /** Set up DOM/jQuery/Backbone event listeners enabled for all pages */\n\t    GalaxyApp.prototype._setUpListeners = function _setUpListeners() {\n\t        var self = this;\n\t\n\t        // hook to jq beforeSend to record the most recent ajax call and cache some data about it\n\t        /** cached info about the last ajax call made through jQuery */\n\t        self.lastAjax = {};\n\t        $(document).bind('ajaxSend', function (ev, xhr, options) {\n\t            var data = options.data;\n\t            try {\n\t                data = JSON.parse(data);\n\t            } catch (err) {}\n\t\n\t            self.lastAjax = {\n\t                url: location.href.slice(0, -1) + options.url,\n\t                data: data\n\t            };\n\t            //TODO:?? we might somehow manage to *retry* ajax using either this hook or Backbone.sync\n\t        });\n\t        return self;\n\t    };\n\t\n\t    /** Turn debugging/console-output on/off by passing boolean. Pass nothing to get current setting. */\n\t    GalaxyApp.prototype.debugging = function _debugging(setting) {\n\t        var self = this;\n\t        try {\n\t            if (setting === undefined) {\n\t                return localStorage.getItem(DEBUGGING_KEY) === 'true';\n\t            }\n\t            if (setting) {\n\t                localStorage.setItem(DEBUGGING_KEY, true);\n\t                return true;\n\t            }\n\t\n\t            localStorage.removeItem(DEBUGGING_KEY);\n\t            // also remove all namespaces\n\t            self.debuggingNamespaces(null);\n\t        } catch (storageErr) {\n\t            console.log(localize('localStorage not available for debug flag retrieval'));\n\t        }\n\t        return false;\n\t    };\n\t\n\t    /** Add, remove, or clear namespaces from the debugging filters\n\t     *  Pass no arguments to retrieve the existing namespaces as an array.\n\t     *  Pass in null to clear all namespaces (all logging messages will show now).\n\t     *  Pass in an array of strings or single string of the namespaces to filter to.\n\t     *  Returns the new/current namespaces as an array;\n\t     */\n\t    GalaxyApp.prototype.debuggingNamespaces = function _debuggingNamespaces(namespaces) {\n\t        var self = this;\n\t        try {\n\t            if (namespaces === undefined) {\n\t                var csv = localStorage.getItem(NAMESPACE_KEY);\n\t                return typeof csv === 'string' ? csv.split(',') : [];\n\t            } else if (namespaces === null) {\n\t                localStorage.removeItem(NAMESPACE_KEY);\n\t            } else {\n\t                localStorage.setItem(NAMESPACE_KEY, namespaces);\n\t            }\n\t            var newSettings = self.debuggingNamespaces();\n\t            if (self.logger) {\n\t                self.logger.options.consoleNamespaceWhitelist = newSettings;\n\t            }\n\t            return newSettings;\n\t        } catch (storageErr) {\n\t            console.log(localize('localStorage not available for debug namespace retrieval'));\n\t        }\n\t    };\n\t\n\t    /** string rep */\n\t    GalaxyApp.prototype.toString = function toString() {\n\t        var userEmail = this.user ? this.user.get('email') || '(anonymous)' : 'uninitialized';\n\t        return 'GalaxyApp(' + userEmail + ')';\n\t    };\n\t\n\t    // ============================================================================\n\t    return {\n\t        GalaxyApp: GalaxyApp\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))\n\n/***/ },\n\n/***/ 32:\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, $) {'use strict';\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(4), __webpack_require__(33), __webpack_require__(35), __webpack_require__(62)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Utils, Menu, Scratchbook, QuotaMeter) {\n\t\n\t    /** Masthead **/\n\t    var View = Backbone.View.extend({\n\t        initialize: function initialize(options) {\n\t            var self = this;\n\t            this.options = options;\n\t            this.setElement(this._template());\n\t            this.$navbarBrandLink = this.$('.navbar-brand-link');\n\t            this.$navbarBrandImage = this.$('.navbar-brand-image');\n\t            this.$navbarBrandTitle = this.$('.navbar-brand-title');\n\t            this.$navbarTabs = this.$('.navbar-tabs');\n\t            this.$quoteMeter = this.$('.quota-meter-container');\n\t\n\t            // build tabs\n\t            this.collection = new Menu.Collection();\n\t            this.collection.on('add', function (model) {\n\t                self.$navbarTabs.append(new Menu.Tab({ model: model }).render().$el);\n\t            }).on('reset', function () {\n\t                self.$navbarTabs.empty();\n\t            }).on('dispatch', function (callback) {\n\t                self.collection.each(function (m) {\n\t                    callback(m);\n\t                });\n\t            }).fetch(this.options);\n\t\n\t            // scratchbook\n\t            Galaxy.frame = this.frame = new Scratchbook({ collection: this.collection });\n\t\n\t            // set up the quota meter (And fetch the current user data from trans)\n\t            // add quota meter to masthead\n\t            Galaxy.quotaMeter = this.quotaMeter = new QuotaMeter.UserQuotaMeter({\n\t                model: Galaxy.user,\n\t                el: this.$quoteMeter\n\t            });\n\t\n\t            // loop through beforeunload functions if the user attempts to unload the page\n\t            $(window).on('click', function (e) {\n\t                var $download_link = $(e.target).closest('a[download]');\n\t                if ($download_link.length == 1) {\n\t                    if ($('iframe[id=download]').length === 0) {\n\t                        $('body').append($('<iframe/>').attr('id', 'download').hide());\n\t                    }\n\t                    $('iframe[id=download]').attr('src', $download_link.attr('href'));\n\t                    e.preventDefault();\n\t                }\n\t            }).on('beforeunload', function () {\n\t                var text = '';\n\t                self.collection.each(function (model) {\n\t                    var q = model.get('onbeforeunload') && model.get('onbeforeunload')();\n\t                    q && (text += q + ' ');\n\t                });\n\t                if (text !== '') {\n\t                    return text;\n\t                }\n\t            });\n\t        },\n\t\n\t        render: function render() {\n\t            this.$navbarBrandTitle.html('Galaxy ' + (this.options.brand && '/ ' + this.options.brand || ''));\n\t            this.$navbarBrandLink.attr('href', this.options.logo_url);\n\t            this.$navbarBrandImage.attr('src', this.options.logo_src);\n\t            this.quotaMeter.render();\n\t            return this;\n\t        },\n\t\n\t        /** body template */\n\t        _template: function _template() {\n\t            return '<div id=\"masthead\" class=\"navbar navbar-fixed-top navbar-inverse\">' + '<div class=\"navbar-header\">' + '<div class=\"navbar-tabs\"/>' + '</div>' + '<div class=\"navbar-brand\">' + '<a class=\"navbar-brand-link\">' + '<img class=\"navbar-brand-image\"/>' + '<span class=\"navbar-brand-title\"/>' + '</a>' + '</div>' + '<div class=\"quota-meter-container\"/>' + '<div class=\"navbar-icons\"/>' + '</div>';\n\t        }\n\t    });\n\t\n\t    return {\n\t        View: View\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1)))\n\n/***/ },\n\n/***/ 33:\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, jQuery, $, _) {'use strict';\n\t\n\t/** Masthead Collection **/\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(26)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Tours) {\n\t    var Collection = Backbone.Collection.extend({\n\t        model: Backbone.Model.extend({\n\t            defaults: {\n\t                visible: true,\n\t                target: '_parent'\n\t            }\n\t        }),\n\t        fetch: function fetch(options) {\n\t            options = options || {};\n\t            this.reset();\n\t\n\t            //\n\t            // Analyze data tab.\n\t            //\n\t            this.add({\n\t                id: 'analysis',\n\t                title: 'Analyze Data',\n\t                url: '',\n\t                tooltip: 'Analysis home view'\n\t            });\n\t\n\t            //\n\t            // Workflow tab.\n\t            //\n\t            this.add({\n\t                id: 'workflow',\n\t                title: 'Workflow',\n\t                url: 'workflow',\n\t                tooltip: 'Chain tools into workflows',\n\t                disabled: !Galaxy.user.id\n\t            });\n\t\n\t            //\n\t            // 'Shared Items' or Libraries tab.\n\t            //\n\t            this.add({\n\t                id: 'shared',\n\t                title: 'Shared Data',\n\t                url: 'library/index',\n\t                tooltip: 'Access published resources',\n\t                menu: [{\n\t                    title: 'Data Libraries',\n\t                    url: 'library/list'\n\t                }, {\n\t                    title: 'Histories',\n\t                    url: 'history/list_published'\n\t                }, {\n\t                    title: 'Workflows',\n\t                    url: 'workflow/list_published'\n\t                }, {\n\t                    title: 'Visualizations',\n\t                    url: 'visualization/list_published'\n\t                }, {\n\t                    title: 'Pages',\n\t                    url: 'page/list_published'\n\t                }]\n\t            });\n\t\n\t            //\n\t            // Lab menu.\n\t            //\n\t            options.user_requests && this.add({\n\t                id: 'lab',\n\t                title: 'Lab',\n\t                menu: [{\n\t                    title: 'Sequencing Requests',\n\t                    url: 'requests/index'\n\t                }, {\n\t                    title: 'Find Samples',\n\t                    url: 'requests/find_samples_index'\n\t                }, {\n\t                    title: 'Help',\n\t                    url: options.lims_doc_url\n\t                }]\n\t            });\n\t\n\t            //\n\t            // Visualization tab.\n\t            //\n\t            this.add({\n\t                id: 'visualization',\n\t                title: 'Visualization',\n\t                url: 'visualization/list',\n\t                tooltip: 'Visualize datasets',\n\t                disabled: !Galaxy.user.id,\n\t                menu: [{\n\t                    title: 'New Track Browser',\n\t                    url: 'visualization/trackster',\n\t                    target: '_frame'\n\t                }, {\n\t                    title: 'Saved Visualizations',\n\t                    url: 'visualization/list',\n\t                    target: '_frame'\n\t                }, {\n\t                    title: 'Interactive Environments',\n\t                    url: 'visualization/gie_list',\n\t                    target: 'galaxy_main'\n\t                }]\n\t            });\n\t\n\t            //\n\t            // Admin.\n\t            //\n\t            Galaxy.user.get('is_admin') && this.add({\n\t                id: 'admin',\n\t                title: 'Admin',\n\t                url: 'admin',\n\t                tooltip: 'Administer this Galaxy',\n\t                cls: 'admin-only'\n\t            });\n\t\n\t            //\n\t            // Help tab.\n\t            //\n\t            var helpTab = {\n\t                id: 'help',\n\t                title: 'Help',\n\t                tooltip: 'Support, contact, and community hubs',\n\t                menu: [{\n\t                    title: 'Support',\n\t                    url: options.support_url,\n\t                    target: '_blank'\n\t                }, {\n\t                    title: 'Search',\n\t                    url: options.search_url,\n\t                    target: '_blank'\n\t                }, {\n\t                    title: 'Mailing Lists',\n\t                    url: options.mailing_lists,\n\t                    target: '_blank'\n\t                }, {\n\t                    title: 'Videos',\n\t                    url: options.screencasts_url,\n\t                    target: '_blank'\n\t                }, {\n\t                    title: 'Wiki',\n\t                    url: options.wiki_url,\n\t                    target: '_blank'\n\t                }, {\n\t                    title: 'How to Cite Galaxy',\n\t                    url: options.citation_url,\n\t                    target: '_blank'\n\t                }, {\n\t                    title: 'Interactive Tours',\n\t                    url: 'tours',\n\t                    onclick: function onclick() {\n\t                        if (Galaxy.app) {\n\t                            Galaxy.app.display(new Tours.ToursView());\n\t                        } else {\n\t                            // Redirect and use clientside routing to go to tour index\n\t                            window.location = Galaxy.root + \"tours\";\n\t                        }\n\t                    }\n\t                }]\n\t            };\n\t            options.terms_url && helpTab.menu.push({\n\t                title: 'Terms and Conditions',\n\t                url: options.terms_url,\n\t                target: '_blank'\n\t            });\n\t            options.biostar_url && helpTab.menu.unshift({\n\t                title: 'Ask a question',\n\t                url: 'biostar/biostar_question_redirect',\n\t                target: '_blank'\n\t            });\n\t            options.biostar_url && helpTab.menu.unshift({\n\t                title: 'Galaxy Biostar',\n\t                url: options.biostar_url_redirect,\n\t                target: '_blank'\n\t            });\n\t            this.add(helpTab);\n\t\n\t            //\n\t            // User tab.\n\t            //\n\t            if (!Galaxy.user.id) {\n\t                var userTab = {\n\t                    id: 'user',\n\t                    title: 'User',\n\t                    cls: 'loggedout-only',\n\t                    tooltip: 'Account registration or login',\n\t                    menu: [{\n\t                        title: 'Login',\n\t                        url: 'user/login',\n\t                        target: 'galaxy_main'\n\t                    }]\n\t                };\n\t                options.allow_user_creation && userTab.menu.push({\n\t                    title: 'Register',\n\t                    url: 'user/create',\n\t                    target: 'galaxy_main'\n\t                });\n\t                this.add(userTab);\n\t            } else {\n\t                var userTab = {\n\t                    id: 'user',\n\t                    title: 'User',\n\t                    cls: 'loggedin-only',\n\t                    tooltip: 'Account preferences and saved data',\n\t                    menu: [{\n\t                        title: 'Logged in as ' + Galaxy.user.get('email')\n\t                    }, {\n\t                        title: 'Preferences',\n\t                        url: 'user?cntrller=user',\n\t                        target: 'galaxy_main'\n\t                    }, {\n\t                        title: 'Custom Builds',\n\t                        url: 'user/dbkeys',\n\t                        target: 'galaxy_main'\n\t                    }, {\n\t                        title: 'Logout',\n\t                        url: 'user/logout',\n\t                        target: '_top',\n\t                        divider: true\n\t                    }, {\n\t                        title: 'Saved Histories',\n\t                        url: 'history/list',\n\t                        target: 'galaxy_main'\n\t                    }, {\n\t                        title: 'Saved Datasets',\n\t                        url: 'dataset/list',\n\t                        target: 'galaxy_main'\n\t                    }, {\n\t                        title: 'Saved Pages',\n\t                        url: 'page/list',\n\t                        target: '_top'\n\t                    }, {\n\t                        title: 'API Keys',\n\t                        url: 'user/api_keys?cntrller=user',\n\t                        target: 'galaxy_main'\n\t                    }]\n\t                };\n\t                options.use_remote_user && userTab.menu.push({\n\t                    title: 'Public Name',\n\t                    url: 'user/edit_username?cntrller=user',\n\t                    target: 'galaxy_main'\n\t                });\n\t                this.add(userTab);\n\t            }\n\t            var activeView = this.get(options.active_view);\n\t            activeView && activeView.set('active', true);\n\t            return new jQuery.Deferred().resolve().promise();\n\t        }\n\t    });\n\t\n\t    /** Masthead tab **/\n\t    var Tab = Backbone.View.extend({\n\t        initialize: function initialize(options) {\n\t            this.model = options.model;\n\t            this.setElement(this._template());\n\t            this.$dropdown = this.$('.dropdown');\n\t            this.$toggle = this.$('.dropdown-toggle');\n\t            this.$menu = this.$('.dropdown-menu');\n\t            this.$note = this.$('.dropdown-note');\n\t            this.listenTo(this.model, 'change', this.render, this);\n\t        },\n\t\n\t        events: {\n\t            'click .dropdown-toggle': '_toggleClick'\n\t        },\n\t\n\t        render: function render() {\n\t            var self = this;\n\t            $('.tooltip').remove();\n\t            this.$el.attr('id', this.model.id).css({ visibility: this.model.get('visible') && 'visible' || 'hidden' });\n\t            this.model.set('url', this._formatUrl(this.model.get('url')));\n\t            this.$note.html(this.model.get('note') || '').removeClass().addClass('dropdown-note').addClass(this.model.get('note_cls')).css({ 'display': this.model.get('show_note') && 'block' || 'none' });\n\t            this.$toggle.html(this.model.get('title') || '').removeClass().addClass('dropdown-toggle').addClass(this.model.get('cls')).addClass(this.model.get('icon') && 'dropdown-icon fa ' + this.model.get('icon')).addClass(this.model.get('toggle') && 'toggle').attr('target', this.model.get('target')).attr('href', this.model.get('url')).attr('title', this.model.get('tooltip')).tooltip('destroy');\n\t            this.model.get('tooltip') && this.$toggle.tooltip({ placement: 'bottom' });\n\t            this.$dropdown.removeClass().addClass('dropdown').addClass(this.model.get('disabled') && 'disabled').addClass(this.model.get('active') && 'active');\n\t            if (this.model.get('menu') && this.model.get('show_menu')) {\n\t                this.$menu.show();\n\t                $('#dd-helper').show().off().on('click', function () {\n\t                    $('#dd-helper').hide();\n\t                    self.model.set('show_menu', false);\n\t                });\n\t            } else {\n\t                self.$menu.hide();\n\t                $('#dd-helper').hide();\n\t            }\n\t            this.$menu.empty().removeClass('dropdown-menu');\n\t            if (this.model.get('menu')) {\n\t                _.each(this.model.get('menu'), function (menuItem) {\n\t                    self.$menu.append(self._buildMenuItem(menuItem));\n\t                    menuItem.divider && self.$menu.append($('<li/>').addClass('divider'));\n\t                });\n\t                self.$menu.addClass('dropdown-menu');\n\t                self.$toggle.append($('<b/>').addClass('caret'));\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /** Add new menu item */\n\t        _buildMenuItem: function _buildMenuItem(options) {\n\t            var self = this;\n\t            options = _.defaults(options || {}, {\n\t                title: '',\n\t                url: '',\n\t                target: '_parent'\n\t            });\n\t            options.url = self._formatUrl(options.url);\n\t            return $('<li/>').append($('<a/>').attr('href', options.url).attr('target', options.target).html(options.title).on('click', function (e) {\n\t                e.preventDefault();\n\t                self.model.set('show_menu', false);\n\t                if (options.onclick) {\n\t                    options.onclick();\n\t                } else {\n\t                    Galaxy.frame.add(options);\n\t                }\n\t            }));\n\t        },\n\t\n\t        /** Handle click event */\n\t        _toggleClick: function _toggleClick(e) {\n\t            var self = this;\n\t            var model = this.model;\n\t            e.preventDefault();\n\t            $('.tooltip').hide();\n\t            model.trigger('dispatch', function (m) {\n\t                model.id !== m.id && m.get('menu') && m.set('show_menu', false);\n\t            });\n\t            if (!model.get('disabled')) {\n\t                if (!model.get('menu')) {\n\t                    model.get('onclick') ? model.get('onclick')() : Galaxy.frame.add(model.attributes);\n\t                } else {\n\t                    model.set('show_menu', true);\n\t                }\n\t            } else {\n\t                var buildLink = function buildLink(label, url) {\n\t                    return $('<div/>').append($('<a/>').attr('href', Galaxy.root + url).html(label)).html();\n\t                };\n\t\n\t                this.$toggle.popover && this.$toggle.popover('destroy');\n\t                this.$toggle.popover({\n\t                    html: true,\n\t                    placement: 'bottom',\n\t                    content: 'Please ' + buildLink('login', 'user/login?use_panels=True') + ' or ' + buildLink('register', 'user/create?use_panels=True') + ' to use this feature.'\n\t                }).popover('show');\n\t                setTimeout(function () {\n\t                    self.$toggle.popover('destroy');\n\t                }, 5000);\n\t            }\n\t        },\n\t\n\t        /** Url formatting */\n\t        _formatUrl: function _formatUrl(url) {\n\t            return typeof url == 'string' && url.indexOf('//') === -1 && url.charAt(0) != '/' ? Galaxy.root + url : url;\n\t        },\n\t\n\t        /** body tempate */\n\t        _template: function _template() {\n\t            return '<ul class=\"nav navbar-nav\">' + '<li class=\"dropdown\">' + '<a class=\"dropdown-toggle\"/>' + '<ul class=\"dropdown-menu\"/>' + '<div class=\"dropdown-note\"/>' + '</li>' + '</ul>';\n\t        }\n\t    });\n\t\n\t    return {\n\t        Collection: Collection,\n\t        Tab: Tab\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(1), __webpack_require__(1), __webpack_require__(2)))\n\n/***/ },\n\n/***/ 34:\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {'use strict';\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(32), __webpack_require__(10), __webpack_require__(8), __webpack_require__(6)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Masthead, Panel, Modal, BaseMVC) {\n\t\n\t    // ============================================================================\n\t    var PageLayoutView = Backbone.View.extend(BaseMVC.LoggableMixin).extend({\n\t        _logNamespace: 'layout',\n\t\n\t        el: 'body',\n\t        className: 'full-content',\n\t\n\t        _panelIds: ['left', 'center', 'right'],\n\t\n\t        defaultOptions: {\n\t            message_box_visible: false,\n\t            message_box_content: '',\n\t            message_box_class: 'info',\n\t            show_inactivity_warning: false,\n\t            inactivity_box_content: ''\n\t        },\n\t\n\t        initialize: function initialize(options) {\n\t            // TODO: remove globals\n\t            this.log(this + '.initialize:', options);\n\t            _.extend(this, _.pick(options, this._panelIds));\n\t            this.options = _.defaults(_.omit(options.config, this._panelIds), this.defaultOptions);\n\t            Galaxy.modal = this.modal = new Modal.View();\n\t            this.masthead = new Masthead.View(this.options);\n\t            this.$el.attr('scroll', 'no');\n\t            this.$el.html(this._template());\n\t            this.$el.append(this.masthead.frame.$el);\n\t            this.$('#masthead').replaceWith(this.masthead.$el);\n\t            this.$el.append(this.modal.$el);\n\t            this.$messagebox = this.$('#messagebox');\n\t            this.$inactivebox = this.$('#inactivebox');\n\t        },\n\t\n\t        render: function render() {\n\t            // TODO: Remove this line after select2 update\n\t            $('.select2-hidden-accessible').remove();\n\t            this.log(this + '.render:');\n\t            this.masthead.render();\n\t            this.renderMessageBox();\n\t            this.renderInactivityBox();\n\t            this.renderPanels();\n\t            return this;\n\t        },\n\t\n\t        /** Render message box */\n\t        renderMessageBox: function renderMessageBox() {\n\t            if (this.options.message_box_visible) {\n\t                var content = this.options.message_box_content || '';\n\t                var level = this.options.message_box_class || 'info';\n\t                this.$el.addClass('has-message-box');\n\t                this.$messagebox.attr('class', 'panel-' + level + '-message').html(content).toggle(!!content).show();\n\t            } else {\n\t                this.$el.removeClass('has-message-box');\n\t                this.$messagebox.hide();\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /** Render inactivity warning */\n\t        renderInactivityBox: function renderInactivityBox() {\n\t            if (this.options.show_inactivity_warning) {\n\t                var content = this.options.inactivity_box_content || '';\n\t                var verificationLink = $('<a/>').attr('href', Galaxy.root + 'user/resend_verification').text('Resend verification');\n\t                this.$el.addClass('has-inactivity-box');\n\t                this.$inactivebox.html(content + ' ').append(verificationLink).toggle(!!content).show();\n\t            } else {\n\t                this.$el.removeClass('has-inactivity-box');\n\t                this.$inactivebox.hide();\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /** Render panels */\n\t        renderPanels: function renderPanels() {\n\t            var page = this;\n\t            this._panelIds.forEach(function (panelId) {\n\t                if (_.has(page, panelId)) {\n\t                    page[panelId].setElement('#' + panelId);\n\t                    page[panelId].render();\n\t                }\n\t            });\n\t            if (!this.left) {\n\t                this.center.$el.css('left', 0);\n\t            }\n\t            if (!this.right) {\n\t                this.center.$el.css('right', 0);\n\t            }\n\t            return this;\n\t        },\n\t\n\t        /** body template */\n\t        _template: function _template() {\n\t            return ['<div id=\"everything\">', '<div id=\"background\"/>', '<div id=\"masthead\"/>', '<div id=\"messagebox\"/>', '<div id=\"inactivebox\" class=\"panel-warning-message\" />', this.left ? '<div id=\"left\" />' : '', this.center ? '<div id=\"center\" class=\"inbound\" />' : '', this.right ? '<div id=\"right\" />' : '', '</div>', '<div id=\"dd-helper\" />'].join('');\n\t        },\n\t\n\t        /** hide both side panels if previously shown */\n\t        hideSidePanels: function hideSidePanels() {\n\t            if (this.left) {\n\t                this.left.hide();\n\t            }\n\t            if (this.right) {\n\t                this.right.hide();\n\t            }\n\t        },\n\t\n\t        toString: function toString() {\n\t            return 'PageLayoutView';\n\t        }\n\t    });\n\t\n\t    // ============================================================================\n\t    return {\n\t        PageLayoutView: PageLayoutView\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n\n/***/ 35:\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {'use strict';\n\t\n\t/** Frame manager uses the ui-frames to create the scratch book masthead icon and functionality **/\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(16)], __WEBPACK_AMD_DEFINE_RESULT__ = function (Frames) {\n\t    return Backbone.View.extend({\n\t        initialize: function initialize(options) {\n\t            var self = this;\n\t            options = options || {};\n\t            this.frames = new Frames.View({ visible: false });\n\t            this.setElement(this.frames.$el);\n\t            this.buttonActive = options.collection.add({\n\t                id: 'enable-scratchbook',\n\t                icon: 'fa-th',\n\t                tooltip: 'Enable/Disable Scratchbook',\n\t                onclick: function onclick() {\n\t                    self.active = !self.active;\n\t                    self.buttonActive.set({\n\t                        toggle: self.active,\n\t                        show_note: self.active,\n\t                        note_cls: self.active && 'fa fa-check'\n\t                    });\n\t                    !self.active && self.frames.hide();\n\t                },\n\t                onbeforeunload: function onbeforeunload() {\n\t                    if (self.frames.length() > 0) {\n\t                        return 'You opened ' + self.frames.length() + ' frame(s) which will be lost.';\n\t                    }\n\t                }\n\t            });\n\t            this.buttonLoad = options.collection.add({\n\t                id: 'show-scratchbook',\n\t                icon: 'fa-eye',\n\t                tooltip: 'Show/Hide Scratchbook',\n\t                show_note: true,\n\t                visible: false,\n\t                onclick: function onclick(e) {\n\t                    self.frames.visible ? self.frames.hide() : self.frames.show();\n\t                }\n\t            });\n\t            this.frames.on('add remove', function () {\n\t                this.visible && this.length() == 0 && this.hide();\n\t                self.buttonLoad.set({ 'note': this.length(), 'visible': this.length() > 0 });\n\t            }).on('show hide ', function () {\n\t                self.buttonLoad.set({ 'toggle': this.visible, 'icon': this.visible && 'fa-eye' || 'fa-eye-slash' });\n\t            });\n\t            this.history_cache = {};\n\t        },\n\t\n\t        /** Add a dataset to the frames */\n\t        addDataset: function addDataset(dataset_id) {\n\t            var self = this;\n\t            var current_dataset = null;\n\t            if (Galaxy && Galaxy.currHistoryPanel) {\n\t                var history_id = Galaxy.currHistoryPanel.collection.historyId;\n\t                this.history_cache[history_id] = { name: Galaxy.currHistoryPanel.model.get('name'), dataset_ids: [] };\n\t                Galaxy.currHistoryPanel.collection.each(function (model) {\n\t                    !model.get('deleted') && model.get('visible') && self.history_cache[history_id].dataset_ids.push(model.get('id'));\n\t                });\n\t            }\n\t            var _findDataset = function _findDataset(dataset, offset) {\n\t                if (dataset) {\n\t                    var history_details = self.history_cache[dataset.get('history_id')];\n\t                    if (history_details && history_details.dataset_ids) {\n\t                        var dataset_list = history_details.dataset_ids;\n\t                        var pos = dataset_list.indexOf(dataset.get('id'));\n\t                        if (pos !== -1 && pos + offset >= 0 && pos + offset < dataset_list.length) {\n\t                            return dataset_list[pos + offset];\n\t                        }\n\t                    }\n\t                }\n\t            };\n\t            var _loadDatasetOffset = function _loadDatasetOffset(dataset, offset, frame) {\n\t                var new_dataset_id = _findDataset(dataset, offset);\n\t                if (new_dataset_id) {\n\t                    self._loadDataset(new_dataset_id, function (new_dataset, config) {\n\t                        current_dataset = new_dataset;\n\t                        frame.model.set(config);\n\t                    });\n\t                } else {\n\t                    frame.model.trigger('change');\n\t                }\n\t            };\n\t            this._loadDataset(dataset_id, function (dataset, config) {\n\t                current_dataset = dataset;\n\t                self.add(_.extend({ menu: [{ icon: 'fa fa-chevron-circle-left',\n\t                        tooltip: 'Previous in History',\n\t                        onclick: function onclick(frame) {\n\t                            _loadDatasetOffset(current_dataset, -1, frame);\n\t                        },\n\t                        disabled: function disabled() {\n\t                            return !_findDataset(current_dataset, -1);\n\t                        } }, { icon: 'fa fa-chevron-circle-right',\n\t                        tooltip: 'Next in History',\n\t                        onclick: function onclick(frame) {\n\t                            _loadDatasetOffset(current_dataset, 1, frame);\n\t                        },\n\t                        disabled: function disabled() {\n\t                            return !_findDataset(current_dataset, 1);\n\t                        } }] }, config));\n\t            });\n\t        },\n\t\n\t        _loadDataset: function _loadDataset(dataset_id, callback) {\n\t            var self = this;\n\t            __webpack_require__.e/* require */(1, function(__webpack_require__) { /* WEBPACK VAR INJECTION */(function($, _) {var __WEBPACK_AMD_REQUIRE_ARRAY__ = [__webpack_require__(11)]; (function (DATA) {\n\t                var dataset = new DATA.Dataset({ id: dataset_id });\n\t                $.when(dataset.fetch()).then(function () {\n\t                    var is_tabular = _.find(['tabular', 'interval'], function (data_type) {\n\t                        return dataset.get('data_type').indexOf(data_type) !== -1;\n\t                    });\n\t                    var title = dataset.get('name');\n\t                    var history_details = self.history_cache[dataset.get('history_id')];\n\t                    if (history_details) {\n\t                        title = history_details.name + ': ' + title;\n\t                    }\n\t                    callback(dataset, is_tabular ? {\n\t                        title: title,\n\t                        url: null,\n\t                        content: DATA.createTabularDatasetChunkedView({\n\t                            model: new DATA.TabularDataset(dataset.toJSON()),\n\t                            embedded: true,\n\t                            height: '100%'\n\t                        }).$el\n\t                    } : {\n\t                        title: title,\n\t                        url: Galaxy.root + 'datasets/' + dataset_id + '/display/?preview=True',\n\t                        content: null\n\t                    });\n\t                });\n\t            }.apply(null, __WEBPACK_AMD_REQUIRE_ARRAY__));\n\t/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(1), __webpack_require__(2)))});\n\t        },\n\t\n\t        /** Add a trackster visualization to the frames. */\n\t        addTrackster: function addTrackster(viz_id) {\n\t            var self = this;\n\t            __webpack_require__.e/* require */(0, function(__webpack_require__) { /* WEBPACK VAR INJECTION */(function($, _) {var __WEBPACK_AMD_REQUIRE_ARRAY__ = [__webpack_require__(30), __webpack_require__(92)]; (function (visualization, trackster) {\n\t                var viz = new visualization.Visualization({ id: viz_id });\n\t                $.when(viz.fetch()).then(function () {\n\t                    var ui = new trackster.TracksterUI(Galaxy.root);\n\t\n\t                    // Construct frame config based on dataset's type.\n\t                    var frame_config = {\n\t                        title: viz.get('name'),\n\t                        type: 'other',\n\t                        content: function content(parent_elt) {\n\t                            // Create view config.\n\t                            var view_config = {\n\t                                container: parent_elt,\n\t                                name: viz.get('title'),\n\t                                id: viz.id,\n\t                                // FIXME: this will not work with custom builds b/c the dbkey needed to be encoded.\n\t                                dbkey: viz.get('dbkey'),\n\t                                stand_alone: false\n\t                            },\n\t                                latest_revision = viz.get('latest_revision'),\n\t                                drawables = latest_revision.config.view.drawables;\n\t\n\t                            // Set up datasets in drawables.\n\t                            _.each(drawables, function (d) {\n\t                                d.dataset = {\n\t                                    hda_ldda: d.hda_ldda,\n\t                                    id: d.dataset_id\n\t                                };\n\t                            });\n\t                            view = ui.create_visualization(view_config, latest_revision.config.viewport, latest_revision.config.view.drawables, latest_revision.config.bookmarks, false);\n\t                        }\n\t                    };\n\t                    self.add(frame_config);\n\t                });\n\t            }.apply(null, __WEBPACK_AMD_REQUIRE_ARRAY__));\n\t/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(1), __webpack_require__(2)))});\n\t        },\n\t\n\t        /** Add and display a new frame/window based on options. */\n\t        add: function add(options) {\n\t            if (options.target == '_blank') {\n\t                window.open(options.url);\n\t            } else if (options.target == '_top' || options.target == '_parent' || options.target == '_self') {\n\t                window.location = options.url;\n\t            } else if (!this.active) {\n\t                var $galaxy_main = $(window.parent.document).find('#galaxy_main');\n\t                if (options.target == 'galaxy_main' || options.target == 'center') {\n\t                    if ($galaxy_main.length === 0) {\n\t                        window.location = options.url + (href.indexOf('?') == -1 ? '?' : '&') + 'use_panels=True';\n\t                    } else {\n\t                        $galaxy_main.attr('src', options.url);\n\t                    }\n\t                } else window.location = options.url;\n\t            } else {\n\t                this.frames.add(options);\n\t            }\n\t        }\n\t    });\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n\n/***/ 62:\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {\"use strict\";\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(6), __webpack_require__(5)], __WEBPACK_AMD_DEFINE_RESULT__ = function (baseMVC, _l) {\n\t    'use strict';\n\t\n\t    var logNamespace = 'user';\n\t    //==============================================================================\n\t    /** @class View to display a user's disk/storage usage\n\t     *      either as a progress bar representing the percentage of a quota used\n\t     *      or a simple text element displaying the human readable size used.\n\t     *  @name UserQuotaMeter\n\t     *  @augments Backbone.View\n\t     */\n\t    var UserQuotaMeter = Backbone.View.extend(baseMVC.LoggableMixin).extend(\n\t    /** @lends UserQuotaMeter.prototype */{\n\t        _logNamespace: logNamespace,\n\t\n\t        /** Defaults for optional settings passed to initialize */\n\t        options: {\n\t            warnAtPercent: 85,\n\t            errorAtPercent: 100\n\t        },\n\t\n\t        /** Set up, accept options, and bind events */\n\t        initialize: function initialize(options) {\n\t            this.log(this + '.initialize:', options);\n\t            _.extend(this.options, options);\n\t\n\t            //this.bind( 'all', function( event, data ){ this.log( this + ' event:', event, data ); }, this );\n\t            this.listenTo(this.model, 'change:quota_percent change:total_disk_usage', this.render);\n\t        },\n\t\n\t        /** Re-load user model data from the api */\n\t        update: function update(options) {\n\t            this.log(this + ' updating user data...', options);\n\t            this.model.loadFromApi(this.model.get('id'), options);\n\t            return this;\n\t        },\n\t\n\t        /** Is the user over their quota (if there is one)?\n\t         * @returns {Boolean} true if over quota, false if no quota or under quota\n\t         */\n\t        isOverQuota: function isOverQuota() {\n\t            return this.model.get('quota_percent') !== null && this.model.get('quota_percent') >= this.options.errorAtPercent;\n\t        },\n\t\n\t        /** Render the meter when they have an applicable quota. Will render as a progress bar\n\t         *      with their percentage of that quota in text over the bar.\n\t         *  @fires quota:over when user is over quota (>= this.errorAtPercent)\n\t         *  @fires quota:under when user is under quota\n\t         *  @fires quota:under:approaching when user is >= this.warnAtPercent of their quota\n\t         *  @fires quota:under:ok when user is below this.warnAtPercent\n\t         *  @returns {jQuery} the rendered meter\n\t         */\n\t        _render_quota: function _render_quota() {\n\t            var modelJson = this.model.toJSON(),\n\t\n\t            //prevPercent = this.model.previous( 'quota_percent' ),\n\t            percent = modelJson.quota_percent,\n\t\n\t            //meter = $( UserQuotaMeter.templates.quota( modelJson ) );\n\t            $meter = $(this._templateQuotaMeter(modelJson)),\n\t                $bar = $meter.find('.progress-bar');\n\t            //this.log( this + '.rendering quota, percent:', percent, 'meter:', meter );\n\t\n\t            // OVER QUOTA: color the quota bar and show the quota error message\n\t            if (this.isOverQuota()) {\n\t                //this.log( '\\t over quota' );\n\t                $bar.attr('class', 'progress-bar progress-bar-danger');\n\t                $meter.find('.quota-meter-text').css('color', 'white');\n\t                //TODO: only trigger event if state has changed\n\t                this.trigger('quota:over', modelJson);\n\t\n\t                // APPROACHING QUOTA: color the quota bar\n\t            } else if (percent >= this.options.warnAtPercent) {\n\t                //this.log( '\\t approaching quota' );\n\t                $bar.attr('class', 'progress-bar progress-bar-warning');\n\t                //TODO: only trigger event if state has changed\n\t                this.trigger('quota:under quota:under:approaching', modelJson);\n\t\n\t                // otherwise, hide/don't use the msg box\n\t            } else {\n\t                $bar.attr('class', 'progress-bar progress-bar-success');\n\t                //TODO: only trigger event if state has changed\n\t                this.trigger('quota:under quota:under:ok', modelJson);\n\t            }\n\t            return $meter;\n\t        },\n\t\n\t        /** Render the meter when the user has NO applicable quota. Will render as text\n\t         *      showing the human readable sum storage their data is using.\n\t         *  @returns {jQuery} the rendered text\n\t         */\n\t        _render_usage: function _render_usage() {\n\t            //var usage = $( UserQuotaMeter.templates.usage( this.model.toJSON() ) );\n\t            var usage = $(this._templateUsage(this.model.toJSON()));\n\t            this.log(this + '.rendering usage:', usage);\n\t            return usage;\n\t        },\n\t\n\t        /** Render either the quota percentage meter or the human readable disk usage\n\t         *      depending on whether the user model has quota info (quota_percent === null -> no quota)\n\t         *  @returns {Object} this UserQuotaMeter\n\t         */\n\t        render: function render() {\n\t            //this.log( this + '.rendering' );\n\t            var meterHtml = null;\n\t\n\t            // no quota on server ('quota_percent' === null (can be valid at 0)), show usage instead\n\t            this.log(this + '.model.quota_percent:', this.model.get('quota_percent'));\n\t            if (this.model.get('quota_percent') === null || this.model.get('quota_percent') === undefined) {\n\t                meterHtml = this._render_usage();\n\t\n\t                // otherwise, render percent of quota (and warning, error)\n\t            } else {\n\t                meterHtml = this._render_quota();\n\t                //TODO: add the original text for unregistered quotas\n\t                //tooltip = \"Your disk quota is %s.  You can increase your quota by registering a Galaxy account.\"\n\t            }\n\t\n\t            this.$el.html(meterHtml);\n\t            this.$el.find('.quota-meter-text').tooltip();\n\t            return this;\n\t        },\n\t\n\t        _templateQuotaMeter: function _templateQuotaMeter(data) {\n\t            return ['<div id=\"quota-meter\" class=\"quota-meter progress\">', '<div class=\"progress-bar\" style=\"width: ', data.quota_percent, '%\"></div>', '<div class=\"quota-meter-text\" style=\"top: 6px\"', data.nice_total_disk_usage ? ' title=\"Using ' + data.nice_total_disk_usage + '\">' : '>', _l('Using'), ' ', data.quota_percent, '%', '</div>', '</div>'].join('');\n\t        },\n\t\n\t        _templateUsage: function _templateUsage(data) {\n\t            return ['<div id=\"quota-meter\" class=\"quota-meter\" style=\"background-color: transparent\">', '<div class=\"quota-meter-text\" style=\"top: 6px; color: white\">', data.nice_total_disk_usage ? _l('Using ') + data.nice_total_disk_usage : '', '</div>', '</div>'].join('');\n\t        },\n\t\n\t        toString: function toString() {\n\t            return 'UserQuotaMeter(' + this.model + ')';\n\t        }\n\t    });\n\t\n\t    //==============================================================================\n\t    return {\n\t        UserQuotaMeter: UserQuotaMeter\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3), __webpack_require__(2), __webpack_require__(1)))\n\n/***/ },\n\n/***/ 66:\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(jQuery) {'use strict';\n\t\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\t\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function () {\n\t    /*global window, jQuery, console */\n\t    /*=============================================================================\n\t    TODO:\n\t        while anon: logs saved to 'logs-null' - this will never post\n\t            unless we manually do so at/after login\n\t            OR prepend when userId and localStorage has 'logs-null'\n\t        wire up _delayPost and test\n\t    \n\t    =============================================================================*/\n\t    /** @class MetricsLogger\n\t     *\n\t     *  Object to cache, output, and post log/metric messages to the server.\n\t     *  Meant to be attached to the Galaxy object.\n\t     *\n\t     *  Log from objects by either attaching logger directly:\n\t     *      panel.logger.metric( 'user dataset deletion', panel.user.id, hda.toJSON() )\n\t     *  or using the LoggableMixin or addLogging function:\n\t     *      MyBackboneModel.extend( LoggableMixin ).extend({ ... })\n\t     *      addLogging( MyBackboneModel, 'my-backbone-model' )\n\t     *\n\t     *  Log from templates by calling directly from Galaxy object:\n\t     *      Galaxy.logger.metric( 'template loaded', { ownedByUser : true });\n\t     *\n\t     *  If you attempt to log an un-serializable object (circular reference, window, etc.),\n\t     *  that entry will not be cached (or sent). If you set consoleLevel and consoleLogger\n\t     *  appropriately, a warning will be shown when this happens:\n\t     *      > panel.metric( 'something weird with window', { window : window })\n\t     *      !'Metrics logger could not stringify logArguments: ...'\n\t     */\n\t    function MetricsLogger(options) {\n\t        options = options || {};\n\t        var self = this;\n\t\n\t        ///** get the current user's id from bootstrapped data or options */\n\t        self.userId = window.bootstrapped && window.bootstrapped.user ? window.bootstrapped.user.id : null;\n\t        self.userId = self.userId || options.userId || null;\n\t\n\t        /** the (optional) console to emit logs to */\n\t        self.consoleLogger = options.consoleLogger || null;\n\t\n\t        self._init(options);\n\t        return self;\n\t    }\n\t\n\t    //----------------------------------------------------------------------------- defaults and constants\n\t    // see: python std lib, logging\n\t    MetricsLogger.ALL = 0;\n\t    MetricsLogger.LOG = 0;\n\t    MetricsLogger.DEBUG = 10;\n\t    MetricsLogger.INFO = 20;\n\t    MetricsLogger.WARN = 30;\n\t    MetricsLogger.ERROR = 40;\n\t    // metrics levels here?\n\t    //MetricsLogger.MinorEvent  = 45;\n\t    //MetricsLogger.MajorEvent  = 50;\n\t    MetricsLogger.METRIC = 50;\n\t    MetricsLogger.NONE = 100;\n\t\n\t    /** default options - override these through the constructor */\n\t    MetricsLogger.defaultOptions = {\n\t        /** if an incoming message has a level >= this, it will be cached - can also be a string (e.g. 'debug') */\n\t        logLevel: MetricsLogger.NONE,\n\t        /** if an incoming message has a level >= this, it will be output to the console */\n\t        consoleLevel: MetricsLogger.NONE,\n\t        /** the default 'namespace' or label associated with an incoming message (if none is passed) */\n\t        defaultNamespace: 'Galaxy',\n\t        /** the namespaces output to the console (all namespaces will be output if this is falsy)\n\t         *  note: applies only to the console (not the event/metrics log/cache)\n\t         */\n\t        consoleNamespaceWhitelist: null,\n\t        /** the prefix attached to client-side logs to distinguish them in the metrics db */\n\t        clientPrefix: 'client.',\n\t\n\t        /** the maximum number of messages the cache should hold; if exceeded older messages are removed first */\n\t        maxCacheSize: 3000,\n\t        /** the number of messages accumulate before posting to the server; should be <= maxCacheSize */\n\t        postSize: 1000,\n\t        /** T/F whether to add a timestamp to incoming cached messages */\n\t        addTime: true,\n\t        /** string to prefix to userid for cache web storage */\n\t        cacheKeyPrefix: 'logs-',\n\t\n\t        /** the relative url to post messages to */\n\t        postUrl: '/api/metrics',\n\t        /** delay before trying post again after two failures */\n\t        delayPostInMs: 1000 * 60 * 10,\n\t\n\t        /** an (optional) function that should return an object; used to send additional data with the metrics */\n\t        getPingData: undefined,\n\t        /** an (optional) function that will handle the servers response after successfully posting messages */\n\t        onServerResponse: undefined\n\t    };\n\t\n\t    //----------------------------------------------------------------------------- set up\n\t    /** initialize the logger with options, set up instance vars and cache, and add onpageunload to window */\n\t    MetricsLogger.prototype._init = function _init(options) {\n\t        var self = this;\n\t        self.options = {};\n\t        for (var k in MetricsLogger.defaultOptions) {\n\t            if (MetricsLogger.defaultOptions.hasOwnProperty(k)) {\n\t                self.options[k] = options.hasOwnProperty(k) ? options[k] : MetricsLogger.defaultOptions[k];\n\t            }\n\t        }\n\t        self.options.logLevel = self._parseLevel(self.options.logLevel);\n\t        self.options.consoleLevel = self._parseLevel(self.options.consoleLevel);\n\t        //self._emitToConsole( 'debug', 'MetricsLogger', 'MetricsLogger.options:', self.options );\n\t\n\t        /** is the logger currently sending? */\n\t        self._sending = false;\n\t        /** the setTimeout id if the logger POST has failed more than once */\n\t        self._waiting = null;\n\t        /** the current number of entries to send in a POST */\n\t        self._postSize = self.options.postSize;\n\t\n\t        self._initCache();\n\t\n\t        return self;\n\t    };\n\t\n\t    /** initialize the cache */\n\t    MetricsLogger.prototype._initCache = function _initCache() {\n\t        try {\n\t            this.cache = new LoggingCache({\n\t                maxSize: this.options.maxCacheSize,\n\t                key: this.options.cacheKeyPrefix + this.userId\n\t            });\n\t        } catch (err) {\n\t            this._emitToConsole('warn', 'MetricsLogger', ['Could not intitialize logging cache:', err]);\n\t            this.options.logLevel = MetricsLogger.NONE;\n\t        }\n\t    };\n\t\n\t    /** return the numeric log level if level in 'none, debug, log, info, warn, error' */\n\t    MetricsLogger.prototype._parseLevel = function _parseLevel(level) {\n\t        var type = typeof level === 'undefined' ? 'undefined' : _typeof(level);\n\t        if (type === 'number') {\n\t            return level;\n\t        }\n\t        if (type === 'string') {\n\t            var upper = level.toUpperCase();\n\t            if (MetricsLogger.hasOwnProperty(upper)) {\n\t                return MetricsLogger[upper];\n\t            }\n\t        }\n\t        throw new Error('Unknown log level: ' + level);\n\t    };\n\t\n\t    //----------------------------------------------------------------------------- main entry point\n\t    /** record a log/message's arguments to the cache and/or the console based on level and namespace */\n\t    MetricsLogger.prototype.emit = function emit(level, namespace, logArguments) {\n\t        //this._emitToConsole( 'debug', 'MetricsLogger', [ 'emit:', level, namespace, logArguments ]);\n\t        var self = this;\n\t        namespace = namespace || self.options.defaultNamespace;\n\t        if (!level || !logArguments) {\n\t            return self;\n\t        }\n\t        // add to cache if proper level\n\t        //TODO: respect do not track?\n\t        //if( !navigator.doNotTrack && level >= self.options.logLevel ){\n\t        level = self._parseLevel(level);\n\t        if (level >= self.options.logLevel) {\n\t            self._addToCache(level, namespace, logArguments);\n\t        }\n\t        // also emit to consoleLogger if proper level for that\n\t        if (self.consoleLogger && level >= self.options.consoleLevel) {\n\t            self._emitToConsole(level, namespace, logArguments);\n\t        }\n\t        return self;\n\t    };\n\t\n\t    //----------------------------------------------------------------------------- cache\n\t    /** add a message to the cache and if messages.length is high enough post them to the server */\n\t    MetricsLogger.prototype._addToCache = function _addToCache(level, namespace, logArguments) {\n\t        this._emitToConsole('debug', 'MetricsLogger', ['_addToCache:', arguments, this.options.addTime, this.cache.length()]);\n\t        //this._emitToConsole( 'debug', 'MetricsLogger', [ '\\t logArguments:', logArguments ]);\n\t        var self = this;\n\t        // try add to the cache and if we've got _postSize number of entries, attempt to post them to the server\n\t        try {\n\t            var newLength = self.cache.add(self._buildEntry(level, namespace, logArguments));\n\t            if (newLength >= self._postSize) {\n\t                self._postCache();\n\t            }\n\t            // discard entry if an error occurs, but warn if level set to do so\n\t        } catch (err) {\n\t            self._emitToConsole('warn', 'MetricsLogger', ['Metrics logger could not stringify logArguments:', namespace, logArguments]);\n\t            self._emitToConsole('error', 'MetricsLogger', [err]);\n\t        }\n\t        return self;\n\t    };\n\t\n\t    /** build a log cache entry object from the given level, namespace, and arguments (optionally adding timestamp */\n\t    MetricsLogger.prototype._buildEntry = function _buildEntry(level, namespace, logArguments) {\n\t        this._emitToConsole('debug', 'MetricsLogger', ['_buildEntry:', arguments]);\n\t        var entry = {\n\t            level: level,\n\t            namespace: this.options.clientPrefix + namespace,\n\t            args: logArguments\n\t        };\n\t        if (this.options.addTime) {\n\t            entry.time = new Date().toISOString();\n\t        }\n\t        return entry;\n\t    };\n\t\n\t    /** post _postSize messages from the cache to the server, removing them if successful\n\t     *      if the post fails, wait until maxCacheSize is accumulated instead and try again then\n\t     *      in addition to the messages from the cache ('metrics'), any info from getPingData (if set) will be sent\n\t     *      onServerResponse will be called (if set) with any response from the server\n\t     */\n\t    MetricsLogger.prototype._postCache = function _postCache(options) {\n\t        options = options || {};\n\t        this._emitToConsole('info', 'MetricsLogger', ['_postCache', options, this._postSize]);\n\t\n\t        // short circuit if we're already sending\n\t        if (!this.options.postUrl || this._sending) {\n\t            return jQuery.when({});\n\t        }\n\t\n\t        var self = this,\n\t            postSize = options.count || self._postSize,\n\t\n\t        // do not splice - remove after *successful* post\n\t        entries = self.cache.get(postSize),\n\t            entriesLength = entries.length,\n\t\n\t        // use the optional getPingData to add any extra info we may want to send\n\t        postData = typeof self.options.getPingData === 'function' ? self.options.getPingData() : {};\n\t        //console.debug( postSize, entriesLength );\n\t\n\t        // add the metrics and send\n\t        postData.metrics = JSON.stringify(entries);\n\t        //console.debug( postData.metrics );\n\t        self._sending = true;\n\t        return jQuery.post(self.options.postUrl, postData).always(function () {\n\t            self._sending = false;\n\t        }).fail(function (xhr, status, message) {\n\t            // if we failed the previous time, set the next post target to the max num of entries\n\t            self._postSize = self.options.maxCacheSize;\n\t            //TODO:??\n\t            // log this failure to explain any gap in metrics\n\t            self.emit('error', 'MetricsLogger', ['_postCache error:', xhr.readyState, xhr.status, xhr.responseJSON || xhr.responseText]);\n\t            //TODO: still doesn't solve the problem that when cache == max, post will be tried on every emit\n\t            //TODO: see _delayPost\n\t        }).done(function (response) {\n\t            if (typeof self.options.onServerResponse === 'function') {\n\t                self.options.onServerResponse(response);\n\t            }\n\t            // only remove if post successful\n\t            self.cache.remove(entriesLength);\n\t            //console.debug( 'removed entries:', entriesLength, 'size now:', self.cache.length() );\n\t            // if we succeeded, reset the post target to the normal num of entries\n\t            self._postSize = self.options.postSize;\n\t        });\n\t        // return the xhr promise\n\t    };\n\t\n\t    /** set _waiting to true and, after delayPostInMs, set it back to false */\n\t    MetricsLogger.prototype._delayPost = function _delayPost() {\n\t        //TODO: this won't work between pages\n\t        var self = this;\n\t        self._waiting = setTimeout(function () {\n\t            self._waiting = null;\n\t        }, self.options.delayPostInMs);\n\t    };\n\t\n\t    //----------------------------------------------------------------------------- console\n\t    /** output message to console based on level and consoleLogger type */\n\t    MetricsLogger.prototype._emitToConsole = function _emitToConsole(level, namespace, logArguments) {\n\t        //console.debug( '_emitToConsole:', level, namespace, logArguments );\n\t        var self = this,\n\t            whitelist = self.options.consoleNamespaceWhitelist;\n\t        if (!self.consoleLogger) {\n\t            return self;\n\t        }\n\t        // if a whitelist for namespaces is set, bail if this namespace is not in the list\n\t        if (whitelist && whitelist.indexOf(namespace) === -1) {\n\t            return self;\n\t        }\n\t\n\t        var args = Array.prototype.slice.call(logArguments, 0);\n\t        args.unshift(namespace);\n\t        //TODO: script location and/or source maps?\n\t        //TODO: branch on navigator.userAgent == AIIEEE - it only has log\n\t        if (level >= MetricsLogger.METRIC && typeof self.consoleLogger.info === 'function') {\n\t            return self.consoleLogger.info.apply(self.consoleLogger, args);\n\t        } else if (level >= MetricsLogger.ERROR && typeof self.consoleLogger.error === 'function') {\n\t            return self.consoleLogger.error.apply(self.consoleLogger, args);\n\t        } else if (level >= MetricsLogger.WARN && typeof self.consoleLogger.warn === 'function') {\n\t            self.consoleLogger.warn.apply(self.consoleLogger, args);\n\t        } else if (level >= MetricsLogger.INFO && typeof self.consoleLogger.info === 'function') {\n\t            self.consoleLogger.info.apply(self.consoleLogger, args);\n\t        } else if (level >= MetricsLogger.DEBUG && typeof self.consoleLogger.debug === 'function') {\n\t            self.consoleLogger.debug.apply(self.consoleLogger, args);\n\t        } else if (typeof self.consoleLogger.log === 'function') {\n\t            self.consoleLogger.log.apply(self.consoleLogger, args);\n\t        }\n\t        return self;\n\t    };\n\t\n\t    //----------------------------------------------------------------------------- shortcuts\n\t    // generic functions when logging from non-namespaced object (e.g. templates)\n\t    /** log to default namespace */\n\t    MetricsLogger.prototype.log = function log() {\n\t        this.emit(1, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n\t    };\n\t\n\t    /** debug to default namespace */\n\t    MetricsLogger.prototype.debug = function debug() {\n\t        this.emit(MetricsLogger.DEBUG, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n\t    };\n\t\n\t    /** info to default namespace */\n\t    MetricsLogger.prototype.info = function info() {\n\t        this.emit(MetricsLogger.INFO, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n\t    };\n\t\n\t    /** warn to default namespace */\n\t    MetricsLogger.prototype.warn = function warn() {\n\t        this.emit(MetricsLogger.WARN, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n\t    };\n\t\n\t    /** error to default namespace */\n\t    MetricsLogger.prototype.error = function error() {\n\t        this.emit(MetricsLogger.ERROR, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n\t    };\n\t\n\t    /** metric to default namespace */\n\t    MetricsLogger.prototype.metric = function metric() {\n\t        this.emit(MetricsLogger.METRIC, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n\t    };\n\t\n\t    /* ============================================================================\n\t    TODO:\n\t        need a performance pass - the JSON un/parsing is a bit much\n\t    \n\t    ============================================================================ */\n\t    /** @class LoggingCache\n\t     *  Simple implementation of cache wrapping an array.\n\t     *\n\t     *  Formats an entry before it's cached and only keeps options.maxSize number\n\t     *  of entries. Older entries are deleted first.\n\t     */\n\t    function LoggingCache(options) {\n\t        var self = this;\n\t        return self._init(options || {});\n\t    }\n\t\n\t    /** default options */\n\t    LoggingCache.defaultOptions = {\n\t        /** maximum number of entries to keep before discarding oldest */\n\t        maxSize: 5000\n\t    };\n\t\n\t    /** initialize with options */\n\t    LoggingCache.prototype._init = function _init(options) {\n\t        if (!this._hasStorage()) {\n\t            //TODO: fall back to jstorage\n\t            throw new Error('LoggingCache needs localStorage');\n\t        }\n\t        if (!options.key) {\n\t            throw new Error('LoggingCache needs key for localStorage');\n\t        }\n\t        this.key = options.key;\n\t        this._initStorage();\n\t\n\t        this.maxSize = options.maxSize || LoggingCache.defaultOptions.maxSize;\n\t        return this;\n\t    };\n\t\n\t    /** tests for localStorage fns */\n\t    LoggingCache.prototype._hasStorage = function _hasStorage() {\n\t        //TODO: modernizr\n\t        var test = 'test';\n\t        try {\n\t            localStorage.setItem(test, test);\n\t            localStorage.removeItem(test);\n\t            return true;\n\t        } catch (e) {\n\t            return false;\n\t        }\n\t    };\n\t\n\t    /** if no localStorage set for key, initialize to empty array */\n\t    LoggingCache.prototype._initStorage = function _initStorage() {\n\t        if (localStorage.getItem(this.key) === null) {\n\t            return this.empty();\n\t        }\n\t        return this;\n\t    };\n\t\n\t    /** add an entry to the cache, removing the oldest beforehand if size >= maxSize */\n\t    LoggingCache.prototype.add = function add(entry) {\n\t        var self = this,\n\t            _cache = self._fetchAndParse(),\n\t            overage = _cache.length + 1 - self.maxSize;\n\t        if (overage > 0) {\n\t            _cache.splice(0, overage);\n\t        }\n\t        _cache.push(entry);\n\t        self._unparseAndStore(_cache);\n\t        return _cache.length;\n\t    };\n\t\n\t    /** get the entries from localStorage and parse them */\n\t    LoggingCache.prototype._fetchAndParse = function _fetchAndParse() {\n\t        var self = this;\n\t        return JSON.parse(localStorage.getItem(self.key));\n\t    };\n\t\n\t    /** stringify the entries and put them in localStorage */\n\t    LoggingCache.prototype._unparseAndStore = function _unparseAndStore(entries) {\n\t        var self = this;\n\t        return localStorage.setItem(self.key, JSON.stringify(entries));\n\t    };\n\t\n\t    ///** process the entry before caching */\n\t    //LoggingCache.prototype._preprocessEntry = function _preprocessEntry( entry ){\n\t    //    return JSON.stringify( entry );\n\t    //};\n\t\n\t    /** return the length --- oh, getters where are you? */\n\t    LoggingCache.prototype.length = function length() {\n\t        return this._fetchAndParse().length;\n\t    };\n\t\n\t    /** get count number of entries starting with the oldest */\n\t    LoggingCache.prototype.get = function get(count) {\n\t        return this._fetchAndParse().slice(0, count);\n\t    };\n\t\n\t    /** remove count number of entries starting with the oldest */\n\t    LoggingCache.prototype.remove = function remove(count) {\n\t        var _cache = this._fetchAndParse(),\n\t            removed = _cache.splice(0, count);\n\t        this._unparseAndStore(_cache);\n\t        return removed;\n\t    };\n\t\n\t    /** empty/clear the entire cache */\n\t    LoggingCache.prototype.empty = function empty() {\n\t        localStorage.setItem(this.key, '[]');\n\t        return this;\n\t    };\n\t\n\t    /** stringify count number of entries (but do not remove) */\n\t    LoggingCache.prototype.stringify = function stringify(count) {\n\t        return JSON.stringify(this.get(count));\n\t    };\n\t\n\t    /** outputs entire cache to console */\n\t    LoggingCache.prototype.print = function print() {\n\t        // popup? (really, carl? a popup?) - easier to copy/paste\n\t        console.log(JSON.stringify(this._fetchAndParse(), null, '  '));\n\t    };\n\t\n\t    //=============================================================================\n\t    return {\n\t        MetricsLogger: MetricsLogger,\n\t        LoggingCache: LoggingCache\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))\n\n/***/ }\n\n});\n\n\n/** WEBPACK FOOTER **\n ** login.bundled.js\n **/","\nvar jQuery = require( 'jquery' ),\n    $ = jQuery,\n    GalaxyApp = require( 'galaxy' ).GalaxyApp,\n    PANEL = require( 'layout/panel' ),\n    _l = require( 'utils/localization' ),\n    PAGE = require( 'layout/page' );\n\nwindow.app = function app( options, bootstrapped ){\n    window.Galaxy = new GalaxyApp( options, bootstrapped );\n    Galaxy.debug( 'login app' );\n    var redirect = encodeURI( options.redirect );\n\n    // TODO: remove iframe for user login (at least) and render login page from here\n    // then remove this redirect\n    if( !options.show_welcome_with_login ){\n        var params = jQuery.param({ use_panels : 'True', redirect : redirect });\n        window.location.href = Galaxy.root + 'user/login?' + params;\n        return;\n    }\n\n    var loginPage = new PAGE.PageLayoutView( _.extend( options, {\n        el      : 'body',\n        center  : new PANEL.CenterPanel({ el : '#center' }),\n        right   : new PANEL.RightPanel({\n            title : _l( 'Login required' ),\n            el : '#right'\n        }),\n    }));\n\n    $(function(){\n        // TODO: incorporate *actual* referrer/redirect info as the original page does\n        var params = jQuery.param({ redirect : redirect }),\n            loginUrl = Galaxy.root + 'user/login?' + params;\n        loginPage.render();\n\n        // welcome page (probably) needs to remain sandboxed\n        loginPage.center.$( '#galaxy_main' ).prop( 'src', options.welcome_url );\n\n        loginPage.right.$( '.unified-panel-body' )\n            .css( 'overflow', 'hidden' )\n            .html( '<iframe src=\"' + loginUrl + '\" frameborder=\"0\" style=\"width: 100%; height: 100%;\"/>' );\n    });\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/apps/login.js\n **/","/**\n * Galaxy utilities comprises small functions, which at this point\n * do not require their own classes/files\n*/\n\n// dependencies\ndefine([], function() {\n\n/** Builds a basic iframe\n*/\nfunction iframe( src ) {\n    return '<iframe src=\"' + src + '\" frameborder=\"0\" style=\"width: 100%; height: 100%;\"/>';\n}\n\n/** Traverse through json\n*/\nfunction deepeach( dict, callback ) {\n    for( var i in dict ) {\n        var d = dict[ i ];\n        if( _.isObject( d ) ) {\n            var new_dict = callback( d );\n            new_dict && ( dict[ i ] = new_dict );\n            deepeach( d, callback );\n        }\n    }\n}\n\n/**\n * Check if a string is a json string\n * @param{String}   text - Content to be validated\n */\nfunction isJSON(text) {\n    return /^[\\],:{}\\s]*$/.test(text.replace(/\\\\[\"\\\\\\/bfnrtu]/g, '@').\n        replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, ']').\n        replace(/(?:^|:|,)(?:\\s*\\[)+/g, ''));\n};\n\n/**\n * Sanitize/escape a string\n * @param{String}   content - Content to be sanitized\n */\nfunction sanitize(content) {\n    return $('<div/>').text(content).html();\n};\n\n/**\n * Checks if a value or list of values is `empty`\n * usually used for selectable options\n * @param{String}   value - Value or list to be validated\n */\nfunction isEmpty ( value ) {\n    if ( !( value instanceof Array ) ) {\n        value = [ value ];\n    }\n    if ( value.length === 0 ) {\n        return true;\n    }\n    for( var i in value ) {\n        if ( [ '__null__', '__undefined__', null, undefined ].indexOf( value[ i ] ) > -1 ) {\n            return true;\n        }\n    }\n    return false;\n};\n\n/**\n * Convert list to pretty string\n * @param{String}   lst - List of strings to be converted in human readable list sentence\n */\nfunction textify( lst ) {\n    if ( $.isArray( lst ) ) {\n        var lst = lst.toString().replace( /,/g, ', ' );\n        var pos = lst.lastIndexOf( ', ' );\n        if ( pos != -1 ) {\n            lst = lst.substr( 0, pos ) + ' or ' + lst.substr( pos + 2 );\n        }\n        return lst;\n    }\n    return '';\n};\n\n/**\n * Request handler for GET\n * @param{String}   url     - Url request is made to\n * @param{Function} success - Callback on success\n * @param{Function} error   - Callback on error\n * @param{Boolean}  cache   - Use cached data if available\n */\nfunction get (options) {\n    top.__utils__get__ = top.__utils__get__ || {};\n    var cache_key = JSON.stringify( options );\n    if (options.cache && top.__utils__get__[cache_key]) {\n        options.success && options.success(top.__utils__get__[cache_key]);\n        window.console.debug('utils.js::get() - Fetching from cache [' + options.url + '].');\n    } else {\n        request({\n            url     : options.url,\n            data    : options.data,\n            success : function(response) {\n                top.__utils__get__[cache_key] = response;\n                options.success && options.success(response);\n            },\n            error : function(response) {\n                options.error && options.error(response);\n            }\n        });\n    }\n};\n\n/**\n * Request handler\n * @param{String}   method  - Request method ['GET', 'POST', 'DELETE', 'PUT']\n * @param{String}   url     - Url request is made to\n * @param{Object}   data    - Data send to url\n * @param{Function} success - Callback on success\n * @param{Function} error   - Callback on error\n */\nfunction request (options) {\n    // prepare ajax\n    var ajaxConfig = {\n        contentType : 'application/json',\n        type        : options.type || 'GET',\n        data        : options.data || {},\n        url         : options.url\n    }\n    // encode data into url\n    if ( ajaxConfig.type == 'GET' || ajaxConfig.type == 'DELETE' ) {\n        if ( !$.isEmptyObject(ajaxConfig.data) ) {\n            ajaxConfig.url += ajaxConfig.url.indexOf('?') == -1 ? '?' : '&';\n            ajaxConfig.url += $.param(ajaxConfig.data, true);\n        }\n        ajaxConfig.data = null;\n    } else {\n        ajaxConfig.dataType = 'json';\n        ajaxConfig.url      = ajaxConfig.url;\n        ajaxConfig.data     = JSON.stringify(ajaxConfig.data);\n    }\n\n    // make request\n    $.ajax(ajaxConfig).done(function(response) {\n        if (typeof response === 'string') {\n            try {\n                response = response.replace('Infinity,', '\"Infinity\",');\n                response = jQuery.parseJSON(response);\n            } catch (e) {\n                console.debug(e);\n            }\n        }\n        options.success && options.success(response);\n    }).fail(function(response) {\n        var response_text = null;\n        try {\n            response_text = jQuery.parseJSON(response.responseText);\n        } catch (e) {\n            response_text = response.responseText;\n        }\n        options.error && options.error(response_text, response);\n    }).always(function() {\n        options.complete && options.complete();\n    });\n};\n\n/**\n * Read a property value from CSS\n * @param{String}   classname   - CSS class\n * @param{String}   name        - CSS property\n */\nfunction cssGetAttribute (classname, name) {\n    var el = $('<div class=\"' + classname + '\"></div>');\n    el.appendTo(':eq(0)');\n    var value = el.css(name);\n    el.remove();\n    return value;\n};\n\n/**\n * Load a CSS file\n * @param{String}   url - Url of CSS file\n */\nfunction cssLoadFile (url) {\n    if (!$('link[href^=\"' + url + '\"]').length) {\n        $('<link href=\"' + Galaxy.root + url + '\" rel=\"stylesheet\">').appendTo('head');\n    }\n};\n\n/**\n * Safely merge to dictionaries\n * @param{Object}   options         - Target dictionary\n * @param{Object}   optionsDefault  - Source dictionary\n */\nfunction merge (options, optionsDefault) {\n    if (options) {\n        return _.defaults(options, optionsDefault);\n    } else {\n        return optionsDefault;\n    }\n};\n\n\n/**\n * Round floaing point 'number' to 'numPlaces' number of decimal places.\n * @param{Object}   number      a floaing point number\n * @param{Object}   numPlaces   number of decimal places\n */\nfunction roundToDecimalPlaces( number, numPlaces ){\n    var placesMultiplier = 1;\n    for( var i=0; i<numPlaces; i++ ){\n        placesMultiplier *= 10;\n    }\n    return Math.round( number * placesMultiplier ) / placesMultiplier;\n}\n\n// calculate on import\nvar kb = 1024,\n    mb = kb * kb,\n    gb = mb * kb,\n    tb = gb * kb;\n/**\n * Format byte size to string with units\n * @param{Integer}   size           - Size in bytes\n * @param{Boolean}   normal_font    - Switches font between normal and bold\n */\nfunction bytesToString (size, normal_font, numberPlaces) {\n    numberPlaces = numberPlaces !== undefined? numberPlaces: 1;\n    // identify unit\n    var unit = \"\";\n    if (size >= tb){ size = size / tb; unit = 'TB'; } else\n    if (size >= gb){ size = size / gb; unit = 'GB'; } else\n    if (size >= mb){ size = size / mb; unit = 'MB'; } else\n    if (size >= kb){ size = size / kb; unit = 'KB'; } else\n    if (size >  0){ unit = 'b'; }\n    else { return normal_font? '0 b': '<strong>-</strong>'; }\n    // return formatted string\n    var rounded = unit == 'b'? size: roundToDecimalPlaces( size, numberPlaces );\n    if (normal_font) {\n       return  rounded + ' ' + unit;\n    } else {\n        return '<strong>' + rounded + '</strong> ' + unit;\n    }\n};\n\n/**\n * Create a unique id\n */\nfunction uid(){\n    top.__utils__uid__ = top.__utils__uid__ || 0;\n    return 'uid-' + top.__utils__uid__++;\n};\n\n/**\n * Create a time stamp\n */\nfunction time() {\n    var d = new Date();\n    var hours = (d.getHours() < 10 ? \"0\" : \"\") + d.getHours();\n    var minutes = (d.getMinutes() < 10 ? \"0\" : \"\") + d.getMinutes()\n    return datetime = d.getDate() + \"/\"\n                + (d.getMonth() + 1)  + \"/\"\n                + d.getFullYear() + \", \"\n                + hours + \":\"\n                + minutes;\n};\n\nreturn {\n    cssLoadFile: cssLoadFile,\n    cssGetAttribute: cssGetAttribute,\n    get: get,\n    merge: merge,\n    iframe: iframe,\n    bytesToString: bytesToString,\n    uid: uid,\n    time: time,\n    request: request,\n    sanitize: sanitize,\n    textify: textify,\n    isEmpty: isEmpty,\n    deepeach: deepeach,\n    isJSON: isJSON\n};\n\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/utils/utils.js\n **/","define([], function() {\nvar View = Backbone.View.extend({\n    // defaults\n    optionsDefault  : {\n        container        : 'body',\n        title            : 'ui-modal',\n        cls              : 'ui-modal',\n        body             : '',\n        backdrop         : true,\n        height           : null,\n        width            : null,\n        closing_events   : false,\n        closing_callback : null,\n        title_separator  : true\n    },\n\n    // button list\n    buttonList: {},\n\n    // initialize\n    initialize: function( options ) {\n        this.setElement( this._template() );\n        this.options = _.defaults( options || {}, this.optionsDefault );\n        $( this.options.container ).prepend( this.el );\n\n        // link elements\n        this.$header    = this.$( '.modal-header' );\n        this.$dialog    = this.$( '.modal-dialog' );\n        this.$body      = this.$( '.modal-body' );\n        this.$footer    = this.$( '.modal-footer' );\n        this.$backdrop  = this.$( '.modal-backdrop' );\n        this.$buttons   = this.$( '.buttons' );\n\n        // optional render\n        options && this.render();\n    },\n\n    /**\n     * Displays modal\n    */\n    show: function( options ) {\n        if ( options ) {\n            this.options = _.defaults( options, this.optionsDefault );\n            this.render();\n        }\n        if ( !this.visible ) {\n            this.visible = true;\n            this.$el.fadeIn( 'fast' );\n            if ( this.options.closing_events ) {\n                var self = this;\n                $( document ).on( 'keyup.ui-modal', function( e ) { e.keyCode == 27 && self.hide( true ) });\n                this.$backdrop.on( 'click', function() { self.hide( true ) } );\n            }\n        }\n    },\n\n    /**\n     * Hide modal\n    */\n    hide: function( canceled ) {\n        this.visible = false;\n        this.$el.fadeOut( 'fast' );\n        this.options.closing_callback && this.options.closing_callback( canceled );\n        $( document ).off( 'keyup.ui-modal' );\n        this.$backdrop.off( 'click' );\n    },\n\n    /**\n     * Render modal\n    */\n    render: function() {\n        var self = this;\n        if (this.options.body == 'progress') {\n            this.options.body = $(  '<div class=\"progress progress-striped active\">' +\n                                        '<div class=\"progress-bar progress-bar-info\" style=\"width:100%\"/>' +\n                                    '</div>' );\n        }\n\n        // fix main content\n        this.$el.removeClass().addClass( 'modal' ).addClass( this.options.cls );\n        this.$header.find( '.title' ).html( this.options.title );\n        this.$body.html( this.options.body );\n\n        // append buttons\n        this.$buttons.empty();\n        this.buttonList = {};\n        if ( this.options.buttons ) {\n            var counter = 0;\n            $.each( this.options.buttons, function( name, callback ) {\n                var $button = $( '<button/>' ).attr( 'id', 'button-' + counter++ ).text( name ).click( callback );\n                self.$buttons.append( $button ).append( '&nbsp;' );\n                self.buttonList[ name ] = $button;\n            });\n        } else {\n            this.$footer.hide();\n        }\n\n        // configure background, separator line\n        this.$backdrop[ this.options.backdrop && 'addClass' || 'removeClass' ]( 'in' );\n        this.$header[ !this.options.title_separator && 'addClass' || 'removeClass' ]( 'no-separator' );\n\n        // fix dimensions\n        if ( this.options.height ) {\n            this.$body.css( 'height', this.options.height );\n            this.$body.css( 'overflow', 'hidden' );\n        } else {\n            this.$body.css( 'max-height', $( window ).height() / 2 );\n        }\n        if ( this.options.width ) {\n            this.$dialog.css( 'width', this.options.width );\n        }\n    },\n\n    /**\n     * Returns the button dom\n     * @param{String}   name    - Button name/title\n    */\n    getButton: function( name ) {\n        return this.buttonList[ name ];\n    },\n\n    /**\n     * Enables a button\n     * @param{String}   name    - Button name/title\n    */\n    enableButton: function( name ) {\n        this.getButton( name ).prop( 'disabled', false );\n    },\n\n    /**\n     * Disables a button\n     * @param{String}   name    - Button name/title\n    */\n    disableButton: function( name ) {\n        this.getButton( name ).prop( 'disabled', true );\n    },\n\n    /**\n     * Show a button\n     * @param{String}   name    - Button name/title\n    */\n    showButton: function( name ) {\n        this.getButton( name ).show();\n    },\n\n    /**\n     * Hide a button\n     * @param{String}   name    - Button name/title\n    */\n    hideButton: function( name ) {\n        this.getButton( name ).hide();\n    },\n\n    /**\n     * Returns scroll top for body element\n    */\n    scrollTop: function() {\n        return this.$body.scrollTop();\n    },\n\n    /**\n     * Returns the modal template\n    */\n    _template: function() {\n        return  '<div class=\"ui-modal\">' +\n                    '<div class=\"modal-backdrop fade\"/>' +\n                    '<div class=\"modal-dialog\">' +\n                        '<div class=\"modal-content\">' +\n                            '<div class=\"modal-header\">' +\n                                '<h4 class=\"title\"/>' +\n                            '</div>' +\n                            '<div class=\"modal-body\"/>' +\n                            '<div class=\"modal-footer\">' +\n                                '<div class=\"buttons\"/>' +\n                            '</div>' +\n                        '</div>' +\n                    '</div>' +\n                '</div>';\n    }\n});\n\nreturn {\n    View : View\n}\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/ui-modal.js\n **/","define([], function() {\n\n/** Frame view */\nvar FrameView = Backbone.View.extend({\n    initialize: function( options ) {\n        var self = this;\n        this.model = options && options.model || new Backbone.Model( options );\n        this.setElement( $( '<div/>' ).addClass( 'corner frame' ) );\n        this.$el.append( $( '<div/>' ).addClass( 'f-header corner' )\n                                      .append( $( '<div/>' ).addClass( 'f-title' ) )\n                                      .append( $( '<div/>' ).addClass( 'f-icon f-close fa fa-close' )\n                                                            .tooltip( { title: 'Close', placement: 'bottom' } ) ) )\n                .append( $( '<div/>' ).addClass( 'f-content' ) )\n                .append( $( '<div/>' ).addClass( 'f-resize f-icon corner fa fa-expand' ).tooltip( { title: 'Resize' } ) )\n                .append( $( '<div/>' ).addClass( 'f-cover' ) );\n        this.$header  = this.$( '.f-header' );\n        this.$title   = this.$( '.f-title' );\n        this.$content = this.$( '.f-content' );\n        this.render();\n        this.listenTo( this.model, 'change', this.render, this );\n    },\n\n    render: function() {\n        var self = this;\n        var options = this.model.attributes;\n        this.$title.html( options.title || '' );\n        this.$header.find( '.f-icon-left' ).remove();\n        _.each( options.menu, function( option ) {\n            var $option = $( '<div/>' ).addClass( 'f-icon-left' ).addClass( option.icon );\n            if ( _.isFunction( option.disabled ) && option.disabled() ) {\n                $option.attr( 'disabled', true );\n            } else {\n                $option.on( 'click', function() { option.onclick( self ) } )\n                       .tooltip( { title: option.tooltip, placement: 'bottom' } );\n            }\n            self.$header.append( $option );\n        } );\n        if ( options.url ) {\n            this.$content.html( $ ( '<iframe/>' ).addClass( 'f-iframe' )\n                                                 .attr( 'scrolling', 'auto' )\n                                                 .attr( 'src', options.url + ( options.url.indexOf( '?' ) === -1 ? '?' : '&' ) + 'widget=True' ) );\n        } else if ( options.content ) {\n            _.isFunction( options.content ) ? options.content( self.$content ) : self.$content.html( options.content );\n        }\n    }\n});\n\n/** Scratchbook viewer */\nvar View = Backbone.View.extend({\n    defaultOptions: {\n        frame: {             // default frame size in cells\n            cols : 6,\n            rows : 3\n        },\n        rows        : 1000,  // maximum number of rows\n        cell        : 130,   // cell size in px\n        margin      : 5,     // margin between frames\n        scroll      : 5,     // scroll speed\n        top_min     : 40,    // top margin\n        frame_max   : 9,     // maximum number of frames\n        visible     : true,  // initial visibility\n    },\n\n    cols            : 0,     // number of columns\n    top             : 0,     // scroll/element top\n    top_max         : 0,     // viewport scrolling state\n    frame_z         : 0,     // frame z-index\n    frame_counter   : 0,     // frame counter\n    frame_uid       : 0,     // unique frame id counter\n    frame_list      : {},    // list of all frames\n    frame_shadow    : null,  // frame shown as placeholder when moving active frames\n    visible         : false, // flag indicating if scratchbook viewer is visible or not\n    event           : {},    // dictionary keeping track of current event\n\n    initialize : function( options ) {\n        var self = this;\n        this.options = _.defaults( options || {}, this.defaultOptions );\n        this.visible = this.options.visible;\n        this.top = this.top_max = this.options.top_min;\n        this.setElement( $( '<div/>' ).addClass( 'galaxy-frame' )\n                            .append( $( '<div/>' ).addClass( 'frame-background' ) )\n                            .append( $( '<div/>' ).addClass( 'frame-menu frame-scroll-up fa fa-chevron-up fa-2x' ) )\n                            .append( $( '<div/>' ).addClass( 'frame-menu frame-scroll-down fa fa-chevron-down fa-2x' ) ) );\n\n        // initialize shadow to guiding drag/resize events\n        this.frame_shadow = new Backbone.View({ el: $( '<div/>' ).addClass( 'corner frame-shadow' ) } );\n        this.$el.append( this.frame_shadow.$el );\n        this._frameInit( this.frame_shadow, '#frame-shadow' );\n        this._frameResize( this.frame_shadow, { width: 0, height: 0 } );\n        this.frame_list[ '#frame-shadow' ] = this.frame_shadow;\n\n        // initialize panel\n        this.visible ? this.show() : this.hide();\n        this._panelRefresh();\n        $( window ).resize( function() { self.visible && self._panelRefresh() } );\n    },\n\n    /** Render */\n    render: function() {\n        this.$( '.frame-scroll-up' ) [ this.top != this.options.top_min && 'show' || 'hide' ]();\n        this.$( '.frame-scroll-down')[ this.top != this.top_max && 'show' || 'hide' ]();\n    },\n\n    /**\n     * Adds and displays a new frame.\n     *\n     * options:\n     *  url     : loaded into an iframe\n     *  content : content is treated as a function or raw HTML, function is passed a single\n     *              argument that is the frame's content DOM element\n     */\n    add: function( options ) {\n        if ( this.frame_counter >= this.options.frame_max ) {\n            Galaxy.modal.show( {\n                title   : 'Warning',\n                body    : 'You have reached the maximum number of allowed frames (' + this.options.frame_max + ').',\n                buttons : { 'Close' : function() { Galaxy.modal.hide() } }\n            });\n\n        } else {\n            var frame_id = '#frame-' + ( this.frame_uid++ );\n            if ( $ ( frame_id ).length !== 0 ) {\n                Galaxy.modal.show( {\n                    title   : 'Error',\n                    body    : 'This frame already exists. This page might contain multiple frame managers.',\n                    buttons : { 'Close' : function() { Galaxy.modal.hide() } }\n                });\n            } else {\n                // initialize new frame elements\n                this.top = this.options.top_min;\n                var frame = new FrameView( options );\n                this.$el.append( frame.$el );\n\n                // set dimensions\n                options.width   = this._toPixelCoord( 'width', this.options.frame.cols );\n                options.height  = this._toPixelCoord( 'height', this.options.frame.rows );\n\n                // set default z-index and add to ui and frame list\n                this.frame_z = parseInt( frame.$el.css( 'z-index' ) );\n                this.frame_list[ frame_id ] = frame;\n                this.frame_counter++;\n                this._frameInit( frame, frame_id );\n                this._frameResize( frame, { width: options.width, height: options.height } );\n                this._frameInsert( frame, { top: 0, left: 0 }, true );\n                !this.visible && this.show();\n                this.trigger( 'add' );\n            }\n        }\n    },\n\n    /** Remove a frame */\n    del: function( frame ) {\n        var self = this;\n        var $frame = frame.$el;\n        $frame.fadeOut( 'fast', function() {\n            $frame.remove();\n            delete self.frame_list[ frame.id ];\n            self.frame_counter--;\n            self._panelRefresh( true );\n            self._panelAnimationComplete();\n            self.trigger( 'remove' );\n        });\n    },\n\n    /** Show panel */\n    show: function() {\n        this.visible = true;\n        this.$el.fadeIn( 'fast' );\n        this.trigger( 'show' );\n    },\n\n    /** Hide panel */\n    hide: function() {\n        if ( !this.event.type ) {\n            this.visible = false;\n            this.$el.fadeOut('fast', function() { $( this ).hide() });\n            this.trigger( 'hide' );\n        }\n    },\n\n    /** Returns the number of frames */\n    length: function() {\n        return this.frame_counter;\n    },\n\n    /*\n        EVENT HANDLING\n    */\n    events: {\n        // global frame events\n        'mousemove'                         : '_eventFrameMouseMove',\n        'mouseup'                           : '_eventFrameMouseUp',\n        'mouseleave'                        : '_eventFrameMouseUp',\n        'mousewheel'                        : '_eventPanelScroll',\n        'DOMMouseScroll'                    : '_eventPanelScroll',\n\n        // events fixed to elements\n        'mousedown .frame'                  : '_eventFrameMouseDown',\n        'mousedown .frame-background'       : '_eventHide',\n        'mousedown .frame-scroll-up'        : '_eventPanelScroll_up',\n        'mousedown .frame-scroll-down'      : '_eventPanelScroll_down',\n        'mousedown .f-close'                : '_eventFrameClose'\n    },\n\n    /** Start drag/resize event */\n    _eventFrameMouseDown: function ( e ) {\n        $( '.tooltip' ).hide();\n        if ( !this.event.type ) {\n            if ( $( e.target ).hasClass( 'f-header' ) || $( e.target ).hasClass( 'f-title' ) ) {\n                this.event.type = 'drag';\n            }\n            if ( $( e.target ).hasClass( 'f-resize' ) ) {\n                this.event.type = 'resize';\n            }\n            if ( this.event.type ) {\n                e.preventDefault();\n                this.event.target = this._frameIdentify( e.target );\n                this.event.xy = {\n                    x: e.originalEvent.pageX,\n                    y: e.originalEvent.pageY\n                };\n                this._frameDragStart( this.event.target );\n            }\n        }\n    },\n\n    /** Processes drag/resize events */\n    _eventFrameMouseMove: function ( e ) {\n        if ( this.event.type ) {\n            // get mouse motion and delta\n            var event_xy_new = {\n                x : e.originalEvent.pageX,\n                y : e.originalEvent.pageY\n            };\n            var event_xy_delta = {\n                x : event_xy_new.x - this.event.xy.x,\n                y : event_xy_new.y - this.event.xy.y\n            };\n            this.event.xy = event_xy_new;\n\n            // get current screen position and size of frame\n            var p = this._frameScreen ( this.event.target );\n\n            // drag/resize event\n            if ( this.event.type == 'resize' ) {\n                p.width  += event_xy_delta.x;\n                p.height += event_xy_delta.y;\n                var min_dim = this.options.cell - this.options.margin - 1;\n                p.width = Math.max( p.width, min_dim );\n                p.height = Math.max( p.height, min_dim );\n                this._frameResize( this.event.target, p );\n                p.width = this._toGridCoord( 'width', p.width ) + 1;\n                p.height = this._toGridCoord( 'height', p.height ) + 1;\n                p.width = this._toPixelCoord( 'width', p.width );\n                p.height = this._toPixelCoord( 'height', p.height );\n                this._frameResize( this.frame_shadow, p );\n                this._frameInsert( this.frame_shadow, {\n                    top     : this._toGridCoord( 'top', p.top ),\n                    left    : this._toGridCoord( 'left', p.left )\n                });\n            } else if ( this.event.type == 'drag' ) {\n                p.left  += event_xy_delta.x;\n                p.top   += event_xy_delta.y;\n                this._frameOffset( this.event.target, p );\n                var l = {\n                    top     : this._toGridCoord( 'top', p.top ),\n                    left    : this._toGridCoord( 'left', p.left )\n                };\n                l.left !== 0 && l.left++;\n                this._frameInsert( this.frame_shadow, l );\n            }\n        }\n    },\n\n    /** Stop drag/resize events */\n    _eventFrameMouseUp: function ( e ) {\n        if ( this.event.type ) {\n            this._frameDragStop( this.event.target );\n            this.event.type = null;\n        }\n    },\n\n    /** Destroy a frame */\n    _eventFrameClose: function ( e ) {\n        if ( !this.event.type ) {\n            e.preventDefault();\n            this.del( this._frameIdentify( e.target ) );\n        }\n    },\n\n    /** Hide all frames */\n    _eventHide: function ( e ) {\n        !this.event.type && this.hide();\n    },\n\n    /** Fired when scrolling occurs on panel */\n    _eventPanelScroll: function( e ) {\n        if ( !this.event.type && this.visible ) {\n            // Stop propagation if scrolling is happening inside a frame.\n            // TODO: could propagate scrolling if at top/bottom of frame.\n            var frames = $( e.srcElement ).parents( '.frame' );\n            if ( frames.length !== 0 ) {\n                e.stopPropagation();\n            } else {\n                e.preventDefault();\n                this._panelScroll( e.originalEvent.detail ? e.originalEvent.detail : e.originalEvent.wheelDelta / -3 );\n            }\n        }\n    },\n\n    /** Handle scroll up event */\n    _eventPanelScroll_up: function( e ) {\n        if ( !this.event.type ) {\n            e.preventDefault();\n            this._panelScroll( -this.options.scroll );\n        }\n    },\n\n    /** Handle scroll down */\n    _eventPanelScroll_down: function(e) {\n        if ( !this.event.type ) {\n            e.preventDefault();\n            this._panelScroll( this.options.scroll );\n        }\n    },\n\n    /*\n        FRAME EVENTS SUPPORT\n    */\n\n    /** Identify the target frame */\n    _frameIdentify: function( target ) {\n        return this.frame_list[ '#' + $( target ).closest( '.frame' ).attr( 'id' ) ];\n    },\n\n    /** Provides drag support */\n    _frameDragStart : function ( frame ) {\n        this._frameFocus( frame, true );\n        var p = this._frameScreen( frame );\n        this._frameResize( this.frame_shadow, p );\n        this._frameGrid( this.frame_shadow, frame.grid_location );\n        frame.grid_location = null;\n        this.frame_shadow.$el.show();\n        $( '.f-cover' ).show();\n    },\n\n    /** Removes drag support */\n    _frameDragStop : function ( frame ) {\n        this._frameFocus( frame, false );\n        var p = this._frameScreen( this.frame_shadow );\n        this._frameResize( frame, p );\n        this._frameGrid( frame, this.frame_shadow.grid_location, true );\n        this.frame_shadow.grid_location = null;\n        this.frame_shadow.$el.hide();\n        $( '.f-cover' ).hide();\n        this._panelAnimationComplete();\n    },\n\n    /*\n        GRID/PIXEL CONVERTER\n    */\n\n    /** Converts a pixel to a grid dimension */\n    _toGridCoord: function ( type, px ) {\n        var sign = ( type == 'width' || type == 'height' ) ? 1 : -1;\n        type == 'top' && ( px -= this.top );\n        return parseInt( ( px + sign * this.options.margin ) / this.options.cell, 10 );\n    },\n    \n    /** Converts a grid to a pixels dimension */\n    _toPixelCoord: function ( type, g ) {\n        var sign = ( type == 'width' || type == 'height' ) ? 1 : -1;\n        var px = ( g * this.options.cell ) - sign * this.options.margin;\n        type == 'top' && ( px += this.top );\n        return px;\n    },\n\n    /** Converts a pixel to a grid coordinate set */\n    _toGrid: function ( px ) {\n        return {\n            top     : this._toGridCoord( 'top', px.top ),\n            left    : this._toGridCoord( 'left', px.left ),\n            width   : this._toGridCoord( 'width', px.width ),\n            height  : this._toGridCoord( 'height', px.height )\n        };\n    },\n\n    /** Converts a pixel to a grid coordinate set */\n    _toPixel: function( g ) {\n        return {\n            top     : this._toPixelCoord( 'top', g.top ),\n            left    : this._toPixelCoord( 'left', g.left ),\n            width   : this._toPixelCoord( 'width', g.width ),\n            height  : this._toPixelCoord( 'height', g.height )\n        };\n    },\n\n    /* \n        COLLISION DETECTION\n    */\n\n    /** Check collisions for a grid coordinate set */\n    _isCollision: function( g ) {\n        function is_collision_pair ( a, b ) {\n            return !( a.left > b.left + b.width - 1 || a.left + a.width - 1 < b.left ||\n                      a.top > b.top + b.height  - 1 || a.top + a.height - 1 < b.top );\n        }\n        for ( var i in this.frame_list ) {\n            var frame = this.frame_list[ i ];\n            if ( frame.grid_location !== null && is_collision_pair ( g, frame.grid_location ) ) {\n                return true;\n            }\n        }\n        return false;\n    },\n\n    /** Return location/grid rank */\n    _locationRank: function( loc ) {\n        return ( loc.top * this.cols ) + loc.left;\n    },\n\n    /*\n        PANEL/WINDOW FUNCTIONS\n    */\n\n    /** Refresh panel */\n    _panelRefresh: function( animate ) {\n        this.cols = parseInt( $( window ).width() / this.options.cell, 10 ) + 1;\n        this._frameInsert( null, null, animate );\n    },\n\n    /** Complete panel animation / frames not moving */\n    _panelAnimationComplete: function() {\n        var self = this;\n        $( '.frame' ).promise().done( function() { self._panelScroll( 0, true ) } );\n    },\n\n    /** Scroll panel */\n    _panelScroll: function( delta, animate ) {\n        var top_new = this.top - this.options.scroll * delta;\n        top_new = Math.max( top_new, this.top_max );\n        top_new = Math.min( top_new, this.options.top_min );\n        if ( this.top != top_new ) {\n            for ( var i in this.frame_list ) {\n                var frame = this.frame_list[ i ];\n                if ( frame.grid_location !== null ) {\n                    var screen_location = {\n                        top  : frame.screen_location.top - ( this.top - top_new ),\n                        left : frame.screen_location.left\n                    }\n                    this._frameOffset( frame, screen_location, animate );\n                }\n            }\n            this.top = top_new;\n        }\n        this.render();\n    },\n\n    /*\n        FRAME FUNCTIONS\n    */\n\n    /** Initialize a new frame */\n    _frameInit: function( frame, id ) {\n        frame.id              = id\n        frame.screen_location = {};\n        frame.grid_location   = {};\n        frame.grid_rank       = null;\n        frame.$el.attr( 'id', id.substring( 1 ) );\n    },\n\n    /** Insert frame at given location */\n    _frameInsert: function( frame, new_loc, animate ) {\n        var self = this;\n        var place_list = [];\n        if ( frame ) {\n            frame.grid_location = null;\n            place_list.push( [ frame, this._locationRank( new_loc ) ] );\n        }\n        _.each( this.frame_list, function( f ) {\n            if ( f.grid_location !== null ) {\n                f.grid_location = null;\n                place_list.push( [ f, f.grid_rank ] );\n            }\n        });\n        place_list.sort( function( a, b ) {\n            return a[ 1 ] < b[ 1 ] ? -1 : ( a[ 1 ] > b[ 1 ] ? 1 : 0 );\n        });\n        _.each( place_list, function( place ) {\n            self._framePlace( place[ 0 ], animate );\n        });\n        this.top_max = 0;\n        _.each( this.frame_list, function( f ) {\n            if ( f.grid_location !== null ) {\n                self.top_max = Math.max( self.top_max, f.grid_location.top + f.grid_location.height );\n            }\n        });\n        this.top_max = $( window ).height() - this.top_max * this.options.cell - 2 * this.options.margin;\n        this.top_max = Math.min( this.top_max, this.options.top_min );\n        this.render();\n    },\n\n    /** Naive frame placement */\n    _framePlace: function( frame, animate ) {\n        frame.grid_location = null;\n        var g = this._toGrid( this._frameScreen( frame ) );\n        var done = false;\n        for ( var i = 0; i < this.options.rows; i++ ) {\n            for ( var j = 0; j < Math.max(1, this.cols - g.width ); j++ ) {\n                g.top   = i;\n                g.left  = j;\n                if ( !this._isCollision( g ) ) {\n                    done = true;\n                    break;\n                }\n            }\n            if ( done ) {\n                break;\n            }\n        }\n        if ( done ) {\n            this._frameGrid( frame, g, animate );\n        } else {\n            console.log( 'Grid dimensions exceeded.' );\n        }\n    },\n\n    /** Handle frame focussing */\n    _frameFocus: function( frame, has_focus ) {\n        frame.$el.css( 'z-index', this.frame_z + ( has_focus ? 1 : 0 ) );\n    },\n\n    /** New left/top position frame */\n    _frameOffset: function( frame, p, animate ) {\n        frame.screen_location.left = p.left;\n        frame.screen_location.top = p.top;\n        if ( animate ) {\n            this._frameFocus( frame, true );\n            var self = this;\n            frame.$el.animate({ top: p.top, left: p.left }, 'fast', function() {\n                self._frameFocus( frame, false );\n            });\n        } else {\n            frame.$el.css( { top: p.top, left: p.left } );\n        }\n    },\n\n    /** Resize frame */\n    _frameResize: function( frame, p ) {\n        frame.$el.css( { width: p.width, height: p.height } );\n        frame.screen_location.width = p.width;\n        frame.screen_location.height = p.height;\n    },\n\n    /** Push frame to new grid location */\n    _frameGrid: function ( frame, l, animate ) {\n        frame.grid_location = l;\n        this._frameOffset( frame, this._toPixel( l ), animate );\n        frame.grid_rank = this._locationRank( l );\n    },\n\n    /** Get frame dimensions */\n    _frameScreen: function( frame ) {\n        var p = frame.screen_location;\n        return { top: p.top, left: p.left, width: p.width, height: p.height };\n    }\n});\n\nreturn {\n    View: View\n}\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/ui/ui-frames.js\n **/","define([\n    'libs/underscore',\n    'libs/backbone',\n    'mvc/base-mvc',\n    'utils/localization'\n], function( _, Backbone, baseMVC, _l ){\n'use strict';\n\nvar logNamespace = 'user';\n//==============================================================================\n/** @class Model for a Galaxy user (including anonymous users).\n *  @name User\n */\nvar User = Backbone.Model.extend( baseMVC.LoggableMixin ).extend(\n/** @lends User.prototype */{\n    _logNamespace : logNamespace,\n\n    /** API location for this resource */\n    urlRoot : function(){ return Galaxy.root + 'api/users'; },\n\n    /** Model defaults\n     *  Note: don't check for anon-users with the username as the default is '(anonymous user)'\n     *      a safer method is if( !user.get( 'email' ) ) -> anon user\n     */\n    defaults : /** @lends User.prototype */{\n        id                      : null,\n        username                : '(' + _l( \"anonymous user\" ) + ')',\n        email                   : \"\",\n        total_disk_usage        : 0,\n        nice_total_disk_usage   : \"\",\n        quota_percent           : null,\n        is_admin                : false\n    },\n\n    /** Set up and bind events\n     *  @param {Object} data Initial model data.\n     */\n    initialize : function( data ){\n        this.log( 'User.initialize:', data );\n\n        this.on( 'loaded', function( model, resp ){ this.log( this + ' has loaded:', model, resp ); });\n        this.on( 'change', function( model, data ){ this.log( this + ' has changed:', model, data.changes ); });\n    },\n\n    isAnonymous : function(){\n        return ( !this.get( 'email' ) );\n    },\n\n    isAdmin : function(){\n        return ( this.get( 'is_admin' ) );\n    },\n\n    /** Load a user with the API using an id.\n     *      If getting an anonymous user or no access to a user id, pass the User.CURRENT_ID_STR\n     *      (e.g. 'current') and the API will return the current transaction's user data.\n     *  @param {String} idOrCurrent encoded user id or the User.CURRENT_ID_STR\n     *  @param {Object} options hash to pass to Backbone.Model.fetch. Can contain success, error fns.\n     *  @fires loaded when the model has been loaded from the API, passing the newModel and AJAX response.\n     */\n    loadFromApi : function( idOrCurrent, options ){\n        idOrCurrent = idOrCurrent || User.CURRENT_ID_STR;\n\n        options = options || {};\n        var model = this,\n            userFn = options.success;\n\n        /** @ignore */\n        options.success = function( newModel, response ){\n            model.trigger( 'loaded', newModel, response );\n            if( userFn ){ userFn( newModel, response ); }\n        };\n\n        // requests for the current user must have a sep. constructed url (fetch don't work, ma)\n        if( idOrCurrent === User.CURRENT_ID_STR ){\n            options.url = this.urlRoot + '/' + User.CURRENT_ID_STR;\n        }\n        return Backbone.Model.prototype.fetch.call( this, options );\n    },\n\n    /** Clears all data from the sessionStorage.\n     */\n    clearSessionStorage : function(){\n        for( var key in sessionStorage ){\n            //TODO: store these under the user key so we don't have to do this\n            // currently only history\n            if( key.indexOf( 'history:' ) === 0 ){\n                sessionStorage.removeItem( key );\n\n            } else if( key === 'history-panel' ){\n                sessionStorage.removeItem( key );\n            }\n        }\n    },\n\n    /** string representation */\n    toString : function(){\n        var userInfo = [ this.get( 'username' ) ];\n        if( this.get( 'id' ) ){\n            userInfo.unshift( this.get( 'id' ) );\n            userInfo.push( this.get( 'email' ) );\n        }\n        return 'User(' + userInfo.join( ':' ) + ')';\n    }\n});\n\n// string to send to tell server to return this transaction's user (see api/users.py)\nUser.CURRENT_ID_STR = 'current';\n\n// class method to load the current user via the api and return that model\nUser.getCurrentUserFromApi = function( options ){\n    var currentUser = new User();\n    currentUser.loadFromApi( User.CURRENT_ID_STR, options );\n    return currentUser;\n};\n\n// (stub) collection for users (shouldn't be common unless admin UI)\nvar UserCollection = Backbone.Collection.extend( baseMVC.LoggableMixin ).extend({\n    model   : User,\n    urlRoot : function(){ return Galaxy.root + 'api/users'; },\n    //logger  : console,\n});\n\n\n//==============================================================================\nreturn {\n    User : User\n};});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/user/user-model.js\n **/","define([\n    'libs/underscore',\n    'libs/backbone',\n    'mvc/base-mvc',\n    'mvc/user/user-model',\n    'utils/metrics-logger',\n    'utils/add-logging',\n    'utils/localization'\n], function( _, Backbone, BASE_MVC, userModel, metricsLogger, addLogging, localize ){\n\n// TODO: move into a singleton pattern and have dependents import Galaxy\n// ============================================================================\n/** Base galaxy client-side application.\n *      Iniitializes:\n *          logger      : the logger/metrics-logger\n *          localize    : the string localizer\n *          config      : the current configuration (any k/v in\n *              galaxy.ini available from the configuration API)\n *          user        : the current user (as a mvc/user/user-model)\n */\nfunction GalaxyApp( options, bootstrapped ){\n    var self = this;\n    return self._init( options || {}, bootstrapped || {} );\n}\n\n// add logging shortcuts for this object\naddLogging( GalaxyApp, 'GalaxyApp' );\n\n// a debug flag can be set via local storage and made available during script/page loading\nvar DEBUGGING_KEY = 'galaxy:debug',\n    NAMESPACE_KEY = DEBUGGING_KEY + ':namespaces',\n    localDebugging = false;\ntry {\n    localDebugging = localStorage.getItem( DEBUGGING_KEY ) == 'true';\n} catch( storageErr ){\n    console.log( localize( 'localStorage not available for debug flag retrieval' ) );\n}\n\n/** initalize options and sub-components */\nGalaxyApp.prototype._init = function __init( options, bootstrapped ){\n    var self = this;\n    _.extend( self, Backbone.Events );\n    if( localDebugging ){\n        self.logger = console;\n        console.debug( 'debugging galaxy:', 'options:', options, 'bootstrapped:', bootstrapped );\n    }\n\n    self._processOptions( options );\n    // special case for root\n    self.root = options.root || '/';\n\n    self._initConfig( options.config || {} );\n    self._patchGalaxy( window.Galaxy );\n\n    self._initLogger( self.options.loggerOptions || {} );\n    // at this point, either logging or not and namespaces are enabled - chat it up\n    self.debug( 'GalaxyApp.options: ', self.options );\n    self.debug( 'GalaxyApp.config: ', self.config );\n    self.debug( 'GalaxyApp.logger: ', self.logger );\n\n    self._initLocale();\n    self.debug( 'GalaxyApp.localize: ', self.localize );\n\n    self.config = options.config || {};\n    self.debug( 'GalaxyApp.config: ', self.config );\n\n    self._initUser( options.user || {} );\n    self.debug( 'GalaxyApp.user: ', self.user );\n\n    self._setUpListeners();\n    self.trigger( 'ready', self );\n\n    return self;\n};\n\n/** default options */\nGalaxyApp.prototype.defaultOptions = {\n    /** monkey patch attributes from existing window.Galaxy object? */\n    patchExisting   : true,\n    /** root url of this app */\n    root            : '/'\n};\n\n/** filter to options present in defaultOptions (and default to them) */\nGalaxyApp.prototype._processOptions = function _processOptions( options ){\n    var self = this,\n        defaults = self.defaultOptions;\n\n    self.options = {};\n    for( var k in defaults ){\n        if( defaults.hasOwnProperty( k ) ){\n            self.options[ k ] = ( options.hasOwnProperty( k ) )?( options[ k ] ):( defaults[ k ] );\n        }\n    }\n    return self;\n};\n\n/** parse the config and any extra info derived from it */\nGalaxyApp.prototype._initConfig = function _initConfig( config ){\n    var self = this;\n    self.config = config;\n\n    // give precendence to localdebugging for this setting\n    self.config.debug = localDebugging || self.config.debug;\n\n    return self;\n};\n\n/** add an option from options if the key matches an option in defaultOptions */\nGalaxyApp.prototype._patchGalaxy = function _patchGalaxy( patchWith ){\n    var self = this;\n    // in case req or plain script tag order has created a prev. version of the Galaxy obj...\n    if( self.options.patchExisting && patchWith ){\n        // self.debug( 'found existing Galaxy object:', patchWith );\n        // ...(for now) monkey patch any added attributes that the previous Galaxy may have had\n        //TODO: move those attributes to more formal assignment in GalaxyApp\n        for( var k in patchWith ){\n            if( patchWith.hasOwnProperty( k ) ){\n                // self.debug( '\\t patching in ' + k + ' to Galaxy:', self[ k ] );\n                self[ k ] = patchWith[ k ];\n            }\n        }\n    }\n};\n\n/** set up the metrics logger (utils/metrics-logger) and pass loggerOptions */\nGalaxyApp.prototype._initLogger = function _initLogger( loggerOptions ){\n    var self = this;\n\n    // default to console logging at the debug level if the debug flag is set\n    if( self.config.debug ){\n        loggerOptions.consoleLogger = loggerOptions.consoleLogger || console;\n        loggerOptions.consoleLevel = loggerOptions.consoleLevel || metricsLogger.MetricsLogger.ALL;\n        // load any logging namespaces from localStorage if we can\n        try {\n            loggerOptions.consoleNamespaceWhitelist = localStorage.getItem( NAMESPACE_KEY ).split( ',' );\n        } catch( storageErr ){}\n    }\n\n    self.logger = new metricsLogger.MetricsLogger( loggerOptions );\n    self.emit = {};\n    [ 'log', 'debug', 'info', 'warn', 'error', 'metric' ].map(function( i ) {\n        self.emit[ i ] = function( data ){\n            self.logger.emit( i, arguments[ 0 ], Array.prototype.slice.call( arguments, 1 ) );\n        };\n    });\n\n    if( self.config.debug ){\n        // add this logger to mvc's loggable mixin so that all models can use the logger\n        BASE_MVC.LoggableMixin.logger = self.logger;\n    }\n    return self;\n};\n\n/** add the localize fn to this object and the window namespace (as '_l') */\nGalaxyApp.prototype._initLocale = function _initLocale( options ){\n    var self = this;\n    self.debug( '_initLocale:', options );\n    self.localize = localize;\n    // add to window as global shortened alias\n    // TODO: temporary - remove when can require for plugins\n    window._l = self.localize;\n    return self;\n};\n\n/** set up the current user as a Backbone model (mvc/user/user-model) */\nGalaxyApp.prototype._initUser = function _initUser( userJSON ){\n    var self = this;\n    self.debug( '_initUser:', userJSON );\n    self.user = new userModel.User( userJSON );\n    self.user.logger = self.logger;\n    return self;\n};\n\n/** Set up DOM/jQuery/Backbone event listeners enabled for all pages */\nGalaxyApp.prototype._setUpListeners = function _setUpListeners(){\n    var self = this;\n\n    // hook to jq beforeSend to record the most recent ajax call and cache some data about it\n    /** cached info about the last ajax call made through jQuery */\n    self.lastAjax = {};\n    $( document ).bind( 'ajaxSend', function( ev, xhr, options ){\n        var data = options.data;\n        try {\n            data = JSON.parse( data );\n        } catch( err ){}\n\n        self.lastAjax = {\n            url     : location.href.slice( 0, -1 ) + options.url,\n            data    : data\n        };\n        //TODO:?? we might somehow manage to *retry* ajax using either this hook or Backbone.sync\n    });\n    return self;\n};\n\n/** Turn debugging/console-output on/off by passing boolean. Pass nothing to get current setting. */\nGalaxyApp.prototype.debugging = function _debugging( setting ){\n    var self = this;\n    try {\n        if( setting === undefined ){\n            return localStorage.getItem( DEBUGGING_KEY ) === 'true';\n        }\n        if( setting ){\n            localStorage.setItem( DEBUGGING_KEY, true );\n            return true;\n        }\n\n        localStorage.removeItem( DEBUGGING_KEY );\n        // also remove all namespaces\n        self.debuggingNamespaces( null );\n\n    } catch( storageErr ){\n        console.log( localize( 'localStorage not available for debug flag retrieval' ) );\n    }\n    return false;\n};\n\n/** Add, remove, or clear namespaces from the debugging filters\n *  Pass no arguments to retrieve the existing namespaces as an array.\n *  Pass in null to clear all namespaces (all logging messages will show now).\n *  Pass in an array of strings or single string of the namespaces to filter to.\n *  Returns the new/current namespaces as an array;\n */\nGalaxyApp.prototype.debuggingNamespaces = function _debuggingNamespaces( namespaces ){\n    var self = this;\n    try {\n        if( namespaces === undefined ){\n            var csv = localStorage.getItem( NAMESPACE_KEY );\n            return typeof( csv ) === 'string'? csv.split( ',' ) : [];\n        } else if( namespaces === null ) {\n            localStorage.removeItem( NAMESPACE_KEY );\n        } else {\n            localStorage.setItem( NAMESPACE_KEY, namespaces );\n        }\n        var newSettings = self.debuggingNamespaces();\n        if( self.logger ){\n            self.logger.options.consoleNamespaceWhitelist = newSettings;\n        }\n        return newSettings;\n    } catch( storageErr ){\n        console.log( localize( 'localStorage not available for debug namespace retrieval' ) );\n    }\n};\n\n/** string rep */\nGalaxyApp.prototype.toString = function toString(){\n    var userEmail = this.user? ( this.user.get( 'email' ) || '(anonymous)' ) : 'uninitialized';\n    return 'GalaxyApp(' + userEmail + ')';\n};\n\n// ============================================================================\n    return {\n        GalaxyApp : GalaxyApp\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/galaxy.js\n **/","define([\n    'utils/utils',\n    'layout/menu',\n    'layout/scratchbook',\n    'mvc/user/user-quotameter',\n], function( Utils, Menu, Scratchbook, QuotaMeter ) {\n\n/** Masthead **/\nvar View = Backbone.View.extend({\n    initialize : function( options ) {\n        var self = this;\n        this.options = options;\n        this.setElement( this._template() );\n        this.$navbarBrandLink   = this.$( '.navbar-brand-link' );\n        this.$navbarBrandImage  = this.$( '.navbar-brand-image' );\n        this.$navbarBrandTitle  = this.$( '.navbar-brand-title' );\n        this.$navbarTabs        = this.$( '.navbar-tabs' );\n        this.$quoteMeter        = this.$( '.quota-meter-container' );\n\n        // build tabs\n        this.collection = new Menu.Collection();\n        this.collection.on( 'add', function( model ) {\n            self.$navbarTabs.append( new Menu.Tab( { model : model } ).render().$el );\n        }).on( 'reset', function() {\n            self.$navbarTabs.empty();\n        }).on( 'dispatch', function( callback ) {\n            self.collection.each( function ( m ) { callback( m ) });\n        }).fetch( this.options );\n\n        // scratchbook\n        Galaxy.frame = this.frame = new Scratchbook( { collection: this.collection } );\n\n        // set up the quota meter (And fetch the current user data from trans)\n        // add quota meter to masthead\n        Galaxy.quotaMeter = this.quotaMeter = new QuotaMeter.UserQuotaMeter({\n            model   : Galaxy.user,\n            el      : this.$quoteMeter\n        });\n\n        // loop through beforeunload functions if the user attempts to unload the page\n        $( window ).on( 'click', function( e ) {\n            var $download_link = $( e.target ).closest( 'a[download]' );\n            if ( $download_link.length == 1 ) {\n                if( $( 'iframe[id=download]' ).length === 0 ) {\n                    $( 'body' ).append( $( '<iframe/>' ).attr( 'id', 'download' ).hide() );\n                }\n                $( 'iframe[id=download]' ).attr( 'src', $download_link.attr( 'href' ) );\n                e.preventDefault();\n            }\n        }).on( 'beforeunload', function() {\n            var text = '';\n            self.collection.each( function( model ) {\n                var q = model.get( 'onbeforeunload' ) && model.get( 'onbeforeunload' )();\n                q && ( text += q + ' ' );\n            });\n            if ( text !== '' ) {\n                return text;\n            }\n        });\n    },\n\n    render: function() {\n        this.$navbarBrandTitle.html( 'Galaxy ' + ( this.options.brand && '/ ' + this.options.brand || '' ) );\n        this.$navbarBrandLink.attr( 'href', this.options.logo_url );\n        this.$navbarBrandImage.attr( 'src', this.options.logo_src );\n        this.quotaMeter.render();\n        return this;\n    },\n\n    /** body template */\n    _template: function() {\n        return  '<div id=\"masthead\" class=\"navbar navbar-fixed-top navbar-inverse\">' +\n                    '<div class=\"navbar-header\">' +\n                        '<div class=\"navbar-tabs\"/>' +\n                    '</div>' +\n                    '<div class=\"navbar-brand\">' +\n                        '<a class=\"navbar-brand-link\">' +\n                            '<img class=\"navbar-brand-image\"/>' +\n                            '<span class=\"navbar-brand-title\"/>' +\n                        '</a>' +\n                    '</div>' +\n                    '<div class=\"quota-meter-container\"/>' +\n                    '<div class=\"navbar-icons\"/>' +\n                '</div>';\n    }\n});\n\nreturn {\n    View: View\n};\n\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/layout/masthead.js\n **/","/** Masthead Collection **/\ndefine(['mvc/tours'], function( Tours ) {\nvar Collection = Backbone.Collection.extend({\n    model: Backbone.Model.extend({\n        defaults: {\n            visible         : true,\n            target          : '_parent'\n        }\n    }),\n    fetch: function( options ){\n        options = options || {};\n        this.reset();\n\n        //\n        // Analyze data tab.\n        //\n        this.add({\n            id              : 'analysis',\n            title           : 'Analyze Data',\n            url             : '',\n            tooltip         : 'Analysis home view'\n        });\n\n        //\n        // Workflow tab.\n        //\n        this.add({\n            id              : 'workflow',\n            title           : 'Workflow',\n            url             : 'workflow',\n            tooltip         : 'Chain tools into workflows',\n            disabled        : !Galaxy.user.id\n        });\n\n        //\n        // 'Shared Items' or Libraries tab.\n        //\n        this.add({\n            id              : 'shared',\n            title           : 'Shared Data',\n            url             : 'library/index',\n            tooltip         : 'Access published resources',\n            menu            : [{\n                    title   : 'Data Libraries',\n                    url     : 'library/list'\n                },{\n                    title   : 'Histories',\n                    url     : 'history/list_published'\n                },{\n                    title   : 'Workflows',\n                    url     : 'workflow/list_published'\n                },{\n                    title   : 'Visualizations',\n                    url     : 'visualization/list_published'\n                },{\n                    title   : 'Pages',\n                    url     : 'page/list_published'\n            }]\n        });\n\n        //\n        // Lab menu.\n        //\n        options.user_requests && this.add({\n            id              : 'lab',\n            title           : 'Lab',\n            menu            : [{\n                    title   : 'Sequencing Requests',\n                    url     : 'requests/index'\n                },{\n                    title   : 'Find Samples',\n                    url     : 'requests/find_samples_index'\n                },{\n                    title   : 'Help',\n                    url     : options.lims_doc_url\n            }]\n        });\n\n        //\n        // Visualization tab.\n        //\n        this.add({\n            id              : 'visualization',\n            title           : 'Visualization',\n            url             : 'visualization/list',\n            tooltip         : 'Visualize datasets',\n            disabled        : !Galaxy.user.id,\n            menu            : [{\n                    title   : 'New Track Browser',\n                    url     : 'visualization/trackster',\n                    target  : '_frame'\n                },{\n                    title   : 'Saved Visualizations',\n                    url     : 'visualization/list',\n                    target  : '_frame'\n                },{\n                    title   : 'Interactive Environments',\n                    url     : 'visualization/gie_list',\n                    target  : 'galaxy_main'\n                }\n            ]\n        });\n\n        //\n        // Admin.\n        //\n        Galaxy.user.get( 'is_admin' ) && this.add({\n            id              : 'admin',\n            title           : 'Admin',\n            url             : 'admin',\n            tooltip         : 'Administer this Galaxy',\n            cls             : 'admin-only'\n        });\n\n        //\n        // Help tab.\n        //\n        var helpTab = {\n            id              : 'help',\n            title           : 'Help',\n            tooltip         : 'Support, contact, and community hubs',\n            menu            : [{\n                    title   : 'Support',\n                    url     : options.support_url,\n                    target  : '_blank'\n                },{\n                    title   : 'Search',\n                    url     : options.search_url,\n                    target  : '_blank'\n                },{\n                    title   : 'Mailing Lists',\n                    url     : options.mailing_lists,\n                    target  : '_blank'\n                },{\n                    title   : 'Videos',\n                    url     : options.screencasts_url,\n                    target  : '_blank'\n                },{\n                    title   : 'Wiki',\n                    url     : options.wiki_url,\n                    target  : '_blank'\n                },{\n                    title   : 'How to Cite Galaxy',\n                    url     : options.citation_url,\n                    target  : '_blank'\n                },{\n                    title   : 'Interactive Tours',\n                    url     : 'tours',\n                    onclick : function(){\n                        if (Galaxy.app){\n                            Galaxy.app.display(new Tours.ToursView());\n                        } else {\n                            // Redirect and use clientside routing to go to tour index\n                            window.location = Galaxy.root + \"tours\";\n                        }\n                    }\n            }]\n        };\n        options.terms_url && helpTab.menu.push({\n            title   : 'Terms and Conditions',\n            url     : options.terms_url,\n            target  : '_blank'\n        });\n        options.biostar_url && helpTab.menu.unshift({\n            title   : 'Ask a question',\n            url     : 'biostar/biostar_question_redirect',\n            target  : '_blank'\n        });\n        options.biostar_url && helpTab.menu.unshift({\n            title   : 'Galaxy Biostar',\n            url     : options.biostar_url_redirect,\n            target  : '_blank'\n        });\n        this.add( helpTab );\n\n        //\n        // User tab.\n        //\n        if ( !Galaxy.user.id ){\n            var userTab = {\n                id              : 'user',\n                title           : 'User',\n                cls             : 'loggedout-only',\n                tooltip         : 'Account registration or login',\n                menu            : [{\n                    title       : 'Login',\n                    url         : 'user/login',\n                    target      : 'galaxy_main'\n                }]\n            };\n            options.allow_user_creation && userTab.menu.push({\n                title   : 'Register',\n                url     : 'user/create',\n                target  : 'galaxy_main'\n            });\n            this.add( userTab );\n        } else {\n            var userTab = {\n                id              : 'user',\n                title           : 'User',\n                cls             : 'loggedin-only',\n                tooltip         : 'Account preferences and saved data',\n                menu            : [{\n                        title   : 'Logged in as ' + Galaxy.user.get( 'email' )\n                    },{\n                        title   : 'Preferences',\n                        url     : 'user?cntrller=user',\n                        target  : 'galaxy_main'\n                    },{\n                        title   : 'Custom Builds',\n                        url     : 'user/dbkeys',\n                        target  : 'galaxy_main'\n                    },{\n                        title   : 'Logout',\n                        url     : 'user/logout',\n                        target  : '_top',\n                        divider : true\n                    },{\n                        title   : 'Saved Histories',\n                        url     : 'history/list',\n                        target  : 'galaxy_main'\n                    },{\n                        title   : 'Saved Datasets',\n                        url     : 'dataset/list',\n                        target  : 'galaxy_main'\n                    },{\n                        title   : 'Saved Pages',\n                        url     : 'page/list',\n                        target  : '_top'\n                    },{\n                        title   : 'API Keys',\n                        url     : 'user/api_keys?cntrller=user',\n                        target  : 'galaxy_main'\n                }]\n            };\n            options.use_remote_user && userTab.menu.push({\n                title   : 'Public Name',\n                url     : 'user/edit_username?cntrller=user',\n                target  : 'galaxy_main'\n            });\n            this.add( userTab );\n        }\n        var activeView = this.get( options.active_view );\n        activeView && activeView.set( 'active', true );\n        return new jQuery.Deferred().resolve().promise();\n    }\n});\n\n/** Masthead tab **/\nvar Tab = Backbone.View.extend({\n    initialize: function ( options ) {\n        this.model = options.model;\n        this.setElement( this._template() );\n        this.$dropdown  = this.$( '.dropdown' );\n        this.$toggle    = this.$( '.dropdown-toggle' );\n        this.$menu      = this.$( '.dropdown-menu' );\n        this.$note      = this.$( '.dropdown-note' );\n        this.listenTo( this.model, 'change', this.render, this );\n    },\n\n    events: {\n        'click .dropdown-toggle' : '_toggleClick'\n    },\n\n    render: function() {\n        var self = this;\n        $( '.tooltip' ).remove();\n        this.$el.attr( 'id', this.model.id )\n                .css( { visibility : this.model.get( 'visible' ) && 'visible' || 'hidden' } );\n        this.model.set( 'url', this._formatUrl( this.model.get( 'url' ) ) );\n        this.$note.html( this.model.get( 'note' ) || '' )\n                  .removeClass().addClass( 'dropdown-note' )\n                  .addClass( this.model.get( 'note_cls' ) )\n                  .css( { 'display' : this.model.get( 'show_note' ) && 'block' || 'none' } )\n        this.$toggle.html( this.model.get( 'title' ) || '' )\n                    .removeClass().addClass( 'dropdown-toggle' )\n                    .addClass( this.model.get( 'cls' ) )\n                    .addClass( this.model.get( 'icon' ) && 'dropdown-icon fa ' + this.model.get( 'icon' ) )\n                    .addClass( this.model.get( 'toggle' ) && 'toggle' )\n                    .attr( 'target', this.model.get( 'target' ) )\n                    .attr( 'href', this.model.get( 'url' ) )\n                    .attr( 'title', this.model.get( 'tooltip' ) )\n                    .tooltip( 'destroy' );\n        this.model.get( 'tooltip' ) && this.$toggle.tooltip( { placement: 'bottom' } );\n        this.$dropdown.removeClass().addClass( 'dropdown' )\n                      .addClass( this.model.get( 'disabled' ) && 'disabled' )\n                      .addClass( this.model.get( 'active' ) && 'active' );\n        if ( this.model.get( 'menu' ) && this.model.get( 'show_menu' ) ) {\n            this.$menu.show();\n            $( '#dd-helper' ).show().off().on( 'click',  function() {\n                $( '#dd-helper' ).hide();\n                self.model.set( 'show_menu', false );\n            });\n        } else {\n            self.$menu.hide();\n            $( '#dd-helper' ).hide();\n        }\n        this.$menu.empty().removeClass( 'dropdown-menu' );\n        if ( this.model.get( 'menu' ) ) {\n            _.each( this.model.get( 'menu' ), function( menuItem ) {\n                self.$menu.append( self._buildMenuItem( menuItem ) );\n                menuItem.divider && self.$menu.append( $( '<li/>' ).addClass( 'divider' ) );\n            });\n            self.$menu.addClass( 'dropdown-menu' );\n            self.$toggle.append( $( '<b/>' ).addClass( 'caret' ) );\n        }\n        return this;\n    },\n\n    /** Add new menu item */\n    _buildMenuItem: function ( options ) {\n        var self = this;\n        options = _.defaults( options || {}, {\n            title       : '',\n            url         : '',\n            target      : '_parent'\n        });\n        options.url = self._formatUrl( options.url );\n        return $( '<li/>' ).append(\n            $( '<a/>' ).attr( 'href', options.url )\n                       .attr( 'target', options.target )\n                       .html( options.title )\n                       .on( 'click', function( e ) {\n                            e.preventDefault();\n                            self.model.set( 'show_menu', false );\n                            if (options.onclick){\n                                options.onclick();\n                            } else {\n                                Galaxy.frame.add( options );\n                            }\n                       })\n        );\n    },\n\n    /** Handle click event */\n    _toggleClick: function( e ) {\n        var self = this;\n        var model = this.model;\n        e.preventDefault();\n        $( '.tooltip' ).hide();\n        model.trigger( 'dispatch', function( m ) {\n            model.id !== m.id && m.get( 'menu' ) && m.set( 'show_menu', false );\n        });\n        if ( !model.get( 'disabled' ) ) {\n            if ( !model.get( 'menu' ) ) {\n                model.get( 'onclick' ) ? model.get( 'onclick' )() : Galaxy.frame.add( model.attributes );\n            } else {\n                model.set( 'show_menu', true );\n            }\n        } else {\n            function buildLink( label, url ) {\n                return $( '<div/>' ).append( $( '<a/>' ).attr( 'href', Galaxy.root + url ).html( label ) ).html()\n            }\n            this.$toggle.popover && this.$toggle.popover( 'destroy' );\n            this.$toggle.popover({\n                html        : true,\n                placement   : 'bottom',\n                content     : 'Please ' + buildLink( 'login', 'user/login?use_panels=True' ) + ' or ' +\n                                          buildLink( 'register', 'user/create?use_panels=True' ) + ' to use this feature.'\n            }).popover( 'show' );\n            setTimeout( function() { self.$toggle.popover( 'destroy' ) }, 5000 );\n        }\n    },\n\n    /** Url formatting */\n    _formatUrl: function( url ) {\n        return typeof url == 'string' && url.indexOf( '//' ) === -1 && url.charAt( 0 ) != '/' ? Galaxy.root + url : url;\n    },\n\n    /** body tempate */\n    _template: function () {\n        return  '<ul class=\"nav navbar-nav\">' +\n                    '<li class=\"dropdown\">' +\n                        '<a class=\"dropdown-toggle\"/>' +\n                        '<ul class=\"dropdown-menu\"/>' +\n                        '<div class=\"dropdown-note\"/>' +\n                    '</li>' +\n                '</ul>';\n    }\n});\n\nreturn {\n    Collection  : Collection,\n    Tab         : Tab\n};\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/layout/menu.js\n **/","define([\n    'layout/masthead',\n    'layout/panel',\n    'mvc/ui/ui-modal',\n    'mvc/base-mvc'\n], function( Masthead, Panel, Modal, BaseMVC ) {\n\n// ============================================================================\nvar PageLayoutView = Backbone.View.extend( BaseMVC.LoggableMixin ).extend({\n    _logNamespace : 'layout',\n\n    el : 'body',\n    className : 'full-content',\n\n    _panelIds : [\n        'left', 'center', 'right'\n    ],\n\n    defaultOptions : {\n        message_box_visible     : false,\n        message_box_content     : '',\n        message_box_class       : 'info',\n        show_inactivity_warning : false,\n        inactivity_box_content  : ''\n    },\n\n    initialize : function( options ) {\n        // TODO: remove globals\n        this.log( this + '.initialize:', options );\n        _.extend( this, _.pick( options, this._panelIds ) );\n        this.options = _.defaults( _.omit( options.config, this._panelIds ), this.defaultOptions );\n        Galaxy.modal = this.modal = new Modal.View();\n        this.masthead = new Masthead.View( this.options );\n        this.$el.attr( 'scroll', 'no' );\n        this.$el.html( this._template() );\n        this.$el.append( this.masthead.frame.$el );\n        this.$( '#masthead' ).replaceWith( this.masthead.$el );\n        this.$el.append( this.modal.$el );\n        this.$messagebox = this.$( '#messagebox' );\n        this.$inactivebox = this.$( '#inactivebox' );\n    },\n\n    render : function() {\n        // TODO: Remove this line after select2 update\n        $( '.select2-hidden-accessible' ).remove();\n        this.log( this + '.render:' );\n        this.masthead.render();\n        this.renderMessageBox();\n        this.renderInactivityBox();\n        this.renderPanels();\n        return this;\n    },\n\n    /** Render message box */\n    renderMessageBox : function() {\n        if ( this.options.message_box_visible ){\n            var content = this.options.message_box_content || '';\n            var level = this.options.message_box_class || 'info';\n            this.$el.addClass( 'has-message-box' );\n            this.$messagebox\n                .attr( 'class', 'panel-' + level + '-message' )\n                .html( content )\n                .toggle( !!content )\n                .show();\n        } else {\n            this.$el.removeClass( 'has-message-box' );\n            this.$messagebox.hide();\n        }\n        return this;\n    },\n\n    /** Render inactivity warning */\n    renderInactivityBox : function() {\n        if( this.options.show_inactivity_warning ){\n            var content = this.options.inactivity_box_content || '';\n            var verificationLink = $( '<a/>' ).attr( 'href', Galaxy.root + 'user/resend_verification' ).text( 'Resend verification' );\n            this.$el.addClass( 'has-inactivity-box' );\n            this.$inactivebox\n                .html( content + ' ' )\n                .append( verificationLink )\n                .toggle( !!content )\n                .show();\n        } else {\n            this.$el.removeClass( 'has-inactivity-box' );\n            this.$inactivebox.hide();\n        }\n        return this;\n    },\n\n    /** Render panels */\n    renderPanels : function() {\n        var page = this;\n        this._panelIds.forEach( function( panelId ){\n            if( _.has( page, panelId ) ){\n                page[ panelId ].setElement( '#' + panelId );\n                page[ panelId ].render();\n            }\n        });\n        if( !this.left ){\n            this.center.$el.css( 'left', 0 );\n        }\n        if( !this.right ){\n            this.center.$el.css( 'right', 0 );\n        }\n        return this;\n    },\n\n    /** body template */\n    _template: function() {\n        return [\n            '<div id=\"everything\">',\n                '<div id=\"background\"/>',\n                '<div id=\"masthead\"/>',\n                '<div id=\"messagebox\"/>',\n                '<div id=\"inactivebox\" class=\"panel-warning-message\" />',\n                this.left?   '<div id=\"left\" />' : '',\n                this.center? '<div id=\"center\" class=\"inbound\" />' : '',\n                this.right?  '<div id=\"right\" />' : '',\n            '</div>',\n            '<div id=\"dd-helper\" />',\n        ].join('');\n    },\n\n    /** hide both side panels if previously shown */\n    hideSidePanels : function(){\n        if( this.left ){\n            this.left.hide();\n        }\n        if( this.right ){\n            this.right.hide();\n        }\n    },\n\n    toString : function() { return 'PageLayoutView'; }\n});\n\n// ============================================================================\n    return {\n        PageLayoutView: PageLayoutView\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/layout/page.js\n **/","/** Frame manager uses the ui-frames to create the scratch book masthead icon and functionality **/\ndefine([ 'mvc/ui/ui-frames' ], function( Frames ) {\nreturn Backbone.View.extend({\n    initialize : function( options ) {\n        var self = this;\n        options = options || {};\n        this.frames = new Frames.View({ visible : false });\n        this.setElement( this.frames.$el );\n        this.buttonActive = options.collection.add({\n            id              : 'enable-scratchbook',\n            icon            : 'fa-th',\n            tooltip         : 'Enable/Disable Scratchbook',\n            onclick         : function() {\n                self.active = !self.active;\n                self.buttonActive.set({\n                    toggle    : self.active,\n                    show_note : self.active,\n                    note_cls  : self.active && 'fa fa-check'\n                });\n                !self.active && self.frames.hide();\n            },\n            onbeforeunload  : function() {\n                if ( self.frames.length() > 0 ) {\n                    return 'You opened ' + self.frames.length() + ' frame(s) which will be lost.';\n                }\n            }\n        });\n        this.buttonLoad = options.collection.add({\n            id              : 'show-scratchbook',\n            icon            : 'fa-eye',\n            tooltip         : 'Show/Hide Scratchbook',\n            show_note       : true,\n            visible         : false,\n            onclick         : function( e ) {\n                self.frames.visible ? self.frames.hide() : self.frames.show();\n            }\n        });\n        this.frames.on( 'add remove', function() {\n            this.visible && this.length() == 0 && this.hide();\n            self.buttonLoad.set( { 'note': this.length(), 'visible': this.length() > 0 } );\n        }).on( 'show hide ', function() {\n            self.buttonLoad.set( { 'toggle': this.visible, 'icon': this.visible && 'fa-eye' || 'fa-eye-slash' } );\n        });\n        this.history_cache = {};\n    },\n\n    /** Add a dataset to the frames */\n    addDataset: function( dataset_id ) {\n        var self = this;\n        var current_dataset = null;\n        if ( Galaxy && Galaxy.currHistoryPanel ) {\n            var history_id = Galaxy.currHistoryPanel.collection.historyId;\n            this.history_cache[ history_id ] = { name: Galaxy.currHistoryPanel.model.get( 'name' ), dataset_ids: [] };\n            Galaxy.currHistoryPanel.collection.each( function( model ) {\n                !model.get( 'deleted' ) && model.get( 'visible' ) && self.history_cache[ history_id ].dataset_ids.push( model.get( 'id' ) );\n            });\n        }\n        var _findDataset = function( dataset, offset ) {\n            if ( dataset ) {\n                var history_details = self.history_cache[ dataset.get( 'history_id' ) ];\n                if ( history_details && history_details.dataset_ids ) {\n                    var dataset_list = history_details.dataset_ids;\n                    var pos = dataset_list.indexOf( dataset.get( 'id' ) );\n                    if ( pos !== -1 && pos + offset >= 0 && pos + offset < dataset_list.length ) {\n                        return dataset_list[ pos + offset ];\n                    }\n                }\n            }\n        };\n        var _loadDatasetOffset = function( dataset, offset, frame ) {\n            var new_dataset_id = _findDataset( dataset, offset );\n            if ( new_dataset_id ) {\n                self._loadDataset( new_dataset_id, function( new_dataset, config ) {\n                    current_dataset = new_dataset;\n                    frame.model.set( config );\n                });\n            } else {\n                frame.model.trigger( 'change' );\n            }\n        }\n        this._loadDataset( dataset_id, function( dataset, config ) {\n            current_dataset = dataset;\n            self.add( _.extend( { menu: [ { icon     : 'fa fa-chevron-circle-left',\n                                            tooltip  : 'Previous in History',\n                                            onclick  : function( frame ) { _loadDatasetOffset( current_dataset, -1, frame ) },\n                                            disabled : function() { return !_findDataset( current_dataset, -1 ) } },\n                                          { icon     : 'fa fa-chevron-circle-right',\n                                            tooltip  : 'Next in History',\n                                            onclick  : function( frame ) { _loadDatasetOffset( current_dataset, 1, frame ) },\n                                            disabled : function() { return !_findDataset( current_dataset, 1 ) } } ] }, config ) )\n        });\n    },\n\n    _loadDataset: function( dataset_id, callback ) {\n        var self = this;\n        require([ 'mvc/dataset/data' ], function( DATA ) {\n            var dataset = new DATA.Dataset( { id : dataset_id } );\n            $.when( dataset.fetch() ).then( function() {\n                var is_tabular = _.find( [ 'tabular', 'interval' ] , function( data_type ) {\n                    return dataset.get( 'data_type' ).indexOf( data_type ) !== -1;\n                });\n                var title = dataset.get( 'name' );\n                var history_details = self.history_cache[ dataset.get( 'history_id' ) ];\n                if ( history_details ) {\n                    title = history_details.name + ': ' + title;\n                }\n                callback( dataset, is_tabular ? {\n                    title   : title,\n                    url     : null,\n                    content : DATA.createTabularDatasetChunkedView({\n                        model       : new DATA.TabularDataset( dataset.toJSON() ),\n                        embedded    : true,\n                        height      : '100%'\n                    }).$el\n                } : {\n                    title   : title,\n                    url     : Galaxy.root + 'datasets/' + dataset_id + '/display/?preview=True',\n                    content : null\n                } );\n            });\n        });\n    },\n\n    /** Add a trackster visualization to the frames. */\n    addTrackster: function(viz_id) {\n        var self = this;\n        require(['viz/visualization', 'viz/trackster'], function(visualization, trackster) {\n            var viz = new visualization.Visualization({id: viz_id});\n            $.when( viz.fetch() ).then( function() {\n                var ui = new trackster.TracksterUI(Galaxy.root);\n\n                // Construct frame config based on dataset's type.\n                var frame_config = {\n                        title: viz.get('name'),\n                        type: 'other',\n                        content: function(parent_elt) {\n                            // Create view config.\n                            var view_config = {\n                                container: parent_elt,\n                                name: viz.get('title'),\n                                id: viz.id,\n                                // FIXME: this will not work with custom builds b/c the dbkey needed to be encoded.\n                                dbkey: viz.get('dbkey'),\n                                stand_alone: false\n                            },\n                            latest_revision = viz.get('latest_revision'),\n                            drawables = latest_revision.config.view.drawables;\n\n                            // Set up datasets in drawables.\n                            _.each(drawables, function(d) {\n                                d.dataset = {\n                                    hda_ldda: d.hda_ldda,\n                                    id: d.dataset_id\n                                };\n                            });\n                            view = ui.create_visualization(view_config,\n                                                           latest_revision.config.viewport,\n                                                           latest_revision.config.view.drawables,\n                                                           latest_revision.config.bookmarks,\n                                                           false);\n                        }\n                    };\n                self.add(frame_config);\n            });\n        });\n    },\n\n    /** Add and display a new frame/window based on options. */\n    add: function( options ) {\n        if ( options.target == '_blank' ) {\n            window.open( options.url );\n        } else if ( options.target == '_top' || options.target == '_parent' || options.target == '_self' ) {\n            window.location = options.url;\n        } else if ( !this.active ) {\n            var $galaxy_main = $( window.parent.document ).find( '#galaxy_main' );\n            if ( options.target == 'galaxy_main' || options.target == 'center' ) {\n                if ( $galaxy_main.length === 0 ) {\n                    window.location = options.url + ( href.indexOf( '?' ) == -1 ? '?' : '&' ) + 'use_panels=True';\n                } else {\n                    $galaxy_main.attr( 'src', options.url );\n                }\n            } else\n                window.location = options.url;\n        } else {\n            this.frames.add( options );\n        }\n    }\n});\n\n});\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/layout/scratchbook.js\n **/","define([\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( baseMVC, _l ){\n'use strict';\n\nvar logNamespace = 'user';\n//==============================================================================\n/** @class View to display a user's disk/storage usage\n *      either as a progress bar representing the percentage of a quota used\n *      or a simple text element displaying the human readable size used.\n *  @name UserQuotaMeter\n *  @augments Backbone.View\n */\nvar UserQuotaMeter = Backbone.View.extend( baseMVC.LoggableMixin ).extend(\n/** @lends UserQuotaMeter.prototype */{\n    _logNamespace : logNamespace,\n\n    /** Defaults for optional settings passed to initialize */\n    options : {\n        warnAtPercent   : 85,\n        errorAtPercent  : 100\n    },\n\n    /** Set up, accept options, and bind events */\n    initialize : function( options ){\n        this.log( this + '.initialize:', options );\n        _.extend( this.options, options );\n\n        //this.bind( 'all', function( event, data ){ this.log( this + ' event:', event, data ); }, this );\n        this.listenTo( this.model, 'change:quota_percent change:total_disk_usage', this.render );\n    },\n\n    /** Re-load user model data from the api */\n    update : function( options ){\n        this.log( this + ' updating user data...', options );\n        this.model.loadFromApi( this.model.get( 'id' ), options );\n        return this;\n    },\n\n    /** Is the user over their quota (if there is one)?\n     * @returns {Boolean} true if over quota, false if no quota or under quota\n     */\n    isOverQuota : function(){\n        return ( this.model.get( 'quota_percent' ) !== null\n              && this.model.get( 'quota_percent' ) >= this.options.errorAtPercent );\n    },\n\n    /** Render the meter when they have an applicable quota. Will render as a progress bar\n     *      with their percentage of that quota in text over the bar.\n     *  @fires quota:over when user is over quota (>= this.errorAtPercent)\n     *  @fires quota:under when user is under quota\n     *  @fires quota:under:approaching when user is >= this.warnAtPercent of their quota\n     *  @fires quota:under:ok when user is below this.warnAtPercent\n     *  @returns {jQuery} the rendered meter\n     */\n    _render_quota : function(){\n        var modelJson = this.model.toJSON(),\n            //prevPercent = this.model.previous( 'quota_percent' ),\n            percent = modelJson.quota_percent,\n            //meter = $( UserQuotaMeter.templates.quota( modelJson ) );\n            $meter = $( this._templateQuotaMeter( modelJson ) ),\n            $bar = $meter.find( '.progress-bar' );\n        //this.log( this + '.rendering quota, percent:', percent, 'meter:', meter );\n\n        // OVER QUOTA: color the quota bar and show the quota error message\n        if( this.isOverQuota() ){\n            //this.log( '\\t over quota' );\n            $bar.attr( 'class', 'progress-bar progress-bar-danger' );\n            $meter.find( '.quota-meter-text' ).css( 'color', 'white' );\n            //TODO: only trigger event if state has changed\n            this.trigger( 'quota:over', modelJson );\n\n        // APPROACHING QUOTA: color the quota bar\n        } else if( percent >= this.options.warnAtPercent ){\n            //this.log( '\\t approaching quota' );\n            $bar.attr( 'class', 'progress-bar progress-bar-warning' );\n            //TODO: only trigger event if state has changed\n            this.trigger( 'quota:under quota:under:approaching', modelJson );\n\n        // otherwise, hide/don't use the msg box\n        } else {\n            $bar.attr( 'class', 'progress-bar progress-bar-success' );\n            //TODO: only trigger event if state has changed\n            this.trigger( 'quota:under quota:under:ok', modelJson );\n        }\n        return $meter;\n    },\n\n    /** Render the meter when the user has NO applicable quota. Will render as text\n     *      showing the human readable sum storage their data is using.\n     *  @returns {jQuery} the rendered text\n     */\n    _render_usage : function(){\n        //var usage = $( UserQuotaMeter.templates.usage( this.model.toJSON() ) );\n        var usage = $( this._templateUsage( this.model.toJSON() ) );\n        this.log( this + '.rendering usage:', usage );\n        return usage;\n    },\n\n    /** Render either the quota percentage meter or the human readable disk usage\n     *      depending on whether the user model has quota info (quota_percent === null -> no quota)\n     *  @returns {Object} this UserQuotaMeter\n     */\n    render : function(){\n        //this.log( this + '.rendering' );\n        var meterHtml = null;\n\n        // no quota on server ('quota_percent' === null (can be valid at 0)), show usage instead\n        this.log( this + '.model.quota_percent:', this.model.get( 'quota_percent' ) );\n        if( ( this.model.get( 'quota_percent' ) === null )\n        ||  ( this.model.get( 'quota_percent' ) === undefined ) ){\n            meterHtml = this._render_usage();\n\n        // otherwise, render percent of quota (and warning, error)\n        } else {\n            meterHtml = this._render_quota();\n            //TODO: add the original text for unregistered quotas\n            //tooltip = \"Your disk quota is %s.  You can increase your quota by registering a Galaxy account.\"\n        }\n\n        this.$el.html( meterHtml );\n        this.$el.find( '.quota-meter-text' ).tooltip();\n        return this;\n    },\n\n    _templateQuotaMeter : function( data ){\n        return [\n            '<div id=\"quota-meter\" class=\"quota-meter progress\">',\n                '<div class=\"progress-bar\" style=\"width: ', data.quota_percent, '%\"></div>',\n                '<div class=\"quota-meter-text\" style=\"top: 6px\"',\n                    (( data.nice_total_disk_usage )?( ' title=\"Using ' + data.nice_total_disk_usage + '\">' ):( '>' )),\n                    _l( 'Using' ), ' ', data.quota_percent, '%',\n                '</div>',\n            '</div>'\n        ].join( '' );\n    },\n\n    _templateUsage : function( data ){\n        return [\n            '<div id=\"quota-meter\" class=\"quota-meter\" style=\"background-color: transparent\">',\n                '<div class=\"quota-meter-text\" style=\"top: 6px; color: white\">',\n                    (( data.nice_total_disk_usage )?( _l( 'Using ' ) + data.nice_total_disk_usage ):( '' )),\n                '</div>',\n            '</div>'\n        ].join( '' );\n    },\n\n    toString : function(){\n        return 'UserQuotaMeter(' + this.model + ')';\n    }\n});\n\n\n//==============================================================================\nreturn {\n    UserQuotaMeter : UserQuotaMeter\n};});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/mvc/user/user-quotameter.js\n **/","define([\n], function(){\n/*global window, jQuery, console */\n/*=============================================================================\nTODO:\n    while anon: logs saved to 'logs-null' - this will never post\n        unless we manually do so at/after login\n        OR prepend when userId and localStorage has 'logs-null'\n    wire up _delayPost and test\n\n=============================================================================*/\n/** @class MetricsLogger\n *\n *  Object to cache, output, and post log/metric messages to the server.\n *  Meant to be attached to the Galaxy object.\n *\n *  Log from objects by either attaching logger directly:\n *      panel.logger.metric( 'user dataset deletion', panel.user.id, hda.toJSON() )\n *  or using the LoggableMixin or addLogging function:\n *      MyBackboneModel.extend( LoggableMixin ).extend({ ... })\n *      addLogging( MyBackboneModel, 'my-backbone-model' )\n *\n *  Log from templates by calling directly from Galaxy object:\n *      Galaxy.logger.metric( 'template loaded', { ownedByUser : true });\n *\n *  If you attempt to log an un-serializable object (circular reference, window, etc.),\n *  that entry will not be cached (or sent). If you set consoleLevel and consoleLogger\n *  appropriately, a warning will be shown when this happens:\n *      > panel.metric( 'something weird with window', { window : window })\n *      !'Metrics logger could not stringify logArguments: ...'\n */\nfunction MetricsLogger( options ){\n    options = options || {};\n    var self = this;\n\n    ///** get the current user's id from bootstrapped data or options */\n    self.userId = ( window.bootstrapped && window.bootstrapped.user )? window.bootstrapped.user.id: null;\n    self.userId = self.userId || options.userId || null;\n\n    /** the (optional) console to emit logs to */\n    self.consoleLogger = options.consoleLogger || null;\n\n    self._init( options );\n    return self;\n}\n\n//----------------------------------------------------------------------------- defaults and constants\n// see: python std lib, logging\nMetricsLogger.ALL   =  0;\nMetricsLogger.LOG   =  0;\nMetricsLogger.DEBUG = 10;\nMetricsLogger.INFO  = 20;\nMetricsLogger.WARN  = 30;\nMetricsLogger.ERROR = 40;\n// metrics levels here?\n//MetricsLogger.MinorEvent  = 45;\n//MetricsLogger.MajorEvent  = 50;\nMetricsLogger.METRIC = 50;\nMetricsLogger.NONE = 100;\n\n/** default options - override these through the constructor */\nMetricsLogger.defaultOptions = {\n    /** if an incoming message has a level >= this, it will be cached - can also be a string (e.g. 'debug') */\n    logLevel            : MetricsLogger.NONE,\n    /** if an incoming message has a level >= this, it will be output to the console */\n    consoleLevel        : MetricsLogger.NONE,\n    /** the default 'namespace' or label associated with an incoming message (if none is passed) */\n    defaultNamespace    : 'Galaxy',\n    /** the namespaces output to the console (all namespaces will be output if this is falsy)\n     *  note: applies only to the console (not the event/metrics log/cache)\n     */\n    consoleNamespaceWhitelist : null,\n    /** the prefix attached to client-side logs to distinguish them in the metrics db */\n    clientPrefix        : 'client.',\n\n    /** the maximum number of messages the cache should hold; if exceeded older messages are removed first */\n    maxCacheSize        : 3000,\n    /** the number of messages accumulate before posting to the server; should be <= maxCacheSize */\n    postSize            : 1000,\n    /** T/F whether to add a timestamp to incoming cached messages */\n    addTime             : true,\n    /** string to prefix to userid for cache web storage */\n    cacheKeyPrefix      : 'logs-',\n\n    /** the relative url to post messages to */\n    postUrl             : '/api/metrics',\n    /** delay before trying post again after two failures */\n    delayPostInMs       : 1000 * 60 * 10,\n\n    /** an (optional) function that should return an object; used to send additional data with the metrics */\n    getPingData         : undefined,\n    /** an (optional) function that will handle the servers response after successfully posting messages */\n    onServerResponse    : undefined\n};\n\n//----------------------------------------------------------------------------- set up\n/** initialize the logger with options, set up instance vars and cache, and add onpageunload to window */\nMetricsLogger.prototype._init = function _init( options ){\n    var self = this;\n    self.options = {};\n    for( var k in MetricsLogger.defaultOptions ){\n        if( MetricsLogger.defaultOptions.hasOwnProperty( k ) ){\n            self.options[ k ] = ( options.hasOwnProperty( k ) )?( options[ k ] ):( MetricsLogger.defaultOptions[ k ] );\n        }\n    }\n    self.options.logLevel = self._parseLevel( self.options.logLevel );\n    self.options.consoleLevel = self._parseLevel( self.options.consoleLevel );\n    //self._emitToConsole( 'debug', 'MetricsLogger', 'MetricsLogger.options:', self.options );\n\n    /** is the logger currently sending? */\n    self._sending = false;\n    /** the setTimeout id if the logger POST has failed more than once */\n    self._waiting = null;\n    /** the current number of entries to send in a POST */\n    self._postSize = self.options.postSize;\n\n    self._initCache();\n\n    return self;\n};\n\n/** initialize the cache */\nMetricsLogger.prototype._initCache = function _initCache(){\n    try {\n        this.cache = new LoggingCache({\n            maxSize : this.options.maxCacheSize,\n            key     : this.options.cacheKeyPrefix + this.userId\n        });\n    } catch( err ){\n        this._emitToConsole( 'warn', 'MetricsLogger', [ 'Could not intitialize logging cache:', err ] );\n        this.options.logLevel = MetricsLogger.NONE;\n    }\n};\n\n/** return the numeric log level if level in 'none, debug, log, info, warn, error' */\nMetricsLogger.prototype._parseLevel = function _parseLevel( level ){\n    var type = typeof level;\n    if( type === 'number' ){ return level; }\n    if( type === 'string' ){\n        var upper = level.toUpperCase();\n        if( MetricsLogger.hasOwnProperty( upper ) ){\n            return MetricsLogger[ upper ];\n        }\n    }\n    throw new Error( 'Unknown log level: ' + level );\n};\n\n\n//----------------------------------------------------------------------------- main entry point\n/** record a log/message's arguments to the cache and/or the console based on level and namespace */\nMetricsLogger.prototype.emit = function emit( level, namespace, logArguments ){\n    //this._emitToConsole( 'debug', 'MetricsLogger', [ 'emit:', level, namespace, logArguments ]);\n    var self = this;\n    namespace = namespace || self.options.defaultNamespace;\n    if( !level || !logArguments ){\n        return self;\n    }\n    // add to cache if proper level\n    //TODO: respect do not track?\n    //if( !navigator.doNotTrack && level >= self.options.logLevel ){\n    level = self._parseLevel( level );\n    if( level >= self.options.logLevel ){\n        self._addToCache( level, namespace, logArguments );\n    }\n    // also emit to consoleLogger if proper level for that\n    if( self.consoleLogger && level >= self.options.consoleLevel ){\n        self._emitToConsole( level, namespace, logArguments );\n    }\n    return self;\n};\n\n//----------------------------------------------------------------------------- cache\n/** add a message to the cache and if messages.length is high enough post them to the server */\nMetricsLogger.prototype._addToCache = function _addToCache( level, namespace, logArguments ){\n    this._emitToConsole( 'debug', 'MetricsLogger',\n        [ '_addToCache:', arguments, this.options.addTime, this.cache.length() ]);\n    //this._emitToConsole( 'debug', 'MetricsLogger', [ '\\t logArguments:', logArguments ]);\n    var self = this;\n    // try add to the cache and if we've got _postSize number of entries, attempt to post them to the server\n    try {\n        var newLength = self.cache.add( self._buildEntry( level, namespace, logArguments ) );\n        if( newLength >= self._postSize ){\n            self._postCache();\n        }\n    // discard entry if an error occurs, but warn if level set to do so\n    } catch( err ){\n        self._emitToConsole( 'warn', 'MetricsLogger',\n            [ 'Metrics logger could not stringify logArguments:', namespace, logArguments ] );\n        self._emitToConsole( 'error', 'MetricsLogger', [ err ] );\n\n    }\n    return self;\n};\n\n/** build a log cache entry object from the given level, namespace, and arguments (optionally adding timestamp */\nMetricsLogger.prototype._buildEntry = function _buildEntry( level, namespace, logArguments ){\n    this._emitToConsole( 'debug', 'MetricsLogger', [ '_buildEntry:', arguments ]);\n    var entry = {\n            level       : level,\n            namespace   : this.options.clientPrefix + namespace,\n            args        : logArguments\n        };\n    if( this.options.addTime ){\n        entry.time = new Date().toISOString();\n    }\n    return entry;\n};\n\n/** post _postSize messages from the cache to the server, removing them if successful\n *      if the post fails, wait until maxCacheSize is accumulated instead and try again then\n *      in addition to the messages from the cache ('metrics'), any info from getPingData (if set) will be sent\n *      onServerResponse will be called (if set) with any response from the server\n */\nMetricsLogger.prototype._postCache = function _postCache( options ){\n    options = options || {};\n    this._emitToConsole( 'info', 'MetricsLogger', [ '_postCache', options, this._postSize ]);\n\n    // short circuit if we're already sending\n    if( !this.options.postUrl || this._sending ){\n        return jQuery.when({});\n    }\n\n    var self = this,\n        postSize = options.count || self._postSize,\n        // do not splice - remove after *successful* post\n        entries = self.cache.get( postSize ),\n        entriesLength = entries.length,\n        // use the optional getPingData to add any extra info we may want to send\n        postData = ( typeof self.options.getPingData === 'function' )?( self.options.getPingData() ):( {} );\n    //console.debug( postSize, entriesLength );\n\n    // add the metrics and send\n    postData.metrics = JSON.stringify( entries );\n    //console.debug( postData.metrics );\n    self._sending = true;\n    return jQuery.post( self.options.postUrl, postData )\n        .always( function(){\n            self._sending = false;\n        })\n        .fail( function( xhr, status, message ){\n            // if we failed the previous time, set the next post target to the max num of entries\n            self._postSize = self.options.maxCacheSize;\n//TODO:??\n            // log this failure to explain any gap in metrics\n            self.emit( 'error', 'MetricsLogger', [ '_postCache error:',\n                xhr.readyState, xhr.status, xhr.responseJSON || xhr.responseText ]);\n//TODO: still doesn't solve the problem that when cache == max, post will be tried on every emit\n//TODO: see _delayPost\n        })\n        .done( function( response ){\n            if( typeof self.options.onServerResponse === 'function' ){\n                self.options.onServerResponse( response );\n            }\n            // only remove if post successful\n            self.cache.remove( entriesLength );\n            //console.debug( 'removed entries:', entriesLength, 'size now:', self.cache.length() );\n            // if we succeeded, reset the post target to the normal num of entries\n            self._postSize = self.options.postSize;\n        });\n    // return the xhr promise\n};\n\n/** set _waiting to true and, after delayPostInMs, set it back to false */\nMetricsLogger.prototype._delayPost = function _delayPost(){\n//TODO: this won't work between pages\n    var self = this;\n    self._waiting = setTimeout( function(){\n        self._waiting = null;\n    }, self.options.delayPostInMs );\n};\n\n\n//----------------------------------------------------------------------------- console\n/** output message to console based on level and consoleLogger type */\nMetricsLogger.prototype._emitToConsole = function _emitToConsole( level, namespace, logArguments ){\n    //console.debug( '_emitToConsole:', level, namespace, logArguments );\n    var self = this,\n        whitelist = self.options.consoleNamespaceWhitelist;\n    if( !self.consoleLogger ){ return self; }\n    // if a whitelist for namespaces is set, bail if this namespace is not in the list\n    if( whitelist && whitelist.indexOf( namespace ) === -1 ){\n        return self;\n    }\n\n    var args = Array.prototype.slice.call( logArguments, 0 );\n    args.unshift( namespace );\n//TODO: script location and/or source maps?\n//TODO: branch on navigator.userAgent == AIIEEE - it only has log\n    if(        level >= MetricsLogger.METRIC && typeof( self.consoleLogger.info ) === 'function' ){\n        return self.consoleLogger.info.apply( self.consoleLogger, args );\n\n    } else if( level >= MetricsLogger.ERROR && typeof( self.consoleLogger.error ) === 'function' ){\n        return self.consoleLogger.error.apply( self.consoleLogger, args );\n    } else if( level >= MetricsLogger.WARN && typeof( self.consoleLogger.warn ) === 'function' ){\n        self.consoleLogger.warn.apply( self.consoleLogger, args );\n    } else if( level >= MetricsLogger.INFO && typeof( self.consoleLogger.info ) === 'function' ){\n        self.consoleLogger.info.apply( self.consoleLogger, args );\n    } else if( level >= MetricsLogger.DEBUG && typeof( self.consoleLogger.debug ) === 'function' ){\n        self.consoleLogger.debug.apply( self.consoleLogger, args );\n    } else if( typeof( self.consoleLogger.log ) === 'function' ){\n        self.consoleLogger.log.apply( self.consoleLogger, args );\n    }\n    return self;\n};\n\n//----------------------------------------------------------------------------- shortcuts\n// generic functions when logging from non-namespaced object (e.g. templates)\n/** log to default namespace */\nMetricsLogger.prototype.log = function log(){\n    this.emit( 1, this.options.defaultNamespace,\n        Array.prototype.slice.call( arguments, 0 ) );\n};\n\n/** debug to default namespace */\nMetricsLogger.prototype.debug = function debug(){\n    this.emit( MetricsLogger.DEBUG, this.options.defaultNamespace,\n        Array.prototype.slice.call( arguments, 0 ) );\n};\n\n/** info to default namespace */\nMetricsLogger.prototype.info = function info(){\n    this.emit( MetricsLogger.INFO, this.options.defaultNamespace,\n        Array.prototype.slice.call( arguments, 0 ) );\n};\n\n/** warn to default namespace */\nMetricsLogger.prototype.warn = function warn(){\n    this.emit( MetricsLogger.WARN, this.options.defaultNamespace,\n        Array.prototype.slice.call( arguments, 0 ) );\n};\n\n/** error to default namespace */\nMetricsLogger.prototype.error = function error(){\n    this.emit( MetricsLogger.ERROR, this.options.defaultNamespace,\n        Array.prototype.slice.call( arguments, 0 ) );\n};\n\n/** metric to default namespace */\nMetricsLogger.prototype.metric = function metric(){\n    this.emit( MetricsLogger.METRIC, this.options.defaultNamespace,\n        Array.prototype.slice.call( arguments, 0 ) );\n};\n\n\n/* ============================================================================\nTODO:\n    need a performance pass - the JSON un/parsing is a bit much\n\n============================================================================ */\n/** @class LoggingCache\n *  Simple implementation of cache wrapping an array.\n *\n *  Formats an entry before it's cached and only keeps options.maxSize number\n *  of entries. Older entries are deleted first.\n */\nfunction LoggingCache( options ){\n    var self = this;\n    return self._init( options || {} );\n}\n\n/** default options */\nLoggingCache.defaultOptions = {\n    /** maximum number of entries to keep before discarding oldest */\n    maxSize     : 5000\n};\n\n/** initialize with options */\nLoggingCache.prototype._init = function _init( options ){\n    if( !this._hasStorage() ){\n        //TODO: fall back to jstorage\n        throw new Error( 'LoggingCache needs localStorage' );\n    }\n    if( !options.key ){\n        throw new Error( 'LoggingCache needs key for localStorage' );\n    }\n    this.key = options.key;\n    this._initStorage();\n\n    this.maxSize = options.maxSize || LoggingCache.defaultOptions.maxSize;\n    return this;\n};\n\n/** tests for localStorage fns */\nLoggingCache.prototype._hasStorage = function _hasStorage(){\n//TODO: modernizr\n    var test = 'test';\n    try {\n        localStorage.setItem( test, test );\n        localStorage.removeItem( test );\n        return true;\n    } catch( e ){\n        return false;\n    }\n};\n\n/** if no localStorage set for key, initialize to empty array */\nLoggingCache.prototype._initStorage = function _initStorage(){\n    if( localStorage.getItem( this.key ) === null ){\n        return this.empty();\n    }\n    return this;\n};\n\n/** add an entry to the cache, removing the oldest beforehand if size >= maxSize */\nLoggingCache.prototype.add = function add( entry ){\n    var self = this,\n        _cache = self._fetchAndParse(),\n        overage = ( _cache.length + 1 ) - self.maxSize;\n    if( overage > 0 ){\n        _cache.splice( 0, overage );\n    }\n    _cache.push( entry );\n    self._unparseAndStore( _cache );\n    return _cache.length;\n};\n\n/** get the entries from localStorage and parse them */\nLoggingCache.prototype._fetchAndParse = function _fetchAndParse(){\n    var self = this;\n    return JSON.parse( localStorage.getItem( self.key ) );\n};\n\n/** stringify the entries and put them in localStorage */\nLoggingCache.prototype._unparseAndStore = function _unparseAndStore( entries ){\n    var self = this;\n    return localStorage.setItem( self.key, JSON.stringify( entries ) );\n};\n\n///** process the entry before caching */\n//LoggingCache.prototype._preprocessEntry = function _preprocessEntry( entry ){\n//    return JSON.stringify( entry );\n//};\n\n/** return the length --- oh, getters where are you? */\nLoggingCache.prototype.length = function length(){\n    return this._fetchAndParse().length;\n};\n\n/** get count number of entries starting with the oldest */\nLoggingCache.prototype.get = function get( count ){\n    return this._fetchAndParse().slice( 0, count );\n};\n\n/** remove count number of entries starting with the oldest */\nLoggingCache.prototype.remove = function remove( count ){\n    var _cache = this._fetchAndParse(),\n        removed = _cache.splice( 0, count );\n    this._unparseAndStore( _cache );\n    return removed;\n};\n\n/** empty/clear the entire cache */\nLoggingCache.prototype.empty = function empty(){\n    localStorage.setItem( this.key, '[]' );\n    return this;\n};\n\n/** stringify count number of entries (but do not remove) */\nLoggingCache.prototype.stringify = function stringify( count ){\n    return JSON.stringify( this.get( count ) );\n};\n\n/** outputs entire cache to console */\nLoggingCache.prototype.print = function print(){\n    // popup? (really, carl? a popup?) - easier to copy/paste\n    console.log( JSON.stringify( this._fetchAndParse(), null, '  ' ) );\n};\n\n\n//=============================================================================\n    return {\n        MetricsLogger  : MetricsLogger,\n        LoggingCache   : LoggingCache\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./galaxy/scripts/utils/metrics-logger.js\n **/"],"sourceRoot":""}