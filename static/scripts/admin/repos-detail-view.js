define(["libs/toastr","admin/repos-model","utils/utils"],function(a,b,c){var d=Backbone.View.extend({el:"#center",defaults:{},events:{"change .select-version":"selectVersion"},jstree:null,initialize:function(a){this.options=_.defaults(this.options||{},a,this.defaults),this.model=new b.Repo,this.listenTo(this.model,"sync",this.render),this.fetchRepo(this.options.id)},render:function(a){this.options=_.extend(this.options,a);var b=this.templateRepoDetail();this.$el.html(b({repo:this.model})),$(".select-version").length>0&&$(".select-version").val(this.model.get("id")),this.bindEvents(),this.$el.find("[data-toggle]").tooltip(),$("#center").css("overflow","auto")},rePaint:function(a){$(".repos_container").remove(),this.fetchRepo(a.id),this.render(a)},bindEvents:function(){var a=this;$("#repo_collapse_browser").on("show.bs.collapse",function(){a.refreshRepoTree()})},fetchRepo:function(a){this.model.url=this.model.urlRoot+"/"+a+"?all_versions=true",this.model.fetch({success:function(){},error:function(){}})},selectVersion:function(a){var b=$(a.currentTarget).val();this.model.id!==b&&this.rePaint({id:b})},refreshRepoTree:function(a){var b=this;this.options=_.extend(this.options,a),0===$("#repo_jstree_browser").children().length&&(this.renderJstree(a),$("#repo_jstree_browser").on("changed.jstree",function(a,c){"file"===c.node.type?b.previewFile(c.node):"folder"===c.node.type&&$("#repo_jstree_browser").jstree("toggle_node",c.node)}))},renderJstree:function(c){this.options=_.extend(this.options,c),this.jstree=new b.Jstree,this.jstree.url=this.jstree.urlRoot+this.model.id+"/files",this.jstree.fetch({success:function(a){define("jquery",function(){return jQuery}),require(["libs/jquery/jstree"],function(){$("#repo_jstree_browser").jstree("destroy"),$("#repo_jstree_browser").jstree({core:{data:a},plugins:["types","changed","wholerow"],types:{folder:{icon:"jstree-folder"},file:{icon:"jstree-file"}}})})},error:function(b,c){"undefined"!=typeof c.responseJSON?404001===c.responseJSON.err_code?a.warning(c.responseJSON.err_msg):a.error(c.responseJSON.err_msg):a.error("An error ocurred.")}})},previewFile:function(a){$(".code-preview").html("loading..."),this.fetchFile(a.li_attr.full_path,this.model.get("changeset_revision"))},fetchFile:function(b,d){c.get({url:this.model.urlRoot+"/"+this.model.id+"/fetch",data:{path:b,repo_revision:d},success:function(a){$(".code-preview").html(a)},error:function(b){a.error("Failed to fetch preview of the requested file."),Galaxy.emit.debug("admin-repos::fetchFile()","Fetch file preview request failed.",b)}})},templateRepoDetail:function(){return _.template(['<div class="repos_container">','<div class="detail-toolbar">','<a href="#repos">< back to installed repositories</a>',"<button>reset metadata</button>","<button>update</button>","<button>uninstall</button>","<button>set tool versions</button>","</div>",'<div class="repo_accord" role="tablist">','<div class="card">','<a role="button" data-toggle="collapse" data-parent=".repo_accord" href="#repo_collapse_1">','<div class="card-header" role="tab" id="repo_section_1">','<h5 class="card-title">',"Repository Details","</h5>","</div>","</a>",'<div id="repo_collapse_1" class="card-collapse collapse in" role="tabpanel">','<div class="card-body">','<table class="grid table table-condensed">',"<tbody>","<tr>",'<td style="width:33%;">Name</td>','<td><%- repo.get("name") %></td>',"</tr>","<tr>","<td>Owner</td>",'<td><%- repo.get("owner") %></td>',"</tr>","<tr>","<td>Tool Shed</td>",'<td><%- repo.get("tool_shed") %></td>',"</tr>","<tr>","<td>Description</td>",'<td><%- repo.get("description") %></td>',"</tr>","<tr>","<td>Version</td>","<td>",'<% if(repo.get("versions")) { %>','<select class="form-control select-version">','<% _.each(repo.get("versions"), function(version) { %>','<option value="<%- version.id %>"><%- version.ctx_rev %> (<%- version.changeset_revision %>)</option>',"<% }) %>","</select>",'<a href="<%- repo.get("revision_url") %>" target="_blank">',"see this revision in Tool Shed","</a>","<% } else { %>",'<a href="<%- repo.get("revision_url") %>" target="_blank" data-toggle="tooltip" data-placement="right" title="show in Tool Shed">','<%- repo.get("revision_url") %>',"</a>","<% }%>","</td>","</tr>","</tbody>","</table>","</div>","</div>","</div>",'<div class="card">','<a role="button" data-toggle="collapse" data-parent=".repo_accord" href="#repo_collapse_2">','<div class="card-header" role="tab" id="repo_section_2">','<h5 class="card-title">',"Installation Details","</h5>","</div>","</a>",'<div id="repo_collapse_2" class="card-collapse collapse in" role="tabpanel">','<div class="card-body">','<table class="grid table table-condensed">',"<tbody>","<tr>",'<td style="width: 33%;">Status</td>',"<td>",'<div class="celldiv status-<%- repo.get("status").toLowerCase().replace(/ /g,"-") %>">','<%- repo.get("status").toLowerCase() %>','<% if(repo.get("collapsed_repos")) { %>','<span data-toggle="tooltip" data-placement="top" title="multiple revisions detected" class="fa fa-compress icon-inline"/>',"<% } %>","</div>","</td>","</tr>","<tr>","<td>Date Installed</td>",'<td data-toggle="tooltip" data-placement="left" title="<%- repo.get("create_time").date %>" >','<%- repo.get("create_time").interval %>',"</td>","</tr>","<tr>","<td>Location</td>",'<td><%- repo.get("repo_location") %></td>',"</tr>","<tr>","<td>ID</td>",'<td><%- repo.get("id") %></td>',"</tr>","</tbody>","</table>","</div>","</div>","</div>",'<div class="card">','<a role="button" data-toggle="collapse" data-parent=".repo_accord" href="#repo_collapse_3">','<div class="card-header" role="tab" id="repo_section_3">','<h5 class="card-title">',"Artifacts","</h5>","</div>","</a>",'<div id="repo_collapse_3" class="card-collapse collapse" role="tabpanel">','<div class="card-body">',"sdsd","</div>","</div>","</div>",'<div class="card">','<a role="button" data-toggle="collapse" data-parent=".repo_accord" href="#repo_collapse_4">','<div class="card-header" role="tab" id="repo_section_4">','<h5 class="card-title">',"Dependency Resolver Details","</h5>","</div>","</a>",'<div id="repo_collapse_4" class="card-collapse collapse" role="tabpanel">','<div class="card-body">',"sdsd","</div>","</div>","</div>",'<div class="card">','<a role="button" data-toggle="collapse" data-parent=".repo_accord" href="#repo_collapse_5">','<div class="card-header" role="tab" id="repo_section_5">','<h5 class="card-title">',"Dependencies","</h5>","</div>","</a>",'<div id="repo_collapse_5" class="card-collapse collapse" role="tabpanel">','<div class="card-body">',"sdsd","</div>","</div>","</div>",'<div class="card">','<a role="button" data-toggle="collapse" data-parent=".repo_accord" href="#repo_collapse_browser" class="repo-browser">','<div class="card-header" role="tab" id="repo_section_6">','<h5 class="card-title">',"Browse files","</h5>","</div>","</a>",'<div id="repo_collapse_browser" class="card-collapse collapse" role="tabpanel">','<div class="card-body">','<div>repository contents at <%- repo.get("changeset_revision") %></div>','<div id="repo_jstree_browser">',"</div>",'<div class="file-preview">',"<pre>",'<code class="code-preview">',"</code>","</pre>","</div>","</div>","</div>","</div>","</div>","</div>"].join(""))}});return{AdminReposDetailView:d}});
//# sourceMappingURL=../../maps/admin/repos-detail-view.js.map