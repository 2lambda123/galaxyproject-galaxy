define(["viz/visualization","libs/bbi/bigwig"],function(a,b){var c=a.GenomeDataManager.extend({load_data:function(a){var c=$.Deferred();this.set_data(a,c);var d=Galaxy.root+"datasets/"+this.get("dataset").id+"/display",e=this;return $.when(b.makeBwg(d)).then(function(b){var d=b.check_min_zoom(a.get("chrom"),a.get("start"),a.get("end")),f=new $.Deferred,g=f;if(d>=0)for(var h=d;h>=-1;h--)g=e.check_zoom_data(b,a,h,g);else g=e.check_zoom_data(b,a,-1,g);$.when(g).then(function(b){var d={data:b,region:a,dataset_type:"bigwig"};e.set_data(a,d),c.resolve(d)}),f.resolve([])}),c},check_zoom_data:function(a,b,c,d){var e=new $.Deferred,f=1e3;return $.when(d).then(function(d){d.length>0?e.resolve(d):$.when(a.readWigData(b.get("chrom"),b.get("start"),b.get("end"),c)).then(function(a){if(-1==c||a.length>f){var b=[],d={max:Number.MIN_VALUE};a.forEach(function(a){d.max!==a.min-1&&(b.push([d.max+1,0]),b.push([a.min-2,0])),b.push([a.min-1,a.score]),b.push([a.max,a.score]),d=a}),e.resolve(b)}else e.resolve([])})}),e}});return{BBIDataManager:c}});
//# sourceMappingURL=../../maps/viz/bbi-data-manager.js.map