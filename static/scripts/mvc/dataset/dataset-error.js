define("mvc/dataset/dataset-error",["exports","utils/localization","utils/utils","mvc/ui/ui-misc","mvc/form/form-view"],function(e,a,t,r,s){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0});var n=o(a),i=o(t),l=o(r),d=o(s),u=Backbone.View.extend({initialize:function(){this.setElement("<div/>"),this.model=new Backbone.Model({dataset_id:Galaxy.params.dataset_id}),this.render()},render:function(){var e=Galaxy.root+"api/datasets/"+this.model.get("dataset_id"),a=this;i.default.get({url:e,success:function(e){var t=Galaxy.root+"api/jobs/"+e.creating_job+"?full=True";i.default.get({url:t,success:function(t){Galaxy.root,e.creating_job;a.render_error_page(a,e,t)},error:function(e){var t={status:"error",message:"Error occured while loading the job.",persistent:!0,cls:"errormessage"};a.display_message(t,a.$(".response-message"))}})},error:function(e){var t={status:"error",message:"Error occured while loading the dataset.",persistent:!0,cls:"errormessage"};a.display_message(t,a.$(".response-message"))}})},render_error_page:function(e,a,t){e.$el.empty().append(e._templateHeader()),e.$el.append("<h2>Dataset Error</h2>"),e.$el.append("<p>An error occured while running the tool <b>"+t.tool_id+"</b>.</p>"),e.$el.append("<p>Tool execution generated the following messages:</p>"),e.$el.append('<pre class="code">'+t.stderr+"</pre>"),e.$el.append("<h2>Report This Error</pre>"),e.$el.append("<p>Usually the local Galaxy administrators regularly review errors that occur on the server. However, if you would like to provide additional information (such as what you were trying to do when the error occurred) and a contact e-mail address, we will be better able to investigate your problem and get back to you.</p>"),e.$el.append(e._getBugFormTemplate(a,t))},display_message:function(e,a,t,r){r?t?a.append(new l.default.UnescapedMessage(e).$el):a.empty().html(new l.default.UnescapedMessage(e).$el):t?a.append(new l.default.Message(e).$el):a.empty().html(new l.default.Message(e).$el)},_templateHeader:function(){return'<div class="page-container edit-attr"><div class="response-message"></div></div>'},_getBugFormTemplate:function(e,a){var t=this,r=[{help:(0,n.default)("Your email address"),options:[],type:"text",name:"email",label:"Your email",value:Galaxy.user.get("email")},{help:(0,n.default)("Any additional comments you can provide regarding what you were doing at the time of the bug."),options:[],type:"text",area:!0,name:"message",label:"Message"}],s=new d.default({title:(0,n.default)("Error Report"),inputs:r,buttons:{save:new l.default.Button({icon:"fa-bug",title:(0,n.default)("Report"),cls:"ui-button btn btn-primary",floating:"clear",onclick:function(){var r=s.data.create(),o=Galaxy.root+"api/jobs/"+a.id+"/error";r.dataset_id=e.id,t.submit(r,o)}})}});return s.$el},submit:function(e,a){var t=this;$.ajax({type:"POST",url:a,data:e,success:function(e){t.$el.empty().append(t._templateHeader()),e.messages.forEach(function(e){t.display_message({status:e[1],message:e[0],persistent:!0},t.$(".response-message"),!0,!0)})},error:function(e){var a={status:"error",message:"Error occured while saving. Please fill all the required fields and try again.",persistent:!0,cls:"errormessage"};t.display_message(a,t.$(".response-message"))}})}});e.default={View:u}});