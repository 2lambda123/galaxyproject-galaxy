<tool id="dataset_options_filter" name="dataset_options_filter" version="1.0">
  <command>
    cat '$input1' > '$out_file1'
  </command>
  <inputs>
    <param format="txt" name="input1" type="data"/>
    <param format="txt" name="input2" type="data">
      <options>
        <filter type="data_meta" ref="input1" key="dbkey" />
      </options>
    </param>
  </inputs>
  <outputs>
    <data format="txt" name="out_file1"/>
  </outputs>
  <tests>
    <test>
      <param name="input1" value="simple_line.txt" dbkey="hg17" ftype="txt"/>
      <param name="input2" value="simple_line_x2.txt" dbkey="hg17" ftype="txt"/>
      <output name="out_file1" file="simple_line.txt"/>
    </test>
    <!-- functional test of the dbkey filter of input2: only the dbkey of input1 is accepted -->
    <test expect_test_failure="true">
      <param name="input1" value="simple_line.txt" dbkey="hg17" ftype="txt"/>
      <param name="input2" value="simple_line_x2.txt" dbkey="hg19" ftype="txt"/>
      <output name="out_file1" file="simple_line.txt"/>
    </test>
    <!-- functional test of the dbkey filter of input2: any dbkey is accepted if input1 has no dbkey-->
    <test>
      <param name="input1" value="simple_line.txt" ftype="txt"/>
      <param name="input2" value="simple_line_x2.txt" dbkey="hg19" ftype="txt"/>
      <output name="out_file1" file="simple_line.txt"/>
    </test>
    <!-- functional test of the dbkey filter of input2: -->
    <test expect_test_failure="true">
      <param name="input1" value="simple_line.txt" dbkey="hg17" ftype="txt"/>
      <param name="input2" value="simple_line_x2.txt" ftype="txt"/>
      <output name="out_file1" file="simple_line.txt"/>
    </test>
  </tests>
  <help>
  </help>
</tool>
